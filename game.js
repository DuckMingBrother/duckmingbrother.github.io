/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/app.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./bin/libs/laya.ani.js":
/*!******************************!*\
  !*** ./bin/libs/laya.ani.js ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Bezier=laya.maths.Bezier,Browser=laya.utils.Browser,Byte=laya.utils.Byte,Event=laya.events.Event;\r\n\tvar EventDispatcher=laya.events.EventDispatcher,Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas;\r\n\tvar Handler=laya.utils.Handler,Loader=laya.net.Loader,MathUtil=laya.maths.MathUtil,Matrix=laya.maths.Matrix;\r\n\tvar Node=laya.display.Node,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render;\r\n\tvar RenderContext=laya.renders.RenderContext,Resource=laya.resource.Resource,RunDriver=laya.utils.RunDriver;\r\n\tvar Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils;\r\n/**\r\n*@private\r\n*@author ...\r\n*/\r\n//class laya.ani.AnimationContent\r\nvar AnimationContent=(function(){\r\n\tfunction AnimationContent(){\r\n\t\tthis.nodes=null;\r\n\t\tthis.name=null;\r\n\t\tthis.playTime=NaN;\r\n\t\tthis.bone3DMap=null;\r\n\t\tthis.totalKeyframeDatasLength=0;\r\n\t}\r\n\r\n\t__class(AnimationContent,'laya.ani.AnimationContent');\r\n\treturn AnimationContent;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*@author ...\r\n*/\r\n//class laya.ani.AnimationNodeContent\r\nvar AnimationNodeContent=(function(){\r\n\tfunction AnimationNodeContent(){\r\n\t\tthis.name=null;\r\n\t\tthis.parentIndex=0;\r\n\t\tthis.parent=null;\r\n\t\tthis.keyframeWidth=0;\r\n\t\tthis.lerpType=0;\r\n\t\tthis.interpolationMethod=null;\r\n\t\tthis.childs=null;\r\n\t\tthis.keyFrame=null;\r\n\t\t//=new Vector.<KeyFramesContent>;\r\n\t\tthis.playTime=NaN;\r\n\t\tthis.extenData=null;\r\n\t\tthis.dataOffset=0;\r\n\t}\r\n\r\n\t__class(AnimationNodeContent,'laya.ani.AnimationNodeContent');\r\n\treturn AnimationNodeContent;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.AnimationParser01\r\nvar AnimationParser01=(function(){\r\n\tfunction AnimationParser01(){}\r\n\t__class(AnimationParser01,'laya.ani.AnimationParser01');\r\n\tAnimationParser01.parse=function(templet,reader){\r\n\t\tvar data=reader.__getBuffer();\r\n\t\tvar i=0,j=0,k=0,n=0,l=0,m=0,o=0;\r\n\t\tvar aniClassName=reader.readUTFString();\r\n\t\ttemplet._aniClassName=aniClassName;\r\n\t\tvar strList=reader.readUTFString().split(\"\\n\");\r\n\t\tvar aniCount=reader.getUint8();\r\n\t\tvar publicDataPos=reader.getUint32();\r\n\t\tvar publicExtDataPos=reader.getUint32();\r\n\t\tvar publicData;\r\n\t\tif (publicDataPos > 0)\r\n\t\t\tpublicData=data.slice(publicDataPos,publicExtDataPos);\r\n\t\tvar publicRead=new Byte(publicData);\r\n\t\tif (publicExtDataPos > 0)\r\n\t\t\ttemplet._publicExtData=data.slice(publicExtDataPos,data.byteLength);\r\n\t\ttemplet._useParent=!!reader.getUint8();\r\n\t\ttemplet._anis.length=aniCount;\r\n\t\tfor (i=0;i < aniCount;i++){\r\n\t\t\tvar ani=templet._anis[i]=new AnimationContent();\r\n\t\t\t{};\r\n\t\t\tani.nodes=new Array;\r\n\t\t\tvar name=ani.name=strList[reader.getUint16()];\r\n\t\t\ttemplet._aniMap[name]=i;\r\n\t\t\tani.bone3DMap={};\r\n\t\t\tani.playTime=reader.getFloat32();\r\n\t\t\tvar boneCount=ani.nodes.length=reader.getUint8();\r\n\t\t\tani.totalKeyframeDatasLength=0;\r\n\t\t\tfor (j=0;j < boneCount;j++){\r\n\t\t\t\tvar node=ani.nodes[j]=new AnimationNodeContent();\r\n\t\t\t\t{};\r\n\t\t\t\tnode.childs=[];\r\n\t\t\t\tvar nameIndex=reader.getInt16();\r\n\t\t\t\tif (nameIndex >=0){\r\n\t\t\t\t\tnode.name=strList[nameIndex];\r\n\t\t\t\t\tani.bone3DMap[node.name]=j;\r\n\t\t\t\t}\r\n\t\t\t\tnode.keyFrame=new Array;\r\n\t\t\t\tnode.parentIndex=reader.getInt16();\r\n\t\t\t\tnode.parentIndex==-1 ? node.parent=null :node.parent=ani.nodes[node.parentIndex]\r\n\t\t\t\tnode.lerpType=reader.getUint8();\r\n\t\t\t\tvar keyframeParamsOffset=reader.getUint32();\r\n\t\t\t\tpublicRead.pos=keyframeParamsOffset;\r\n\t\t\t\tvar keyframeDataCount=node.keyframeWidth=publicRead.getUint16();\r\n\t\t\t\tani.totalKeyframeDatasLength+=keyframeDataCount;\r\n\t\t\t\tif (node.lerpType===0 || node.lerpType===1){\r\n\t\t\t\t\tnode.interpolationMethod=[];\r\n\t\t\t\t\tnode.interpolationMethod.length=keyframeDataCount;\r\n\t\t\t\t\tfor (k=0;k < keyframeDataCount;k++)\r\n\t\t\t\t\tnode.interpolationMethod[k]=AnimationTemplet.interpolation[publicRead.getUint8()];\r\n\t\t\t\t}\r\n\t\t\t\tif (node.parent !=null)\r\n\t\t\t\t\tnode.parent.childs.push(node);\r\n\t\t\t\tvar privateDataLen=reader.getUint16();\r\n\t\t\t\tif (privateDataLen > 0){\r\n\t\t\t\t\tnode.extenData=data.slice(reader.pos,reader.pos+privateDataLen);\r\n\t\t\t\t\treader.pos+=privateDataLen;\r\n\t\t\t\t};\r\n\t\t\t\tvar keyframeCount=reader.getUint16();\r\n\t\t\t\tnode.keyFrame.length=keyframeCount;\r\n\t\t\t\tvar startTime=0;\r\n\t\t\t\tvar keyFrame;\r\n\t\t\t\tfor (k=0,n=keyframeCount;k < n;k++){\r\n\t\t\t\t\tkeyFrame=node.keyFrame[k]=new KeyFramesContent();\r\n\t\t\t\t\t{};\r\n\t\t\t\t\tkeyFrame.duration=reader.getFloat32();\r\n\t\t\t\t\tkeyFrame.startTime=startTime;\r\n\t\t\t\t\tif (node.lerpType===2){\r\n\t\t\t\t\t\tkeyFrame.interpolationData=[];\r\n\t\t\t\t\t\tvar interDataLength=reader.getUint8();\r\n\t\t\t\t\t\tvar lerpType=0;\r\n\t\t\t\t\t\tlerpType=reader.getFloat32();\r\n\t\t\t\t\t\tswitch (lerpType){\r\n\t\t\t\t\t\t\tcase 254:\r\n\t\t\t\t\t\t\t\tkeyFrame.interpolationData.length=keyframeDataCount;\r\n\t\t\t\t\t\t\t\tfor (o=0;o < keyframeDataCount;o++)\r\n\t\t\t\t\t\t\t\tkeyFrame.interpolationData[o]=0;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase 255:\r\n\t\t\t\t\t\t\t\tkeyFrame.interpolationData.length=keyframeDataCount;\r\n\t\t\t\t\t\t\t\tfor (o=0;o < keyframeDataCount;o++)\r\n\t\t\t\t\t\t\t\tkeyFrame.interpolationData[o]=5;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tdefault :\r\n\t\t\t\t\t\t\t\tkeyFrame.interpolationData.push(lerpType);\r\n\t\t\t\t\t\t\t\tfor (m=1;m < interDataLength;m++){\r\n\t\t\t\t\t\t\t\t\tkeyFrame.interpolationData.push(reader.getFloat32());\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkeyFrame.data=new Float32Array(keyframeDataCount);\r\n\t\t\t\t\tfor (l=0;l < keyframeDataCount;l++){\r\n\t\t\t\t\t\tkeyFrame.data[l]=reader.getFloat32();\r\n\t\t\t\t\t\tif (keyFrame.data[l] >-0.00000001 && keyFrame.data[l] < 0.00000001)keyFrame.data[l]=0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstartTime+=keyFrame.duration;\r\n\t\t\t\t}\r\n\t\t\t\tkeyFrame.startTime=ani.playTime;\r\n\t\t\t\tnode.playTime=ani.playTime;\r\n\t\t\t\ttemplet._calculateKeyFrame(node,keyframeCount,keyframeDataCount);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn AnimationParser01;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.AnimationParser02\r\nvar AnimationParser02=(function(){\r\n\tfunction AnimationParser02(){}\r\n\t__class(AnimationParser02,'laya.ani.AnimationParser02');\r\n\tAnimationParser02.READ_DATA=function(){\r\n\t\tAnimationParser02._DATA.offset=AnimationParser02._reader.getUint32();\r\n\t\tAnimationParser02._DATA.size=AnimationParser02._reader.getUint32();\r\n\t}\r\n\r\n\tAnimationParser02.READ_BLOCK=function(){\r\n\t\tvar count=AnimationParser02._BLOCK.count=AnimationParser02._reader.getUint16();\r\n\t\tvar blockStarts=AnimationParser02._BLOCK.blockStarts=[];\r\n\t\tvar blockLengths=AnimationParser02._BLOCK.blockLengths=[];\r\n\t\tfor (var i=0;i < count;i++){\r\n\t\t\tblockStarts.push(AnimationParser02._reader.getUint32());\r\n\t\t\tblockLengths.push(AnimationParser02._reader.getUint32());\r\n\t\t}\r\n\t}\r\n\r\n\tAnimationParser02.READ_STRINGS=function(){\r\n\t\tvar offset=AnimationParser02._reader.getUint32();\r\n\t\tvar count=AnimationParser02._reader.getUint16();\r\n\t\tvar prePos=AnimationParser02._reader.pos;\r\n\t\tAnimationParser02._reader.pos=offset+AnimationParser02._DATA.offset;\r\n\t\tfor (var i=0;i < count;i++)\r\n\t\tAnimationParser02._strings[i]=AnimationParser02._reader.readUTFString();\r\n\t\tAnimationParser02._reader.pos=prePos;\r\n\t}\r\n\r\n\tAnimationParser02.parse=function(templet,reader){\r\n\t\tAnimationParser02._templet=templet;\r\n\t\tAnimationParser02._reader=reader;\r\n\t\tvar arrayBuffer=reader.__getBuffer();\r\n\t\tAnimationParser02.READ_DATA();\r\n\t\tAnimationParser02.READ_BLOCK();\r\n\t\tAnimationParser02.READ_STRINGS();\r\n\t\tfor (var i=0,n=AnimationParser02._BLOCK.count;i < n;i++){\r\n\t\t\tvar index=reader.getUint16();\r\n\t\t\tvar blockName=AnimationParser02._strings[index];\r\n\t\t\tvar fn=AnimationParser02[\"READ_\"+blockName];\r\n\t\t\tif (fn==null)\r\n\t\t\t\tthrow new Error(\"model file err,no this function:\"+index+\" \"+blockName);\r\n\t\t\telse\r\n\t\t\tfn.call();\r\n\t\t}\r\n\t}\r\n\r\n\tAnimationParser02.READ_ANIMATIONS=function(){\r\n\t\tvar reader=AnimationParser02._reader;\r\n\t\tvar arrayBuffer=reader.__getBuffer();\r\n\t\tvar i=0,j=0,k=0,n=0,l=0;\r\n\t\tvar keyframeWidth=reader.getUint16();\r\n\t\tvar interpolationMethod=[];\r\n\t\tinterpolationMethod.length=keyframeWidth;\r\n\t\tfor (i=0;i < keyframeWidth;i++)\r\n\t\tinterpolationMethod[i]=AnimationTemplet.interpolation[reader.getByte()];\r\n\t\tvar aniCount=reader.getUint8();\r\n\t\tAnimationParser02._templet._anis.length=aniCount;\r\n\t\tfor (i=0;i < aniCount;i++){\r\n\t\t\tvar ani=AnimationParser02._templet._anis[i]=\r\n\t\t\t{};\r\n\t\t\tani.nodes=new Array;\r\n\t\t\tvar aniName=ani.name=AnimationParser02._strings[reader.getUint16()];\r\n\t\t\tAnimationParser02._templet._aniMap[aniName]=i;\r\n\t\t\tani.bone3DMap={};\r\n\t\t\tani.playTime=reader.getFloat32();\r\n\t\t\tvar boneCount=ani.nodes.length=reader.getInt16();\r\n\t\t\tani.totalKeyframeDatasLength=0;\r\n\t\t\tfor (j=0;j < boneCount;j++){\r\n\t\t\t\tvar node=ani.nodes[j]=\r\n\t\t\t\t{};\r\n\t\t\t\tnode.keyframeWidth=keyframeWidth;\r\n\t\t\t\tnode.childs=[];\r\n\t\t\t\tvar nameIndex=reader.getUint16();\r\n\t\t\t\tif (nameIndex >=0){\r\n\t\t\t\t\tnode.name=AnimationParser02._strings[nameIndex];\r\n\t\t\t\t\tani.bone3DMap[node.name]=j;\r\n\t\t\t\t}\r\n\t\t\t\tnode.keyFrame=new Array;\r\n\t\t\t\tnode.parentIndex=reader.getInt16();\r\n\t\t\t\tnode.parentIndex==-1 ? node.parent=null :node.parent=ani.nodes[node.parentIndex]\r\n\t\t\t\tani.totalKeyframeDatasLength+=keyframeWidth;\r\n\t\t\t\tnode.interpolationMethod=interpolationMethod;\r\n\t\t\t\tif (node.parent !=null)\r\n\t\t\t\t\tnode.parent.childs.push(node);\r\n\t\t\t\tvar keyframeCount=reader.getUint16();\r\n\t\t\t\tnode.keyFrame.length=keyframeCount;\r\n\t\t\t\tvar keyFrame=null,lastKeyFrame=null;\r\n\t\t\t\tfor (k=0,n=keyframeCount;k < n;k++){\r\n\t\t\t\t\tkeyFrame=node.keyFrame[k]=\r\n\t\t\t\t\t{};\r\n\t\t\t\t\tkeyFrame.startTime=reader.getFloat32();\r\n\t\t\t\t\t(lastKeyFrame)&& (lastKeyFrame.duration=keyFrame.startTime-lastKeyFrame.startTime);\r\n\t\t\t\t\tvar offset=AnimationParser02._DATA.offset;\r\n\t\t\t\t\tvar keyframeDataOffset=reader.getUint32();\r\n\t\t\t\t\tvar keyframeDataLength=keyframeWidth *4;\r\n\t\t\t\t\tvar keyframeArrayBuffer=arrayBuffer.slice(offset+keyframeDataOffset,offset+keyframeDataOffset+keyframeDataLength);\r\n\t\t\t\t\tkeyFrame.data=new Float32Array(keyframeArrayBuffer);\r\n\t\t\t\t\tlastKeyFrame=keyFrame;\r\n\t\t\t\t}\r\n\t\t\t\tkeyFrame.duration=0;\r\n\t\t\t\tnode.playTime=ani.playTime;\r\n\t\t\t\tAnimationParser02._templet._calculateKeyFrame(node,keyframeCount,keyframeWidth);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tAnimationParser02._templet=null;\r\n\tAnimationParser02._reader=null;\r\n\tAnimationParser02._strings=[];\r\n\t__static(AnimationParser02,\r\n\t['_BLOCK',function(){return this._BLOCK={count:0};},'_DATA',function(){return this._DATA={offset:0,size:0};}\r\n\t]);\r\n\treturn AnimationParser02;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.AnimationState\r\nvar AnimationState=(function(){\r\n\tfunction AnimationState(){}\r\n\t__class(AnimationState,'laya.ani.AnimationState');\r\n\tAnimationState.stopped=0;\r\n\tAnimationState.paused=1;\r\n\tAnimationState.playing=2;\r\n\treturn AnimationState;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.Bone\r\nvar Bone=(function(){\r\n\tfunction Bone(){\r\n\t\tthis.name=null;\r\n\t\tthis.root=null;\r\n\t\tthis.parentBone=null;\r\n\t\tthis.length=10;\r\n\t\tthis.transform=null;\r\n\t\tthis.inheritScale=true;\r\n\t\tthis.inheritRotation=true;\r\n\t\tthis.rotation=NaN;\r\n\t\tthis.resultRotation=NaN;\r\n\t\tthis.d=-1;\r\n\t\tthis._tempMatrix=null;\r\n\t\tthis._sprite=null;\r\n\t\tthis.resultTransform=new Transform();\r\n\t\tthis.resultMatrix=new Matrix();\r\n\t\tthis._children=[];\r\n\t}\r\n\r\n\t__class(Bone,'laya.ani.bone.Bone');\r\n\tvar __proto=Bone.prototype;\r\n\t__proto.setTempMatrix=function(matrix){\r\n\t\tthis._tempMatrix=matrix;\r\n\t\tvar i=0,n=0;\r\n\t\tvar tBone;\r\n\t\tfor (i=0,n=this._children.length;i < n;i++){\r\n\t\t\ttBone=this._children[i];\r\n\t\t\ttBone.setTempMatrix(this._tempMatrix);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.update=function(pMatrix){\r\n\t\tthis.rotation=this.transform.skX;\r\n\t\tvar tResultMatrix;\r\n\t\tif (pMatrix){\r\n\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\tMatrix.mul(tResultMatrix,pMatrix,this.resultMatrix);\r\n\t\t\tthis.resultRotation=this.rotation;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.resultRotation=this.rotation+this.parentBone.resultRotation;\r\n\t\t\tif (this.parentBone){\r\n\t\t\t\tif (this.inheritRotation && this.inheritScale){\r\n\t\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\t\tMatrix.mul(tResultMatrix,this.parentBone.resultMatrix,this.resultMatrix);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvar temp=0;\r\n\t\t\t\t\tvar parent=this.parentBone;\r\n\t\t\t\t\tvar tAngle=NaN;\r\n\t\t\t\t\tvar cos=NaN;\r\n\t\t\t\t\tvar sin=NaN;\r\n\t\t\t\t\tvar tParentMatrix=this.parentBone.resultMatrix;\r\n\t\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\t\tvar worldX=tParentMatrix.a *tResultMatrix.tx+tParentMatrix.c *tResultMatrix.ty+tParentMatrix.tx;\r\n\t\t\t\t\tvar worldY=tParentMatrix.b *tResultMatrix.tx+tParentMatrix.d *tResultMatrix.ty+tParentMatrix.ty;\r\n\t\t\t\t\tvar tTestMatrix=new Matrix();\r\n\t\t\t\t\tif (this.inheritRotation){\r\n\t\t\t\t\t\ttAngle=Math.atan2(parent.resultMatrix.b,parent.resultMatrix.a);\r\n\t\t\t\t\t\tcos=Math.cos(tAngle),sin=Math.sin(tAngle);\r\n\t\t\t\t\t\ttTestMatrix.setTo(cos,sin,-sin,cos,0,0);\r\n\t\t\t\t\t\tMatrix.mul(this._tempMatrix,tTestMatrix,Matrix.TEMP);\r\n\t\t\t\t\t\tMatrix.TEMP.copyTo(tTestMatrix);\r\n\t\t\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\t\t\tMatrix.mul(tResultMatrix,tTestMatrix,this.resultMatrix);\r\n\t\t\t\t\t\tif (this.resultTransform.scX *this.resultTransform.scY < 0){\r\n\t\t\t\t\t\t\tthis.resultMatrix.rotate(Math.PI*0.5);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.resultMatrix.tx=worldX;\r\n\t\t\t\t\t\tthis.resultMatrix.ty=worldY;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (this.inheritScale){\r\n\t\t\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\t\t\tMatrix.TEMP.identity();\r\n\t\t\t\t\t\tMatrix.TEMP.d=this.d;\r\n\t\t\t\t\t\tMatrix.mul(tResultMatrix,Matrix.TEMP,this.resultMatrix);\r\n\t\t\t\t\t\tthis.resultMatrix.tx=worldX;\r\n\t\t\t\t\t\tthis.resultMatrix.ty=worldY;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\t\t\tMatrix.TEMP.identity();\r\n\t\t\t\t\t\tMatrix.TEMP.d=this.d;\r\n\t\t\t\t\t\tMatrix.mul(tResultMatrix,Matrix.TEMP,this.resultMatrix);\r\n\t\t\t\t\t\tthis.resultMatrix.tx=worldX;\r\n\t\t\t\t\t\tthis.resultMatrix.ty=worldY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttResultMatrix=this.resultTransform.getMatrix();\r\n\t\t\t\ttResultMatrix.copyTo(this.resultMatrix);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar i=0,n=0;\r\n\t\tvar tBone;\r\n\t\tfor (i=0,n=this._children.length;i < n;i++){\r\n\t\t\ttBone=this._children[i];\r\n\t\t\ttBone.update();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.updateChild=function(){\r\n\t\tvar i=0,n=0;\r\n\t\tvar tBone;\r\n\t\tfor (i=0,n=this._children.length;i < n;i++){\r\n\t\t\ttBone=this._children[i];\r\n\t\t\ttBone.update();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setRotation=function(rd){\r\n\t\tif (this._sprite){\r\n\t\t\tthis._sprite.rotation=rd *180 / Math.PI;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.updateDraw=function(x,y){\r\n\t\tif (!Bone.ShowBones || Bone.ShowBones[this.name]){\r\n\t\t\tif (this._sprite){\r\n\t\t\t\tthis._sprite.x=x+this.resultMatrix.tx;\r\n\t\t\t\tthis._sprite.y=y+this.resultMatrix.ty;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._sprite=new Sprite();\r\n\t\t\t\tthis._sprite.graphics.drawCircle(0,0,5,\"#ff0000\");\r\n\t\t\t\tthis._sprite.graphics.drawLine(0,0,this.length,0,\"#00ff00\");\r\n\t\t\t\tthis._sprite.graphics.fillText(this.name,0,0,\"20px Arial\",\"#00ff00\",\"center\");\r\n\t\t\t\tLaya.stage.addChild(this._sprite);\r\n\t\t\t\tthis._sprite.x=x+this.resultMatrix.tx;\r\n\t\t\t\tthis._sprite.y=y+this.resultMatrix.ty;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar i=0,n=0;\r\n\t\tvar tBone;\r\n\t\tfor (i=0,n=this._children.length;i < n;i++){\r\n\t\t\ttBone=this._children[i];\r\n\t\t\ttBone.updateDraw(x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.addChild=function(bone){\r\n\t\tthis._children.push(bone);\r\n\t\tbone.parentBone=this;\r\n\t}\r\n\r\n\t__proto.findBone=function(boneName){\r\n\t\tif (this.name==boneName){\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvar i=0,n=0;\r\n\t\t\tvar tBone;\r\n\t\t\tvar tResult;\r\n\t\t\tfor (i=0,n=this._children.length;i < n;i++){\r\n\t\t\t\ttBone=this._children[i];\r\n\t\t\t\ttResult=tBone.findBone(boneName);\r\n\t\t\t\tif (tResult){\r\n\t\t\t\t\treturn tResult;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.localToWorld=function(local){\r\n\t\tvar localX=local[0];\r\n\t\tvar localY=local[1];\r\n\t\tlocal[0]=localX *this.resultMatrix.a+localY *this.resultMatrix.c+this.resultMatrix.tx;\r\n\t\tlocal[1]=localX *this.resultMatrix.b+localY *this.resultMatrix.d+this.resultMatrix.ty;\r\n\t}\r\n\r\n\tBone.ShowBones={};\r\n\treturn Bone;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.BoneSlot\r\nvar BoneSlot=(function(){\r\n\tfunction BoneSlot(){\r\n\t\t/**插槽名称 */\r\n\t\tthis.name=null;\r\n\t\t/**插槽绑定的骨骼名称 */\r\n\t\tthis.parent=null;\r\n\t\t/**插糟显示数据数据的名称 */\r\n\t\tthis.attachmentName=null;\r\n\t\t/**原始数据的索引 */\r\n\t\tthis.srcDisplayIndex=-1;\r\n\t\t/**判断对象是否是原对象 */\r\n\t\tthis.type=\"src\";\r\n\t\t/**模板的指针 */\r\n\t\tthis.templet=null;\r\n\t\t/**当前插槽对应的数据 */\r\n\t\tthis.currSlotData=null;\r\n\t\t/**当前插槽显示的纹理 */\r\n\t\tthis.currTexture=null;\r\n\t\t/**显示对象对应的数据 */\r\n\t\tthis.currDisplayData=null;\r\n\t\t/**显示皮肤的索引 */\r\n\t\tthis.displayIndex=-1;\r\n\t\t/**用户自定义的皮肤 */\r\n\t\tthis._diyTexture=null;\r\n\t\tthis._parentMatrix=null;\r\n\t\tthis._resultMatrix=null;\r\n\t\t/**索引替换表 */\r\n\t\tthis._replaceDic={};\r\n\t\t/**当前diyTexture的动画纹理 */\r\n\t\tthis._curDiyUV=null;\r\n\t\tthis._curDiyVS=null;\r\n\t\t/**实时模式下，复用使用 */\r\n\t\tthis._skinSprite=null;\r\n\t\t/**@private 变形动画数据 */\r\n\t\tthis.deformData=null;\r\n\t\tthis._mVerticleArr=null;\r\n\t}\r\n\r\n\t__class(BoneSlot,'laya.ani.bone.BoneSlot');\r\n\tvar __proto=BoneSlot.prototype;\r\n\t/**\r\n\t*设置要显示的插槽数据\r\n\t*@param slotData\r\n\t*@param disIndex\r\n\t*@param freshIndex 是否重置纹理\r\n\t*/\r\n\t__proto.showSlotData=function(slotData,freshIndex){\r\n\t\t(freshIndex===void 0)&& (freshIndex=true);\r\n\t\tthis.currSlotData=slotData;\r\n\t\tif(freshIndex)\r\n\t\t\tthis.displayIndex=this.srcDisplayIndex;\r\n\t\tthis.currDisplayData=null;\r\n\t\tthis.currTexture=null;\r\n\t}\r\n\r\n\t/**\r\n\t*通过名字显示指定对象\r\n\t*@param name\r\n\t*/\r\n\t__proto.showDisplayByName=function(name){\r\n\t\tif (this.currSlotData){\r\n\t\t\tthis.showDisplayByIndex(this.currSlotData.getDisplayByName(name));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*替换贴图名\r\n\t*@param tarName 要替换的贴图名\r\n\t*@param newName 替换后的贴图名\r\n\t*/\r\n\t__proto.replaceDisplayByName=function(tarName,newName){\r\n\t\tif (!this.currSlotData)return;\r\n\t\tvar preIndex=0;\r\n\t\tpreIndex=this.currSlotData.getDisplayByName(tarName);\r\n\t\tvar newIndex=0;\r\n\t\tnewIndex=this.currSlotData.getDisplayByName(newName);\r\n\t\tthis.replaceDisplayByIndex(preIndex,newIndex);\r\n\t}\r\n\r\n\t/**\r\n\t*替换贴图索引\r\n\t*@param tarIndex 要替换的索引\r\n\t*@param newIndex 替换后的索引\r\n\t*/\r\n\t__proto.replaceDisplayByIndex=function(tarIndex,newIndex){\r\n\t\tif (!this.currSlotData)return;\r\n\t\tthis._replaceDic[tarIndex]=newIndex;\r\n\t\tif (this.displayIndex==tarIndex){\r\n\t\t\tthis.showDisplayByIndex(tarIndex);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*指定显示对象\r\n\t*@param index\r\n\t*/\r\n\t__proto.showDisplayByIndex=function(index){\r\n\t\tif (this._replaceDic[index]!=null)index=this._replaceDic[index];\r\n\t\tif (this.currSlotData && index >-1 && index < this.currSlotData.displayArr.length){\r\n\t\t\tthis.displayIndex=index;\r\n\t\t\tthis.currDisplayData=this.currSlotData.displayArr[index];\r\n\t\t\tif (this.currDisplayData){\r\n\t\t\t\tvar tName=this.currDisplayData.name;\r\n\t\t\t\tthis.currTexture=this.templet.getTexture(tName);\r\n\t\t\t\tif (this.currTexture && !Render.isConchApp && this.currDisplayData.type==0 && this.currDisplayData.uvs){\r\n\t\t\t\t\tthis.currTexture=this.currDisplayData.createTexture(this.currTexture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis.displayIndex=-1;\r\n\t\t\tthis.currDisplayData=null;\r\n\t\t\tthis.currTexture=null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*替换皮肤\r\n\t*@param _texture\r\n\t*/\r\n\t__proto.replaceSkin=function(_texture){\r\n\t\tthis._diyTexture=_texture;\r\n\t\tif (this._curDiyUV)this._curDiyUV.length=0;\r\n\t\tif (this.currDisplayData&&this._diyTexture==this.currDisplayData.texture){\r\n\t\t\tthis._diyTexture=null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*保存父矩阵的索引\r\n\t*@param parentMatrix\r\n\t*/\r\n\t__proto.setParentMatrix=function(parentMatrix){\r\n\t\tthis._parentMatrix=parentMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t*把纹理画到Graphics上\r\n\t*@param graphics\r\n\t*@param noUseSave\r\n\t*/\r\n\t__proto.draw=function(graphics,boneMatrixArray,noUseSave,alpha){\r\n\t\t(noUseSave===void 0)&& (noUseSave=false);\r\n\t\t(alpha===void 0)&& (alpha=1);\r\n\t\tif ((this._diyTexture==null && this.currTexture==null)|| this.currDisplayData==null){\r\n\t\t\tif (!(this.currDisplayData && this.currDisplayData.type==3)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tTexture=this.currTexture;\r\n\t\tif (this._diyTexture)tTexture=this._diyTexture;\r\n\t\tvar tSkinSprite;\r\n\t\tswitch (this.currDisplayData.type){\r\n\t\t\tcase 0:\r\n\t\t\t\tif (graphics){\r\n\t\t\t\t\tvar tCurrentMatrix=this.getDisplayMatrix();\r\n\t\t\t\t\tif (this._parentMatrix){\r\n\t\t\t\t\t\tvar tRotateKey=false;\r\n\t\t\t\t\t\tif (tCurrentMatrix){\r\n\t\t\t\t\t\t\tMatrix.mul(tCurrentMatrix,this._parentMatrix,Matrix.TEMP);\r\n\t\t\t\t\t\t\tvar tResultMatrix;\r\n\t\t\t\t\t\t\tif (noUseSave){\r\n\t\t\t\t\t\t\t\tif (this._resultMatrix==null)this._resultMatrix=new Matrix();\r\n\t\t\t\t\t\t\t\ttResultMatrix=this._resultMatrix;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\ttResultMatrix=new Matrix();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif ((!Render.isWebGL && this.currDisplayData.uvs)|| (Render.isWebGL && this._diyTexture && this.currDisplayData.uvs)){\r\n\t\t\t\t\t\t\t\tvar tTestMatrix=BoneSlot._tempMatrix;\r\n\t\t\t\t\t\t\t\ttTestMatrix.identity();\r\n\t\t\t\t\t\t\t\tif (this.currDisplayData.uvs[1] > this.currDisplayData.uvs[5]){\r\n\t\t\t\t\t\t\t\t\ttTestMatrix.d=-1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (this.currDisplayData.uvs[0] > this.currDisplayData.uvs[4]\r\n\t\t\t\t\t\t\t\t\t&& this.currDisplayData.uvs[1] > this.currDisplayData.uvs[5]){\r\n\t\t\t\t\t\t\t\t\ttRotateKey=true;\r\n\t\t\t\t\t\t\t\t\ttTestMatrix.rotate(-Math.PI/2);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tMatrix.mul(tTestMatrix,Matrix.TEMP,tResultMatrix);\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tMatrix.TEMP.copyTo(tResultMatrix);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (tRotateKey){\r\n\t\t\t\t\t\t\t\tgraphics.drawTexture(tTexture,-this.currDisplayData.height / 2,-this.currDisplayData.width / 2,this.currDisplayData.height,this.currDisplayData.width,tResultMatrix);\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tgraphics.drawTexture(tTexture,-this.currDisplayData.width / 2,-this.currDisplayData.height / 2,this.currDisplayData.width,this.currDisplayData.height,tResultMatrix);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (noUseSave){\r\n\t\t\t\t\tif (this._skinSprite==null){\r\n\t\t\t\t\t\tthis._skinSprite=BoneSlot.createSkinMesh();\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttSkinSprite=this._skinSprite;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttSkinSprite=BoneSlot.createSkinMesh();\r\n\t\t\t\t}\r\n\t\t\t\tif (tSkinSprite==null){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t};\r\n\t\t\t\tvar tIBArray;\r\n\t\t\t\tvar tRed=1;\r\n\t\t\t\tvar tGreed=1;\r\n\t\t\t\tvar tBlue=1;\r\n\t\t\t\tvar tAlpha=1;\r\n\t\t\t\tif (this.currDisplayData.bones==null){\r\n\t\t\t\t\tvar tVertices=this.currDisplayData.weights;\r\n\t\t\t\t\tif (this.deformData){\r\n\t\t\t\t\t\ttVertices=this.deformData;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar tUVs;\r\n\t\t\t\t\tif (this._diyTexture){\r\n\t\t\t\t\t\tif (!this._curDiyUV){\r\n\t\t\t\t\t\t\tthis._curDiyUV=[];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this._curDiyUV.length==0){\r\n\t\t\t\t\t\t\tthis._curDiyUV=UVTools.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);\r\n\t\t\t\t\t\t\tthis._curDiyUV=UVTools.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttUVs=this._curDiyUV;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttUVs=this.currDisplayData.uvs;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._mVerticleArr=tVertices;\r\n\t\t\t\t\tvar tTriangleNum=this.currDisplayData.triangles.length / 3;\r\n\t\t\t\t\ttIBArray=this.currDisplayData.triangles;\r\n\t\t\t\t\ttSkinSprite.init2(tTexture,null ,tIBArray,this._mVerticleArr,tUVs);\r\n\t\t\t\t\tvar tCurrentMatrix2=this.getDisplayMatrix();\r\n\t\t\t\t\tif (this._parentMatrix){\r\n\t\t\t\t\t\tif (tCurrentMatrix2){\r\n\t\t\t\t\t\t\tMatrix.mul(tCurrentMatrix2,this._parentMatrix,Matrix.TEMP);\r\n\t\t\t\t\t\t\tvar tResultMatrix2;\r\n\t\t\t\t\t\t\tif (noUseSave){\r\n\t\t\t\t\t\t\t\tif (this._resultMatrix==null)this._resultMatrix=new Matrix();\r\n\t\t\t\t\t\t\t\ttResultMatrix2=this._resultMatrix;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\ttResultMatrix2=new Matrix();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tMatrix.TEMP.copyTo(tResultMatrix2);\r\n\t\t\t\t\t\t\ttSkinSprite.transform=tResultMatrix2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis.skinMesh(boneMatrixArray,tSkinSprite,alpha);\r\n\t\t\t\t}\r\n\t\t\t\tgraphics.drawSkin(tSkinSprite);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (noUseSave){\r\n\t\t\t\t\tif (this._skinSprite==null){\r\n\t\t\t\t\t\tthis._skinSprite=BoneSlot.createSkinMesh();\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttSkinSprite=this._skinSprite;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttSkinSprite=BoneSlot.createSkinMesh();\r\n\t\t\t\t}\r\n\t\t\t\tif (tSkinSprite==null){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.skinMesh(boneMatrixArray,tSkinSprite,alpha);\r\n\t\t\t\tgraphics.drawSkin(tSkinSprite);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 3:\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*显示蒙皮动画\r\n\t*@param boneMatrixArray 当前帧的骨骼矩阵\r\n\t*/\r\n\t__proto.skinMesh=function(boneMatrixArray,skinSprite,alpha){\r\n\t\tvar tTexture=this.currTexture;\r\n\t\tvar tBones=this.currDisplayData.bones;\r\n\t\tvar tUvs;\r\n\t\tif (this._diyTexture){\r\n\t\t\ttTexture=this._diyTexture;\r\n\t\t\tif (!this._curDiyUV){\r\n\t\t\t\tthis._curDiyUV=[];\r\n\t\t\t}\r\n\t\t\tif (this._curDiyUV.length==0){\r\n\t\t\t\tthis._curDiyUV=UVTools.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);\r\n\t\t\t\tthis._curDiyUV=UVTools.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV);\r\n\t\t\t}\r\n\t\t\ttUvs=this._curDiyUV;\r\n\t\t\t}else{\r\n\t\t\ttUvs=this.currDisplayData.uvs;\r\n\t\t};\r\n\t\tvar tWeights=this.currDisplayData.weights;\r\n\t\tvar tTriangles=this.currDisplayData.triangles;\r\n\t\tvar tIBArray;\r\n\t\tvar tRx=0;\r\n\t\tvar tRy=0;\r\n\t\tvar nn=0;\r\n\t\tvar tMatrix;\r\n\t\tvar tX=NaN;\r\n\t\tvar tY=NaN;\r\n\t\tvar tB=0;\r\n\t\tvar tWeight=0;\r\n\t\tvar tVertices=[];\r\n\t\tvar i=0,j=0,n=0;\r\n\t\tvar tRed=1;\r\n\t\tvar tGreed=1;\r\n\t\tvar tBlue=1;\r\n\t\tvar tAlpha=alpha;\r\n\t\tif (this.deformData && this.deformData.length > 0){\r\n\t\t\tvar f=0;\r\n\t\t\tfor (i=0,n=tBones.length;i < n;){\r\n\t\t\t\tnn=tBones[i++]+i;\r\n\t\t\t\ttRx=0,tRy=0;\r\n\t\t\t\tfor (;i < nn;i++){\r\n\t\t\t\t\ttMatrix=boneMatrixArray[tBones[i]]\r\n\t\t\t\t\ttX=tWeights[tB]+this.deformData[f++];\r\n\t\t\t\t\ttY=tWeights[tB+1]+this.deformData[f++];\r\n\t\t\t\t\ttWeight=tWeights[tB+2];\r\n\t\t\t\t\ttRx+=(tX *tMatrix.a+tY *tMatrix.c+tMatrix.tx)*tWeight;\r\n\t\t\t\t\ttRy+=(tX *tMatrix.b+tY *tMatrix.d+tMatrix.ty)*tWeight;\r\n\t\t\t\t\ttB+=3;\r\n\t\t\t\t}\r\n\t\t\t\ttVertices.push(tRx,tRy);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (i=0,n=tBones.length;i < n;){\r\n\t\t\t\tnn=tBones[i++]+i;\r\n\t\t\t\ttRx=0,tRy=0;\r\n\t\t\t\tfor (;i < nn;i++){\r\n\t\t\t\t\ttMatrix=boneMatrixArray[tBones[i]]\r\n\t\t\t\t\ttX=tWeights[tB];\r\n\t\t\t\t\ttY=tWeights[tB+1];\r\n\t\t\t\t\ttWeight=tWeights[tB+2];\r\n\t\t\t\t\ttRx+=(tX *tMatrix.a+tY *tMatrix.c+tMatrix.tx)*tWeight;\r\n\t\t\t\t\ttRy+=(tX *tMatrix.b+tY *tMatrix.d+tMatrix.ty)*tWeight;\r\n\t\t\t\t\ttB+=3;\r\n\t\t\t\t}\r\n\t\t\t\ttVertices.push(tRx,tRy);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._mVerticleArr=tVertices;\r\n\t\ttIBArray=tTriangles;\r\n\t\tskinSprite.init2(tTexture,null,tIBArray,this._mVerticleArr,tUvs);\r\n\t}\r\n\r\n\t/**\r\n\t*画骨骼的起始点，方便调试\r\n\t*@param graphics\r\n\t*/\r\n\t__proto.drawBonePoint=function(graphics){\r\n\t\tif (graphics && this._parentMatrix){\r\n\t\t\tgraphics.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,\"#ff0000\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*得到显示对象的矩阵\r\n\t*@return\r\n\t*/\r\n\t__proto.getDisplayMatrix=function(){\r\n\t\tif (this.currDisplayData){\r\n\t\t\treturn this.currDisplayData.transform.getMatrix();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*得到插糟的矩阵\r\n\t*@return\r\n\t*/\r\n\t__proto.getMatrix=function(){\r\n\t\treturn this._resultMatrix;\r\n\t}\r\n\r\n\t/**\r\n\t*用原始数据拷贝出一个\r\n\t*@return\r\n\t*/\r\n\t__proto.copy=function(){\r\n\t\tvar tBoneSlot=new BoneSlot();\r\n\t\ttBoneSlot.type=\"copy\";\r\n\t\ttBoneSlot.name=this.name;\r\n\t\ttBoneSlot.attachmentName=this.attachmentName;\r\n\t\ttBoneSlot.srcDisplayIndex=this.srcDisplayIndex;\r\n\t\ttBoneSlot.parent=this.parent;\r\n\t\ttBoneSlot.displayIndex=this.displayIndex;\r\n\t\ttBoneSlot.templet=this.templet;\r\n\t\ttBoneSlot.currSlotData=this.currSlotData;\r\n\t\ttBoneSlot.currTexture=this.currTexture;\r\n\t\ttBoneSlot.currDisplayData=this.currDisplayData;\r\n\t\treturn tBoneSlot;\r\n\t}\r\n\r\n\tBoneSlot.createSkinMesh=function(){\r\n\t\tif (Render.isWebGL || Render.isConchApp){\r\n\t\t\treturn RunDriver.skinAniSprite();\r\n\t\t\t}else{\r\n\t\t\tif (!Render.isWebGL){\r\n\t\t\t\tif (Skeleton.useSimpleMeshInCanvas){\r\n\t\t\t\t\treturn new SimpleSkinMeshCanvas();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\treturn new SkinMeshCanvas();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__static(BoneSlot,\r\n\t['_tempMatrix',function(){return this._tempMatrix=new Matrix();}\r\n\t]);\r\n\treturn BoneSlot;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*canvas mesh渲染器\r\n*/\r\n//class laya.ani.bone.canvasmesh.CanvasMeshRender\r\nvar CanvasMeshRender=(function(){\r\n\tfunction CanvasMeshRender(){\r\n\t\t/**\r\n\t\t*mesh数据\r\n\t\t*/\r\n\t\tthis.mesh=null;\r\n\t\t/**\r\n\t\t*矩阵\r\n\t\t*/\r\n\t\tthis.transform=null;\r\n\t\t/**\r\n\t\t*绘图环境\r\n\t\t*/\r\n\t\tthis.context=null;\r\n\t\t/**\r\n\t\t*绘制mesh的模式 0:顶点索引模式 1：无顶点索引模式\r\n\t\t*/\r\n\t\tthis.mode=0;\r\n\t}\r\n\r\n\t__class(CanvasMeshRender,'laya.ani.bone.canvasmesh.CanvasMeshRender');\r\n\tvar __proto=CanvasMeshRender.prototype;\r\n\t/**\r\n\t*将mesh数据渲染到context上面\r\n\t*@param context\r\n\t*\r\n\t*/\r\n\t__proto.renderToContext=function(context){\r\n\t\tthis.context=context.ctx||context;\r\n\t\tif (this.mesh){\r\n\t\t\tif (this.mode==0){\r\n\t\t\t\tthis._renderWithIndexes(this.mesh);\r\n\t\t\t\t}else{\r\n\t\t\t\tthis._renderNoIndexes(this.mesh);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*无顶点索引的模式\r\n\t*@param mesh\r\n\t*\r\n\t*/\r\n\t__proto._renderNoIndexes=function(mesh){\r\n\t\tvar i=0,len=mesh.vertices.length / 2;\r\n\t\tvar index=0;\r\n\t\tfor (i=0;i < len-2;i++){\r\n\t\t\tindex=i *2;\r\n\t\t\tthis._renderDrawTriangle(mesh,index,(index+2),(index+4));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*使用顶点索引模式绘制\r\n\t*@param mesh\r\n\t*\r\n\t*/\r\n\t__proto._renderWithIndexes=function(mesh){\r\n\t\tvar indexes=mesh.indexes;\r\n\t\tvar i=0,len=indexes.length;\r\n\t\tfor (i=0;i < len;i+=3){\r\n\t\t\tvar index0=indexes[i] *2;\r\n\t\t\tvar index1=indexes[i+1] *2;\r\n\t\t\tvar index2=indexes[i+2] *2;\r\n\t\t\tthis._renderDrawTriangle(mesh,index0,index1,index2);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*绘制三角形\r\n\t*@param mesh mesh\r\n\t*@param index0 顶点0\r\n\t*@param index1 顶点1\r\n\t*@param index2 顶点2\r\n\t*\r\n\t*/\r\n\t__proto._renderDrawTriangle=function(mesh,index0,index1,index2){\r\n\t\tvar context=this.context;\r\n\t\tvar uvs=mesh.uvs;\r\n\t\tvar vertices=mesh.vertices;\r\n\t\tvar texture=mesh.texture;\r\n\t\tvar source=texture.bitmap;\r\n\t\tvar textureSource=source.source;\r\n\t\tvar textureWidth=texture.width;\r\n\t\tvar textureHeight=texture.height;\r\n\t\tvar sourceWidth=source.width;\r\n\t\tvar sourceHeight=source.height;\r\n\t\tvar u0=NaN;\r\n\t\tvar u1=NaN;\r\n\t\tvar u2=NaN;\r\n\t\tvar v0=NaN;\r\n\t\tvar v1=NaN;\r\n\t\tvar v2=NaN;\r\n\t\tif (mesh.useUvTransform){\r\n\t\t\tvar ut=mesh.uvTransform;\r\n\t\t\tu0=((uvs[index0] *ut.a)+(uvs[index0+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tu1=((uvs[index1] *ut.a)+(uvs[index1+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tu2=((uvs[index2] *ut.a)+(uvs[index2+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tv0=((uvs[index0] *ut.b)+(uvs[index0+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t\tv1=((uvs[index1] *ut.b)+(uvs[index1+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t\tv2=((uvs[index2] *ut.b)+(uvs[index2+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tu0=uvs[index0] *sourceWidth;\r\n\t\t\tu1=uvs[index1] *sourceWidth;\r\n\t\t\tu2=uvs[index2] *sourceWidth;\r\n\t\t\tv0=uvs[index0+1] *sourceHeight;\r\n\t\t\tv1=uvs[index1+1] *sourceHeight;\r\n\t\t\tv2=uvs[index2+1] *sourceHeight;\r\n\t\t};\r\n\t\tvar x0=vertices[index0];\r\n\t\tvar x1=vertices[index1];\r\n\t\tvar x2=vertices[index2];\r\n\t\tvar y0=vertices[index0+1];\r\n\t\tvar y1=vertices[index1+1];\r\n\t\tvar y2=vertices[index2+1];\r\n\t\tif (mesh.canvasPadding > 0){\r\n\t\t\tvar paddingX=mesh.canvasPadding;\r\n\t\t\tvar paddingY=mesh.canvasPadding;\r\n\t\t\tvar centerX=(x0+x1+x2)/ 3;\r\n\t\t\tvar centerY=(y0+y1+y2)/ 3;\r\n\t\t\tvar normX=x0-centerX;\r\n\t\t\tvar normY=y0-centerY;\r\n\t\t\tvar dist=Math.sqrt((normX *normX)+(normY *normY));\r\n\t\t\tx0=centerX+((normX / dist)*(dist+paddingX));\r\n\t\t\ty0=centerY+((normY / dist)*(dist+paddingY));\r\n\t\t\tnormX=x1-centerX;\r\n\t\t\tnormY=y1-centerY;\r\n\t\t\tdist=Math.sqrt((normX *normX)+(normY *normY));\r\n\t\t\tx1=centerX+((normX / dist)*(dist+paddingX));\r\n\t\t\ty1=centerY+((normY / dist)*(dist+paddingY));\r\n\t\t\tnormX=x2-centerX;\r\n\t\t\tnormY=y2-centerY;\r\n\t\t\tdist=Math.sqrt((normX *normX)+(normY *normY));\r\n\t\t\tx2=centerX+((normX / dist)*(dist+paddingX));\r\n\t\t\ty2=centerY+((normY / dist)*(dist+paddingY));\r\n\t\t}\r\n\t\tcontext.save();\r\n\t\tif (this.transform){\r\n\t\t\tvar mt=this.transform;\r\n\t\t\tcontext.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);\r\n\t\t}\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(x0,y0);\r\n\t\tcontext.lineTo(x1,y1);\r\n\t\tcontext.lineTo(x2,y2);\r\n\t\tcontext.closePath();\r\n\t\tcontext.clip();\r\n\t\tvar delta=(u0 *v1)+(v0 *u2)+(u1 *v2)-(v1 *u2)-(v0 *u1)-(u0 *v2);\r\n\t\tvar dDelta=1 / delta;\r\n\t\tvar deltaA=(x0 *v1)+(v0 *x2)+(x1 *v2)-(v1 *x2)-(v0 *x1)-(x0 *v2);\r\n\t\tvar deltaB=(u0 *x1)+(x0 *u2)+(u1 *x2)-(x1 *u2)-(x0 *u1)-(u0 *x2);\r\n\t\tvar deltaC=(u0 *v1 *x2)+(v0 *x1 *u2)+(x0 *u1 *v2)-(x0 *v1 *u2)-(v0 *u1 *x2)-(u0 *x1 *v2);\r\n\t\tvar deltaD=(y0 *v1)+(v0 *y2)+(y1 *v2)-(v1 *y2)-(v0 *y1)-(y0 *v2);\r\n\t\tvar deltaE=(u0 *y1)+(y0 *u2)+(u1 *y2)-(y1 *u2)-(y0 *u1)-(u0 *y2);\r\n\t\tvar deltaF=(u0 *v1 *y2)+(v0 *y1 *u2)+(y0 *u1 *v2)-(y0 *v1 *u2)-(v0 *u1 *y2)-(u0 *y1 *v2);\r\n\t\tcontext.transform(deltaA *dDelta,deltaD *dDelta,deltaB *dDelta,deltaE*dDelta,deltaC *dDelta,deltaF *dDelta);\r\n\t\tcontext.drawImage(textureSource,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight);\r\n\t\tcontext.restore();\r\n\t}\r\n\r\n\treturn CanvasMeshRender;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.canvasmesh.MeshData\r\nvar MeshData=(function(){\r\n\tfunction MeshData(){\r\n\t\t/**\r\n\t\t*纹理\r\n\t\t*/\r\n\t\tthis.texture=null;\r\n\t\t/**\r\n\t\t*uv数据\r\n\t\t*/\r\n\t\tthis.uvs=[0,0,1,0,1,1,0,1];\r\n\t\t/**\r\n\t\t*顶点数据\r\n\t\t*/\r\n\t\tthis.vertices=[0,0,100,0,100,100,0,100];\r\n\t\t/**\r\n\t\t*顶点索引\r\n\t\t*/\r\n\t\tthis.indexes=[0,1,3,3,1,2];\r\n\t\t/**\r\n\t\t*uv变换矩阵\r\n\t\t*/\r\n\t\tthis.uvTransform=null;\r\n\t\t/**\r\n\t\t*是否有uv变化矩阵\r\n\t\t*/\r\n\t\tthis.useUvTransform=false;\r\n\t\t/**\r\n\t\t*扩展像素,用来去除黑边\r\n\t\t*/\r\n\t\tthis.canvasPadding=1;\r\n\t}\r\n\r\n\t__class(MeshData,'laya.ani.bone.canvasmesh.MeshData');\r\n\tvar __proto=MeshData.prototype;\r\n\t/**\r\n\t*计算mesh的Bounds\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.getBounds=function(){\r\n\t\treturn Rectangle._getWrapRec(this.vertices);\r\n\t}\r\n\r\n\treturn MeshData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.DeformAniData\r\nvar DeformAniData=(function(){\r\n\tfunction DeformAniData(){\r\n\t\tthis.skinName=null;\r\n\t\tthis.deformSlotDataList=[];\r\n\t}\r\n\r\n\t__class(DeformAniData,'laya.ani.bone.DeformAniData');\r\n\treturn DeformAniData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.DeformSlotData\r\nvar DeformSlotData=(function(){\r\n\tfunction DeformSlotData(){\r\n\t\tthis.deformSlotDisplayList=[];\r\n\t}\r\n\r\n\t__class(DeformSlotData,'laya.ani.bone.DeformSlotData');\r\n\treturn DeformSlotData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.DeformSlotDisplayData\r\nvar DeformSlotDisplayData=(function(){\r\n\tfunction DeformSlotDisplayData(){\r\n\t\tthis.boneSlot=null;\r\n\t\tthis.slotIndex=-1;\r\n\t\tthis.attachment=null;\r\n\t\tthis.deformData=null;\r\n\t\tthis.frameIndex=0;\r\n\t\tthis.timeList=[];\r\n\t\tthis.vectices=[];\r\n\t\tthis.tweenKeyList=[];\r\n\t}\r\n\r\n\t__class(DeformSlotDisplayData,'laya.ani.bone.DeformSlotDisplayData');\r\n\tvar __proto=DeformSlotDisplayData.prototype;\r\n\t__proto.binarySearch1=function(values,target){\r\n\t\tvar low=0;\r\n\t\tvar high=values.length-2;\r\n\t\tif (high==0)\r\n\t\t\treturn 1;\r\n\t\tvar current=high >>> 1;\r\n\t\twhile (true){\r\n\t\t\tif (values[Math.floor(current+1)] <=target)\r\n\t\t\t\tlow=current+1;\r\n\t\t\telse\r\n\t\t\thigh=current;\r\n\t\t\tif (low==high)\r\n\t\t\t\treturn low+1;\r\n\t\t\tcurrent=(low+high)>>> 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t// Can't happen.\r\n\t__proto.apply=function(time,boneSlot,alpha){\r\n\t\t(alpha===void 0)&& (alpha=1);\r\n\t\ttime+=0.05;\r\n\t\tif (this.timeList.length <=0){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar i=0;\r\n\t\tvar n=0;\r\n\t\tvar tTime=this.timeList[0];\r\n\t\tif (time < tTime){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tVertexCount=this.vectices[0].length;\r\n\t\tvar tVertices=[];\r\n\t\tvar tFrameIndex=this.binarySearch1(this.timeList,time);\r\n\t\tthis.frameIndex=tFrameIndex;\r\n\t\tif (time >=this.timeList[this.timeList.length-1]){\r\n\t\t\tvar lastVertices=this.vectices[this.vectices.length-1];\r\n\t\t\tif (alpha < 1){\r\n\t\t\t\tfor (i=0;i < tVertexCount;i++){\r\n\t\t\t\t\ttVertices[i]+=(lastVertices[i]-tVertices[i])*alpha;\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (i=0;i < tVertexCount;i++){\r\n\t\t\t\t\ttVertices[i]=lastVertices[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.deformData=tVertices;\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tTweenKey=this.tweenKeyList[this.frameIndex];\r\n\t\tvar tPrevVertices=this.vectices[this.frameIndex-1];\r\n\t\tvar tNextVertices=this.vectices[this.frameIndex];\r\n\t\tvar tPreFrameTime=this.timeList[this.frameIndex-1];\r\n\t\tvar tFrameTime=this.timeList[this.frameIndex];\r\n\t\tif (this.tweenKeyList[tFrameIndex-1]){\r\n\t\t\talpha=(time-tPreFrameTime)/ (tFrameTime-tPreFrameTime);\r\n\t\t\t}else {\r\n\t\t\talpha=0;\r\n\t\t};\r\n\t\tvar tPrev=NaN;\r\n\t\tfor (i=0;i < tVertexCount;i++){\r\n\t\t\ttPrev=tPrevVertices[i];\r\n\t\t\ttVertices[i]=tPrev+(tNextVertices[i]-tPrev)*alpha;\r\n\t\t}\r\n\t\tthis.deformData=tVertices;\r\n\t}\r\n\r\n\treturn DeformSlotDisplayData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.DrawOrderData\r\nvar DrawOrderData=(function(){\r\n\tfunction DrawOrderData(){\r\n\t\tthis.time=NaN;\r\n\t\tthis.drawOrder=[];\r\n\t}\r\n\r\n\t__class(DrawOrderData,'laya.ani.bone.DrawOrderData');\r\n\treturn DrawOrderData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.EventData\r\nvar EventData=(function(){\r\n\tfunction EventData(){\r\n\t\tthis.name=null;\r\n\t\tthis.intValue=0;\r\n\t\tthis.floatValue=NaN;\r\n\t\tthis.stringValue=null;\r\n\t\tthis.time=NaN;\r\n\t}\r\n\r\n\t__class(EventData,'laya.ani.bone.EventData');\r\n\treturn EventData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.IkConstraint\r\nvar IkConstraint=(function(){\r\n\tfunction IkConstraint(data,bones){\r\n\t\tthis._targetBone=null;\r\n\t\tthis._bones=null;\r\n\t\tthis._data=null;\r\n\t\tthis.name=null;\r\n\t\tthis.mix=NaN;\r\n\t\tthis.bendDirection=NaN;\r\n\t\tthis.isSpine=true;\r\n\t\t//debug相关代码\r\n\t\tthis._sp=null;\r\n\t\tthis.isDebug=false;\r\n\t\tthis._data=data;\r\n\t\tthis._targetBone=bones[data.targetBoneIndex];\r\n\t\tthis.isSpine=data.isSpine;\r\n\t\tif (this._bones==null)this._bones=[];\r\n\t\tthis._bones.length=0;\r\n\t\tfor (var i=0,n=data.boneIndexs.length;i < n;i++){\r\n\t\t\tthis._bones.push(bones[data.boneIndexs[i]]);\r\n\t\t}\r\n\t\tthis.name=data.name;\r\n\t\tthis.mix=data.mix;\r\n\t\tthis.bendDirection=data.bendDirection;\r\n\t}\r\n\r\n\t__class(IkConstraint,'laya.ani.bone.IkConstraint');\r\n\tvar __proto=IkConstraint.prototype;\r\n\t__proto.apply=function(){\r\n\t\tswitch (this._bones.length){\r\n\t\t\tcase 1:\r\n\t\t\t\tthis._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (this.isSpine){\r\n\t\t\t\t\tthis._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tthis._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__proto._applyIk1=function(bone,targetX,targetY,alpha){\r\n\t\tvar pp=bone.parentBone;\r\n\t\tvar id=1 / (pp.resultMatrix.a *pp.resultMatrix.d-pp.resultMatrix.b *pp.resultMatrix.c);\r\n\t\tvar x=targetX-pp.resultMatrix.tx;\r\n\t\tvar y=targetY-pp.resultMatrix.ty;\r\n\t\tvar tx=(x *pp.resultMatrix.d-y *pp.resultMatrix.c)*id-bone.transform.x;\r\n\t\tvar ty=(y *pp.resultMatrix.a-x *pp.resultMatrix.b)*id-bone.transform.y;\r\n\t\tvar rotationIK=Math.atan2(ty,tx)*IkConstraint.radDeg-0-bone.transform.skX;\r\n\t\tif (bone.transform.scX < 0)rotationIK+=180;\r\n\t\tif (rotationIK > 180)\r\n\t\t\trotationIK-=360;\r\n\t\telse if (rotationIK <-180)rotationIK+=360;\r\n\t\tbone.transform.skX=bone.transform.skY=bone.transform.skX+rotationIK *alpha;\r\n\t\tbone.update();\r\n\t}\r\n\r\n\t__proto.updatePos=function(x,y){\r\n\t\tif (this._sp){\r\n\t\t\tthis._sp.pos(x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._applyIk2=function(parent,child,targetX,targetY,bendDir,alpha){\r\n\t\tif (alpha==0){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar px=parent.resultTransform.x,py=parent.resultTransform.y;\r\n\t\tvar psx=parent.transform.scX,psy=parent.transform.scY;\r\n\t\tvar csx=child.transform.scX;\r\n\t\tvar os1=0,os2=0,s2=0;\r\n\t\tif (psx < 0){\r\n\t\t\tpsx=-psx;\r\n\t\t\tos1=180;\r\n\t\t\ts2=-1;\r\n\t\t\t}else {\r\n\t\t\tos1=0;\r\n\t\t\ts2=1;\r\n\t\t}\r\n\t\tif (psy < 0){\r\n\t\t\tpsy=-psy;\r\n\t\t\ts2=-s2;\r\n\t\t}\r\n\t\tif (csx < 0){\r\n\t\t\tcsx=-csx;\r\n\t\t\tos2=180;\r\n\t\t\t}else {\r\n\t\t\tos2=0\r\n\t\t};\r\n\t\tvar cx=child.resultTransform.x,cy=NaN,cwx=NaN,cwy=NaN;\r\n\t\tvar a=parent.resultMatrix.a,b=parent.resultMatrix.c;\r\n\t\tvar c=parent.resultMatrix.b,d=parent.resultMatrix.d;\r\n\t\tvar u=Math.abs(psx-psy)<=0.0001;\r\n\t\tif (!u){\r\n\t\t\tcy=0;\r\n\t\t\tcwx=a *cx+parent.resultMatrix.tx;\r\n\t\t\tcwy=c *cx+parent.resultMatrix.ty;\r\n\t\t\t}else {\r\n\t\t\tcy=child.resultTransform.y;\r\n\t\t\tcwx=a *cx+b *cy+parent.resultMatrix.tx;\r\n\t\t\tcwy=c *cx+d *cy+parent.resultMatrix.ty;\r\n\t\t}\r\n\t\tif (this.isDebug){\r\n\t\t\tif (!this._sp){\r\n\t\t\t\tthis._sp=new Sprite();\r\n\t\t\t\tLaya.stage.addChild(this._sp);\r\n\t\t\t}\r\n\t\t\tthis._sp.graphics.clear();\r\n\t\t\tthis._sp.graphics.drawCircle(targetX,targetY,15,\"#ffff00\");\r\n\t\t\tthis._sp.graphics.drawCircle(cwx,cwy,15,\"#ff00ff\");\r\n\t\t}\r\n\t\tparent.setRotation(Math.atan2(cwy-parent.resultMatrix.ty,cwx-parent.resultMatrix.tx));\r\n\t\tvar pp=parent.parentBone;\r\n\t\ta=pp.resultMatrix.a;\r\n\t\tb=pp.resultMatrix.c;\r\n\t\tc=pp.resultMatrix.b;\r\n\t\td=pp.resultMatrix.d;\r\n\t\tvar id=1 / (a *d-b *c);\r\n\t\tvar x=targetX-pp.resultMatrix.tx,y=targetY-pp.resultMatrix.ty;\r\n\t\tvar tx=(x *d-y *b)*id-px;\r\n\t\tvar ty=(y *a-x *c)*id-py;\r\n\t\tx=cwx-pp.resultMatrix.tx;\r\n\t\ty=cwy-pp.resultMatrix.ty;\r\n\t\tvar dx=(x *d-y *b)*id-px;\r\n\t\tvar dy=(y *a-x *c)*id-py;\r\n\t\tvar l1=Math.sqrt(dx *dx+dy *dy);\r\n\t\tvar l2=child.length *csx;\r\n\t\tvar a1=NaN,a2=NaN;\r\n\t\tif (u){\r\n\t\t\tl2 *=psx;\r\n\t\t\tvar cos=(tx *tx+ty *ty-l1 *l1-l2 *l2)/ (2 *l1 *l2);\r\n\t\t\tif (cos <-1)\r\n\t\t\t\tcos=-1;\r\n\t\t\telse if (cos > 1)cos=1;\r\n\t\t\ta2=Math.acos(cos)*bendDir;\r\n\t\t\ta=l1+l2 *cos;\r\n\t\t\tb=l2 *Math.sin(a2);\r\n\t\t\ta1=Math.atan2(ty *a-tx *b,tx *a+ty *b);\r\n\t\t\t}else {\r\n\t\t\ta=psx *l2;\r\n\t\t\tb=psy *l2;\r\n\t\t\tvar aa=a *a,bb=b *b,dd=tx *tx+ty *ty,ta=Math.atan2(ty,tx);\r\n\t\t\tc=bb *l1 *l1+aa *dd-aa *bb;\r\n\t\t\tvar c1=-2 *bb *l1,c2=bb-aa;\r\n\t\t\td=c1 *c1-4 *c2 *c;\r\n\t\t\tif (d > 0){\r\n\t\t\t\tvar q=Math.sqrt(d);\r\n\t\t\t\tif (c1 < 0)q=-q;\r\n\t\t\t\tq=-(c1+q)/ 2;\r\n\t\t\t\tvar r0=q / c2,r1=c / q;\r\n\t\t\t\tvar r=Math.abs(r0)< Math.abs(r1)? r0 :r1;\r\n\t\t\t\tif (r *r <=dd){\r\n\t\t\t\t\ty=Math.sqrt(dd-r *r)*bendDir;\r\n\t\t\t\t\ta1=ta-Math.atan2(y,r);\r\n\t\t\t\t\ta2=Math.atan2(y / psy,(r-l1)/ psx);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar minAngle=0,minDist=Number.MAX_VALUE,minX=0,minY=0;\r\n\t\t\tvar maxAngle=0,maxDist=0,maxX=0,maxY=0;\r\n\t\t\tx=l1+a;\r\n\t\t\td=x *x;\r\n\t\t\tif (d > maxDist){\r\n\t\t\t\tmaxAngle=0;\r\n\t\t\t\tmaxDist=d;\r\n\t\t\t\tmaxX=x;\r\n\t\t\t}\r\n\t\t\tx=l1-a;\r\n\t\t\td=x *x;\r\n\t\t\tif (d < minDist){\r\n\t\t\t\tminAngle=Math.PI;\r\n\t\t\t\tminDist=d;\r\n\t\t\t\tminX=x;\r\n\t\t\t};\r\n\t\t\tvar angle=Math.acos(-a *l1 / (aa-bb));\r\n\t\t\tx=a *Math.cos(angle)+l1;\r\n\t\t\ty=b *Math.sin(angle);\r\n\t\t\td=x *x+y *y;\r\n\t\t\tif (d < minDist){\r\n\t\t\t\tminAngle=angle;\r\n\t\t\t\tminDist=d;\r\n\t\t\t\tminX=x;\r\n\t\t\t\tminY=y;\r\n\t\t\t}\r\n\t\t\tif (d > maxDist){\r\n\t\t\t\tmaxAngle=angle;\r\n\t\t\t\tmaxDist=d;\r\n\t\t\t\tmaxX=x;\r\n\t\t\t\tmaxY=y;\r\n\t\t\t}\r\n\t\t\tif (dd <=(minDist+maxDist)/ 2){\r\n\t\t\t\ta1=ta-Math.atan2(minY *bendDir,minX);\r\n\t\t\t\ta2=minAngle *bendDir;\r\n\t\t\t\t}else {\r\n\t\t\t\ta1=ta-Math.atan2(maxY *bendDir,maxX);\r\n\t\t\t\ta2=maxAngle *bendDir;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar os=Math.atan2(cy,cx)*s2;\r\n\t\tvar rotation=parent.resultTransform.skX;\r\n\t\ta1=(a1-os)*IkConstraint.radDeg+os1-rotation;\r\n\t\tif (a1 > 180)\r\n\t\t\ta1-=360;\r\n\t\telse if (a1 <-180)a1+=360;\r\n\t\tparent.resultTransform.x=px;\r\n\t\tparent.resultTransform.y=py;\r\n\t\tparent.resultTransform.skX=parent.resultTransform.skY=rotation+a1 *alpha;\r\n\t\trotation=child.resultTransform.skX;\r\n\t\trotation=rotation % 360;\r\n\t\ta2=((a2+os)*IkConstraint.radDeg-0)*s2+os2-rotation;\r\n\t\tif (a2 > 180)\r\n\t\t\ta2-=360;\r\n\t\telse if (a2 <-180)a2+=360;\r\n\t\tchild.resultTransform.x=cx;\r\n\t\tchild.resultTransform.y=cy;\r\n\t\tchild.resultTransform.skX=child.resultTransform.skY=child.resultTransform.skY+a2 *alpha;\r\n\t\tparent.update();\r\n\t}\r\n\r\n\t__proto._applyIk3=function(parent,child,targetX,targetY,bendDir,alpha){\r\n\t\tif (alpha==0){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar cwx=NaN,cwy=NaN;\r\n\t\tvar x=child.resultMatrix.a *child.length;\r\n\t\tvar y=child.resultMatrix.b *child.length;\r\n\t\tvar lLL=x *x+y *y;\r\n\t\tvar lL=Math.sqrt(lLL);\r\n\t\tvar parentX=parent.resultMatrix.tx;\r\n\t\tvar parentY=parent.resultMatrix.ty;\r\n\t\tvar childX=child.resultMatrix.tx;\r\n\t\tvar childY=child.resultMatrix.ty;\r\n\t\tvar dX=childX-parentX;\r\n\t\tvar dY=childY-parentY;\r\n\t\tvar lPP=dX *dX+dY *dY;\r\n\t\tvar lP=Math.sqrt(lPP);\r\n\t\tdX=targetX-parent.resultMatrix.tx;\r\n\t\tdY=targetY-parent.resultMatrix.ty;\r\n\t\tvar lTT=dX *dX+dY *dY;\r\n\t\tvar lT=Math.sqrt(lTT);\r\n\t\tvar ikRadianA=0;\r\n\t\tif (lL+lP <=lT || lT+lL <=lP || lT+lP <=lL){\r\n\t\t\tvar rate=NaN;\r\n\t\t\tif (lL+lP <=lT){\r\n\t\t\t\trate=1;\r\n\t\t\t\t}else{\r\n\t\t\t\trate=-1;\r\n\t\t\t}\r\n\t\t\tchildX=parentX+rate*(targetX-parentX)*lP / lT;\r\n\t\t\tchildY=parentY+rate*(targetY-parentY)*lP / lT;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar h=(lPP-lLL+lTT)/ (2 *lTT);\r\n\t\t\tvar r=Math.sqrt(lPP-h *h *lTT)/ lT;\r\n\t\t\tvar hX=parentX+(dX *h);\r\n\t\t\tvar hY=parentY+(dY *h);\r\n\t\t\tvar rX=-dY *r;\r\n\t\t\tvar rY=dX *r;\r\n\t\t\tif (bendDir>0){\r\n\t\t\t\tchildX=hX-rX;\r\n\t\t\t\tchildY=hY-rY;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tchildX=hX+rX;\r\n\t\t\t\tchildY=hY+rY;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcwx=childX;\r\n\t\tcwy=childY;\r\n\t\tif (this.isDebug){\r\n\t\t\tif (!this._sp){\r\n\t\t\t\tthis._sp=new Sprite();\r\n\t\t\t\tLaya.stage.addChild(this._sp);\r\n\t\t\t}\r\n\t\t\tthis._sp.graphics.clear();\r\n\t\t\tthis._sp.graphics.drawCircle(parentX,parentY,15,\"#ff00ff\");\r\n\t\t\tthis._sp.graphics.drawCircle(targetX,targetY,15,\"#ffff00\");\r\n\t\t\tthis._sp.graphics.drawCircle(cwx,cwy,15,\"#ff00ff\");\r\n\t\t};\r\n\t\tvar pRotation=NaN;\r\n\t\tpRotation=Math.atan2(cwy-parent.resultMatrix.ty,cwx-parent.resultMatrix.tx);\r\n\t\tparent.setRotation(pRotation);\r\n\t\tvar pTarMatrix;\r\n\t\tpTarMatrix=IkConstraint._tempMatrix;\r\n\t\tpTarMatrix.identity();\r\n\t\tpTarMatrix.rotate(pRotation);\r\n\t\tpTarMatrix.scale(parent.resultMatrix.getScaleX(),parent.resultMatrix.getScaleY());\r\n\t\tpTarMatrix.translate(parent.resultMatrix.tx,parent.resultMatrix.ty);\r\n\t\tpTarMatrix.copyTo(parent.resultMatrix);\r\n\t\tparent.updateChild();\r\n\t\tvar childRotation=NaN;\r\n\t\tchildRotation=Math.atan2(targetY-cwy,targetX-cwx);\r\n\t\tchild.setRotation(childRotation);\r\n\t\tvar childTarMatrix;\r\n\t\tchildTarMatrix=IkConstraint._tempMatrix;\r\n\t\tchildTarMatrix.identity();\r\n\t\tchildTarMatrix.rotate(childRotation);\r\n\t\tchildTarMatrix.scale(child.resultMatrix.getScaleX(),child.resultMatrix.getScaleY());\r\n\t\tchildTarMatrix.translate(cwx,cwy);\r\n\t\tpTarMatrix.copyTo(child.resultMatrix);\r\n\t\tchild.updateChild();\r\n\t}\r\n\r\n\t__static(IkConstraint,\r\n\t['radDeg',function(){return this.radDeg=180 / Math.PI;},'degRad',function(){return this.degRad=Math.PI / 180;},'_tempMatrix',function(){return this._tempMatrix=new Matrix();}\r\n\t]);\r\n\treturn IkConstraint;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.IkConstraintData\r\nvar IkConstraintData=(function(){\r\n\tfunction IkConstraintData(){\r\n\t\tthis.name=null;\r\n\t\tthis.targetBoneName=null;\r\n\t\tthis.bendDirection=1;\r\n\t\tthis.mix=1;\r\n\t\tthis.isSpine=true;\r\n\t\tthis.targetBoneIndex=-1;\r\n\t\tthis.boneNames=[];\r\n\t\tthis.boneIndexs=[];\r\n\t}\r\n\r\n\t__class(IkConstraintData,'laya.ani.bone.IkConstraintData');\r\n\treturn IkConstraintData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*Mesh数据处理工具\r\n*@version 1.0\r\n*\r\n*@created 2017-4-28 下午2:46:23\r\n*/\r\n//class laya.ani.bone.MeshTools\r\nvar MeshTools=(function(){\r\n\tfunction MeshTools(){}\r\n\t__class(MeshTools,'laya.ani.bone.MeshTools');\r\n\tMeshTools.findEdge=function(verticles,offI,min){\r\n\t\t(offI===void 0)&& (offI=0);\r\n\t\t(min===void 0)&& (min=true);\r\n\t\tvar i=0,len=0;\r\n\t\tvar tIndex=0;\r\n\t\tlen=verticles.length;\r\n\t\ttIndex=-1;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\tif (tIndex < 0 || (min==(verticles[tIndex+offI] < verticles[i+offI]))){\r\n\t\t\t\ttIndex=i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tIndex;\r\n\t}\r\n\r\n\tMeshTools.findBestTriangle=function(verticles){\r\n\t\tvar topI=0;\r\n\t\ttopI=MeshTools.findEdge(verticles,1,true);\r\n\t\tvar bottomI=0;\r\n\t\tbottomI=MeshTools.findEdge(verticles,1,false);\r\n\t\tvar leftI=0;\r\n\t\tleftI=MeshTools.findEdge(verticles,0,true);\r\n\t\tvar rightI=0;\r\n\t\trightI=MeshTools.findEdge(verticles,0,false);\r\n\t\tvar rst;\r\n\t\trst=MeshTools._bestTriangle;\r\n\t\trst.length=0;\r\n\t\trst.push(leftI,rightI);\r\n\t\tif (rst.indexOf(topI)< 0)rst.push(topI);\r\n\t\tif (rst.indexOf(bottomI)< 0)rst.push(bottomI);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMeshTools.solveMesh=function(mesh,rst){\r\n\t\trst=rst||[];\r\n\t\trst.length=0;\r\n\t\tvar mUv;\r\n\t\tmUv=mesh.uvs;\r\n\t\tvar mVer;\r\n\t\tmVer=mesh.vertices;\r\n\t\tvar uvAbs;\r\n\t\tvar indexs;\r\n\t\tindexs=MeshTools.findBestTriangle(mUv);\r\n\t\tvar index0=0;\r\n\t\tvar index1=0;\r\n\t\tvar index2=0;\r\n\t\tindex0=indexs[0];\r\n\t\tindex1=indexs[1];\r\n\t\tindex2=indexs[2];\r\n\t\tMeshTools._absArr.length=0;\r\n\t\tuvAbs=MeshTools.solvePoints(mesh.texture.uv,mUv[index0],mUv[index0+1],mUv[index1]-mUv[index0],mUv[index1+1]-mUv[index0+1],mUv[index2]-mUv[index0],mUv[index2+1]-mUv[index0+1],MeshTools._absArr);\r\n\t\tvar newVerticles;\r\n\t\tnewVerticles=MeshTools.transPoints(uvAbs,mVer[index0],mVer[index0+1],mVer[index1]-mVer[index0],mVer[index1+1]-mVer[index0+1],mVer[index2]-mVer[index0],mVer[index2+1]-mVer[index0+1],rst);\r\n\t\treturn newVerticles;\r\n\t}\r\n\r\n\tMeshTools.solvePoints=function(pointList,oX,oY,v1x,v1y,v2x,v2y,rst){\r\n\t\trst=rst||[];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=pointList.length;\r\n\t\tvar tRst;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\ttRst=MeshTools.solve2(pointList[i],pointList[i+1],oX,oY,v1x,v1y,v2x,v2y);\r\n\t\t\trst.push(tRst[0],tRst[1]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMeshTools.transPoints=function(abs,oX,oY,v1x,v1y,v2x,v2y,rst){\r\n\t\trst=rst|| [];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=abs.length;\r\n\t\tvar tRst;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\ttRst=MeshTools.transPoint(abs[i],abs[i+1],oX,oY,v1x,v1y,v2x,v2y,rst);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMeshTools.transPoint=function(a,b,oX,oY,v1x,v1y,v2x,v2y,rst){\r\n\t\trst=rst|| [];\r\n\t\tvar nX=NaN;\r\n\t\tvar nY=NaN;\r\n\t\tnX=oX+v1x *a+v2x *b;\r\n\t\tnY=oY+v1y *a+v2y *b;\r\n\t\trst.push(nX,nY)\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMeshTools.solve2=function(rx,ry,oX,oY,v1x,v1y,v2x,v2y,rv,rst){\r\n\t\t(rv===void 0)&& (rv=false);\r\n\t\trst=rst||[];\r\n\t\tvar a=NaN,b=NaN;\r\n\t\tif (v1x==0){\r\n\t\t\treturn MeshTools.solve2(rx,ry,oX,oY,v2x,v2y,v1x,v1y,true,rst);\r\n\t\t};\r\n\t\tvar dX=NaN;\r\n\t\tvar dY=NaN;\r\n\t\tdX=rx-oX;\r\n\t\tdY=ry-oY;\r\n\t\tb=(dY-dX *v1y / v1x)/ (v2y-v2x *v1y / v1x);\r\n\t\ta=(dX-b *v2x)/ v1x;\r\n\t\tif(rv){\r\n\t\t\trst.push(b,a);\r\n\t\t\t}else{\r\n\t\t\trst.push(a,b);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMeshTools.solve=function(pointC,point0,v1,v2){\r\n\t\treturn MeshTools.solve2(pointC.x,pointC.y,point0.x,point0.y,v1.x,v1.y,v2.x,v2.y);\r\n\t}\r\n\r\n\tMeshTools._bestTriangle=[];\r\n\tMeshTools._absArr=[];\r\n\treturn MeshTools;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*路径作用器\r\n*1，生成根据骨骼计算控制点\r\n*2，根据控制点生成路径，并计算路径上的节点\r\n*3，根据节点，重新调整骨骼位置\r\n*/\r\n//class laya.ani.bone.PathConstraint\r\nvar PathConstraint=(function(){\r\n\tfunction PathConstraint(data,bones){\r\n\t\tthis.target=null;\r\n\t\tthis.data=null;\r\n\t\tthis.bones=null;\r\n\t\tthis.position=NaN;\r\n\t\tthis.spacing=NaN;\r\n\t\tthis.rotateMix=NaN;\r\n\t\tthis.translateMix=NaN;\r\n\t\tthis._debugKey=false;\r\n\t\tthis._spaces=null;\r\n\t\tthis._segments=[];\r\n\t\tthis._curves=[];\r\n\t\tthis.data=data;\r\n\t\tthis.position=data.position;\r\n\t\tthis.spacing=data.spacing;\r\n\t\tthis.rotateMix=data.rotateMix;\r\n\t\tthis.translateMix=data.translateMix;\r\n\t\tthis.bones=[];\r\n\t\tvar tBoneIds=this.data.bones;\r\n\t\tfor (var i=0,n=tBoneIds.length;i < n;i++){\r\n\t\t\tthis.bones.push(bones[tBoneIds[i]]);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(PathConstraint,'laya.ani.bone.PathConstraint');\r\n\tvar __proto=PathConstraint.prototype;\r\n\t/**\r\n\t*计算骨骼在路径上的节点\r\n\t*@param boneSlot\r\n\t*@param boneMatrixArray\r\n\t*@param graphics\r\n\t*/\r\n\t__proto.apply=function(boneList,graphics){\r\n\t\tif (!this.target)\r\n\t\t\treturn;\r\n\t\tvar tTranslateMix=this.translateMix;\r\n\t\tvar tRotateMix=this.translateMix;\r\n\t\tvar tTranslate=tTranslateMix > 0;\r\n\t\tvar tRotate=tRotateMix > 0;\r\n\t\tvar tSpacingMode=this.data.spacingMode;\r\n\t\tvar tLengthSpacing=tSpacingMode==\"length\";\r\n\t\tvar tRotateMode=this.data.rotateMode;\r\n\t\tvar tTangents=tRotateMode==\"tangent\";\r\n\t\tvar tScale=tRotateMode==\"chainScale\";\r\n\t\tvar lengths=[];\r\n\t\tvar boneCount=this.bones.length;\r\n\t\tvar spacesCount=tTangents ? boneCount :boneCount+1;\r\n\t\tvar spaces=[];\r\n\t\tthis._spaces=spaces;\r\n\t\tspaces[0]=this.position;\r\n\t\tvar spacing=this.spacing;\r\n\t\tif (tScale || tLengthSpacing){\r\n\t\t\tfor (var i=0,n=spacesCount-1;i < n;){\r\n\t\t\t\tvar bone=this.bones[i];\r\n\t\t\t\tvar length=bone.length;\r\n\t\t\t\tvar x=length *bone.resultMatrix.a;\r\n\t\t\t\tvar y=length *bone.resultMatrix.b;\r\n\t\t\t\tlength=Math.sqrt(x *x+y *y);\r\n\t\t\t\tif (tScale)\r\n\t\t\t\t\tlengths[i]=length;\r\n\t\t\t\tspaces[++i]=tLengthSpacing ? Math.max(0,length+spacing):spacing;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor (i=1;i < spacesCount;i++){\r\n\t\t\t\tspaces[i]=spacing;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar positions=this.computeWorldPositions(this.target,boneList,graphics,spacesCount,tTangents,this.data.positionMode==\"percent\",tSpacingMode==\"percent\");\r\n\t\tif (this._debugKey){\r\n\t\t\tfor (i=0;i < positions.length;i++){\r\n\t\t\t\tgraphics.drawCircle(positions[i++],positions[i++],5,\"#00ff00\");\r\n\t\t\t};\r\n\t\t\tvar tLinePos=[];\r\n\t\t\tfor (i=0;i < positions.length;i++){\r\n\t\t\t\ttLinePos.push(positions[i++],positions[i++]);\r\n\t\t\t}\r\n\t\t\tgraphics.drawLines(0,0,tLinePos,\"#ff0000\");\r\n\t\t};\r\n\t\tvar skeletonX=NaN;\r\n\t\tvar skeletonY=NaN;\r\n\t\tvar boneX=positions[0];\r\n\t\tvar boneY=positions[1];\r\n\t\tvar offsetRotation=this.data.offsetRotation;\r\n\t\tvar tip=tRotateMode==\"chain\" && offsetRotation==0;\r\n\t\tvar p=NaN;\r\n\t\tfor (i=0,p=3;i < boneCount;i++,p+=3){\r\n\t\t\tbone=this.bones[i];\r\n\t\t\tbone.resultMatrix.tx+=(boneX-bone.resultMatrix.tx)*tTranslateMix;\r\n\t\t\tbone.resultMatrix.ty+=(boneY-bone.resultMatrix.ty)*tTranslateMix;\r\n\t\t\tx=positions[p];\r\n\t\t\ty=positions[p+1];\r\n\t\t\tvar dx=x-boneX,dy=y-boneY;\r\n\t\t\tif (tScale){\r\n\t\t\t\tlength=lengths[i];\r\n\t\t\t\tif (length !=0){\r\n\t\t\t\t\tvar s=(Math.sqrt(dx *dx+dy *dy)/ length-1)*tRotateMix+1;\r\n\t\t\t\t\tbone.resultMatrix.a *=s;\r\n\t\t\t\t\tbone.resultMatrix.c *=s;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tboneX=x;\r\n\t\t\tboneY=y;\r\n\t\t\tif (tRotate){\r\n\t\t\t\tvar a=bone.resultMatrix.a;\r\n\t\t\t\tvar b=bone.resultMatrix.c;\r\n\t\t\t\tvar c=bone.resultMatrix.b;\r\n\t\t\t\tvar d=bone.resultMatrix.d;\r\n\t\t\t\tvar r=NaN;\r\n\t\t\t\tvar cos=NaN;\r\n\t\t\t\tvar sin=NaN;\r\n\t\t\t\tif (tTangents){\r\n\t\t\t\t\tr=positions[p-1];\r\n\t\t\t\t}\r\n\t\t\t\telse if (spaces[i+1]==0){\r\n\t\t\t\t\tr=positions[p+2];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tr=Math.atan2(dy,dx);\r\n\t\t\t\t}\r\n\t\t\t\tr-=Math.atan2(c,a)-offsetRotation / 180 *Math.PI;\r\n\t\t\t\tif (tip){\r\n\t\t\t\t\tcos=Math.cos(r);\r\n\t\t\t\t\tsin=Math.sin(r);\r\n\t\t\t\t\tlength=bone.length;\r\n\t\t\t\t\tboneX+=(length *(cos *a-sin *c)-dx)*tRotateMix;\r\n\t\t\t\t\tboneY+=(length *(sin *a+cos *c)-dy)*tRotateMix;\r\n\t\t\t\t}\r\n\t\t\t\tif (r > Math.PI){\r\n\t\t\t\t\tr-=(Math.PI *2);\r\n\t\t\t\t}\r\n\t\t\t\telse if (r <-Math.PI){\r\n\t\t\t\t\tr+=(Math.PI *2);\r\n\t\t\t\t}\r\n\t\t\t\tr *=tRotateMix;\r\n\t\t\t\tcos=Math.cos(r);\r\n\t\t\t\tsin=Math.sin(r);\r\n\t\t\t\tbone.resultMatrix.a=cos *a-sin *c;\r\n\t\t\t\tbone.resultMatrix.c=cos *b-sin *d;\r\n\t\t\t\tbone.resultMatrix.b=sin *a+cos *c;\r\n\t\t\t\tbone.resultMatrix.d=sin *b+cos *d;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*计算顶点的世界坐标\r\n\t*@param boneSlot\r\n\t*@param boneList\r\n\t*@param start\r\n\t*@param count\r\n\t*@param worldVertices\r\n\t*@param offset\r\n\t*/\r\n\t__proto.computeWorldVertices2=function(boneSlot,boneList,start,count,worldVertices,offset){\r\n\t\tvar tBones=boneSlot.currDisplayData.bones;\r\n\t\tvar tWeights=boneSlot.currDisplayData.weights;\r\n\t\tvar tTriangles=boneSlot.currDisplayData.triangles;\r\n\t\tvar tMatrix;\r\n\t\tvar i=0;\r\n\t\tvar v=0;\r\n\t\tvar skip=0;\r\n\t\tvar n=0;\r\n\t\tvar w=0;\r\n\t\tvar b=0;\r\n\t\tvar wx=0;\r\n\t\tvar wy=0;\r\n\t\tvar vx=0;\r\n\t\tvar vy=0;\r\n\t\tvar bone;\r\n\t\tvar len=0;\r\n\t\tif (tBones==null){\r\n\t\t\tif (!tTriangles)tTriangles=tWeights;\r\n\t\t\tif (boneSlot.deformData)\r\n\t\t\t\ttTriangles=boneSlot.deformData;\r\n\t\t\tvar parentName;\r\n\t\t\tparentName=boneSlot.parent;\r\n\t\t\tif (boneList){\r\n\t\t\t\tlen=boneList.length;\r\n\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\tif (boneList[i].name==parentName){\r\n\t\t\t\t\t\tbone=boneList[i];\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar tBoneMt;\r\n\t\t\tif (bone){\r\n\t\t\t\ttBoneMt=bone.resultMatrix;\r\n\t\t\t}\r\n\t\t\tif (!tBoneMt)tBoneMt=PathConstraint._tempMt;\r\n\t\t\tvar x=tBoneMt.tx;\r\n\t\t\tvar y=tBoneMt.ty;\r\n\t\t\tvar a=tBoneMt.a,bb=tBoneMt.b,c=tBoneMt.c,d=tBoneMt.d;\r\n\t\t\tif(bone)d*=bone.d;\r\n\t\t\tfor (v=start,w=offset;w < count;v+=2,w+=2){\r\n\t\t\t\tvx=tTriangles[v],vy=tTriangles[v+1];\r\n\t\t\t\tworldVertices[w]=vx *a+vy *bb+x;\r\n\t\t\t\tworldVertices[w+1]=-(vx *c+vy *d+y);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (i=0;i < start;i+=2){\r\n\t\t\tn=tBones[v];\r\n\t\t\tv+=n+1;\r\n\t\t\tskip+=n;\r\n\t\t};\r\n\t\tvar skeletonBones=boneList;\r\n\t\tfor (w=offset,b=skip *3;w < count;w+=2){\r\n\t\t\twx=0,wy=0;\r\n\t\t\tn=tBones[v++];\r\n\t\t\tn+=v;\r\n\t\t\tfor (;v < n;v++,b+=3){\r\n\t\t\t\ttMatrix=skeletonBones[tBones[v]].resultMatrix;\r\n\t\t\t\tvx=tWeights[b];\r\n\t\t\t\tvy=tWeights[b+1];\r\n\t\t\t\tvar weight=tWeights[b+2];\r\n\t\t\t\twx+=(vx *tMatrix.a+vy *tMatrix.c+tMatrix.tx)*weight;\r\n\t\t\t\twy+=(vx *tMatrix.b+vy *tMatrix.d+tMatrix.ty)*weight;\r\n\t\t\t}\r\n\t\t\tworldVertices[w]=wx;\r\n\t\t\tworldVertices[w+1]=wy;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*计算路径上的节点\r\n\t*@param boneSlot\r\n\t*@param boneList\r\n\t*@param graphics\r\n\t*@param spacesCount\r\n\t*@param tangents\r\n\t*@param percentPosition\r\n\t*@param percentSpacing\r\n\t*@return\r\n\t*/\r\n\t__proto.computeWorldPositions=function(boneSlot,boneList,graphics,spacesCount,tangents,percentPosition,percentSpacing){\r\n\t\tvar tBones=boneSlot.currDisplayData.bones;\r\n\t\tvar tWeights=boneSlot.currDisplayData.weights;\r\n\t\tvar tTriangles=boneSlot.currDisplayData.triangles;\r\n\t\tvar tRx=0;\r\n\t\tvar tRy=0;\r\n\t\tvar nn=0;\r\n\t\tvar tMatrix;\r\n\t\tvar tX=NaN;\r\n\t\tvar tY=NaN;\r\n\t\tvar tB=0;\r\n\t\tvar tWeight=0;\r\n\t\tvar tVertices=[];\r\n\t\tvar i=0,j=0,n=0;\r\n\t\tvar verticesLength=boneSlot.currDisplayData.verLen;\r\n\t\tvar target=boneSlot;\r\n\t\tvar position=this.position;\r\n\t\tvar spaces=this._spaces;\r\n\t\tvar world=[];\r\n\t\tvar out=[];\r\n\t\tvar closed=false;\r\n\t\tvar curveCount=verticesLength / 6;\r\n\t\tvar prevCurve=-1;\r\n\t\tvar pathLength=NaN;\r\n\t\tvar o=0,curve=0;\r\n\t\tvar p=NaN;\r\n\t\tvar space=NaN;\r\n\t\tvar prev=NaN;\r\n\t\tvar length=NaN;\r\n\t\tif (false){ var lengths; }\r\n\t\tif (closed){\r\n\t\t\tverticesLength+=2;\r\n\t\t\tworld[verticesLength-2]=world[0];\r\n\t\t\tworld[verticesLength-1]=world[1];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcurveCount--;\r\n\t\t\tverticesLength-=4;\r\n\t\t\tthis.computeWorldVertices2(boneSlot,boneList,2,verticesLength,tVertices,0);\r\n\t\t\tif (this._debugKey){\r\n\t\t\t\tfor (i=0;i < tVertices.length;){\r\n\t\t\t\t\tgraphics.drawCircle(tVertices[i++],tVertices[i++],10,\"#ff0000\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tworld=tVertices;\r\n\t\t}\r\n\t\tthis._curves.length=curveCount;\r\n\t\tvar curves=this._curves;\r\n\t\tpathLength=0;\r\n\t\tvar x1=world[0],y1=world[1],cx1=0,cy1=0,cx2=0,cy2=0,x2=0,y2=0;\r\n\t\tvar tmpx=NaN,tmpy=NaN,dddfx=NaN,dddfy=NaN,ddfx=NaN,ddfy=NaN,dfx=NaN,dfy=NaN;\r\n\t\tvar w=0;\r\n\t\tfor (i=0,w=2;i < curveCount;i++,w+=6){\r\n\t\t\tcx1=world[w];\r\n\t\t\tcy1=world[w+1];\r\n\t\t\tcx2=world[w+2];\r\n\t\t\tcy2=world[w+3];\r\n\t\t\tx2=world[w+4];\r\n\t\t\ty2=world[w+5];\r\n\t\t\ttmpx=(x1-cx1 *2+cx2)*0.1875;\r\n\t\t\ttmpy=(y1-cy1 *2+cy2)*0.1875;\r\n\t\t\tdddfx=((cx1-cx2)*3-x1+x2)*0.09375;\r\n\t\t\tdddfy=((cy1-cy2)*3-y1+y2)*0.09375;\r\n\t\t\tddfx=tmpx *2+dddfx;\r\n\t\t\tddfy=tmpy *2+dddfy;\r\n\t\t\tdfx=(cx1-x1)*0.75+tmpx+dddfx *0.16666667;\r\n\t\t\tdfy=(cy1-y1)*0.75+tmpy+dddfy *0.16666667;\r\n\t\t\tpathLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\tdfx+=ddfx;\r\n\t\t\tdfy+=ddfy;\r\n\t\t\tddfx+=dddfx;\r\n\t\t\tddfy+=dddfy;\r\n\t\t\tpathLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\tdfx+=ddfx;\r\n\t\t\tdfy+=ddfy;\r\n\t\t\tpathLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\tdfx+=ddfx+dddfx;\r\n\t\t\tdfy+=ddfy+dddfy;\r\n\t\t\tpathLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\tcurves[i]=pathLength;\r\n\t\t\tx1=x2;\r\n\t\t\ty1=y2;\r\n\t\t}\r\n\t\tif (percentPosition)\r\n\t\t\tposition *=pathLength;\r\n\t\tif (percentSpacing){\r\n\t\t\tfor (i=0;i < spacesCount;i++)\r\n\t\t\tspaces[i] *=pathLength;\r\n\t\t};\r\n\t\tvar segments=this._segments;\r\n\t\tvar curveLength=0;\r\n\t\tvar segment=0;\r\n\t\tfor (i=0,o=0,curve=0,segment=0;i < spacesCount;i++,o+=3){\r\n\t\t\tspace=spaces[i];\r\n\t\t\tposition+=space;\r\n\t\t\tp=position;\r\n\t\t\tif (closed){\r\n\t\t\t\tp %=pathLength;\r\n\t\t\t\tif (p < 0)\r\n\t\t\t\t\tp+=pathLength;\r\n\t\t\t\tcurve=0;\r\n\t\t\t}\r\n\t\t\telse if (p < 0){\r\n\t\t\t\tthis.addBeforePosition(p,world,0,out,o);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\telse if (p > pathLength){\r\n\t\t\t\tthis.addAfterPosition(p-pathLength,world,verticesLength-4,out,o);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tfor (;;curve++){\r\n\t\t\t\tlength=curves[curve];\r\n\t\t\t\tif (p > length)\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\tif (curve==0)\r\n\t\t\t\t\tp /=length;\r\n\t\t\t\telse {\r\n\t\t\t\t\tprev=curves[curve-1];\r\n\t\t\t\t\tp=(p-prev)/ (length-prev);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tif (curve !=prevCurve){\r\n\t\t\t\tprevCurve=curve;\r\n\t\t\t\tvar ii=curve *6;\r\n\t\t\t\tx1=world[ii];\r\n\t\t\t\ty1=world[ii+1];\r\n\t\t\t\tcx1=world[ii+2];\r\n\t\t\t\tcy1=world[ii+3];\r\n\t\t\t\tcx2=world[ii+4];\r\n\t\t\t\tcy2=world[ii+5];\r\n\t\t\t\tx2=world[ii+6];\r\n\t\t\t\ty2=world[ii+7];\r\n\t\t\t\ttmpx=(x1-cx1 *2+cx2)*0.03;\r\n\t\t\t\ttmpy=(y1-cy1 *2+cy2)*0.03;\r\n\t\t\t\tdddfx=((cx1-cx2)*3-x1+x2)*0.006;\r\n\t\t\t\tdddfy=((cy1-cy2)*3-y1+y2)*0.006;\r\n\t\t\t\tddfx=tmpx *2+dddfx;\r\n\t\t\t\tddfy=tmpy *2+dddfy;\r\n\t\t\t\tdfx=(cx1-x1)*0.3+tmpx+dddfx *0.16666667;\r\n\t\t\t\tdfy=(cy1-y1)*0.3+tmpy+dddfy *0.16666667;\r\n\t\t\t\tcurveLength=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\t\tsegments[0]=curveLength;\r\n\t\t\t\tfor (ii=1;ii < 8;ii++){\r\n\t\t\t\t\tdfx+=ddfx;\r\n\t\t\t\t\tdfy+=ddfy;\r\n\t\t\t\t\tddfx+=dddfx;\r\n\t\t\t\t\tddfy+=dddfy;\r\n\t\t\t\t\tcurveLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\t\t\tsegments[ii]=curveLength;\r\n\t\t\t\t}\r\n\t\t\t\tdfx+=ddfx;\r\n\t\t\t\tdfy+=ddfy;\r\n\t\t\t\tcurveLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\t\tsegments[8]=curveLength;\r\n\t\t\t\tdfx+=ddfx+dddfx;\r\n\t\t\t\tdfy+=ddfy+dddfy;\r\n\t\t\t\tcurveLength+=Math.sqrt(dfx *dfx+dfy *dfy);\r\n\t\t\t\tsegments[9]=curveLength;\r\n\t\t\t\tsegment=0;\r\n\t\t\t}\r\n\t\t\tp *=curveLength;\r\n\t\t\tfor (;;segment++){\r\n\t\t\t\tlength=segments[segment];\r\n\t\t\t\tif (p > length)\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\tif (segment==0)\r\n\t\t\t\t\tp /=length;\r\n\t\t\t\telse {\r\n\t\t\t\t\tprev=segments[segment-1];\r\n\t\t\t\t\tp=segment+(p-prev)/ (length-prev);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tthis.addCurvePosition(p *0.1,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents || (i > 0 && space==0));\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\t__proto.addBeforePosition=function(p,temp,i,out,o){\r\n\t\tvar x1=temp[i],y1=temp[i+1],dx=temp[i+2]-x1,dy=temp[i+3]-y1,r=Math.atan2(dy,dx);\r\n\t\tout[o]=x1+p *Math.cos(r);\r\n\t\tout[o+1]=y1+p *Math.sin(r);\r\n\t\tout[o+2]=r;\r\n\t}\r\n\r\n\t__proto.addAfterPosition=function(p,temp,i,out,o){\r\n\t\tvar x1=temp[i+2],y1=temp[i+3],dx=x1-temp[i],dy=y1-temp[i+1],r=Math.atan2(dy,dx);\r\n\t\tout[o]=x1+p *Math.cos(r);\r\n\t\tout[o+1]=y1+p *Math.sin(r);\r\n\t\tout[o+2]=r;\r\n\t}\r\n\r\n\t__proto.addCurvePosition=function(p,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents){\r\n\t\tif (p==0)\r\n\t\t\tp=0.0001;\r\n\t\tvar tt=p *p,ttt=tt *p,u=1-p,uu=u *u,uuu=uu *u;\r\n\t\tvar ut=u *p,ut3=ut *3,uut3=u *ut3,utt3=ut3 *p;\r\n\t\tvar x=x1 *uuu+cx1 *uut3+cx2 *utt3+x2 *ttt,y=y1 *uuu+cy1 *uut3+cy2 *utt3+y2 *ttt;\r\n\t\tout[o]=x;\r\n\t\tout[o+1]=y;\r\n\t\tif (tangents){\r\n\t\t\tout[o+2]=Math.atan2(y-(y1 *uu+cy1 *ut *2+cy2 *tt),x-(x1 *uu+cx1 *ut *2+cx2 *tt));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tout[o+2]=0;\r\n\t\t}\r\n\t}\r\n\r\n\tPathConstraint.NONE=-1;\r\n\tPathConstraint.BEFORE=-2;\r\n\tPathConstraint.AFTER=-3;\r\n\t__static(PathConstraint,\r\n\t['_tempMt',function(){return this._tempMt=new Matrix();}\r\n\t]);\r\n\treturn PathConstraint;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.PathConstraintData\r\nvar PathConstraintData=(function(){\r\n\tfunction PathConstraintData(){\r\n\t\tthis.name=null;\r\n\t\tthis.target=null;\r\n\t\tthis.positionMode=null;\r\n\t\tthis.spacingMode=null;\r\n\t\tthis.rotateMode=null;\r\n\t\tthis.offsetRotation=NaN;\r\n\t\tthis.position=NaN;\r\n\t\tthis.spacing=NaN;\r\n\t\tthis.rotateMix=NaN;\r\n\t\tthis.translateMix=NaN;\r\n\t\tthis.bones=[];\r\n\t}\r\n\r\n\t__class(PathConstraintData,'laya.ani.bone.PathConstraintData');\r\n\treturn PathConstraintData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.SkinData\r\nvar SkinData=(function(){\r\n\tfunction SkinData(){\r\n\t\tthis.name=null;\r\n\t\tthis.slotArr=[];\r\n\t}\r\n\r\n\t__class(SkinData,'laya.ani.bone.SkinData');\r\n\treturn SkinData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.SkinSlotDisplayData\r\nvar SkinSlotDisplayData=(function(){\r\n\tfunction SkinSlotDisplayData(){\r\n\t\tthis.name=null;\r\n\t\tthis.attachmentName=null;\r\n\t\tthis.type=0;\r\n\t\tthis.transform=null;\r\n\t\tthis.width=NaN;\r\n\t\tthis.height=NaN;\r\n\t\tthis.texture=null;\r\n\t\tthis.bones=null;\r\n\t\tthis.uvs=null;\r\n\t\tthis.weights=null;\r\n\t\tthis.triangles=null;\r\n\t\tthis.vertices=null;\r\n\t\tthis.lengths=null;\r\n\t\tthis.verLen=0;\r\n\t}\r\n\r\n\t__class(SkinSlotDisplayData,'laya.ani.bone.SkinSlotDisplayData');\r\n\tvar __proto=SkinSlotDisplayData.prototype;\r\n\t__proto.createTexture=function(currTexture){\r\n\t\tif (this.texture)return this.texture;\r\n\t\tthis.texture=new Texture(currTexture.bitmap,this.uvs);\r\n\t\tif (this.uvs[0] > this.uvs[4]\r\n\t\t\t&& this.uvs[1] > this.uvs[5]){\r\n\t\t\tthis.texture.width=currTexture.height;\r\n\t\t\tthis.texture.height=currTexture.width;\r\n\t\t\tthis.texture.offsetX=-currTexture.offsetX;\r\n\t\t\tthis.texture.offsetY=-currTexture.offsetY;\r\n\t\t\tthis.texture.sourceWidth=currTexture.sourceHeight;\r\n\t\t\tthis.texture.sourceHeight=currTexture.sourceWidth;\r\n\t\t\t}else {\r\n\t\t\tthis.texture.width=currTexture.width;\r\n\t\t\tthis.texture.height=currTexture.height;\r\n\t\t\tthis.texture.offsetX=-currTexture.offsetX;\r\n\t\t\tthis.texture.offsetY=-currTexture.offsetY;\r\n\t\t\tthis.texture.sourceWidth=currTexture.sourceWidth;\r\n\t\t\tthis.texture.sourceHeight=currTexture.sourceHeight;\r\n\t\t}\r\n\t\tif (!Render.isWebGL){\r\n\t\t\tif (this.uvs[1] > this.uvs[5]){\r\n\t\t\t\tthis.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.texture;\r\n\t}\r\n\r\n\t__proto.destory=function(){\r\n\t\tif (this.texture)this.texture.destroy();\r\n\t}\r\n\r\n\treturn SkinSlotDisplayData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.SlotData\r\nvar SlotData=(function(){\r\n\tfunction SlotData(){\r\n\t\tthis.name=null;\r\n\t\tthis.displayArr=[];\r\n\t}\r\n\r\n\t__class(SlotData,'laya.ani.bone.SlotData');\r\n\tvar __proto=SlotData.prototype;\r\n\t__proto.getDisplayByName=function(name){\r\n\t\tvar tDisplay;\r\n\t\tfor (var i=0,n=this.displayArr.length;i < n;i++){\r\n\t\t\ttDisplay=this.displayArr[i];\r\n\t\t\tif (tDisplay.attachmentName==name){\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn-1;\r\n\t}\r\n\r\n\treturn SlotData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.TfConstraint\r\nvar TfConstraint=(function(){\r\n\tfunction TfConstraint(data,bones){\r\n\t\tthis._data=null;\r\n\t\tthis._bones=null;\r\n\t\tthis.target=null;\r\n\t\tthis.rotateMix=NaN;\r\n\t\tthis.translateMix=NaN;\r\n\t\tthis.scaleMix=NaN;\r\n\t\tthis.shearMix=NaN;\r\n\t\tthis._temp=__newvec(2,0);\r\n\t\tthis._data=data;\r\n\t\tif (this._bones==null){\r\n\t\t\tthis._bones=[];\r\n\t\t}\r\n\t\tthis.target=bones[data.targetIndex];\r\n\t\tvar j=0,n=0;\r\n\t\tfor (j=0,n=data.boneIndexs.length;j < n;j++){\r\n\t\t\tthis._bones.push(bones[data.boneIndexs[j]]);\r\n\t\t}\r\n\t\tthis.rotateMix=data.rotateMix;\r\n\t\tthis.translateMix=data.translateMix;\r\n\t\tthis.scaleMix=data.scaleMix;\r\n\t\tthis.shearMix=data.shearMix;\r\n\t}\r\n\r\n\t__class(TfConstraint,'laya.ani.bone.TfConstraint');\r\n\tvar __proto=TfConstraint.prototype;\r\n\t__proto.apply=function(){\r\n\t\tvar tTfBone;\r\n\t\tvar ta=this.target.resultMatrix.a,tb=this.target.resultMatrix.b,tc=this.target.resultMatrix.c,td=this.target.resultMatrix.d;\r\n\t\tfor (var j=0,n=this._bones.length;j < n;j++){\r\n\t\t\ttTfBone=this._bones[j];\r\n\t\t\tif (this.rotateMix > 0){\r\n\t\t\t\tvar a=tTfBone.resultMatrix.a,b=tTfBone.resultMatrix.b,c=tTfBone.resultMatrix.c,d=tTfBone.resultMatrix.d;\r\n\t\t\t\tvar r=Math.atan2(tc,ta)-Math.atan2(c,a)+this._data.offsetRotation *Math.PI / 180;\r\n\t\t\t\tif (r > Math.PI)\r\n\t\t\t\t\tr-=Math.PI *2;\r\n\t\t\t\telse if (r <-Math.PI)r+=Math.PI *2;\r\n\t\t\t\tr *=this.rotateMix;\r\n\t\t\t\tvar cos=Math.cos(r),sin=Math.sin(r);\r\n\t\t\t\ttTfBone.resultMatrix.a=cos *a-sin *c;\r\n\t\t\t\ttTfBone.resultMatrix.b=cos *b-sin *d;\r\n\t\t\t\ttTfBone.resultMatrix.c=sin *a+cos *c;\r\n\t\t\t\ttTfBone.resultMatrix.d=sin *b+cos *d;\r\n\t\t\t}\r\n\t\t\tif (this.translateMix){\r\n\t\t\t\tthis._temp[0]=this._data.offsetX;\r\n\t\t\t\tthis._temp[1]=this._data.offsetY;\r\n\t\t\t\tthis.target.localToWorld(this._temp);\r\n\t\t\t\ttTfBone.resultMatrix.tx+=(this._temp[0]-tTfBone.resultMatrix.tx)*this.translateMix;\r\n\t\t\t\ttTfBone.resultMatrix.ty+=(this._temp[1]-tTfBone.resultMatrix.ty)*this.translateMix;\r\n\t\t\t\ttTfBone.updateChild();\r\n\t\t\t}\r\n\t\t\tif (this.scaleMix > 0){\r\n\t\t\t\tvar bs=Math.sqrt(tTfBone.resultMatrix.a *tTfBone.resultMatrix.a+tTfBone.resultMatrix.c *tTfBone.resultMatrix.c);\r\n\t\t\t\tvar ts=Math.sqrt(ta *ta+tc *tc);\r\n\t\t\t\tvar s=bs > 0.00001 ? (bs+(ts-bs+this._data.offsetScaleX)*this.scaleMix)/ bs :0;\r\n\t\t\t\ttTfBone.resultMatrix.a *=s;\r\n\t\t\t\ttTfBone.resultMatrix.c *=s;\r\n\t\t\t\tbs=Math.sqrt(tTfBone.resultMatrix.b *tTfBone.resultMatrix.b+tTfBone.resultMatrix.d *tTfBone.resultMatrix.d);\r\n\t\t\t\tts=Math.sqrt(tb *tb+td *td);\r\n\t\t\t\ts=bs > 0.00001 ? (bs+(ts-bs+this._data.offsetScaleY)*this.scaleMix)/ bs :0;\r\n\t\t\t\ttTfBone.resultMatrix.b *=s;\r\n\t\t\t\ttTfBone.resultMatrix.d *=s;\r\n\t\t\t}\r\n\t\t\tif (this.shearMix > 0){\r\n\t\t\t\tb=tTfBone.resultMatrix.b,d=tTfBone.resultMatrix.d;\r\n\t\t\t\tvar by=Math.atan2(d,b);\r\n\t\t\t\tr=Math.atan2(td,tb)-Math.atan2(tc,ta)-(by-Math.atan2(tTfBone.resultMatrix.c,tTfBone.resultMatrix.a));\r\n\t\t\t\tif (r > Math.PI)\r\n\t\t\t\t\tr-=Math.PI *2;\r\n\t\t\t\telse if (r <-Math.PI)r+=Math.PI *2;\r\n\t\t\t\tr=by+(r+this._data.offsetShearY *Math.PI / 180)*this.shearMix;\r\n\t\t\t\ts=Math.sqrt(b *b+d *d);\r\n\t\t\t\ttTfBone.resultMatrix.b=Math.cos(r)*s;\r\n\t\t\t\ttTfBone.resultMatrix.d=Math.sin(r)*s;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn TfConstraint;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.TfConstraintData\r\nvar TfConstraintData=(function(){\r\n\tfunction TfConstraintData(){\r\n\t\tthis.name=null;\r\n\t\tthis.targetIndex=0;\r\n\t\tthis.rotateMix=NaN;\r\n\t\tthis.translateMix=NaN;\r\n\t\tthis.scaleMix=NaN;\r\n\t\tthis.shearMix=NaN;\r\n\t\tthis.offsetRotation=NaN;\r\n\t\tthis.offsetX=NaN;\r\n\t\tthis.offsetY=NaN;\r\n\t\tthis.offsetScaleX=NaN;\r\n\t\tthis.offsetScaleY=NaN;\r\n\t\tthis.offsetShearY=NaN;\r\n\t\tthis.boneIndexs=[];\r\n\t}\r\n\r\n\t__class(TfConstraintData,'laya.ani.bone.TfConstraintData');\r\n\treturn TfConstraintData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.bone.Transform\r\nvar Transform=(function(){\r\n\tfunction Transform(){\r\n\t\tthis.skX=0;\r\n\t\tthis.skY=0;\r\n\t\tthis.scX=1;\r\n\t\tthis.scY=1;\r\n\t\tthis.x=0;\r\n\t\tthis.y=0;\r\n\t\tthis.skewX=0;\r\n\t\tthis.skewY=0;\r\n\t\tthis.mMatrix=null;\r\n\t}\r\n\r\n\t__class(Transform,'laya.ani.bone.Transform');\r\n\tvar __proto=Transform.prototype;\r\n\t__proto.initData=function(data){\r\n\t\tif (data.x !=undefined){\r\n\t\t\tthis.x=data.x;\r\n\t\t}\r\n\t\tif (data.y !=undefined){\r\n\t\t\tthis.y=data.y;\r\n\t\t}\r\n\t\tif (data.skX !=undefined){\r\n\t\t\tthis.skX=data.skX;\r\n\t\t}\r\n\t\tif (data.skY !=undefined){\r\n\t\t\tthis.skY=data.skY;\r\n\t\t}\r\n\t\tif (data.scX !=undefined){\r\n\t\t\tthis.scX=data.scX;\r\n\t\t}\r\n\t\tif (data.scY !=undefined){\r\n\t\t\tthis.scY=data.scY;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getMatrix=function(){\r\n\t\tvar tMatrix;\r\n\t\tif (this.mMatrix){\r\n\t\t\ttMatrix=this.mMatrix;\r\n\t\t\t}else {\r\n\t\t\ttMatrix=this.mMatrix=new Matrix();\r\n\t\t}\r\n\t\ttMatrix.identity();\r\n\t\ttMatrix.scale(this.scX,this.scY);\r\n\t\tif (this.skewX || this.skewY){\r\n\t\t\tthis.skew(tMatrix,this.skewX *Math.PI / 180,this.skewY *Math.PI / 180);\r\n\t\t}\r\n\t\ttMatrix.rotate(this.skX *Math.PI / 180);\r\n\t\ttMatrix.translate(this.x,this.y);\r\n\t\treturn tMatrix;\r\n\t}\r\n\r\n\t__proto.skew=function(m,x,y){\r\n\t\tvar sinX=Math.sin(y);\r\n\t\tvar cosX=Math.cos(y);\r\n\t\tvar sinY=Math.sin(x);\r\n\t\tvar cosY=Math.cos(x);\r\n\t\tm.setTo(m.a *cosY-m.b *sinX,\r\n\t\tm.a *sinY+m.b *cosX,\r\n\t\tm.c *cosY-m.d *sinX,\r\n\t\tm.c *sinY+m.d *cosX,\r\n\t\tm.tx *cosY-m.ty *sinX,\r\n\t\tm.tx *sinY+m.ty *cosX);\r\n\t\treturn m;\r\n\t}\r\n\r\n\treturn Transform;\r\n})()\r\n\r\n\r\n/**\r\n*用于UV转换的工具类\r\n*@private\r\n*/\r\n//class laya.ani.bone.UVTools\r\nvar UVTools=(function(){\r\n\tfunction UVTools(){}\r\n\t__class(UVTools,'laya.ani.bone.UVTools');\r\n\tUVTools.getRelativeUV=function(bigUV,smallUV,rst){\r\n\t\tvar startX=bigUV[0];\r\n\t\tvar width=bigUV[2]-bigUV[0];\r\n\t\tvar startY=bigUV[1];\r\n\t\tvar height=bigUV[5]-bigUV[1];\r\n\t\tif(!rst)rst=[];\r\n\t\trst.length=smallUV.length;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=rst.length;\r\n\t\tvar dWidth=1 / width;\r\n\t\tvar dHeight=1 / height;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\trst[i]=(smallUV[i]-startX)*dWidth;\r\n\t\t\trst[i+1]=(smallUV[i+1]-startY)*dHeight;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tUVTools.getAbsoluteUV=function(bigUV,smallUV,rst){\r\n\t\tif (bigUV[0]==0 && bigUV[1]==0 && bigUV[4]==1 && bigUV[5]==1){\r\n\t\t\tif (rst){\r\n\t\t\t\tUtils.copyArray(rst,smallUV);\r\n\t\t\t\treturn rst;\r\n\t\t\t\t}else{\r\n\t\t\t\treturn smallUV;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar startX=bigUV[0];\r\n\t\tvar width=bigUV[2]-bigUV[0];\r\n\t\tvar startY=bigUV[1];\r\n\t\tvar height=bigUV[5]-bigUV[1];\r\n\t\tif(!rst)rst=[];\r\n\t\trst.length=smallUV.length;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=rst.length;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\trst[i]=smallUV[i]*width+startX;\r\n\t\t\trst[i+1]=smallUV[i+1]*height+startY;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn UVTools;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*@author ...\r\n*/\r\n//class laya.ani.KeyFramesContent\r\nvar KeyFramesContent=(function(){\r\n\tfunction KeyFramesContent(){\r\n\t\tthis.startTime=NaN;\r\n\t\tthis.duration=NaN;\r\n\t\tthis.interpolationData=null;\r\n\t\t//私有插值方式 [type0(插值类型),Data0(插值数据,可为空)，type1(插值类型),Data1(插值数据,可为空)] 注意：254全线性插值，255全不插值\r\n\t\tthis.data=null;\r\n\t\t//=new Float32Array();\r\n\t\tthis.nextData=null;\r\n\t}\r\n\r\n\t__class(KeyFramesContent,'laya.ani.KeyFramesContent');\r\n\treturn KeyFramesContent;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.ani.math.BezierLerp\r\nvar BezierLerp=(function(){\r\n\tfunction BezierLerp(){}\r\n\t__class(BezierLerp,'laya.ani.math.BezierLerp');\r\n\tBezierLerp.getBezierRate=function(t,px0,py0,px1,py1){\r\n\t\tvar key=BezierLerp._getBezierParamKey(px0,py0,px1,py1);\r\n\t\tvar vKey=key *100+t;\r\n\t\tif (BezierLerp._bezierResultCache[vKey])return BezierLerp._bezierResultCache[vKey];\r\n\t\tvar points=BezierLerp._getBezierPoints(px0,py0,px1,py1,key);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=points.length;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\tif (t <=points[i]){\r\n\t\t\t\tBezierLerp._bezierResultCache[vKey]=points[i+1];\r\n\t\t\t\treturn points[i+1];\r\n\t\t\t}\r\n\t\t}\r\n\t\tBezierLerp._bezierResultCache[vKey]=1;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tBezierLerp._getBezierParamKey=function(px0,py0,px1,py1){\r\n\t\treturn (((px0 *100+py0)*100+px1)*100+py1)*100;\r\n\t}\r\n\r\n\tBezierLerp._getBezierPoints=function(px0,py0,px1,py1,key){\r\n\t\tif (BezierLerp._bezierPointsCache[key])return BezierLerp._bezierPointsCache[key];\r\n\t\tvar controlPoints;\r\n\t\tcontrolPoints=[0,0,px0,py0,px1,py1,1,1];\r\n\t\tvar bz;\r\n\t\tbz=new Bezier();\r\n\t\tvar points;\r\n\t\tpoints=bz.getBezierPoints(controlPoints,100,3);\r\n\t\tBezierLerp._bezierPointsCache[key]=points;\r\n\t\treturn points;\r\n\t}\r\n\r\n\tBezierLerp._bezierResultCache={};\r\n\tBezierLerp._bezierPointsCache={};\r\n\treturn BezierLerp;\r\n})()\r\n\r\n\r\n/**\r\n*<code>AnimationPlayer</code> 类用于动画播放器。\r\n*/\r\n//class laya.ani.AnimationPlayer extends laya.events.EventDispatcher\r\nvar AnimationPlayer=(function(_super){\r\n\tfunction AnimationPlayer(){\r\n\t\t/**@private */\r\n\t\tthis._destroyed=false;\r\n\t\t/**数据模板*/\r\n\t\tthis._templet=null;\r\n\t\t/**当前精确时间，不包括重播时间*/\r\n\t\tthis._currentTime=NaN;\r\n\t\t/**当前帧时间，不包括重播时间*/\r\n\t\tthis._currentFrameTime=NaN;\r\n\t\t/**动画播放的起始时间位置*/\r\n\t\tthis._playStart=NaN;\r\n\t\t/**动画播放的结束时间位置*/\r\n\t\tthis._playEnd=NaN;\r\n\t\t/**动画播放一次的总时间*/\r\n\t\tthis._playDuration=NaN;\r\n\t\t/**动画播放总时间*/\r\n\t\tthis._overallDuration=NaN;\r\n\t\t/**是否在一帧结束时停止*/\r\n\t\tthis._stopWhenCircleFinish=false;\r\n\t\t/**已播放时间，包括重播时间*/\r\n\t\tthis._elapsedPlaybackTime=NaN;\r\n\t\t/**播放时帧数*/\r\n\t\tthis._startUpdateLoopCount=NaN;\r\n\t\t/**当前动画索引*/\r\n\t\tthis._currentAnimationClipIndex=0;\r\n\t\t/**当前帧数*/\r\n\t\tthis._currentKeyframeIndex=0;\r\n\t\t/**是否暂停*/\r\n\t\tthis._paused=false;\r\n\t\t/**默认帧率,必须大于0*/\r\n\t\tthis._cacheFrameRate=0;\r\n\t\t/**帧率间隔时间*/\r\n\t\tthis._cacheFrameRateInterval=NaN;\r\n\t\t/**缓存播放速率*/\r\n\t\tthis._cachePlayRate=NaN;\r\n\t\tthis._fullFrames=null;\r\n\t\t/**是否缓存*/\r\n\t\tthis.isCache=true;\r\n\t\t/**播放速率*/\r\n\t\tthis.playbackRate=1.0;\r\n\t\t/**停止时是否归零*/\r\n\t\tthis.returnToZeroStopped=false;\r\n\t\tAnimationPlayer.__super.call(this);\r\n\t\tthis._destroyed=false;\r\n\t\tthis._currentAnimationClipIndex=-1;\r\n\t\tthis._currentKeyframeIndex=-1;\r\n\t\tthis._currentTime=0.0;\r\n\t\tthis._overallDuration=Number.MAX_VALUE;\r\n\t\tthis._stopWhenCircleFinish=false;\r\n\t\tthis._elapsedPlaybackTime=0;\r\n\t\tthis._startUpdateLoopCount=-1;\r\n\t\tthis._cachePlayRate=1.0;\r\n\t\tthis.cacheFrameRate=60;\r\n\t\tthis.returnToZeroStopped=false;\r\n\t}\r\n\r\n\t__class(AnimationPlayer,'laya.ani.AnimationPlayer',_super);\r\n\tvar __proto=AnimationPlayer.prototype;\r\n\tLaya.imps(__proto,{\"laya.resource.IDestroy\":true})\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onTempletLoadedComputeFullKeyframeIndices=function(cachePlayRate,cacheFrameRate,templet){\r\n\t\tif (this._templet===templet && this._cachePlayRate===cachePlayRate && this._cacheFrameRate===cacheFrameRate)\r\n\t\t\tthis._computeFullKeyframeIndices();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._computeFullKeyframeIndices=function(){\r\n\t\tvar anifullFrames=this._fullFrames=[];\r\n\t\tvar templet=this._templet;\r\n\t\tvar cacheFrameInterval=this._cacheFrameRateInterval *this._cachePlayRate;\r\n\t\tfor (var i=0,iNum=templet.getAnimationCount();i < iNum;i++){\r\n\t\t\tvar aniFullFrame=[];\r\n\t\t\tfor (var j=0,jNum=templet.getAnimation(i).nodes.length;j < jNum;j++){\r\n\t\t\t\tvar node=templet.getAnimation(i).nodes[j];\r\n\t\t\t\tvar frameCount=Math.floor(node.playTime / cacheFrameInterval+0.01);\r\n\t\t\t\tvar nodeFullFrames=new Uint16Array(frameCount+1);\r\n\t\t\t\tvar lastFrameIndex=-1;\r\n\t\t\t\tfor (var n=0,nNum=node.keyFrame.length;n < nNum;n++){\r\n\t\t\t\t\tvar keyFrame=node.keyFrame[n];\r\n\t\t\t\t\tvar tm=keyFrame.startTime;\r\n\t\t\t\t\tvar endTm=tm+keyFrame.duration+cacheFrameInterval;\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tvar frameIndex=Math.floor(tm / cacheFrameInterval+0.5);\r\n\t\t\t\t\t\tfor (var k=lastFrameIndex+1;k < frameIndex;k++)\r\n\t\t\t\t\t\tnodeFullFrames[k]=n;\r\n\t\t\t\t\t\tlastFrameIndex=frameIndex;\r\n\t\t\t\t\t\tnodeFullFrames[frameIndex]=n;\r\n\t\t\t\t\t\ttm+=cacheFrameInterval;\r\n\t\t\t\t\t}while (tm <=endTm);\r\n\t\t\t\t}\r\n\t\t\t\taniFullFrame.push(nodeFullFrames);\r\n\t\t\t}\r\n\t\t\tanifullFrames.push(aniFullFrame);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onAnimationTempletLoaded=function(){\r\n\t\t(this.destroyed)|| (this._calculatePlayDuration());\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._calculatePlayDuration=function(){\r\n\t\tif (this.state!==/*laya.ani.AnimationState.stopped*/0){\r\n\t\t\tvar oriDuration=this._templet.getAniDuration(this._currentAnimationClipIndex);\r\n\t\t\t(this._playEnd===0)&& (this._playEnd=oriDuration);\r\n\t\t\tif (this._playEnd > oriDuration)\r\n\t\t\t\tthis._playEnd=oriDuration;\r\n\t\t\tthis._playDuration=this._playEnd-this._playStart;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._setPlayParams=function(time,cacheFrameInterval){\r\n\t\tthis._currentTime=time;\r\n\t\tthis._currentKeyframeIndex=Math.max(Math.floor((this.currentPlayTime)/ cacheFrameInterval+0.01),0);\r\n\t\tthis._currentFrameTime=this._currentKeyframeIndex *cacheFrameInterval;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._setPlayParamsWhenStop=function(currentAniClipPlayDuration,cacheFrameInterval){\r\n\t\tthis._currentTime=currentAniClipPlayDuration;\r\n\t\tthis._currentKeyframeIndex=Math.max(Math.floor(currentAniClipPlayDuration / cacheFrameInterval+0.01),0);\r\n\t\tthis._currentFrameTime=this._currentKeyframeIndex *cacheFrameInterval;\r\n\t\tthis._currentAnimationClipIndex=-1;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._update=function(elapsedTime){\r\n\t\tif (this._currentAnimationClipIndex===-1 || this._paused || !this._templet || !this._templet.loaded)\r\n\t\t\treturn;\r\n\t\tvar cacheFrameInterval=this._cacheFrameRateInterval *this._cachePlayRate;\r\n\t\tvar time=0;\r\n\t\t(this._startUpdateLoopCount!==Stat.loopCount)&& (time=elapsedTime *this.playbackRate,this._elapsedPlaybackTime+=time);\r\n\t\tvar currentAniClipPlayDuration=this.playDuration;\r\n\t\tif ((this._overallDuration!==0 && this._elapsedPlaybackTime >=this._overallDuration)|| (this._overallDuration===0 && this._elapsedPlaybackTime >=currentAniClipPlayDuration)){\r\n\t\t\tthis._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);\r\n\t\t\tthis.event(/*laya.events.Event.STOPPED*/\"stopped\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttime+=this._currentTime;\r\n\t\tif (currentAniClipPlayDuration > 0){\r\n\t\t\tif (time >=currentAniClipPlayDuration){\r\n\t\t\t\tdo {\r\n\t\t\t\t\ttime-=currentAniClipPlayDuration;\r\n\t\t\t\t\tif (this._stopWhenCircleFinish){\r\n\t\t\t\t\t\tthis._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);\r\n\t\t\t\t\t\tthis._stopWhenCircleFinish=false;\r\n\t\t\t\t\t\tthis.event(/*laya.events.Event.STOPPED*/\"stopped\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (time < currentAniClipPlayDuration){\r\n\t\t\t\t\t\tthis._setPlayParams(time,cacheFrameInterval);\r\n\t\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}while (time >=currentAniClipPlayDuration)\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._setPlayParams(time,cacheFrameInterval);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (this._stopWhenCircleFinish){\r\n\t\t\t\tthis._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);\r\n\t\t\t\tthis._stopWhenCircleFinish=false;\r\n\t\t\t\tthis.event(/*laya.events.Event.STOPPED*/\"stopped\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._destroy=function(){\r\n\t\tthis.offAll();\r\n\t\tthis._templet=null;\r\n\t\tthis._fullFrames=null;\r\n\t\tthis._destroyed=true;\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画。\r\n\t*@param index 动画索引。\r\n\t*@param playbackRate 播放速率。\r\n\t*@param duration 播放时长（0为1次,Number.MAX_VALUE为循环播放）。\r\n\t*@param playStart 播放的起始时间位置。\r\n\t*@param playEnd 播放的结束时间位置。（0为动画一次循环的最长结束时间位置）。\r\n\t*/\r\n\t__proto.play=function(index,playbackRate,overallDuration,playStart,playEnd){\r\n\t\t(index===void 0)&& (index=0);\r\n\t\t(playbackRate===void 0)&& (playbackRate=1.0);\r\n\t\t(overallDuration===void 0)&& (overallDuration=2147483647);\r\n\t\t(playStart===void 0)&& (playStart=0);\r\n\t\t(playEnd===void 0)&& (playEnd=0);\r\n\t\tif (!this._templet)\r\n\t\t\tthrow new Error(\"AnimationPlayer:templet must not be null,maybe you need to set url.\");\r\n\t\tif (overallDuration < 0 || playStart < 0 || playEnd < 0)\r\n\t\t\tthrow new Error(\"AnimationPlayer:overallDuration,playStart and playEnd must large than zero.\");\r\n\t\tif ((playEnd!==0)&& (playStart > playEnd))\r\n\t\t\tthrow new Error(\"AnimationPlayer:start must less than end.\");\r\n\t\tthis._currentTime=0;\r\n\t\tthis._currentFrameTime=0;\r\n\t\tthis._elapsedPlaybackTime=0;\r\n\t\tthis.playbackRate=playbackRate;\r\n\t\tthis._overallDuration=overallDuration;\r\n\t\tthis._playStart=playStart;\r\n\t\tthis._playEnd=playEnd;\r\n\t\tthis._paused=false;\r\n\t\tthis._currentAnimationClipIndex=index;\r\n\t\tthis._currentKeyframeIndex=0;\r\n\t\tthis._startUpdateLoopCount=Stat.loopCount;\r\n\t\tthis.event(/*laya.events.Event.PLAYED*/\"played\");\r\n\t\tif (this._templet.loaded)\r\n\t\t\tthis._calculatePlayDuration();\r\n\t\telse\r\n\t\tthis._templet.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._onAnimationTempletLoaded);\r\n\t\tthis._update(0);\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画。\r\n\t*@param index 动画索引。\r\n\t*@param playbackRate 播放速率。\r\n\t*@param duration 播放时长（0为1次,Number.MAX_VALUE为循环播放）。\r\n\t*@param playStartFrame 播放的原始起始帧率位置。\r\n\t*@param playEndFrame 播放的原始结束帧率位置。（0为动画一次循环的最长结束时间位置）。\r\n\t*/\r\n\t__proto.playByFrame=function(index,playbackRate,overallDuration,playStartFrame,playEndFrame,fpsIn3DBuilder){\r\n\t\t(index===void 0)&& (index=0);\r\n\t\t(playbackRate===void 0)&& (playbackRate=1.0);\r\n\t\t(overallDuration===void 0)&& (overallDuration=2147483647);\r\n\t\t(playStartFrame===void 0)&& (playStartFrame=0);\r\n\t\t(playEndFrame===void 0)&& (playEndFrame=0);\r\n\t\t(fpsIn3DBuilder===void 0)&& (fpsIn3DBuilder=30);\r\n\t\tvar interval=1000.0 / fpsIn3DBuilder;\r\n\t\tthis.play(index,playbackRate,overallDuration,playStartFrame *interval,playEndFrame *interval);\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放当前动画\r\n\t*@param immediate 是否立即停止\r\n\t*/\r\n\t__proto.stop=function(immediate){\r\n\t\t(immediate===void 0)&& (immediate=true);\r\n\t\tif (immediate){\r\n\t\t\tthis._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;\r\n\t\t\tthis._currentAnimationClipIndex=-1;\r\n\t\t\tthis.event(/*laya.events.Event.STOPPED*/\"stopped\");\r\n\t\t\t}else {\r\n\t\t\tthis._stopWhenCircleFinish=true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*动画播放的结束时间位置。\r\n\t*@return 结束时间位置。\r\n\t*/\r\n\t__getset(0,__proto,'playEnd',function(){\r\n\t\treturn this._playEnd;\r\n\t});\r\n\r\n\t/**\r\n\t*设置动画数据模板,注意：修改此值会有计算开销。\r\n\t*@param value 动画数据模板\r\n\t*/\r\n\t/**\r\n\t*获取动画数据模板\r\n\t*@param value 动画数据模板\r\n\t*/\r\n\t__getset(0,__proto,'templet',function(){\r\n\t\treturn this._templet;\r\n\t\t},function(value){\r\n\t\tif (!this.state===/*laya.ani.AnimationState.stopped*/0)\r\n\t\t\tthis.stop(true);\r\n\t\tif (this._templet!==value){\r\n\t\t\tthis._templet=value;\r\n\t\t\tif (value.loaded)\r\n\t\t\t\tthis._computeFullKeyframeIndices();\r\n\t\t\telse\r\n\t\t\tvalue.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*动画播放的起始时间位置。\r\n\t*@return 起始时间位置。\r\n\t*/\r\n\t__getset(0,__proto,'playStart',function(){\r\n\t\treturn this._playStart;\r\n\t});\r\n\r\n\t/**\r\n\t*获取动画播放一次的总时间\r\n\t*@return 动画播放一次的总时间\r\n\t*/\r\n\t__getset(0,__proto,'playDuration',function(){\r\n\t\treturn this._playDuration;\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前播放状态\r\n\t*@return 当前播放状态\r\n\t*/\r\n\t__getset(0,__proto,'state',function(){\r\n\t\tif (this._currentAnimationClipIndex===-1)\r\n\t\t\treturn /*laya.ani.AnimationState.stopped*/0;\r\n\t\tif (this._paused)\r\n\t\t\treturn /*laya.ani.AnimationState.paused*/1;\r\n\t\treturn /*laya.ani.AnimationState.playing*/2;\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前帧数\r\n\t*@return 当前帧数\r\n\t*/\r\n\t__getset(0,__proto,'currentKeyframeIndex',function(){\r\n\t\treturn this._currentKeyframeIndex;\r\n\t});\r\n\r\n\t/**\r\n\t*获取动画播放的总总时间\r\n\t*@return 动画播放的总时间\r\n\t*/\r\n\t__getset(0,__proto,'overallDuration',function(){\r\n\t\treturn this._overallDuration;\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前帧时间，不包括重播时间\r\n\t*@return value 当前时间\r\n\t*/\r\n\t__getset(0,__proto,'currentFrameTime',function(){\r\n\t\treturn this._currentFrameTime;\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前动画索引\r\n\t*@return value 当前动画索引\r\n\t*/\r\n\t__getset(0,__proto,'currentAnimationClipIndex',function(){\r\n\t\treturn this._currentAnimationClipIndex;\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前精确时间，不包括重播时间\r\n\t*@return value 当前时间\r\n\t*/\r\n\t__getset(0,__proto,'currentPlayTime',function(){\r\n\t\treturn this._currentTime+this._playStart;\r\n\t});\r\n\r\n\t/**\r\n\t*设置缓存播放速率,默认值为1.0,注意：修改此值会有计算开销。*\r\n\t*@return value 缓存播放速率。\r\n\t*/\r\n\t/**\r\n\t*获取缓存播放速率。*\r\n\t*@return 缓存播放速率。\r\n\t*/\r\n\t__getset(0,__proto,'cachePlayRate',function(){\r\n\t\treturn this._cachePlayRate;\r\n\t\t},function(value){\r\n\t\tif (this._cachePlayRate!==value){\r\n\t\t\tthis._cachePlayRate=value;\r\n\t\t\tif (this._templet)\r\n\t\t\t\tif (this._templet.loaded)\r\n\t\t\tthis._computeFullKeyframeIndices();\r\n\t\t\telse\r\n\t\t\tthis._templet.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._onTempletLoadedComputeFullKeyframeIndices,[value,this._cacheFrameRate]);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置默认帧率,每秒60帧,注意：修改此值会有计算开销。*\r\n\t*@return value 缓存帧率\r\n\t*/\r\n\t/**\r\n\t*获取默认帧率*\r\n\t*@return value 默认帧率\r\n\t*/\r\n\t__getset(0,__proto,'cacheFrameRate',function(){\r\n\t\treturn this._cacheFrameRate;\r\n\t\t},function(value){\r\n\t\tif (this._cacheFrameRate!==value){\r\n\t\t\tthis._cacheFrameRate=value;\r\n\t\t\tthis._cacheFrameRateInterval=1000.0 / this._cacheFrameRate;\r\n\t\t\tif (this._templet)\r\n\t\t\t\tif (this._templet.loaded)\r\n\t\t\tthis._computeFullKeyframeIndices();\r\n\t\t\telse\r\n\t\t\tthis._templet.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,value]);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置当前播放位置\r\n\t*@param value 当前时间\r\n\t*/\r\n\t__getset(0,__proto,'currentTime',null,function(value){\r\n\t\tif (this._currentAnimationClipIndex===-1 || !this._templet || !this._templet.loaded)\r\n\t\t\treturn;\r\n\t\tif (value < this._playStart || value > this._playEnd)\r\n\t\t\tthrow new Error(\"AnimationPlayer:value must large than playStartTime,small than playEndTime.\");\r\n\t\tthis._startUpdateLoopCount=Stat.loopCount;\r\n\t\tvar cacheFrameInterval=this._cacheFrameRateInterval *this._cachePlayRate;\r\n\t\tthis._currentTime=value;\r\n\t\tthis._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime / cacheFrameInterval),0);\r\n\t\tthis._currentFrameTime=this._currentKeyframeIndex *cacheFrameInterval;\r\n\t});\r\n\r\n\t/**\r\n\t*设置是否暂停\r\n\t*@param value 是否暂停\r\n\t*/\r\n\t/**\r\n\t*获取当前是否暂停\r\n\t*@return 是否暂停\r\n\t*/\r\n\t__getset(0,__proto,'paused',function(){\r\n\t\treturn this._paused;\r\n\t\t},function(value){\r\n\t\tthis._paused=value;\r\n\t\tvalue && this.event(/*laya.events.Event.PAUSED*/\"paused\");\r\n\t});\r\n\r\n\t/**\r\n\t*获取缓存帧率间隔时间\r\n\t*@return 缓存帧率间隔时间\r\n\t*/\r\n\t__getset(0,__proto,'cacheFrameRateInterval',function(){\r\n\t\treturn this._cacheFrameRateInterval;\r\n\t});\r\n\r\n\t/**\r\n\t*获取是否已销毁。\r\n\t*@return 是否已销毁。\r\n\t*/\r\n\t__getset(0,__proto,'destroyed',function(){\r\n\t\treturn this._destroyed;\r\n\t});\r\n\r\n\treturn AnimationPlayer;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.ani.GraphicsAni extends laya.display.Graphics\r\nvar GraphicsAni=(function(_super){\r\n\tfunction GraphicsAni(){\r\n\t\tGraphicsAni.__super.call(this);\r\n\t\tif (Render.isConchNode){\r\n\t\t\tthis[\"drawSkin\"]=function (skin){\r\n\t\t\t\tskin.transform || (skin.transform=Matrix.EMPTY);\r\n\t\t\t\tthis.setSkinMesh&&this.setSkinMesh(skin._ps,skin.mVBData,skin.mEleNum,0,skin.mTexture,skin.transform);\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\t__class(GraphicsAni,'laya.ani.GraphicsAni',_super);\r\n\tvar __proto=GraphicsAni.prototype;\r\n\t/**\r\n\t*@private\r\n\t*画自定义蒙皮动画\r\n\t*@param skin\r\n\t*/\r\n\t__proto.drawSkin=function(skin){\r\n\t\tvar arr=[skin];\r\n\t\tthis._saveToCmd(Render._context._drawSkin,arr);\r\n\t}\r\n\r\n\treturn GraphicsAni;\r\n})(Graphics)\r\n\r\n\r\n/**\r\n*@private\r\n*Canvas版本的SkinMesh\r\n*/\r\n//class laya.ani.bone.canvasmesh.SkinMeshCanvas extends laya.ani.bone.canvasmesh.CanvasMeshRender\r\nvar SkinMeshCanvas=(function(_super){\r\n\tfunction SkinMeshCanvas(){\r\n\t\tSkinMeshCanvas.__super.call(this);\r\n\t\tthis.mesh=new MeshData();\r\n\t}\r\n\r\n\t__class(SkinMeshCanvas,'laya.ani.bone.canvasmesh.SkinMeshCanvas',_super);\r\n\tvar __proto=SkinMeshCanvas.prototype;\r\n\t__proto.init2=function(texture,vs,ps,verticles,uvs){\r\n\t\tif (this.transform){\r\n\t\t\tthis.transform=null;\r\n\t\t};\r\n\t\tvar _ps;\r\n\t\tif (ps){\r\n\t\t\t_ps=ps;\r\n\t\t\t}else {\r\n\t\t\t_ps=[];\r\n\t\t\t_ps.push(0,1,3,3,1,2);\r\n\t\t}\r\n\t\tthis.mesh.texture=texture;\r\n\t\tthis.mesh.indexes=_ps;\r\n\t\tthis.mesh.vertices=verticles;\r\n\t\tthis.mesh.uvs=uvs;\r\n\t}\r\n\r\n\t__proto.render=function(context,x,y){\r\n\t\tif(!this.mesh.texture)return;\r\n\t\tif(!this.transform){\r\n\t\t\tthis.transform=SkinMeshCanvas._tempMatrix;\r\n\t\t\tthis.transform.identity();\r\n\t\t\tthis.transform.translate(x,y);\r\n\t\t\tthis.renderToContext(context);\r\n\t\t\tthis.transform.translate(-x,-y);\r\n\t\t\tthis.transform=null;\r\n\t\t\t}else{\r\n\t\t\tthis.transform.translate(x,y);\r\n\t\t\tthis.renderToContext(context);\r\n\t\t\tthis.transform.translate(-x,-y);\r\n\t\t}\r\n\t}\r\n\r\n\t__static(SkinMeshCanvas,\r\n\t['_tempMatrix',function(){return this._tempMatrix=new Matrix();}\r\n\t]);\r\n\treturn SkinMeshCanvas;\r\n})(CanvasMeshRender)\r\n\r\n\r\n/**\r\n*<code>AnimationTemplet</code> 类用于动画模板资源。\r\n*/\r\n//class laya.ani.AnimationTemplet extends laya.resource.Resource\r\nvar AnimationTemplet=(function(_super){\r\n\tfunction AnimationTemplet(){\r\n\t\t/**@private */\r\n\t\t//this._aniVersion=null;\r\n\t\t/**@private */\r\n\t\tthis._aniMap={};\r\n\t\t/**@private */\r\n\t\t//this._publicExtData=null;\r\n\t\t/**@private */\r\n\t\t//this._useParent=false;\r\n\t\t/**@private */\r\n\t\t//this.unfixedCurrentFrameIndexes=null;\r\n\t\t/**@private */\r\n\t\t//this.unfixedCurrentTimes=null;\r\n\t\t/**@private */\r\n\t\t//this.unfixedKeyframes=null;\r\n\t\t/**@private */\r\n\t\tthis.unfixedLastAniIndex=-1;\r\n\t\t/**@private */\r\n\t\t//this._aniClassName=null;\r\n\t\t/**@private */\r\n\t\t//this._animationDatasCache=null;\r\n\t\tAnimationTemplet.__super.call(this);\r\n\t\tthis._anis=new Array;\r\n\t}\r\n\r\n\t__class(AnimationTemplet,'laya.ani.AnimationTemplet',_super);\r\n\tvar __proto=AnimationTemplet.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.parse=function(data){\r\n\t\tvar reader=new Byte(data);\r\n\t\tthis._aniVersion=reader.readUTFString();\r\n\t\tAnimationParser01.parse(this,reader);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._calculateKeyFrame=function(node,keyframeCount,keyframeDataCount){\r\n\t\tvar keyFrames=node.keyFrame;\r\n\t\tkeyFrames[keyframeCount]=keyFrames[0];\r\n\t\tfor (var i=0;i < keyframeCount;i++){\r\n\t\t\tvar keyFrame=keyFrames[i];\r\n\t\t\tkeyFrame.nextData=(keyFrame.duration===0)? keyFrame.data :keyFrames[i+1].data;\r\n\t\t}\r\n\t\tkeyFrames.length--;\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.onAsynLoaded=function(url,data,params){\r\n\t\tvar reader=new Byte(data);\r\n\t\tthis._aniVersion=reader.readUTFString();\r\n\t\tswitch (this._aniVersion){\r\n\t\t\tcase \"LAYAANIMATION:02\":\r\n\t\t\t\tAnimationParser02.parse(this,reader);\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tAnimationParser01.parse(this,reader);\r\n\t\t\t}\r\n\t\tthis._endLoaded();\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.disposeResource=function(){\r\n\t\tthis._aniVersion=null;\r\n\t\tthis._anis=null;\r\n\t\tthis._aniMap=null;\r\n\t\tthis._publicExtData=null;\r\n\t\tthis.unfixedCurrentFrameIndexes=null;\r\n\t\tthis.unfixedCurrentTimes=null;\r\n\t\tthis.unfixedKeyframes=null;\r\n\t\tthis._aniClassName=null;\r\n\t\tthis._animationDatasCache=null;\r\n\t}\r\n\r\n\t__proto.getAnimationCount=function(){\r\n\t\treturn this._anis.length;\r\n\t}\r\n\r\n\t__proto.getAnimation=function(aniIndex){\r\n\t\treturn this._anis[aniIndex];\r\n\t}\r\n\r\n\t__proto.getAniDuration=function(aniIndex){\r\n\t\treturn this._anis[aniIndex].playTime;\r\n\t}\r\n\r\n\t__proto.getNodes=function(aniIndex){\r\n\t\treturn this._anis[aniIndex].nodes;\r\n\t}\r\n\r\n\t__proto.getNodeIndexWithName=function(aniIndex,name){\r\n\t\treturn this._anis[aniIndex].bone3DMap[name];\r\n\t}\r\n\r\n\t__proto.getNodeCount=function(aniIndex){\r\n\t\treturn this._anis[aniIndex].nodes.length;\r\n\t}\r\n\r\n\t__proto.getTotalkeyframesLength=function(aniIndex){\r\n\t\treturn this._anis[aniIndex].totalKeyframeDatasLength;\r\n\t}\r\n\r\n\t__proto.getPublicExtData=function(){\r\n\t\treturn this._publicExtData;\r\n\t}\r\n\r\n\t__proto.getAnimationDataWithCache=function(key,cacheDatas,aniIndex,frameIndex){\r\n\t\tvar aniDatas=cacheDatas[aniIndex];\r\n\t\tif (!aniDatas){\r\n\t\t\treturn null;\r\n\t\t\t}else {\r\n\t\t\tvar keyDatas=aniDatas[key];\r\n\t\t\tif (!keyDatas)\r\n\t\t\t\treturn null;\r\n\t\t\telse {\r\n\t\t\t\treturn keyDatas[frameIndex];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setAnimationDataWithCache=function(key,cacheDatas,aniIndex,frameIndex,data){\r\n\t\tvar aniDatas=(cacheDatas[aniIndex])|| (cacheDatas[aniIndex]={});\r\n\t\tvar aniDatasCache=(aniDatas[key])|| (aniDatas[key]=[]);\r\n\t\taniDatasCache[frameIndex]=data;\r\n\t}\r\n\r\n\t__proto.getOriginalData=function(aniIndex,originalData,nodesFrameIndices,frameIndex,playCurTime){\r\n\t\tvar oneAni=this._anis[aniIndex];\r\n\t\tvar nodes=oneAni.nodes;\r\n\t\tvar j=0;\r\n\t\tfor (var i=0,n=nodes.length,outOfs=0;i < n;i++){\r\n\t\t\tvar node=nodes[i];\r\n\t\t\tvar key;\r\n\t\t\tkey=node.keyFrame[nodesFrameIndices[i][frameIndex]];\r\n\t\t\tnode.dataOffset=outOfs;\r\n\t\t\tvar dt=playCurTime-key.startTime;\r\n\t\t\tvar lerpType=node.lerpType;\r\n\t\t\tif (lerpType){\r\n\t\t\t\tswitch (lerpType){\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tfor (j=0;j < node.keyframeWidth;)\r\n\t\t\t\t\t\tj+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase 2:;\r\n\t\t\t\t\t\tvar interpolationData=key.interpolationData;\r\n\t\t\t\t\t\tvar interDataLen=interpolationData.length;\r\n\t\t\t\t\t\tvar dataIndex=0;\r\n\t\t\t\t\t\tfor (j=0;j < interDataLen;){\r\n\t\t\t\t\t\t\tvar type=interpolationData[j];\r\n\t\t\t\t\t\tswitch (type){\r\n\t\t\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tdefault :\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdataIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (j=0;j < node.keyframeWidth;)\r\n\t\t\t\tj+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t}\r\n\t\t\toutOfs+=node.keyframeWidth;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getNodesCurrentFrameIndex=function(aniIndex,playCurTime){\r\n\t\tvar ani=this._anis[aniIndex];\r\n\t\tvar nodes=ani.nodes;\r\n\t\tif (aniIndex!==this.unfixedLastAniIndex){\r\n\t\t\tthis.unfixedCurrentFrameIndexes=new Uint32Array(nodes.length);\r\n\t\t\tthis.unfixedCurrentTimes=new Float32Array(nodes.length);\r\n\t\t\tthis.unfixedLastAniIndex=aniIndex;\r\n\t\t}\r\n\t\tfor (var i=0,n=nodes.length,outOfs=0;i < n;i++){\r\n\t\t\tvar node=nodes[i];\r\n\t\t\tif (playCurTime < this.unfixedCurrentTimes[i])\r\n\t\t\t\tthis.unfixedCurrentFrameIndexes[i]=0;\r\n\t\t\tthis.unfixedCurrentTimes[i]=playCurTime;\r\n\t\t\twhile ((this.unfixedCurrentFrameIndexes[i] < node.keyFrame.length)){\r\n\t\t\t\tif (node.keyFrame[this.unfixedCurrentFrameIndexes[i]].startTime > this.unfixedCurrentTimes[i])\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tthis.unfixedCurrentFrameIndexes[i]++;\r\n\t\t\t}\r\n\t\t\tthis.unfixedCurrentFrameIndexes[i]--;\r\n\t\t}\r\n\t\treturn this.unfixedCurrentFrameIndexes;\r\n\t}\r\n\r\n\t__proto.getOriginalDataUnfixedRate=function(aniIndex,originalData,playCurTime){\r\n\t\tvar oneAni=this._anis[aniIndex];\r\n\t\tvar nodes=oneAni.nodes;\r\n\t\tif (aniIndex!==this.unfixedLastAniIndex){\r\n\t\t\tthis.unfixedCurrentFrameIndexes=new Uint32Array(nodes.length);\r\n\t\t\tthis.unfixedCurrentTimes=new Float32Array(nodes.length);\r\n\t\t\tthis.unfixedKeyframes=__newvec(nodes.length);\r\n\t\t\tthis.unfixedLastAniIndex=aniIndex;\r\n\t\t};\r\n\t\tvar j=0;\r\n\t\tfor (var i=0,n=nodes.length,outOfs=0;i < n;i++){\r\n\t\t\tvar node=nodes[i];\r\n\t\t\tif (playCurTime < this.unfixedCurrentTimes[i])\r\n\t\t\t\tthis.unfixedCurrentFrameIndexes[i]=0;\r\n\t\t\tthis.unfixedCurrentTimes[i]=playCurTime;\r\n\t\t\twhile (this.unfixedCurrentFrameIndexes[i] < node.keyFrame.length){\r\n\t\t\t\tif (node.keyFrame[this.unfixedCurrentFrameIndexes[i]].startTime > this.unfixedCurrentTimes[i])\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tthis.unfixedKeyframes[i]=node.keyFrame[this.unfixedCurrentFrameIndexes[i]];\r\n\t\t\t\tthis.unfixedCurrentFrameIndexes[i]++;\r\n\t\t\t};\r\n\t\t\tvar key=this.unfixedKeyframes[i];\r\n\t\t\tnode.dataOffset=outOfs;\r\n\t\t\tvar dt=playCurTime-key.startTime;\r\n\t\t\tvar lerpType=node.lerpType;\r\n\t\t\tif (lerpType){\r\n\t\t\t\tswitch (node.lerpType){\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\tfor (j=0;j < node.keyframeWidth;)\r\n\t\t\t\t\t\tj+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase 2:;\r\n\t\t\t\t\t\tvar interpolationData=key.interpolationData;\r\n\t\t\t\t\t\tvar interDataLen=interpolationData.length;\r\n\t\t\t\t\t\tvar dataIndex=0;\r\n\t\t\t\t\t\tfor (j=0;j < interDataLen;){\r\n\t\t\t\t\t\t\tvar type=interpolationData[j];\r\n\t\t\t\t\t\tswitch (type){\r\n\t\t\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tdefault :\r\n\t\t\t\t\t\t\t\tj+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdataIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (j=0;j < node.keyframeWidth;)\r\n\t\t\t\tj+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);\r\n\t\t\t}\r\n\t\t\toutOfs+=node.keyframeWidth;\r\n\t\t}\r\n\t}\r\n\r\n\tAnimationTemplet._LinearInterpolation_0=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\tvar amount=duration===0 ? 0 :dt / duration;\r\n\t\tout[outOfs]=(1.0-amount)*data[index]+amount *nextData[index];\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tAnimationTemplet._QuaternionInterpolation_1=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\tvar amount=duration===0 ? 0 :dt / duration;\r\n\t\tMathUtil.slerpQuaternionArray(data,index,nextData,index,amount,out,outOfs);\r\n\t\treturn 4;\r\n\t}\r\n\r\n\tAnimationTemplet._AngleInterpolation_2=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tAnimationTemplet._RadiansInterpolation_3=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tAnimationTemplet._Matrix4x4Interpolation_4=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\tfor (var i=0;i < 16;i++,index++)\r\n\t\tout[outOfs+i]=data[index]+dt *dData[index];\r\n\t\treturn 16;\r\n\t}\r\n\r\n\tAnimationTemplet._NoInterpolation_5=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){\r\n\t\tout[outOfs]=data[index];\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tAnimationTemplet._BezierInterpolation_6=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\tout[outOfs]=data[index]+(nextData[index]-data[index])*BezierLerp.getBezierRate(dt / duration,interData[offset],interData[offset+1],interData[offset+2],interData[offset+3]);\r\n\t\treturn 5;\r\n\t}\r\n\r\n\tAnimationTemplet._BezierInterpolation_7=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\tout[outOfs]=interData[offset+4]+interData[offset+5] *BezierLerp.getBezierRate((dt *0.001+interData[offset+6])/ interData[offset+7],interData[offset],interData[offset+1],interData[offset+2],interData[offset+3]);\r\n\t\treturn 9;\r\n\t}\r\n\r\n\tAnimationTemplet.load=function(url){\r\n\t\treturn Laya.loader.create(url,null,null,AnimationTemplet);\r\n\t}\r\n\r\n\t__static(AnimationTemplet,\r\n\t['interpolation',function(){return this.interpolation=[AnimationTemplet._LinearInterpolation_0,AnimationTemplet._QuaternionInterpolation_1,AnimationTemplet._AngleInterpolation_2,AnimationTemplet._RadiansInterpolation_3,AnimationTemplet._Matrix4x4Interpolation_4,AnimationTemplet._NoInterpolation_5,AnimationTemplet._BezierInterpolation_6,AnimationTemplet._BezierInterpolation_7];}\r\n\t]);\r\n\treturn AnimationTemplet;\r\n})(Resource)\r\n\r\n\r\n/**\r\n*@private\r\n*将mesh元素缓存到canvas中并进行绘制\r\n*/\r\n//class laya.ani.bone.canvasmesh.CacheAbleSkinMesh extends laya.ani.bone.canvasmesh.SkinMeshCanvas\r\nvar CacheAbleSkinMesh=(function(_super){\r\n\tfunction CacheAbleSkinMesh(){\r\n\t\tthis.isCached=false;\r\n\t\tthis.canvas=null;\r\n\t\tthis.tex=null;\r\n\t\tthis.rec=null;\r\n\t\tCacheAbleSkinMesh.__super.call(this);\r\n\t}\r\n\r\n\t__class(CacheAbleSkinMesh,'laya.ani.bone.canvasmesh.CacheAbleSkinMesh',_super);\r\n\tvar __proto=CacheAbleSkinMesh.prototype;\r\n\t__proto.getCanvasPic=function(){\r\n\t\tvar canvas=new HTMLCanvas(\"2D\");\r\n\t\tvar ctx=canvas.getContext('2d');\r\n\t\tthis.rec=this.mesh.getBounds();\r\n\t\tdebugger;\r\n\t\tcanvas.size(this.rec.width,this.rec.height);\r\n\t\tvar preTransform;\r\n\t\tpreTransform=this.transform;\r\n\t\tthis.transform=CacheAbleSkinMesh.tempMt;\r\n\t\tthis.transform.identity();\r\n\t\tthis.transform.translate(-this.rec.x,-this.rec.y);\r\n\t\tthis.renderToContext(ctx);\r\n\t\tthis.transform.translate(+this.rec.x,+this.rec.y);\r\n\t\tthis.transform=preTransform;\r\n\t\treturn new Texture(canvas);\r\n\t}\r\n\r\n\t__proto.render=function(context,x,y){\r\n\t\tif (!this.mesh.texture)return;\r\n\t\tif (!this.isCached){\r\n\t\t\tthis.isCached=true;\r\n\t\t\tthis.tex=this.getCanvasPic();\r\n\t\t}\r\n\t\tif(!this.transform){\r\n\t\t\tthis.transform=SkinMeshCanvas._tempMatrix;\r\n\t\t\tthis.transform.identity();\r\n\t\t\tthis.transform.translate(x,y);\r\n\t\t\tthis._renderTextureToContext(context);\r\n\t\t\tthis.transform.translate(-x,-y);\r\n\t\t\tthis.transform=null;\r\n\t\t\t}else{\r\n\t\t\tthis.transform.translate(x,y);\r\n\t\t\tthis._renderTextureToContext(context);\r\n\t\t\tthis.transform.translate(-x,-y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._renderTextureToContext=function(context){\r\n\t\tthis.context=context.ctx || context;\r\n\t\tcontext.save();\r\n\t\tvar texture;\r\n\t\ttexture=this.tex;\r\n\t\tif (this.transform){\r\n\t\t\tvar mt=this.transform;\r\n\t\t\tcontext.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);\r\n\t\t}\r\n\t\tthis.rec=this.mesh.getBounds();\r\n\t\tcontext.translate(this.rec.x,this.rec.y);\r\n\t\tcontext.drawTexture(texture,0,0,texture.width,texture.height,0,0);\r\n\t\tcontext.restore();\r\n\t}\r\n\r\n\t__static(CacheAbleSkinMesh,\r\n\t['tempMt',function(){return this.tempMt=new Matrix();}\r\n\t]);\r\n\treturn CacheAbleSkinMesh;\r\n})(SkinMeshCanvas)\r\n\r\n\r\n/**\r\n*@private\r\n*简化mesh绘制，多顶点mesh改为四顶点mesh，只绘制矩形不绘制三角形\r\n*/\r\n//class laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas extends laya.ani.bone.canvasmesh.SkinMeshCanvas\r\nvar SimpleSkinMeshCanvas=(function(_super){\r\n\tfunction SimpleSkinMeshCanvas(){\r\n\t\t/**\r\n\t\t*当前mesh数据是否可用\r\n\t\t*/\r\n\t\tthis.cacheOK=false;\r\n\t\t/**\r\n\t\t*当前渲染数据是否可用\r\n\t\t*/\r\n\t\tthis.cacheCmdOK=false;\r\n\t\t/**\r\n\t\t*transform参数缓存\r\n\t\t*/\r\n\t\tthis.transformCmds=[];\r\n\t\t/**\r\n\t\t*drawImage参数缓存\r\n\t\t*/\r\n\t\tthis.drawCmds=[]\r\n\t\tSimpleSkinMeshCanvas.__super.call(this);\r\n\t\tthis.tempMesh=new MeshData();\r\n\t}\r\n\r\n\t__class(SimpleSkinMeshCanvas,'laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas',_super);\r\n\tvar __proto=SimpleSkinMeshCanvas.prototype;\r\n\t__proto.init2=function(texture,vs,ps,verticles,uvs){\r\n\t\t_super.prototype.init2.call(this,texture,vs,ps,verticles,uvs);\r\n\t\tthis.cacheOK=false;\r\n\t\tthis.cacheCmdOK=false;\r\n\t\tthis.transformCmds.length=6;\r\n\t\tthis.drawCmds.length=9;\r\n\t}\r\n\r\n\t__proto.renderToContext=function(context){\r\n\t\tthis.context=context.ctx || context;\r\n\t\tif (this.mesh){\r\n\t\t\tif (this.mesh.uvs.length <=8){\r\n\t\t\t\tif (this.mode==0){\r\n\t\t\t\t\tthis._renderWithIndexes(this.mesh);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._renderNoIndexes(this.mesh);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!this.cacheOK){\r\n\t\t\t\tthis.tempMesh.texture=this.mesh.texture;\r\n\t\t\t\tthis.tempMesh.uvs=this.mesh.texture.uv;\r\n\t\t\t\tthis.tempMesh.vertices=MeshTools.solveMesh(this.mesh,this.tempMesh.vertices);\r\n\t\t\t\tthis.cacheOK=true;\r\n\t\t\t}\r\n\t\t\tif (this.mode==0){\r\n\t\t\t\tthis._renderWithIndexes(this.tempMesh);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._renderNoIndexes(this.tempMesh);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._renderWithIndexes=function(mesh){\r\n\t\tif(this.cacheCmdOK){\r\n\t\t\tthis.renderByCache(mesh);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar indexes=mesh.indexes;\r\n\t\tvar i=0,len=indexes.length;\r\n\t\tif (len > 1)\r\n\t\t\tlen=1;\r\n\t\tfor (i=0;i < len;i+=3){\r\n\t\t\tvar index0=indexes[i] *2;\r\n\t\t\tvar index1=indexes[i+1] *2;\r\n\t\t\tvar index2=indexes[i+2] *2;\r\n\t\t\tthis._renderDrawTriangle(mesh,index0,index1,index2);\r\n\t\t}\r\n\t\tthis.cacheCmdOK=true;\r\n\t}\r\n\r\n\t__proto._renderDrawTriangle=function(mesh,index0,index1,index2){\r\n\t\tvar context=this.context;\r\n\t\tvar uvs=mesh.uvs;\r\n\t\tvar vertices=mesh.vertices;\r\n\t\tvar texture=mesh.texture;\r\n\t\tvar source=texture.bitmap;\r\n\t\tvar textureSource=source.source;\r\n\t\tvar textureWidth=texture.width;\r\n\t\tvar textureHeight=texture.height;\r\n\t\tvar sourceWidth=source.width;\r\n\t\tvar sourceHeight=source.height;\r\n\t\tvar u0=NaN;\r\n\t\tvar u1=NaN;\r\n\t\tvar u2=NaN;\r\n\t\tvar v0=NaN;\r\n\t\tvar v1=NaN;\r\n\t\tvar v2=NaN;\r\n\t\tif (mesh.useUvTransform){\r\n\t\t\tvar ut=mesh.uvTransform;\r\n\t\t\tu0=((uvs[index0] *ut.a)+(uvs[index0+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tu1=((uvs[index1] *ut.a)+(uvs[index1+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tu2=((uvs[index2] *ut.a)+(uvs[index2+1] *ut.c)+ut.tx)*sourceWidth;\r\n\t\t\tv0=((uvs[index0] *ut.b)+(uvs[index0+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t\tv1=((uvs[index1] *ut.b)+(uvs[index1+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t\tv2=((uvs[index2] *ut.b)+(uvs[index2+1] *ut.d)+ut.ty)*sourceHeight;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tu0=uvs[index0] *sourceWidth;\r\n\t\t\tu1=uvs[index1] *sourceWidth;\r\n\t\t\tu2=uvs[index2] *sourceWidth;\r\n\t\t\tv0=uvs[index0+1] *sourceHeight;\r\n\t\t\tv1=uvs[index1+1] *sourceHeight;\r\n\t\t\tv2=uvs[index2+1] *sourceHeight;\r\n\t\t};\r\n\t\tvar x0=vertices[index0];\r\n\t\tvar x1=vertices[index1];\r\n\t\tvar x2=vertices[index2];\r\n\t\tvar y0=vertices[index0+1];\r\n\t\tvar y1=vertices[index1+1];\r\n\t\tvar y2=vertices[index2+1];\r\n\t\tvar delta=(u0 *v1)+(v0 *u2)+(u1 *v2)-(v1 *u2)-(v0 *u1)-(u0 *v2);\r\n\t\tvar dDelta=1 / delta;\r\n\t\tvar deltaA=(x0 *v1)+(v0 *x2)+(x1 *v2)-(v1 *x2)-(v0 *x1)-(x0 *v2);\r\n\t\tvar deltaB=(u0 *x1)+(x0 *u2)+(u1 *x2)-(x1 *u2)-(x0 *u1)-(u0 *x2);\r\n\t\tvar deltaC=(u0 *v1 *x2)+(v0 *x1 *u2)+(x0 *u1 *v2)-(x0 *v1 *u2)-(v0 *u1 *x2)-(u0 *x1 *v2);\r\n\t\tvar deltaD=(y0 *v1)+(v0 *y2)+(y1 *v2)-(v1 *y2)-(v0 *y1)-(y0 *v2);\r\n\t\tvar deltaE=(u0 *y1)+(y0 *u2)+(u1 *y2)-(y1 *u2)-(y0 *u1)-(u0 *y2);\r\n\t\tvar deltaF=(u0 *v1 *y2)+(v0 *y1 *u2)+(y0 *u1 *v2)-(y0 *v1 *u2)-(v0 *u1 *y2)-(u0 *y1 *v2);\r\n\t\tthis.transformCmds[0]=deltaA *dDelta;\r\n\t\tthis.transformCmds[1]=deltaD *dDelta;\r\n\t\tthis.transformCmds[2]=deltaB *dDelta;\r\n\t\tthis.transformCmds[3]=deltaE *dDelta;\r\n\t\tthis.transformCmds[4]=deltaC *dDelta;\r\n\t\tthis.transformCmds[5]=deltaF *dDelta;\r\n\t\tthis.drawCmds[0]=textureSource;\r\n\t\tthis.drawCmds[1]=texture.uv[0] *sourceWidth;\r\n\t\tthis.drawCmds[2]=texture.uv[1] *sourceHeight;\r\n\t\tthis.drawCmds[3]=textureWidth;\r\n\t\tthis.drawCmds[4]=textureHeight;\r\n\t\tthis.drawCmds[5]=texture.uv[0] *sourceWidth;\r\n\t\tthis.drawCmds[6]=texture.uv[1] *sourceHeight;\r\n\t\tthis.drawCmds[7]=textureWidth;\r\n\t\tthis.drawCmds[8]=textureHeight;\r\n\t\tcontext.save();\r\n\t\tif (this.transform){\r\n\t\t\tvar mt=this.transform;\r\n\t\t\tcontext.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);\r\n\t\t}\r\n\t\tcontext.transform.apply(context,this.transformCmds);\r\n\t\tcontext.drawImage.apply(context,this.drawCmds);\r\n\t\tcontext.restore();\r\n\t}\r\n\r\n\t/**\r\n\t*绘制缓存的命令\r\n\t*@param mesh\r\n\t*\r\n\t*/\r\n\t__proto.renderByCache=function(mesh){\r\n\t\tvar context=this.context;\r\n\t\tcontext.save();\r\n\t\tif (this.transform){\r\n\t\t\tvar mt=this.transform;\r\n\t\t\tcontext.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);\r\n\t\t}\r\n\t\tcontext.transform.apply(context,this.transformCmds);\r\n\t\tcontext.drawImage.apply(context,this.drawCmds);\r\n\t\tcontext.restore();\r\n\t}\r\n\r\n\treturn SimpleSkinMeshCanvas;\r\n})(SkinMeshCanvas)\r\n\r\n\r\n/**\r\n*骨骼动画由<code>Templet</code>，<code>AnimationPlayer</code>，<code>Skeleton</code>三部分组成。\r\n*/\r\n//class laya.ani.bone.Skeleton extends laya.display.Sprite\r\nvar Skeleton=(function(_super){\r\n\tfunction Skeleton(templet,aniMode){\r\n\t\tthis._templet=null;\r\n\t\t/**@private */\r\n\t\tthis._player=null;\r\n\t\t/**@private */\r\n\t\tthis._curOriginalData=null;\r\n\t\t//当前骨骼的偏移数据\r\n\t\tthis._boneMatrixArray=[];\r\n\t\t//当前骨骼动画的最终结果数据\r\n\t\tthis._lastTime=0;\r\n\t\t//上次的帧时间\r\n\t\tthis._currAniName=null;\r\n\t\tthis._currAniIndex=-1;\r\n\t\tthis._pause=true;\r\n\t\t/**@private */\r\n\t\tthis._aniClipIndex=-1;\r\n\t\t/**@private */\r\n\t\tthis._clipIndex=-1;\r\n\t\tthis._skinIndex=0;\r\n\t\tthis._skinName=\"default\";\r\n\t\tthis._aniMode=0;\r\n\t\t//当前动画自己的缓冲区\r\n\t\tthis._graphicsCache=null;\r\n\t\tthis._boneSlotDic=null;\r\n\t\tthis._bindBoneBoneSlotDic=null;\r\n\t\tthis._boneSlotArray=null;\r\n\t\tthis._index=-1;\r\n\t\tthis._total=-1;\r\n\t\tthis._indexControl=false;\r\n\t\t//加载路径\r\n\t\tthis._aniPath=null;\r\n\t\tthis._texturePath=null;\r\n\t\tthis._complete=null;\r\n\t\tthis._loadAniMode=0;\r\n\t\tthis._yReverseMatrix=null;\r\n\t\tthis._ikArr=null;\r\n\t\tthis._tfArr=null;\r\n\t\tthis._pathDic=null;\r\n\t\tthis._rootBone=null;\r\n\t\t/**@private */\r\n\t\tthis._boneList=null;\r\n\t\t/**@private */\r\n\t\tthis._aniSectionDic=null;\r\n\t\tthis._eventIndex=0;\r\n\t\tthis._drawOrderIndex=0;\r\n\t\tthis._drawOrder=null;\r\n\t\tthis._lastAniClipIndex=-1;\r\n\t\tthis._lastUpdateAniClipIndex=-1;\r\n\t\tSkeleton.__super.call(this);\r\n\t\t(aniMode===void 0)&& (aniMode=0);\r\n\t\tif (templet)this.init(templet,aniMode);\r\n\t}\r\n\r\n\t__class(Skeleton,'laya.ani.bone.Skeleton',_super);\r\n\tvar __proto=Skeleton.prototype;\r\n\t/**\r\n\t*初始化动画\r\n\t*@param templet 模板\r\n\t*@param aniMode 动画模式\r\n\t*<table>\r\n\t*<tr><th>模式</th><th>描述</th></tr>\r\n\t*<tr>\r\n\t*<td>0</td> <td>使用模板缓冲的数据，模板缓冲的数据，不允许修改（内存开销小，计算开销小，不支持换装）</td>\r\n\t*</tr>\r\n\t*<tr>\r\n\t*<td>1</td> <td>使用动画自己的缓冲区，每个动画都会有自己的缓冲区，相当耗费内存 （内存开销大，计算开销小，支持换装）</td>\r\n\t*</tr>\r\n\t*<tr>\r\n\t*<td>2</td> <td>使用动态方式，去实时去画（内存开销小，计算开销大，支持换装,不建议使用）</td>\r\n\t*</tr>\r\n\t*</table>\r\n\t*/\r\n\t__proto.init=function(templet,aniMode){\r\n\t\t(aniMode===void 0)&& (aniMode=0);\r\n\t\tvar i=0,n=0;\r\n\t\tif (aniMode==1){\r\n\t\t\tthis._graphicsCache=[];\r\n\t\t\tfor (i=0,n=templet.getAnimationCount();i < n;i++){\r\n\t\t\t\tthis._graphicsCache.push([]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._yReverseMatrix=templet.yReverseMatrix;\r\n\t\tthis._aniMode=aniMode;\r\n\t\tthis._templet=templet;\r\n\t\tthis._player=new AnimationPlayer();\r\n\t\tthis._player.cacheFrameRate=templet.rate;\r\n\t\tthis._player.templet=templet;\r\n\t\tthis._player.play();\r\n\t\tthis._parseSrcBoneMatrix();\r\n\t\tthis._boneList=templet.mBoneArr;\r\n\t\tthis._rootBone=templet.mRootBone;\r\n\t\tthis._aniSectionDic=templet.aniSectionDic;\r\n\t\tif (templet.ikArr.length > 0){\r\n\t\t\tthis._ikArr=[];\r\n\t\t\tfor (i=0,n=templet.ikArr.length;i < n;i++){\r\n\t\t\t\tthis._ikArr.push(new IkConstraint(templet.ikArr[i],this._boneList));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (templet.pathArr.length > 0){\r\n\t\t\tvar tPathData;\r\n\t\t\tvar tPathConstraint;\r\n\t\t\tif (this._pathDic==null)this._pathDic={};\r\n\t\t\tvar tBoneSlot;\r\n\t\t\tfor (i=0,n=templet.pathArr.length;i < n;i++){\r\n\t\t\t\ttPathData=templet.pathArr[i];\r\n\t\t\t\ttPathConstraint=new PathConstraint(tPathData,this._boneList);\r\n\t\t\t\ttBoneSlot=this._boneSlotDic[tPathData.name];\r\n\t\t\t\tif (tBoneSlot){\r\n\t\t\t\t\ttPathConstraint=new PathConstraint(tPathData,this._boneList);\r\n\t\t\t\t\ttPathConstraint.target=tBoneSlot;\r\n\t\t\t\t}\r\n\t\t\t\tthis._pathDic[tPathData.name]=tPathConstraint;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (templet.tfArr.length > 0){\r\n\t\t\tthis._tfArr=[];\r\n\t\t\tfor (i=0,n=templet.tfArr.length;i < n;i++){\r\n\t\t\t\tthis._tfArr.push(new TfConstraint(templet.tfArr[i],this._boneList));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (templet.skinDataArray.length > 0){\r\n\t\t\tvar tSkinData=this._templet.skinDataArray[this._skinIndex];\r\n\t\t\tthis._skinName=tSkinData.name;\r\n\t\t}\r\n\t\tthis._player.on(/*laya.events.Event.PLAYED*/\"played\",this,this._onPlay);\r\n\t\tthis._player.on(/*laya.events.Event.STOPPED*/\"stopped\",this,this._onStop);\r\n\t\tthis._player.on(/*laya.events.Event.PAUSED*/\"paused\",this,this._onPause);\r\n\t}\r\n\r\n\t/**\r\n\t*通过加载直接创建动画\r\n\t*@param path 要加载的动画文件路径\r\n\t*@param complete 加载完成的回调函数\r\n\t*@param aniMode 与<code>Skeleton.init</code>的<code>aniMode</code>作用一致\r\n\t*/\r\n\t__proto.load=function(path,complete,aniMode){\r\n\t\t(aniMode===void 0)&& (aniMode=0);\r\n\t\tthis._aniPath=path;\r\n\t\tthis._complete=complete;\r\n\t\tthis._loadAniMode=aniMode;\r\n\t\tLaya.loader.load([{url:path,type:/*laya.net.Loader.BUFFER*/\"arraybuffer\"}],Handler.create(this,this._onLoaded));\r\n\t}\r\n\r\n\t/**\r\n\t*加载完成\r\n\t*/\r\n\t__proto._onLoaded=function(){\r\n\t\tvar arraybuffer=Loader.getRes(this._aniPath);\r\n\t\tif (arraybuffer==null)return;\r\n\t\tif (Templet.TEMPLET_DICTIONARY==null){\r\n\t\t\tTemplet.TEMPLET_DICTIONARY={};\r\n\t\t};\r\n\t\tvar tFactory;\r\n\t\ttFactory=Templet.TEMPLET_DICTIONARY[this._aniPath];\r\n\t\tif (tFactory){\r\n\t\t\tif (tFactory.isParseFail){\r\n\t\t\t\tthis._parseFail();\r\n\t\t\t\t}else {\r\n\t\t\t\tif (tFactory.isParserComplete){\r\n\t\t\t\t\tthis._parseComplete();\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttFactory.on(/*laya.events.Event.COMPLETE*/\"complete\",this,this._parseComplete);\r\n\t\t\t\t\ttFactory.on(/*laya.events.Event.ERROR*/\"error\",this,this._parseFail);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\ttFactory=new Templet();\r\n\t\t\ttFactory._setUrl(this._aniPath);\r\n\t\t\tTemplet.TEMPLET_DICTIONARY[this._aniPath]=tFactory;\r\n\t\t\ttFactory.on(/*laya.events.Event.COMPLETE*/\"complete\",this,this._parseComplete);\r\n\t\t\ttFactory.on(/*laya.events.Event.ERROR*/\"error\",this,this._parseFail);\r\n\t\t\ttFactory.isParserComplete=false;\r\n\t\t\ttFactory.parseData(null,arraybuffer);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*解析完成\r\n\t*/\r\n\t__proto._parseComplete=function(){\r\n\t\tvar tTemple=Templet.TEMPLET_DICTIONARY[this._aniPath];\r\n\t\tif (tTemple){\r\n\t\t\tthis.init(tTemple,this._loadAniMode);\r\n\t\t\tthis.play(0,true);\r\n\t\t}\r\n\t\tthis._complete && this._complete.runWith(this);\r\n\t}\r\n\r\n\t/**\r\n\t*解析失败\r\n\t*/\r\n\t__proto._parseFail=function(){\r\n\t\tconsole.log(\"[Error]:\"+this._aniPath+\"解析失败\");\r\n\t}\r\n\r\n\t/**\r\n\t*传递PLAY事件\r\n\t*/\r\n\t__proto._onPlay=function(){\r\n\t\tthis.event(/*laya.events.Event.PLAYED*/\"played\");\r\n\t}\r\n\r\n\t/**\r\n\t*传递STOP事件\r\n\t*/\r\n\t__proto._onStop=function(){\r\n\t\tvar tEventData;\r\n\t\tvar tEventAniArr=this._templet.eventAniArr;\r\n\t\tvar tEventArr=tEventAniArr[this._aniClipIndex];\r\n\t\tif (tEventArr && this._eventIndex < tEventArr.length){\r\n\t\t\tfor (;this._eventIndex < tEventArr.length;this._eventIndex++){\r\n\t\t\t\ttEventData=tEventArr[this._eventIndex];\r\n\t\t\t\tif (tEventData.time >=this._player.playStart && tEventData.time <=this._player.playEnd){\r\n\t\t\t\t\tthis.event(/*laya.events.Event.LABEL*/\"label\",tEventData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._eventIndex=0;\r\n\t\tthis._drawOrder=null;\r\n\t\tthis.event(/*laya.events.Event.STOPPED*/\"stopped\");\r\n\t}\r\n\r\n\t/**\r\n\t*传递PAUSE事件\r\n\t*/\r\n\t__proto._onPause=function(){\r\n\t\tthis.event(/*laya.events.Event.PAUSED*/\"paused\");\r\n\t}\r\n\r\n\t/**\r\n\t*创建骨骼的矩阵，保存每次计算的最终结果\r\n\t*/\r\n\t__proto._parseSrcBoneMatrix=function(){\r\n\t\tvar i=0,n=0;\r\n\t\tn=this._templet.srcBoneMatrixArr.length;\r\n\t\tfor (i=0;i < n;i++){\r\n\t\t\tthis._boneMatrixArray.push(new Matrix());\r\n\t\t}\r\n\t\tif (this._aniMode==0){\r\n\t\t\tthis._boneSlotDic=this._templet.boneSlotDic;\r\n\t\t\tthis._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic;\r\n\t\t\tthis._boneSlotArray=this._templet.boneSlotArray;\r\n\t\t\t}else {\r\n\t\t\tif (this._boneSlotDic==null)this._boneSlotDic={};\r\n\t\t\tif (this._bindBoneBoneSlotDic==null)this._bindBoneBoneSlotDic={};\r\n\t\t\tif (this._boneSlotArray==null)this._boneSlotArray=[];\r\n\t\t\tvar tArr=this._templet.boneSlotArray;\r\n\t\t\tvar tBS;\r\n\t\t\tvar tBSArr;\r\n\t\t\tfor (i=0,n=tArr.length;i < n;i++){\r\n\t\t\t\ttBS=tArr[i];\r\n\t\t\t\ttBSArr=this._bindBoneBoneSlotDic[tBS.parent];\r\n\t\t\t\tif (tBSArr==null){\r\n\t\t\t\t\tthis._bindBoneBoneSlotDic[tBS.parent]=tBSArr=[];\r\n\t\t\t\t}\r\n\t\t\t\tthis._boneSlotDic[tBS.name]=tBS=tBS.copy();\r\n\t\t\t\ttBSArr.push(tBS);\r\n\t\t\t\tthis._boneSlotArray.push(tBS);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._emitMissedEvents=function(startTime,endTime,startIndex){\r\n\t\t(startIndex===void 0)&& (startIndex=0);\r\n\t\tvar tEventAniArr=this._templet.eventAniArr;\r\n\t\tvar tEventArr=tEventAniArr[this._player.currentAnimationClipIndex];\r\n\t\tif (tEventArr){\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tvar tEventData;\r\n\t\t\tlen=tEventArr.length;\r\n\t\t\tfor (i=startIndex;i < len;i++){\r\n\t\t\t\ttEventData=tEventArr[i];\r\n\t\t\t\tif (tEventData.time >=this._player.playStart && tEventData.time <=this._player.playEnd){\r\n\t\t\t\t\tthis.event(/*laya.events.Event.LABEL*/\"label\",tEventData);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*更新动画\r\n\t*@param autoKey true为正常更新，false为index手动更新\r\n\t*/\r\n\t__proto._update=function(autoKey){\r\n\t\t(autoKey===void 0)&& (autoKey=true);\r\n\t\tif (this._pause)return;\r\n\t\tif (autoKey && this._indexControl){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tCurrTime=this.timer.currTimer;\r\n\t\tvar preIndex=this._player.currentKeyframeIndex;\r\n\t\tvar dTime=tCurrTime-this._lastTime;\r\n\t\tif (autoKey){\r\n\t\t\tthis._player._update(dTime);\r\n\t\t\t}else {\r\n\t\t\tpreIndex=-1;\r\n\t\t}\r\n\t\tthis._lastTime=tCurrTime;\r\n\t\tif (!this._player)return;\r\n\t\tthis._index=this._clipIndex=this._player.currentKeyframeIndex;\r\n\t\tif (this._index < 0)return;\r\n\t\tif (dTime > 0 && this._clipIndex==preIndex && this._lastUpdateAniClipIndex==this._aniClipIndex){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._lastUpdateAniClipIndex=this._aniClipIndex;\r\n\t\tif (preIndex > this._clipIndex && this._eventIndex !=0){\r\n\t\t\tthis._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex);\r\n\t\t\tthis._eventIndex=0;\r\n\t\t};\r\n\t\tvar tEventData;\r\n\t\tvar tEventAniArr=this._templet.eventAniArr;\r\n\t\tvar tEventArr=tEventAniArr[this._aniClipIndex];\r\n\t\tif (tEventArr && this._eventIndex < tEventArr.length){\r\n\t\t\ttEventData=tEventArr[this._eventIndex];\r\n\t\t\tif (tEventData.time >=this._player.playStart && tEventData.time <=this._player.playEnd){\r\n\t\t\t\tif (this._player.currentPlayTime >=tEventData.time){\r\n\t\t\t\t\tthis.event(/*laya.events.Event.LABEL*/\"label\",tEventData);\r\n\t\t\t\t\tthis._eventIndex++;\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._eventIndex++;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tGraphics;\r\n\t\tif (this._aniMode==0){\r\n\t\t\ttGraphics=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex);\r\n\t\t\tif (tGraphics){\r\n\t\t\t\tif (this.graphics !=tGraphics){\r\n\t\t\t\t\tthis.graphics=tGraphics;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t\t}else {\r\n\t\t\t\tvar i=0,minIndex=0;\r\n\t\t\t\tminIndex=this._clipIndex;\r\n\t\t\t\twhile ((!this._templet.getGrahicsDataWithCache(this._aniClipIndex,minIndex-1))&& (minIndex > 0)){\r\n\t\t\t\t\tminIndex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (minIndex < this._clipIndex){\r\n\t\t\t\t\tfor (i=minIndex;i < this._clipIndex;i++){\r\n\t\t\t\t\t\tthis._createGraphics(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else if (this._aniMode==1){\r\n\t\t\ttGraphics=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex);\r\n\t\t\tif (tGraphics){\r\n\t\t\t\tif (this.graphics !=tGraphics){\r\n\t\t\t\t\tthis.graphics=tGraphics;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t\t}else {\r\n\t\t\t\tminIndex=this._clipIndex;\r\n\t\t\t\twhile ((!this._getGrahicsDataWithCache(this._aniClipIndex,minIndex-1))&& (minIndex > 0)){\r\n\t\t\t\t\tminIndex--;\r\n\t\t\t\t}\r\n\t\t\t\tif (minIndex < this._clipIndex){\r\n\t\t\t\t\tfor (i=minIndex;i < this._clipIndex;i++){\r\n\t\t\t\t\t\tthis._createGraphics(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._createGraphics();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*创建grahics图像\r\n\t*/\r\n\t__proto._createGraphics=function(_clipIndex){\r\n\t\t(_clipIndex===void 0)&& (_clipIndex=-1);\r\n\t\tif (_clipIndex==-1)_clipIndex=this._clipIndex;\r\n\t\tvar curTime=_clipIndex *this._player.cacheFrameRateInterval;\r\n\t\tvar tDrawOrderData;\r\n\t\tvar tDrawOrderAniArr=this._templet.drawOrderAniArr;\r\n\t\tvar tDrawOrderArr=tDrawOrderAniArr[this._aniClipIndex];\r\n\t\tif (tDrawOrderArr && tDrawOrderArr.length > 0){\r\n\t\t\tthis._drawOrderIndex=0;\r\n\t\t\ttDrawOrderData=tDrawOrderArr[this._drawOrderIndex];\r\n\t\t\twhile (curTime >=tDrawOrderData.time){\r\n\t\t\t\tthis._drawOrder=tDrawOrderData.drawOrder;\r\n\t\t\t\tthis._drawOrderIndex++;\r\n\t\t\t\tif (this._drawOrderIndex >=tDrawOrderArr.length){\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t\ttDrawOrderData=tDrawOrderArr[this._drawOrderIndex];\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tGraphics;\r\n\t\tif (this._aniMode==0 || this._aniMode==1){\r\n\t\t\tthis.graphics=new GraphicsAni();\r\n\t\t\t}else {\r\n\t\t\tif ((this.graphics instanceof laya.ani.GraphicsAni )){\r\n\t\t\t\tthis.graphics.clear();\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.graphics=new GraphicsAni();\r\n\t\t\t}\r\n\t\t}\r\n\t\ttGraphics=this.graphics;\r\n\t\tvar bones=this._templet.getNodes(this._aniClipIndex);\r\n\t\tthis._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],_clipIndex,curTime);\r\n\t\tvar tSectionArr=this._aniSectionDic[this._aniClipIndex];\r\n\t\tvar tParentMatrix;\r\n\t\tvar tStartIndex=0;\r\n\t\tvar i=0,j=0,k=0,n=0;\r\n\t\tvar tDBBoneSlot;\r\n\t\tvar tDBBoneSlotArr;\r\n\t\tvar tParentTransform;\r\n\t\tvar tSrcBone;\r\n\t\tvar boneCount=this._templet.srcBoneMatrixArr.length;\r\n\t\tfor (i=0,n=tSectionArr[0];i < boneCount;i++){\r\n\t\t\ttSrcBone=this._boneList[i];\r\n\t\t\ttParentTransform=this._templet.srcBoneMatrixArr[i];\r\n\t\t\ttSrcBone.resultTransform.scX=tParentTransform.scX *this._curOriginalData[tStartIndex++];\r\n\t\t\ttSrcBone.resultTransform.skX=tParentTransform.skX+this._curOriginalData[tStartIndex++];\r\n\t\t\ttSrcBone.resultTransform.skY=tParentTransform.skY+this._curOriginalData[tStartIndex++];\r\n\t\t\ttSrcBone.resultTransform.scY=tParentTransform.scY *this._curOriginalData[tStartIndex++];\r\n\t\t\ttSrcBone.resultTransform.x=tParentTransform.x+this._curOriginalData[tStartIndex++];\r\n\t\t\ttSrcBone.resultTransform.y=tParentTransform.y+this._curOriginalData[tStartIndex++];\r\n\t\t\tif (this._templet.tMatrixDataLen===8){\r\n\t\t\t\ttSrcBone.resultTransform.skewX=tParentTransform.skewX+this._curOriginalData[tStartIndex++];\r\n\t\t\t\ttSrcBone.resultTransform.skewY=tParentTransform.skewY+this._curOriginalData[tStartIndex++];\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tSlotDic={};\r\n\t\tvar tSlotAlphaDic={};\r\n\t\tvar tBoneData;\r\n\t\tfor (n+=tSectionArr[1];i < n;i++){\r\n\t\t\ttBoneData=bones[i];\r\n\t\t\ttSlotDic[tBoneData.name]=this._curOriginalData[tStartIndex++];\r\n\t\t\ttSlotAlphaDic[tBoneData.name]=this._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t};\r\n\t\tvar tBendDirectionDic={};\r\n\t\tvar tMixDic={};\r\n\t\tfor (n+=tSectionArr[2];i < n;i++){\r\n\t\t\ttBoneData=bones[i];\r\n\t\t\ttBendDirectionDic[tBoneData.name]=this._curOriginalData[tStartIndex++];\r\n\t\t\ttMixDic[tBoneData.name]=this._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t\tthis._curOriginalData[tStartIndex++];\r\n\t\t}\r\n\t\tif (this._pathDic){\r\n\t\t\tvar tPathConstraint;\r\n\t\t\tfor (n+=tSectionArr[3];i < n;i++){\r\n\t\t\t\ttBoneData=bones[i];\r\n\t\t\t\ttPathConstraint=this._pathDic[tBoneData.name];\r\n\t\t\t\tif (tPathConstraint){\r\n\t\t\t\t\tvar tByte=new Byte(tBoneData.extenData);\r\n\t\t\t\t\tswitch (tByte.getByte()){\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\ttPathConstraint.position=this._curOriginalData[tStartIndex++];\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\ttPathConstraint.spacing=this._curOriginalData[tStartIndex++];\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\ttPathConstraint.rotateMix=this._curOriginalData[tStartIndex++];\r\n\t\t\t\t\t\t\ttPathConstraint.translateMix=this._curOriginalData[tStartIndex++];\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._yReverseMatrix){\r\n\t\t\tthis._rootBone.update(this._yReverseMatrix);\r\n\t\t\t}else {\r\n\t\t\tthis._rootBone.update(Matrix.TEMP.identity());\r\n\t\t}\r\n\t\tif (this._ikArr){\r\n\t\t\tvar tIkConstraint;\r\n\t\t\tfor (i=0,n=this._ikArr.length;i < n;i++){\r\n\t\t\t\ttIkConstraint=this._ikArr[i];\r\n\t\t\t\tif (tBendDirectionDic.hasOwnProperty(tIkConstraint.name)){\r\n\t\t\t\t\ttIkConstraint.bendDirection=tBendDirectionDic[tIkConstraint.name];\r\n\t\t\t\t}\r\n\t\t\t\tif (tMixDic.hasOwnProperty(tIkConstraint.name)){\r\n\t\t\t\t\ttIkConstraint.mix=tMixDic[tIkConstraint.name]\r\n\t\t\t\t}\r\n\t\t\t\ttIkConstraint.apply();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._pathDic){\r\n\t\t\tfor (var tPathStr in this._pathDic){\r\n\t\t\t\ttPathConstraint=this._pathDic[tPathStr];\r\n\t\t\t\ttPathConstraint.apply(this._boneList,tGraphics);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._tfArr){\r\n\t\t\tvar tTfConstraint;\r\n\t\t\tfor (i=0,k=this._tfArr.length;i < k;i++){\r\n\t\t\t\ttTfConstraint=this._tfArr[i];\r\n\t\t\t\ttTfConstraint.apply();\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=0,k=this._boneList.length;i < k;i++){\r\n\t\t\ttSrcBone=this._boneList[i];\r\n\t\t\ttDBBoneSlotArr=this._bindBoneBoneSlotDic[tSrcBone.name];\r\n\t\t\ttSrcBone.resultMatrix.copyTo(this._boneMatrixArray[i]);\r\n\t\t\tif (tDBBoneSlotArr){\r\n\t\t\t\tfor (j=0,n=tDBBoneSlotArr.length;j < n;j++){\r\n\t\t\t\t\ttDBBoneSlot=tDBBoneSlotArr[j];\r\n\t\t\t\t\tif (tDBBoneSlot){\r\n\t\t\t\t\t\ttDBBoneSlot.setParentMatrix(tSrcBone.resultMatrix);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tDeformDic={};\r\n\t\tvar tDeformAniArr=this._templet.deformAniArr;\r\n\t\tvar tDeformAniData;\r\n\t\tvar tDeformSlotData;\r\n\t\tvar tDeformSlotDisplayData;\r\n\t\tif (tDeformAniArr && tDeformAniArr.length > 0){\r\n\t\t\tif (this._lastAniClipIndex !=this._aniClipIndex){\r\n\t\t\t\tthis._lastAniClipIndex=this._aniClipIndex;\r\n\t\t\t\tfor (i=0,n=this._boneSlotArray.length;i < n;i++){\r\n\t\t\t\t\ttDBBoneSlot=this._boneSlotArray[i];\r\n\t\t\t\t\ttDBBoneSlot.deformData=null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar tSkinDeformAni=tDeformAniArr[this._aniClipIndex];\r\n\t\t\ttDeformAniData=(tSkinDeformAni[\"default\"]);\r\n\t\t\tthis._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);\r\n\t\t\tvar tSkin;\r\n\t\t\tfor (tSkin in tSkinDeformAni){\r\n\t\t\t\tif (tSkin !=\"default\" && tSkin !=this._skinName){\r\n\t\t\t\t\ttDeformAniData=tSkinDeformAni [tSkin];\r\n\t\t\t\t\tthis._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttDeformAniData=(tSkinDeformAni[this._skinName]);\r\n\t\t\tthis._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);\r\n\t\t};\r\n\t\tvar tSlotData2;\r\n\t\tvar tSlotData3;\r\n\t\tvar tObject;\r\n\t\tif (this._drawOrder){\r\n\t\t\tfor (i=0,n=this._drawOrder.length;i < n;i++){\r\n\t\t\t\ttDBBoneSlot=this._boneSlotArray[this._drawOrder[i]];\r\n\t\t\t\ttSlotData2=tSlotDic[tDBBoneSlot.name];\r\n\t\t\t\ttSlotData3=tSlotAlphaDic[tDBBoneSlot.name];\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttGraphics.save();\r\n\t\t\t\t\ttGraphics.alpha(tSlotData3);\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData2)&& tSlotData2 !=-2){\r\n\t\t\t\t\tif (this._templet.attachmentNames){\r\n\t\t\t\t\t\ttDBBoneSlot.showDisplayByName(this._templet.attachmentNames[tSlotData2]);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttDBBoneSlot.showDisplayByIndex(tSlotData2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (tDeformDic[this._drawOrder[i]]){\r\n\t\t\t\t\ttObject=tDeformDic[this._drawOrder[i]];\r\n\t\t\t\t\tif (tDBBoneSlot.currDisplayData && tObject[tDBBoneSlot.currDisplayData.attachmentName]){\r\n\t\t\t\t\t\ttDBBoneSlot.deformData=tObject[tDBBoneSlot.currDisplayData.attachmentName];\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttDBBoneSlot.deformData=null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttDBBoneSlot.deformData=null;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2,tSlotData3);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2);\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttGraphics.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (i=0,n=this._boneSlotArray.length;i < n;i++){\r\n\t\t\t\ttDBBoneSlot=this._boneSlotArray[i];\r\n\t\t\t\ttSlotData2=tSlotDic[tDBBoneSlot.name];\r\n\t\t\t\ttSlotData3=tSlotAlphaDic[tDBBoneSlot.name];\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttGraphics.save();\r\n\t\t\t\t\ttGraphics.alpha(tSlotData3);\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData2)&& tSlotData2 !=-2){\r\n\t\t\t\t\tif (this._templet.attachmentNames){\r\n\t\t\t\t\t\ttDBBoneSlot.showDisplayByName(this._templet.attachmentNames[tSlotData2]);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttDBBoneSlot.showDisplayByIndex(tSlotData2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (tDeformDic[i]){\r\n\t\t\t\t\ttObject=tDeformDic[i];\r\n\t\t\t\t\tif (tDBBoneSlot.currDisplayData && tObject[tDBBoneSlot.currDisplayData.attachmentName]){\r\n\t\t\t\t\t\ttDBBoneSlot.deformData=tObject[tDBBoneSlot.currDisplayData.attachmentName];\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttDBBoneSlot.deformData=null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttDBBoneSlot.deformData=null;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2,tSlotData3);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2);\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(tSlotData3)){\r\n\t\t\t\t\ttGraphics.restore();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._aniMode==0){\r\n\t\t\tthis._templet.setGrahicsDataWithCache(this._aniClipIndex,_clipIndex,tGraphics);\r\n\t\t\t}else if (this._aniMode==1){\r\n\t\t\tthis._setGrahicsDataWithCache(this._aniClipIndex,_clipIndex,tGraphics);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置deform数据\r\n\t*@param tDeformAniData\r\n\t*@param tDeformDic\r\n\t*@param _boneSlotArray\r\n\t*@param curTime\r\n\t*/\r\n\t__proto._setDeform=function(tDeformAniData,tDeformDic,_boneSlotArray,curTime){\r\n\t\tif (!tDeformAniData)return;\r\n\t\tvar tDeformSlotData;\r\n\t\tvar tDeformSlotDisplayData;\r\n\t\tvar tDBBoneSlot;\r\n\t\tvar i=0,n=0,j=0;\r\n\t\tif (tDeformAniData){\r\n\t\t\tfor (i=0,n=tDeformAniData.deformSlotDataList.length;i < n;i++){\r\n\t\t\t\ttDeformSlotData=tDeformAniData.deformSlotDataList[i];\r\n\t\t\t\tfor (j=0;j < tDeformSlotData.deformSlotDisplayList.length;j++){\r\n\t\t\t\t\ttDeformSlotDisplayData=tDeformSlotData.deformSlotDisplayList[j];\r\n\t\t\t\t\ttDBBoneSlot=_boneSlotArray[tDeformSlotDisplayData.slotIndex];\r\n\t\t\t\t\ttDeformSlotDisplayData.apply(curTime,tDBBoneSlot);\r\n\t\t\t\t\tif (!tDeformDic[tDeformSlotDisplayData.slotIndex]){\r\n\t\t\t\t\t\ttDeformDic[tDeformSlotDisplayData.slotIndex]={};\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttDeformDic[tDeformSlotDisplayData.slotIndex][tDeformSlotDisplayData.attachment]=tDeformSlotDisplayData.deformData;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*得到当前动画的数量\r\n\t*@return 当前动画的数量\r\n\t*/\r\n\t__proto.getAnimNum=function(){\r\n\t\treturn this._templet.getAnimationCount();\r\n\t}\r\n\r\n\t/**\r\n\t*得到指定动画的名字\r\n\t*@param index 动画的索引\r\n\t*/\r\n\t__proto.getAniNameByIndex=function(index){\r\n\t\treturn this._templet.getAniNameByIndex(index);\r\n\t}\r\n\r\n\t/**\r\n\t*通过名字得到插槽的引用\r\n\t*@param name 动画的名字\r\n\t*@return 插槽的引用\r\n\t*/\r\n\t__proto.getSlotByName=function(name){\r\n\t\treturn this._boneSlotDic[name];\r\n\t}\r\n\r\n\t/**\r\n\t*通过名字显示一套皮肤\r\n\t*@param name 皮肤的名字\r\n\t*@param freshSlotIndex 是否将插槽纹理重置到初始化状态\r\n\t*/\r\n\t__proto.showSkinByName=function(name,freshSlotIndex){\r\n\t\t(freshSlotIndex===void 0)&& (freshSlotIndex=true);\r\n\t\tthis.showSkinByIndex(this._templet.getSkinIndexByName(name),freshSlotIndex);\r\n\t}\r\n\r\n\t/**\r\n\t*通过索引显示一套皮肤\r\n\t*@param skinIndex 皮肤索引\r\n\t*@param freshSlotIndex 是否将插槽纹理重置到初始化状态\r\n\t*/\r\n\t__proto.showSkinByIndex=function(skinIndex,freshSlotIndex){\r\n\t\t(freshSlotIndex===void 0)&& (freshSlotIndex=true);\r\n\t\tfor (var i=0;i < this._boneSlotArray.length;i++){\r\n\t\t\t(this._boneSlotArray [i]).showSlotData(null,freshSlotIndex);\r\n\t\t}\r\n\t\tif (this._templet.showSkinByIndex(this._boneSlotDic,skinIndex,freshSlotIndex)){\r\n\t\t\tvar tSkinData=this._templet.skinDataArray[skinIndex];\r\n\t\t\tthis._skinIndex=skinIndex;\r\n\t\t\tthis._skinName=tSkinData.name;\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*设置某插槽的皮肤\r\n\t*@param slotName 插槽名称\r\n\t*@param index 插糟皮肤的索引\r\n\t*/\r\n\t__proto.showSlotSkinByIndex=function(slotName,index){\r\n\t\tif (this._aniMode==0)return;\r\n\t\tvar tBoneSlot=this.getSlotByName(slotName);\r\n\t\tif (tBoneSlot){\r\n\t\t\ttBoneSlot.showDisplayByIndex(index);\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*设置某插槽的皮肤\r\n\t*@param slotName 插槽名称\r\n\t*@param name 皮肤名称\r\n\t*/\r\n\t__proto.showSlotSkinByName=function(slotName,name){\r\n\t\tif (this._aniMode==0)return;\r\n\t\tvar tBoneSlot=this.getSlotByName(slotName);\r\n\t\tif (tBoneSlot){\r\n\t\t\ttBoneSlot.showDisplayByName(name);\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*替换插槽贴图名\r\n\t*@param slotName 插槽名称\r\n\t*@param oldName 要替换的贴图名\r\n\t*@param newName 替换后的贴图名\r\n\t*/\r\n\t__proto.replaceSlotSkinName=function(slotName,oldName,newName){\r\n\t\tif (this._aniMode==0)return;\r\n\t\tvar tBoneSlot=this.getSlotByName(slotName);\r\n\t\tif (tBoneSlot){\r\n\t\t\ttBoneSlot.replaceDisplayByName(oldName,newName);\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*替换插槽的贴图索引\r\n\t*@param slotName 插槽名称\r\n\t*@param oldIndex 要替换的索引\r\n\t*@param newIndex 替换后的索引\r\n\t*/\r\n\t__proto.replaceSlotSkinByIndex=function(slotName,oldIndex,newIndex){\r\n\t\tif (this._aniMode==0)return;\r\n\t\tvar tBoneSlot=this.getSlotByName(slotName);\r\n\t\tif (tBoneSlot){\r\n\t\t\ttBoneSlot.replaceDisplayByIndex(oldIndex,newIndex);\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*设置自定义皮肤\r\n\t*@param name 插糟的名字\r\n\t*@param texture 自定义的纹理\r\n\t*/\r\n\t__proto.setSlotSkin=function(slotName,texture){\r\n\t\tif (this._aniMode==0)return;\r\n\t\tvar tBoneSlot=this.getSlotByName(slotName);\r\n\t\tif (tBoneSlot){\r\n\t\t\ttBoneSlot.replaceSkin(texture);\r\n\t\t}\r\n\t\tthis._clearCache();\r\n\t}\r\n\r\n\t/**\r\n\t*换装的时候，需要清一下缓冲区\r\n\t*/\r\n\t__proto._clearCache=function(){\r\n\t\tif (this._aniMode==1){\r\n\t\t\tfor (var i=0,n=this._graphicsCache.length;i < n;i++){\r\n\t\t\t\tthis._graphicsCache[i].length=0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画\r\n\t*\r\n\t*@param nameOrIndex 动画名字或者索引\r\n\t*@param loop 是否循环播放\r\n\t*@param force false,如果要播的动画跟上一个相同就不生效,true,强制生效\r\n\t*@param start 起始时间\r\n\t*@param end 结束时间\r\n\t*@param freshSkin 是否刷新皮肤数据\r\n\t*/\r\n\t__proto.play=function(nameOrIndex,loop,force,start,end,freshSkin){\r\n\t\t(force===void 0)&& (force=true);\r\n\t\t(start===void 0)&& (start=0);\r\n\t\t(end===void 0)&& (end=0);\r\n\t\t(freshSkin===void 0)&& (freshSkin=true);\r\n\t\tthis._indexControl=false;\r\n\t\tvar index=-1;\r\n\t\tvar duration=NaN;\r\n\t\tif (loop){\r\n\t\t\tduration=2147483647;\r\n\t\t\t}else {\r\n\t\t\tduration=0;\r\n\t\t}\r\n\t\tif ((typeof nameOrIndex=='string')){\r\n\t\t\tfor (var i=0,n=this._templet.getAnimationCount();i < n;i++){\r\n\t\t\t\tvar animation=this._templet.getAnimation(i);\r\n\t\t\t\tif (animation && nameOrIndex==animation.name){\r\n\t\t\t\t\tindex=i;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tindex=nameOrIndex;\r\n\t\t}\r\n\t\tif (index >-1 && index < this.getAnimNum()){\r\n\t\t\tthis._aniClipIndex=index;\r\n\t\t\tif (force || this._pause || this._currAniIndex !=index){\r\n\t\t\t\tthis._currAniIndex=index;\r\n\t\t\t\tthis._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(index));\r\n\t\t\t\tthis._drawOrder=null;\r\n\t\t\t\tthis._eventIndex=0;\r\n\t\t\t\tthis._player.play(index,this._player.playbackRate,duration,start,end);\r\n\t\t\t\tif (freshSkin)\r\n\t\t\t\t\tthis._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex);\r\n\t\t\t\tif (this._pause){\r\n\t\t\t\t\tthis._pause=false;\r\n\t\t\t\t\tthis._lastTime=Browser.now();\r\n\t\t\t\t\tthis.timer.frameLoop(1,this,this._update,null,true);\r\n\t\t\t\t}\r\n\t\t\t\tthis._update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止动画\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tif (!this._pause){\r\n\t\t\tthis._pause=true;\r\n\t\t\tif (this._player){\r\n\t\t\t\tthis._player.stop(true);\r\n\t\t\t}\r\n\t\t\tthis.timer.clear(this,this._update);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置动画播放速率\r\n\t*@param value 1为标准速率\r\n\t*/\r\n\t__proto.playbackRate=function(value){\r\n\t\tif (this._player){\r\n\t\t\tthis._player.playbackRate=value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*暂停动画的播放\r\n\t*/\r\n\t__proto.paused=function(){\r\n\t\tif (!this._pause){\r\n\t\t\tthis._pause=true;\r\n\t\t\tif (this._player){\r\n\t\t\t\tthis._player.paused=true;\r\n\t\t\t}\r\n\t\t\tthis.timer.clear(this,this._update);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*恢复动画的播放\r\n\t*/\r\n\t__proto.resume=function(){\r\n\t\tthis._indexControl=false;\r\n\t\tif (this._pause){\r\n\t\t\tthis._pause=false;\r\n\t\t\tif (this._player){\r\n\t\t\t\tthis._player.paused=false;\r\n\t\t\t}\r\n\t\t\tthis._lastTime=Browser.now();\r\n\t\t\tthis.timer.frameLoop(1,this,this._update,null,true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*得到缓冲数据\r\n\t*@param aniIndex\r\n\t*@param frameIndex\r\n\t*@return\r\n\t*/\r\n\t__proto._getGrahicsDataWithCache=function(aniIndex,frameIndex){\r\n\t\treturn this._graphicsCache[aniIndex][frameIndex];\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*保存缓冲grahpics\r\n\t*@param aniIndex\r\n\t*@param frameIndex\r\n\t*@param graphics\r\n\t*/\r\n\t__proto._setGrahicsDataWithCache=function(aniIndex,frameIndex,graphics){\r\n\t\tthis._graphicsCache[aniIndex][frameIndex]=graphics;\r\n\t}\r\n\r\n\t/**\r\n\t*销毁当前动画\r\n\t*/\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._templet=null;\r\n\t\tif (this._player)this._player.offAll();\r\n\t\tthis._player=null;\r\n\t\tthis._curOriginalData=null;\r\n\t\tthis._boneMatrixArray.length=0;\r\n\t\tthis._lastTime=0;\r\n\t\tthis.timer.clear(this,this._update);\r\n\t}\r\n\r\n\t/**\r\n\t*设置动画路径\r\n\t*/\r\n\t/**\r\n\t*得到资源的URL\r\n\t*/\r\n\t__getset(0,__proto,'url',function(){\r\n\t\treturn this._aniPath;\r\n\t\t},function(path){\r\n\t\tthis.load(path);\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置帧索引\r\n\t*/\r\n\t/**\r\n\t*@private\r\n\t*得到帧索引\r\n\t*/\r\n\t__getset(0,__proto,'index',function(){\r\n\t\treturn this._index;\r\n\t\t},function(value){\r\n\t\tif (this.player){\r\n\t\t\tthis._index=value;\r\n\t\t\tthis._player.currentTime=this._index *1000 / this._player.cacheFrameRate;\r\n\t\t\tthis._indexControl=true;\r\n\t\t\tthis._update(false);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*得到总帧数据\r\n\t*/\r\n\t__getset(0,__proto,'total',function(){\r\n\t\tif (this._templet && this._player){\r\n\t\t\tthis._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/ 1000 *this._player.cacheFrameRate);\r\n\t\t\t}else {\r\n\t\t\tthis._total=-1;\r\n\t\t}\r\n\t\treturn this._total;\r\n\t});\r\n\r\n\t/**\r\n\t*得到动画模板的引用\r\n\t*/\r\n\t__getset(0,__proto,'templet',function(){\r\n\t\treturn this._templet;\r\n\t});\r\n\r\n\t/**\r\n\t*得到播放器的引用\r\n\t*/\r\n\t__getset(0,__proto,'player',function(){\r\n\t\treturn this._player;\r\n\t});\r\n\r\n\tSkeleton.useSimpleMeshInCanvas=false;\r\n\treturn Skeleton;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*<p> <code>MovieClip</code> 用于播放经过工具处理后的 swf 动画。</p>\r\n*/\r\n//class laya.ani.swf.MovieClip extends laya.display.Sprite\r\nvar MovieClip=(function(_super){\r\n\tfunction MovieClip(parentMovieClip){\r\n\t\t/**@private 数据起始位置。*/\r\n\t\tthis._start=0;\r\n\t\t/**@private 当前位置。*/\r\n\t\tthis._Pos=0;\r\n\t\t/**@private 数据。*/\r\n\t\tthis._data=null;\r\n\t\t/**@private */\r\n\t\tthis._curIndex=0;\r\n\t\t/**@private */\r\n\t\tthis._preIndex=0;\r\n\t\t/**@private */\r\n\t\tthis._playIndex=0;\r\n\t\t/**@private */\r\n\t\tthis._playing=false;\r\n\t\t/**@private */\r\n\t\tthis._ended=true;\r\n\t\t/**@private 总帧数。*/\r\n\t\tthis._count=0;\r\n\t\t/**@private id_data起始位置表*/\r\n\t\tthis._ids=null;\r\n\t\t/**@private */\r\n\t\tthis._loadedImage={};\r\n\t\t/**@private id_实例表*/\r\n\t\tthis._idOfSprite=null;\r\n\t\t/**@private 父mc*/\r\n\t\tthis._parentMovieClip=null;\r\n\t\t/**@private 需要更新的movieClip表*/\r\n\t\tthis._movieClipList=null;\r\n\t\t/**@private */\r\n\t\tthis._labels=null;\r\n\t\t/**资源根目录。*/\r\n\t\tthis.basePath=null;\r\n\t\t/**@private */\r\n\t\tthis._atlasPath=null;\r\n\t\t/**@private */\r\n\t\tthis._url=null;\r\n\t\t/**@private */\r\n\t\tthis._isRoot=false;\r\n\t\t/**@private */\r\n\t\tthis._completeHandler=null;\r\n\t\t/**@private */\r\n\t\tthis._endFrame=-1;\r\n\t\t/**播放间隔(单位：毫秒)。*/\r\n\t\tthis.interval=30;\r\n\t\t/**是否循环播放 */\r\n\t\tthis.loop=false;\r\n\t\tMovieClip.__super.call(this);\r\n\t\tthis._ids={};\r\n\t\tthis._idOfSprite=[];\r\n\t\tthis._reset();\r\n\t\tthis._playing=false;\r\n\t\tthis._parentMovieClip=parentMovieClip;\r\n\t\tif (!parentMovieClip){\r\n\t\t\tthis._movieClipList=[this];\r\n\t\t\tthis._isRoot=true;\r\n\t\t\tthis._setUpNoticeType(/*laya.display.Node.NOTICE_DISPLAY*/0x1);\r\n\t\t\t}else {\r\n\t\t\tthis._isRoot=false;\r\n\t\t\tthis._movieClipList=parentMovieClip._movieClipList;\r\n\t\t\tthis._movieClipList.push(this);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(MovieClip,'laya.ani.swf.MovieClip',_super);\r\n\tvar __proto=MovieClip.prototype;\r\n\t/**\r\n\t*<p>销毁此对象。以及销毁引用的Texture</p>\r\n\t*@param destroyChild 是否同时销毁子节点，若值为true,则销毁子节点，否则不销毁子节点。\r\n\t*/\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis._clear();\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setDisplay=function(value){\r\n\t\t_super.prototype._setDisplay.call(this,value);\r\n\t\tif (this._isRoot){\r\n\t\t\tthis._$3__onDisplay(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._$3__onDisplay=function(value){\r\n\t\tif (value)this.timer.loop(this.interval,this,this.updates,null,true);\r\n\t\telse this.timer.clear(this,this.updates);\r\n\t}\r\n\r\n\t/**@private 更新时间轴*/\r\n\t__proto.updates=function(){\r\n\t\tif (this._parentMovieClip)return;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=this._movieClipList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._movieClipList[i]&&this._movieClipList[i]._update();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*增加一个标签到index帧上，播放到此index后会派发label事件\r\n\t*@param label 标签名称\r\n\t*@param index 索引位置\r\n\t*/\r\n\t__proto.addLabel=function(label,index){\r\n\t\tif (!this._labels)this._labels={};\r\n\t\tthis._labels[index]=label;\r\n\t}\r\n\r\n\t/**\r\n\t*删除某个标签\r\n\t*@param label 标签名字，如果label为空，则删除所有Label\r\n\t*/\r\n\t__proto.removeLabel=function(label){\r\n\t\tif (!label)this._labels=null;\r\n\t\telse if (!this._labels){\r\n\t\t\tfor (var name in this._labels){\r\n\t\t\t\tif (this._labels[name]===label){\r\n\t\t\t\t\tdelete this._labels[name];\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*动画的帧更新处理函数。\r\n\t*/\r\n\t__proto._update=function(){\r\n\t\tif (!this._data)return;\r\n\t\tif (!this._playing)return;\r\n\t\tthis._playIndex++;\r\n\t\tif (this._playIndex >=this._count){\r\n\t\t\tif (!this.loop){\r\n\t\t\t\tthis._playIndex--;\r\n\t\t\t\tthis.stop();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis._playIndex=0;\r\n\t\t}\r\n\t\tthis._parse(this._playIndex);\r\n\t\tif (this._labels && this._labels[this._playIndex])this.event(/*laya.events.Event.LABEL*/\"label\",this._labels[this._playIndex]);\r\n\t\tif (this._endFrame!=-1&&this._endFrame==this._playIndex){\r\n\t\t\tthis._endFrame=-1;\r\n\t\t\tif (this._completeHandler !=null){\r\n\t\t\t\tvar handler=this._completeHandler;\r\n\t\t\t\tthis._completeHandler=null;\r\n\t\t\t\thandler.run();\r\n\t\t\t}\r\n\t\t\tthis.stop();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放动画。\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis._playing=false;\r\n\t}\r\n\r\n\t/**\r\n\t*跳到某帧并停止播放动画。\r\n\t*@param frame 要跳到的帧\r\n\t*/\r\n\t__proto.gotoAndStop=function(index){\r\n\t\tthis.index=index;\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*清理。\r\n\t*/\r\n\t__proto._clear=function(){\r\n\t\tthis.stop();\r\n\t\tthis._idOfSprite.length=0;\r\n\t\tif (!this._parentMovieClip){\r\n\t\t\tthis.timer.clear(this,this.updates);\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tlen=this._movieClipList.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tif (this._movieClipList[i] !=this)\r\n\t\t\t\t\tthis._movieClipList[i]._clear();\r\n\t\t\t}\r\n\t\t\tthis._movieClipList.length=0;\r\n\t\t}\r\n\t\tif (this._atlasPath){\r\n\t\t\tLoader.clearRes(this._atlasPath);\r\n\t\t};\r\n\t\tvar key;\r\n\t\tfor (key in this._loadedImage){\r\n\t\t\tif (this._loadedImage[key]){\r\n\t\t\t\tLoader.clearRes(key);\r\n\t\t\t\tthis._loadedImage[key]=false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.removeChildren();\r\n\t\tthis.graphics=null;\r\n\t\tthis._parentMovieClip=null;\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画。\r\n\t*@param index 帧索引。\r\n\t*/\r\n\t__proto.play=function(index,loop){\r\n\t\t(index===void 0)&& (index=0);\r\n\t\t(loop===void 0)&& (loop=true);\r\n\t\tthis.loop=loop;\r\n\t\tthis._playing=true;\r\n\t\tif (this._data)\r\n\t\t\tthis._displayFrame(index);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._displayFrame=function(frameIndex){\r\n\t\t(frameIndex===void 0)&& (frameIndex=-1);\r\n\t\tif (frameIndex !=-1){\r\n\t\t\tif (this._curIndex > frameIndex)this._reset();\r\n\t\t\tthis._parse(frameIndex);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._reset=function(rm){\r\n\t\t(rm===void 0)&& (rm=true);\r\n\t\tif (rm && this._curIndex !=1)this.removeChildren();\r\n\t\tthis._preIndex=this._curIndex=-1;\r\n\t\tthis._Pos=this._start;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._parse=function(frameIndex){\r\n\t\tvar curChild=this;\r\n\t\tvar mc,sp,key=0,type=0,tPos=0,ttype=0,ifAdd=false;\r\n\t\tvar _idOfSprite=this._idOfSprite,_data=this._data,eStr;\r\n\t\tif (this._ended)this._reset();\r\n\t\t_data.pos=this._Pos;\r\n\t\tthis._ended=false;\r\n\t\tthis._playIndex=frameIndex;\r\n\t\tif (this._curIndex > frameIndex&&frameIndex<this._preIndex){\r\n\t\t\tthis._reset(true);\r\n\t\t\t_data.pos=this._Pos;\r\n\t\t}\r\n\t\twhile ((this._curIndex <=frameIndex)&& (!this._ended)){\r\n\t\t\ttype=_data.getUint16();\r\n\t\t\tswitch (type){\r\n\t\t\t\tcase 12:\r\n\t\t\t\t\tkey=_data.getUint16();\r\n\t\t\t\t\ttPos=this._ids[_data.getUint16()];\r\n\t\t\t\t\tthis._Pos=_data.pos;\r\n\t\t\t\t\t_data.pos=tPos;\r\n\t\t\t\t\tif ((ttype=_data.getUint8())==0){\r\n\t\t\t\t\t\tvar pid=_data.getUint16();\r\n\t\t\t\t\t\tsp=_idOfSprite[key]\r\n\t\t\t\t\t\tif (!sp){\r\n\t\t\t\t\t\t\tsp=_idOfSprite[key]=new Sprite();\r\n\t\t\t\t\t\t\tvar spp=new Sprite();\r\n\t\t\t\t\t\t\tspp.loadImage(this.basePath+pid+\".png\");\r\n\t\t\t\t\t\t\tthis._loadedImage[this.basePath+pid+\".png\"]=true;\r\n\t\t\t\t\t\t\tsp.addChild(spp);\r\n\t\t\t\t\t\t\tspp.size(_data.getFloat32(),_data.getFloat32());\r\n\t\t\t\t\t\t\tvar mat=_data._getMatrix();\r\n\t\t\t\t\t\t\tspp.transform=mat;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsp.alpha=1;\r\n\t\t\t\t\t\t}else if (ttype==1){\r\n\t\t\t\t\t\tmc=_idOfSprite[key]\r\n\t\t\t\t\t\tif (!mc){\r\n\t\t\t\t\t\t\t_idOfSprite[key]=mc=new MovieClip(this);\r\n\t\t\t\t\t\t\tmc.interval=this.interval;\r\n\t\t\t\t\t\t\tmc._ids=this._ids;\r\n\t\t\t\t\t\t\tmc.basePath=this.basePath;\r\n\t\t\t\t\t\t\tmc._setData(_data,tPos);\r\n\t\t\t\t\t\t\tmc._initState();\r\n\t\t\t\t\t\t\tmc.play(0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tmc.alpha=1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_data.pos=this._Pos;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 3:;\r\n\t\t\t\t\tvar node=_idOfSprite[ _data.getUint16()];\r\n\t\t\t\t\tif (node){\r\n\t\t\t\t\t\tthis.addChild(node);\r\n\t\t\t\t\t\tnode.zOrder=_data.getUint16();\r\n\t\t\t\t\t\tifAdd=true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tnode=_idOfSprite[ _data.getUint16()];\r\n\t\t\t\t\tnode && node.removeSelf();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\t_idOfSprite[_data.getUint16()][MovieClip._ValueList[_data.getUint16()]]=(_data.getFloat32());\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\t_idOfSprite[_data.getUint16()].visible=(_data.getUint8()> 0);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 7:\r\n\t\t\t\t\tsp=_idOfSprite[ _data.getUint16()];\r\n\t\t\t\t\tvar mt=sp.transform || Matrix.create();\r\n\t\t\t\t\tmt.setTo(_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32());\r\n\t\t\t\t\tsp.transform=mt;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\t_idOfSprite[_data.getUint16()].setPos(_data.getFloat32(),_data.getFloat32());\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 9:\r\n\t\t\t\t\t_idOfSprite[_data.getUint16()].setSize(_data.getFloat32(),_data.getFloat32());\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 10:\r\n\t\t\t\t\t_idOfSprite[ _data.getUint16()].alpha=_data.getFloat32();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\t_idOfSprite[_data.getUint16()].setScale(_data.getFloat32(),_data.getFloat32());\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 98:\r\n\t\t\t\t\teStr=_data.getString();\r\n\t\t\t\t\tthis.event(eStr);\r\n\t\t\t\t\tif (eStr==\"stop\")this.stop();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 99:\r\n\t\t\t\t\tthis._curIndex=_data.getUint16();\r\n\t\t\t\t\tifAdd && this.updateZOrder();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 100:\r\n\t\t\t\t\tthis._count=this._curIndex+1;\r\n\t\t\t\t\tthis._ended=true;\r\n\t\t\t\t\tif (this._playing){\r\n\t\t\t\t\t\tthis.event(/*laya.events.Event.FRAME*/\"enterframe\");\r\n\t\t\t\t\t\tthis.event(/*laya.events.Event.END*/\"end\");\r\n\t\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._reset(false);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tif (this._playing&&!this._ended)this.event(/*laya.events.Event.FRAME*/\"enterframe\");\r\n\t\tthis._Pos=_data.pos;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setData=function(data,start){\r\n\t\tthis._data=data;\r\n\t\tthis._start=start+3;\r\n\t}\r\n\r\n\t/**\r\n\t*加载资源。\r\n\t*@param url swf 资源地址。\r\n\t*@param atlas 是否使用图集资源\r\n\t*@param atlasPath 图集路径，默认使用与swf同名的图集\r\n\t*/\r\n\t__proto.load=function(url,atlas,atlasPath){\r\n\t\t(atlas===void 0)&& (atlas=false);\r\n\t\tthis._url=url=URL.formatURL(url);\r\n\t\tif(atlas)this._atlasPath=atlasPath?atlasPath:url.split(\".swf\")[0]+\".json\";\r\n\t\tthis.stop();\r\n\t\tthis._clear();\r\n\t\tthis._movieClipList=[this];\r\n\t\tvar urls;\r\n\t\turls=[ {url:url,type:/*laya.net.Loader.BUFFER*/\"arraybuffer\" }];\r\n\t\tif (this._atlasPath){\r\n\t\t\turls.push({url:this._atlasPath,type:/*laya.net.Loader.ATLAS*/\"atlas\" });\r\n\t\t}\r\n\t\tLaya.loader.load(urls,Handler.create(this,this._onLoaded));\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onLoaded=function(){\r\n\t\tvar data;\r\n\t\tdata=Loader.getRes(this._url);\r\n\t\tif (!data){\r\n\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",\"file not find\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.basePath=this._atlasPath?Loader.getAtlas(this._atlasPath).dir:this._url.split(\".swf\")[0]+\"/image/\";\r\n\t\tthis._initData(data);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._initState=function(){\r\n\t\tthis._reset();\r\n\t\tthis._ended=false;\r\n\t\tvar preState=this._playing;\r\n\t\tthis._playing=false;\r\n\t\tthis._curIndex=0;\r\n\t\twhile (!this._ended)this._parse(++this._curIndex);\r\n\t\tthis._playing=preState;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._initData=function(data){\r\n\t\tthis._data=new Byte(data);\r\n\t\tvar i=0,len=this._data.getUint16();\r\n\t\tfor (i=0;i < len;i++)this._ids[this._data.getInt16()]=this._data.getInt32();\r\n\t\tthis.interval=1000 / this._data.getUint16();\r\n\t\tthis._setData(this._data,this._ids[32767]);\r\n\t\tthis._initState();\r\n\t\tthis.play(0);\r\n\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\");\r\n\t\tif (!this._parentMovieClip)this.timer.loop(this.interval,this,this.updates,null,true);\r\n\t}\r\n\r\n\t/**\r\n\t*从开始索引播放到结束索引，结束之后出发complete回调\r\n\t*@param start 开始索引\r\n\t*@param end 结束索引\r\n\t*@param complete 结束回调\r\n\t*/\r\n\t__proto.playTo=function(start,end,complete){\r\n\t\tthis._completeHandler=complete;\r\n\t\tthis._endFrame=end;\r\n\t\tthis.play(start,false);\r\n\t}\r\n\r\n\t/**当前播放索引。*/\r\n\t__getset(0,__proto,'index',function(){\r\n\t\treturn this._playIndex;\r\n\t\t},function(value){\r\n\t\tthis._playIndex=value;\r\n\t\tif (this._data)\r\n\t\t\tthis._displayFrame(this._playIndex);\r\n\t\tif (this._labels && this._labels[value])this.event(/*laya.events.Event.LABEL*/\"label\",this._labels[value]);\r\n\t});\r\n\r\n\t/**\r\n\t*帧总数。\r\n\t*/\r\n\t__getset(0,__proto,'count',function(){\r\n\t\treturn this._count;\r\n\t});\r\n\r\n\t/**\r\n\t*是否在播放中\r\n\t*/\r\n\t__getset(0,__proto,'playing',function(){\r\n\t\treturn this._playing;\r\n\t});\r\n\r\n\t/**\r\n\t*资源地址。\r\n\t*/\r\n\t__getset(0,__proto,'url',null,function(path){\r\n\t\tthis.load(path);\r\n\t});\r\n\r\n\t__static(MovieClip,\r\n\t['_ValueList',function(){return this._ValueList=[\"x\",\"y\",\"width\",\"height\",\"scaleX\",\"scaleY\",\"rotation\",\"alpha\"];}\r\n\t]);\r\n\treturn MovieClip;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*动画模板类\r\n*/\r\n//class laya.ani.bone.Templet extends laya.ani.AnimationTemplet\r\nvar Templet=(function(_super){\r\n\tfunction Templet(){\r\n\t\tthis._mainTexture=null;\r\n\t\tthis._textureJson=null;\r\n\t\tthis._graphicsCache=[];\r\n\t\t/**存放原始骨骼信息 */\r\n\t\tthis.srcBoneMatrixArr=[];\r\n\t\t/**IK数据 */\r\n\t\tthis.ikArr=[];\r\n\t\t/**transform数据 */\r\n\t\tthis.tfArr=[];\r\n\t\t/**path数据 */\r\n\t\tthis.pathArr=[];\r\n\t\t/**存放插槽数据的字典 */\r\n\t\tthis.boneSlotDic={};\r\n\t\t/**绑定插槽数据的字典 */\r\n\t\tthis.bindBoneBoneSlotDic={};\r\n\t\t/**存放插糟数据的数组 */\r\n\t\tthis.boneSlotArray=[];\r\n\t\t/**皮肤数据 */\r\n\t\tthis.skinDataArray=[];\r\n\t\t/**皮肤的字典数据 */\r\n\t\tthis.skinDic={};\r\n\t\t/**存放纹理数据 */\r\n\t\tthis.subTextureDic={};\r\n\t\t/**是否解析失败 */\r\n\t\tthis.isParseFail=false;\r\n\t\t/**反转矩阵，有些骨骼动画要反转才能显示 */\r\n\t\tthis.yReverseMatrix=null;\r\n\t\t/**渲染顺序动画数据 */\r\n\t\tthis.drawOrderAniArr=[];\r\n\t\t/**事件动画数据 */\r\n\t\tthis.eventAniArr=[];\r\n\t\t/**@private 索引对应的名称 */\r\n\t\tthis.attachmentNames=null;\r\n\t\t/**顶点动画数据 */\r\n\t\tthis.deformAniArr=[];\r\n\t\tthis._isDestroyed=false;\r\n\t\tthis._rate=30;\r\n\t\tthis.isParserComplete=false;\r\n\t\tthis.aniSectionDic={};\r\n\t\tthis._skBufferUrl=null;\r\n\t\tthis._textureDic={};\r\n\t\tthis._loadList=null;\r\n\t\tthis._path=null;\r\n\t\t/**@private */\r\n\t\tthis.tMatrixDataLen=0;\r\n\t\tthis.mRootBone=null;\r\n\t\tTemplet.__super.call(this);\r\n\t\tthis.skinSlotDisplayDataArr=[];\r\n\t\tthis.mBoneArr=[];\r\n\t}\r\n\r\n\t__class(Templet,'laya.ani.bone.Templet',_super);\r\n\tvar __proto=Templet.prototype;\r\n\t__proto.loadAni=function(url){\r\n\t\tthis._skBufferUrl=url;\r\n\t\tLaya.loader.load(url,Handler.create(this,this.onComplete),null,/*laya.net.Loader.BUFFER*/\"arraybuffer\");\r\n\t}\r\n\r\n\t__proto.onComplete=function(content){\r\n\t\tif (this._isDestroyed){\r\n\t\t\tthis.destroy();\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tSkBuffer=Loader.getRes(this._skBufferUrl);\r\n\t\tif (!tSkBuffer){\r\n\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",\"load failed:\"+this._skBufferUrl);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf(\"/\"))+\"/\";\r\n\t\tthis.parseData(null,tSkBuffer);\r\n\t}\r\n\r\n\t/**\r\n\t*解析骨骼动画数据\r\n\t*@param texture 骨骼动画用到的纹理\r\n\t*@param skeletonData 骨骼动画信息及纹理分块信息\r\n\t*@param playbackRate 缓冲的帧率数据（会根据帧率去分帧）\r\n\t*/\r\n\t__proto.parseData=function(texture,skeletonData,playbackRate){\r\n\t\t(playbackRate===void 0)&& (playbackRate=30);\r\n\t\tif(!this._path&&this.url)this._path=this.url.slice(0,this.url.lastIndexOf(\"/\"))+\"/\";\r\n\t\tthis._mainTexture=texture;\r\n\t\tif (this._mainTexture){\r\n\t\t\tif (Render.isWebGL && texture.bitmap){\r\n\t\t\t\ttexture.bitmap.enableMerageInAtlas=false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._rate=playbackRate;\r\n\t\tthis.parse(skeletonData);\r\n\t}\r\n\r\n\t/**\r\n\t*创建动画\r\n\t*0,使用模板缓冲的数据，模板缓冲的数据，不允许修改 （内存开销小，计算开销小，不支持换装）\r\n\t*1,使用动画自己的缓冲区，每个动画都会有自己的缓冲区，相当耗费内存 （内存开销大，计算开销小，支持换装）\r\n\t*2,使用动态方式，去实时去画 （内存开销小，计算开销大，支持换装,不建议使用）\r\n\t*@param aniMode 0 动画模式，0:不支持换装,1,2支持换装\r\n\t*@return\r\n\t*/\r\n\t__proto.buildArmature=function(aniMode){\r\n\t\t(aniMode===void 0)&& (aniMode=0);\r\n\t\treturn new Skeleton(this,aniMode);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*解析动画\r\n\t*@param data 解析的二进制数据\r\n\t*@param playbackRate 帧率\r\n\t*/\r\n\t__proto.parse=function(data){\r\n\t\t_super.prototype.parse.call(this,data);\r\n\t\tthis._endLoaded();\r\n\t\tif (this._aniVersion !=Templet.LAYA_ANIMATION_VISION){\r\n\t\t\tconsole.log(\"[Error] 版本不一致，请使用IDE版本配套的重新导出\"+this._aniVersion+\"->\"+Templet.LAYA_ANIMATION_VISION);\r\n\t\t\tthis._loaded=false;\r\n\t\t}\r\n\t\tif (this.loaded){\r\n\t\t\tif (this._mainTexture){\r\n\t\t\t\tthis._parsePublicExtData();\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._parseTexturePath();\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",this);\r\n\t\t\tthis.isParseFail=true;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._parseTexturePath=function(){\r\n\t\tif (this._isDestroyed){\r\n\t\t\tthis.destroy();\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar i=0;\r\n\t\tthis._loadList=[];\r\n\t\tvar tByte=new Byte(this.getPublicExtData());\r\n\t\tvar tX=0,tY=0,tWidth=0,tHeight=0;\r\n\t\tvar tFrameX=0,tFrameY=0,tFrameWidth=0,tFrameHeight=0;\r\n\t\tvar tTempleData=0;\r\n\t\tvar tTextureLen=tByte.getInt32();\r\n\t\tvar tTextureName=tByte.readUTFString();\r\n\t\tvar tTextureNameArr=tTextureName.split(\"\\n\");\r\n\t\tvar tTexture;\r\n\t\tvar tSrcTexturePath;\r\n\t\tfor (i=0;i < tTextureLen;i++){\r\n\t\t\ttSrcTexturePath=this._path+tTextureNameArr[i *2];\r\n\t\t\ttTextureName=tTextureNameArr[i *2+1];\r\n\t\t\ttX=tByte.getFloat32();\r\n\t\t\ttY=tByte.getFloat32();\r\n\t\t\ttWidth=tByte.getFloat32();\r\n\t\t\ttHeight=tByte.getFloat32();\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameX=isNaN(tTempleData)? 0 :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameY=isNaN(tTempleData)? 0 :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameWidth=isNaN(tTempleData)? tWidth :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameHeight=isNaN(tTempleData)? tHeight :tTempleData;\r\n\t\t\tif (this._loadList.indexOf(tSrcTexturePath)==-1){\r\n\t\t\t\tthis._loadList.push(tSrcTexturePath);\r\n\t\t\t}\r\n\t\t}\r\n\t\tLaya.loader.load(this._loadList,Handler.create(this,this._textureComplete));\r\n\t}\r\n\r\n\t/**\r\n\t*纹理加载完成\r\n\t*/\r\n\t__proto._textureComplete=function(){\r\n\t\tvar tTexture;\r\n\t\tvar tTextureName;\r\n\t\tfor (var i=0,n=this._loadList.length;i < n;i++){\r\n\t\t\ttTextureName=this._loadList[i];\r\n\t\t\ttTexture=this._textureDic[tTextureName]=Loader.getRes(tTextureName);\r\n\t\t\tif (Render.isWebGL && tTexture && tTexture.bitmap){\r\n\t\t\t\ttTexture.bitmap.enableMerageInAtlas=false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._parsePublicExtData();\r\n\t}\r\n\r\n\t/**\r\n\t*解析自定义数据\r\n\t*/\r\n\t__proto._parsePublicExtData=function(){\r\n\t\tvar i=0,j=0,k=0,l=0,n=0;\r\n\t\tfor (i=0,n=this.getAnimationCount();i < n;i++){\r\n\t\t\tthis._graphicsCache.push([]);\r\n\t\t};\r\n\t\tvar isSpine=false;\r\n\t\tisSpine=this._aniClassName !=\"Dragon\";\r\n\t\tvar tByte=new Byte(this.getPublicExtData());\r\n\t\tvar tX=0,tY=0,tWidth=0,tHeight=0;\r\n\t\tvar tFrameX=0,tFrameY=0,tFrameWidth=0,tFrameHeight=0;\r\n\t\tvar tTempleData=0;\r\n\t\tvar tTextureLen=tByte.getInt32();\r\n\t\tvar tTextureName=tByte.readUTFString();\r\n\t\tvar tTextureNameArr=tTextureName.split(\"\\n\");\r\n\t\tvar tTexture;\r\n\t\tvar tSrcTexturePath;\r\n\t\tfor (i=0;i < tTextureLen;i++){\r\n\t\t\ttTexture=this._mainTexture;\r\n\t\t\ttSrcTexturePath=this._path+tTextureNameArr[i *2];\r\n\t\t\ttTextureName=tTextureNameArr[i *2+1];\r\n\t\t\tif (this._mainTexture==null){\r\n\t\t\t\ttTexture=this._textureDic[tSrcTexturePath];\r\n\t\t\t}\r\n\t\t\tif (!tTexture){\r\n\t\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",this);\r\n\t\t\t\tthis.isParseFail=true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttX=tByte.getFloat32();\r\n\t\t\ttY=tByte.getFloat32();\r\n\t\t\ttWidth=tByte.getFloat32();\r\n\t\t\ttHeight=tByte.getFloat32();\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameX=isNaN(tTempleData)? 0 :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameY=isNaN(tTempleData)? 0 :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameWidth=isNaN(tTempleData)? tWidth :tTempleData;\r\n\t\t\ttTempleData=tByte.getFloat32();\r\n\t\t\ttFrameHeight=isNaN(tTempleData)? tHeight :tTempleData;\r\n\t\t\tthis.subTextureDic[tTextureName]=Texture.create(tTexture,tX,tY,tWidth,tHeight,-tFrameX,-tFrameY,tFrameWidth,tFrameHeight);\r\n\t\t}\r\n\t\tthis._mainTexture=tTexture;\r\n\t\tvar tAniCount=tByte.getUint16();\r\n\t\tvar tSectionArr;\r\n\t\tfor (i=0;i < tAniCount;i++){\r\n\t\t\ttSectionArr=[];\r\n\t\t\ttSectionArr.push(tByte.getUint16());\r\n\t\t\ttSectionArr.push(tByte.getUint16());\r\n\t\t\ttSectionArr.push(tByte.getUint16());\r\n\t\t\ttSectionArr.push(tByte.getUint16());\r\n\t\t\tthis.aniSectionDic[i]=tSectionArr;\r\n\t\t};\r\n\t\tvar tBone;\r\n\t\tvar tParentBone;\r\n\t\tvar tName;\r\n\t\tvar tParentName;\r\n\t\tvar tBoneLen=tByte.getInt16();\r\n\t\tvar tBoneDic={};\r\n\t\tvar tRootBone;\r\n\t\tfor (i=0;i < tBoneLen;i++){\r\n\t\t\ttBone=new Bone();\r\n\t\t\tif (i==0){\r\n\t\t\t\ttRootBone=tBone;\r\n\t\t\t\t}else {\r\n\t\t\t\ttBone.root=tRootBone;\r\n\t\t\t}\r\n\t\t\ttBone.d=isSpine?-1:1;\r\n\t\t\ttName=tByte.readUTFString();\r\n\t\t\ttParentName=tByte.readUTFString();\r\n\t\t\ttBone.length=tByte.getFloat32();\r\n\t\t\tif (tByte.getByte()==1){\r\n\t\t\t\ttBone.inheritRotation=false;\r\n\t\t\t}\r\n\t\t\tif (tByte.getByte()==1){\r\n\t\t\t\ttBone.inheritScale=false;\r\n\t\t\t}\r\n\t\t\ttBone.name=tName;\r\n\t\t\tif (tParentName){\r\n\t\t\t\ttParentBone=tBoneDic[tParentName];\r\n\t\t\t\tif (tParentBone){\r\n\t\t\t\t\ttParentBone.addChild(tBone);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis.mRootBone=tBone;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttBoneDic[tName]=tBone;\r\n\t\t\tthis.mBoneArr.push(tBone);\r\n\t\t}\r\n\t\tthis.tMatrixDataLen=tByte.getUint16();\r\n\t\tvar tLen=tByte.getUint16();\r\n\t\tvar parentIndex=0;\r\n\t\tvar boneLength=Math.floor(tLen / this.tMatrixDataLen);\r\n\t\tvar tResultTransform;\r\n\t\tvar tMatrixArray=this.srcBoneMatrixArr;\r\n\t\tfor (i=0;i < boneLength;i++){\r\n\t\t\ttResultTransform=new Transform();\r\n\t\t\ttResultTransform.scX=tByte.getFloat32();\r\n\t\t\ttResultTransform.skX=tByte.getFloat32();\r\n\t\t\ttResultTransform.skY=tByte.getFloat32();\r\n\t\t\ttResultTransform.scY=tByte.getFloat32();\r\n\t\t\ttResultTransform.x=tByte.getFloat32();\r\n\t\t\ttResultTransform.y=tByte.getFloat32();\r\n\t\t\tif (this.tMatrixDataLen===8){\r\n\t\t\t\ttResultTransform.skewX=tByte.getFloat32();\r\n\t\t\t\ttResultTransform.skewY=tByte.getFloat32();\r\n\t\t\t}\r\n\t\t\ttMatrixArray.push(tResultTransform);\r\n\t\t\ttBone=this.mBoneArr[i];\r\n\t\t\ttBone.transform=tResultTransform;\r\n\t\t};\r\n\t\tvar tIkConstraintData;\r\n\t\tvar tIkLen=tByte.getUint16();\r\n\t\tvar tIkBoneLen=0;\r\n\t\tfor (i=0;i < tIkLen;i++){\r\n\t\t\ttIkConstraintData=new IkConstraintData();\r\n\t\t\ttIkBoneLen=tByte.getUint16();\r\n\t\t\tfor (j=0;j < tIkBoneLen;j++){\r\n\t\t\t\ttIkConstraintData.boneNames.push(tByte.readUTFString());\r\n\t\t\t\ttIkConstraintData.boneIndexs.push(tByte.getInt16());\r\n\t\t\t}\r\n\t\t\ttIkConstraintData.name=tByte.readUTFString();\r\n\t\t\ttIkConstraintData.targetBoneName=tByte.readUTFString();\r\n\t\t\ttIkConstraintData.targetBoneIndex=tByte.getInt16();\r\n\t\t\ttIkConstraintData.bendDirection=tByte.getFloat32();\r\n\t\t\ttIkConstraintData.mix=tByte.getFloat32();\r\n\t\t\ttIkConstraintData.isSpine=isSpine;\r\n\t\t\tthis.ikArr.push(tIkConstraintData);\r\n\t\t};\r\n\t\tvar tTfConstraintData;\r\n\t\tvar tTfLen=tByte.getUint16();\r\n\t\tvar tTfBoneLen=0;\r\n\t\tfor (i=0;i < tTfLen;i++){\r\n\t\t\ttTfConstraintData=new TfConstraintData();\r\n\t\t\ttTfBoneLen=tByte.getUint16();\r\n\t\t\tfor (j=0;j < tTfBoneLen;j++){\r\n\t\t\t\ttTfConstraintData.boneIndexs.push(tByte.getInt16());\r\n\t\t\t}\r\n\t\t\ttTfConstraintData.name=tByte.getUTFString();\r\n\t\t\ttTfConstraintData.targetIndex=tByte.getInt16();\r\n\t\t\ttTfConstraintData.rotateMix=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.translateMix=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.scaleMix=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.shearMix=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetRotation=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetX=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetY=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetScaleX=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetScaleY=tByte.getFloat32();\r\n\t\t\ttTfConstraintData.offsetShearY=tByte.getFloat32();\r\n\t\t\tthis.tfArr.push(tTfConstraintData);\r\n\t\t};\r\n\t\tvar tPathConstraintData;\r\n\t\tvar tPathLen=tByte.getUint16();\r\n\t\tvar tPathBoneLen=0;\r\n\t\tfor (i=0;i < tPathLen;i++){\r\n\t\t\ttPathConstraintData=new PathConstraintData();\r\n\t\t\ttPathConstraintData.name=tByte.readUTFString();\r\n\t\t\ttPathBoneLen=tByte.getUint16();\r\n\t\t\tfor (j=0;j < tPathBoneLen;j++){\r\n\t\t\t\ttPathConstraintData.bones.push(tByte.getInt16());\r\n\t\t\t}\r\n\t\t\ttPathConstraintData.target=tByte.readUTFString();\r\n\t\t\ttPathConstraintData.positionMode=tByte.readUTFString();\r\n\t\t\ttPathConstraintData.spacingMode=tByte.readUTFString();\r\n\t\t\ttPathConstraintData.rotateMode=tByte.readUTFString();\r\n\t\t\ttPathConstraintData.offsetRotation=tByte.getFloat32();\r\n\t\t\ttPathConstraintData.position=tByte.getFloat32();\r\n\t\t\ttPathConstraintData.spacing=tByte.getFloat32();\r\n\t\t\ttPathConstraintData.rotateMix=tByte.getFloat32();\r\n\t\t\ttPathConstraintData.translateMix=tByte.getFloat32();\r\n\t\t\tthis.pathArr.push(tPathConstraintData);\r\n\t\t};\r\n\t\tvar tDeformSlotLen=0;\r\n\t\tvar tDeformSlotDisplayLen=0;\r\n\t\tvar tDSlotIndex=0;\r\n\t\tvar tDAttachment;\r\n\t\tvar tDeformTimeLen=0;\r\n\t\tvar tDTime=NaN;\r\n\t\tvar tDeformVecticesLen=0;\r\n\t\tvar tDeformAniData;\r\n\t\tvar tDeformSlotData;\r\n\t\tvar tDeformSlotDisplayData;\r\n\t\tvar tDeformVectices;\r\n\t\tvar tDeformAniLen=tByte.getInt16();\r\n\t\tfor (i=0;i < tDeformAniLen;i++){\r\n\t\t\tvar tDeformSkinLen=tByte.getUint8();\r\n\t\t\tvar tSkinDic={};\r\n\t\t\tthis.deformAniArr.push(tSkinDic);\r\n\t\t\tfor (var f=0;f < tDeformSkinLen;f++){\r\n\t\t\t\ttDeformAniData=new DeformAniData();\r\n\t\t\t\ttDeformAniData.skinName=tByte.getUTFString();\r\n\t\t\t\ttSkinDic[tDeformAniData.skinName]=tDeformAniData;\r\n\t\t\t\ttDeformSlotLen=tByte.getInt16();\r\n\t\t\t\tfor (j=0;j < tDeformSlotLen;j++){\r\n\t\t\t\t\ttDeformSlotData=new DeformSlotData();\r\n\t\t\t\t\ttDeformAniData.deformSlotDataList.push(tDeformSlotData);\r\n\t\t\t\t\ttDeformSlotDisplayLen=tByte.getInt16();\r\n\t\t\t\t\tfor (k=0;k < tDeformSlotDisplayLen;k++){\r\n\t\t\t\t\t\ttDeformSlotDisplayData=new DeformSlotDisplayData();\r\n\t\t\t\t\t\ttDeformSlotData.deformSlotDisplayList.push(tDeformSlotDisplayData);\r\n\t\t\t\t\t\ttDeformSlotDisplayData.slotIndex=tDSlotIndex=tByte.getInt16();\r\n\t\t\t\t\t\ttDeformSlotDisplayData.attachment=tDAttachment=tByte.getUTFString();\r\n\t\t\t\t\t\ttDeformTimeLen=tByte.getInt16();\r\n\t\t\t\t\t\tfor (l=0;l < tDeformTimeLen;l++){\r\n\t\t\t\t\t\t\tif (tByte.getByte()==1){\r\n\t\t\t\t\t\t\t\ttDeformSlotDisplayData.tweenKeyList.push(true);\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\ttDeformSlotDisplayData.tweenKeyList.push(false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttDTime=tByte.getFloat32();\r\n\t\t\t\t\t\t\ttDeformSlotDisplayData.timeList.push(tDTime);\r\n\t\t\t\t\t\t\ttDeformVectices=[];\r\n\t\t\t\t\t\t\ttDeformSlotDisplayData.vectices.push(tDeformVectices);\r\n\t\t\t\t\t\t\ttDeformVecticesLen=tByte.getInt16();\r\n\t\t\t\t\t\t\tfor (n=0;n < tDeformVecticesLen;n++){\r\n\t\t\t\t\t\t\t\ttDeformVectices.push(tByte.getFloat32());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tDrawOrderArr;\r\n\t\tvar tDrawOrderAniLen=tByte.getInt16();\r\n\t\tvar tDrawOrderLen=0;\r\n\t\tvar tDrawOrderData;\r\n\t\tvar tDoLen=0;\r\n\t\tfor (i=0;i < tDrawOrderAniLen;i++){\r\n\t\t\ttDrawOrderLen=tByte.getInt16();\r\n\t\t\ttDrawOrderArr=[];\r\n\t\t\tfor (j=0;j < tDrawOrderLen;j++){\r\n\t\t\t\ttDrawOrderData=new DrawOrderData();\r\n\t\t\t\ttDrawOrderData.time=tByte.getFloat32();\r\n\t\t\t\ttDoLen=tByte.getInt16();\r\n\t\t\t\tfor (k=0;k < tDoLen;k++){\r\n\t\t\t\t\ttDrawOrderData.drawOrder.push(tByte.getInt16());\r\n\t\t\t\t}\r\n\t\t\t\ttDrawOrderArr.push(tDrawOrderData);\r\n\t\t\t}\r\n\t\t\tthis.drawOrderAniArr.push(tDrawOrderArr);\r\n\t\t};\r\n\t\tvar tEventArr;\r\n\t\tvar tEventAniLen=tByte.getInt16();\r\n\t\tvar tEventLen=0;\r\n\t\tvar tEventData;\r\n\t\tfor (i=0;i < tEventAniLen;i++){\r\n\t\t\ttEventLen=tByte.getInt16();\r\n\t\t\ttEventArr=[];\r\n\t\t\tfor (j=0;j < tEventLen;j++){\r\n\t\t\t\ttEventData=new EventData();\r\n\t\t\t\ttEventData.name=tByte.getUTFString();\r\n\t\t\t\ttEventData.intValue=tByte.getInt32();\r\n\t\t\t\ttEventData.floatValue=tByte.getFloat32();\r\n\t\t\t\ttEventData.stringValue=tByte.getUTFString();\r\n\t\t\t\ttEventData.time=tByte.getFloat32();\r\n\t\t\t\ttEventArr.push(tEventData);\r\n\t\t\t}\r\n\t\t\tthis.eventAniArr.push(tEventArr);\r\n\t\t};\r\n\t\tvar tAttachmentLen=tByte.getInt16();\r\n\t\tif (tAttachmentLen > 0){\r\n\t\t\tthis.attachmentNames=[];\r\n\t\t\tfor (i=0;i < tAttachmentLen;i++){\r\n\t\t\t\tthis.attachmentNames.push(tByte.getUTFString());\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tBoneSlotLen=tByte.getInt16();\r\n\t\tvar tDBBoneSlot;\r\n\t\tvar tDBBoneSlotArr;\r\n\t\tfor (i=0;i < tBoneSlotLen;i++){\r\n\t\t\ttDBBoneSlot=new BoneSlot();\r\n\t\t\ttDBBoneSlot.name=tByte.readUTFString();\r\n\t\t\ttDBBoneSlot.parent=tByte.readUTFString();\r\n\t\t\ttDBBoneSlot.attachmentName=tByte.readUTFString();\r\n\t\t\ttDBBoneSlot.srcDisplayIndex=tDBBoneSlot.displayIndex=tByte.getInt16();\r\n\t\t\ttDBBoneSlot.templet=this;\r\n\t\t\tthis.boneSlotDic[tDBBoneSlot.name]=tDBBoneSlot;\r\n\t\t\ttDBBoneSlotArr=this.bindBoneBoneSlotDic[tDBBoneSlot.parent];\r\n\t\t\tif (tDBBoneSlotArr==null){\r\n\t\t\t\tthis.bindBoneBoneSlotDic[tDBBoneSlot.parent]=tDBBoneSlotArr=[];\r\n\t\t\t}\r\n\t\t\ttDBBoneSlotArr.push(tDBBoneSlot);\r\n\t\t\tthis.boneSlotArray.push(tDBBoneSlot);\r\n\t\t};\r\n\t\tvar tNameString=tByte.readUTFString();\r\n\t\tvar tNameArray=tNameString.split(\"\\n\");\r\n\t\tvar tNameStartIndex=0;\r\n\t\tvar tSkinDataLen=tByte.getUint8();\r\n\t\tvar tSkinData,tSlotData,tDisplayData;\r\n\t\tvar tSlotDataLen=0,tDisplayDataLen=0;\r\n\t\tvar tUvLen=0,tWeightLen=0,tTriangleLen=0,tVerticeLen=0,tLengthLen=0;\r\n\t\tfor (i=0;i < tSkinDataLen;i++){\r\n\t\t\ttSkinData=new SkinData();\r\n\t\t\ttSkinData.name=tNameArray[tNameStartIndex++];\r\n\t\t\ttSlotDataLen=tByte.getUint8();\r\n\t\t\tfor (j=0;j < tSlotDataLen;j++){\r\n\t\t\t\ttSlotData=new SlotData();\r\n\t\t\t\ttSlotData.name=tNameArray[tNameStartIndex++];\r\n\t\t\t\ttDBBoneSlot=this.boneSlotDic[tSlotData.name];\r\n\t\t\t\ttDisplayDataLen=tByte.getUint8();\r\n\t\t\t\tfor (k=0;k < tDisplayDataLen;k++){\r\n\t\t\t\t\ttDisplayData=new SkinSlotDisplayData();\r\n\t\t\t\t\tthis.skinSlotDisplayDataArr.push(tDisplayData);\r\n\t\t\t\t\ttDisplayData.name=tNameArray[tNameStartIndex++];\r\n\t\t\t\t\ttDisplayData.attachmentName=tNameArray[tNameStartIndex++];\r\n\t\t\t\t\ttDisplayData.transform=new Transform();\r\n\t\t\t\t\ttDisplayData.transform.scX=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.transform.skX=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.transform.skY=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.transform.scY=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.transform.x=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.transform.y=tByte.getFloat32();\r\n\t\t\t\t\ttSlotData.displayArr.push(tDisplayData);\r\n\t\t\t\t\ttDisplayData.width=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.height=tByte.getFloat32();\r\n\t\t\t\t\ttDisplayData.type=tByte.getUint8();\r\n\t\t\t\t\ttDisplayData.verLen=tByte.getUint16();\r\n\t\t\t\t\ttBoneLen=tByte.getUint16();\r\n\t\t\t\t\tif (tBoneLen > 0){\r\n\t\t\t\t\t\ttDisplayData.bones=[];\r\n\t\t\t\t\t\tfor (l=0;l < tBoneLen;l++){\r\n\t\t\t\t\t\t\tvar tBoneId=tByte.getUint16();\r\n\t\t\t\t\t\t\ttDisplayData.bones.push(tBoneId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttUvLen=tByte.getUint16();\r\n\t\t\t\t\tif (tUvLen > 0){\r\n\t\t\t\t\t\ttDisplayData.uvs=[];\r\n\t\t\t\t\t\tfor (l=0;l < tUvLen;l++){\r\n\t\t\t\t\t\t\ttDisplayData.uvs.push(tByte.getFloat32());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttWeightLen=tByte.getUint16();\r\n\t\t\t\t\tif (tWeightLen > 0){\r\n\t\t\t\t\t\ttDisplayData.weights=[];\r\n\t\t\t\t\t\tfor (l=0;l < tWeightLen;l++){\r\n\t\t\t\t\t\t\ttDisplayData.weights.push(tByte.getFloat32());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttTriangleLen=tByte.getUint16();\r\n\t\t\t\t\tif (tTriangleLen > 0){\r\n\t\t\t\t\t\ttDisplayData.triangles=[];\r\n\t\t\t\t\t\tfor (l=0;l < tTriangleLen;l++){\r\n\t\t\t\t\t\t\ttDisplayData.triangles.push(tByte.getUint16());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttVerticeLen=tByte.getUint16();\r\n\t\t\t\t\tif (tVerticeLen > 0){\r\n\t\t\t\t\t\ttDisplayData.vertices=[];\r\n\t\t\t\t\t\tfor (l=0;l < tVerticeLen;l++){\r\n\t\t\t\t\t\t\ttDisplayData.vertices.push(tByte.getFloat32());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttLengthLen=tByte.getUint16();\r\n\t\t\t\t\tif (tLengthLen > 0){\r\n\t\t\t\t\t\ttDisplayData.lengths=[];\r\n\t\t\t\t\t\tfor (l=0;l < tLengthLen;l++){\r\n\t\t\t\t\t\t\ttDisplayData.lengths.push(tByte.getFloat32());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttSkinData.slotArr.push(tSlotData);\r\n\t\t\t}\r\n\t\t\tthis.skinDic[tSkinData.name]=tSkinData;\r\n\t\t\tthis.skinDataArray.push(tSkinData);\r\n\t\t};\r\n\t\tvar tReverse=tByte.getUint8();\r\n\t\tif (tReverse==1){\r\n\t\t\tthis.yReverseMatrix=new Matrix(1,0,0,-1,0,0);\r\n\t\t\tif (tRootBone){\r\n\t\t\t\ttRootBone.setTempMatrix(this.yReverseMatrix);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (tRootBone){\r\n\t\t\t\ttRootBone.setTempMatrix(new Matrix());\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.showSkinByIndex(this.boneSlotDic,0);\r\n\t\tthis.isParserComplete=true;\r\n\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*得到指定的纹理\r\n\t*@param name 纹理的名字\r\n\t*@return\r\n\t*/\r\n\t__proto.getTexture=function(name){\r\n\t\tvar tTexture=this.subTextureDic[name];\r\n\t\tif (tTexture==null){\r\n\t\t\treturn this._mainTexture;\r\n\t\t}\r\n\t\treturn tTexture;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*显示指定的皮肤\r\n\t*@param boneSlotDic 插糟字典的引用\r\n\t*@param skinIndex 皮肤的索引\r\n\t*@param freshDisplayIndex 是否重置插槽纹理\r\n\t*/\r\n\t__proto.showSkinByIndex=function(boneSlotDic,skinIndex,freshDisplayIndex){\r\n\t\t(freshDisplayIndex===void 0)&& (freshDisplayIndex=true);\r\n\t\tif (skinIndex < 0 && skinIndex >=this.skinDataArray.length)return false;\r\n\t\tvar i=0,n=0;\r\n\t\tvar tBoneSlot;\r\n\t\tvar tSlotData;\r\n\t\tvar tSkinData=this.skinDataArray[skinIndex];\r\n\t\tif (tSkinData){\r\n\t\t\tfor (i=0,n=tSkinData.slotArr.length;i < n;i++){\r\n\t\t\t\ttSlotData=tSkinData.slotArr[i];\r\n\t\t\t\tif (tSlotData){\r\n\t\t\t\t\ttBoneSlot=boneSlotDic[tSlotData.name];\r\n\t\t\t\t\tif (tBoneSlot){\r\n\t\t\t\t\t\ttBoneSlot.showSlotData(tSlotData,freshDisplayIndex);\r\n\t\t\t\t\t\tif (freshDisplayIndex&&tBoneSlot.attachmentName !=\"undefined\" && tBoneSlot.attachmentName !=\"null\"){\r\n\t\t\t\t\t\t\ttBoneSlot.showDisplayByName(tBoneSlot.attachmentName);\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\ttBoneSlot.showDisplayByIndex(tBoneSlot.displayIndex);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*通过皮肤名字得到皮肤索引\r\n\t*@param skinName 皮肤名称\r\n\t*@return\r\n\t*/\r\n\t__proto.getSkinIndexByName=function(skinName){\r\n\t\tvar tSkinData;\r\n\t\tfor (var i=0,n=this.skinDataArray.length;i < n;i++){\r\n\t\t\ttSkinData=this.skinDataArray[i];\r\n\t\t\tif (tSkinData.name==skinName){\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn-1;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*得到缓冲数据\r\n\t*@param aniIndex 动画索引\r\n\t*@param frameIndex 帧索引\r\n\t*@return\r\n\t*/\r\n\t__proto.getGrahicsDataWithCache=function(aniIndex,frameIndex){\r\n\t\treturn this._graphicsCache[aniIndex][frameIndex];\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*保存缓冲grahpics\r\n\t*@param aniIndex 动画索引\r\n\t*@param frameIndex 帧索引\r\n\t*@param graphics 要保存的数据\r\n\t*/\r\n\t__proto.setGrahicsDataWithCache=function(aniIndex,frameIndex,graphics){\r\n\t\tthis._graphicsCache[aniIndex][frameIndex]=graphics;\r\n\t}\r\n\r\n\t/**\r\n\t*释放纹理\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis._isDestroyed=true;\r\n\t\tvar tTexture;\r\n\t\t/*for each*/for(var $each_tTexture in this.subTextureDic){\r\n\t\t\ttTexture=this.subTextureDic[$each_tTexture];\r\n\t\t\tif(tTexture)\r\n\t\t\t\ttTexture.destroy();\r\n\t\t}\r\n\t\tvar $each_tTexture;\r\n\t\t/*for each*/for($each_tTexture in this._textureDic){\r\n\t\t\ttTexture=this._textureDic[$each_tTexture];\r\n\t\t\tif(tTexture)\r\n\t\t\t\ttTexture.destroy();\r\n\t\t};\r\n\t\tvar tSkinSlotDisplayData;\r\n\t\tfor (var i=0,n=this.skinSlotDisplayDataArr.length;i < n;i++){\r\n\t\t\ttSkinSlotDisplayData=this.skinSlotDisplayDataArr[i];\r\n\t\t\ttSkinSlotDisplayData.destory();\r\n\t\t}\r\n\t\tthis.skinSlotDisplayDataArr.length=0;\r\n\t\tif (this.url){\r\n\t\t\tdelete Templet.TEMPLET_DICTIONARY[this.url];\r\n\t\t}\r\n\t\tlaya.resource.Resource.prototype.destroy.call(this);\r\n\t}\r\n\r\n\t/**\r\n\t*通过索引得动画名称\r\n\t*@param index\r\n\t*@return\r\n\t*/\r\n\t__proto.getAniNameByIndex=function(index){\r\n\t\tvar tAni=this.getAnimation(index);\r\n\t\tif (tAni)return tAni.name;\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__getset(0,__proto,'rate',function(){\r\n\t\treturn this._rate;\r\n\t\t},function(v){\r\n\t\tthis._rate=v;\r\n\t});\r\n\r\n\tTemplet.LAYA_ANIMATION_VISION=\"LAYAANIMATION:1.6.0\";\r\n\tTemplet.TEMPLET_DICTIONARY=null;\r\n\treturn Templet;\r\n})(AnimationTemplet)\r\n\r\n\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.ani.js?");

/***/ }),

/***/ "./bin/libs/laya.core.js-exposed":
/*!***************************************!*\
  !*** ./bin/libs/laya.core.js-exposed ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* WEBPACK VAR INJECTION */(function(global) {module.exports = global[\"Laya=Laya\"] = __webpack_require__(/*! -!../../node_modules/exports-loader?Laya!./laya.core.js */ \"./node_modules/exports-loader/index.js?Laya!./bin/libs/laya.core.js\");\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../node_modules/webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))\n\n//# sourceURL=webpack:///./bin/libs/laya.core.js-exposed?");

/***/ }),

/***/ "./bin/libs/laya.debugtool.js":
/*!************************************!*\
  !*** ./bin/libs/laya.debugtool.js ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Box=laya.ui.Box,Browser=laya.utils.Browser,Button=laya.ui.Button,Byte=laya.utils.Byte,CSSStyle=laya.display.css.CSSStyle;\r\n\tvar Component=laya.ui.Component,Config=Laya.Config,Event=laya.events.Event,EventDispatcher=laya.events.EventDispatcher;\r\n\tvar Filter=laya.filters.Filter,GrahamScan=laya.maths.GrahamScan,Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas;\r\n\tvar Handler=laya.utils.Handler,HitArea=laya.utils.HitArea,Image=laya.ui.Image,Input=laya.display.Input,Label=laya.ui.Label;\r\n\tvar List=laya.ui.List,Loader=laya.net.Loader,LoaderManager=laya.net.LoaderManager,LocalStorage=laya.net.LocalStorage;\r\n\tvar MathUtil=laya.maths.MathUtil,Matrix=laya.maths.Matrix,Node=laya.display.Node,Point=laya.maths.Point,Pool=laya.utils.Pool;\r\n\tvar Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;\r\n\tvar Resource=laya.resource.Resource,ResourceManager=laya.resource.ResourceManager,RunDriver=laya.utils.RunDriver;\r\n\tvar Sprite=laya.display.Sprite,Stage=laya.display.Stage,Stat=laya.utils.Stat,Style=laya.display.css.Style;\r\n\tvar Text=laya.display.Text,TextInput=laya.ui.TextInput,Texture=laya.resource.Texture,Timer=laya.utils.Timer;\r\n\tvar Tree=laya.ui.Tree,UIEvent=laya.ui.UIEvent,URL=laya.net.URL,Utils=laya.utils.Utils,View=laya.ui.View;\r\n//class laya.debug.data.Base64AtlasManager\r\nvar Base64AtlasManager=(function(){\r\n\tfunction Base64AtlasManager(){}\r\n\t__class(Base64AtlasManager,'laya.debug.data.Base64AtlasManager');\r\n\tBase64AtlasManager.replaceRes=function(uiO){\r\n\t\tBase64AtlasManager.base64.replaceRes(uiO);\r\n\t}\r\n\r\n\t__static(Base64AtlasManager,\r\n\t['dataO',function(){return this.dataO={\"comp/button1.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABRCAYAAAApS3MNAAABSUlEQVR4Xu3a0QmFMADFUJ1JXM0h3moPZ6qg4AoNeLqAIenFn65jjLE40w2sQkxvcAMI0eggRKSDEEJUDEQ4/COEiBiIYFiEEBEDEQyLECJiIIJhEUJEDEQwLEKIiIEIhkUIETEQwbAIISIGIhgWIUTEQATDIoSIGIhgWIQQEQMRDIsQImIggnEvYvv9IzjfxDiP/XlgJsTcCyDEXP/v14UQImIggmERQkQMRDAsQoiIgQiGRQgRMRDBsAghIgYiGBYhRMRABMMihIgYiGBYhBARAxEMixAiYiCCYRFCRAxEMCxCiIiBCMa7iAjPpzG8fY3kF0KIiIEIhkUIETEQwbAIISIGIhgWIUTEQATDIoSIGIhgWIQQEQMRDIsQImIggmERQkQMRDAsQoiIgQiGRQgRMRDBsAghIgYiGBYhRMRABMMihIgYiGBcGJiOHTRZjZAAAAAASUVORK5CYII=\",\"comp/line2.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAAG0lEQVQYV2NkoDJgpLJ5DIxtra3/qWko1V0IAJvgApS1libIAAAAAElFTkSuQmCC\",\"view/create.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAAAdElEQVQ4T2NkwAIWLFjwH5t4QkICIyM2CXQxmAHka/j///9mXDYxMjL6YtgwBDUg+w8crIT8MBQ0oEca55JvWNPS9xgu4tISzADyNfz///8MnrRkgmHDENSALWng9fRQ0DA40xLecglbWhpqGoZCMUNKUQkANAHAJVkE5XwAAAAASUVORK5CYII=\",\"view/rendertime.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAABeUlEQVQ4T+2Uv0tCURSAvyNdcwiXBlsaaomWFgeHlqAtCPsDJHwIiUtDSxERtErtmQ6CjkHo4FpDBQ0tbVFR0BYE0eQvOnFF7T17QlOTd3m88873OD8+rtA9uVzOBIPBlIisAwvd8B1QajQahXQ63bIx6QHFYrEEJHrv7qeqZhzHOfYA+Xw+Yow5B+YHoGwymdxW1QAQEFWNAk8i8uEDuZM3gUcLZIEJYNcNqWrVcZyd7p9t8jLwYIFTYBx47UHlcjmcSCQ+B5JtpU0LnAFj3br7kE+yTalb4BCYczVqoT3AjteW4T73FlgFNgY+1IGQz4hPLGCAI2DGbweu2Auw1Vmcqk4C+8DsEOgZOBCR9/6mVdU2vgIsAdOuIVwANRFpezatuahpTYVSop1m+y6pasm8NQqSvvW61KwslkSHuCRkgvErr0taiUXaal1Sr0siWRO/9HfpF+RN9nfpB/qqmrXrv7mktVhYVm5GLo1cct9LI5e8d84/3UvfAgdlKH0EO7MAAAAASUVORK5CYII=\",\"view/cache.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAkCAYAAABSSLCCAAAAcElEQVQ4T2NcsGDB/4SEBEYGBgYGYtmMxCpENhhsA6mA8f///5tHNTEwkBcQpIYcSD15kUtWigi51vR/jVYdOGUQy2YkViGywWSnvTOkhiAonkY1gZIRqSEHTntkRe4g10RWQIyWe5Bgo2O5R7dkBADztyP+yFzirAAAAABJRU5ErkJggg==\",\"comp/clip_selectBox.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAoCAYAAAAIeF9DAAAAsElEQVRoQ+3ZQQ0AMQzEwAuqEgh/Sj2pKObhIrBsrfLonHPu12MMTEGYFg+kIFaPgmA9ClIQzQDG0w0pCGYAw2khBcEMYDgtpCCYAQynhRQEM4DhtJCCYAYwnBZSEMwAhtNCCoIZwHBmd/tTh6IUBIrx/tRbiFWkIFaPFoL1KEhBNAMYTzekIJgBDKeFFAQzgOG0kIJgBjCcFlIQzACG00IKghnAcFpIQTADGE4LwYL8U/BE1dCJ3PsAAAAASUVORK5CYII=\",\"comp/label.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAASCAYAAACQCxruAAAAmElEQVRoQ+3aMQqAQBBDUef+hx4Zq1mrbPnhWylECHmghVZ397OOqqp97TlugdNzgEXFIaaFuwROt0LmBEay5aXb920+FjIpMJItLy1wvhUyKTCSLS8tcL4VMikwki0vLXC+FTIpMJItLy1wvhUyKTCSLS89wPP1Qeh8M0zy+84gMMbruqjA15OxbtjAu7mPa5bj0fb/A8cLgD4n/wQKNiIAAAAASUVORK5CYII=\",\"comp/clip_tree_arrow.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAQCAYAAAArij59AAAAwUlEQVQoU5WRPRKCMBCFWUt6vYQeB06RUDpoBbFDa7yDwm30FGi9dHnOMiQDBgvT5c3b7+0PRVEUlVV9A3NmzL6T//SRfMz5CgCdtVafjlmzaHAigAbM2tE8YVo1pf0yvABoc9D3wACgBbMKIgD4qqDJsqqlMV8VGL5n/88geCJKlijSMBXFZUNx/CSi9WwX1r7R99thzKKqkxXRbMUWSE2u2sEwHsxHCbrMVSq6N4xRD9HAvJstylEkarhurlqnfQC58YP5+CvQNwAAAABJRU5ErkJggg==\",\"view/bg_panel.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMUlEQVRYR+3QQREAAAjDMGZk/l2CDD6pgl7SduexGCBAgAABAgQIECBAgAABAgS+BQ4oyStBhXcy5AAAAABJRU5ErkJggg==\",\"view/bg_top.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMUlEQVRYR+3QQREAAAjDMKZp/rWBDD6pgl7SduexGCBAgAABAgQIECBAgAABAgS+BQ6WyDMhXMLeQgAAAABJRU5ErkJggg==\",\"view/clickselect.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAACfElEQVRIS8WVO2iTYRSGn5OWqpMOurg0VRBdVVCsg7GgDjpZECyirl4GEYfSgBlaB5VSpApdxCJIoeKgg7dKC21ALahIiyiKKUjxAiI4qCH1lRP/hPhfAnHpGZPv+c4573nP95ukO/xHmINmtq8RtswsPiipB/gAPAFem5nCbcSWKukIsD84/A2YBh4DL8ysWLkk0qOkDcD5GLF+Ac+Ap35ZHGjAdWB5gtJvgZFYVSWdBHaFwBlg1Mw8K0ngFiAbAm+a2XBij/6HpBbgBrAEmAVeAZ1AFU40QDCWrcBZL0/S4Vq4HtgB7DWzU5XyauDBMhhWz70ryVVdb2ZuhGpI2g1MODjfiMFrxZk3s9WNwJ6snHFxQUlXgXfAPeC5mf2O2Y5oqZLcMceCw1+AseCSSTP7mSiOpM3A7RixfvgYgAd+WUQcSSnfPWBlgtIvgf5YVSVdBA6GQF/mS2bmWcvbERmHJF+payFw0MzO1TWApKXBViwL3h5/Pk4AVTjRAMFY9njJXl6wLccrcD3wAHDUzBwuRw18JtbkbkFJruomM7sf2o4u4Jals/mFRgxeFcfBQm97UyOwM+WMiwums/k3QnMps+HWpuLIRC5TCrcRW2pbT35MRiY4XDRsVmiU5uJQIZfxb0k5Ij229eQPySJ287MLGO8Rd1M0XY6AO3LjzYVSy3fAH+VICL4a6o9VtTWbnzbYGKI+IrtQ6Ns2EFuq/5jOTnWD9f4DikeFvvbqhyg2Yzo3voJSy2fAjfEJMYPRQQ2caAAfC7AW2WkvrzU79dCwnRW4Hjgg6JrrbV9VKbkKw1Csyd2Ca7on1y2krHOub3t16//2n79SarbsH7BKtfejoCjmAAAAAElFTkSuQmCC\",\"view/resize.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAABeUlEQVRIS+2UvUpdURCFvxXRKJpIEBURsVAIiiBoaaGCjY2VLyH4MBaCPoWlnQlpI6SxsQmkURQL5eK/6JK57iuRnMPZtxAkuOFUhzWz96xvjcg8tluAT5LOQqJMHba/AgPAD0nOEtruAOaB6Lon6U+ucAoYTLe7Bb5XCm1/BCaAXqAVOAHyOkYn27PA5/TGWmXHxvBeT2i7TVIM4MUp7ZhGPlY3V/pVKUxEjAIjyac74LIAjK70PwCoyfYXYDJwyqDoHtiRdFOfql0naBgIrILF/ZIi1yH6h1XbYXCPpKOq7s34GEX7JB00m445YBzYlPSQ1dF2N7CaWN2W9DNXuJxAj1uGVeuVQtvh32LyuR34DexWCv+CfAXoBzYkHb8Boe1OSRcFkBdfNY18IQiUtFUpTJjNAPEFHVfAaQFyjZ3zNBzbQ8BSWkZViEbk1uIpjXR8AKbT7jwEvpVUqEk6L0pHLN5hSWWxeq7XjI/v6Sgz0vZ7Ov7DdDwCkcb1m86tSukAAAAASUVORK5CYII=\",\"view/clickanalyse.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAAC7UlEQVRIS5WWT2hUZxTFfyfGFolkoUVKrHQiEaX+IfgHa54UQzUqpWYhLbQU6ULNwgYXuog6yiiTgK2LgtAu6yqbFkpRBEURQzJEBN200NqKkxoDLnQhFUrizJU7vje8SSbzZr7FwDy+c75z7z3nfU80uMxMDin9JC0zewvYAHwIrAH65wWaWQuwOdy8CVgUHnBd0sUKoJktBbYC24B1QHMVNeck3ZWZrYhtXpUg/3/gS0kzDnT2/cDqpFqBUUnnK5pjZutDgo01Tr0g6XbVrprZypBgO9AUU/EK+ErSyzLQzC5XkTkCfBR7fl/Smeh/qasOlPRp9DAkOgp8H5P9o6SriUAnMrOzgNdswNeSntcL9IYNAQ8kHYuXU5Y6u8ZIupldAO5I+nkOsNb8wjk/ljTZKFCSvMbSMrPSiOpNx9uAz3UP4IbfWSsdrcDH4eZuYHF46LCk47PT8S6wG9gbJmRhlfoPSLrhJvdERJs7E+S73dZKmnagsx8JB50UEHdY3+x0dIUEO2qcekTSr/OlY21I4N5dEJMwA6yX9CKejqkqGn8DemPPb0v6YrZXpyS1xYbsRD3AtZjsk5IuJQKdyMyGAa/ZnbNR0tN6gd6wXwAP8SfV0jGnxki6mV1xyf4ubdTkPue/Jf3TEJCMNZFRMQLtyNwqvaTrSkdHZry1MFM8bLLPgY5U8/SyeYHvncotb5b1A/t8c2QGg3sT2WBLBbD95PiGogr9Ej0Gbap8r4ZJ5kR+MPhW7WdGd5npEFaa15IE+YWW5uklf2S6/1N7OnfasG+Ad5KiAfyVzwYfVDQnlc71YTaA8Ntrvtq/y2eDgapdTZ0a60UMhjdvmcCgWDClJge7npSBqfRYYY5M6U/M/NqO1mQ+G7xf4VUH5rNBOXtviLQfzH0afizop0fZroOJQCdKpcfyUKrZFhTpfDgU/F4nMNcH9gPwLJ8Nls3xarUaI+mp9NhTg5GJbPBZQyb3OReayP17rutmHPga1PpCOk+zrlEAAAAASUVORK5CYII=\",\"view/res.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAADwUlEQVRIS+3WT2gcdRQH8O/b2SwNC7l4MAEPvbilUkoPOUmLjSDrZn4hxYKH/kGwyB4tQogiu/N+GymyoWguhVBQKKkHQTHsW9fUQwqKp4AgtMXkInhILl4CkoTdmSe/6XZp2pntLli8uMedt9/3mze/33yW8Jw+9Jxy0TeYmV8FcFVVTxPRiwA6AP5U1TvZbHapUqn8nrawxGBVJWvtNVWdJ6K05h1V/dhaW08KT/wRM1sAVQCRqn5JRLdyudw9Iora7faJKIrKqnrBNSWiahAEC0+GHwpm5utEdD+KopsuBMDbzPxt0oqstRdV9Za7lslkzlar1Z8erzsUHATBJhG93C34fmJi4ly5XG6nzTEIgjoRzanqkrX2amowM98F8Fq3wK34PWb+Ii14cXExv7e3V6hWq78+axQrANwt/kVEl5j5h0G2IzMfUdWCtfa3R/VPzvhTAG8AOM/MfwwYehTANwB+ZOYPE4ODIDhJRJvMvD9IqLW2GEXRbSJ6AcBtZr6UGPzoS2Y+lc/nt+bm5v5Oa2CtvaKqywC8bs06M7+eGszMn7nTBqDOzPNpwcvLyyPb29vfAZh2Naq6Za0tpAbXarUzURS53eGKL1trv0oKZ+a3AHytqplMJlOOoui4tfaDvqOw1lZUtabubBOtqOqN0dHRB/v7++62XwHwDoB33dkAUGPmoO92e/yitXZeVT8BkE1acbdpPQiCj4hIBw52hQsLC8c6nc77AN4E8FK3yQ4R/Qzgc2b+Je0ZDPU+fjiZp1eXFD5U8CB7u+/DGybgXxnFMA3/m1GISGwegNMAeuYBuON53lKpVBrePBG5RkTuSPc1b2ZmZnDzRKRnHoDYvIODg3u5XM69/E8AKAO40G1aNcb0N6/ZbF5X1fsAbjpInXnGmETzGo3GRdew+0DPGmPSzRORTQA988bHx89NTk6mmtdoNGLziGjJ9/1085rN5l1VPWSeMSbVvLW1tXwYhoXp6en+5olIbB6A2Dzf9wcyb319/cju7m5hdnY22TwRic3zPO98qVQayLxWq3U0DMPYPGNMsnmrq6snx8bGNqempgYyT0SKzjoAsXnGmP7mNZvNU9lsdqtYLKaaJyJXABwyzxiTbp6IxOYRUd33/VTzNjY2RnZ2dnrmAdgyxqSbJyJnAMTmEdFl3/cTzROR2DzHk6qWiei4Maa/eSJScZY99FRXPM+7MTIy8iAMQ6/dbsfmEVHPPGPM4OaJiBtDqnmuqfuL4Pv+8Oa1Wq1jYRg+ZR6A2DxjzP/mPRupfwAf56Q4urCh6QAAAABJRU5ErkJggg==\",\"view/tab_panel.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAABICAYAAADyMAW8AAAAcUlEQVRYR+3WsQ3AMAhE0TCMeyTvP1tShRQo7lxYegxA8fUPLuac97VhwuKXKhTlFxRQ9GPDClawYvGEDwxIZu7pFRZXr4ACinY1ghWsYMX/NxWQr22edyvGGHt6hcV1NqGAon8QVrCCFYteISDnBuQB3xJuQcDkEngAAAAASUVORK5CYII=\",\"view/btn_close.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAqCAYAAACz+XvQAAACmUlEQVRIS7WWS0/bUBCFz7mJmyZxENm06mNVoVZC7LqGn9FNqy55/BSWSEhs2/4uuqFVoA150JLKJvGdaiIH2TfXNoKQpeP5PHPO3GMTK/5xxTwsAUWkBeBZ+qAByb/Zh4pIA8CL9NqY5Dj7vw9YA/ABwDsAfwB8ITnUIhF5CuATgNcAfgH4RnJSCkwLl6AA/lXBtLZQQxFxoTr6q6LOFl2WmuJAtcY7ZuXIixsczfRyTlPfhpSN7BpwBeBtFdQLFJE2gI8AXi7GBBBl3Fdnv5L87XbpWxuFfQbw3NXM0dQLLdrDIH3ylGTiLLYB8CS9lpCc3tmU+xzL1Z9lEXl/n06KavjowCiK1uM4fqMd1Ov1s3a7fZntZjabtSeTiQYHgiC4aLVavZwpbofT6TQYDAaH1tod3bMwDHc7nc5PLZrNZmG/3z8WkS1jzGm32z1oNBqjUqD+6YM2m81xFWyeNkUaulAAlyKyWdTZbdqUmZKFakEVrLRDV7P5zY6m3rQp6tA1AMC5tXY7he51Op0fdwbGcdwdDodHWc2MMdcL9wGM1tbW9sMw/L6UNm6HChuNRifW2g1XM0dTL3TJZS1KkkTDFbVaLQqCIJcm6k0URRpxuvg39Xo9rtzDh5zt1Z/lXq+32rR5dKC1dt0YM08bAGd65BxN1ZB52ojIBcl82rgdWmsDkocAdgDoW22X5DxtSIZJkhyT3AJwCuCAZD5tfCP7oMaYcRVs/tAiDT1QHX2zqLPbtCkzxYFqjXfM3GKXAR3NtC6nqTccioAeA84BbCuU5B4Af9r4gCLSBXCU1UxErjPuj0Rk3xiznDYuMIWdANhwNXM09UKXXNai9LtQ9y4yxuS/XUijr9L0lXBDMp82j370HhJdWvsftiHJYFPSIqEAAAAASUVORK5CYII=\",\"comp/combobox.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAABCCAYAAAA476rKAAACfElEQVR4Xu3bMYsTURQF4PMmExgIWkgEU5hskyJYxGYKY5VS7NzCylL8Bftj3NbKQjuxTBWbaUwhKdIYLCJotlACA5m8kQTZZZkkeN9dbuNJOXPPu/DN5ZHkMa7dbpfgx0TAEdvEedeE2HbWxDa0JjaxLQUMe3HPJrahQECrNE3RarUOJheLBbIsq9znZAdgJ0mC4XCIer1eSa/Xa4xGI+R5TuwA272RTqeDfr9fuTeZTDCfz/dmONkK/cFggGazebnCcrnEeDw+uCKxFdiNRmO3nURRBO/9bvtYrVbEVpgejXa7XfR6PUynU8xms6O1nGzlU3DO7fbu7V5dlsf/0yO2ElsSJ7ZES1lLbCWgJE5siZaylthKQEmc2BItZS2xlYCSOLElWspaYisBJXFiS7SUtcRWAkrixJZoKWuJrQSUxIkt0VLWElsJKIkTW6L1t5an6wFooRGerofKBeZ4uh4IFxrj6XqoXECOp+sBaJoIT9c1esIsT9eFYFbl/J5tJc13agyliU1sWwHDbtyziW0oYNiKk22JfXJ6xnfXjcDdFttnb43a/b9tovQ5iG30/IltBL1tQ2xiGwoYtuJkE9tQILBV/ugl4rh2MF1sPJJP59fuc7IDsTe37mHz8Bki+MoKHhFqn9+j9vs7sQN9K7G89xRx837levHzG5Lph8p1TrZK3iF//ApxdLVI4YFk/BpA9Uc5sVXYwObOCfyDJ3AoUcIh+vIRtYuve1clthJ7G8/7p4hv30Xx6weSybuDKxL7BrARxcjTF0iyN4AviH0Tpto1ONlaQUGe2AIsbSmxtYKCPLEFWNpSYmsFBXliC7C0pZfY2oWY/zeBP8uaLni/AFTVAAAAAElFTkSuQmCC\",\"comp/textinput.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAWCAYAAACv8OArAAAAZElEQVRYR+3UQQkAMAwEwcZI/LtsoSL2NTGwMByZ3b3HJQIDO3H+EdidNezQGjbsUiBs+dmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4EwZdmwQ4Ew9QBe0R29X9x+dwAAAABJRU5ErkJggg==\",\"comp/vscroll.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAhCAYAAAA/F0BXAAAAOklEQVRIS2N8+OzVf2YWFgYmJiYGcgHjqCEYQTcaJpipaTRMRsOEmDJmNJ2MppPRdEJMCIymE2JCCQAYonwDuu2VMAAAAABJRU5ErkJggg==\",\"comp/vscroll$down.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAzCAYAAABxCePHAAAC/klEQVRIS+2WS0wTURSG/zszBcrLFVvjio0LiAqRRDAmGpRodFE1MQQQkOKGqBujRo3ExLjB4MaKgDzUaGQhvoJGYwAjYoioERcuDGxYEIwPkBY6nWvObXuLnXZaSklYOIu5M/fxzZn/nvPPsInJKa5qGhRFQaIH+w8xSbcymtTd+gBFYXAdyjM9sf7ORxgGR0t5/j9jpkhq2t5B0xQwBrgqNsnJ9V0j4BzQdQNtNYXWkKz0NDiaXkBTFTCFoaWmCHVtQ+AGh+4z0HNiO2bmPNYQGiXQvkuPoaqqiIgi8Pl8eHBqtwlA86MKS6Cy8z1gjIFzjqcXHBEBlpBgRNuOd+HVlYqogJiQIChcg/BtW5k8SaSSkxPJ5PRPTttHfkI7kcghIpn8NYfp33NLXp+TnYG1OWvA3ox9499nPSjdkCsgHJxOIjc43VMrugL9dEUD4Oj/PA4CsUfDX/jOjbmisHTDCCzi4t4QgLDrQF+qTYOmqhgYGw9BvLpv0ZNjQwieaU9b7ZCDriFhSt3VBSZNartHA6aUJ7SK+jqO5n5pSp1HiqSw1e3Di0ypwBpiU1XsudwnTanraDEqrg2GmZLbGkJh2jQVZY29JlPqPe03JX/uxLE7Nk3DjjP3pCn1Ne7HrNsjdYoLQsmWYtNQ3NCBgeZKzLrn/foEoogbQgvSUmz4454P7VQikGhpHzGSZdVOUqqYTGli6gemZ9yJ+0lSTalk/TrxtQOYaBnESbTinokev4UG+p+9/xoyJQKQn8x7vf7JjEFZ1FJBBvuC12RINIdAwtkIQuksnxgHhKBUZ6scQtLSNyiWJpav47z9STjbjfJ8k5iVN0eEs911bhZjUTWpbR+RztZ6uFBERNCq1rfS2e43lFhDsjPscDS9lM7W4dyCquuvpbM9PFkq0iHm7mSl2yP+bj05uxdeXZe5FHOL6Xdr17nQ79bziwew4NXFqwUTMiaEtKBPwtZjnRi8WgXPglfqsyQITc60pwpAeNpH1GRZtRM0pWVVcTJM6S+dYaRsIf025wAAAABJRU5ErkJggg==\",\"comp/vscroll$bar.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAA/CAYAAAAGyyO8AAABYElEQVRYR+2Wv0sDMRTH30tarCg6dRWnQnFT6OiqoP+tk+Cig+AiHayDiNSlg+jgD47K1US+Lwm5s4o/mkElN1xy73KfcF/efTi+Ht3Y0X1Btw8FffdoLy3QSnuZ+HhwZe+exrS13hGGJYsTWSszN0rJ1zHDDbJ0eDYkgHjv5Nxub3TIGEsTY/xDVq6NAN7MfW2u2aCG1nQ0GEZIOXmp7Pw5BPDF+VaGIGQfbM6k0ng5kw8/wF/eJzP5JInZkjg2CSS8zk6vCys7Wb8r5qqsncAP+pdR1Lu9rvgVT4uYg+3F+PCtAzjzu/taKdKKBSS2/wkEMBg/Q+rB50zqzZb7ZPoD/GeZ1HySxGxJHJsEEl5nc22VmCFalpFJTjLKNUtFxlDfP72IogYAP8PPZekWM5OqjErFWpjjbxprABJRA/JYjOOOX4Bgo6bWGYKsfMg5k+lmy5n8uUxm8kkSs6Vw7Cstibc9Fv5vWQAAAABJRU5ErkJggg==\",\"comp/vscroll$up.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAzCAYAAABxCePHAAADF0lEQVRIS92WTUhUURTHz31vPv0KKmkXrtxUGNomkCANLdCUpEatJFuIClIEFRl9kGH0BYWQElLpotGKEJXAtKQooYUFpi1axLQZMCyyZJqv926cM2/uTM288emoUHfx3v16v3fuuef+72Hume/c7/cBAwaLKWaLBZjLPc0Zk0CSJGBs4SDOObDP7i9ckuXkIbLJRJDFFrJk2SGNvZNwy7ExoZEJLWnqfQ+4SlUFaHNs0gXpQhq6x0GWGe0Y7oCicGivyYsLigup7XgFJlkCJjFwNm2HqrZR4CqHoKLC3fr8GFAMpPLqEJhMoZjpay6Bnx4vpKfYoLx1kCwKBlXoOV78BygGsudCH1nwtNVBgHBBUFFzL1n0+Gx5YghOxhINiAbFG1uZODESxf+bJShKrulv8HUusp1G/IBz1qTZIGvdamBjU584Aopzs+lbDhwfFFgc2/imLq0fazgAHF5MumBtuh3YwJsPfGdeNqgY1qqqfcSprRLgr7rWZzWbwCTL8HLKFYEEgkrUn+eHIDzNbltBSG33O+jcnxNZmrYcw5Yc7hoXotRenRPyz0IgBzrGYkTp9qEtxiEV10eEKD08Wgh7bzwTonSvIV/soK5jd53rE6I0eGY3/PL5wWYxQ+nFgShRKqK6LqTwhJNEafRKNQHCcWK3WmDHqR5NlMoSQzAWUV+9vkBMsKXYLCSbs3Oe+SGqqupGrIL3h3YclifYkjo7yZ7izIzUUGrhnvXAzA+PURkR8xCwPnMVsCUVpW0bsiCUKOH9S0980JvaLJSQUTal9Q+9/RgRJQSgnvgCgdBkxkCKektSpC9cR0HCOQgiZUMI3njijwYg+COzLP9rkLr7E3Dn4Gbhp7BPDC+n0TkhlK2zJpccuSBIfVdsutVdt9U4pLbjtVC2B0cKYN/N50LZHh0rFGGguztV14aFsvWfLiVhSrVboaSlXyjbk/NlBNKFVLT0k7INX3KAx+sXfkBlKzjpJItGLlcmhmSkptAB83h9MTuCICxBRUkMwUmY5+uFPY7LmJ7GW05SZycsSos9xUsmSr8BfgGeWI6+BgEAAAAASUVORK5CYII=\",\"comp/button.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE0AAABFCAYAAAAPWmvdAAABA0lEQVR4Xu3ZMRGDUBRFwXwfKSgxFhfRgAbUxEakkCEO3qmX+p9m5w7NW9v7cz18I4EFbeT1fwxtbgYtmEGDVgRC458GLQiExNKgBYGQWBq0IBASS4MWBEJiadCCQEgsDVoQCImlQQsCIbE0aEEgJJZW0Pbj64Q3hFvQhmL3CQ8atLlAKCwNWhAIiaVBCwIhsTRoQSAklgYtCITE0qAFgZBYGrQgEBJLgxYEQmJp0IJASCwNWhAIiaUVtOfrdMIbwi1oQ7H7hAcN2lwgFJYGLQiExNKgBYGQWBq0IBASS4MWBEJiadCCQEgsDVoQCImlQQsCIbE0aEEgJJYGLQiExNIC2g/MxaMp6CSauwAAAABJRU5ErkJggg==\",\"view/bg_tool.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAMklEQVRYR+3QQREAAAjDMCYG/DsEGXxSBb2ke7YeiwECBAgQIECAAAECBAgQIEDgW+AAAeIuAVS/mngAAAAASUVORK5CYII=\",\"comp/minBtn.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAA8CAYAAAB1odqiAAAArUlEQVRYR+3X0QmAMAwE0GQN19B9nM193CmiIH7ZXOAoRc/fpjl8jVDdOj/eOc8USBcXqUjLAtDQRMSOdHb3JatTYCZUXodIy10bGxTI1Lx6/YA0Ima6W2tKFcjmdpGKtCow7NBAdxozy+804Gfx/cDqbLzWDzs0ekNY4B9nOMEehMKTVIEEyKeFSKmc18+MppRtipJuYPCa1SkwEyqvo6Tlxm8bFEijvBt9n/QA/fOPydLHcUIAAAAASUVORK5CYII=\",\"view/zoom_out.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAACy0lEQVRIS92WQU8TQRTH/28oQkj0CL0QOMAJQkz4DkS6A+GA+A00Hrhj0uy8NiTwEdBPAOrB0Fnq3U8g6gkOSjxUjpCQCu08M5u2qaVAt7YmOqfNZPa3b9/+Z35L6NOgPnHx98Gbm5sTlUplA0AGQBpACcBBKpXazmaz3+5607YVM/MjEXlNRPdbASJyTkRrzPz+Nvg1MDNPAvgI4AGA10qpvHPuSCk17ZwLAazV4HPM/PUmeDvwSwBPAbxl5sf+RmYWZo7XMvOehwPYYebnScAnAMaVUrNhGH5pBefz+Rnn3GcAJ8w8kQT8E8A9AEMA/HXrqM9fMrO/bjvataJvFdd7/IaZfS9/67ExZpeIngB4xczPklQ8KSKHPmoispdKpXKjo6PHp6enU5VKxXhoV6moVXhnjpVS5wDOwjD81K7qG7e033lXV1cviMjvvDEAP0TkYHBwcKtarT4UkXcALolo1RhTaIV3dVYYY9aIyOfZDw9fMcYUm+FdgWvtYgCmBisrpRbCMPxQh3cNbgM3zJzvCdhDcrncuojMA8gy8/eegTvO8U0Lk87/UY9ve9h/BI6iyJ+1GyLScB4RHQDYDoKgO+dFURSfFQCuOQ9A7LwgCJI5r1gsTlar1YbznHP5crl8NDw8PK2Uip3n4QMDA3OLi4udO89a23Ce1jp2nrVWtNbxh7bWxs4jop0gCDp3XhRFJyIy7pybXV5ejp3XDN7f359RSsXO01p37jxrbey8i4uLoZGRkWvOa5q/1Fp37rx+VtxwntY6dl5zK6Io2hWR2Hla686dV0vFoY+aP8xFJJdOp49LpdIUEZkaNHkqfIWd5JiIzkXkLAiCZM7zO09EYueJyBgRxc4joi0ADeeJyOrS0lJvnBdFkf8xbDhPKbWSyWR647xCocC+53XnAVjQWvfGeS1wo7XunfOstesA5pVS2Uwm8w877xeHf444cscwYAAAAABJRU5ErkJggg==\",\"view/refresh2.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAA/CAYAAAAPIIPGAAAEIElEQVRYR+2XTUhjVxTH/+fGpBrGT/xoBQdFFMMQLNLNbLooLbaFzqKMUhCSZwsuhGG6KCNd6DuRLgqzmGVxUd8LUrpoYWZTKO1yNi2F1oVtceEHflSLqNEav8bklPuqgsl75sUPSsucTQj33v895+R/7y+XcA1B16CJ/6GoYRiDItKfzWZjExMTv5/XtoLlx2Kxm0qp1wH0AHgTwC4RfWRZ1mdewp6ig4ODN9Lp9CMieh+AchH41Lbtj92EXUUHBgaCh4eH3wJ4zSObGSLqtSzrZ9+ihmF8CODR8YIflFL3MplMNxF9IiJWIBC4Pz4+/ldR5RuG8QuAlwGsAWi3bTsVj8dvAWhOJpPfFPK2a/mGYewDeAHAV7Zt9+aK9PX1VYRCoVcApNxa4CX6J4B6AE9t2341V9QwjO8AvAFg27btytxxL9EvAbynJxNRj2VZX58sjMfjd4joyT9D9NiyrHf9iup+/gggBCALQPfxVwARAO8cWywD4LZt2z/5EtWT+vv774rIBIBSlx/mmT5dyWTyC9+WOpkYi8XalVIPRKQbwItEpHv9PRE9tCzrt6IsVcgyhcYLnv1CAkWXfxFBxzEXXXipq+8imz7P9CJdO3+N754y86A+vYFAIDY8PHw58DHzTQB54DNNs3jwMfONY6R4go+Z/YNvbGwsuLKyci74APQys3/wMfMZ8InIPaVUt4g44AuHw/eHhoaKAx8znwEfM6dGR0dviUizaZoXA59pmvtE5ICPmfPAx8wVABzwubXA1VLM7IBPRJ4mEok88DHzKfiY2R/4mPkUfCLSk0gkTsHHzHdE5Immnog8TiQS/sDHzK7gE5EIEZ2CTyl1e2RkxD/4TNO8S0Su4BORZ0qpftM0iwefaZrtAB4QkQM+AA74ADxk5ufgc78CfV99xdy61yMajUbfAvA5gJeKycZj7gqADygajf5xRYIn+6xoUbmCDM9I/LuidXV1qK2txdzcHPb39ZPAOwpmGgqFUFFRgerqauczm81iaWkJa2v64eLhU6+eKqXQ1NTkZOcWq6urWF5edh1zzZSI0NbWhvLyctdFBwcHmJ2dxe7urn/R+vp6J0sd6XQaCwsLqKysRGNjI9bX17G4uIhMRr8jiig/EokgHA7j6OgIU1NTjkBZWRl0f7e2tgo60LX8rq4u/UjC5uamU2ZuBAIBZ1O9mVsLXEU7OztRUlKCnZ0dTE9P54nqfmsnaNHJycm8cVfRlpYW1NTUOJN1pjrjk6iqqkJra6vzNZVKYWZmxp+oLq2jo8NpgQ7dx729PZSWlkKL6hARpwr9Q+aGp/m12Zubm6H9mhtacH5+HhsbG/4tdTJTZ9bQ0OD0LxgMOm7Y3t6GNv55R7XgMS3oH5cJ/y3Rq775V3X5bx8zSv8DuWzoa2vgb5tumbHGlerDAAAAAElFTkSuQmCC\",\"view/settings2.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAA/CAYAAAAPIIPGAAAD2ElEQVRYR+1Xz08bRxT+ZjAGYQoH4rS9IBJBQJEsUC8VKNdQtamUE0fLayqhKHeOaGbFkT8gFVLZtXzk1qqKSs4NUg8RXCIQVoOQ2jRFHHCwBRj2VW+zttY/14BXVaPOyR7NfPN9771536xACEOEgImPDHRhYaHv/Pz8kEMVjUbjq6urxVZhayo/lUo9chzndTabfWMYxkMAGx7QrG3bL5LJ5B0p5f1MJvNz7QENQdPp9LdE9CMAZrcHYAaoxJ8AvARwD8AtAI9t2/7JD9wQdH5+/q7jOLzx04DqeCelnFlbW/s9EJQXGIbxq8eQ//4mhPieiJjlEwBf8qQQYtOyLFZRNeqYJpPJWCQSeUBEzz3JrwqFwvT6+vo575ybm4vGYrFNAF8AICnlbKlU2sxms4Uych2oYRh5AJ9UFggxb1mW5aeSTqfTRLTmm3tv2/bAVUCfWpb1zA9qGAaHwD/XGjQU+WVGHU0Ug4ZSUjXFnwMwXVP8nP1RAPG2i5/Z+q9pKpWaFUL8wvNE9FUmk9m48jWtLWavofztNZTb124oN2neH1mTvmoo/pcfHDGtdZ9nLbw4rrW+nvGZpvlISvl6aWnpjWmaD4nINT4hxKxS6sXy8vIdx3HuK6XaMz6ttWt8QohDInKNTwjhJtWzlJdCiHtEdEtK+VgpFWx8Wuu7RMQbWxofEb0TQsxordszPq11Q+MjoidCCNf4AGxqrYONb2VlJVYsFh84jvPck/yKW5/W2jU+rXWUwdj4OBQcYzbCxcXF5sanlMoLIaqMTylVZXymaVYZHxG9N02zufE1AH2qlKoyPqUUh6AyFwgaivzyVehoorxkdL6k/MUPIEdE0/7i5zcUGx8Rxdsufmbrv6ZKqSrjM01z48rXtLbFeA3FNT4At6/dUIJ7V/MV/6HOn0gkvgbwA4DPbyLZ2/sWwHcikUj82SHAMqe3DMrv+I6Ofw9USonJyUlXzfb2NhzHaamsKdPBwUGcnp7i7OwMAwMDGBsbc4H29vaQz+fR09OD3t5eHB8f1x3QEJQBR0dHcXFx4QL39/dXbTw5OXEBI5EIcrlcHXBDUGYxPj6O7u7uljJLpRJ2d3ddNf7RVD6DlhkWCgUcHrof0YjH44jFYu5vnt/Z2QmWz0lhsHIMi8Wiu/HDF6T7mMDExAT6+vjR8iHGHA5/8uqYTk1Noaurq3L6/v4+jo6OqtgMDQ1hZGSkMnd5eYmtra3K/0DQg4ODivTyLg7B8PBw+6ChyC8f39FEMWgoJRVK8TPbjl/T2mruWEO5SYMNo/P/xaDfeB712U3YeXv/ALDwD+TbY8Dbd9BBAAAAAElFTkSuQmCC\",\"view/setting.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAACAklEQVQ4T5XUS4iOcRTH8c9xCeVeiiiXhSJRJFIusRO2lEtZKFlgY6GxZDUrk2TFwii22JJLlERRLKRQJmXBkHIb8+hM/2d6ememed93957n93v+55zf9/mHll9VVTNxopTPR8T3piTyT1VVs7AL9zEd+4roOn5gK25HxLfacAjL8A8TWw6ta28jorc2LMLhIu7Ds2Jah4XlRVci4mNUVTUDadiLFF/G5GL4iyOYjxsYMnQ1BDfxujk0VmJPecFAO4bV2Nk05Bqzz3Za6ut86JJDx2vN4Hbj3hjBbcOt4eCaQZXUj5daT4pGoNFimI1zpdYVEf2jsTQX+5MX5NaOFdFFJHzJ2bWI+FJv6SRWYACTWliqa68ioqc2LMWpwtJ7PCymzVhSWOqOiHeZdPachqNIcXdBJV/2B6cLa5cwZLjQYOkqnuNsOeEM1uJgE43xDBsaH9QQfJ21VNBoHfpBaWHLiKGLoeO1ZnAHkpcxgkvOeoeDa0FjTnNLEfF1PJamYkcR3YmIX6OxNA35Kb7BFKwvoqf4jeV4GRE/azQ2Yh4GMaGFpbr2OSKe1Ibse1MRJ84fimkxMqc0Pc55MrjsOYvZRoofNW6/vPUSwEQ+2+tPQ14h9fX4Ap+aQ2MB1pQTB9sx5K24qmnorKWCRvtDF0PHa+0suBaW0ry91O5mus3n/wHmQwUTIH+tVgAAAABJRU5ErkJggg==\",\"view/refresh.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAkCAYAAAC9itu8AAACiElEQVQ4T4WVS4iPYRTGf4/7/X6XcivXcktEUhTKQkqyYCOKjWyUhezFThbIlJ3LYrIRkoWGUhhhTMko4zJujYRpxgxHj9737/P3zfh239c57/uc5/zO+UQ3T0QsBRYCtZI+5jBVx0fEcGA6MA+YCXQCVyXddWwlISL6ARuARcXvhQPrJF3/nRARvYHtwLRuFLYCFyW15ITl6XTHvwIuJzlrgHrgiqSOiqSI2ANMAL4BxyW1R8RYYKSkp8Vb8w2HgD7AE0kXSozoD0wC2nPCAWAw0CyppiRhBzAD6MgJW4D5KdDFNeSkiJgFbEvONeYE698N2K0ArPsDMAZwguN+AmeKfZgLbAb6llj7A7gk6eFfnY6I0cDKpNc1tQFNwG1JvvFPp0sKXQ2sAGokveuJpVHAHGBJ4ul76vLNapbs9dYk6R8oU7driyztA2Z3w5L1n5LUnBPWptMd/xw4l+RscsHAeeNSZMloTAG+AIcltUXERPdB0qMylk4klu5LOlni2ABgqm3Oko4BQ4Fnko6WJOxPzlXg2wV4hv2czuOYhmsBsDf1rD7fYP0HkyyzZN0twHjACZmlI0WWFgM7e2DprKQ71SyNA9YDBnFYcq0RuOZ5/h9LdsVS6yV97YmlgYDn2X3wjUa7QdKLapY8015ePrWMJVtembhewLI0YWU4eZvck/Q525pXo4M/AY+TLMP40u+SuooseVjsitm/IakzItz5QcXhKSZsBCyrpdjlwuZwfSO8mLOkdYAHqFXSrRKWvErtXFdOcJcnp0AX96ZwuldQ5uxtTrD+VUmWWXqfujwk8eQ4f68rsuRG+d/gZVb9eIk9kPS6miXvIv91rNc12TXPc5MkTyO/AFhJCujHqZlCAAAAAElFTkSuQmCC\",\"comp/checkbox.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAqCAYAAACDdWrxAAABbUlEQVRIS+2TP0gCURzHv88GRYsrExyOo5cEQVEtWdQQpE4N0R+HxmirXXCrKYigqMF2IRqCQByaLJqNIFpyUIzu4rIwpExODy88ITD/cJ603Rsf7/OGz+/zI5TSEAE20cZRgBMySKni8XrbwICrWAwG2ESZIadFS53J0R25brCyHZNud1vbcRuPV7fDAOu9GXJatNSZHN2R6wb/PfJCrxOZCR8Gbk6hWc6Xg8PrcgBETMIVPdIGSjYG/NoOSHcfkLqDK3qsBSRIrgRAuBF1quUPEUPhYGMwb2dhywrqQ3F0Dt++jSokJMBdhmDO52pB2WwFP7OK8rgH9os99IgppNf3QWwMFP4RNHKALrmoflIj53l6CaWpRcBkgiIkYHl6gDTrh5JJg57v/kJ1YOUixw7jfWELxMpAKUmAXAR7tg3LZ7am3IbjKDBOvPiDqkUmcoj+9H1d7k3nmHdweBubB70ON9wRzQH8pVVQb+Q/zZAEfpwDCU4AAAAASUVORK5CYII=\",\"comp/btn_close.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAA8CAYAAAB1odqiAAAE6UlEQVRYR+3Y30+bVRgH8G/T0t/0Jy0USrIsC0E2GMKAVYcRpmSbEzIGZhqyxCxeceGVF3pjvJl/wYyJWZYY4hZBFnBuBBUW2ewYAxlsSMiyLKH8aEt/0vZtSxvM+562We15C6jlxr53zfO8z+ec5z2nOTmCk598tY19fAQs+Hlvz76QX1zpAwd+1NMNXzieU1QtFeKbvn4CXvqgC95wLKegRirC1e8GCPjh+53wMnRwedkG54aLG4yhSI/ycnPawHaKJ5M1MhGuXR8k4MX3OnjBx3NPcLX3DPfepSu3odfrYC4r5X7bVlbhcrnT4kdrjlA7xYLffj9EwJ6udnhCW9TEJ08XUgWTqE6n5XLdbk9G7MjhKmodrbwAfQPDBLxw7h1ecH3dDq/Xm1GYrZqceXIgGo0GJSXFvOCNmz8RsLv9NNyhKO+icTqc8Pl8acDLyWyr1Wo1DEYDbw2dXIz+4TsE7DzbBneQH2SruDZc8Pv9GSiLqVQq6Iv0WVe5TiHG4K1RAnaceguuYCTrCx63G4FAgAoqlUpodbqs7+sVEgyN/ELAs20t2Ajwgz6vF6FgMGtL5QoF1BoNL1qklODW6DgBT518gxcM+P1gQqFdLRqZXA6lSkVFWXDk198I2NZyAs7NMDXR7XRmYBKZjMuNMEzmljHQF46hUIrR8XsEbG228IJ+T/rGFkskkMoVHBgOBRGNRNI2vkpL/5YsODZhJeCbJ47D4WeoM4wyDLai5PsWiCUQJ2aXTN4pnswzqmS4e+8BAZstDbxg1qW3hyALTlinCPh6Uz1C0Rg2w/S/tz3UpaYWSgsgF4twf3IagvOXr297PR5YGuv+bd2s71sfzkCj1ULQe+3u9vraGlg0lw+LlZhMEIzUNu7vmYYFmz/9LJeTS9We+PIymaGl6wLizo2cokJDEawDNxLg+W7EHTkGjUWw/tBPwOMdnYg7nNQZep4/Q2B9jYspS0zQHjyUlrdTPJksNBrwYGiQgE3vtiNup4O2SSuOzk5y7z2ubYKyuBiaAwe5394XzxGw29Pi5iYLdeDCYgMmfxxOgKfPIG53UBNt049SBVNo4g864HRmxMz1x3hAIybv3CZg49ttiK/bqYneFRuCLldGYTY5OfPkQBR6PTRl6cfIVEtLivHw51ECNrS2Ir62zrtKfWtrCHo8acDLyWyrFVot1CYTbw2hqQRTY2MJsLk5K8hW8TkcCPp8GSiHqdVQG41ZtxUHTkwQ8NhrFsRXyUrke3wuF0L+TSooVxVCrc9+iBKWmvDodysB65saEFtZ5cX8Hi+YQDBrS2VKBVRa/jONqKwU05NTBKyrexWxlRUquOnfBBNidrVoZHIZClWF1DqisjLMzPxBwNraasRsdHDD6c7ApDIJVzTMRDJiRQb6EUNkLsPs7DwBa6qrELPZqCNzu/1pG1siEUOhkHK5wWAYkUg0La7T0U9tIrMZc/MLBKw+XImtZTrIMBFEouQkIBEXQJaYXXJ0O8WTeQXlZsw/XSRg1SsVvGDWpbuHIAsu/LlEwMrKCsQDAcQ93j2U2H2qUKuBUKnE4uISBF9f/Hj7wJwVhyordl/hH2Q+W1zCixoLOdNUj98Ei+byYbH5lnPkmJhL6O+18/c0/1m38/c0qVbm72nYVuTvadgu5O9pUtsif0+Tv6dhF8P/657mLz4NfQVdLmZiAAAAAElFTkSuQmCC\",\"comp/textarea.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAAXCAYAAABkrDOOAAAA4klEQVRoQ+3ZvQrCMBiF4e9rU+sPOErRqxDRe/KG9Fp0EAc3VzuIg1ML4uDmlkaaquDenMUTyJoDD+8W3ZyKlaoshSeogHOy1m1euOmoI1EU+auqQUf/8XHnnBzLp3jsWdaVJEnEGEPsADXU2Ifro8Gej/uSpqnHruvmaVegqirZX+4N9mIy8Nh13XEct7vE18RaK7vzjdiIFoiNUH5vEJvYQAHgFMsmNlAAOMWyiQ0UAE6xbGIDBYBTLJvYQAHgFMsmNlAAOMWyiQ0UAE79lM2fmrDy358a/q6Hhf68ng175QueKdEXxUGVVwAAAABJRU5ErkJggg==\",\"view/re.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAACpklEQVRIS+WWPUgcQRiG3+8O70QEUwTB1EJgsTGdRRrhOMjOtEtSRbBIBMFKuCtkZleES2uRQoWQJggKKW7Of7GyTRvBLkVShhS73OXMfWGOU85Es7uXs0m2XeZh+OZ95xnCHX10R1ykBvu+P5fP59+VSqVvf9pUarBS6jWAR0Q0rbWOboP3BCaiOQAHAKTW+vtN8L8BW96W4zjPPM/78Ss8FlypVEYajYbHzALAJIAHALJdoDWl1Esi4m74rWBmpiAI5pk5AHAvJj0VrXU5Fmyhvu+/AfA8YRxfaa1LsWDf92eZeSMJlJnXtdYvEo1Ca30G4GEH/ImI1lqt1nE+nz9vNBrLnVTY39uO4zxNdHgrKytjzWbzs13FzKfDw8PFxcXF8HL3Nscd8BEAN3HcgiCYbLVaHyyIiGaUUm+7R9JzQZRSo0T0BUCGmRd831/tBttK53K5zXK5/DV1pZVSG0Q0C2BXa/0kySEmKojWeoiZD4hoKpvNTiwtLX1MC7+1IFrrQWZeJaJxx3EKN5186lF0LwiC4DEz31dKvU+z69i7Ig0stnm9wv4zsDGm7bxCodBf5xlj2s5j5mkpZf+c1wHPEdFBGIbS87z+OO8S3EnAVhRFvTnv8PBwpF6ve0QkiGiSmX9znuu66ZxXq9XmAcQ6j5krUspkzqvVaqmcJ4SId54xxl6ZiZwHYN113WTOq1arZ0R05TwAa5lM5rher5/ncrllAPYl1HZeFEXJnLe3tzd2cXHRdh6A04GBgWKxWLxyXlcqjqIochPHbWdn58p5AGaEENec13NB9vf3R5vNZtt5RLTguu4159lKA9gUQqR3njHGHpx9tOxKKfvnvGq1OmQrC2AKwIQQon/OOzk5GQzD0I5hPIqi/jvPGNN2npTyH3feTzoJOzgswwlqAAAAAElFTkSuQmCC\",\"view/search.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAqCAYAAABcOxDuAAABX0lEQVRIS+3VsUrEQBAG4H9HiDZiJQg+gJVaiKAoWClYXWeZ7D6CtbWFr5Ai2ayQxkLQRgsLGwtBUQsRC6sDCxHxEIvIZSRwxRGSu83pNUe23c0H+89kR2AISwzBxAiinuctCSH2AawD+AFwRkR7QRC85CO0ur5SaoOZzwGM54A3IlrJw1aolPIewEJJUY+01jvde31RKeUMgNceXdLSWk9VQl3XnSWiZhnKzF9RFE1WQrPDUsonAHNFsBDiJAzDRmXUdd1tIjoFMJaDW0KI1TAMH61RpdQ0Mx8z8zMzHxLRAYBlAG0Al2ma7hpjHqxbqgNeAJgHcKW1XutEMeE4Ttv3/axXC1dh9XPgbZqmW8aYd9t3ohCVUt4BWARwkyTJZhzHH7Zgdq4MvQbw7ThOw/f9zypgKVoVsS7UX+C+v+kgeI0Oklrvb0Yw03rwlZW8Hnz14OvqjXrw1e/pPyfwCww91CttlMG7AAAAAElFTkSuQmCC\",\"view/save.png\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAoCAYAAAD6xArmAAAA1klEQVRIS+2VzQ3DIAyFwxwdoMMAA/VQ8ZByyEBhmA7QOVxxKLIaOcIoSZUfrlifHw/wM91Ky6zE7SZgANTaDEDhzYJ5odSMC7nA5U7+b4X2dVQr3ic4hHCTlMcY33xPZUUGcwBvdEJwjcfGGIQQ4rd2qenWA3hyAUuABwCP31NtN+i1v02qP4DicRybM885J2ceB/NCyUupfuLxBS4WbmKF9rNUv4p9gq21d0l5SunF91RWZDAH8EYnBNd4nDPPWitnXst0I6Leez+feVowEQ3e+wNk3ge7C/Qp3GfwkgAAAABJRU5ErkJggg==\"};},'base64',function(){return this.base64=new Base64Atlas(Base64AtlasManager.dataO);}\r\n\t]);\r\n\treturn Base64AtlasManager;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.DebugPanel\r\nvar DebugPanel=(function(){\r\n\tfunction DebugPanel(){\r\n\t\tthis.tShowObj=null;\r\n\t\tthis.preValueO={};\r\n\t\tthis.div=null;\r\n\t\tthis.debug_view=null;\r\n\t\tthis.height=300;\r\n\t\tthis.clickedHandler=null;\r\n\t\tthis.fromMe=false;\r\n\t\tthis._treeDataList=null;\r\n\t\tthis._init();\r\n\t}\r\n\r\n\t__class(DebugPanel,'laya.debug.DebugPanel');\r\n\tvar __proto=DebugPanel.prototype;\r\n\t__proto.removeNoDisplayKeys=function(arr){\r\n\t\tvar i=0;\r\n\t\tfor (i=arr.length-1;i >=0;i--){\r\n\t\t\tif (DebugPanel.noDisplayKeys[arr[i]]){\r\n\t\t\t\tarr.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.updateShowKeys=function(){\r\n\t\tDebugPanel.tObjKeys.length=0;\r\n\t\tif (!this.tShowObj)\r\n\t\t\treturn;\r\n\t\tDebugPanel.tObjKeys=ClassTool.getObjectDisplayAbleKeys(this.tShowObj,DebugPanel.tObjKeys);\r\n\t\tif (this.tShowObj==Laya.stage){\r\n\t\t\tthis.removeNoDisplayKeys(DebugPanel.tObjKeys);\r\n\t\t}\r\n\t\tDebugPanel.tObjKeys.sort(MathUtil.sortSmallFirst);\r\n\t}\r\n\r\n\t__proto._init=function(){\r\n\t\tvar _$this=this;\r\n\t\tthis.div=Browser.document.createElement('div');\r\n\t\tBrowser.document.body.appendChild(this.div);\r\n\t\tthis.clickedHandler=new Handler(this,this.onClickSelected);\r\n\t\tthis.debug_view=Browser.window.layaair_debug_view;\r\n\t\tthis.debug_view.initLayaAirDebugView(this.div);\r\n\t\tthis.debug_view.tree.attachEvent(\"onSelect\",function(id){\r\n\t\t\tvar dataO;\r\n\t\t\tdataO=_$this.getDataByID(id,_$this._treeDataList[0]);\r\n\t\t\tif (dataO.target){\r\n\t\t\t\tDebugTool.showDisBound(dataO.target);\r\n\t\t\t\t_$this.showTargetInfo(dataO.target);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.debug_view.setValueChangeHandler(function(data,new_value){\r\n\t\t\t_$this.onValueChange(data,new_value);\r\n\t\t});\r\n\t\tthis.debug_view.onRefresh(function(){\r\n\t\t\tDebugPanel.I.setRoot(Laya.stage);\r\n\t\t});\r\n\t\tthis.debug_view.onInspectElement(function(){\r\n\t\t\tClickSelectTool.I.beginClickSelect(_$this.clickedHandler);\r\n\t\t});\r\n\t\tthis.debug_view.onLogInfo(function(){\r\n\t\t\tconsole.log(_$this.tShowObj);\r\n\t\t});\r\n\t\tthis.debug_view.onPrintEnabledNodeChain(function(){\r\n\t\t\tDebugTool.traceDisMouseEnable(_$this.tShowObj);\r\n\t\t});\r\n\t\tthis.debug_view.onPrintSizeChain(function(){\r\n\t\t\tDebugTool.traceDisSizeChain(_$this.tShowObj);\r\n\t\t});\r\n\t\tthis.debug_view.onToggleVisibility(function(selectd){\r\n\t\t\tif (_$this.tShowObj){\r\n\t\t\t\t_$this.tShowObj.visible=_$this.debug_view.getVisibility();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.debug_view.onToggleDebugBorder(function(selectd){\r\n\t\t\tif (!_$this.tShowObj)\r\n\t\t\t\treturn;\r\n\t\t\tSpriteRenderHook.showDisplayBorder(_$this.tShowObj,_$this.debug_view.getShowDebugBorder());\r\n\t\t});\r\n\t\tthis.debug_view.onToggleShowCurrentCache(function(selectd){\r\n\t\t\tCacheAnalyser.showRecacheSprite=_$this.debug_view.getShowCurrentCache();\r\n\t\t});\r\n\t\tthis.debug_view.onToggleShowAllCache(function(selectd){\r\n\t\t\tCacheAnalyser.showCacheSprite=_$this.debug_view.getShowAllCache();\r\n\t\t});\r\n\t\tthis.debug_view.onToggleShowAtlas(function(selectd){\r\n\t\t\tconsole.log(\"toggle show atlas:\",_$this.debug_view.getShowAtlas());\r\n\t\t\tif (_$this.debug_view.getShowAtlas()){\r\n\t\t\t\tAtlasTools.getInstance().start();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tAtlasTools.getInstance().end();\r\n\t\t\t}\r\n\t\t});\r\n\t\tJSTools.showToBody(this.div,0,0);\r\n\t\tLaya.stage.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.adptPos);\r\n\t\tthis.adptPos();\r\n\t}\r\n\r\n\t__proto.onClickSelected=function(target){\r\n\t\tvar dataO;\r\n\t\tif (!this._treeDataList)\r\n\t\t\treturn;\r\n\t\tthis.debug_view.tree.selectItem(IDTools.getObjID(target));\r\n\t\tthis.debug_view.bounceUpInspectButton();\r\n\t}\r\n\r\n\t__proto.updateLoop=function(){\r\n\t\tif (this.tShowObj){\r\n\t\t\tthis.showTargetInfo(this.tShowObj);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onSelectItem=function(obj){\r\n\t\tvar tTarget;\r\n\t\ttTarget=obj.target;\r\n\t\tthis.showTargetInfo(tTarget);\r\n\t}\r\n\r\n\t__proto.onValueChange=function(obj,newValue){\r\n\t\tif (obj[\"type\"]==\"number\"){\r\n\t\t\tnewValue=DebugPanel.mParseFloat(newValue);\r\n\t\t}\r\n\t\tif (obj[\"type\"]==\"boolean\"){\r\n\t\t\tnewValue=newValue.toString()==\"true\";\r\n\t\t}\r\n\t\tif (this.tShowObj){\r\n\t\t\tvar key;\r\n\t\t\tkey=obj[\"key\"];\r\n\t\t\tthis.preValueO[key]=this.tShowObj[key]=newValue;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.showTargetInfo=function(tTarget){\r\n\t\tif (!tTarget)\r\n\t\t\treturn;\r\n\t\tthis.debug_view.setVisibility(tTarget.visible);\r\n\t\tthis.debug_view.setShowDebugBorder(SpriteRenderHook.isDisplayShowBorder(tTarget));\r\n\t\tvar i=0,len=0;\r\n\t\tlen=DebugPanel.tObjKeys.length;\r\n\t\tvar key;\r\n\t\tif (this.tShowObj==tTarget){\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tkey=DebugPanel.tObjKeys[i];\r\n\t\t\t\tif (this.preValueO[key] !=tTarget[key]){\r\n\t\t\t\t\tthis.debug_view.changeValueByLabel(key,tTarget[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.tShowObj=tTarget;\r\n\t\t\tthis.updateShowKeys();\r\n\t\t\tvar dataList;\r\n\t\t\tdataList=DebugPanel.getObjectData(tTarget);\r\n\t\t\tthis.debug_view.setContents(dataList);\r\n\t\t}\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=DebugPanel.tObjKeys[i];\r\n\t\t\tthis.preValueO[key]=tTarget[key];\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.adptPos=function(){\r\n\t\tif (this.fromMe)return;\r\n\t\tthis.fromMe=true;\r\n\t\tJSTools.setPos(this.div,0,Browser.clientHeight-this.height);\r\n\t\tthis.debug_view.resize(Browser.clientWidth,this.height);\r\n\t\tif (!DebugPanel.overlay){\r\n\t\t\tLaya.stage.setScreenSize(Browser.clientWidth *Browser.pixelRatio,(Browser.clientHeight-this.height)*Browser.pixelRatio);\r\n\t\t}\r\n\t\tthis.fromMe=false;\r\n\t}\r\n\r\n\t__proto.setRoot=function(sprite){\r\n\t\tvar mtreeo;\r\n\t\tmtreeo=DebugPanel.getSpriteTreeArr(sprite);\r\n\t\tthis._treeDataList=[mtreeo];\r\n\t\tvar wraped;\r\n\t\twraped={};\r\n\t\twraped.id=0;\r\n\t\twraped.item=[mtreeo];\r\n\t\tthis.debug_view.setTree(wraped);\r\n\t\tLaya.timer.loop(500,this,this.updateLoop);\r\n\t}\r\n\r\n\t__proto.getDataByID=function(targetID,nodeO){\r\n\t\tif (!nodeO)\r\n\t\t\treturn null;\r\n\t\tif (targetID==nodeO.id)\r\n\t\t\treturn nodeO;\r\n\t\tvar childs;\r\n\t\tchilds=nodeO[\"item\"];\r\n\t\tif (!childs)\r\n\t\t\treturn null;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=childs.length;\r\n\t\tvar tRst;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttRst=this.getDataByID(targetID,childs[i]);\r\n\t\t\tif (tRst)\r\n\t\t\t\treturn tRst;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.getDataByTarget=function(target,nodeO){\r\n\t\tif (!nodeO)\r\n\t\t\treturn null;\r\n\t\tif (target==nodeO.target)\r\n\t\t\treturn nodeO;\r\n\t\tvar childs;\r\n\t\tchilds=nodeO[\"item\"];\r\n\t\tif (!childs)\r\n\t\t\treturn null;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=childs.length;\r\n\t\tvar tRst;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttRst=this.getDataByTarget(target,childs[i]);\r\n\t\t\tif (tRst)\r\n\t\t\t\treturn tRst;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tDebugPanel.init=function(underGame,bgColor){\r\n\t\t(underGame===void 0)&& (underGame=true);\r\n\t\t(bgColor===void 0)&& (bgColor=\"#ffffff\");\r\n\t\tif (!DebugPanel.I){\r\n\t\t\tDebugPanel.overlay=!underGame;\r\n\t\t\tDivScripts.init();\r\n\t\t\tDebugTool.initBasicFunctions();\r\n\t\t\tRenderSpriteHook.init();\r\n\t\t\tSpriteRenderHook.init();\r\n\t\t\tDebugPanel.I=new DebugPanel();\r\n\t\t\tDebugPanel.I.setRoot(Laya.stage);\r\n\t\t\tCacheAnalyser.showRecacheSprite=false;\r\n\t\t\tif (bgColor){\r\n\t\t\t\tDebugPanel.I.div.style.background=bgColor;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tDebugPanel.getSpriteTreeArr=function(sprite){\r\n\t\tvar rst;\r\n\t\trst={};\r\n\t\trst[\"text\"]=\"\"+ClassTool.getNodeClassAndName(sprite);\r\n\t\trst.target=sprite;\r\n\t\tIDTools.idObj(sprite);\r\n\t\trst.id=IDTools.getObjID(sprite);\r\n\t\tvar childs;\r\n\t\tchilds=sprite._childs;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=childs.length;\r\n\t\tvar tchild;\r\n\t\tvar childsList;\r\n\t\tchildsList=[];\r\n\t\trst[\"item\"]=childsList;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tchildsList.push(DebugPanel.getSpriteTreeArr(childs[i]));\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugPanel.getObjectData=function(data){\r\n\t\tvar dataList;\r\n\t\tvar tData;\r\n\t\tvar key;\r\n\t\tvar tValue;\r\n\t\tvar tType;\r\n\t\tdataList=[];\r\n\t\tvar keys;\r\n\t\tkeys=DebugPanel.tObjKeys;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=keys[i];\r\n\t\t\ttValue=data[key];\r\n\t\t\ttType=typeof(tValue);\r\n\t\t\tif (key.charAt(0)==\"_\")\r\n\t\t\t\tcontinue ;\r\n\t\t\tif (DebugPanel.displayTypes[tType]){\r\n\t\t\t\ttData={};\r\n\t\t\t\ttData[\"key\"]=key;\r\n\t\t\t\ttData[\"value\"]=tValue;\r\n\t\t\t\ttData[\"type\"]=tType;\r\n\t\t\t\tdataList.push(tData);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dataList;\r\n\t}\r\n\r\n\tDebugPanel.mParseFloat=function(v){\r\n\t\tvar rst=NaN;\r\n\t\trst=parseFloat(v);\r\n\t\tif (isNaN(rst))\r\n\t\t\treturn 0;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugPanel.I=null;\r\n\tDebugPanel.overlay=false;\r\n\tDebugPanel.ChildrenSign=\"item\";\r\n\tDebugPanel.LabelSign=\"text\";\r\n\tDebugPanel.tObjKeys=[];\r\n\t__static(DebugPanel,\r\n\t['displayTypes',function(){return this.displayTypes={\"boolean\":true,\"number\":true,\"string\":true};},'displayKeys',function(){return this.displayKeys=[[\"x\",\"number\"],[\"y\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],[\"width\",\"number\"],];},'noDisplayKeys',function(){return this.noDisplayKeys={\"desginWidth\":true,\"desginHeight\":true };}\r\n\t]);\r\n\treturn DebugPanel;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-24 下午3:00:38\r\n*/\r\n//class laya.debug.DebugTool\r\nvar DebugTool=(function(){\r\n\tfunction DebugTool(){}\r\n\t__class(DebugTool,'laya.debug.DebugTool');\r\n\t__getset(1,DebugTool,'target',function(){\r\n\t\treturn DebugTool._target;\r\n\t\t},function(v){\r\n\t\tDebugTool._target=v;\r\n\t});\r\n\r\n\t__getset(1,DebugTool,'isThisShow',function(){\r\n\t\treturn false;\r\n\t});\r\n\r\n\t/**\r\n\t*设置是否显示帧率信息\r\n\t*@param value 是否显示true|false\r\n\t*/\r\n\t__getset(1,DebugTool,'showStatu',null,function(value){\r\n\t\tif (value){\r\n\t\t\tStat.show();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tStat.hide();\r\n\t\t\tDebugTool.clearDebugLayer();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*是否自动显示点击对象的边框\r\n\t*@param value\r\n\t*/\r\n\t__getset(1,DebugTool,'showBound',function(){\r\n\t\treturn DebugTool._showBound;\r\n\t\t},function(value){\r\n\t\tDebugTool._showBound=value;\r\n\t\tif (!DebugTool._showBound){\r\n\t\t\tDebugTool.clearDebugLayer();\r\n\t\t}\r\n\t});\r\n\r\n\tDebugTool.getMenuShowEvent=function(){\r\n\t\tif (Browser.onMobile){\r\n\t\t\treturn /*laya.events.Event.DOUBLE_CLICK*/\"doubleclick\";\r\n\t\t\t}else{\r\n\t\t\treturn /*laya.events.Event.RIGHT_CLICK*/\"rightclick\";\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.init=function(cacheAnalyseEnable,loaderAnalyseEnable,createAnalyseEnable,renderAnalyseEnable,showCacheRec){\r\n\t\t(cacheAnalyseEnable===void 0)&& (cacheAnalyseEnable=true);\r\n\t\t(loaderAnalyseEnable===void 0)&& (loaderAnalyseEnable=true);\r\n\t\t(createAnalyseEnable===void 0)&& (createAnalyseEnable=true);\r\n\t\t(renderAnalyseEnable===void 0)&& (renderAnalyseEnable=true);\r\n\t\t(showCacheRec===void 0)&& (showCacheRec=false);\r\n\t\tDebugTool.enableCacheAnalyse=cacheAnalyseEnable;\r\n\t\tif (DebugTool.enableCacheAnalyse){\r\n\t\t\tRenderSpriteHook.init();\r\n\t\t}\r\n\t\tif (renderAnalyseEnable){\r\n\t\t\tSpriteRenderHook.init();\r\n\t\t}\r\n\t\tDebugTool.enableNodeCreateAnalyse=createAnalyseEnable;\r\n\t\tif (DebugTool.enableNodeCreateAnalyse){\r\n\t\t\tClassCreateHook.I.hookClass(Node);\r\n\t\t}\r\n\t\tif (loaderAnalyseEnable){\r\n\t\t\tLoaderHook.init();\r\n\t\t}\r\n\t\tCacheAnalyser.showCacheSprite=showCacheRec;\r\n\t\tNodeInfoPanel.init();\r\n\t\tDebugTool.initBasicFunctions();\r\n\t}\r\n\r\n\tDebugTool.initBasicFunctions=function(){\r\n\t\tDisplayHook.initMe();\r\n\t\tif (!DebugTool.debugLayer){\r\n\t\t\tDebugInfoLayer.init();\r\n\t\t\tDebugTool.debugLayer=DebugInfoLayer.I.graphicLayer;\r\n\t\t\tDebugTool.debugLayer.mouseEnabled=false;\r\n\t\t\tDebugTool.debugLayer.mouseThrough=true;\r\n\t\t\tDebugTool.showStatu=true;\r\n\t\t\tLaya.stage.on(/*laya.events.Event.KEY_DOWN*/\"keydown\",null,DebugTool.keyHandler);\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.IMAGE*/0x01]=\"IMAGE\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.ALPHA*/0x02]=\"ALPHA\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.TRANSFORM*/0x04]=\"TRANSFORM\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.CANVAS*/0x10]=\"CANVAS\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.GRAPHICS*/0x200]=\"GRAPHICS\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.CUSTOM*/0x400]=\"CUSTOM\";\r\n\t\t\tDebugTool.cmdToTypeO[ /*laya.renders.RenderSprite.CHILDS*/0x800]=\"CHILDS\";\r\n\t\t\tDebugExport.export();\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.dTrace=function(str){\r\n\t\tif (DebugTool._traceFun !=null){\r\n\t\t\tDebugTool._traceFun(str);\r\n\t\t}\r\n\t\tconsole.log(str);\r\n\t}\r\n\r\n\tDebugTool.keyHandler=function(e){\r\n\t\tvar key;\r\n\t\tkey=String.fromCharCode(e.keyCode);\r\n\t\tif (!e.altKey)\r\n\t\t\treturn;\r\n\t\tswitch (e.keyCode){\r\n\t\t\tcase 38:\r\n\t\t\t\tDebugTool.showParent();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 40:\r\n\t\t\t\tDebugTool.showChild();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 37:\r\n\t\t\t\tDebugTool.showBrother(DebugTool.target,1);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 39:\r\n\t\t\t\tDebugTool.showBrother(DebugTool.target,-1);\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tDebugTool.dealCMDKey(key);\r\n\t}\r\n\r\n\tDebugTool.dealCMDKey=function(key){\r\n\t\tswitch (key){\r\n\t\t\tcase \"上\":\r\n\t\t\t\tDebugTool.showParent();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"下\":\r\n\t\t\t\tDebugTool.showChild();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"左\":\r\n\t\t\t\tDebugTool.showBrother(DebugTool.target,1);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"右\":\r\n\t\t\t\tDebugTool.showBrother(DebugTool.target,-1);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"B\":\r\n\t\t\t\tDebugTool.showAllBrother();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"C\":\r\n\t\t\t\tDebugTool.showAllChild();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"E\":\r\n\t\t\t\tDebugTool.traceDisMouseEnable();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"S\":\r\n\t\t\t\tDebugTool.traceDisSizeChain();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"D\":\r\n\t\t\t\tDisControlTool.downDis(DebugTool.target);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"U\":\r\n\t\t\t\tDisControlTool.upDis(DebugTool.target);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"N\":\r\n\t\t\t\tDebugTool.getNodeInfo();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"M\":\r\n\t\t\t\tDebugTool.showAllUnderMosue();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"I\":\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"O\":\r\n\t\t\t\tObjectCreateView.I.show();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"L\":\r\n\t\t\t\tDisController.I.switchType();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"Q\":\r\n\t\t\t\tDebugTool.showNodeInfo();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"F\":\r\n\t\t\t\tDebugTool.showToolPanel();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"P\":\r\n\t\t\t\tDebugTool.showToolFilter();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"V\":\r\n\t\t\t\tDebugTool.selectNodeUnderMouse();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"A\":\r\n\t\t\t\tif (NodeToolView.I.target){\r\n\t\t\t\t\tMouseEventAnalyser.analyseNode(NodeToolView.I.target);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"K\":\r\n\t\t\t\tNodeUtils.traceStage();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"T\":\r\n\t\t\t\tDebugTool.switchNodeTree();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"R\":\r\n\t\t\t\tRenderCostRankView.I.show();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"X\":\r\n\t\t\t\tNodeTree.I.fresh();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"mCMD\":\r\n\t\t\t\tDebugTool.traceCMD();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"allCMD\":\r\n\t\t\t\tDebugTool.traceCMDR();\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\tDebugTool.switchNodeTree=function(){\r\n\t\tToolPanel.I.switchShow(/*laya.debug.view.nodeInfo.ToolPanel.Tree*/\"Tree\");\r\n\t}\r\n\r\n\tDebugTool.analyseMouseHit=function(){\r\n\t\tif (DebugTool.target)\r\n\t\t\tMouseEventAnalyser.analyseNode(DebugTool.target);\r\n\t}\r\n\r\n\tDebugTool.selectNodeUnderMouse=function(){\r\n\t\tDisplayHook.instance.selectDisUnderMouse();\r\n\t\tDebugTool.showDisBound();\r\n\t\treturn;\r\n\t}\r\n\r\n\tDebugTool.showToolPanel=function(){\r\n\t\tToolPanel.I.switchShow(/*laya.debug.view.nodeInfo.ToolPanel.Find*/\"Find\");\r\n\t}\r\n\r\n\tDebugTool.showToolFilter=function(){\r\n\t\tToolPanel.I.switchShow(/*laya.debug.view.nodeInfo.ToolPanel.Filter*/\"Filter\");\r\n\t}\r\n\r\n\tDebugTool.showNodeInfo=function(){\r\n\t\tif (NodeInfoPanel.I.isWorkState){\r\n\t\t\tNodeInfoPanel.I.recoverNodes();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tNodeInfoPanel.I.showDisInfo(DebugTool.target);\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.switchDisController=function(){\r\n\t\tif (DisController.I.target){\r\n\t\t\tDisController.I.target=null;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif (DebugTool.target){\r\n\t\t\t\tDisController.I.target=DebugTool.target;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.showParent=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tDebugTool.target=sprite.parent;\r\n\t\tDebugTool.autoWork();\r\n\t}\r\n\r\n\tDebugTool.showChild=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (sprite.numChildren > 0){\r\n\t\t\tDebugTool.target=sprite.getChildAt(0);\r\n\t\t\tDebugTool.autoWork();\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.showAllChild=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tDebugTool.selectedNodes=DisControlTool.getAllChild(sprite);\r\n\t\tDebugTool.showSelected();\r\n\t}\r\n\r\n\tDebugTool.showAllUnderMosue=function(){\r\n\t\tDebugTool.selectedNodes=DisControlTool.getObjectsUnderGlobalPoint(Laya.stage);\r\n\t\tDebugTool.showSelected();\r\n\t}\r\n\r\n\tDebugTool.showParentChain=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\treturn;\r\n\t\tDebugTool.selectedNodes=[];\r\n\t\tvar tar;\r\n\t\ttar=sprite.parent;\r\n\t\twhile (tar){\r\n\t\t\tDebugTool.selectedNodes.push(tar);\r\n\t\t\ttar=tar.parent;\r\n\t\t}\r\n\t\tDebugTool.showSelected();\r\n\t}\r\n\r\n\tDebugTool.showAllBrother=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (!sprite.parent)\r\n\t\t\treturn;\r\n\t\tDebugTool.selectedNodes=DisControlTool.getAllChild(sprite.parent);\r\n\t\tDebugTool.showSelected();\r\n\t}\r\n\r\n\tDebugTool.showBrother=function(sprite,dID){\r\n\t\t(dID===void 0)&& (dID=1);\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\tvar p;\r\n\t\tp=sprite.parent;\r\n\t\tif (!p)\r\n\t\t\treturn;\r\n\t\tvar n=0;\r\n\t\tn=p.getChildIndex(sprite);\r\n\t\tn+=dID;\r\n\t\tif (n < 0)\r\n\t\t\tn+=p.numChildren;\r\n\t\tif (n >=p.numChildren)\r\n\t\t\tn-=p.numChildren;\r\n\t\tDebugTool.target=p.getChildAt(n);\r\n\t\tDebugTool.autoWork();\r\n\t}\r\n\r\n\tDebugTool.clearDebugLayer=function(){\r\n\t\tif (DebugTool.debugLayer.graphics)\r\n\t\t\tDebugTool.debugLayer.graphics.clear();\r\n\t}\r\n\r\n\tDebugTool.showSelected=function(){\r\n\t\tif (!DebugTool.autoShowSelected)\r\n\t\t\treturn;\r\n\t\tif (!DebugTool.selectedNodes || DebugTool.selectedNodes.length < 1)\r\n\t\t\treturn;\r\n\t\tconsole.log(\"selected:\",DebugTool.selectedNodes);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=DebugTool.selectedNodes.length;\r\n\t\tDebugTool.clearDebugLayer();\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tDebugTool.showDisBound(DebugTool.selectedNodes[i],false);\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.getClassCreateInfo=function(className){\r\n\t\treturn RunProfile.getRunInfo(className);\r\n\t}\r\n\r\n\tDebugTool.autoWork=function(){\r\n\t\tif (!DebugTool.isThisShow)\r\n\t\t\treturn;\r\n\t\tif (DebugTool.showBound)\r\n\t\t\tDebugTool.showDisBound();\r\n\t\tif (DebugTool.autoTraceSpriteInfo && DebugTool.target){\r\n\t\t\tTraceTool.traceSpriteInfo(DebugTool.target,DebugTool.autoTraceBounds,DebugTool.autoTraceSize,DebugTool.autoTraceTree);\r\n\t\t}\r\n\t\tif (!DebugTool.target)\r\n\t\t\treturn;\r\n\t\tif (DebugTool.autoTraceCMD){\r\n\t\t\tDebugTool.traceCMD();\r\n\t\t}\r\n\t\tif (DebugTool.autoTraceCMDR){\r\n\t\t\tDebugTool.traceCMDR();\r\n\t\t}\r\n\t\tif (DebugTool.autoTraceEnable){\r\n\t\t\tDebugTool.traceDisMouseEnable(DebugTool.target);\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.traceDisMouseEnable=function(tar){\r\n\t\tconsole.log(\"----------------traceDisMouseEnable--------------------\");\r\n\t\tif (!tar)\r\n\t\t\ttar=DebugTool.target;\r\n\t\tif (!tar){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\tvar strArr;\r\n\t\tstrArr=[];\r\n\t\tDebugTool.selectedNodes=[];\r\n\t\twhile (tar){\r\n\t\t\tstrArr.push(ClassTool.getNodeClassAndName(tar)+\": mouseEnabled:\"+tar.mouseEnabled+\" hitFirst:\"+tar.hitTestPrior);\r\n\t\t\tDebugTool.selectedNodes.push(tar);\r\n\t\t\ttar=tar.parent;\r\n\t\t}\r\n\t\tconsole.log(strArr.join(\"\\n\"));\r\n\t\tDebugTool.showSelected();\r\n\t\treturn strArr.join(\"\\n\");\r\n\t}\r\n\r\n\tDebugTool.traceDisSizeChain=function(tar){\r\n\t\tconsole.log(\"---------------------traceDisSizeChain-------------------\");\r\n\t\tif (!tar)\r\n\t\t\ttar=DebugTool.target;\r\n\t\tif (!tar){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tDebugTool.selectedNodes=[];\r\n\t\tvar strArr;\r\n\t\tstrArr=[];\r\n\t\twhile (tar){\r\n\t\t\tstrArr.push(ClassTool.getNodeClassAndName(tar)+\": x:\"+tar.x+\" y:\"+tar.y+\" w:\"+tar.width+\" h:\"+tar.height+\" scaleX:\"+tar.scaleX+\" scaleY:\"+tar.scaleY);\r\n\t\t\tDebugTool.selectedNodes.push(tar);\r\n\t\t\ttar=tar.parent;\r\n\t\t}\r\n\t\tconsole.log(strArr.join(\"\\n\"));\r\n\t\tDebugTool.showSelected();\r\n\t\treturn strArr.join(\"\\n\");\r\n\t}\r\n\r\n\tDebugTool.showDisBound=function(sprite,clearPre,color){\r\n\t\t(clearPre===void 0)&& (clearPre=true);\r\n\t\t(color===void 0)&& (color=\"#ff0000\");\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (clearPre)\r\n\t\t\tDebugTool.clearDebugLayer();\r\n\t\tvar pointList;\r\n\t\tpointList=sprite._getBoundPointsM(true);\r\n\t\tif (!pointList || pointList.length < 1)\r\n\t\t\treturn;\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,sprite.localToGlobal,sprite);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tDebugTool._disBoundRec=Rectangle._getWrapRec(pointList,DebugTool._disBoundRec);\r\n\t\tDebugTool.debugLayer.graphics.drawRect(DebugTool._disBoundRec.x,DebugTool._disBoundRec.y,DebugTool._disBoundRec.width,DebugTool._disBoundRec.height,null,color);\r\n\t\tDebugInfoLayer.I.setTop();\r\n\t}\r\n\r\n\tDebugTool.showDisBoundToSprite=function(sprite,graphicSprite,color,lineWidth){\r\n\t\t(color===void 0)&& (color=\"#ff0000\");\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar pointList;\r\n\t\tpointList=sprite._getBoundPointsM(true);\r\n\t\tif (!pointList || pointList.length < 1)\r\n\t\t\treturn;\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,sprite.localToGlobal,sprite);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tDebugTool._disBoundRec=Rectangle._getWrapRec(pointList,DebugTool._disBoundRec);\r\n\t\tgraphicSprite.graphics.drawRect(DebugTool._disBoundRec.x,DebugTool._disBoundRec.y,DebugTool._disBoundRec.width,DebugTool._disBoundRec.height,null,color,lineWidth);\r\n\t}\r\n\r\n\tDebugTool.getNodeInfo=function(){\r\n\t\tDebugTool.counter.reset();\r\n\t\tWalkTools.walkTarget(Laya.stage,DebugTool.addNodeInfo);\r\n\t\tconsole.log(\"node info:\");\r\n\t\tDebugTool.counter.traceSelf();\r\n\t\treturn DebugTool.counter.data;\r\n\t}\r\n\r\n\tDebugTool.findByClass=function(className){\r\n\t\tDebugTool._classList=[];\r\n\t\tDebugTool._tFindClass=className;\r\n\t\tWalkTools.walkTarget(Laya.stage,DebugTool.addClassNode);\r\n\t\tDebugTool.selectedNodes=DebugTool._classList;\r\n\t\tDebugTool.showSelected();\r\n\t\treturn DebugTool._classList;\r\n\t}\r\n\r\n\tDebugTool.addClassNode=function(node){\r\n\t\tvar type;\r\n\t\ttype=node[\"constructor\"].name;\r\n\t\tif (type==DebugTool._tFindClass){\r\n\t\t\tDebugTool._classList.push(node);\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.traceCMD=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconsole.log(\"self CMDs:\");\r\n\t\tconsole.log(sprite.graphics.cmds);\r\n\t\tvar renderSprite;\r\n\t\trenderSprite=RenderSprite.renders[sprite._renderType];\r\n\t\tconsole.log(\"renderSprite:\",renderSprite);\r\n\t\tDebugTool._rSpList.length=0;\r\n\t\twhile (renderSprite && renderSprite[\"_sign\"] > 0){\r\n\t\t\tDebugTool._rSpList.push(DebugTool.cmdToTypeO[renderSprite[\"_sign\"]]);\r\n\t\t\trenderSprite=renderSprite._next;\r\n\t\t}\r\n\t\tconsole.log(\"fun:\",DebugTool._rSpList.join(\",\"));\r\n\t\tDebugTool.counter.reset();\r\n\t\tDebugTool.addCMDs(sprite.graphics.cmds);\r\n\t\tDebugTool.counter.traceSelf();\r\n\t\treturn DebugTool.counter.data;\r\n\t}\r\n\r\n\tDebugTool.addCMDs=function(cmds){\r\n\t\tWalkTools.walkArr(cmds,DebugTool.addCMD);\r\n\t}\r\n\r\n\tDebugTool.addCMD=function(cmd){\r\n\t\tDebugTool.counter.add(cmd.callee);\r\n\t}\r\n\r\n\tDebugTool.traceCMDR=function(sprite){\r\n\t\tif (!sprite)\r\n\t\t\tsprite=DebugTool.target;\r\n\t\tif (!sprite){\r\n\t\t\tconsole.log(\"no targetAvalible\");\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tDebugTool.counter.reset();\r\n\t\tWalkTools.walkTarget(sprite,DebugTool.getCMdCount);\r\n\t\tconsole.log(\"cmds include children\");\r\n\t\tDebugTool.counter.traceSelf();\r\n\t\treturn DebugTool.counter.data;\r\n\t}\r\n\r\n\tDebugTool.getCMdCount=function(target){\r\n\t\tif (!target)\r\n\t\t\treturn 0;\r\n\t\tif (! (target instanceof laya.display.Sprite ))\r\n\t\t\treturn 0;\r\n\t\tif (!target.graphics.cmds)\r\n\t\t\treturn 0;\r\n\t\tDebugTool.addCMDs(target.graphics.cmds);\r\n\t\tvar rst=target.graphics.cmds.length;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.addNodeInfo=function(node){\r\n\t\tvar type;\r\n\t\ttype=node[\"constructor\"].name;\r\n\t\tDebugTool.counter.add(type);\r\n\t}\r\n\r\n\tDebugTool.find=function(filter,ifShowSelected){\r\n\t\t(ifShowSelected===void 0)&& (ifShowSelected=true);\r\n\t\tvar rst;\r\n\t\trst=DebugTool.findTarget(Laya.stage,filter);\r\n\t\tDebugTool.selectedNodes=rst;\r\n\t\tif (DebugTool.selectedNodes){\r\n\t\t\tDebugTool.target=DebugTool.selectedNodes[0];\r\n\t\t}\r\n\t\tif (ifShowSelected)\r\n\t\t\tDebugTool.showSelected();\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.findByName=function(name){\r\n\t\tDebugTool.nameFilter.name=name;\r\n\t\treturn DebugTool.find(DebugTool.nameFilter);\r\n\t}\r\n\r\n\tDebugTool.findNameStartWith=function(startStr){\r\n\t\tDebugTool.nameFilter.name=DebugTool.getStartWithFun(startStr);\r\n\t\treturn DebugTool.find(DebugTool.nameFilter);\r\n\t}\r\n\r\n\tDebugTool.findNameHas=function(hasStr,showSelected){\r\n\t\t(showSelected===void 0)&& (showSelected=true);\r\n\t\tDebugTool.nameFilter.name=DebugTool.getHasFun(hasStr);\r\n\t\treturn DebugTool.find(DebugTool.nameFilter,showSelected);\r\n\t}\r\n\r\n\tDebugTool.getStartWithFun=function(startStr){\r\n\t\tvar rst=function (str){\r\n\t\t\tif (!str)\r\n\t\t\t\treturn false;\r\n\t\t\tif (str.indexOf(startStr)==0)\r\n\t\t\t\treturn true;\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.getHasFun=function(hasStr){\r\n\t\tvar rst=function (str){\r\n\t\t\tif (!str)\r\n\t\t\t\treturn false;\r\n\t\t\tif (str.indexOf(hasStr)>=0)\r\n\t\t\t\treturn true;\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.findTarget=function(target,filter){\r\n\t\tvar rst=[];\r\n\t\tif (DebugTool.isFit(target,filter))\r\n\t\t\trst.push(target);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tChild;\r\n\t\tlen=target.numChildren;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=target.getChildAt(i);\r\n\t\t\tif ((tChild instanceof laya.display.Sprite )){\r\n\t\t\t\trst=rst.concat(DebugTool.findTarget(tChild,filter));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.findClassHas=function(target,str){\r\n\t\tvar rst=[];\r\n\t\tif (ClassTool.getClassName(target).indexOf(str)>=0)\r\n\t\t\trst.push(target);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tChild;\r\n\t\tlen=target.numChildren;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=target.getChildAt(i);\r\n\t\t\tif ((tChild instanceof laya.display.Sprite )){\r\n\t\t\t\trst=rst.concat(DebugTool.findClassHas(tChild,str));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTool.isFit=function(tar,filter){\r\n\t\tif (!tar)\r\n\t\t\treturn false;\r\n\t\tif (!filter)\r\n\t\t\treturn true;\r\n\t\tif ((typeof filter=='function')){\r\n\t\t\treturn (filter)(tar);\r\n\t\t};\r\n\t\tvar key;\r\n\t\tfor (key in filter){\r\n\t\t\tif ((typeof (filter[key])=='function')){\r\n\t\t\t\tif (!filter[key](tar[key]))\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif (tar[key] !=filter[key])\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tDebugTool.log=function(__args){\r\n\t\tvar args=arguments;\r\n\t\tvar arr;\r\n\t\tarr=DTrace.getArgArr(args);\r\n\t\tif (DebugTool._logFun!=null){\r\n\t\t\tDebugTool._logFun(arr.join(\" \"));\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTool.enableCacheAnalyse=false;\r\n\tDebugTool.enableNodeCreateAnalyse=true;\r\n\tDebugTool._traceFun=null;\r\n\tDebugTool.debugLayer=null;\r\n\tDebugTool._target=null;\r\n\tDebugTool.selectedNodes=[];\r\n\tDebugTool.autoShowSelected=true;\r\n\tDebugTool._showBound=true;\r\n\tDebugTool._disBoundRec=null;\r\n\tDebugTool.autoTraceEnable=false;\r\n\tDebugTool.autoTraceBounds=false;\r\n\tDebugTool.autoTraceSize=false;\r\n\tDebugTool.autoTraceTree=true;\r\n\tDebugTool.autoTraceCMD=true;\r\n\tDebugTool.autoTraceCMDR=false;\r\n\tDebugTool.autoTraceSpriteInfo=true;\r\n\tDebugTool._classList=null;\r\n\tDebugTool._tFindClass=null;\r\n\tDebugTool._rSpList=[];\r\n\tDebugTool._logFun=null;\r\n\t__static(DebugTool,\r\n\t['text',function(){return this.text=new Stat();},'cmdToTypeO',function(){return this.cmdToTypeO={\r\n\t};},'counter',function(){return this.counter=new CountTool();},'nameFilter',function(){return this.nameFilter={\"name\":\"name\"};}\r\n\r\n\t]);\r\n\treturn DebugTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.divui.DivScripts\r\nvar DivScripts=(function(){\r\n\tfunction DivScripts(){}\r\n\t__class(DivScripts,'laya.debug.divui.DivScripts');\r\n\tDivScripts.init=function(){\r\n\t\tvar script;\r\n\t\tscript=Base64Tool.decodeToByte(DivScripts.data).readUTFBytes();\r\n\t\tBrowser.window.eval(script);\r\n\t}\r\n\r\n\tDivScripts.data=\"ZnVuY3Rpb24gZGh0bWx4RXZlbnQoZSx0LGkpe2UuYWRkRXZlbnRMaXN0ZW5lcj9lLmFkZEV2ZW50TGlzdGVuZXIodCxpLCExKTplLmF0dGFjaEV2ZW50JiZlLmF0dGFjaEV2ZW50KCJvbiIrdCxpKX1mdW5jdGlvbiBkaHRtbFhUcmVlT2JqZWN0KGUsdCxpLG4pe2lmKGRodG1seEV2ZW50LmluaXRUb3VjaCYmZGh0bWx4RXZlbnQuaW5pdFRvdWNoKCksX2lzSUUpdHJ5e2RvY3VtZW50LmV4ZWNDb21tYW5kKCJCYWNrZ3JvdW5kSW1hZ2VDYWNoZSIsITEsITApfWNhdGNoKG8pe30ib2JqZWN0IiE9dHlwZW9mIGU/dGhpcy5wYXJlbnRPYmplY3Q9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSk6dGhpcy5wYXJlbnRPYmplY3Q9ZSx0aGlzLnBhcmVudE9iamVjdC5zdHlsZS5vdmVyZmxvdz0iaGlkZGVuIix0aGlzLl9pdGltX2RnPSEwLHRoaXMuZGxtdHI9IiwiLHRoaXMuZHJvcExvd2VyPSExLHRoaXMuZW5hYmxlSUVJbWFnZUZpeCghMCksdGhpcy54bWxzdGF0ZT0wLHRoaXMubXl0eXBlPSJ0cmVlIix0aGlzLnNtY2hlY2s9ITAsdGhpcy53aWR0aD10LHRoaXMuaGVpZ2h0PWksdGhpcy5yb290SWQ9bix0aGlzLmNoaWxkQ2FsYz1udWxsLHRoaXMuZGVmX2ltZ194PSIxOHB4Iix0aGlzLmRlZl9pbWdfeT0iMThweCIsdGhpcy5kZWZfbGluZV9pbWdfeD0iMThweCIsdGhpcy5kZWZfbGluZV9pbWdfeT0iMjRweCIsdGhpcy5fZHJhZ2dlZD1uZXcgQXJyYXksdGhpcy5fc2VsZWN0ZWQ9bmV3IEFycmF5LHRoaXMuc3R5bGVfcG9pbnRlcj0icG9pbnRlciIsdGhpcy5fYWltZ3M9ITAsdGhpcy5odG1sY0E9IiBbIix0aGlzLmh0bWxjQj0iXSIsdGhpcy5sV2luPXdpbmRvdyx0aGlzLmNNZW51PTAsdGhpcy5tbGl0ZW1zPTAsdGhpcy5pY29uVVJMPSIiLHRoaXMuZGFkbW9kZT0wLHRoaXMuc2xvd1BhcnNlPSExLHRoaXMuYXV0b1Njcm9sbD0hMCx0aGlzLmhmTW9kZT0wLHRoaXMubm9kZUN1dD1uZXcgQXJyYXksdGhpcy5YTUxzb3VyY2U9MCx0aGlzLlhNTGxvYWRpbmdXYXJuaW5nPTAsdGhpcy5faWRwdWxsPXt9LHRoaXMuX3B1bGxTaXplPTAsdGhpcy50cmVlTGluZXNPbj0hMCx0aGlzLnRzY2hlY2s9ITEsdGhpcy50aW1nZW49ITAsdGhpcy5kcGNweT0hMSx0aGlzLl9sZF9pZD1udWxsLHRoaXMuX2R5bkRlbGV0ZUJyYW5jaGVzPXt9LHRoaXMuX29pZV9vblhMRT1bXSx0aGlzLmltUGF0aD13aW5kb3cuZGh4X2dsb2JhbEltZ1BhdGh8fCIiLHRoaXMuY2hlY2tBcnJheT1uZXcgQXJyYXkoImljb25VbmNoZWNrQWxsLmdpZiIsImljb25DaGVja0FsbC5naWYiLCJpY29uQ2hlY2tHcmF5LmdpZiIsImljb25VbmNoZWNrRGlzLmdpZiIsImljb25DaGVja0Rpcy5naWYiLCJpY29uQ2hlY2tEaXMuZ2lmIiksdGhpcy5yYWRpb0FycmF5PW5ldyBBcnJheSgicmFkaW9fb2ZmLmdpZiIsInJhZGlvX29uLmdpZiIsInJhZGlvX29uLmdpZiIsInJhZGlvX29mZi5naWYiLCJyYWRpb19vbi5naWYiLCJyYWRpb19vbi5naWYiKSx0aGlzLmxpbmVBcnJheT1uZXcgQXJyYXkoImxpbmUyLmdpZiIsImxpbmUzLmdpZiIsImxpbmU0LmdpZiIsYmxhbmtfYmFzZTY0LGJsYW5rX2Jhc2U2NCwibGluZTEuZ2lmIiksdGhpcy5taW51c0FycmF5PW5ldyBBcnJheSgibWludXMyLmdpZiIsIm1pbnVzMy5naWYiLCJtaW51czQuZ2lmIiwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRWdBWUFKRUNBTEd2clo2ZG5mVDA5QUFBQUNINUJBRUFBQUlBTEFBQUFBQVNBQmdBQUFJY2xJK3B5KzBQbzV5MFdoc0NEV0IzbUdYZnd3SG1oYWJxeXJaVEFRQTciLCJtaW51czUuZ2lmIiksdGhpcy5wbHVzQXJyYXk9bmV3IEFycmF5KCJwbHVzMi5naWYiLCJwbHVzMy5naWYiLCJwbHVzNC5naWYiLCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFZ0FZQUpFQ0FLR2duN0d2cmZUMDlBQUFBQ0g1QkFFQUFBSUFMQUFBQUFBU0FCZ0FBQUljbEkrcHkrMFBvNXkwVW5CRHlIc0NMUUZmT0U2ZGhhYnF5clpKQVFBNyIsInBsdXM1LmdpZiIpLHRoaXMuaW1hZ2VBcnJheT1uZXcgQXJyYXkoImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVnQVNBS0VDQUplWGw3R3ZyZi8vLy8vLy95SDVCQUVLQUFJQUxBQUFBQUFTQUJJQUFBSXpsSStwQXUyOURBaTAxamlUWFJuTm0zVEhCNDVCYUoyZXVsQm94TENTL0s2d09OODBYcHQ2citCOUhrU2FJSVdFS1EwRkFEcz0iLCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFZ0FTQUtFQ0FKZVhsN0d2cmYvLy8vLy8veUg1QkFFS0FBSUFMQUFBQUFBU0FCSUFBQUl6bEkrcHl3Y1BtM21oV2drQ3NqQk92VmtpbUVsRzlabENCbFhkKzJYampMS2c1R3FvZVpYcXZzT1FYSy9palVaVEtWVUZBRHM9IiwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRWdBU0FLRUNBSmVYbDdHdnJmLy8vLy8vL3lINUJBRUtBQUlBTEFBQUFBQVNBQklBQUFJd2xJK3B5d2NQbTNtaFdna0NzakJPdlZraW1FbEc5WmxDdVlJWTZUWXMrNmJtSERPNGlnZmREM0dOaGhlVjBWUUFBRHM9IiksdGhpcy5jdXRJbWc9bmV3IEFycmF5KDAsMCwwKSx0aGlzLmN1dEltYWdlPSJidXRfY3V0LmdpZiIsZGh4NC5fZXZlbnRhYmxlKHRoaXMpLHRoaXMuaHRtbE5vZGU9bmV3IGRodG1sWFRyZWVJdGVtT2JqZWN0KHRoaXMucm9vdElkLCIiLDAsdGhpcyksdGhpcy5odG1sTm9kZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uc3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5odG1sTm9kZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5jbGFzc05hbWU9ImhpZGRlblJvdyIsdGhpcy5hbGxUcmVlPXRoaXMuX2NyZWF0ZVNlbGYoKSx0aGlzLmFsbFRyZWUuYXBwZW5kQ2hpbGQodGhpcy5odG1sTm9kZS5odG1sTm9kZSksZGh0bWx4LiRjdXN0b21TY3JvbGwmJmRodG1seC5DdXN0b21TY3JvbGwuZW5hYmxlKHRoaXMpLF9pc0ZGJiYodGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0ud2lkdGg9IjEwMCUiLHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iKTt2YXIgcj10aGlzO2lmKHRoaXMuYWxsVHJlZS5vbnNlbGVjdHN0YXJ0PW5ldyBGdW5jdGlvbigicmV0dXJuIGZhbHNlOyIpLF9pc01hY09TJiYodGhpcy5hbGxUcmVlLm9uY29udGV4dG1lbnU9ZnVuY3Rpb24oZSl7cmV0dXJuIHIuX2RvQ29udENsaWNrKGV8fHdpbmRvdy5ldmVudCwhMCl9KSx0aGlzLmFsbFRyZWUub25tb3VzZWRvd249ZnVuY3Rpb24oZSl7cmV0dXJuIHIuX2RvQ29udENsaWNrKGV8fHdpbmRvdy5ldmVudCl9LHRoaXMuWE1MTG9hZGVyPXRoaXMuX3BhcnNlWE1MVHJlZSxfaXNJRSYmdGhpcy5wcmV2ZW50SUVDYXNoaW5nKCEwKSx0aGlzLnNlbGVjdGlvbkJhcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx0aGlzLnNlbGVjdGlvbkJhci5jbGFzc05hbWU9InNlbGVjdGlvbkJhciIsdGhpcy5zZWxlY3Rpb25CYXIuaW5uZXJIVE1MPSImbmJzcDsiLHRoaXMuc2VsZWN0aW9uQmFyLnN0eWxlLmRpc3BsYXk9Im5vbmUiLHRoaXMuYWxsVHJlZS5hcHBlbmRDaGlsZCh0aGlzLnNlbGVjdGlvbkJhciksd2luZG93LmFkZEV2ZW50TGlzdGVuZXImJndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLGZ1bmN0aW9uKCl7dHJ5e3IuZGVzdHJ1Y3RvcigpfWNhdGNoKGUpe319LCExKSx3aW5kb3cuYXR0YWNoRXZlbnQmJndpbmRvdy5hdHRhY2hFdmVudCgib251bmxvYWQiLGZ1bmN0aW9uKCl7dHJ5e3IuZGVzdHJ1Y3RvcigpfWNhdGNoKGUpe319KSx0aGlzLnNldEltYWdlc1BhdGg9dGhpcy5zZXRJbWFnZVBhdGgsdGhpcy5zZXRJY29uc1BhdGg9dGhpcy5zZXRJY29uUGF0aCx0aGlzLnNldFNraW4oIm1hdGVyaWFsIiksZGh0bWx4LmltYWdlX3BhdGgpe3ZhciBsPWRodG1seC5pbWFnZV9wYXRoLHM9dGhpcy5wYXJlbnRPYmplY3QuY2xhc3NOYW1lLm1hdGNoKC9kaHh0cmVlX2RoeF8oW2Etel9dKikvaSk7bnVsbCE9cyYmbnVsbCE9c1sxXSYmKGwrPSJkaHh0cmVlXyIrc1sxXSsiLyIpLHRoaXMuc2V0SW1hZ2VQYXRoKGwpfXJldHVybiB0aGlzfWZ1bmN0aW9uIGNPYmplY3QoKXtyZXR1cm4gdGhpc31mdW5jdGlvbiBkaHRtbFhUcmVlSXRlbU9iamVjdChlLHQsaSxuLG8scil7cmV0dXJuIHRoaXMuaHRtbE5vZGU9IiIsdGhpcy5hY29sb3I9IiIsdGhpcy5zY29sb3I9IiIsdGhpcy50cj0wLHRoaXMuY2hpbGRzQ291bnQ9MCx0aGlzLnRlbXBET01NPTAsdGhpcy50ZW1wRE9NVT0wLHRoaXMuZHJhZ1NwYW49MCx0aGlzLmRyYWdNb3ZlPTAsdGhpcy5zcGFuPTAsdGhpcy5jbG9zZWJsZT0xLHRoaXMuY2hpbGROb2Rlcz1uZXcgQXJyYXksdGhpcy51c2VyRGF0YT1uZXcgY09iamVjdCx0aGlzLmNoZWNrc3RhdGU9MCx0aGlzLnRyZWVOb2Q9bix0aGlzLmxhYmVsPXQsdGhpcy5wYXJlbnRPYmplY3Q9aSx0aGlzLmFjdGlvbkhhbmRsZXI9byx0aGlzLmltYWdlcz1uZXcgQXJyYXkobi5pbWFnZUFycmF5WzBdLG4uaW1hZ2VBcnJheVsxXSxuLmltYWdlQXJyYXlbMl0pLHRoaXMuaWQ9bi5fZ2xvYmFsSWRTdG9yYWdlQWRkKGUsdGhpcyksdGhpcy50cmVlTm9kLmNoZWNrQm94T2ZmP3RoaXMuaHRtbE5vZGU9dGhpcy50cmVlTm9kLl9jcmVhdGVJdGVtKDEsdGhpcyxyKTp0aGlzLmh0bWxOb2RlPXRoaXMudHJlZU5vZC5fY3JlYXRlSXRlbSgwLHRoaXMsciksdGhpcy5odG1sTm9kZS5vYmpCZWxvbmc9dGhpcyx0aGlzfWZ1bmN0aW9uIGpzb25Qb2ludGVyKGUsdCl7dGhpcy5kPWUsdGhpcy5kcD10fWZ1bmN0aW9uIGRoeF9pbml0X3RyZWVzKCl7Zm9yKHZhciBlPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJkaXYiKSx0PTA7dDxlLmxlbmd0aDt0KyspImRodG1seFRyZWUiPT1lW3RdLmNsYXNzTmFtZSYmZGh0bWxYVHJlZUZyb21IVE1MKGVbdF0pfXZhciBibGFua19iYXNlNjQ9ImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEVnQVNBSUFBQVAvLy8vLy8veUg1QkFVVUFBRUFMQUFBQUFBU0FCSUFBQUlQakkrcHkrMFBvNXkwMm91ejNwd1hBRHM9IjsidW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdy5kaHgmJih3aW5kb3cuZGh4PXdpbmRvdy5kaHg0PXt2ZXJzaW9uOiI1LjAiLHNraW46bnVsbCxsYXN0SWQ6MSxuZXdJZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmxhc3RJZCsrfSx6aW06e2RhdGE6e30sc3RlcDo1LGZpcnN0OmZ1bmN0aW9uKCl7cmV0dXJuIDEwMH0sbGFzdDpmdW5jdGlvbigpe3ZhciBlPXRoaXMuZmlyc3QoKTtmb3IodmFyIHQgaW4gdGhpcy5kYXRhKWU9TWF0aC5tYXgoZSx0aGlzLmRhdGFbdF0pO3JldHVybiBlfSxyZXNlcnZlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmRhdGFbZV09dGhpcy5sYXN0KCkrdGhpcy5zdGVwLHRoaXMuZGF0YVtlXX0sY2xlYXI6ZnVuY3Rpb24oZSl7bnVsbCE9dGhpcy5kYXRhW2VdJiYodGhpcy5kYXRhW2VdPW51bGwsZGVsZXRlIHRoaXMuZGF0YVtlXSl9fSxzMmI6ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYoZT1lLnRvTG93ZXJDYXNlKCkpLDE9PWV8fDE9PWV8fCJ0cnVlIj09ZXx8IjEiPT1lfHwieWVzIj09ZXx8InkiPT1lfHwib24iPT1lfSxzMmo6ZnVuY3Rpb24ocyl7dmFyIG9iaj1udWxsO2RoeDQudGVtcD1udWxsO3RyeXtldmFsKCJkaHg0LnRlbXA9IitzKX1jYXRjaChlKXtkaHg0LnRlbXA9bnVsbH1yZXR1cm4gb2JqPWRoeDQudGVtcCxkaHg0LnRlbXA9bnVsbCxvYmp9LGFic0xlZnQ6ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiYoZT1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKSksdGhpcy5nZXRPZmZzZXQoZSkubGVmdH0sYWJzVG9wOmZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmKGU9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSkpLHRoaXMuZ2V0T2Zmc2V0KGUpLnRvcH0sX2FPZnM6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTAsaT0wO2U7KXQrPXBhcnNlSW50KGUub2Zmc2V0VG9wKSxpKz1wYXJzZUludChlLm9mZnNldExlZnQpLGU9ZS5vZmZzZXRQYXJlbnQ7cmV0dXJue3RvcDp0LGxlZnQ6aX19LF9hT2ZzUmVjdDpmdW5jdGlvbihlKXt2YXIgdD1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9ZG9jdW1lbnQuYm9keSxuPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxvPXdpbmRvdy5wYWdlWU9mZnNldHx8bi5zY3JvbGxUb3B8fGkuc2Nyb2xsVG9wLHI9d2luZG93LnBhZ2VYT2Zmc2V0fHxuLnNjcm9sbExlZnR8fGkuc2Nyb2xsTGVmdCxsPW4uY2xpZW50VG9wfHxpLmNsaWVudFRvcHx8MCxzPW4uY2xpZW50TGVmdHx8aS5jbGllbnRMZWZ0fHwwLGE9dC50b3Arby1sLGQ9dC5sZWZ0K3ItcztyZXR1cm57dG9wOk1hdGgucm91bmQoYSksbGVmdDpNYXRoLnJvdW5kKGQpfX0sZ2V0T2Zmc2V0OmZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdD90aGlzLl9hT2ZzUmVjdChlKTp0aGlzLl9hT2ZzKGUpfSxfaXNPYmo6ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWUmJiJvYmplY3QiPT10eXBlb2YgZSYmInVuZGVmaW5lZCI9PXR5cGVvZiBlLmxlbmd0aH0sX2NvcHlPYmo6ZnVuY3Rpb24oZSl7aWYodGhpcy5faXNPYmooZSkpe3ZhciB0PXt9O2Zvcih2YXIgaSBpbiBlKSJvYmplY3QiPT10eXBlb2YgZVtpXSYmbnVsbCE9ZVtpXT90W2ldPXRoaXMuX2NvcHlPYmooZVtpXSk6dFtpXT1lW2ldfWVsc2UgZm9yKHZhciB0PVtdLGk9MDtpPGUubGVuZ3RoO2krKykib2JqZWN0Ij09dHlwZW9mIGVbaV0mJm51bGwhPWVbaV0/dFtpXT10aGlzLl9jb3B5T2JqKGVbaV0pOnRbaV09ZVtpXTtyZXR1cm4gdH19LHdpbmRvdy5kaHg0LmlzSUU9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIik+PTB8fG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiVHJpZGVudCIpPj0wLHdpbmRvdy5kaHg0LmlzSUU2PW51bGw9PXdpbmRvdy5YTUxIdHRwUmVxdWVzdCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIik+PTAsd2luZG93LmRoeDQuaXNJRTc9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDcuMCIpPj0wJiZuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKTwwLHdpbmRvdy5kaHg0LmlzSUU4PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTVNJRSA4LjAiKT49MCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJUcmlkZW50Iik+PTAsd2luZG93LmRoeDQuaXNJRTk9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDkuMCIpPj0wJiZuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKT49MCx3aW5kb3cuZGh4NC5pc0lFMTA9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJNU0lFIDEwLjAiKT49MCYmbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJUcmlkZW50Iik+PTAmJjEhPXdpbmRvdy5uYXZpZ2F0b3IucG9pbnRlckVuYWJsZWQsd2luZG93LmRoeDQuaXNJRTExPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiVHJpZGVudCIpPj0wJiYxPT13aW5kb3cubmF2aWdhdG9yLnBvaW50ZXJFbmFibGVkLHdpbmRvdy5kaHg0LmlzRWRnZT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkVkZ2UiKT49MCx3aW5kb3cuZGh4NC5pc09wZXJhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiT3BlcmEiKT49MCx3aW5kb3cuZGh4NC5pc0Nocm9tZT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpPj0wJiYhd2luZG93LmRoeDQuaXNFZGdlLHdpbmRvdy5kaHg0LmlzS0hUTUw9KG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+PTB8fG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiS29ucXVlcm9yIik+PTApJiYhd2luZG93LmRoeDQuaXNFZGdlLHdpbmRvdy5kaHg0LmlzRkY9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJGaXJlZm94Iik+PTAsd2luZG93LmRoeDQuaXNJUGFkPW5hdmlnYXRvci51c2VyQWdlbnQuc2VhcmNoKC9pUGFkL2dpKT49MCx3aW5kb3cuZGh4NC5kbmQ9e2V2czp7fSxwX2VuOih3aW5kb3cuZGh4NC5pc0lFfHx3aW5kb3cuZGh4NC5pc0VkZ2UpJiYod2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZHx8d2luZG93Lm5hdmlnYXRvci5tc1BvaW50ZXJFbmFibGVkKSxfbVRvdWNoOmZ1bmN0aW9uKGUpe3JldHVybiB3aW5kb3cuZGh4NC5pc0lFMTAmJmUucG9pbnRlclR5cGU9PWUuTVNQT0lOVEVSX1RZUEVfTU9VU0V8fHdpbmRvdy5kaHg0LmlzSUUxMSYmIm1vdXNlIj09ZS5wb2ludGVyVHlwZXx8d2luZG93LmRoeDQuaXNFZGdlJiYibW91c2UiPT1lLnBvaW50ZXJUeXBlfSxfdG91Y2hPbjpmdW5jdGlvbihlKXtudWxsPT1lJiYoZT1kb2N1bWVudC5ib2R5KSxlLnN0eWxlLnRvdWNoQWN0aW9uPWUuc3R5bGUubXNUb3VjaEFjdGlvbj0iIixlPW51bGx9LF90b3VjaE9mZjpmdW5jdGlvbihlKXtudWxsPT1lJiYoZT1kb2N1bWVudC5ib2R5KSxlLnN0eWxlLnRvdWNoQWN0aW9uPWUuc3R5bGUubXNUb3VjaEFjdGlvbj0ibm9uZSIsZT1udWxsfX0sMT09d2luZG93Lm5hdmlnYXRvci5wb2ludGVyRW5hYmxlZD93aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoicG9pbnRlcmRvd24iLG1vdmU6InBvaW50ZXJtb3ZlIixlbmQ6InBvaW50ZXJ1cCJ9OjE9PXdpbmRvdy5uYXZpZ2F0b3IubXNQb2ludGVyRW5hYmxlZD93aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoiTVNQb2ludGVyRG93biIsbW92ZToiTVNQb2ludGVyTW92ZSIsZW5kOiJNU1BvaW50ZXJVcCJ9OiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93LmFkZEV2ZW50TGlzdGVuZXImJih3aW5kb3cuZGh4NC5kbmQuZXZzPXtzdGFydDoidG91Y2hzdGFydCIsbW92ZToidG91Y2htb3ZlIixlbmQ6InRvdWNoZW5kIn0pKSwidW5kZWZpbmVkIj09dHlwZW9mIHdpbmRvdy5kaHg0Ll9ldmVudGFibGUmJih3aW5kb3cuZGh4NC5fZXZlbnRhYmxlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuImNsZWFyIj09dD8oZS5kZXRhY2hBbGxFdmVudHMoKSxlLmRoeGV2cz1udWxsLGUuYXR0YWNoRXZlbnQ9bnVsbCxlLmRldGFjaEV2ZW50PW51bGwsZS5jaGVja0V2ZW50PW51bGwsZS5jYWxsRXZlbnQ9bnVsbCxlLmRldGFjaEFsbEV2ZW50cz1udWxsLHZvaWQoZT1udWxsKSk6KGUuZGh4ZXZzPXtkYXRhOnt9fSxlLmF0dGFjaEV2ZW50PWZ1bmN0aW9uKGUsdCl7ZT1TdHJpbmcoZSkudG9Mb3dlckNhc2UoKSx0aGlzLmRoeGV2cy5kYXRhW2VdfHwodGhpcy5kaHhldnMuZGF0YVtlXT17fSk7dmFyIGk9d2luZG93LmRoeDQubmV3SWQoKTtyZXR1cm4gdGhpcy5kaHhldnMuZGF0YVtlXVtpXT10LGl9LGUuZGV0YWNoRXZlbnQ9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0IGluIHRoaXMuZGh4ZXZzLmRhdGEpe3ZhciBpPTA7Zm9yKHZhciBuIGluIHRoaXMuZGh4ZXZzLmRhdGFbdF0pbj09ZT8odGhpcy5kaHhldnMuZGF0YVt0XVtuXT1udWxsLGRlbGV0ZSB0aGlzLmRoeGV2cy5kYXRhW3RdW25dKTppKys7MD09aSYmKHRoaXMuZGh4ZXZzLmRhdGFbdF09bnVsbCxkZWxldGUgdGhpcy5kaHhldnMuZGF0YVt0XSl9fSxlLmNoZWNrRXZlbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9U3RyaW5nKGUpLnRvTG93ZXJDYXNlKCksbnVsbCE9dGhpcy5kaHhldnMuZGF0YVtlXX0sZS5jYWxsRXZlbnQ9ZnVuY3Rpb24oZSx0KXtpZihlPVN0cmluZyhlKS50b0xvd2VyQ2FzZSgpLG51bGw9PXRoaXMuZGh4ZXZzLmRhdGFbZV0pcmV0dXJuITA7dmFyIGk9ITA7Zm9yKHZhciBuIGluIHRoaXMuZGh4ZXZzLmRhdGFbZV0paT10aGlzLmRoeGV2cy5kYXRhW2VdW25dLmFwcGx5KHRoaXMsdCkmJmk7cmV0dXJuIGl9LGUuZGV0YWNoQWxsRXZlbnRzPWZ1bmN0aW9uKCl7Zm9yKHZhciBlIGluIHRoaXMuZGh4ZXZzLmRhdGEpe2Zvcih2YXIgdCBpbiB0aGlzLmRoeGV2cy5kYXRhW2VdKXRoaXMuZGh4ZXZzLmRhdGFbZV1bdF09bnVsbCxkZWxldGUgdGhpcy5kaHhldnMuZGF0YVtlXVt0XTt0aGlzLmRoeGV2cy5kYXRhW2VdPW51bGwsZGVsZXRlIHRoaXMuZGh4ZXZzLmRhdGFbZV19fSx2b2lkKGU9bnVsbCkpfSxkaHg0Ll9ldmVudGFibGUoZGh4NCkpLCJ1bmRlZmluZWQiPT10eXBlb2Ygd2luZG93LmRodG1seCYmKHdpbmRvdy5kaHRtbHg9e2V4dGVuZDpmdW5jdGlvbihlLHQpe2Zvcih2YXIgaSBpbiB0KWVbaV18fChlW2ldPXRbaV0pO3JldHVybiBlfSxleHRlbmRfYXBpOmZ1bmN0aW9uKGUsdCxpKXt2YXIgbj13aW5kb3dbZV07biYmKHdpbmRvd1tlXT1mdW5jdGlvbihlKXtpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUmJiFlLnRhZ05hbWUpe3ZhciBpPW4uYXBwbHkodGhpcyx0Ll9pbml0P3QuX2luaXQoZSk6YXJndW1lbnRzKTtmb3IodmFyIG8gaW4gZGh0bWx4KXRbb10mJnRoaXNbdFtvXV0oZGh0bWx4W29dKTtmb3IodmFyIG8gaW4gZSl0W29dP3RoaXNbdFtvXV0oZVtvXSk6MD09PW8uaW5kZXhPZigib24iKSYmdGhpcy5hdHRhY2hFdmVudChvLGVbb10pfWVsc2UgdmFyIGk9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHQuX3BhdGNoJiZ0Ll9wYXRjaCh0aGlzKSxpfHx0aGlzfSx3aW5kb3dbZV0ucHJvdG90eXBlPW4ucHJvdG90eXBlLGkmJmRodG1seC5leHRlbmQod2luZG93W2VdLnByb3RvdHlwZSxpKSl9LHVybDpmdW5jdGlvbihlKXtyZXR1cm4tMSE9ZS5pbmRleE9mKCI/Iik/IiYiOiI/In19KSxfaXNGRj0hMSxfaXNJRT0hMSxfaXNPcGVyYT0hMSxfaXNLSFRNTD0hMSxfaXNNYWNPUz0hMSxfaXNDaHJvbWU9ITEsX0ZGcnY9ITEsX0tIVE1McnY9ITEsX09wZXJhUnY9ITEsLTEhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiTWFjaW50b3NoIikmJihfaXNNYWNPUz0hMCksbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoImNocm9tZSIpPi0xJiYoX2lzQ2hyb21lPSEwKSwtMSE9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKXx8LTEhPW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiS29ucXVlcm9yIik/KF9LSFRNTHJ2PXBhcnNlRmxvYXQobmF2aWdhdG9yLnVzZXJBZ2VudC5zdWJzdHIobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKSs3LDUpKSxfS0hUTUxydj41MjU/KF9pc0ZGPSEwLF9GRnJ2PTEuOSk6X2lzS0hUTUw9ITApOi0xIT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk9wZXJhIik/KF9pc09wZXJhPSEwLF9PcGVyYVJ2PXBhcnNlRmxvYXQobmF2aWdhdG9yLnVzZXJBZ2VudC5zdWJzdHIobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJPcGVyYSIpKzYsMykpKTotMSE9bmF2aWdhdG9yLmFwcE5hbWUuaW5kZXhPZigiTWljcm9zb2Z0Iik/KF9pc0lFPSEwLCgtMSE9bmF2aWdhdG9yLmFwcFZlcnNpb24uaW5kZXhPZigiTVNJRSA4LjAiKXx8LTEhPW5hdmlnYXRvci5hcHBWZXJzaW9uLmluZGV4T2YoIk1TSUUgOS4wIil8fC0xIT1uYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKCJNU0lFIDEwLjAiKXx8ZG9jdW1lbnQuZG9jdW1lbnRNb2RlPjcpJiYiQmFja0NvbXBhdCIhPWRvY3VtZW50LmNvbXBhdE1vZGUmJihfaXNJRT04KSk6Ik5ldHNjYXBlIj09bmF2aWdhdG9yLmFwcE5hbWUmJi0xIT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlRyaWRlbnQiKT9faXNJRT04OihfaXNGRj0hMCxfRkZydj1wYXJzZUZsb2F0KG5hdmlnYXRvci51c2VyQWdlbnQuc3BsaXQoInJ2OiIpWzFdKSksInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3cuZGh0bWx4RXZlbnQsbnVsbD09ZGh0bWx4RXZlbnQudG91Y2hEZWxheSYmKGRodG1seEV2ZW50LnRvdWNoRGVsYXk9MmUzKSwidW5kZWZpbmVkIj09dHlwZW9mIGRodG1seEV2ZW50LmluaXRUb3VjaCYmKGRodG1seEV2ZW50LmluaXRUb3VjaD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtpZihpKXt2YXIgZT1kb2N1bWVudC5jcmVhdGVFdmVudCgiSFRNTEV2ZW50cyIpO2UuaW5pdEV2ZW50KCJkYmxjbGljayIsITAsITApLGkuZGlzcGF0Y2hFdmVudChlKSx0PWk9bnVsbH19dmFyIHQsaSxuLG87ZGh0bWx4RXZlbnQoZG9jdW1lbnQuYm9keSwidG91Y2hzdGFydCIsZnVuY3Rpb24ocil7aT1yLnRvdWNoZXNbMF0udGFyZ2V0LG49ci50b3VjaGVzWzBdLmNsaWVudFgsbz1yLnRvdWNoZXNbMF0uY2xpZW50WSx0PXdpbmRvdy5zZXRUaW1lb3V0KGUsZGh0bWx4RXZlbnQudG91Y2hEZWxheSl9KSxkaHRtbHhFdmVudChkb2N1bWVudC5ib2R5LCJ0b3VjaG1vdmUiLGZ1bmN0aW9uKGUpe3QmJihNYXRoLmFicyhlLnRvdWNoZXNbMF0uY2xpZW50WC1uKT41MHx8TWF0aC5hYnMoZS50b3VjaGVzWzBdLmNsaWVudFktbyk+NTApJiYod2luZG93LmNsZWFyVGltZW91dCh0KSx0PWk9ITEpfSksZGh0bWx4RXZlbnQoZG9jdW1lbnQuYm9keSwidG91Y2hlbmQiLGZ1bmN0aW9uKGUpe3QmJih3aW5kb3cuY2xlYXJUaW1lb3V0KHQpLHQ9aT0hMSl9KSxkaHRtbHhFdmVudC5pbml0VG91Y2g9ZnVuY3Rpb24oKXt9fSksZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2RvQ29udENsaWNrPWZ1bmN0aW9uKGUsdCl7aWYoIXQmJjIhPWUuYnV0dG9uKXJldHVybiB0aGlzLl9hY01lbnUmJih0aGlzLl9hY01lbnUuaGlkZUNvbnRleHRNZW51P3RoaXMuX2FjTWVudS5oaWRlQ29udGV4dE1lbnUoKTp0aGlzLmNNZW51Ll9jb250ZXh0RW5kKCkpLCEwO2Zvcih2YXIgaT1faXNJRT9lLnNyY0VsZW1lbnQ6ZS50YXJnZXQ7aSYmIkJPRFkiIT1pLnRhZ05hbWUmJiFpLnBhcmVudE9iamVjdDspaT1pLnBhcmVudE5vZGU7aWYoIWl8fCFpLnBhcmVudE9iamVjdClyZXR1cm4hMDt2YXIgbj1pLnBhcmVudE9iamVjdDtpZih0aGlzLmNhbGxFdmVudCgib25SaWdodENsaWNrIixbbi5pZCxlXSl8fCgoZS5zcmNFbGVtZW50fHxlLnRhcmdldCkub25jb250ZXh0bWVudT1mdW5jdGlvbihlKXtyZXR1cm4oZXx8ZXZlbnQpLmNhbmNlbEJ1YmJsZT0hMCwhMX0pLHRoaXMuX2FjTWVudT1uLmNNZW51fHx0aGlzLmNNZW51LHRoaXMuX2FjTWVudSl7aWYoIXRoaXMuY2FsbEV2ZW50KCJvbkJlZm9yZUNvbnRleHRNZW51Iixbbi5pZF0pKXJldHVybiEwO2lmKF9pc01hY09TfHwoKGUuc3JjRWxlbWVudHx8ZS50YXJnZXQpLm9uY29udGV4dG1lbnU9ZnVuY3Rpb24oZSl7cmV0dXJuKGV8fGV2ZW50KS5jYW5jZWxCdWJibGU9ITAsITF9KSx0aGlzLl9hY01lbnUuc2hvd0NvbnRleHRNZW51KXt2YXIgbz13aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LHI9d2luZG93LmRvY3VtZW50LmJvZHksbD1uZXcgQXJyYXkoby5zY3JvbGxMZWZ0fHxyLnNjcm9sbExlZnQsby5zY3JvbGxUb3B8fHIuc2Nyb2xsVG9wKTtpZihfaXNJRSl2YXIgcz1lLmNsaWVudFgrbFswXSxhPWUuY2xpZW50WStsWzFdO2Vsc2UgdmFyIHM9ZS5wYWdlWCxhPWUucGFnZVk7dGhpcy5fYWNNZW51LnNob3dDb250ZXh0TWVudShzLTEsYS0xKSx0aGlzLmNvbnRleHRJRD1uLmlkLGUuY2FuY2VsQnViYmxlPSEwLHRoaXMuX2FjTWVudS5fc2tpcF9oaWRlPSEwfWVsc2UgaS5jb250ZXh0TWVudUlkPW4uaWQsaS5jb250ZXh0TWVudT10aGlzLl9hY01lbnUsaS5hPXRoaXMuX2FjTWVudS5fY29udGV4dFN0YXJ0LGkuYShpLGUpLGkuYT1udWxsO3JldHVybiExfXJldHVybiEwfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5lbmFibGVJRUltYWdlRml4PWZ1bmN0aW9uKGUpe2U/KHRoaXMuX2dldEltZz1mdW5jdGlvbigpe3ZhciBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpO3JldHVybiBlLmlubmVySFRNTD0iJm5ic3A7IixlLmNsYXNzTmFtZT0iZGh4X2JnX2ltZ19maXgiLGV9LHRoaXMuX3NldFNyYz1mdW5jdGlvbihlLHQpe2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlPSJ1cmwoIit0KyIpIn0sdGhpcy5fZ2V0U3JjPWZ1bmN0aW9uKGUpe3ZhciB0PWUuc3R5bGUuYmFja2dyb3VuZEltYWdlO3JldHVybiB0LnN1YnN0cig0LHQubGVuZ3RoLTUpLnJlcGxhY2UoLyheIil8KCIkKS9nLCIiKX0pOih0aGlzLl9nZXRJbWc9ZnVuY3Rpb24oZSl7cmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZT09dGhpcy5yb290SWQ/ImRpdiI6ImltZyIpfSx0aGlzLl9zZXRTcmM9ZnVuY3Rpb24oZSx0KXtlLnNyYz10fSx0aGlzLl9nZXRTcmM9ZnVuY3Rpb24oZSl7cmV0dXJuIGUuc3JjfSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmRlc3RydWN0b3I9ZnVuY3Rpb24oKXtmb3IodmFyIGUgaW4gdGhpcy5faWRwdWxsKXt2YXIgdD10aGlzLl9pZHB1bGxbZV07dCYmKHQucGFyZW50T2JqZWN0PW51bGwsdC50cmVlTm9kPW51bGwsdC5jaGlsZE5vZGVzPW51bGwsdC5zcGFuPW51bGwsdC50ci5ub2RlbT1udWxsLHQudHI9bnVsbCx0Lmh0bWxOb2RlLm9iakJlbG9uZz1udWxsLHQuaHRtbE5vZGU9bnVsbCx0aGlzLl9pZHB1bGxbZV09bnVsbCl9dGhpcy5wYXJlbnRPYmplY3QuaW5uZXJIVE1MPSIiLHRoaXMuYWxsVHJlZS5vbnNlbGVjdHN0YXJ0PW51bGwsdGhpcy5hbGxUcmVlLm9uY29udGV4dG1lbnU9bnVsbCx0aGlzLmFsbFRyZWUub25tb3VzZWRvd249bnVsbDtmb3IodmFyIGUgaW4gdGhpcyl0aGlzW2VdPW51bGx9LGNPYmplY3QucHJvdG90eXBlPW5ldyBPYmplY3QsY09iamVjdC5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7fXJldHVybiBlLnByb3RvdHlwZT10aGlzLG5ldyBlfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZ2xvYmFsSWRTdG9yYWdlQWRkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSwxLDEpPyhlPWUrIl8iKyhuZXcgRGF0ZSkudmFsdWVPZigpLHRoaXMuX2dsb2JhbElkU3RvcmFnZUFkZChlLHQpKToodGhpcy5faWRwdWxsW2VdPXQsdGhpcy5fcHVsbFNpemUrKyxlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dsb2JhbElkU3RvcmFnZVN1Yj1mdW5jdGlvbihlKXt0aGlzLl9pZHB1bGxbZV0mJih0aGlzLl91bnNlbGVjdEl0ZW0odGhpcy5faWRwdWxsW2VdKSx0aGlzLl9pZHB1bGxbZV09bnVsbCx0aGlzLl9wdWxsU2l6ZS0tKSx0aGlzLl9sb2NrZXImJnRoaXMuX2xvY2tlcltlXSYmKHRoaXMuX2xvY2tlcltlXT0hMSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nbG9iYWxJZFN0b3JhZ2VGaW5kPWZ1bmN0aW9uKGUsdCxpLG4pe3ZhciBvPXRoaXMuX2lkcHVsbFtlXTtpZihvKXtpZihvLnVuUGFyc2VkJiYhaSYmdGhpcy5yZVBhcnNlKG8sMCksdGhpcy5fc3JuZCYmIW8uaHRtbE5vZGUmJnRoaXMuX2J1aWxkU1JORChvLGkpLG4mJnRoaXMuX2Vkc2Jwc0EpZm9yKHZhciByPTA7cjx0aGlzLl9lZHNicHNBLmxlbmd0aDtyKyspaWYodGhpcy5fZWRzYnBzQVtyXVsyXT09ZSlyZXR1cm4gZGh4NC5jYWxsRXZlbnQoIm9uZ2V0SXRlbUVycm9yIixbIlJlcXVlc3RlZCBpdGVtIHN0aWxsIGluIHBhcnNpbmcgcHJvY2Vzcy4iLGVdKSxudWxsO3JldHVybiBvfXJldHVybiB0aGlzLnNsb3dQYXJzZSYmMCE9ZSYmIXQ/dGhpcy5wcmVQYXJzZShlKTpudWxsfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZHJhd05ld1RyPWZ1bmN0aW9uKGUsdCl7dmFyIGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKSxuPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIiksbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpO3JldHVybiBuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIgIikpLG8uY29sU3Bhbj0zLG8uYXBwZW5kQ2hpbGQoZSksaS5hcHBlbmRDaGlsZChuKSxpLmFwcGVuZENoaWxkKG8pLGl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnBhcnNlPWZ1bmN0aW9uKGUsdCxpKXtpZigic3RyaW5nIj09dHlwZW9mIHQmJihpPXQsdD1udWxsKSwianNvbiI9PT1pKXJldHVybiB0aGlzLl9sb2FkSlNPTk9iamVjdChlLHQpO2lmKCJjc3YiPT09aSlyZXR1cm4gdGhpcy5fbG9hZENTVlN0cmluZyhlLHQpO2lmKCJqc2FycmF5Ij09PWkpcmV0dXJuIHRoaXMuX2xvYWRKU0FycmF5KGUsdCk7dmFyIG49dGhpczt0aGlzLnBhcnNDb3VudHx8dGhpcy5jYWxsRXZlbnQoIm9uWExTIixbbixudWxsXSksdGhpcy54bWxzdGF0ZT0xLHRoaXMuWE1MTG9hZGVyKHtyZXNwb25zZVhNTDpkaHg0LmFqYXgucGFyc2UoZSl9LHQpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fYXR0YWNoQ2hpbGROb2RlPWZ1bmN0aW9uKGUsdCxpLG4sbyxyLGwscyxhLGQsaCl7ZCYmZC5wYXJlbnRPYmplY3QmJihlPWQucGFyZW50T2JqZWN0KSwwPT1lLlhNTGxvYWQmJnRoaXMuWE1Mc291cmNlJiYhdGhpcy5YTUxsb2FkaW5nV2FybmluZyYmKGUuWE1MbG9hZD0xLHRoaXMuX2xvYWREeW5YTUwoZS5pZCkpO3ZhciBjPWUuY2hpbGRzQ291bnQsdT1lLmNoaWxkTm9kZXM7aWYoaCYmaC50ci5wcmV2aW91c1NpYmxpbmcmJihoLnRyLnByZXZpb3VzU2libGluZy5wcmV2aW91c1NpYmxpbmc/ZD1oLnRyLnByZXZpb3VzU2libGluZy5ub2RlbTpzPXMucmVwbGFjZSgiVE9QIiwiIikrIixUT1AiKSxkKXt2YXIgcCxfO2ZvcihwPTA7Yz5wO3ArKylpZih1W3BdPT1kKXtmb3IoXz1jO18hPXA7Xy0tKXVbMStfXT11W19dO2JyZWFrfXArKyxjPXB9aWYocylmb3IodmFyIG09cy5zcGxpdCgiLCIpLGc9MDtnPG0ubGVuZ3RoO2crKylzd2l0Y2gobVtnXSl7Y2FzZSJUT1AiOmZvcihlLmNoaWxkc0NvdW50PjAmJihkPW5ldyBPYmplY3QsZC50cj1lLmNoaWxkTm9kZXNbMF0udHIucHJldmlvdXNTaWJsaW5nKSxlLl9oYXNfdG9wPSEwLHA9YztwPjA7cC0tKXVbcF09dVtwLTFdO2M9MH12YXIgZjsoZj10aGlzLl9pZHB1bGxbdF0pJiYtMT09Zi5zcGFufHwoZj11W2NdPW5ldyBkaHRtbFhUcmVlSXRlbU9iamVjdCh0LGksZSx0aGlzLG4sMSksdD11W2NdLmlkLGUuY2hpbGRzQ291bnQrKyksZi5odG1sTm9kZXx8KGYubGFiZWw9aSxmLmh0bWxOb2RlPXRoaXMuX2NyZWF0ZUl0ZW0odGhpcy5jaGVja0JveE9mZj8xOjAsZiksZi5odG1sTm9kZS5vYmpCZWxvbmc9ZiksbyYmKGYuaW1hZ2VzWzBdPW8pLHImJihmLmltYWdlc1sxXT1yKSxsJiYoZi5pbWFnZXNbMl09bCk7dmFyIGI9dGhpcy5fZHJhd05ld1RyKGYuaHRtbE5vZGUpO2lmKCh0aGlzLlhNTGxvYWRpbmdXYXJuaW5nfHx0aGlzLl9oQWRJKSYmKGYuaHRtbE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnN0eWxlLmRpc3BsYXk9Im5vbmUiKSxkJiZkLnRyJiZkLnRyLm5leHRTaWJsaW5nP2UuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5pbnNlcnRCZWZvcmUoYixkLnRyLm5leHRTaWJsaW5nKTp0aGlzLnBhcnNpbmdPbj09ZS5pZD90aGlzLnBhcnNlZEFycmF5W3RoaXMucGFyc2VkQXJyYXkubGVuZ3RoXT1iOmUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5hcHBlbmRDaGlsZChiKSxkJiYhZC5zcGFuJiYoZD1udWxsKSx0aGlzLlhNTHNvdXJjZSYmKGEmJjAhPWE/Zi5YTUxsb2FkPTA6Zi5YTUxsb2FkPTEpLGYudHI9YixiLm5vZGVtPWYsMD09ZS5pdGVtSWQmJihiLmNoaWxkTm9kZXNbMF0uY2xhc3NOYW1lPSJoaWRkZW5Sb3ciKSwoZS5fcl9sb2dpY3x8dGhpcy5fZnJidHIpJiZ0aGlzLl9zZXRTcmMoZi5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLHRoaXMuaW1QYXRoK3RoaXMucmFkaW9BcnJheVswXSkscylmb3IodmFyIG09cy5zcGxpdCgiLCIpLGc9MDtnPG0ubGVuZ3RoO2crKylzd2l0Y2gobVtnXSl7Y2FzZSJTRUxFQ1QiOnRoaXMuc2VsZWN0SXRlbSh0LCExKTticmVhaztjYXNlIkNBTEwiOnRoaXMuc2VsZWN0SXRlbSh0LCEwKTticmVhaztjYXNlIkNISUxEIjpmLlhNTGxvYWQ9MDticmVhaztjYXNlIkNIRUNLRUQiOnRoaXMuWE1MbG9hZGluZ1dhcm5pbmc/dGhpcy5zZXRDaGVja0xpc3QrPXRoaXMuZGxtdHIrdDp0aGlzLnNldENoZWNrKHQsMSk7YnJlYWs7Y2FzZSJIQ0hFQ0tFRCI6dGhpcy5fc2V0Q2hlY2soZiwidW5zdXJlIik7YnJlYWs7Y2FzZSJPUEVOIjpmLm9wZW5NZT0xfWlmKCF0aGlzLlhNTGxvYWRpbmdXYXJuaW5nJiYodGhpcy5fZ2V0T3BlblN0YXRlKGUpPDAmJiF0aGlzLl9oQWRJJiZ0aGlzLm9wZW5JdGVtKGUuaWQpLGQmJih0aGlzLl9jb3JyZWN0UGx1cyhkKSx0aGlzLl9jb3JyZWN0TGluZShkKSksdGhpcy5fY29ycmVjdFBsdXMoZSksdGhpcy5fY29ycmVjdExpbmUoZSksdGhpcy5fY29ycmVjdFBsdXMoZiksZS5jaGlsZHNDb3VudD49MiYmKHRoaXMuX2NvcnJlY3RQbHVzKHVbZS5jaGlsZHNDb3VudC0yXSksdGhpcy5fY29ycmVjdExpbmUodVtlLmNoaWxkc0NvdW50LTJdKSksMiE9ZS5jaGlsZHNDb3VudCYmdGhpcy5fY29ycmVjdFBsdXModVswXSksdGhpcy50c2NoZWNrJiZ0aGlzLl9jb3JyZWN0Q2hlY2tTdGF0ZXMoZSksdGhpcy5fb25yYWRoKSlpZigxPT10aGlzLnhtbHN0YXRlKXt2YXIgdj10aGlzLm9uWExFO3RoaXMub25YTEU9ZnVuY3Rpb24oZSl7dGhpcy5fb25yYWRoKHQpLHYmJnYoZSl9fWVsc2UgdGhpcy5fb25yYWRoKHQpO3JldHVybiBmfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fcGFyc2VJdGVtPWZ1bmN0aW9uKGUsdCxpLG4pe3ZhciBvO2lmKHRoaXMuX3NybmQmJighdGhpcy5faWRwdWxsW289ZS5nZXQoImlkIildfHwhdGhpcy5faWRwdWxsW29dLnNwYW4pKXJldHVybiB2b2lkIHRoaXMuX2FkZEl0ZW1TUk5EKHQuaWQsbyxlKTt2YXIgcj1lLmdldF9hbGwoKTtpZigib2JqZWN0Ij09dHlwZW9mIHRoaXMud2FpdFVwZGF0ZVhNTCYmIXRoaXMud2FpdFVwZGF0ZVhNTFtyLmlkXSlyZXR1cm4gdm9pZCB0aGlzLl9wYXJzZShlLHIuaWQsMSk7bnVsbCE9PXIudGV4dCYmInVuZGVmaW5lZCIhPXR5cGVvZiByLnRleHR8fChyLnRleHQ9ZS5zdWIoIml0ZW10ZXh0Iiksci50ZXh0JiYoci50ZXh0PXIudGV4dC5jb250ZW50KCkpKTt2YXIgbD1bXTtpZihyLnNlbGVjdCYmbC5wdXNoKCJTRUxFQ1QiKSxyLnRvcCYmbC5wdXNoKCJUT1AiKSxyLmNhbGwmJih0aGlzLm5vZGVBc2tpbmdDYWxsPXIuaWQpLC0xPT1yLmNoZWNrZWQ/bC5wdXNoKCJIQ0hFQ0tFRCIpOnIuY2hlY2tlZCYmbC5wdXNoKCJDSEVDS0VEIiksci5vcGVuJiZsLnB1c2goIk9QRU4iKSx0aGlzLndhaXRVcGRhdGVYTUwpaWYodGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChyLmlkKSl2YXIgcz10aGlzLnVwZGF0ZUl0ZW0oci5pZCxyLnRleHQsci5pbTAsci5pbTEsci5pbTIsci5jaGVja2VkLHIuY2hpbGQpO2Vsc2V7MD09dGhpcy5ucGw/bC5wdXNoKCJUT1AiKTppPXQuY2hpbGROb2Rlc1t0aGlzLm5wbF07dmFyIHM9dGhpcy5fYXR0YWNoQ2hpbGROb2RlKHQsci5pZCxyLnRleHQsMCxyLmltMCxyLmltMSxyLmltMixsLmpvaW4oIiwiKSxyLmNoaWxkLDAsaSk7ci5pZD1zLmlkLGk9bnVsbH1lbHNlIHZhciBzPXRoaXMuX2F0dGFjaENoaWxkTm9kZSh0LHIuaWQsci50ZXh0LDAsci5pbTAsci5pbTEsci5pbTIsbC5qb2luKCIsIiksci5jaGlsZCxufHwwLGkpO2lmKHIudG9vbHRpcCYmKHMuc3Bhbi5wYXJlbnROb2RlLnBhcmVudE5vZGUudGl0bGU9ci50b29sdGlwKSxyLnN0eWxlJiYocy5zcGFuLnN0eWxlLmNzc1RleHQ/cy5zcGFuLnN0eWxlLmNzc1RleHQrPSI7IityLnN0eWxlOnMuc3Bhbi5zZXRBdHRyaWJ1dGUoInN0eWxlIixzLnNwYW4uZ2V0QXR0cmlidXRlKCJzdHlsZSIpKyI7ICIrci5zdHlsZSkpLHIucmFkaW8mJihzLl9yX2xvZ2ljPSEwKSxyLm5vY2hlY2tib3gpe3ZhciBhPXMuc3Bhbi5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZy5wcmV2aW91c1NpYmxpbmc7YS5zdHlsZS5kaXNwbGF5PSJub25lIixzLm5vY2hlY2tib3g9ITB9ci5kaXNhYmxlZCYmKG51bGwhPXIuY2hlY2tlZCYmdGhpcy5fc2V0Q2hlY2socyxyLmNoZWNrZWQpLHRoaXMuZGlzYWJsZUNoZWNrYm94KHMsMSkpLHMuX2FjYz1yLmNoaWxkfHwwLHRoaXMucGFyc2VyRXh0ZW5zaW9uJiZ0aGlzLnBhcnNlckV4dGVuc2lvbi5fcGFyc2VFeHRlbnNpb24uY2FsbCh0aGlzLGUscix0P3QuaWQ6MCksdGhpcy5zZXRJdGVtQ29sb3IocyxyLmFDb2wsci5zQ29sKSwiMSI9PXIubG9ja2VkJiZ0aGlzLmxvY2tJdGVtKHMuaWQsITAsITApLChyLmltd2lkdGh8fHIuaW1oZWlnaHQpJiZ0aGlzLnNldEljb25TaXplKHIuaW13aWR0aCxyLmltaGVpZ2h0LHMpLCIwIiE9ci5jbG9zZWFibGUmJiIxIiE9ci5jbG9zZWFibGV8fHRoaXMuc2V0SXRlbUNsb3NlYWJsZShzLHIuY2xvc2VhYmxlKTt2YXIgZD0iIjtyLnRvcG9mZnNldCYmdGhpcy5zZXRJdGVtVG9wT2Zmc2V0KHMsci50b3BvZmZzZXQpLHRoaXMuc2xvd1BhcnNlJiYib2JqZWN0IiE9dHlwZW9mIHRoaXMud2FpdFVwZGF0ZVhNTD8oIXMuY2hpbGRzQ291bnQmJmUuc3ViX2V4aXN0cygiaXRlbSIpJiYocy51blBhcnNlZD1lLmNsb25lKCkpLGUuZWFjaCgidXNlcmRhdGEiLGZ1bmN0aW9uKGUpe3RoaXMuc2V0VXNlckRhdGEoci5pZCxlLmdldCgibmFtZSIpLGUuY29udGVudCgpKX0sdGhpcykpOmUuc3ViX2V4aXN0cygiaXRlbSIpJiYoZD10aGlzLl9wYXJzZShlLHIuaWQsMSkpLCIiIT1kJiYodGhpcy5ub2RlQXNraW5nQ2FsbD1kKSxlLmVhY2goInVzZXJkYXRhIixmdW5jdGlvbih0KXt0aGlzLnNldFVzZXJEYXRhKGUuZ2V0KCJpZCIpLHQuZ2V0KCJuYW1lIiksdC5jb250ZW50KCkpfSx0aGlzKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3BhcnNlPWZ1bmN0aW9uKGUsdCxpLG4pe2lmKHRoaXMuX3NybmQmJiF0aGlzLnBhcmVudE9iamVjdC5vZmZzZXRIZWlnaHQpe3ZhciBvPXRoaXM7cmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7by5fcGFyc2UoZSx0LGksbil9LDEwMCl9aWYoZS5leGlzdHMoKSl7aWYodGhpcy5za2lwTG9jaz0hMCwhdCl7dD1lLmdldCgiaWQiKSx0aGlzLl9keW5EZWxldGVCcmFuY2hlc1t0XSYmKHRoaXMuZGVsZXRlQ2hpbGRJdGVtcyh0KSx0aGlzLl9keW5EZWxldGVCcmFuY2hlc1t0XS0tLHRoaXMuX2R5bkRlbGV0ZUJyYW5jaGVzW3RdfHxkZWxldGUgdGhpcy5fZHluRGVsZXRlQnJhbmNoZXNbdF0pO3ZhciByPWUuZ2V0KCJkaHhfc2VjdXJpdHkiKTtyJiYoZGh0bWx4LnNlY3VyaXR5X2tleT1yKSxlLmdldCgicmFkaW8iKSYmKHRoaXMuaHRtbE5vZGUuX3JfbG9naWM9ITApLHRoaXMucGFyc2luZ09uPXQsdGhpcy5wYXJzZWRBcnJheT1uZXcgQXJyYXksdGhpcy5zZXRDaGVja0xpc3Q9IiIsdGhpcy5ub2RlQXNraW5nQ2FsbD0iIn12YXIgbD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKHQpO2lmKCFsKXJldHVybiBkaHg0LmNhbGxFdmVudCgib25EYXRhU3RydWN0dXJlRXJyb3IiLFsiWE1MIHJlZmVycyB0byBub3QgZXhpc3RpbmcgcGFyZW50Il0pO2lmKHRoaXMucGFyc0NvdW50PXRoaXMucGFyc0NvdW50P3RoaXMucGFyc0NvdW50KzE6MSx0aGlzLlhNTGxvYWRpbmdXYXJuaW5nPTEsIWwuY2hpbGRzQ291bnR8fG58fHRoaXMuX2Vkc2Jwc3x8bC5faGFzX3RvcCl2YXIgcz0wO2Vsc2UgdmFyIHM9MDtpZih0aGlzLm5wbD0wLGUuZWFjaCgiaXRlbSIsZnVuY3Rpb24obixvKXtyZXR1cm4gbC5YTUxsb2FkPTEsdGhpcy5fcGFyc2VJdGVtKG4sbCwwLHMpLHRoaXMuX2Vkc2JwcyYmdGhpcy5ucGw9PXRoaXMuX2Vkc2Jwc0M/KHRoaXMuX2Rpc3RyaWJ1dGVkU3RhcnQoZSxvKzEsdCxpLGwuY2hpbGRzQ291bnQpLC0xKTp2b2lkIHRoaXMubnBsKyt9LHRoaXMsbiksIWkpe2lmKGUuZWFjaCgidXNlcmRhdGEiLGZ1bmN0aW9uKHQpe3RoaXMuc2V0VXNlckRhdGEoZS5nZXQoImlkIiksdC5nZXQoIm5hbWUiKSx0LmNvbnRlbnQoKSl9LHRoaXMpLGwuWE1MbG9hZD0xLHRoaXMud2FpdFVwZGF0ZVhNTCl7dGhpcy53YWl0VXBkYXRlWE1MPSExO2Zvcih2YXIgYT1sLmNoaWxkc0NvdW50LTE7YT49MDthLS0pbC5jaGlsZE5vZGVzW2FdLl9kbWFyayYmdGhpcy5kZWxldGVJdGVtKGwuY2hpbGROb2Rlc1thXS5pZCl9Zm9yKHZhciBhPSh0aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKHRoaXMucGFyc2luZ09uKSwwKTthPHRoaXMucGFyc2VkQXJyYXkubGVuZ3RoO2ErKylsLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uYXBwZW5kQ2hpbGQodGhpcy5wYXJzZWRBcnJheVthXSk7dGhpcy5wYXJzZWRBcnJheT1bXSx0aGlzLmxhc3RMb2FkZWRYTUxJZD10LHRoaXMuWE1MbG9hZGluZ1dhcm5pbmc9MDtmb3IodmFyIGQ9dGhpcy5zZXRDaGVja0xpc3Quc3BsaXQodGhpcy5kbG10ciksaD0wO2g8ZC5sZW5ndGg7aCsrKWRbaF0mJnRoaXMuc2V0Q2hlY2soZFtoXSwxKTt0aGlzLlhNTHNvdXJjZSYmdGhpcy50c2NoZWNrJiZ0aGlzLnNtY2hlY2smJmwuaWQhPXRoaXMucm9vdElkJiYoMD09PWwuY2hlY2tzdGF0ZT90aGlzLl9zZXRTdWJDaGVja2VkKDAsbCk6MT09PWwuY2hlY2tzdGF0ZSYmdGhpcy5fc2V0U3ViQ2hlY2tlZCgxLGwpKSx0aGlzLl9yZWRyYXdGcm9tKHRoaXMsbnVsbCxuKSxlLmdldCgib3JkZXIiKSYmIm5vbmUiIT1lLmdldCgib3JkZXIiKSYmdGhpcy5fcmVvcmRlckJyYW5jaChsLGUuZ2V0KCJvcmRlciIpLCEwKSwiIiE9dGhpcy5ub2RlQXNraW5nQ2FsbCYmdGhpcy5jYWxsRXZlbnQoIm9uQ2xpY2siLFt0aGlzLm5vZGVBc2tpbmdDYWxsLHRoaXMuZ2V0U2VsZWN0ZWRJdGVtSWQoKV0pLHRoaXMuX2JyYW5jaFVwZGF0ZSYmdGhpcy5fYnJhbmNoVXBkYXRlTmV4dChlKX1pZigxPT10aGlzLnBhcnNDb3VudCl7aWYodGhpcy5wYXJzaW5nT249bnVsbCx0aGlzLl9zcm5kJiZsLmlkIT10aGlzLnJvb3RJZCYmKHRoaXMucHJlcGFyZVNSKGwuaWQpLHRoaXMuWE1Mc291cmNlJiZ0aGlzLm9wZW5JdGVtKGwuaWQpKSxlLnRocm91Z2goIml0ZW0iLCJvcGVuIixudWxsLGZ1bmN0aW9uKGUpe3RoaXMub3Blbkl0ZW0oZS5nZXQoImlkIikpfSx0aGlzKSwhdGhpcy5fZWRzYnBzfHwhdGhpcy5fZWRzYnBzQS5sZW5ndGgpe3ZhciBjPXRoaXM7d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtjLmNhbGxFdmVudCgib25YTEUiLFtjLHRdKX0sMSksdGhpcy54bWxzdGF0ZT0wfXRoaXMuc2tpcExvY2s9ITF9dGhpcy5wYXJzQ291bnQtLTt2YXIgYz10aGlzO3JldHVybiB0aGlzLl9lZHNicHMmJndpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yy5fZGlzdHJpYnV0ZWRTdGVwKHQpfSx0aGlzLl9lZHNicHNEKSwhaSYmdGhpcy5vblhMRSYmdGhpcy5vblhMRSh0aGlzLHQpLHRoaXMubm9kZUFza2luZ0NhbGx9fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fcmVkcmF3RnJvbT1mdW5jdGlvbihlLHQsaSxuKXtpZih0KW89dDtlbHNle3ZhciBvPWUuX2dsb2JhbElkU3RvcmFnZUZpbmQoZS5sYXN0TG9hZGVkWE1MSWQpO2lmKGUubGFzdExvYWRlZFhNTElkPS0xLCFvKXJldHVybiAwfWZvcih2YXIgcj0wLGw9aT9pLTE6MDtsPG8uY2hpbGRzQ291bnQ7bCsrKWlmKHRoaXMuX2JyYW5jaFVwZGF0ZSYmMSE9dGhpcy5fZ2V0T3BlblN0YXRlKG8pfHx0JiYxIT1ufHwoby5jaGlsZE5vZGVzW2xdLmh0bWxOb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5zdHlsZS5kaXNwbGF5PSIiKSwxPT1vLmNoaWxkTm9kZXNbbF0ub3Blbk1lJiYodGhpcy5fb3Blbkl0ZW0oby5jaGlsZE5vZGVzW2xdKSxvLmNoaWxkTm9kZXNbbF0ub3Blbk1lPTApLGUuX3JlZHJhd0Zyb20oZSxvLmNoaWxkTm9kZXNbbF0pLG51bGwhPXRoaXMuY2hpbGRDYWxjKXtpZigoby5jaGlsZE5vZGVzW2xdLnVuUGFyc2VkfHwhby5jaGlsZE5vZGVzW2xdLlhNTGxvYWQmJnRoaXMuWE1Mc291cmNlKSYmKG8uY2hpbGROb2Rlc1tsXS5fYWNjP28uY2hpbGROb2Rlc1tsXS5zcGFuLmlubmVySFRNTD1vLmNoaWxkTm9kZXNbbF0ubGFiZWwrdGhpcy5odG1sY0Erby5jaGlsZE5vZGVzW2xdLl9hY2MrdGhpcy5odG1sY0I6by5jaGlsZE5vZGVzW2xdLnNwYW4uaW5uZXJIVE1MPW8uY2hpbGROb2Rlc1tsXS5sYWJlbCksby5jaGlsZE5vZGVzW2xdLmNoaWxkTm9kZXMubGVuZ3RoJiZ0aGlzLmNoaWxkQ2FsYyl7aWYoMT09dGhpcy5jaGlsZENhbGMmJihvLmNoaWxkTm9kZXNbbF0uc3Bhbi5pbm5lckhUTUw9by5jaGlsZE5vZGVzW2xdLmxhYmVsK3RoaXMuaHRtbGNBK28uY2hpbGROb2Rlc1tsXS5jaGlsZHNDb3VudCt0aGlzLmh0bWxjQiksMj09dGhpcy5jaGlsZENhbGMpe3ZhciBzPW8uY2hpbGROb2Rlc1tsXS5jaGlsZHNDb3VudC0oby5jaGlsZE5vZGVzW2xdLnB1cmVDaGlsZHN8fDApO3MmJihvLmNoaWxkTm9kZXNbbF0uc3Bhbi5pbm5lckhUTUw9by5jaGlsZE5vZGVzW2xdLmxhYmVsK3RoaXMuaHRtbGNBK3MrdGhpcy5odG1sY0IpLG8ucHVyZUNoaWxkcz9vLnB1cmVDaGlsZHMrKzpvLnB1cmVDaGlsZHM9MX1pZigzPT10aGlzLmNoaWxkQ2FsYyYmKG8uY2hpbGROb2Rlc1tsXS5zcGFuLmlubmVySFRNTD1vLmNoaWxkTm9kZXNbbF0ubGFiZWwrdGhpcy5odG1sY0Erby5jaGlsZE5vZGVzW2xdLl9hY2MrdGhpcy5odG1sY0IpLDQ9PXRoaXMuY2hpbGRDYWxjKXt2YXIgcz1vLmNoaWxkTm9kZXNbbF0uX2FjYztzJiYoby5jaGlsZE5vZGVzW2xdLnNwYW4uaW5uZXJIVE1MPW8uY2hpbGROb2Rlc1tsXS5sYWJlbCt0aGlzLmh0bWxjQStzK3RoaXMuaHRtbGNCKX19ZWxzZSA0PT10aGlzLmNoaWxkQ2FsYyYmcisrO3IrPW8uY2hpbGROb2Rlc1tsXS5fYWNjLDM9PXRoaXMuY2hpbGRDYWxjJiZyKyt9by51blBhcnNlZHx8IW8uWE1MbG9hZCYmdGhpcy5YTUxzb3VyY2V8fChvLl9hY2M9ciksZS5fY29ycmVjdExpbmUobyksZS5fY29ycmVjdFBsdXMobyksdGhpcy5jaGlsZENhbGMmJiF0JiZlLl9maXhDaGlsZENvdW50TGFiZWwobyl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9jcmVhdGVTZWxmPWZ1bmN0aW9uKCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7cmV0dXJuIGUuY2xhc3NOYW1lPSJjb250YWluZXJUYWJsZVN0eWxlIixlLnN0eWxlLndpZHRoPXRoaXMud2lkdGgsZS5zdHlsZS5oZWlnaHQ9dGhpcy5oZWlnaHQsdGhpcy5wYXJlbnRPYmplY3QuYXBwZW5kQ2hpbGQoZSksZX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3hjbG9zZUFsbD1mdW5jdGlvbihlKXtpZighZS51blBhcnNlZCl7aWYodGhpcy5yb290SWQhPWUuaWQpe2lmKCFlLmh0bWxOb2RlKXJldHVybjtmb3IodmFyIHQ9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMsaT10Lmxlbmd0aCxuPTE7aT5uO24rKyl0W25dLnN0eWxlLmRpc3BsYXk9Im5vbmUiO3RoaXMuX2NvcnJlY3RQbHVzKGUpfWZvcih2YXIgbj0wO248ZS5jaGlsZHNDb3VudDtuKyspZS5jaGlsZE5vZGVzW25dLmNoaWxkc0NvdW50JiZ0aGlzLl94Y2xvc2VBbGwoZS5jaGlsZE5vZGVzW25dKX19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl94b3BlbkFsbD1mdW5jdGlvbihlKXt0aGlzLl9IaWRlU2hvdyhlLDIpO2Zvcih2YXIgdD0wO3Q8ZS5jaGlsZHNDb3VudDt0KyspdGhpcy5feG9wZW5BbGwoZS5jaGlsZE5vZGVzW3RdKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvcnJlY3RQbHVzPWZ1bmN0aW9uKGUpe2lmKGUuaHRtbE5vZGUpe3ZhciB0PWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubGFzdENoaWxkLGk9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1syXS5jaGlsZE5vZGVzWzBdLG49dGhpcy5saW5lQXJyYXk7aWYodGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe3ZhciBuPXRoaXMucGx1c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1syXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWytdIn1lbHNlIGlmKGUuY2hpbGRzQ291bnR8fGUudW5QYXJzZWQpaWYoZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0mJiJub25lIiE9ZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uc3R5bGUuZGlzcGxheSl7aWYoIWUud3NpZ24pdmFyIG49dGhpcy5taW51c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1sxXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWy1dIn1lbHNle2lmKCFlLndzaWduKXZhciBuPXRoaXMucGx1c0FycmF5O2lmKHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1syXSksdGhpcy5fdHh0aW1nKXJldHVybiB0LmlubmVySFRNTD0iWytdIn1lbHNlIHRoaXMuX3NldFNyYyhpLHRoaXMuaWNvblVSTCtlLmltYWdlc1swXSk7dmFyIG89MjtlLnRyZWVOb2QudHJlZUxpbmVzT24/KGUucGFyZW50T2JqZWN0JiYobz10aGlzLl9nZXRDb3VudFN0YXR1cyhlLmlkLGUucGFyZW50T2JqZWN0KSksdGhpcy5fc2V0U3JjKHQsdGhpcy5pbVBhdGgrbltvXSkpOnRoaXMuX3NldFNyYyh0LHRoaXMuaW1QYXRoK25bM10pfX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvcnJlY3RMaW5lPWZ1bmN0aW9uKGUpe2lmKGUuaHRtbE5vZGUpe3ZhciB0PWUucGFyZW50T2JqZWN0O2lmKHQpaWYoMCE9dGhpcy5fZ2V0TGluZVN0YXR1cyhlLmlkLHQpJiZ0aGlzLnRyZWVMaW5lc09uKWZvcih2YXIgaT0xO2k8PWUuY2hpbGRzQ291bnQmJmUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldO2krKyllLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1tpXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmRJbWFnZT0idXJsKCIrdGhpcy5pbVBhdGgrdGhpcy5saW5lQXJyYXlbNV0rIikiLGUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFJlcGVhdD0icmVwZWF0LXkiO2Vsc2UgZm9yKHZhciBpPTE7aTw9ZS5jaGlsZHNDb3VudCYmZS5odG1sTm9kZS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbaV07aSsrKWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZEltYWdlPSIiLGUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzW2ldLmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZFJlcGVhdD0iIn19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nZXRMaW5lU3RhdHVzPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQuY2hpbGROb2Rlc1t0LmNoaWxkc0NvdW50LTFdLmlkPT1lPzA6MX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX0hpZGVTaG93PWZ1bmN0aW9uKGUsdCl7aWYoIXRoaXMuX2xvY2tlcnx8dGhpcy5za2lwTG9ja3x8IXRoaXMuX2xvY2tlcltlLmlkXSl7aWYodGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe2lmKDE9PXQpcmV0dXJuO3JldHVybiBlLlhNTGxvYWQ9MSx2b2lkIHRoaXMuX2xvYWREeW5YTUwoZS5pZCl9ZS51blBhcnNlZCYmdGhpcy5yZVBhcnNlKGUpO3ZhciBpPWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLG49aS5sZW5ndGg7aWYobj4xKXsibm9uZSI9PWlbMV0uc3R5bGUuZGlzcGxheSYmMSE9dHx8Mj09dD9ub2Rlc3R5bGU9IiI6KHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLmJvcmRlcj0iMSIsdGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0uYm9yZGVyPSIwIixub2Rlc3R5bGU9Im5vbmUiKTtmb3IodmFyIG89MTtuPm87bysrKWlbb10uc3R5bGUuZGlzcGxheT1ub2Rlc3R5bGV9dGhpcy5fY29ycmVjdFBsdXMoZSl9fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fZ2V0T3BlblN0YXRlPWZ1bmN0aW9uKGUpe2lmKCFlLmh0bWxOb2RlKXJldHVybiAwO3ZhciB0PWUuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzO3JldHVybiB0Lmxlbmd0aDw9MT8wOiJub25lIiE9dFsxXS5zdHlsZS5kaXNwbGF5PzE6LTF9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLm9uUm93Q2xpY2syPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wYXJlbnRPYmplY3QudHJlZU5vZDtyZXR1cm4gZS5jYWxsRXZlbnQoIm9uRGJsQ2xpY2siLFt0aGlzLnBhcmVudE9iamVjdC5pZCxlXSk/KHRoaXMucGFyZW50T2JqZWN0LmNsb3NlYmxlJiYiMCIhPXRoaXMucGFyZW50T2JqZWN0LmNsb3NlYmxlP2UuX0hpZGVTaG93KHRoaXMucGFyZW50T2JqZWN0KTplLl9IaWRlU2hvdyh0aGlzLnBhcmVudE9iamVjdCwyKSxlLmNoZWNrRXZlbnQoIm9uT3BlbkVuZCIpJiYoZS54bWxzdGF0ZT8oZS5fb2llX29uWExFLnB1c2goZS5vblhMRSksZS5vblhMRT1lLl9lcG5GSGUpOmUuY2FsbEV2ZW50KCJvbk9wZW5FbmQiLFt0aGlzLnBhcmVudE9iamVjdC5pZCxlLl9nZXRPcGVuU3RhdGUodGhpcy5wYXJlbnRPYmplY3QpXSkpLCExKTohMX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub25Sb3dDbGljaz1mdW5jdGlvbigpe3ZhciBlPXRoaXMucGFyZW50T2JqZWN0LnRyZWVOb2Q7cmV0dXJuIGUuY2FsbEV2ZW50KCJvbk9wZW5TdGFydCIsW3RoaXMucGFyZW50T2JqZWN0LmlkLGUuX2dldE9wZW5TdGF0ZSh0aGlzLnBhcmVudE9iamVjdCldKT8odGhpcy5wYXJlbnRPYmplY3QuY2xvc2VibGUmJiIwIiE9dGhpcy5wYXJlbnRPYmplY3QuY2xvc2VibGU/ZS5fSGlkZVNob3codGhpcy5wYXJlbnRPYmplY3QpOmUuX0hpZGVTaG93KHRoaXMucGFyZW50T2JqZWN0LDIpLHZvaWQoZS5jaGVja0V2ZW50KCJvbk9wZW5FbmQiKSYmKGUueG1sc3RhdGU/KGUuX29pZV9vblhMRS5wdXNoKGUub25YTEUpLGUub25YTEU9ZS5fZXBuRkhlKTplLmNhbGxFdmVudCgib25PcGVuRW5kIixbdGhpcy5wYXJlbnRPYmplY3QuaWQsZS5fZ2V0T3BlblN0YXRlKHRoaXMucGFyZW50T2JqZWN0KV0pKSkpOjB9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldFNlbGVjdGVkSXRlbUlkPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPW5ldyBBcnJheSx0PTA7dDx0aGlzLl9zZWxlY3RlZC5sZW5ndGg7dCsrKWVbdF09dGhpcy5fc2VsZWN0ZWRbdF0uaWQ7cmV0dXJuIGUuam9pbih0aGlzLmRsbXRyKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3NlbGVjdEl0ZW09ZnVuY3Rpb24oZSx0KXtpZih0aGlzLmNoZWNrRXZlbnQoIm9uU2VsZWN0IikmJih0aGlzLl9vblNTQ0ZvbGQ9dGhpcy5nZXRTZWxlY3RlZEl0ZW1JZCgpKSx0aGlzLl9hbXNlbCYmdCYmKHQuY3RybEtleXx8dC5tZXRhS2V5fHx0LnNoaWZ0S2V5KXx8dGhpcy5fdW5zZWxlY3RJdGVtcygpLGUuaV9zZWwmJnRoaXMuX2Ftc2VsJiZ0JiYodC5jdHJsS2V5fHx0Lm1ldGFLZXkpKXRoaXMuX3Vuc2VsZWN0SXRlbShlKTtlbHNlIGlmKCEoZS5pX3NlbHx8dGhpcy5fYW1zZWxTJiYwIT10aGlzLl9zZWxlY3RlZC5sZW5ndGgmJnRoaXMuX3NlbGVjdGVkWzBdLnBhcmVudE9iamVjdCE9ZS5wYXJlbnRPYmplY3QpKWlmKHRoaXMuX2Ftc2VsJiZ0JiZ0LnNoaWZ0S2V5JiYwIT10aGlzLl9zZWxlY3RlZC5sZW5ndGgmJnRoaXMuX3NlbGVjdGVkW3RoaXMuX3NlbGVjdGVkLmxlbmd0aC0xXS5wYXJlbnRPYmplY3Q9PWUucGFyZW50T2JqZWN0KXt2YXIgaT10aGlzLl9nZXRJbmRleCh0aGlzLl9zZWxlY3RlZFt0aGlzLl9zZWxlY3RlZC5sZW5ndGgtMV0pLG49dGhpcy5fZ2V0SW5kZXgoZSk7aWYoaT5uKXt2YXIgbz1pO2k9bixuPW99Zm9yKHZhciByPWk7bj49cjtyKyspZS5wYXJlbnRPYmplY3QuY2hpbGROb2Rlc1tyXS5pX3NlbHx8dGhpcy5fbWFya0l0ZW0oZS5wYXJlbnRPYmplY3QuY2hpbGROb2Rlc1tyXSl9ZWxzZSB0aGlzLl9tYXJrSXRlbShlKTtpZih0aGlzLmNoZWNrRXZlbnQoIm9uU2VsZWN0Iikpe3ZhciBsPXRoaXMuZ2V0U2VsZWN0ZWRJdGVtSWQoKTtsIT10aGlzLl9vblNTQ0ZvbGQmJnRoaXMuY2FsbEV2ZW50KCJvblNlbGVjdCIsW2xdKX19LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9tYXJrSXRlbT1mdW5jdGlvbihlKXtlLnNjb2xvciYmKGUuc3Bhbi5zdHlsZS5jb2xvcj1lLnNjb2xvciksZS5zcGFuLmNsYXNzTmFtZT0ic2VsZWN0ZWRUcmVlUm93IixlLnNwYW4ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTmFtZT0ic2VsZWN0ZWRUcmVlUm93RnVsbCIsZS5pX3NlbD0hMCx0aGlzLl9zZWxlY3RlZFt0aGlzLl9zZWxlY3RlZC5sZW5ndGhdPWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldEluZGV4QnlJZD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO3JldHVybiB0P3RoaXMuX2dldEluZGV4KHQpOm51bGx9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9nZXRJbmRleD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5wYXJlbnRPYmplY3QsaT0wO2k8dC5jaGlsZHNDb3VudDtpKyspaWYodC5jaGlsZE5vZGVzW2ldPT1lKXJldHVybiBpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fdW5zZWxlY3RJdGVtPWZ1bmN0aW9uKGUpe2lmKGUmJmUuaV9zZWwpe2Uuc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsZS5zcGFuLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWU9IiIsZS5hY29sb3ImJihlLnNwYW4uc3R5bGUuY29sb3I9ZS5hY29sb3IpLGUuaV9zZWw9ITE7Zm9yKHZhciB0PTA7dDx0aGlzLl9zZWxlY3RlZC5sZW5ndGg7dCsrKWlmKCF0aGlzLl9zZWxlY3RlZFt0XS5pX3NlbCl7dGhpcy5fc2VsZWN0ZWQuc3BsaWNlKHQsMSk7YnJlYWt9fX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX3Vuc2VsZWN0SXRlbXM9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MDtlPHRoaXMuX3NlbGVjdGVkLmxlbmd0aDtlKyspe3ZhciB0PXRoaXMuX3NlbGVjdGVkW2VdO3Quc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsdC5zcGFuLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWU9IiIsdC5hY29sb3ImJih0LnNwYW4uc3R5bGUuY29sb3I9dC5hY29sb3IpLHQuaV9zZWw9ITF9dGhpcy5fc2VsZWN0ZWQ9bmV3IEFycmF5fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5vblJvd1NlbGVjdD1mdW5jdGlvbihlLHQsaSl7ZT1lfHx3aW5kb3cuZXZlbnQ7dmFyIG49dGhpcy5wYXJlbnRPYmplY3Q7dCYmKG49dC5wYXJlbnRPYmplY3QpO3ZhciBvPW4udHJlZU5vZCxyPW8uZ2V0U2VsZWN0ZWRJdGVtSWQoKTtlJiZlLnNraXBVblNlbHx8by5fc2VsZWN0SXRlbShuLGUpLGl8fChuLmFjdGlvbkhhbmRsZXI/bi5hY3Rpb25IYW5kbGVyKG4uaWQscik6by5jYWxsRXZlbnQoIm9uQ2xpY2siLFtuLmlkLHJdKSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLl9jcmVhdGVJdGVtPWZ1bmN0aW9uKGUsdCxpKXt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpO24uY2VsbFNwYWNpbmc9MCxuLmNlbGxQYWRkaW5nPTAsbi5ib3JkZXI9MCx0aGlzLmhmTW9kZSYmKG4uc3R5bGUudGFibGVMYXlvdXQ9ImZpeGVkIiksbi5zdHlsZS5tYXJnaW49MCxuLnN0eWxlLnBhZGRpbmc9MDt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpLHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHIiKSxsPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7aWYobC5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZUltYWdlIix0aGlzLl90eHRpbWcpe3ZhciBzPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2wuYXBwZW5kQ2hpbGQocykscy5jbGFzc05hbWU9ImRoeF90cmVlX3RleHRTaWduIn1lbHNle3ZhciBzPXRoaXMuX2dldEltZyh0LmlkKTtzLmJvcmRlcj0iMCIsIklNRyI9PXMudGFnTmFtZSYmKHMuYWxpZ249ImFic21pZGRsZSIpLGwuYXBwZW5kQ2hpbGQocykscy5zdHlsZS5wYWRkaW5nPTAscy5zdHlsZS5tYXJnaW49MCxzLnN0eWxlLndpZHRoPXRoaXMuZGVmX2xpbmVfaW1nX3h9dmFyIGE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKSxkPXRoaXMuX2dldEltZyh0aGlzLmNCUk9mP3RoaXMucm9vdElkOnQuaWQpO2QuY2hlY2tlZD0wLHRoaXMuX3NldFNyYyhkLHRoaXMuaW1QYXRoK3RoaXMuY2hlY2tBcnJheVswXSksZC5zdHlsZS53aWR0aD0iMThweCIsZC5zdHlsZS5oZWlnaHQ9IjE4cHgiLGV8fChhLnN0eWxlLmRpc3BsYXk9Im5vbmUiKSxhLmFwcGVuZENoaWxkKGQpLHRoaXMuY0JST2Z8fCJJTUciIT1kLnRhZ05hbWV8fChkLmFsaWduPSJhYnNtaWRkbGUiKSxkLm9uY2xpY2s9dGhpcy5vbkNoZWNrQm94Q2xpY2ssZC50cmVlTm9kPXRoaXMsZC5wYXJlbnRPYmplY3Q9dCx3aW5kb3cuX0tIVE1McnY/YS53aWR0aD0iMTZweCI6YS53aWR0aD0iMjBweCI7dmFyIGg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTtoLmNsYXNzTmFtZT0ic3RhbmRhcnRUcmVlSW1hZ2UiO3ZhciBjPXRoaXMuX2dldEltZyh0aGlzLnRpbWdlbj90LmlkOnRoaXMucm9vdElkKTtjLm9ubW91c2Vkb3duPXRoaXMuX3ByZXZlbnROc0RyYWcsYy5vbmRyYWdzdGFydD10aGlzLl9wcmV2ZW50TnNEcmFnLGMuYm9yZGVyPSIwIix0aGlzLl9haW1ncyYmKGMucGFyZW50T2JqZWN0PXQsCiJJTUciPT1jLnRhZ05hbWUmJihjLmFsaWduPSJhYnNtaWRkbGUiKSxjLm9uY2xpY2s9dGhpcy5vblJvd1NlbGVjdCksaXx8dGhpcy5fc2V0U3JjKGMsdGhpcy5pY29uVVJMK3RoaXMuaW1hZ2VBcnJheVswXSksaC5hcHBlbmRDaGlsZChjKSxjLnN0eWxlLnBhZGRpbmc9MCxjLnN0eWxlLm1hcmdpbj0wLHRoaXMudGltZ2VuPyhoLnN0eWxlLndpZHRoPWMuc3R5bGUud2lkdGg9dGhpcy5kZWZfaW1nX3gsYy5zdHlsZS5oZWlnaHQ9dGhpcy5kZWZfaW1nX3kpOihjLnN0eWxlLndpZHRoPSIwcHgiLGMuc3R5bGUuaGVpZ2h0PSIwcHgiLChfaXNPcGVyYXx8d2luZG93Ll9LSFRNTHJ2KSYmKGguc3R5bGUuZGlzcGxheT0ibm9uZSIpKTt2YXIgdT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpO3JldHVybiB1LmNsYXNzTmFtZT0iZGh4VGV4dENlbGwgc3RhbmRhcnRUcmVlUm93Iix0LnNwYW49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpLHQuc3Bhbi5jbGFzc05hbWU9InN0YW5kYXJ0VHJlZVJvdyIsdGhpcy5tbGl0ZW1zPyh0LnNwYW4uc3R5bGUud2lkdGg9dGhpcy5tbGl0ZW1zLHQuc3Bhbi5zdHlsZS5kaXNwbGF5PSJibG9jayIpOnUubm9XcmFwPSEwLGRoeDQuaXNJRTg/dS5zdHlsZS53aWR0aD0iOTk5OTlweCI6d2luZG93Ll9LSFRNTHJ2fHwodS5zdHlsZS53aWR0aD0iMTAwJSIpLHQuc3Bhbi5pbm5lckhUTUw9dC5sYWJlbCx1LmFwcGVuZENoaWxkKHQuc3BhbiksdS5wYXJlbnRPYmplY3Q9dCxsLnBhcmVudE9iamVjdD10LHUub25jbGljaz10aGlzLm9uUm93U2VsZWN0LGwub25jbGljaz10aGlzLm9uUm93Q2xpY2ssdS5vbmRibGNsaWNrPXRoaXMub25Sb3dDbGljazIsdGhpcy5ldHRpcCYmKHIudGl0bGU9dC5sYWJlbCksdGhpcy5kcmFnQW5kRHJvcE9mZiYmKHRoaXMuX2FpbWdzJiYodGhpcy5kcmFnZ2VyLmFkZERyYWdnYWJsZUl0ZW0oaCx0aGlzKSxoLnBhcmVudE9iamVjdD10KSx0aGlzLmRyYWdnZXIuYWRkRHJhZ2dhYmxlSXRlbSh1LHRoaXMpKSx0LnNwYW4uc3R5bGUucGFkZGluZ0xlZnQ9IjVweCIsdC5zcGFuLnN0eWxlLnBhZGRpbmdSaWdodD0iNXB4Iix1LnN0eWxlLnZlcnRpY2FsQWxpZ249IiIsdS5zdHlsZS5mb250U2l6ZT0iMTBwdCIsdS5zdHlsZS5jdXJzb3I9dGhpcy5zdHlsZV9wb2ludGVyLHIuYXBwZW5kQ2hpbGQobCksci5hcHBlbmRDaGlsZChhKSxyLmFwcGVuZENoaWxkKGgpLHIuYXBwZW5kQ2hpbGQodSksby5hcHBlbmRDaGlsZChyKSxuLmFwcGVuZENoaWxkKG8pLCh0aGlzLmVobHR8fHRoaXMuY2hlY2tFdmVudCgib25Nb3VzZUluIil8fHRoaXMuY2hlY2tFdmVudCgib25Nb3VzZU91dCIpKSYmKHIub25tb3VzZW1vdmU9dGhpcy5faXRlbU1vdXNlSW4scltfaXNJRT8ib25tb3VzZWxlYXZlIjoib25tb3VzZW91dCJdPXRoaXMuX2l0ZW1Nb3VzZU91dCksbn0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25SaWdodENsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvblJpZ2h0Q2xpY2siLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbkNsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbkNsaWNrIixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25TZWxlY3RTdGF0ZUNoYW5nZT1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvblNlbGVjdCIsZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldFhNTEF1dG9Mb2FkaW5nPWZ1bmN0aW9uKGUpe3RoaXMuWE1Mc291cmNlPWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uQ2hlY2tIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uQ2hlY2siLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbk9wZW5IYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uT3BlblN0YXJ0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25PcGVuU3RhcnRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuYXR0YWNoRXZlbnQoIm9uT3BlblN0YXJ0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0T25PcGVuRW5kSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbk9wZW5FbmQiLGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRPbkRibENsaWNrSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLmF0dGFjaEV2ZW50KCJvbkRibENsaWNrIixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub3BlbkFsbEl0ZW1zPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7cmV0dXJuIHQ/dm9pZCB0aGlzLl94b3BlbkFsbCh0KTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5nZXRPcGVuU3RhdGU9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlKTtyZXR1cm4gdD90aGlzLl9nZXRPcGVuU3RhdGUodCk6IiJ9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmNsb3NlQWxsSXRlbXM9ZnVuY3Rpb24oZSl7ZT09PXdpbmRvdy51bmRlZmluZWQmJihlPXRoaXMucm9vdElkKTt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO3JldHVybiB0Pyh0aGlzLl94Y2xvc2VBbGwodCksdGhpcy5hbGxUcmVlLmNoaWxkTm9kZXNbMF0uYm9yZGVyPSIxIix2b2lkKHRoaXMuYWxsVHJlZS5jaGlsZE5vZGVzWzBdLmJvcmRlcj0iMCIpKTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRVc2VyRGF0YT1mdW5jdGlvbihlLHQsaSl7dmFyIG49dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlLDAsITApO24mJigiaGludCI9PXQmJihuLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS50aXRsZT1pKSwidW5kZWZpbmVkIj09dHlwZW9mIG4udXNlckRhdGFbInRfIit0XSYmKG4uX3VzZXJkYXRhbGlzdD9uLl91c2VyZGF0YWxpc3QrPSIsIit0Om4uX3VzZXJkYXRhbGlzdD10KSxuLnVzZXJEYXRhWyJ0XyIrdF09aSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLmdldFVzZXJEYXRhPWZ1bmN0aW9uKGUsdCl7dmFyIGk9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlLDAsITApO2lmKGkpcmV0dXJuIGkudXNlckRhdGFbInRfIit0XX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZ2V0SXRlbUNvbG9yPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7aWYoIXQpcmV0dXJuIDA7dmFyIGk9bmV3IE9iamVjdDtyZXR1cm4gdC5hY29sb3ImJihpLmFjb2xvcj10LmFjb2xvciksdC5zY29sb3ImJihpLnNjb2xvcj10LnNjb2xvciksaX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuc2V0SXRlbUNvbG9yPWZ1bmN0aW9uKGUsdCxpKXtpZihlJiZlLnNwYW4pdmFyIG49ZTtlbHNlIHZhciBuPXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7cmV0dXJuIG4/KG4uaV9zZWw/KGl8fHQpJiYobi5zcGFuLnN0eWxlLmNvbG9yPWl8fHQpOnQmJihuLnNwYW4uc3R5bGUuY29sb3I9dCksaSYmKG4uc2NvbG9yPWkpLHQmJihuLmFjb2xvcj10KSx2b2lkIDApOjB9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uTW91c2VJbkhhbmRsZXI9ZnVuY3Rpb24oZSl7dGhpcy5laGx0PSEwLHRoaXMuYXR0YWNoRXZlbnQoIm9uTW91c2VJbiIsZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnNldE9uTW91c2VPdXRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMuZWhsdD0hMCx0aGlzLmF0dGFjaEV2ZW50KCJvbk1vdXNlT3V0IixlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlVHJlZUxpbmVzPWZ1bmN0aW9uKGUpe3RoaXMudHJlZUxpbmVzT249ZGh4NC5zMmIoZSl9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLm9wZW5JdGVtPWZ1bmN0aW9uKGUpe3RoaXMuc2tpcExvY2s9ITA7dmFyIHQ9dGhpcy5fZ2xvYmFsSWRTdG9yYWdlRmluZChlKTtyZXR1cm4gdD90aGlzLl9vcGVuSXRlbSh0KTowfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fb3Blbkl0ZW09ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fZ2V0T3BlblN0YXRlKGUpO2lmKDA+dHx8dGhpcy5YTUxzb3VyY2UmJiFlLlhNTGxvYWQpe2lmKCF0aGlzLmNhbGxFdmVudCgib25PcGVuU3RhcnQiLFtlLmlkLHRdKSlyZXR1cm4gMDt0aGlzLl9IaWRlU2hvdyhlLDIpLHRoaXMuY2hlY2tFdmVudCgib25PcGVuRW5kIikmJih0aGlzLm9uWExFPT10aGlzLl9lcG5GSGUmJnRoaXMuX2VwbkZIZSh0aGlzLGUuaWQsITApLHRoaXMueG1sc3RhdGUmJnRoaXMuWE1Mc291cmNlPyh0aGlzLl9vaWVfb25YTEUucHVzaCh0aGlzLm9uWExFKSx0aGlzLm9uWExFPXRoaXMuX2VwbkZIZSk6dGhpcy5jYWxsRXZlbnQoIm9uT3BlbkVuZCIsW2UuaWQsdGhpcy5fZ2V0T3BlblN0YXRlKGUpXSkpfWVsc2UgdGhpcy5fc3JuZCYmdGhpcy5fSGlkZVNob3coZSwyKTtlLnBhcmVudE9iamVjdCYmIXRoaXMuX3NraXBfb3Blbl9wYXJlbnQmJnRoaXMuX29wZW5JdGVtKGUucGFyZW50T2JqZWN0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dldEFsbEZhdEl0ZW1zPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixpPTA7aTxlLmNoaWxkc0NvdW50O2krKylpZihlLmNoaWxkTm9kZXNbaV0udW5QYXJzZWR8fGUuY2hpbGROb2Rlc1tpXS5jaGlsZHNDb3VudD4wKXtpZih0P3QrPXRoaXMuZGxtdHIrZS5jaGlsZE5vZGVzW2ldLmlkOnQ9IiIrZS5jaGlsZE5vZGVzW2ldLmlkLGUuY2hpbGROb2Rlc1tpXS51blBhcnNlZCl2YXIgbj10aGlzLl9nZXRBbGxGYXRJdGVtc1hNTChlLmNoaWxkTm9kZXNbaV0udW5QYXJzZWQsMSk7ZWxzZSB2YXIgbj10aGlzLl9nZXRBbGxGYXRJdGVtcyhlLmNoaWxkTm9kZXNbaV0pO24mJih0Kz10aGlzLmRsbXRyK24pfXJldHVybiB0fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZWxlY3RJdGVtPWZ1bmN0aW9uKGUsdCxpKXt0PWRoeDQuczJiKHQpO3ZhciBuPXRoaXMuX2dsb2JhbElkU3RvcmFnZUZpbmQoZSk7aWYoIW58fCFuLnBhcmVudE9iamVjdClyZXR1cm4gMDt0aGlzLlhNTGxvYWRpbmdXYXJuaW5nP24ucGFyZW50T2JqZWN0Lm9wZW5NZT0xOnRoaXMuX29wZW5JdGVtKG4ucGFyZW50T2JqZWN0KTt2YXIgbz1udWxsO2kmJihvPW5ldyBPYmplY3Qsby5jdHJsS2V5PSEwLG4uaV9zZWwmJihvLnNraXBVblNlbD0hMCkpLHQ/dGhpcy5vblJvd1NlbGVjdChvLG4uaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbM10sITEpOnRoaXMub25Sb3dTZWxlY3QobyxuLmh0bWxOb2RlLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzNdLCEwKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2NvbXByZXNzQ2hpbGRMaXN0PWZ1bmN0aW9uKGUsdCl7ZS0tO2Zvcih2YXIgaT0wO2U+aTtpKyspMD09dFtpXSYmKHRbaV09dFtpKzFdLHRbaSsxXT0wKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2RlbGV0ZU5vZGU9ZnVuY3Rpb24oZSx0LGkpe2lmKCF0fHwhdC5wYXJlbnRPYmplY3QpcmV0dXJuIDA7dmFyIG49MCxvPTA7dC50ci5uZXh0U2libGluZyYmKG49dC50ci5uZXh0U2libGluZy5ub2RlbSksdC50ci5wcmV2aW91c1NpYmxpbmcmJihvPXQudHIucHJldmlvdXNTaWJsaW5nLm5vZGVtKTtmb3IodmFyIHI9dC5wYXJlbnRPYmplY3QsbD1yLmNoaWxkc0NvdW50LHM9ci5jaGlsZE5vZGVzLGE9MDtsPmE7YSsrKWlmKHNbYV0uaWQ9PWUpe2l8fHIuaHRtbE5vZGUuY2hpbGROb2Rlc1swXS5yZW1vdmVDaGlsZChzW2FdLnRyKSxzW2FdPTA7YnJlYWt9dGhpcy5fY29tcHJlc3NDaGlsZExpc3QobCxzKSxpfHxyLmNoaWxkc0NvdW50LS0sbiYmKHRoaXMuX2NvcnJlY3RQbHVzKG4pLHRoaXMuX2NvcnJlY3RMaW5lKG4pKSxvJiYodGhpcy5fY29ycmVjdFBsdXMobyksdGhpcy5fY29ycmVjdExpbmUobykpLHRoaXMudHNjaGVjayYmdGhpcy5fY29ycmVjdENoZWNrU3RhdGVzKHIpLGl8fHRoaXMuX2dsb2JhbElkU3RvcmFnZVJlY1N1Yih0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZGVsZXRlQ2hpbGRJdGVtcz1mdW5jdGlvbihlKXt2YXIgdD10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGUpO2lmKHQpZm9yKHZhciBpPXQuY2hpbGRzQ291bnQsbj0wO2k+bjtuKyspdGhpcy5fZGVsZXRlTm9kZSh0LmNoaWxkTm9kZXNbMF0uaWQsdC5jaGlsZE5vZGVzWzBdKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2dsb2JhbElkU3RvcmFnZVJlY1N1Yj1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PGUuY2hpbGRzQ291bnQ7dCsrKXRoaXMuX2dsb2JhbElkU3RvcmFnZVJlY1N1YihlLmNoaWxkTm9kZXNbdF0pLHRoaXMuX2dsb2JhbElkU3RvcmFnZVN1YihlLmNoaWxkTm9kZXNbdF0uaWQpO3RoaXMuX2dsb2JhbElkU3RvcmFnZVN1YihlLmlkKTt2YXIgaT1lO2kuc3Bhbj1udWxsLGkudHIubm9kZW09bnVsbCxpLnRyPW51bGwsaS5odG1sTm9kZT1udWxsfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5fYXV0b1Njcm9sbD1mdW5jdGlvbihlLHQsaSl7dGhpcy5hdXRvU2Nyb2xsJiYoZSYmKHQ9ZGh4NC5hYnNUb3AoZSksaT1kaHg0LmFic1RvcCh0aGlzLmFsbFRyZWUpLXRoaXMuYWxsVHJlZS5zY3JvbGxUb3ApLHQtaS1wYXJzZUludCh0aGlzLmFsbFRyZWUuc2Nyb2xsVG9wKT5wYXJzZUludCh0aGlzLmFsbFRyZWUub2Zmc2V0SGVpZ2h0KS01MCYmKHRoaXMuYWxsVHJlZS5zY3JvbGxUb3A9cGFyc2VJbnQodGhpcy5hbGxUcmVlLnNjcm9sbFRvcCkrMjApLHQtaTxwYXJzZUludCh0aGlzLmFsbFRyZWUuc2Nyb2xsVG9wKSszMCYmKHRoaXMuYWxsVHJlZS5zY3JvbGxUb3A9cGFyc2VJbnQodGhpcy5hbGxUcmVlLnNjcm9sbFRvcCktMjApKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlVGV4dFNpZ25zPWZ1bmN0aW9uKGUpe3RoaXMuX3R4dGltZz1kaHg0LnMyYihlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUucHJldmVudElFQ2FjaGluZz1mdW5jdGlvbihlKXtkaHg0LmFqYXguY2FjaGU9IWV9LGRodG1sWFRyZWVPYmplY3QucHJvdG90eXBlLnByZXZlbnRJRUNhc2hpbmc9ZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUucHJldmVudElFQ2FjaGluZyxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRJY29uU2l6ZT1mdW5jdGlvbihlLHQsaSl7aWYoaSl7aWYoaSYmaS5zcGFuKXZhciBuPWk7ZWxzZSB2YXIgbj10aGlzLl9nbG9iYWxJZFN0b3JhZ2VGaW5kKGkpO2lmKCFuKXJldHVybiAwO3ZhciBvPW4uc3Bhbi5wYXJlbnROb2RlLnByZXZpb3VzU2libGluZy5jaGlsZE5vZGVzWzBdO2UmJihvLnN0eWxlLndpZHRoPWUrInB4Iix3aW5kb3cuX0tIVE1McnYmJihvLnBhcmVudE5vZGUuc3R5bGUud2lkdGg9ZSsicHgiKSksdCYmKG8uc3R5bGUuaGVpZ2h0PXQrInB4Iix3aW5kb3cuX0tIVE1McnYmJihvLnBhcmVudE5vZGUuc3R5bGUuaGVpZ2h0PXQrInB4IikpfWVsc2UgdGhpcy5kZWZfaW1nX3g9ZSsicHgiLHRoaXMuZGVmX2ltZ195PXQrInB4In0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuZW5hYmxlU2luZ2xlUmFkaW9Nb2RlPWZ1bmN0aW9uKGUpe3RoaXMuX2ZyYnRycz1kaHg0LnMyYihlKX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUub3Blbk9uSXRlbUFkZGVkPWZ1bmN0aW9uKGUpe3RoaXMuX2hBZEk9IWRoeDQuczJiKGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5vcGVuT25JdGVtQWRkaW5nPWZ1bmN0aW9uKGUpe3RoaXMuX2hBZEk9IWRoeDQuczJiKGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5nZXRBbGxJdGVtc1dpdGhLaWRzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2dldEFsbEZhdEl0ZW1zKHRoaXMuaHRtbE5vZGUpfSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5zZXRTa2luPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucGFyZW50T2JqZWN0LmNsYXNzTmFtZS5yZXBsYWNlKC9kaHh0cmVlX1teIF0qL2dpLCIiKTt0aGlzLnBhcmVudE9iamVjdC5jbGFzc05hbWU9dCsiIGRoeHRyZWVfIitlLCJkaHhfdGVycmFjZSIhPWUmJiJkaHhfd2ViIiE9ZSYmIm1hdGVyaWFsIiE9ZXx8dGhpcy5lbmFibGVUcmVlTGluZXMoITEpLCJtYXRlcmlhbCI9PWUmJnRoaXMuc2V0SWNvblNpemUoIjI1IiwiMjUiKX0sanNvblBvaW50ZXIucHJvdG90eXBlPXt0ZXh0OmZ1bmN0aW9uKCl7dmFyIGU9ZnVuY3Rpb24oZSl7Zm9yKHZhciBpPVtdLG49MDtuPGUubGVuZ3RoO24rKylpLnB1c2goInsiK3QoZVtuXSkrIn0iKTtyZXR1cm4gaS5qb2luKCIsIil9LHQ9ZnVuY3Rpb24oaSl7dmFyIG49W107Zm9yKHZhciBvIGluIGkpIm9iamVjdCI9PXR5cGVvZiBpW29dP28ubGVuZ3RoP24ucHVzaCgnIicrbysnIjpbJytlKGlbb10pKyJdIik6bi5wdXNoKCciJytvKyciOnsnK3QoaVtvXSkrIn0iKTpuLnB1c2goJyInK28rJyI6IicraVtvXSsnIicpO3JldHVybiBuLmpvaW4oIiwiKX07cmV0dXJuInsiK3QodGhpcy5kKSsifSJ9LGdldDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5kW2VdfSxleGlzdHM6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuZH0sY29udGVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmQuY29udGVudH0sZWFjaDpmdW5jdGlvbihlLHQsaSl7dmFyIG49dGhpcy5kW2VdLG89bmV3IGpzb25Qb2ludGVyO2lmKG4pZm9yKHZhciByPTA7cjxuLmxlbmd0aDtyKyspby5kPW5bcl0sdC5hcHBseShpLFtvLHJdKX0sZ2V0X2FsbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmR9LHN1YjpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IGpzb25Qb2ludGVyKHRoaXMuZFtlXSx0aGlzLmQpfSxzdWJfZXhpc3RzOmZ1bmN0aW9uKGUpe3JldHVybiEhdGhpcy5kW2VdfSxlYWNoX3g6ZnVuY3Rpb24oZSx0LGksbixvKXt2YXIgcj10aGlzLmRbZV0sbD1uZXcganNvblBvaW50ZXIoMCx0aGlzLmQpO2lmKHIpZm9yKG89b3x8MDtvPHIubGVuZ3RoO28rKylpZihyW29dW3RdJiYobC5kPXJbb10sLTE9PWkuYXBwbHkobixbbCxvXSkpKXJldHVybn0sdXA6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBqc29uUG9pbnRlcih0aGlzLmRwLHRoaXMuZCl9LHNldDpmdW5jdGlvbihlLHQpe3RoaXMuZFtlXT10fSxjbG9uZTpmdW5jdGlvbihlKXtyZXR1cm4gbmV3IGpzb25Qb2ludGVyKHRoaXMuZCx0aGlzLmRwKX0sdGhyb3VnaDpmdW5jdGlvbihlLHQsaSxuLG8pe3ZhciByPXRoaXMuZFtlXTtpZihyLmxlbmd0aClmb3IodmFyIGw9MDtsPHIubGVuZ3RoO2wrKyl7aWYobnVsbCE9cltsXVt0XSYmIiIhPXJbbF1bdF0mJighaXx8cltsXVt0XT09aSkpe3ZhciBzPW5ldyBqc29uUG9pbnRlcihyW2xdLHRoaXMuZCk7bi5hcHBseShvLFtzLGxdKX12YXIgYT10aGlzLmQ7dGhpcy5kPXJbbF0sdGhpcy5zdWJfZXhpc3RzKGUpJiZ0aGlzLnRocm91Z2goZSx0LGksbixvKSx0aGlzLmQ9YX19fSxkaHRtbFhUcmVlT2JqZWN0LnByb3RvdHlwZS5sb2FkSlNPTk9iamVjdD1mdW5jdGlvbihlLHQpe3JldHVybiB3aW5kb3cuY29uc29sZSYmd2luZG93LmNvbnNvbGUuaW5mbyYmd2luZG93LmNvbnNvbGUuaW5mbygibG9hZEpTT05PYmplY3Qgd2FzIGRlcHJlY2F0ZWQiLCJodHRwOi8vZG9jcy5kaHRtbHguY29tL21pZ3JhdGlvbl9faW5kZXguaHRtbCNtaWdyYXRpb25mcm9tNDN0bzQ0IiksdGhpcy5fbG9hZEpTT05PYmplY3QoZSx0KX0sZGh0bWxYVHJlZU9iamVjdC5wcm90b3R5cGUuX2xvYWRKU09OT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dGhpcy5wYXJzQ291bnR8fHRoaXMuY2FsbEV2ZW50KCJvblhMUyIsW3RoaXMsbnVsbF0pLHRoaXMueG1sc3RhdGU9MTt2YXIgaT1uZXcganNvblBvaW50ZXIoZSk7dGhpcy5fcGFyc2UoaSksdGhpcy5fcD1pLHQmJnQoKX0sd2luZG93LmFkZEV2ZW50TGlzdGVuZXI/d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGRoeF9pbml0X3RyZWVzLCExKTp3aW5kb3cuYXR0YWNoRXZlbnQmJndpbmRvdy5hdHRhY2hFdmVudCgib25sb2FkIixkaHhfaW5pdF90cmVlcyk7dmFyIHN0eWxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7c3R5bGUuaW5uZXJIVE1MPSdAa2V5ZnJhbWVzIGRoeF9sb2FkZXJfcm90YXRlezEwMCV7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO319QGtleWZyYW1lcyBkaHhfbG9hZGVyX2Rhc2h7MCV7c3Ryb2tlLWRhc2hhcnJheToxLDIwMDtzdHJva2UtZGFzaG9mZnNldDowO301MCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTM1cHg7fTEwMCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTEyNHB4O319LmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxle3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoyOHB4O2xpbmUtaGVpZ2h0OjI4cHg7YmFja2dyb3VuZC1jb2xvcjojZjVmNWY1O292ZXJmbG93OmhpZGRlbjtib3JkZXI6bm9uZTtmb250LXNpemU6MTRweDtmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2NvbG9yOiM0MDQwNDA7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1raHRtbC11c2VyLXNlbGVjdDpub25lOy1tb3otdXNlci1zZWxlY3Q6bm9uZTstbXMtdXNlci1zZWxlY3Q6bm9uZTstby11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmU7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX05vcm1hbCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9EaXNhYmxlZCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmbG9hdDpsZWZ0O2ZvbnQ6aW5oZXJpdDtoZWlnaHQ6MjhweDtsaW5lLWhlaWdodDoyOHB4O21hcmdpbjowO3BhZGRpbmc6MCA4cHg7Y3Vyc29yOmRlZmF1bHQ7d2hpdGUtc3BhY2U6bm93cmFwOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9Ob3JtYWwgZGl2LnRvcF9sZXZlbF90ZXh0LC5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX0Rpc2FibGVkIGRpdi50b3BfbGV2ZWxfdGV4dCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZCBkaXYudG9wX2xldmVsX3RleHR7ZmxvYXQ6bGVmdDttYXJnaW46MCAzcHg7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX05vcm1hbCBpLC5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9Ub3BMZXZlbF9JdGVtX0Rpc2FibGVkIGksLmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxlIGRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1RvcExldmVsX0l0ZW1fU2VsZWN0ZWQgaXtoZWlnaHQ6aW5oZXJpdDtsaW5lLWhlaWdodDppbmhlcml0O2Zsb2F0OmxlZnQ7Y29sb3I6aW5oZXJpdDttYXJnaW46MCA0cHg7Zm9udC1zaXplOjEuMmVtO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9EaXNhYmxlZHtjb2xvcjojYTZhNmE2O30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfVG9wTGV2ZWxfSXRlbV9TZWxlY3RlZHtiYWNrZ3JvdW5kLWNvbG9yOiNlYmViZWI7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBpbWcuZGh0bWx4TWVudV9Ub3BMZXZlbF9JdGVtX0ljb257ZmxvYXQ6bGVmdDttYXJnaW46NXB4IDNweCAwIDNweDt3aWR0aDoxOHB4O2hlaWdodDoxOHB4O2N1cnNvcjpkZWZhdWx0O30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LnRvcF9zZXB7cG9zaXRpb246cmVsYXRpdmU7ZmxvYXQ6bGVmdDtoZWlnaHQ6MjJweDt3aWR0aDowO2JvcmRlci1sZWZ0OjFweCBzb2xpZCAjZGZkZmRmO21hcmdpbjozcHggOHB4IDAgOHB4O2ZvbnQtc2l6ZToxcHg7b3ZlcmZsb3c6aGlkZGVuO2N1cnNvcjpkZWZhdWx0Oy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9yaWdodCwuZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9sZWZ0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2hlaWdodDoyOHB4O2xpbmUtaGVpZ2h0OjI4cHg7Y3Vyc29yOmRlZmF1bHQ7Zm9udC1zaXplOjE0cHg7Zm9udC1mYW1pbHk6Um9ib3RvLEFyaWFsLEhlbHZldGljYTtjb2xvcjojNDA0MDQwOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUgZGl2LmRodG1seE1lbnVfVG9wTGV2ZWxfVGV4dF9yaWdodHtyaWdodDo2cHg7fS5kaHRtbHhNZW51X21hdGVyaWFsX01pZGRsZSBkaXYuZGh0bWx4TWVudV9Ub3BMZXZlbF9UZXh0X2xlZnR7bGVmdDo2cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29ue3Bvc2l0aW9uOmFic29sdXRlO3BhZGRpbmc6NXB4IDA7YmFja2dyb3VuZC1jb2xvcjojZmFmYWZhO292ZXJmbG93OmhpZGRlbjtjdXJzb3I6ZGVmYXVsdDtsaW5lLWhlaWdodDpub3JtYWw7b3ZlcmZsb3cteTphdXRvOy13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoOy13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjpyZ2JhKDAsMCwwLDApO2JveC1zaGFkb3c6MCAxcHggM3B4IHJnYmEoMCwwLDAsMC4xMiksMCAxcHggMnB4IHJnYmEoMCwwLDAsMC4yNCk7LXdlYmtpdC11c2VyLXNlbGVjdDpub25lOy1raHRtbC11c2VyLXNlbGVjdDpub25lOy1tb3otdXNlci1zZWxlY3Q6bm9uZTstbXMtdXNlci1zZWxlY3Q6bm9uZTstby11c2VyLXNlbGVjdDpub25lO3VzZXItc2VsZWN0Om5vbmU7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRke3BhZGRpbmc6MDttYXJnaW46MDtsaW5lLWhlaWdodDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtc2l6ZToxNHB4O2ZvbnQtZmFtaWx5OlJvYm90byxBcmlhbCxIZWx2ZXRpY2E7Y29sb3I6IzQwNDA0MDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbnt3aWR0aDoxOHB4O3RleHQtYWxpZ246Y2VudGVyO31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGltZy5zdWJfaWNvbnttYXJnaW46NHB4IDZweCAwIDZweDt3aWR0aDoxOHB4O2hlaWdodDoxOHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGl7d2lkdGg6MThweDtoZWlnaHQ6MzBweDtsaW5lLWhlaWdodDoyOXB4O21hcmdpbjowIDZweDtmb250LXNpemU6MS4yZW07dGV4dC1hbGlnbjpjZW50ZXI7Y29sb3I6aW5oZXJpdDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb257bWFyZ2luOjAgNnB4O3dpZHRoOjE4cHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgNXB4O2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLWltYWdlOnVybCgiaW1ncy9kaHhtZW51X21hdGVyaWFsL2RoeG1lbnVfY2hyZC5wbmciKTt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb24uY2hieF8we2JhY2tncm91bmQtcG9zaXRpb246MCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX2ljb24gZGl2LnN1Yl9pY29uLmNoYnhfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi0xOHB4IDVweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdGQuc3ViX2l0ZW1faWNvbiBkaXYuc3ViX2ljb24ucmRidF8we2JhY2tncm91bmQtcG9zaXRpb246LTcycHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9pY29uIGRpdi5zdWJfaWNvbi5yZGJ0XzF7YmFja2dyb3VuZC1wb3NpdGlvbjotOTBweCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX3RleHQgZGl2LnN1Yl9pdGVtX3RleHR7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtwYWRkaW5nOjAgMjJweCAwIDFweDtvdmVyZmxvdzpoaWRkZW47fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRkLnN1Yl9pdGVtX2hre3BhZGRpbmc6MCAxMHB4IDAgOHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZC5zdWJfaXRlbV9oayBkaXYuc3ViX2l0ZW1faGt7Y29sb3I6IzhkOGQ4ZDtmb250LXNpemU6MTJweDt0ZXh0LWFsaWduOnJpZ2h0O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZCBkaXYuY29tcGxleF9hcnJvd3tmbG9hdDpyaWdodDt3aWR0aDoxMHB4O21hcmdpbjowIDFweCAwIDExcHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLWltYWdlOnVybCgiaW1ncy9kaHhtZW51X21hdGVyaWFsL2RoeG1lbnVfc3ViYXIucG5nIik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246MCAxMHB4O292ZXJmbG93OmhpZGRlbjtmb250LXNpemU6MXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ZCBkaXYuY29tcGxleF9hcnJvd19sb2FkaW5ne3dpZHRoOjE2cHg7aGVpZ2h0OjMwcHg7bGluZS1oZWlnaHQ6MzBweDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlciBjZW50ZXI7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtaW1hZ2U6dXJsKCJpbWdzL2RoeG1lbnVfbWF0ZXJpYWwvZGh4bWVudV9sb2FkZXIuZ2lmIik7ZmxvYXQ6cmlnaHQ7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX3NlbGVjdGVkIHRke2JhY2tncm91bmQtY29sb3I6I2ViZWJlYjt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdHIuc3ViX2l0ZW1fc2VsZWN0ZWQgdGQgZGl2LmNvbXBsZXhfYXJyb3d7YmFja2dyb3VuZC1wb3NpdGlvbjotMTBweCAxMHB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQuc3ViX2l0ZW1faGsgZGl2LnN1Yl9pdGVtX2hre2NvbG9yOiNjMGMwYzA7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuc3ViX2l0ZW1fdGV4dCxkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgdGQuc3ViX2l0ZW1faWNvbiBpe2NvbG9yOiNhNmE2YTY7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuY29tcGxleF9hcnJvd3tiYWNrZ3JvdW5kLXBvc2l0aW9uOi0yMHB4IDEwcHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBkaXYuc3ViX2ljb24uY2hieF8we2JhY2tncm91bmQtcG9zaXRpb246LTM2cHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgZGl2LnN1Yl9pY29uLmNoYnhfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi01NHB4IDVweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gdHIuc3ViX2l0ZW1fZGlzIHRkIGRpdi5zdWJfaWNvbi5yZGJ0XzB7YmFja2dyb3VuZC1wb3NpdGlvbjotMTA4cHggNXB4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfaXRlbV9kaXMgdGQgZGl2LnN1Yl9pY29uLnJkYnRfMXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi0xMjZweCA1cHg7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9pdGVtX2RpcyB0ZCBpe2NvbG9yOiNhNmE2YTY7fWRpdi5kaHRtbHhNZW51X21hdGVyaWFsX1N1YkxldmVsQXJlYV9Qb2x5Z29uIHRyLnN1Yl9zZXAgdGR7cGFkZGluZzo1cHggM3B4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiB0ci5zdWJfc2VwIHRkIGRpdi5zdWJfc2Vwe3Bvc2l0aW9uOnJlbGF0aXZlO2ZvbnQtc2l6ZToxcHg7bGluZS1oZWlnaHQ6MXB4O2hlaWdodDowO3dpZHRoOjEwMCU7Ym9yZGVyLXRvcDoxcHggc29saWQgI2RmZGZkZjt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXAsZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXBfT3ZlcixkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dVcF9EaXNhYmxlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmb250LXNpemU6MXB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNkZmRmZGY7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X3VwLnBuZyIpO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlciAycHg7cGFkZGluZzo4cHggMDttYXJnaW4tYm90dG9tOjNweDt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93VXBfRGlzYWJsZWR7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X3VwX2Rpcy5wbmciKTt9ZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93RG93bixkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dEb3duX092ZXIsZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX1BvbHlnb24gZGl2LmRodG1seE1lbnVfbWF0ZXJpYWxfU3ViTGV2ZWxBcmVhX0Fycm93RG93bl9EaXNhYmxlZHtwb3NpdGlvbjpyZWxhdGl2ZTtmb250LXNpemU6MXB4O2JvcmRlci10b3A6MXB4IHNvbGlkICNkZmRmZGY7YmFja2dyb3VuZC1pbWFnZTp1cmwoImltZ3MvZGh4bWVudV9tYXRlcmlhbC9kaHhtZW51X2Fycm93X2Rvd24ucG5nIik7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyIDZweDtwYWRkaW5nOjhweCAwO21hcmdpbi10b3A6M3B4O31kaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfUG9seWdvbiBkaXYuZGh0bWx4TWVudV9tYXRlcmlhbF9TdWJMZXZlbEFyZWFfQXJyb3dEb3duX0Rpc2FibGVke2JhY2tncm91bmQtaW1hZ2U6dXJsKCJpbWdzL2RoeG1lbnVfbWF0ZXJpYWwvZGh4bWVudV9hcnJvd19kb3duX2Rpcy5wbmciKTt9aWZyYW1lLmRodG1seE1lbnVfSUU2Q292ZXJGaXhfbWF0ZXJpYWx7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyOm5vbmU7YmFja2dyb3VuZDojMDAwO2ZpbHRlcjpwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQWxwaGEob3BhY2l0eT0xMDApO30uZGh0bWx4TWVudV9tYXRlcmlhbF9NaWRkbGUuZGlyX2xlZnQgZGl2LmFsaWduX2xlZnR7ZmxvYXQ6bGVmdDt9LmRodG1seE1lbnVfbWF0ZXJpYWxfTWlkZGxlLmRpcl9sZWZ0IGRpdi5hbGlnbl9yaWdodHtmbG9hdDpyaWdodDt9LmRoeG1lbnVfc2tpbl9kZXRlY3R7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO3RvcDotMTAwcHg7bWFyZ2luOjA7cGFkZGluZzowO2JvcmRlcjowIHNvbGlkIHdoaXRlO3dpZHRoOjQwcHg7aGVpZ2h0OjEwcHg7b3ZlcmZsb3c6aGlkZGVuO31Aa2V5ZnJhbWVzIGRoeF9sb2FkZXJfcm90YXRlezEwMCV7dHJhbnNmb3JtOnJvdGF0ZSgzNjBkZWcpO319QGtleWZyYW1lcyBkaHhfbG9hZGVyX2Rhc2h7MCV7c3Ryb2tlLWRhc2hhcnJheToxLDIwMDtzdHJva2UtZGFzaG9mZnNldDowO301MCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTM1cHg7fTEwMCV7c3Ryb2tlLWRhc2hhcnJheTo4OSwyMDA7c3Ryb2tlLWRhc2hvZmZzZXQ6LTEyNHB4O319LmRlZmF1bHRUcmVlVGFibGV7bWFyZ2luOjA7cGFkZGluZzowO2JvcmRlcjowO30uY29udGFpbmVyVGFibGVTdHlsZXtvdmVyZmxvdzphdXRvOy13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOnRvdWNoO3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDowO2ZvbnQtc2l6ZToxMnB4Oy1raHRtbC11c2VyLXNlbGVjdDpub25lO30uY29udGFpbmVyVGFibGVTdHlsZVJUTCBzcGFue2RpcmVjdGlvbjpydGw7dW5pY29kZS1iaWRpOmJpZGktb3ZlcnJpZGU7fS5jb250YWluZXJUYWJsZVN0eWxlUlRMe2RpcmVjdGlvbjpydGw7b3ZlcmZsb3c6YXV0bztwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MDtmb250LXNpemU6MTJweDt9LnN0YW5kYXJ0VHJlZVJvd3tmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2ZvbnQtc2l6ZTo7LW1vei11c2VyLXNlbGVjdDpub25lO2xpbmUtaGVpZ2h0OjI0cHg7fS5zZWxlY3RlZFRyZWVSb3d7Zm9udC1mYW1pbHk6Um9ib3RvLEFyaWFsLEhlbHZldGljYTtmb250LXNpemU6Oy1tb3otdXNlci1zZWxlY3Q6bm9uZTtiYWNrZ3JvdW5kLWNvbG9yOiNlZWU7Y29sb3I6IzM5Yzt9LmRoeHRyZWVfbWF0ZXJpYWwgLnNlbGVjdGVkVHJlZVJvd0Z1bGwgLmRoeFRleHRDZWxse2JhY2tncm91bmQtY29sb3I6I2VlZTtjb2xvcjojMzljO30uZHJhZ0FuZERyb3BSb3d7Y29sb3I6IzM5Yzt9LnN0YW5kYXJ0VHJlZVJvd19sb3J7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTtiYWNrZ3JvdW5kLWNvbG9yOjtmb250LWZhbWlseTpSb2JvdG8sQXJpYWwsSGVsdmV0aWNhO2ZvbnQtc2l6ZTo7LW1vei11c2VyLXNlbGVjdDpub25lO30uc3RhbmRhcnRUcmVlSW1hZ2V7aGVpZ2h0OjI0cHg7b3ZlcmZsb3c6aGlkZGVuO2JvcmRlcjowO3BhZGRpbmc6MDttYXJnaW46MDtmb250LXNpemU6MXB4O30uc3RhbmRhcnRUcmVlSW1hZ2UgaW1ne3dpZHRoOjE4cHg7aGVpZ2h0OjI0cHg7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXIgY2VudGVyO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtib3JkZXI6MDtwYWRkaW5nOjA7bWFyZ2luOjA7Zm9udC1zaXplOjFweDstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7LWtodG1sLXVzZXItc2VsZWN0Om5vbmU7LW1vei11c2VyLXNlbGVjdDpub25lOy1tcy11c2VyLXNlbGVjdDpub25lOy1vLXVzZXItc2VsZWN0Om5vbmU7dXNlci1zZWxlY3Q6bm9uZTt9LmhpZGRlblJvd3t3aWR0aDoxcHg7b3ZlcmZsb3c6aGlkZGVuO30uZHJhZ1NwYW5EaXYsLmRyYWdTcGFuRGl2IHRke2ZvbnQtZmFtaWx5OlJvYm90byxBcmlhbCxIZWx2ZXRpY2E7Zm9udC1zaXplOjtsaW5lLWhlaWdodDo7dmVydGljYWwtYWxpZ246Y2VudGVyO2JhY2tncm91bmQtY29sb3I6d2hpdGU7ei1pbmRleDo5OTk7fS5kcmFnU3BhbkRpdiB0ZHtwYWRkaW5nOjVweDt9LmFfZGh4X2hpZGRlbl9pbnB1dHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTFweDtsZWZ0Oi0xcHg7d2lkdGg6MXB4O2hlaWdodDoxcHg7Ym9yZGVyOm5vbmU7YmFja2dyb3VuZDpub25lO30uYV9kaHhfaGlkZGVuX2lucHV0e3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMXB4O2xlZnQ6LTFweDt3aWR0aDoxcHg7aGVpZ2h0OjFweDtib3JkZXI6bm9uZTtiYWNrZ3JvdW5kOm5vbmU7fS5zZWxlY3Rpb25CYXJ7dG9wOjA7YmFja2dyb3VuZC1jb2xvcjpibGFjaztwb3NpdGlvbjphYnNvbHV0ZTtvdmVyZmxvdzpoaWRkZW47aGVpZ2h0OjJweDt6LWluZGV4OjExO30uaW50cmVlZWRpdFJvd3tmb250LXNpemU6OHB0O2hlaWdodDoxNnB4O2JvcmRlcjoxcHggc29saWQgc2lsdmVyO3BhZGRpbmc6MDttYXJnaW46MDttYXJnaW4tbGVmdDo0cHg7LW1vei11c2VyLXNlbGVjdDp0ZXh0Oy1raHRtbC11c2VyLXNlbGVjdDp0ZXh0O30uZGh4X3RyZWVfdGV4dFNpZ257Zm9udC1zaXplOjhwdDtmb250LWZhbWlseTptb25vc3BhY2U7d2lkdGg6MjFweDtjb2xvcjo7cGFkZGluZzowO21hcmdpbjowO2N1cnNvcjpwb2ludGVyO3RleHQtYWxpZ246Y2VudGVyO30uZGh4X3RyZWVfb3BhY2l0eXtvcGFjaXR5OjA7ZmlsdGVyOnByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5BbHBoYShvcGFjaXR5PTApOy13ZWJraXQtdXNlci1zZWxlY3Q6bm9uZTsta2h0bWwtdXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmU7LW1zLXVzZXItc2VsZWN0Om5vbmU7LW8tdXNlci1zZWxlY3Q6bm9uZTt1c2VyLXNlbGVjdDpub25lO30uZGh4X2JnX2ltZ19maXh7d2lkdGg6MThweDtoZWlnaHQ6MjRweDtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7YmFja2dyb3VuZC1wb3NpdGlvbi14OmNlbnRlcjtiYWNrZ3JvdW5kLXBvc2l0aW9uLXk6Y2VudGVyO30uZGh4dHJlZV9za2luX2RldGVjdHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOi0xMDBweDttYXJnaW46MDtwYWRkaW5nOjA7Ym9yZGVyOjAgc29saWQgd2hpdGU7d2lkdGg6NDBweDtoZWlnaHQ6MTBweDtvdmVyZmxvdzpoaWRkZW47fScsZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7dmFyIGxheWFhaXJfZGVidWdfdmlldz17fTt3aW5kb3cubGF5YWFpcl9kZWJ1Z192aWV3PWxheWFhaXJfZGVidWdfdmlldyxsYXlhYWlyX2RlYnVnX3ZpZXcuaW5pdExheWFBaXJEZWJ1Z1ZpZXc9ZnVuY3Rpb24oZSl7ZS5zdHlsZS5ib3JkZXI9IjFweCBzb2xpZCBibGFjayI7dmFyIHQ9TWF0aC5taW4oMjUwLC4zKmUub2Zmc2V0V2lkdGgpLGk9JzxkaXYgY2xhc3M9InRvcC1iYW5uZXIiPlxuPC9kaXY+XG48ZGl2PlxuPGRpdiBzdHlsZT0ib3ZlcmZsb3c6aGlkZGVuOyBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjNDQ0OyBwYWRkaW5nOjVweCI+XG48ZGl2IHN0eWxlPSJmbG9hdDpsZWZ0Ij5cbjxidXR0b24gaWQ9Im5vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sIj7lrqHmn6XlhYPntKA8L2J1dHRvbj5cbjxidXR0b24gaWQ9InJlZnJlc2hfY29udHJvbCI+5Yi35pawPC9idXR0b24+XG48L2Rpdj5cbjxkaXYgc3R5bGU9ImZsb2F0OnJpZ2h0Ij5cbjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNob3dfY3VycmVudF9jYWNoZV9jb250cm9sIj7mmL7npLrlvZPliY1jYWNoZemHjee7mDwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2FsbF9jYWNoZV9jb250cm9sIj7mmL7npLrmiYDmnIljYWNoZeWMuuWfnzwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2F0bGFzX2NvbnRyb2wiPuaYvuekuuWkp+WbvuWQiOmbhjwvaW5wdXQ+XG48L2Rpdj5cbjwvZGl2PlxuPGRpdiBjbGFzcz0iaGdyb3VwIj5cbjxkaXYgc3R5bGU9ImZsb2F0OmxlZnQ7d2lkdGg6Jyt0KydweDsgYm9yZGVyLXJpZ2h0OjFweCBzb2xpZCBibGFjayIgaWQ9InRyZWVfY29udGFpbmVyIj48L2Rpdj5cbjxkaXYgc3R5bGU9Im92ZXJmbG93OmhpZGRlbiI+XG48ZGl2IGlkPSJjb250ZW50X3Rvb2xiYXIiIHN0eWxlPSJ3aWR0aDoxMDAlO21hcmdpbjoxMHB4Ij48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ2aXNpYmlsaXR5X2NvbnRyb2wiPuWPr+ingTwvaW5wdXQ+XG48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzaG93X2JvcmRlcl9jb250cm9sIj7mmL7npLrovrnmoYY8L2lucHV0PlxuPGJ1dHRvbiBpZD0ibG9nX2luZm9fY29udHJvbCI+5omT5Y2w5Yiw5o6n5Yi25Y+wPC9idXR0b24+XG48YnV0dG9uIGlkPSJlbmFibGVkX25vZGVfY2hhaW5fY29udHJvbCI+ZW5hYmxl6ZO+PC9idXR0b24+XG48YnV0dG9uIGlkPSJzaXplX2NoYWluX2NvbnRyb2wiPnNpemXpk748L2J1dHRvbj5cbjwvZGl2PjxkaXYgc3R5bGU9Im92ZXJmbG93OmF1dG8iPjx0YWJsZSBpZD0iY29udGVudF90YWJsZSIgc3R5bGU9ImJvcmRlcjoxcHggc29saWQgI2NjY2NjYztib3JkZXItY29sbGFwc2U6Y29sbGFwc2UiPjwvdGFibGU+XG48L2Rpdj48L2Rpdj5cbjwvZGl2PlxuPC9kaXY+JztlLmlubmVySFRNTD1pLHRoaXMuY29udGFpbmVyPWUsdGhpcy50cmVlPW5ldyBkaHRtbFhUcmVlT2JqZWN0KHRyZWVfY29udGFpbmVyLCIxMDAlIiwiMTAwJSIsMCksbm9kZV9mdW5jdGlvbmFsaXR5X2NvbnRyb2wub25jbGljaz1mdW5jdGlvbihlKXtlLnN0b3BQcm9wYWdhdGlvbigpLGxheWFhaXJfZGVidWdfdmlldy5vbl9pbnNwZWN0X2VsZW1lbnRfY2FsbGJhY2soKSxub2RlX2Z1bmN0aW9uYWxpdHlfY29udHJvbC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9IiNGRkYiLG5vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sLnN0eWxlLmNvbG9yPSJyZ2IoMTA3LCAxNjMsIDI1NSkifX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFRyZWU9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMudHJlZS5nZXRBbGxJdGVtc1dpdGhLaWRzKCkuc3BsaXQoIiwiKSxpPVtdLG49MDtuPHQubGVuZ3RoO24rKyl7dmFyIG89dFtuXSxyPXRoaXMudHJlZS5nZXRPcGVuU3RhdGUobyk7MT09ciYmaS5wdXNoKG8pfXRoaXMudHJlZS5kZWxldGVDaGlsZEl0ZW1zKDApLHRoaXMudHJlZS5wYXJzZShlLCJqc29uIik7Zm9yKHZhciBuPTA7bjxpLmxlbmd0aDtuKyspdGhpcy50cmVlLm9wZW5JdGVtKGlbbl0pfSxsYXlhYWlyX2RlYnVnX3ZpZXcucmVzaXplPWZ1bmN0aW9uKGUsdCl7dGhpcy5jb250YWluZXIuc3R5bGUud2lkdGg9ZSsicHgiLHRoaXMuY29udGFpbmVyLnN0eWxlLmhlaWdodD10KyJweCI7dmFyIGk9dGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0LXRyZWVfY29udGFpbmVyLm9mZnNldFRvcDt0cmVlX2NvbnRhaW5lci5zdHlsZS5oZWlnaHQ9aSsicHgiLGNvbnRlbnRfdG9vbGJhci5zdHlsZS53aWR0aD1lLXRyZWVfY29udGFpbmVyLm9mZnNldFdpZHRoKyJweCIsY29udGVudF90YWJsZS5wYXJlbnRFbGVtZW50LnN0eWxlLmhlaWdodD1pLWNvbnRlbnRfdG9vbGJhci5vZmZzZXRIZWlnaHQtMjErInB4Iixjb250ZW50X3RhYmxlLnN0eWxlLndpZHRoPWUtdHJlZV9jb250YWluZXIub2Zmc2V0V2lkdGgtMTYrInB4In0sbGF5YWFpcl9kZWJ1Z192aWV3LmJvdW5jZVVwSW5zcGVjdEJ1dHRvbj1mdW5jdGlvbigpe25vZGVfZnVuY3Rpb25hbGl0eV9jb250cm9sLnN0eWxlLmJhY2tncm91bmRDb2xvcj0iYnV0dG9uZmFjZSIsbm9kZV9mdW5jdGlvbmFsaXR5X2NvbnRyb2wuc3R5bGUuY29sb3I9ImJsYWNrIn0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZhbHVlSW5wdXRIYW5kbGVyPWZ1bmN0aW9uKGUpe3RoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZhbHVlQ2hhbmdlSGFuZGxlcj1mdW5jdGlvbihlKXt0aGlzLnZhbHVlX2NoYW5nZV9jYWxsYmFjaz1lfSxsYXlhYWlyX2RlYnVnX3ZpZXcuYWRkQ29udGVudD1mdW5jdGlvbihlKXt2YXIgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpO3QuaW5uZXJIVE1MPSc8dGQgc3R5bGU9IndpZHRoOjEwMHB4O2ZvbnQtc2l6ZToxM3B4O2JvcmRlcjoxcHggc29saWQgI0NDQztwYWRkaW5nLWxlZnQ6MTBweCI+JytlLmtleSsnPC90ZD5cbjx0ZCBzdHlsZT0id2lkdGg6MjAwcHg7Ym9yZGVyOjFweCBzb2xpZCAjQ0NDOyI+PGlucHV0IHN0eWxlPSJib3JkZXI6bm9uZTt3aWR0aDoxMDAlO2hlaWdodDoyNXB4O3BhZGRpbmctbGVmdDoxMHB4OyIgdmFsdWU9JytlLnZhbHVlKyI+PC90ZD4iLGNvbnRlbnRfdGFibGUuYXBwZW5kQ2hpbGQodCk7dmFyIGk9dC5sYXN0RWxlbWVudENoaWxkLmxhc3RFbGVtZW50Q2hpbGQ7aS5kYXRhPWUsaS5vbmlucHV0PWZ1bmN0aW9uKGUpe3RoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2smJnRoaXMudmFsdWVfaW5wdXRfY2FsbGJhY2soZS50YXJnZXQuZGF0YSxlLnRhcmdldC52YWx1ZSl9LmJpbmQodGhpcyksaS5vbmNoYW5nZT1mdW5jdGlvbihlKXt0aGlzLnZhbHVlX2NoYW5nZV9jYWxsYmFjayYmdGhpcy52YWx1ZV9jaGFuZ2VfY2FsbGJhY2soZS50YXJnZXQuZGF0YSxlLnRhcmdldC52YWx1ZSl9LmJpbmQodGhpcyl9LGxheWFhaXJfZGVidWdfdmlldy5zZXRDb250ZW50cz1mdW5jdGlvbihlKXtjb250ZW50X3RhYmxlLmlubmVySFRNTD0iIjtmb3IodmFyIHQ9MDt0PGUubGVuZ3RoO3QrKyl7dmFyIGk9ZVt0XTt0aGlzLmFkZENvbnRlbnQoaSl9fSxsYXlhYWlyX2RlYnVnX3ZpZXcuY2hhbmdlVmFsdWVBdD1mdW5jdGlvbihlLHQpe2NvbnRlbnRfdGFibGUuY2hpbGRyZW5bZV0ubGFzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC52YWx1ZT10fSxsYXlhYWlyX2RlYnVnX3ZpZXcuY2hhbmdlVmFsdWVCeUxhYmVsPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBpPWNvbnRlbnRfdGFibGUuY2hpbGRyZW4ubGVuZ3RoLTE7aT49MDtpLS0paWYoY29udGVudF90YWJsZS5jaGlsZHJlbltpXS5maXJzdEVsZW1lbnRDaGlsZC5pbm5lclRleHQ9PWUpe2NvbnRlbnRfdGFibGUuY2hpbGRyZW5baV0ubGFzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC52YWx1ZT10O2JyZWFrfX0sbGF5YWFpcl9kZWJ1Z192aWV3LnNldFZpc2liaWxpdHk9ZnVuY3Rpb24oZSl7dmlzaWJpbGl0eV9jb250cm9sLmNoZWNrZWQ9ISFlfSxsYXlhYWlyX2RlYnVnX3ZpZXcuc2V0U2hvd0RlYnVnQm9yZGVyPWZ1bmN0aW9uKGUpe3Nob3dfYm9yZGVyX2NvbnRyb2wuY2hlY2tlZD0hIWV9LGxheWFhaXJfZGVidWdfdmlldy5nZXRWaXNpYmlsaXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHZpc2liaWxpdHlfY29udHJvbC5jaGVja2VkfSxsYXlhYWlyX2RlYnVnX3ZpZXcuZ2V0U2hvd0RlYnVnQm9yZGVyPWZ1bmN0aW9uKCl7cmV0dXJuIHNob3dfYm9yZGVyX2NvbnRyb2wuY2hlY2tlZH0sbGF5YWFpcl9kZWJ1Z192aWV3LmdldFNob3dDdXJyZW50Q2FjaGU9ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd19jdXJyZW50X2NhY2hlX2NvbnRyb2wuY2hlY2tlZH0sbGF5YWFpcl9kZWJ1Z192aWV3LmdldFNob3dBbGxDYWNoZT1mdW5jdGlvbigpe3JldHVybiBzaG93X2FsbF9jYWNoZV9jb250cm9sLmNoZWNrZWR9LGxheWFhaXJfZGVidWdfdmlldy5nZXRTaG93QXRsYXM9ZnVuY3Rpb24oKXtyZXR1cm4gc2hvd19hdGxhc19jb250cm9sLmNoZWNrZWR9LGxheWFhaXJfZGVidWdfdmlldy5vbkluc3BlY3RFbGVtZW50PWZ1bmN0aW9uKGUpe3RoaXMub25faW5zcGVjdF9lbGVtZW50X2NhbGxiYWNrPWV9LGxheWFhaXJfZGVidWdfdmlldy5vbkxvZ0luZm89ZnVuY3Rpb24oZSl7bG9nX2luZm9fY29udHJvbC5vbmNsaWNrPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblJlZnJlc2g9ZnVuY3Rpb24oZSl7cmVmcmVzaF9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uUHJpbnRFbmFibGVkTm9kZUNoYWluPWZ1bmN0aW9uKGUpe2VuYWJsZWRfbm9kZV9jaGFpbl9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uUHJpbnRTaXplQ2hhaW49ZnVuY3Rpb24oZSl7c2l6ZV9jaGFpbl9jb250cm9sLm9uY2xpY2s9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uVG9nZ2xlVmlzaWJpbGl0eT1mdW5jdGlvbihlKXt2aXNpYmlsaXR5X2NvbnRyb2wub25jaGFuZ2U9ZX0sbGF5YWFpcl9kZWJ1Z192aWV3Lm9uVG9nZ2xlRGVidWdCb3JkZXI9ZnVuY3Rpb24oZSl7c2hvd19ib3JkZXJfY29udHJvbC5vbmNoYW5nZT1lfSxsYXlhYWlyX2RlYnVnX3ZpZXcub25Ub2dnbGVTaG93Q3VycmVudENhY2hlPWZ1bmN0aW9uKGUpe3Nob3dfY3VycmVudF9jYWNoZV9jb250cm9sLm9uY2hhbmdlPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblRvZ2dsZVNob3dBbGxDYWNoZT1mdW5jdGlvbihlKXtzaG93X2FsbF9jYWNoZV9jb250cm9sLm9uY2hhbmdlPWV9LGxheWFhaXJfZGVidWdfdmlldy5vblRvZ2dsZVNob3dBdGxhcz1mdW5jdGlvbihlKXtzaG93X2F0bGFzX2NvbnRyb2wub25jaGFuZ2U9ZX07\";\r\n\treturn DivScripts;\r\n})()\r\n\r\n\r\n/**\r\n*tianpeng\r\n*@author\r\n*/\r\n//class laya.debug.tools.AtlasTools\r\nvar AtlasTools=(function(){\r\n\tfunction AtlasTools(){\r\n\t\tthis.mSprite=null;\r\n\t\tthis.mIndex=0;\r\n\t\tthis.mTextureDic={};\r\n\t}\r\n\r\n\t__class(AtlasTools,'laya.debug.tools.AtlasTools');\r\n\tvar __proto=AtlasTools.prototype;\r\n\t__proto.start=function(){\r\n\t\tif (!Render.isWebGL)return;\r\n\t\tif (this.mSprite==null){\r\n\t\t\tthis.mSprite=new Sprite();\r\n\t\t}\r\n\t\tLaya.stage.addChild(this.mSprite);\r\n\t\tthis.showNext();\r\n\t}\r\n\r\n\t__proto.end=function(){\r\n\t\tif (!Render.isWebGL)return;\r\n\t\tif (this.mSprite){\r\n\t\t\tLaya.stage.removeChild(this.mSprite);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.showNext=function(){\r\n\t\tif (!Render.isWebGL)return;\r\n\t\tif (this.mSprite==null){\r\n\t\t\tthis.mSprite=new Sprite();\r\n\t\t}\r\n\t\tLaya.stage.addChild(this.mSprite);\r\n\t\tthis.mIndex++;\r\n\t\tvar resManager;\r\n\t\t/*__JS__ */resManager=laya.webgl.atlas.AtlasResourceManager.instance;;\r\n\t\tvar tCount=resManager.getAtlaserCount();\r\n\t\tif (this.mIndex >=tCount){\r\n\t\t\tthis.mIndex=0;\r\n\t\t};\r\n\t\tvar tTexture;\r\n\t\tif (this.mTextureDic[this.mIndex]){\r\n\t\t\ttTexture=this.mTextureDic[this.mIndex];\r\n\t\t\t}else {\r\n\t\t\tvar tAtlaser=resManager.getAtlaserByIndex(this.mIndex);\r\n\t\t\tif (tAtlaser && tAtlaser.texture){\r\n\t\t\t\ttTexture=new Texture(tAtlaser.texture,null);\r\n\t\t\t\tthis.mTextureDic[this.mIndex]=tTexture;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tTexture){\r\n\t\t\tthis.mSprite.graphics.clear();\r\n\t\t\tthis.mSprite.graphics.save();\r\n\t\t\tthis.mSprite.graphics.alpha(0.9);\r\n\t\t\tthis.mSprite.graphics.drawRect(0,0,1024,1024,\"#efefefe\");\r\n\t\t\tthis.mSprite.graphics.restore();\r\n\t\t\tthis.mSprite.graphics.drawTexture(tTexture,0,0,1024,1024);\r\n\t\t\tthis.mSprite.graphics.fillText((this.mIndex+1).toString()+\"/\"+tCount.toString(),25,100,\"40px Arial\",\"#ff0000\",\"left\");\r\n\t\t}\r\n\t}\r\n\r\n\tAtlasTools.getInstance=function(){\r\n\t\treturn AtlasTools.mInstance=AtlasTools.mInstance|| new AtlasTools();\r\n\t}\r\n\r\n\tAtlasTools.mInstance=null;\r\n\treturn AtlasTools;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.Base64Atlas\r\nvar Base64Atlas=(function(){\r\n\tfunction Base64Atlas(data,idKey){\r\n\t\tthis.data=null;\r\n\t\tthis.replaceO=null;\r\n\t\tthis.idKey=null;\r\n\t\tthis._loadedHandler=null;\r\n\t\tthis.data=data;\r\n\t\tif (!idKey)idKey=Math.random()+\"key\";\r\n\t\tthis.idKey=idKey;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\t__class(Base64Atlas,'laya.debug.tools.Base64Atlas');\r\n\tvar __proto=Base64Atlas.prototype;\r\n\t//preLoad();\r\n\t__proto.init=function(){\r\n\t\tthis.replaceO={};\r\n\t\tvar key;\r\n\t\tfor (key in this.data){\r\n\t\t\tthis.replaceO[key]=this.idKey+\"/\"+key;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getAdptUrl=function(url){\r\n\t\treturn this.replaceO[url];\r\n\t}\r\n\r\n\t__proto.preLoad=function(completeHandler){\r\n\t\tthis._loadedHandler=completeHandler;\r\n\t\tLaya.loader.load(Base64ImageTool.getPreloads(this.data),new Handler(this,this.preloadEnd));\r\n\t}\r\n\r\n\t__proto.preloadEnd=function(){\r\n\t\tvar key;\r\n\t\tfor (key in this.data){\r\n\t\t\tvar tx;\r\n\t\t\ttx=Laya.loader.getRes(this.data[key]);\r\n\t\t\tLoader.cacheRes(this.replaceO[key],tx);\r\n\t\t}\r\n\t\tif (this._loadedHandler){\r\n\t\t\tthis._loadedHandler.run();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.replaceRes=function(uiObj){\r\n\t\tObjectTools.replaceValue(uiObj,this.replaceO);\r\n\t}\r\n\r\n\treturn Base64Atlas;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.Base64ImageTool\r\nvar Base64ImageTool=(function(){\r\n\tfunction Base64ImageTool(){}\r\n\t__class(Base64ImageTool,'laya.debug.tools.Base64ImageTool');\r\n\tBase64ImageTool.getCanvasPic=function(img){\r\n\t\timg=img.bitmap;\r\n\t\tvar canvas=Browser.createElement(\"canvas\");\r\n\t\tvar ctx=canvas.getContext('2d');\r\n\t\tcanvas.height=img.height;\r\n\t\tcanvas.width=img.width;\r\n\t\tctx.drawImage(img.source,0,0);\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\tBase64ImageTool.getBase64Pic=function(img){\r\n\t\treturn Base64ImageTool.getCanvasPic(img).toDataURL(\"image/png\");\r\n\t}\r\n\r\n\tBase64ImageTool.getPreloads=function(base64Data){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar key;\r\n\t\tfor (key in base64Data){\r\n\t\t\trst.push({url:base64Data[key],type:/*laya.net.Loader.IMAGE*/\"image\" });\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn Base64ImageTool;\r\n})()\r\n\r\n\r\n/**\r\n*base64编码解码类\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.Base64Tool\r\nvar Base64Tool=(function(){\r\n\tfunction Base64Tool(){}\r\n\t__class(Base64Tool,'laya.debug.tools.Base64Tool');\r\n\tBase64Tool.init=function(){\r\n\t\tif (Base64Tool.lookup)\r\n\t\t\treturn;\r\n\t\tBase64Tool.lookup=new Uint8Array(256)\r\n\t\tfor (var i=0;i < Base64Tool.chars.length;i++){\r\n\t\t\tBase64Tool.lookup[Base64Tool.chars.charCodeAt(i)]=i;\r\n\t\t}\r\n\t}\r\n\r\n\tBase64Tool.encode=function(arraybuffer){\r\n\t\tvar bytes=new Uint8Array(arraybuffer),i=0,len=bytes.length,base64=\"\";\r\n\t\tfor (i=0;i < len;i+=3){\r\n\t\t\tbase64+=Base64Tool.chars[bytes[i] >> 2];\r\n\t\t\tbase64+=Base64Tool.chars[((bytes[i] & 3)<< 4)| (bytes[i+1] >> 4)];\r\n\t\t\tbase64+=Base64Tool.chars[((bytes[i+1] & 15)<< 2)| (bytes[i+2] >> 6)];\r\n\t\t\tbase64+=Base64Tool.chars[bytes[i+2] & 63];\r\n\t\t}\r\n\t\tif ((len % 3)===2){\r\n\t\t\tbase64=base64.substring(0,base64.length-1)+\"=\";\r\n\t\t}\r\n\t\telse if (len % 3===1){\r\n\t\t\tbase64=base64.substring(0,base64.length-2)+\"==\";\r\n\t\t}\r\n\t\treturn base64;\r\n\t}\r\n\r\n\tBase64Tool.encodeStr=function(str){\r\n\t\tvar byte;\r\n\t\tbyte=new Byte();\r\n\t\tbyte.writeUTFString(str);\r\n\t\treturn Base64Tool.encodeByte(byte);\r\n\t}\r\n\r\n\tBase64Tool.encodeStr2=function(str){\r\n\t\tvar byte;\r\n\t\tbyte=new Byte();\r\n\t\tbyte.writeUTFBytes(str);\r\n\t\treturn Base64Tool.encodeByte(byte);\r\n\t}\r\n\r\n\tBase64Tool.encodeByte=function(byte,start,end){\r\n\t\t(start===void 0)&& (start=0);\r\n\t\t(end===void 0)&& (end=-1);\r\n\t\tif (end < 0){\r\n\t\t\tend=byte.length;\r\n\t\t}\r\n\t\treturn Base64Tool.encode(byte.buffer.slice(start,end));\r\n\t}\r\n\r\n\tBase64Tool.decodeToByte=function(base64){\r\n\t\treturn new Byte(Base64Tool.decode(base64));\r\n\t}\r\n\r\n\tBase64Tool.decode=function(base64){\r\n\t\tBase64Tool.init();\r\n\t\tvar bufferLength=base64.length *0.75,len=base64.length,i=0,p=0,encoded1=0,encoded2=0,encoded3=0,encoded4=0;\r\n\t\tif (base64[base64.length-1]===\"=\"){\r\n\t\t\tbufferLength--;\r\n\t\t\tif (base64[base64.length-2]===\"=\"){\r\n\t\t\t\tbufferLength--;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);\r\n\t\tfor (i=0;i < len;i+=4){\r\n\t\t\tencoded1=Base64Tool.lookup[base64.charCodeAt(i)];\r\n\t\t\tencoded2=Base64Tool.lookup[base64.charCodeAt(i+1)];\r\n\t\t\tencoded3=Base64Tool.lookup[base64.charCodeAt(i+2)];\r\n\t\t\tencoded4=Base64Tool.lookup[base64.charCodeAt(i+3)];\r\n\t\t\tbytes[p++]=(encoded1 << 2)| (encoded2 >> 4);\r\n\t\t\tbytes[p++]=((encoded2 & 15)<< 4)| (encoded3 >> 2);\r\n\t\t\tbytes[p++]=((encoded3 & 3)<< 6)| (encoded4 & 63);\r\n\t\t}\r\n\t\treturn arraybuffer;\r\n\t}\r\n\r\n\tBase64Tool.chars=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n\tBase64Tool.lookup=null;\r\n\treturn Base64Tool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.CacheAnalyser\r\nvar CacheAnalyser=(function(){\r\n\tfunction CacheAnalyser(){}\r\n\t__class(CacheAnalyser,'laya.debug.tools.CacheAnalyser');\r\n\tvar __proto=CacheAnalyser.prototype;\r\n\t__proto.renderCanvas=function(sprite,time){\r\n\t\t(time===void 0)&& (time=0);\r\n\t\tif (!CacheAnalyser.showCacheSprite)return;\r\n\t\tif (DebugInfoLayer.I.isDebugItem(sprite))return;\r\n\t\tDebugTool.showDisBoundToSprite(sprite,DebugInfoLayer.I.cacheViewLayer,DebugConsts.CANVAS_REC_COLOR,4);\r\n\t}\r\n\r\n\t__proto.reCacheCanvas=function(sprite,time){\r\n\t\t(time===void 0)&& (time=0);\r\n\t\tif (!CacheAnalyser.showRecacheSprite)return;\r\n\t\tif (DebugInfoLayer.I.isDebugItem(sprite))return;\r\n\t\tvar info;\r\n\t\tinfo=CacheAnalyser.getNodeInfoByNode(sprite);\r\n\t\tinfo.addCount(time);\r\n\t\tCacheAnalyser.counter.addTime(sprite,time);\r\n\t\tif (!info.parent){\r\n\t\t\tDebugInfoLayer.I.nodeRecInfoLayer.addChild(info);\r\n\t\t}\r\n\t}\r\n\r\n\tCacheAnalyser.renderLoopBegin=function(){\r\n\t\tDebugInfoLayer.I.cacheViewLayer.graphics.clear();\r\n\t}\r\n\r\n\tCacheAnalyser.getNodeInfoByNode=function(node){\r\n\t\tIDTools.idObj(node);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(node);\r\n\t\tif (!CacheAnalyser._nodeInfoDic[key]){\r\n\t\t\tCacheAnalyser._nodeInfoDic[key]=new ReCacheRecInfo();\r\n\t\t}\r\n\t\t(CacheAnalyser._nodeInfoDic [key]).setTarget(node);\r\n\t\treturn CacheAnalyser._nodeInfoDic[key];\r\n\t}\r\n\r\n\tCacheAnalyser._nodeInfoDic={};\r\n\tCacheAnalyser.showCacheSprite=false;\r\n\tCacheAnalyser.showRecacheSprite=true;\r\n\t__static(CacheAnalyser,\r\n\t['counter',function(){return this.counter=new ObjTimeCountTool();},'I',function(){return this.I=new CacheAnalyser();}\r\n\t]);\r\n\treturn CacheAnalyser;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2017-3-2 下午12:11:59\r\n*/\r\n//class laya.debug.tools.CallLaterTool\r\nvar CallLaterTool=(function(){\r\n\tfunction CallLaterTool(){\r\n\t\tthis._getHandler=null;\r\n\t\tthis._indexHandler=null;\r\n\t\tthis._pool=null;\r\n\t\tthis._laters=null;\r\n\t}\r\n\r\n\t__class(CallLaterTool,'laya.debug.tools.CallLaterTool');\r\n\tvar __proto=CallLaterTool.prototype;\r\n\t/**\r\n\t*延迟执行。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*/\r\n\t__proto.callLater=function(caller,method,args){\r\n\t\tif (this._getHandler(caller,method)==null){\r\n\t\t\tCallLaterTool.oldCallLater.call(this,caller,method,args);\r\n\t\t\tif(CallLaterTool._isRecording){\r\n\t\t\t\tCallLaterTool._recordedCallLaters.push(this._laters[this._laters.length-1]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tCallLaterTool.initCallLaterRecorder=function(){\r\n\t\tif(CallLaterTool.oldCallLater)return;\r\n\t\tCallLaterTool.oldCallLater=Laya.timer[\"callLater\"];\r\n\t\tLaya.timer[\"callLater\"]=CallLaterTool[\"prototype\"][\"callLater\"];\r\n\t}\r\n\r\n\tCallLaterTool.beginRecordCallLater=function(){\r\n\t\tCallLaterTool.initCallLaterRecorder();\r\n\t\tCallLaterTool._isRecording=true;\r\n\t}\r\n\r\n\tCallLaterTool.runRecordedCallLaters=function(){\r\n\t\tCallLaterTool._isRecording=false;\r\n\t\tvar timer;\r\n\t\ttimer=Laya.timer;\r\n\t\tvar laters=timer[\"_laters\"];\r\n\t\tlaters=CallLaterTool._recordedCallLaters;\r\n\t\tfor (var i=0,n=laters.length-1;i <=n;i++){\r\n\t\t\tvar handler=laters[i];\r\n\t\t\tif(CallLaterTool._recordedCallLaters.indexOf(handler)<0)continue ;\r\n\t\t\thandler.method!==null && handler.run(false);\r\n\t\t\ttimer[\"_recoverHandler\"](handler);\r\n\t\t\tlaters.splice(i,1);\r\n\t\t}\r\n\t\tCallLaterTool._recordedCallLaters.length=0;\r\n\t}\r\n\r\n\tCallLaterTool._recordedCallLaters=[];\r\n\tCallLaterTool._isRecording=false;\r\n\tCallLaterTool.oldCallLater=null;\r\n\treturn CallLaterTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.CanvasTools\r\nvar CanvasTools=(function(){\r\n\tfunction CanvasTools(){}\r\n\t__class(CanvasTools,'laya.debug.tools.CanvasTools');\r\n\tCanvasTools.createCanvas=function(width,height){\r\n\t\tvar rst=new HTMLCanvas(\"2D\");\r\n\t\trst.getContext('2d');\r\n\t\trst.size(width,height);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tCanvasTools.renderSpriteToCanvas=function(sprite,canvas,offsetX,offsetY){\r\n\t\tRenderSprite.renders[sprite._renderType]._fun(sprite,canvas.context,offsetX,offsetY);\r\n\t}\r\n\r\n\tCanvasTools.getImageDataFromCanvas=function(canvas,x,y,width,height){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tif (width <=0)\r\n\t\t\twidth=canvas.width;\r\n\t\tif (height <=0)\r\n\t\t\theight=canvas.height;\r\n\t\tvar imgdata=canvas.context.getImageData(x,y,width,height);\r\n\t\treturn imgdata;\r\n\t}\r\n\r\n\tCanvasTools.getImageDataFromCanvasByRec=function(canvas,rec){\r\n\t\tvar imgdata=canvas.context.getImageData(rec.x,rec.y,rec.width,rec.height);\r\n\t\treturn imgdata;\r\n\t}\r\n\r\n\tCanvasTools.getDifferCount=function(imageData1,imageData2){\r\n\t\tvar data1=imageData1.data;\r\n\t\tvar data2=imageData2.data;\r\n\t\tvar differCount=0;\r\n\t\tdifferCount=0;\r\n\t\tCanvasTools.walkImageData(imageData1,myWalkFun);\r\n\t\treturn differCount;\r\n\t\tfunction myWalkFun (i,j,tarPos,data){\r\n\t\t\tif (!CanvasTools.isPoinSame(tarPos,data1,data2))differCount++;\r\n\t\t}\r\n\t}\r\n\r\n\tCanvasTools.getDifferRate=function(imageData1,imageData2){\r\n\t\treturn CanvasTools.getDifferCount(imageData1,imageData2)/(imageData1.width *imageData1.height);\r\n\t}\r\n\r\n\tCanvasTools.getCanvasDisRec=function(canvas){\r\n\t\tvar rst;\r\n\t\trst=new Rectangle;\r\n\t\tvar imgdata;\r\n\t\timgdata=CanvasTools.getImageDataFromCanvas(canvas,0,0);\r\n\t\tvar maxX=0;\r\n\t\tvar minX=0;\r\n\t\tvar maxY=0;\r\n\t\tvar minY=0;\r\n\t\tmaxX=maxY=0;\r\n\t\tminX=imgdata.width;\r\n\t\tminY=imgdata.height;\r\n\t\tvar i=0,iLen=0;\r\n\t\tvar j=0,jLen=0;\r\n\t\tiLen=imgdata.width;\r\n\t\tjLen=imgdata.height;\r\n\t\tvar data;\r\n\t\tdata=imgdata.data;\r\n\t\tvar tarPos=0;\r\n\t\tfor (j=0;j < jLen;j++){\r\n\t\t\tfor (i=0;i < iLen;i++){\r\n\t\t\t\tif (!CanvasTools.isEmptyPoint(data,tarPos)){\r\n\t\t\t\t\tif (minX > i)\r\n\t\t\t\t\t\tminX=i;\r\n\t\t\t\t\tif (maxX < i)\r\n\t\t\t\t\t\tmaxX=i;\r\n\t\t\t\t\tif (minY > j)\r\n\t\t\t\t\t\tminY=j;\r\n\t\t\t\t\tif (maxY < j)\r\n\t\t\t\t\t\tmaxY=j;\r\n\t\t\t\t}\r\n\t\t\t\ttarPos+=4;\r\n\t\t\t}\r\n\t\t}\r\n\t\trst.setTo(minX,minY,maxX-minX+1,maxY-minY+1);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tCanvasTools.fillCanvasRec=function(canvas,rec,color){\r\n\t\tvar ctx=canvas.context;\r\n\t\tctx.fillStyle=color;\r\n\t\tctx.fillRect(rec.x,rec.y,rec.width,rec.height);\r\n\t}\r\n\r\n\tCanvasTools.isEmptyPoint=function(data,pos){\r\n\t\tif (data[pos]==0 && data[pos+1]==0 && data[pos+2]==0 && data[pos+3]==0){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tCanvasTools.isPoinSame=function(pos,data1,data2){\r\n\t\tif (data1[pos]==data2[pos] && data1[pos+1]==data2[pos+1] && data1[pos+2]==data2[pos+2] && data1[pos+3]==data2[pos+3]){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tCanvasTools.walkImageData=function(imgdata,walkFun){\r\n\t\tvar i=0,iLen=0;\r\n\t\tvar j=0,jLen=0;\r\n\t\tiLen=imgdata.width;\r\n\t\tjLen=imgdata.height;\r\n\t\tvar tarPos=0;\r\n\t\tvar data=imgdata.data;\r\n\t\tfor (i=0;i < iLen;i++){\r\n\t\t\tfor (j=0;j < jLen;j++){\r\n\t\t\t\twalkFun(i,j,tarPos,data);\r\n\t\t\t\ttarPos+=4;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tCanvasTools.getSpriteByCanvas=function(canvas){\r\n\t\tvar rst;\r\n\t\trst=new Sprite();\r\n\t\trst.graphics.drawTexture(new Texture(canvas),0,0,canvas.width,canvas.height);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tCanvasTools.renderSpritesToCanvas=function(canvas,sprites,offx,offy,startIndex){\r\n\t\t(offx===void 0)&& (offx=0);\r\n\t\t(offy===void 0)&& (offy=0);\r\n\t\t(startIndex===void 0)&& (startIndex=0);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=sprites.length;\r\n\t\tfor (i=startIndex;i < len;i++){\r\n\t\t\tCanvasTools.renderSpriteToCanvas(sprites[i],canvas,offx,offy);\r\n\t\t}\r\n\t}\r\n\r\n\tCanvasTools.clearCanvas=function(canvas){\r\n\t\tvar preWidth=NaN;\r\n\t\tvar preHeight=NaN;\r\n\t\tpreWidth=canvas.width;\r\n\t\tpreHeight=canvas.height;\r\n\t\tcanvas.size(preWidth+1,preHeight);\r\n\t\tcanvas.size(preWidth,preHeight);\r\n\t}\r\n\r\n\tCanvasTools.getImagePixels=function(x,y,width,data,colorLen){\r\n\t\t(colorLen===void 0)&& (colorLen=4);\r\n\t\tvar pos=0;\r\n\t\tpos=(x *width+y)*colorLen;\r\n\t\tvar i=0,len=0;\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tlen=colorLen;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst.push(data[pos+i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn CanvasTools;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-23 下午2:24:04\r\n*/\r\n//class laya.debug.tools.ClassTool\r\nvar ClassTool=(function(){\r\n\tfunction ClassTool(){}\r\n\t__class(ClassTool,'laya.debug.tools.ClassTool');\r\n\tClassTool.defineProperty=function(obj,name,des){\r\n\t\t/*__JS__ */Object.defineProperty(obj,name,des);;\r\n\t}\r\n\r\n\tClassTool.getOwnPropertyDescriptor=function(obj,name){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=Object.getOwnPropertyDescriptor(obj,name);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getOwnPropertyDescriptors=function(obj){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=Object.getOwnPropertyDescriptors(obj);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getOwnPropertyNames=function(obj){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=Object.getOwnPropertyNames(obj);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getObjectGetSetKeys=function(obj,rst){\r\n\t\tif (!rst)rst=[];\r\n\t\tvar keys;\r\n\t\tkeys=laya.debug.tools.ClassTool.getOwnPropertyNames(obj);\r\n\t\tvar key;\r\n\t\tfor (key in keys){\r\n\t\t\tkey=keys[key];\r\n\t\t\tif (key.indexOf(\"_$get_\")>=0){\r\n\t\t\t\tkey=key.replace(\"_$get_\",\"\");\r\n\t\t\t\trst.push(key);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (obj[\"__proto__\"]){\r\n\t\t\tClassTool.getObjectGetSetKeys(obj[\"__proto__\"],rst);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getObjectDisplayAbleKeys=function(obj,rst){\r\n\t\tif (!rst)rst=[];\r\n\t\tvar key;\r\n\t\tvar tValue;\r\n\t\tvar tType;\r\n\t\tfor (key in obj){\r\n\t\t\ttValue=obj[key];\r\n\t\t\ttType=typeof(tValue);\r\n\t\t\tif (key.charAt(0)==\"_\")continue ;\r\n\t\t\trst.push(key);\r\n\t\t}\r\n\t\tClassTool.getObjectGetSetKeys(obj,rst);\r\n\t\trst=ObjectTools.getNoSameArr(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getClassName=function(tar){\r\n\t\tif ((typeof tar=='function'))return tar.name;\r\n\t\treturn tar[\"constructor\"].name;\r\n\t}\r\n\r\n\tClassTool.getNodeClassAndName=function(tar){\r\n\t\tif (!tar)return \"null\";\r\n\t\tvar rst;\r\n\t\tif (tar.name){\r\n\t\t\trst=ClassTool.getClassName(tar)+\"(\"+tar.name+\")\";\r\n\t\t\t}else{\r\n\t\t\trst=ClassTool.getClassName(tar);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.getClassNameByClz=function(clz){\r\n\t\treturn clz[\"name\"];\r\n\t}\r\n\r\n\tClassTool.getClassByName=function(className){\r\n\t\tvar rst;\r\n\t\trst=/*__JS__ */eval(className);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassTool.createObjByName=function(className){\r\n\t\tvar clz;\r\n\t\tclz=ClassTool.getClassByName(className);\r\n\t\treturn new clz();\r\n\t}\r\n\r\n\t__static(ClassTool,\r\n\t['displayTypes',function(){return this.displayTypes={\"boolean\":true,\"number\":true,\"string\":true };}\r\n\t]);\r\n\treturn ClassTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.ClickSelectTool\r\nvar ClickSelectTool=(function(){\r\n\tfunction ClickSelectTool(){\r\n\t\tthis.completeHandler=null;\r\n\t\tthis.tSelectTar=null;\r\n\t\tthis._selectTip=new Sprite();\r\n\t\tthis._selectTip.setBounds(new Rectangle(0,0,0,0));\r\n\t\tNotice.listen(/*laya.debug.tools.DisplayHook.ITEM_CLICKED*/\"ItemClicked\",this,this.itemClicked);\r\n\t}\r\n\r\n\t__class(ClickSelectTool,'laya.debug.tools.ClickSelectTool');\r\n\tvar __proto=ClickSelectTool.prototype;\r\n\t__proto.beginClickSelect=function(complete){\r\n\t\tthis.completeHandler=complete;\r\n\t\tClickSelectTool.isClickSelectState=true;\r\n\t\tthis.clickSelectChange();\r\n\t}\r\n\r\n\t__proto.clickSelectChange=function(){\r\n\t\tif (!Browser.onPC)return;\r\n\t\tthis.tSelectTar=null;\r\n\t\tthis.clearSelectTip();\r\n\t\tif (ClickSelectTool.isClickSelectState){\r\n\t\t\tLaya.timer.loop(200,this,this.updateSelectTar,null,true);\r\n\t\t\t}else{\r\n\t\t\tLaya.timer.clear(this,this.updateSelectTar);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.clearSelectTip=function(){\r\n\t\tthis._selectTip.removeSelf();\r\n\t}\r\n\r\n\t__proto.updateSelectTar=function(){\r\n\t\tthis.clearSelectTip();\r\n\t\tthis.tSelectTar=DisplayHook.instance.getDisUnderMouse();\r\n\t\tif (!this.tSelectTar){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (DebugInfoLayer.I.isDebugItem(this.tSelectTar))return;\r\n\t\tvar g;\r\n\t\tg=this._selectTip.graphics;\r\n\t\tg.clear();\r\n\t\tvar rec;\r\n\t\trec=NodeUtils.getGRec(this.tSelectTar);\r\n\t\tDebugInfoLayer.I.popLayer.addChild(this._selectTip);\r\n\t\tg.drawRect(0,0,rec.width,rec.height,null,DebugConsts.CLICK_SELECT_COLOR,2);\r\n\t\tthis._selectTip.pos(rec.x,rec.y);\r\n\t}\r\n\r\n\t__proto.itemClicked=function(tar){\r\n\t\tif (!ClickSelectTool.isClickSelectState)return;\r\n\t\tif (ClickSelectTool.ignoreDebugTool){\r\n\t\t\tif (DebugInfoLayer.I.isDebugItem(tar))return;\r\n\t\t}\r\n\t\tif ((tar instanceof laya.debug.uicomps.ContextMenuItem )|| (tar.parent instanceof laya.debug.uicomps.ContextMenuItem )){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tDebugTool.showDisBound(tar);\r\n\t\tif (this.completeHandler){\r\n\t\t\tthis.completeHandler.runWith(tar);\r\n\t\t}\r\n\t\tClickSelectTool.isClickSelectState=false;\r\n\t\tthis.clickSelectChange();\r\n\t}\r\n\r\n\t__getset(1,ClickSelectTool,'I',function(){\r\n\t\tif (!ClickSelectTool._I)ClickSelectTool._I=new ClickSelectTool();\r\n\t\treturn ClickSelectTool._I;\r\n\t});\r\n\r\n\tClickSelectTool._I=null;\r\n\tClickSelectTool.isClickSelectState=false;\r\n\tClickSelectTool.ignoreDebugTool=false;\r\n\treturn ClickSelectTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.ColorTool\r\nvar ColorTool=(function(){\r\n\tfunction ColorTool(){\r\n\t\tthis.red=NaN;\r\n\t\tthis.green=NaN;\r\n\t\tthis.blue=NaN;\r\n\t}\r\n\r\n\t__class(ColorTool,'laya.debug.tools.ColorTool');\r\n\tColorTool.toHexColor=function(color){\r\n\t\treturn Utils.toHexColor(color);\r\n\t}\r\n\r\n\tColorTool.getRGBByRGBStr=function(str){\r\n\t\tstr.charAt(0)=='#' && (str=str.substr(1));\r\n\t\tvar color=/*__JS__ */parseInt(str,16);\r\n\t\tvar flag=(str.length==8);\r\n\t\tvar _color;\r\n\t\t_color=[((0x00FF0000 & color)>> 16),((0x0000FF00 & color)>> 8),(0x000000FF & color)];\r\n\t\treturn _color;\r\n\t}\r\n\r\n\tColorTool.getColorBit=function(value){\r\n\t\tvar rst;\r\n\t\trst=Math.floor(value).toString(16);\r\n\t\trst=rst.length > 1 ? rst :\"0\"+rst;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tColorTool.getRGBStr=function(rgb){\r\n\t\treturn \"#\"+ColorTool.getColorBit(rgb[0])+ColorTool.getColorBit(rgb[1])+ColorTool.getColorBit(rgb[2]);\r\n\t}\r\n\r\n\tColorTool.traseHSB=function(hsb){\r\n\t\tconsole.log(\"hsb:\",hsb[0],hsb[1],hsb[2]);\r\n\t}\r\n\r\n\tColorTool.rgb2hsb=function(rgbR,rgbG,rgbB){\r\n\t\tvar rgb=[rgbR,rgbG,rgbB];\r\n\t\trgb.sort(MathTools.sortNumSmallFirst);\r\n\t\tvar max=rgb[2];\r\n\t\tvar min=rgb[0];\r\n\t\tvar hsbB=max / 255.0;\r\n\t\tvar hsbS=max==0 ? 0 :(max-min)/ max;\r\n\t\tvar hsbH=0;\r\n\t\tif(max==min){\r\n\t\t\thsbH=1;\r\n\t\t}\r\n\t\telse\r\n\t\tif (rgbR==0 && rgbG==0&&rgbB==0){\r\n\t\t}else\r\n\t\tif (max==rgbR && rgbG >=rgbB){\r\n\t\t\thsbH=(rgbG-rgbB)*60 / (max-min)+0;\r\n\t\t}\r\n\t\telse if (max==rgbR && rgbG < rgbB){\r\n\t\t\thsbH=(rgbG-rgbB)*60 / (max-min)+360;\r\n\t\t}\r\n\t\telse if (max==rgbG){\r\n\t\t\thsbH=(rgbB-rgbR)*60 / (max-min)+120;\r\n\t\t}\r\n\t\telse if (max==rgbB){\r\n\t\t\thsbH=(rgbR-rgbG)*60 / (max-min)+240;\r\n\t\t}\r\n\t\treturn [hsbH,hsbS,hsbB];\r\n\t}\r\n\r\n\tColorTool.hsb2rgb=function(h,s,v){\r\n\t\tvar r=0,g=0,b=0;\r\n\t\tvar i=Math.floor((h / 60)% 6);\r\n\t\tvar f=(h / 60)-i;\r\n\t\tvar p=v *(1-s);\r\n\t\tvar q=v *(1-f *s);\r\n\t\tvar t=v *(1-(1-f)*s);\r\n\t\tswitch (i){\r\n\t\t\tcase 0:\r\n\t\t\t\tr=v;\r\n\t\t\t\tg=t;\r\n\t\t\t\tb=p;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 1:\r\n\t\t\t\tr=q;\r\n\t\t\t\tg=v;\r\n\t\t\t\tb=p;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 2:\r\n\t\t\t\tr=p;\r\n\t\t\t\tg=v;\r\n\t\t\t\tb=t;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 3:\r\n\t\t\t\tr=p;\r\n\t\t\t\tg=q;\r\n\t\t\t\tb=v;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 4:\r\n\t\t\t\tr=t;\r\n\t\t\t\tg=p;\r\n\t\t\t\tb=v;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 5:\r\n\t\t\t\tr=v;\r\n\t\t\t\tg=p;\r\n\t\t\t\tb=q;\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\treturn [Math.floor(r *255.0),Math.floor(g *255.0),Math.floor(b *255.0)];\r\n\t}\r\n\r\n\treturn ColorTool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-29 下午12:53:31\r\n*/\r\n//class laya.debug.tools.CommonTools\r\nvar CommonTools=(function(){\r\n\tfunction CommonTools(){}\r\n\t__class(CommonTools,'laya.debug.tools.CommonTools');\r\n\tCommonTools.bind=function(fun,scope){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=fun.bind(scope);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tCommonTools.insertP=function(tar,x,y,scaleX,scaleY,rotation){\r\n\t\tvar nSp;\r\n\t\tnSp=new Sprite();\r\n\t\ttar.parent.addChild(nSp);\r\n\t\tnSp.x=x;\r\n\t\tnSp.y=y;\r\n\t\tnSp.scaleX=scaleX;\r\n\t\tnSp.scaleY=scaleY;\r\n\t\tnSp.rotation=rotation;\r\n\t\tnSp.addChild(tar);\r\n\t\tCommonTools.count++;\r\n\t\tnSp.name=\"insertP:\"+CommonTools.count;\r\n\t}\r\n\r\n\tCommonTools.insertChild=function(tar,x,y,scaleX,scaleY,rotation,color){\r\n\t\t(color===void 0)&& (color=\"#ff00ff\");\r\n\t\tvar nSp;\r\n\t\tnSp=new Sprite();\r\n\t\ttar.addChild(nSp);\r\n\t\tnSp.x=x;\r\n\t\tnSp.y=y;\r\n\t\tnSp.scaleX=scaleX;\r\n\t\tnSp.scaleY=scaleY;\r\n\t\tnSp.rotation=rotation;\r\n\t\tnSp.graphics.drawRect(0,0,20,20,color);\r\n\t\tnSp.name=\"child:\"+tar.numChildren;\r\n\t\treturn nSp;\r\n\t}\r\n\r\n\tCommonTools.createSprite=function(width,height,color){\r\n\t\t(color===void 0)&& (color=\"#ff0000\");\r\n\t\tvar sp;\r\n\t\tsp=new Sprite();\r\n\t\tsp.graphics.drawRect(0,0,width,height,color);\r\n\t\tsp.size(width,height);\r\n\t\treturn sp;\r\n\t}\r\n\r\n\tCommonTools.createBtn=function(txt,width,height){\r\n\t\t(width===void 0)&& (width=100);\r\n\t\t(height===void 0)&& (height=40);\r\n\t\tvar sp;\r\n\t\tsp=new Sprite();\r\n\t\tsp.size(width,height);\r\n\t\tsp.graphics.drawRect(0,0,sp.width,sp.height,\"#ff0000\");\r\n\t\tsp.graphics.fillText(txt,sp.width *0.5,sp.height *0.5,null,\"#ffff00\",\"center\");\r\n\t\treturn sp;\r\n\t}\r\n\r\n\tCommonTools.count=0;\r\n\treturn CommonTools;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-24 下午6:37:56\r\n*/\r\n//class laya.debug.tools.CountTool\r\nvar CountTool=(function(){\r\n\tfunction CountTool(){\r\n\t\tthis.data={};\r\n\t\tthis.preO={};\r\n\t\tthis.changeO={};\r\n\t\tthis.count=0;\r\n\t}\r\n\r\n\t__class(CountTool,'laya.debug.tools.CountTool');\r\n\tvar __proto=CountTool.prototype;\r\n\t__proto.reset=function(){\r\n\t\tthis.data={};\r\n\t\tthis.count=0;\r\n\t}\r\n\r\n\t__proto.add=function(name,num){\r\n\t\t(num===void 0)&& (num=1);\r\n\t\tthis.count++;\r\n\t\tif(!this.data.hasOwnProperty(name)){\r\n\t\t\tthis.data[name]=0;\r\n\t\t}\r\n\t\tthis.data[name]=this.data[name]+num;\r\n\t}\r\n\r\n\t__proto.getKeyCount=function(key){\r\n\t\tif(!this.data.hasOwnProperty(key)){\r\n\t\t\tthis.data[key]=0;\r\n\t\t}\r\n\t\treturn this.data[key];\r\n\t}\r\n\r\n\t__proto.getKeyChange=function(key){\r\n\t\tif (!this.changeO[key])return 0;\r\n\t\treturn this.changeO[key];\r\n\t}\r\n\r\n\t__proto.record=function(){\r\n\t\tvar key;\r\n\t\tfor (key in this.changeO){\r\n\t\t\tthis.changeO[key]=0;\r\n\t\t}\r\n\t\tfor (key in this.data){\r\n\t\t\tif (!this.preO[key])this.preO[key]=0;\r\n\t\t\tthis.changeO[key]=this.data[key]-this.preO[key];\r\n\t\t\tthis.preO[key]=this.data[key]\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getCount=function(dataO){\r\n\t\tvar rst=0;\r\n\t\tvar key;\r\n\t\tfor (key in dataO){\r\n\t\t\trst+=dataO[key];\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto.traceSelf=function(dataO){\r\n\t\tif (!dataO)dataO=this.data;\r\n\t\tvar tCount=0;\r\n\t\ttCount=this.getCount(dataO);\r\n\t\tconsole.log(\"total:\"+tCount);\r\n\t\treturn \"total:\"+tCount+\"\\n\"+TraceTool.traceObj(dataO);\r\n\t}\r\n\r\n\t__proto.traceSelfR=function(dataO){\r\n\t\tif (!dataO)dataO=this.data;\r\n\t\tvar tCount=0;\r\n\t\ttCount=this.getCount(dataO);\r\n\t\tconsole.log(\"total:\"+tCount);\r\n\t\treturn \"total:\"+tCount+\"\\n\"+TraceTool.traceObjR(dataO);\r\n\t}\r\n\r\n\treturn CountTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.DebugConsts\r\nvar DebugConsts=(function(){\r\n\tfunction DebugConsts(){}\r\n\t__class(DebugConsts,'laya.debug.tools.DebugConsts');\r\n\tDebugConsts.CLICK_SELECT_COLOR=\"#ff0000\";\r\n\tDebugConsts.CANVAS_REC_COLOR=\"#FF00FF\";\r\n\tDebugConsts.RECACHE_REC_COLOR=\"#00ff00\";\r\n\tDebugConsts.SPRITE_REC_COLOR=\"#ff0000\";\r\n\tDebugConsts.SPRITE_REC_LINEWIDTH=2;\r\n\treturn DebugConsts;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-31 下午3:35:16\r\n*/\r\n//class laya.debug.tools.DebugExport\r\nvar DebugExport=(function(){\r\n\tfunction DebugExport(){}\r\n\t__class(DebugExport,'laya.debug.tools.DebugExport');\r\n\tDebugExport.export=function(){\r\n\t\tvar _window;\r\n\t\t/*__JS__ */_window=window;;\r\n\t\tvar key;\r\n\t\tfor(key in DebugExport._exportsDic){\r\n\t\t\t_window[key]=DebugExport._exportsDic[key];\r\n\t\t}\r\n\t}\r\n\r\n\t__static(DebugExport,\r\n\t['_exportsDic',function(){return this._exportsDic={\r\n\t\t\t\"DebugTool\":DebugTool,\r\n\t\t\t\"Watcher\":Watcher\r\n\t};}\r\n\r\n\t]);\r\n\treturn DebugExport;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.DebugTxt\r\nvar DebugTxt=(function(){\r\n\tfunction DebugTxt(){}\r\n\t__class(DebugTxt,'laya.debug.tools.DebugTxt');\r\n\tDebugTxt.init=function(){\r\n\t\tif (DebugTxt._txt)return;\r\n\t\tDebugTxt._txt=new Text();\r\n\t\tDebugTxt._txt.pos(100,100);\r\n\t\tDebugTxt._txt.color=\"#ff00ff\";\r\n\t\tDebugTxt._txt.zOrder=999;\r\n\t\tDebugTxt._txt.fontSize=24;\r\n\t\tDebugTxt._txt.text=\"debugTxt inited\";\r\n\t\tLaya.stage.addChild(DebugTxt._txt);\r\n\t}\r\n\r\n\tDebugTxt.getArgArr=function(arg){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar i=0,len=arg.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(arg[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDebugTxt.dTrace=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\targ=DebugTxt.getArgArr(arg);\r\n\t\tvar str;\r\n\t\tstr=arg.join(\" \");\r\n\t\tif (DebugTxt._txt){\r\n\t\t\tDebugTxt._txt.text=str+\"\\n\"+DebugTxt._txt.text;\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTxt.getTimeStr=function(){\r\n\t\tvar dateO=/*__JS__ */new Date();\r\n\t\treturn dateO.toTimeString();\r\n\t}\r\n\r\n\tDebugTxt.traceTime=function(msg){\r\n\t\tDebugTxt.dTrace(DebugTxt.getTimeStr());\r\n\t\tDebugTxt.dTrace(msg);\r\n\t}\r\n\r\n\tDebugTxt.show=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\targ=DebugTxt.getArgArr(arg);\r\n\t\tvar str;\r\n\t\tstr=arg.join(\" \");\r\n\t\tif (DebugTxt._txt){\r\n\t\t\tDebugTxt._txt.text=str;\r\n\t\t}\r\n\t}\r\n\r\n\tDebugTxt._txt=null;\r\n\tDebugTxt.I=null;\r\n\treturn DebugTxt;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于显示对象值变化过程\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-23 上午10:41:50\r\n*/\r\n//class laya.debug.tools.DifferTool\r\nvar DifferTool=(function(){\r\n\tfunction DifferTool(sign,autoTrace){\r\n\t\tthis.autoTrace=true;\r\n\t\tthis.sign=\"\";\r\n\t\tthis.obj=null;\r\n\t\t(sign===void 0)&& (sign=\"\");\r\n\t\t(autoTrace===void 0)&& (autoTrace=true);\r\n\t\tthis.sign=sign;\r\n\t\tthis.autoTrace=autoTrace;\r\n\t}\r\n\r\n\t__class(DifferTool,'laya.debug.tools.DifferTool');\r\n\tvar __proto=DifferTool.prototype;\r\n\t__proto.update=function(data,msg){\r\n\t\tif(msg){\r\n\t\t\tconsole.log(msg);\r\n\t\t};\r\n\t\tvar tObj=ObjectTools.copyObj(data);\r\n\t\tif(!this.obj)this.obj={};\r\n\t\tvar rst;\r\n\t\trst=ObjectTools.differ(this.obj,tObj);\r\n\t\tthis.obj=tObj;\r\n\t\tif(this.autoTrace){\r\n\t\t\tconsole.log(this.sign+\" differ:\");\r\n\t\t\tObjectTools.traceDifferObj(rst);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDifferTool.differ=function(sign,data,msg){\r\n\t\tif(!DifferTool._differO[sign])DifferTool._differO[sign]=new DifferTool(sign,true);\r\n\t\tvar tDiffer;\r\n\t\ttDiffer=DifferTool._differO[sign];\r\n\t\treturn tDiffer.update(data,msg);\r\n\t}\r\n\r\n\tDifferTool._differO={};\r\n\treturn DifferTool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2016-1-14 下午4:32:47\r\n*/\r\n//class laya.debug.tools.DisController\r\nvar DisController=(function(){\r\n\tfunction DisController(){\r\n\t\tthis.arrowAxis=null;\r\n\t\tthis._target=null;\r\n\t\tthis.recInfo=null;\r\n\t\tDisController.init();\r\n\t\tthis.arrowAxis=new Axis();\r\n\t\tthis.arrowAxis.mouseEnabled=true;\r\n\t}\r\n\r\n\t__class(DisController,'laya.debug.tools.DisController');\r\n\tvar __proto=DisController.prototype;\r\n\t__proto.switchType=function(){\r\n\t\tthis.arrowAxis.switchType();\r\n\t}\r\n\r\n\t__proto.updateMe=function(){\r\n\t\tif(!this._target)return;\r\n\t\tthis.recInfo=RecInfo.getGlobalRecInfo(this._target,0,0,1,0,0,1);\r\n\t\tconsole.log(\"rotation:\",this.recInfo.rotation);\r\n\t\tconsole.log(\"pos:\",this.recInfo.x,this.recInfo.y);\r\n\t\tconsole.log(\"scale:\",this.recInfo.width,this.recInfo.height);\r\n\t\tthis.arrowAxis.x=this.recInfo.x;\r\n\t\tthis.arrowAxis.y=this.recInfo.y;\r\n\t\tthis.arrowAxis.rotation=this.recInfo.rotation;\r\n\t\tthis.arrowAxis.yAxis.rotation=this.recInfo.rotationV-this.recInfo.rotation;\r\n\t}\r\n\r\n\t__getset(0,__proto,'target',function(){\r\n\t\treturn this._target;\r\n\t\t},function(target){\r\n\t\tthis._target=target;\r\n\t\tif(target){\r\n\t\t\tDisController._container.addChild(this.arrowAxis);\r\n\t\t\tLaya.timer.loop(100,this,this.updateMe);\r\n\t\t\t}else{\r\n\t\t\tthis.arrowAxis.removeSelf();\r\n\t\t\tLaya.timer.clear(this,this.updateMe);\r\n\t\t}\r\n\t\tthis.arrowAxis.target=target;\r\n\t\tthis.updateMe();\r\n\t});\r\n\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn this.arrowAxis.type;\r\n\t\t},function(lenType){\r\n\t\tthis.arrowAxis.type=lenType;\r\n\t});\r\n\r\n\tDisController.init=function(){\r\n\t\tif (DisController._container){\r\n\t\t\tDisControlTool.setTop(DisController._container);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tDisController._container=new Sprite();\r\n\t\tDisController._container.mouseEnabled=true;\r\n\t\tLaya.stage.addChild(DisController._container);\r\n\t}\r\n\r\n\tDisController._container=null;\r\n\t__static(DisController,\r\n\t['I',function(){return this.I=new DisController();}\r\n\t]);\r\n\treturn DisController;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-25 下午7:19:44\r\n*/\r\n//class laya.debug.tools.DisControlTool\r\nvar DisControlTool=(function(){\r\n\tfunction DisControlTool(){}\r\n\t__class(DisControlTool,'laya.debug.tools.DisControlTool');\r\n\tDisControlTool.getObjectsUnderPoint=function(sprite,x,y,rst,filterFun){\r\n\t\trst=rst?rst:[];\r\n\t\tif(filterFun!=null&&!filterFun(sprite))return rst;\r\n\t\tif (sprite.getBounds().contains(x,y)){\r\n\t\t\trst.push(sprite);\r\n\t\t\tvar tS;\r\n\t\t\tvar tempP=new Point();\r\n\t\t\ttempP.setTo(x,y);\r\n\t\t\ttempP=sprite.fromParentPoint(tempP);\r\n\t\t\tx=tempP.x;\r\n\t\t\ty=tempP.y;\r\n\t\t\tfor (var i=sprite._childs.length-1;i >-1;i--){\r\n\t\t\t\tvar child=sprite._childs[i];\r\n\t\t\t\tif((child instanceof laya.display.Sprite ))\r\n\t\t\t\t\tDisControlTool.getObjectsUnderPoint(child,x,y,rst,filterFun);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDisControlTool.getObjectsUnderGlobalPoint=function(sprite,filterFun){\r\n\t\tvar point=new Point();\r\n\t\tpoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);\r\n\t\tif(sprite.parent)\r\n\t\t\tpoint=(sprite.parent).globalToLocal(point);\r\n\t\treturn DisControlTool.getObjectsUnderPoint(sprite,point.x,point.y,null,filterFun);\r\n\t}\r\n\r\n\tDisControlTool.findFirstObjectsUnderGlobalPoint=function(){\r\n\t\tvar disList;\r\n\t\tdisList=DisControlTool.getObjectsUnderGlobalPoint(Laya.stage);\r\n\t\tif (!disList)return null;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tDis;\r\n\t\tlen=disList.length;\r\n\t\tfor (i=len-1;i>=0;i--){\r\n\t\t\ttDis=disList[i];\r\n\t\t\tif (tDis && tDis.numChildren < 1){\r\n\t\t\t\treturn tDis;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tDis;\r\n\t}\r\n\r\n\tDisControlTool.visibleAndEnableObjFun=function(tar){\r\n\t\treturn tar.visible&&tar.mouseEnabled;\r\n\t}\r\n\r\n\tDisControlTool.visibleObjFun=function(tar){\r\n\t\treturn tar.visible;\r\n\t}\r\n\r\n\tDisControlTool.getMousePoint=function(sprite){\r\n\t\tvar point=new Point();\r\n\t\tpoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);\r\n\t\tpoint=sprite.globalToLocal(point);\r\n\t\treturn point;\r\n\t}\r\n\r\n\tDisControlTool.isChildE=function(parent,child){\r\n\t\tif (!parent)return false;\r\n\t\twhile (child){\r\n\t\t\tif (child.parent==parent)return true;\r\n\t\t\tchild=child.parent;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tDisControlTool.isInTree=function(pNode,child){\r\n\t\treturn pNode==child || DisControlTool.isChildE(pNode,child);\r\n\t}\r\n\r\n\tDisControlTool.setTop=function(tar){\r\n\t\tif(tar&&tar.parent){\r\n\t\t\tvar tParent;\r\n\t\t\ttParent=tar.parent;\r\n\t\t\ttParent.setChildIndex(tar,tParent.numChildren-1);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.clearItemRelativeInfo=function(item){\r\n\t\tvar Nan=\"NaN\";\r\n\t\titem.getLayout().left=Nan;\r\n\t\titem.getLayout().right=Nan;\r\n\t\titem.getLayout().top=Nan;\r\n\t\titem.getLayout().bottom=Nan;\r\n\t}\r\n\r\n\tDisControlTool.swap=function(tarA,tarB){\r\n\t\tif (tarA==tarB)return;\r\n\t\tvar iA=0;\r\n\t\tiA=tarA.parent.getChildIndex(tarA);\r\n\t\tvar iB=0;\r\n\t\tiB=tarB.parent.getChildIndex(tarB);\r\n\t\tvar bP;\r\n\t\tbP=tarB.parent;\r\n\t\ttarA.parent.addChildAt(tarB,iA);\r\n\t\tbP.addChildAt(tarA,iB);\r\n\t}\r\n\r\n\tDisControlTool.insertToTarParent=function(tarA,tars,after){\r\n\t\t(after===void 0)&& (after=false);\r\n\t\tvar tIndex=0;\r\n\t\tvar parent;\r\n\t\tif(!tarA)return;\r\n\t\tparent=tarA.parent;\r\n\t\tif(!parent)return;\r\n\t\ttIndex=parent.getChildIndex(tarA);\r\n\t\tif(after)tIndex++;\r\n\t\tDisControlTool.insertToParent(parent,tars,tIndex);\r\n\t}\r\n\r\n\tDisControlTool.insertToParent=function(parent,tars,index){\r\n\t\t(index===void 0)&& (index=-1);\r\n\t\tif(!parent)return;\r\n\t\tif(index<0)index=parent.numChildren;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=tars.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tDisControlTool.transParent(tars[i],parent);\r\n\t\t\tparent.addChildAt(tars[i],index);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.transParent=function(tar,newParent){\r\n\t\tif(!tar||!newParent)return;\r\n\t\tif(!tar.parent)return;\r\n\t\tvar preParent;\r\n\t\tpreParent=tar.parent;\r\n\t\tvar pos;\r\n\t\tpos=new Point(tar.x,tar.y);\r\n\t\tpos=preParent.localToGlobal(pos);\r\n\t\tpos=newParent.globalToLocal(pos);\r\n\t\ttar.pos(pos.x,pos.y);\r\n\t}\r\n\r\n\tDisControlTool.transPoint=function(nowParent,tarParent,point){\r\n\t\tpoint=nowParent.localToGlobal(point);\r\n\t\tpoint=tarParent.globalToLocal(point);\r\n\t\treturn point;\r\n\t}\r\n\r\n\tDisControlTool.removeItems=function(itemList){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=itemList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\t(itemList [i]).removeSelf();\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.addItems=function(itemList,parent){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=itemList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tparent.addChild(itemList[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.getAllChild=function(tar){\r\n\t\tif(!tar)return [];\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar rst=[];\r\n\t\tlen=tar.numChildren;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(tar.getChildAt(i));\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDisControlTool.upDis=function(child){\r\n\t\tif(child&&child.parent){\r\n\t\t\tvar tParent;\r\n\t\t\ttParent=child.parent;\r\n\t\t\tvar newIndex=0;\r\n\t\t\tnewIndex=tParent.getChildIndex(child)+1;\r\n\t\t\tif(newIndex>=tParent.numChildren){\r\n\t\t\t\tnewIndex=tParent.numChildren-1;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"setChildIndex:\"+newIndex);\r\n\t\t\ttParent.setChildIndex(child,newIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.downDis=function(child){\r\n\t\tif(child&&child.parent){\r\n\t\t\tvar tParent;\r\n\t\t\ttParent=child.parent;\r\n\t\t\tvar newIndex=0;\r\n\t\t\tnewIndex=tParent.getChildIndex(child)-1;\r\n\t\t\tif(newIndex<0)newIndex=0;\r\n\t\t\tconsole.log(\"setChildIndex:\"+newIndex);\r\n\t\t\ttParent.setChildIndex(child,newIndex);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.setResizeAbleEx=function(node){\r\n\t\tvar clickItem;\r\n\t\tclickItem=node.getChildByName(\"resizeBtn\");\r\n\t\tif (clickItem){\r\n\t\t\tSimpleResizer.setResizeAble(clickItem,node);\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.setResizeAble=function(node){\r\n\t\tnode.on(/*laya.events.Event.CLICK*/\"click\",null,DisControlTool.resizeHandler,[node]);\r\n\t}\r\n\r\n\tDisControlTool.resizeHandler=function(tar){\r\n\t\tDisResizer.setUp(tar);\r\n\t}\r\n\r\n\tDisControlTool.setDragingItem=function(dragBar,tar){\r\n\t\tdragBar.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",null,DisControlTool.dragingHandler,[tar]);\r\n\t\ttar.on(/*laya.events.Event.DRAG_END*/\"dragend\",null,DisControlTool.dragingEnd,[tar]);\r\n\t}\r\n\r\n\tDisControlTool.dragingHandler=function(tar){\r\n\t\tif (tar){\r\n\t\t\ttar.startDrag();\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.dragingEnd=function(tar){\r\n\t\tDisControlTool.intFyDisPos(tar);\r\n\t\tconsole.log(tar.x,tar.y);\r\n\t}\r\n\r\n\tDisControlTool.showToStage=function(dis,offX,offY){\r\n\t\t(offX===void 0)&& (offX=0);\r\n\t\t(offY===void 0)&& (offY=0);\r\n\t\tvar rec=dis.getBounds();\r\n\t\tdis.x=Laya.stage.mouseX+offX;\r\n\t\tdis.y=Laya.stage.mouseY+offY;\r\n\t\tif (dis.x+rec.width > Laya.stage.width){\r\n\t\t\tdis.x-=rec.width+offX;\r\n\t\t}\r\n\t\tif (dis.y+rec.height > Laya.stage.height){\r\n\t\t\tdis.y-=rec.height+offY;\r\n\t\t}\r\n\t\tDisControlTool.intFyDisPos(dis);\r\n\t}\r\n\r\n\tDisControlTool.intFyDisPos=function(dis){\r\n\t\tif (!dis)return;\r\n\t\tdis.x=Math.round(dis.x);\r\n\t\tdis.y=Math.round(dis.y);\r\n\t}\r\n\r\n\tDisControlTool.showOnly=function(disList,showItem){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=disList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tdisList[i].visible=disList[i]==showItem;\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.showOnlyByIndex=function(disList,index){\r\n\t\tDisControlTool.showOnly(disList,disList[index]);\r\n\t}\r\n\r\n\tDisControlTool.addOnly=function(disList,showItem,parent){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=disList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (disList[i] !=showItem){\r\n\t\t\t\tdisList[i].removeSelf();\r\n\t\t\t\t}else{\r\n\t\t\t\tparent.addChild(disList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tDisControlTool.addOnlyByIndex=function(disList,index,parent){\r\n\t\tDisControlTool.addOnly(disList,disList[index],parent);\r\n\t}\r\n\r\n\t__static(DisControlTool,\r\n\t['tempP',function(){return this.tempP=new Point();}\r\n\t]);\r\n\treturn DisControlTool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-24 下午4:20:25\r\n*/\r\n//class laya.debug.tools.DisEditor\r\nvar DisEditor=(function(){\r\n\tfunction DisEditor(){\r\n\t\tthis.tar=null;\r\n\t\tthis.rec=new Sprite();\r\n\t\tthis.rootContainer=new Sprite();\r\n\t}\r\n\r\n\t__class(DisEditor,'laya.debug.tools.DisEditor');\r\n\tvar __proto=DisEditor.prototype;\r\n\t__proto.setTarget=function(target){\r\n\t\tthis.tar=target;\r\n\t\tvar g;\r\n\t\tg=this.rec.graphics;\r\n\t\tg.clear();\r\n\t\tvar bounds;\r\n\t\tbounds=this.tar.getSelfBounds();\r\n\t\tg.drawRect(bounds.x,bounds.y,bounds.width,bounds.height,null,\"#00ff00\");\r\n\t\tthis.createSameDisChain();\r\n\t\tLaya.stage.addChild(this.rootContainer);\r\n\t}\r\n\r\n\t__proto.createSameDisChain=function(){\r\n\t\tvar tParent;\r\n\t\tvar cpParent;\r\n\t\tvar preTar;\r\n\t\tpreTar=this.rec;\r\n\t\ttParent=this.tar;\r\n\t\twhile(tParent&&tParent!=Laya.stage){\r\n\t\t\tcpParent=new Sprite();\r\n\t\t\tcpParent.addChild(preTar);\r\n\t\t\tcpParent.x=tParent.x;\r\n\t\t\tcpParent.y=tParent.y;\r\n\t\t\tcpParent.scaleX=tParent.scaleX;\r\n\t\t\tcpParent.scaleY=tParent.scaleY;\r\n\t\t\tcpParent.rotation=tParent.rotation;\r\n\t\t\tcpParent.scrollRect=tParent.scrollRect;\r\n\t\t\tpreTar=cpParent;\r\n\t\t\ttParent=tParent.parent;\r\n\t\t}\r\n\t\tthis.rootContainer.removeChildren();\r\n\t\tthis.rootContainer.addChild(preTar);\r\n\t}\r\n\r\n\treturn DisEditor;\r\n})()\r\n\r\n\r\n/**\r\n*调试拾取显示对象类\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.DisplayHook\r\nvar DisplayHook=(function(){\r\n\tfunction DisplayHook(){\r\n\t\tthis.mouseX=NaN;\r\n\t\tthis.mouseY=NaN;\r\n\t\tthis._stage=null;\r\n\t\tthis._target=null;\r\n\t\tthis.isGetting=false;\r\n\t\tthis._matrix=new Matrix();\r\n\t\tthis._point=new Point();\r\n\t\tthis._rect=new Rectangle();\r\n\t\tthis._event=Event.EMPTY;\r\n\t\tthis._stage=Laya.stage;\r\n\t\tthis.init(Render.context.canvas);\r\n\t}\r\n\r\n\t__class(DisplayHook,'laya.debug.tools.DisplayHook');\r\n\tvar __proto=DisplayHook.prototype;\r\n\t__proto.init=function(canvas){\r\n\t\tvar _$this=this;\r\n\t\tif (Browser.window.navigator.msPointerEnabled){\r\n\t\t\tcanvas.style['-ms-content-zooming']='none';\r\n\t\t\tcanvas.style['-ms-touch-action']='none';\r\n\t\t};\r\n\t\tvar _this=this;\r\n\t\tBrowser.document.addEventListener('mousedown',function(e){\r\n\t\t\t_$this._event._stoped=false;\r\n\t\t\tDisplayHook.isFirst=true;\r\n\t\t\t_this.check(_this._stage,e.offsetX,e.offsetY,_this.onMouseDown,true,false);\r\n\t\t},true);\r\n\t\tBrowser.document.addEventListener('touchstart',function(e){\r\n\t\t\t_$this._event._stoped=false;\r\n\t\t\tDisplayHook.isFirst=true;\r\n\t\t\tvar touches=e.changedTouches;\r\n\t\t\tfor (var i=0,n=touches.length;i < n;i++){\r\n\t\t\t\tvar touch=touches[i];\r\n\t\t\t\tinitEvent(touch,e);\r\n\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseDown,true,false);\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tfunction initEvent (e,event){\r\n\t\t\t_this._event._stoped=false;\r\n\t\t\t_this._event.nativeEvent=event || e;\r\n\t\t\t_this._target=null;\r\n\t\t\tif (e.offsetX){\r\n\t\t\t\t_this.mouseX=e.offsetX;\r\n\t\t\t\t_this.mouseY=e.offsetY;\r\n\t\t\t\t}else {\r\n\t\t\t\t_this.mouseX=e.clientX-Laya.stage.offset.x;\r\n\t\t\t\t_this.mouseY=e.clientY-Laya.stage.offset.y;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onMouseMove=function(ele,hit){\r\n\t\tthis.sendEvent(ele,/*laya.events.Event.MOUSE_MOVE*/\"mousemove\");\r\n\t\treturn;\r\n\t\tif (hit && ele !=this._stage && ele!==this._target){\r\n\t\t\tif (this._target){\r\n\t\t\t\tif (this._target.$_MOUSEOVER){\r\n\t\t\t\t\tthis._target.$_MOUSEOVER=false;\r\n\t\t\t\t\tthis._target.event(/*laya.events.Event.MOUSE_OUT*/\"mouseout\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._target=ele;\r\n\t\t\tif (!ele.$_MOUSEOVER){\r\n\t\t\t\tele.$_MOUSEOVER=true;\r\n\t\t\t\tthis.sendEvent(ele,/*laya.events.Event.MOUSE_OVER*/\"mouseover\");\r\n\t\t\t}\r\n\t\t\t}else if (!hit && this._target && ele===this._target){\r\n\t\t\tthis._target=null;\r\n\t\t\tif (ele.$_MOUSEOVER){\r\n\t\t\t\tele.$_MOUSEOVER=false;\r\n\t\t\t\tthis.sendEvent(ele,/*laya.events.Event.MOUSE_OUT*/\"mouseout\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onMouseUp=function(ele,hit){\r\n\t\thit && this.sendEvent(ele,/*laya.events.Event.MOUSE_UP*/\"mouseup\");\r\n\t}\r\n\r\n\t__proto.onMouseDown=function(ele,hit){\r\n\t\tif (hit){\r\n\t\t\tele.$_MOUSEDOWN=true;\r\n\t\t\tthis.sendEvent(ele,/*laya.events.Event.MOUSE_DOWN*/\"mousedown\");\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.sendEvent=function(ele,type){\r\n\t\tif (!this._event._stoped){\r\n\t\t\tele.event(type,this._event.setTo(type,ele,ele));\r\n\t\t\tif (type===/*laya.events.Event.MOUSE_UP*/\"mouseup\" && ele.$_MOUSEDOWN){\r\n\t\t\t\tele.$_MOUSEDOWN=false;\r\n\t\t\t\tele.event(/*laya.events.Event.CLICK*/\"click\",this._event.setTo(/*laya.events.Event.CLICK*/\"click\",ele,ele));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.selectDisUnderMouse=function(){\r\n\t\tDisplayHook.isFirst=true;\r\n\t\tthis.check(Laya.stage,Laya.stage.mouseX,Laya.stage.mouseY,null,true,false);\r\n\t\tSelectInfosView.I.setSelectTarget(DebugTool.target);\r\n\t}\r\n\r\n\t__proto.getDisUnderMouse=function(){\r\n\t\tthis.isGetting=true;\r\n\t\tDisplayHook.isFirst=true;\r\n\t\tDebugTool.target=null;\r\n\t\tthis.check(Laya.stage,Laya.stage.mouseX,Laya.stage.mouseY,null,true,false);\r\n\t\tthis.isGetting=false;\r\n\t\treturn DebugTool.target;\r\n\t}\r\n\r\n\t__proto.check=function(sp,mouseX,mouseY,callBack,hitTest,mouseEnable){\r\n\t\tif (sp==DebugTool.debugLayer)return false;\r\n\t\tif (sp==DebugInfoLayer.I)return false;\r\n\t\tif (this.isGetting && sp==DebugInfoLayer.I)return false;\r\n\t\tif (!sp.visible || sp.getSelfBounds().width<=0)return false;\r\n\t\tvar isHit=false;\r\n\t\tmouseEnable=true\r\n\t\tif (mouseEnable){\r\n\t\t\tvar graphicHit=false;\r\n\t\t\tif (hitTest){\r\n\t\t\t\tthis._rect=sp.getBounds();\r\n\t\t\t\tisHit=this._rect.contains(mouseX,mouseY);\r\n\t\t\t\tthis._point.setTo(mouseX,mouseY);\r\n\t\t\t\tsp.fromParentPoint(this._point);\r\n\t\t\t\tmouseX=this._point.x;\r\n\t\t\t\tmouseY=this._point.y;\r\n\t\t\t}\r\n\t\t\tif (isHit){\r\n\t\t\t\tvar flag=false;\r\n\t\t\t\tfor (var i=sp._childs.length-1;i >-1;i--){\r\n\t\t\t\t\tvar child=sp._childs[i];\r\n\t\t\t\t\t(flag=this.check(child,mouseX,mouseY,callBack,hitTest,true));\r\n\t\t\t\t\tif (flag)break ;\r\n\t\t\t\t}\r\n\t\t\t\tgraphicHit=sp.getGraphicBounds().contains(mouseX,mouseY);\r\n\t\t\t\tisHit=flag||graphicHit;\r\n\t\t\t\tif(isHit&&!flag&&DisplayHook.isFirst){\r\n\t\t\t\t\tDisplayHook.isFirst=false;\r\n\t\t\t\t\tif(! ((sp instanceof laya.debug.tools.debugUI.DButton ))){\r\n\t\t\t\t\t\tDebugTool.target=sp;\r\n\t\t\t\t\t\tif (!this.isGetting){\r\n\t\t\t\t\t\t\tDebugTool.autoWork();\r\n\t\t\t\t\t\t\tNotice.notify(\"ItemClicked\",sp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isHit;\r\n\t}\r\n\r\n\tDisplayHook.initMe=function(){\r\n\t\tif(!DisplayHook.instance){\r\n\t\t\tDisplayHook.instance=new DisplayHook();\r\n\t\t}\r\n\t}\r\n\r\n\tDisplayHook.ITEM_CLICKED=\"ItemClicked\";\r\n\tDisplayHook.instance=null;\r\n\tDisplayHook.isFirst=false;\r\n\treturn DisplayHook;\r\n})()\r\n\r\n\r\n/**\r\n*简单的显示对象对象池\r\n*从父容器上移除时即被视为可被重用\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-11-13 下午8:05:13\r\n*/\r\n//class laya.debug.tools.DisPool\r\nvar DisPool=(function(){\r\n\tfunction DisPool(){}\r\n\t__class(DisPool,'laya.debug.tools.DisPool');\r\n\tDisPool.getDis=function(clz){\r\n\t\tvar clzName;\r\n\t\tclzName=ClassTool.getClassNameByClz(clz);\r\n\t\tif(!DisPool._objDic[clzName]){\r\n\t\t\tDisPool._objDic[clzName]=[];\r\n\t\t};\r\n\t\tvar disList;\r\n\t\tdisList=DisPool._objDic[clzName];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=disList.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(!disList[i].parent){\r\n\t\t\t\treturn disList[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisList.push(new clz());\r\n\t\treturn disList[disList.length-1];\r\n\t}\r\n\r\n\tDisPool._objDic={};\r\n\treturn DisPool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-28 上午10:39:47\r\n*/\r\n//class laya.debug.tools.DTrace\r\nvar DTrace=(function(){\r\n\tfunction DTrace(){}\r\n\t__class(DTrace,'laya.debug.tools.DTrace');\r\n\tDTrace.getArgArr=function(arg){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar i=0,len=arg.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(arg[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tDTrace.dTrace=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\targ=DTrace.getArgArr(arg);\r\n\t\targ.push(TraceTool.getCallLoc(2));\r\n\t\t/*__JS__ */console.log.apply(console,arg);\r\n\t\tvar str;\r\n\t\tstr=arg.join(\" \");\r\n\t}\r\n\r\n\tDTrace.timeStart=function(sign){\r\n\t\t/*__JS__ */console.time(sign);;\r\n\t}\r\n\r\n\tDTrace.timeEnd=function(sign){\r\n\t\t/*__JS__ */console.timeEnd(sign);;\r\n\t}\r\n\r\n\tDTrace.traceTable=function(data){\r\n\t\t/*__JS__ */console.table(data);;\r\n\t}\r\n\r\n\treturn DTrace;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.ClassCreateHook\r\nvar ClassCreateHook=(function(){\r\n\tfunction ClassCreateHook(){\r\n\t\tthis.createInfo={};\r\n\t}\r\n\r\n\t__class(ClassCreateHook,'laya.debug.tools.enginehook.ClassCreateHook');\r\n\tvar __proto=ClassCreateHook.prototype;\r\n\t__proto.hookClass=function(clz){\r\n\t\tvar _$this=this;\r\n\t\tif (ClassCreateHook.isInited)return;\r\n\t\tClassCreateHook.isInited=true;\r\n\t\tvar createFun=function (sp){\r\n\t\t\t_$this.classCreated(sp,clz);\r\n\t\t}\r\n\t\tFunHook.hook(clz,\"call\",createFun);\r\n\t}\r\n\r\n\t__proto.classCreated=function(clz,oClass){\r\n\t\tvar key;\r\n\t\tkey=ClassTool.getNodeClassAndName(clz);\r\n\t\tvar depth=0;\r\n\t\tvar tClz;\r\n\t\ttClz=clz;\r\n\t\twhile (tClz && tClz !=oClass){\r\n\t\t\ttClz=tClz.__super;\r\n\t\t\tdepth++;\r\n\t\t}\r\n\t\tif (!ClassCreateHook.I.createInfo[key]){\r\n\t\t\tClassCreateHook.I.createInfo[key]=0;\r\n\t\t}\r\n\t\tClassCreateHook.I.createInfo[key]=ClassCreateHook.I.createInfo[key]+1;\r\n\t\tRunProfile.run(key,depth+6);\r\n\t}\r\n\r\n\t__proto.getClassCreateInfo=function(clz){\r\n\t\tvar key;\r\n\t\tkey=ClassTool.getClassName(clz);\r\n\t\treturn RunProfile.getRunInfo(key);\r\n\t}\r\n\r\n\tClassCreateHook.isInited=false;\r\n\t__static(ClassCreateHook,\r\n\t['I',function(){return this.I=new ClassCreateHook();}\r\n\t]);\r\n\treturn ClassCreateHook;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.FunctionTimeHook\r\nvar FunctionTimeHook=(function(){\r\n\tfunction FunctionTimeHook(){}\r\n\t__class(FunctionTimeHook,'laya.debug.tools.enginehook.FunctionTimeHook');\r\n\tFunctionTimeHook.hookFun=function(obj,funName){\r\n\t\tif (!obj)return;\r\n\t\tif (obj.timeHooked)return;\r\n\t\tvar myKey;\r\n\t\tFunctionTimeHook.HookID++;\r\n\t\tmyKey=ClassTool.getNodeClassAndName(obj)+\".\"+funName+\"():\"+FunctionTimeHook.HookID;\r\n\t\tvar timePreFun=function (__args){\r\n\t\t\tvar args=arguments;\r\n\t\t\tFunctionTimeHook.funBegin(myKey);\r\n\t\t};\r\n\t\tvar timeEndFun=function (__args){\r\n\t\t\tvar args=arguments;\r\n\t\t\tFunctionTimeHook.funEnd(myKey);\r\n\t\t}\r\n\t\tobj.timeHooked=true;\r\n\t\tFunHook.hook(obj,funName,timePreFun,timeEndFun);\r\n\t}\r\n\r\n\tFunctionTimeHook.funBegin=function(funKey){\r\n\t\tFunctionTimeHook.funPre[funKey]=Browser.now();\r\n\t}\r\n\r\n\tFunctionTimeHook.funEnd=function(funKey){\r\n\t\tif (!FunctionTimeHook.funPre[funKey])FunctionTimeHook.funPre[funKey]=0;\r\n\t\tFunctionTimeHook.counter.add(funKey,Browser.now()-FunctionTimeHook.funPre[funKey]);\r\n\t}\r\n\r\n\tFunctionTimeHook.fresh=function(){\r\n\t\tFunctionTimeHook.funEnd(\"TotalSign\");\r\n\t\tFunctionTimeHook.counter.record();\r\n\t\tFunctionTimeHook.funBegin(\"TotalSign\");\r\n\t}\r\n\r\n\tFunctionTimeHook.HookID=1;\r\n\tFunctionTimeHook.funPre={};\r\n\tFunctionTimeHook.TotalSign=\"TotalSign\";\r\n\t__static(FunctionTimeHook,\r\n\t['counter',function(){return this.counter=new CountTool();}\r\n\t]);\r\n\treturn FunctionTimeHook;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.RenderSpriteHook\r\nvar RenderSpriteHook=(function(){\r\n\tfunction RenderSpriteHook(){\r\n\t\t/**@private */\r\n\t\t//this._next=null;\r\n\t\t/**@private */\r\n\t\t//this._fun=null;\r\n\t\t//this._oldCanvas=null;\r\n\t}\r\n\r\n\t__class(RenderSpriteHook,'laya.debug.tools.enginehook.RenderSpriteHook');\r\n\tvar __proto=RenderSpriteHook.prototype;\r\n\t__proto.createRenderSprite=function(type,next){\r\n\t\tvar rst;\r\n\t\trst=RenderSpriteHook._preCreateFun(type,next);\r\n\t\tif (type==/*laya.renders.RenderSprite.CANVAS*/0x10){\r\n\t\t\trst[\"_oldCanvas\"]=rst._fun;\r\n\t\t\trst._fun=RenderSpriteHook.I._canvas;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto._canvas=function(sprite,context,x,y){\r\n\t\tif (!SpriteRenderForVisibleAnalyse.allowRendering)return;\r\n\t\tvar _cacheCanvas=sprite._$P.cacheCanvas;\r\n\t\tvar _next=this._next;\r\n\t\tif (!_cacheCanvas||SpriteRenderForVisibleAnalyse.isVisibleTesting){\r\n\t\t\t_next._fun.call(_next,sprite,context,x,y);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar preTime;\r\n\t\tpreTime=Browser.now();\r\n\t\tvar tx=_cacheCanvas.ctx;\r\n\t\tvar _repaint=sprite._needRepaint()|| (!tx);\r\n\t\tthis._oldCanvas(sprite,context,x,y);\r\n\t\tif (Config.showCanvasMark){\r\n\t\t}\r\n\t\tif (_repaint){\r\n\t\t\tCacheAnalyser.I.reCacheCanvas(sprite,Browser.now()-preTime);\r\n\t\t\t}else{\r\n\t\t\tCacheAnalyser.I.renderCanvas(sprite,Browser.now()-preTime);\r\n\t\t}\r\n\t}\r\n\r\n\tRenderSpriteHook.init=function(){\r\n\t\tif (RenderSpriteHook.I)return;\r\n\t\tRenderSpriteHook.I=new RenderSpriteHook();\r\n\t\tRenderSpriteHook._preCreateFun=RunDriver.createRenderSprite;\r\n\t\tRunDriver.createRenderSprite=RenderSpriteHook.I.createRenderSprite;\r\n\t}\r\n\r\n\tRenderSpriteHook.IMAGE=0x01;\r\n\tRenderSpriteHook.FILTERS=0x02;\r\n\tRenderSpriteHook.ALPHA=0x04;\r\n\tRenderSpriteHook.TRANSFORM=0x08;\r\n\tRenderSpriteHook.CANVAS=0x10;\r\n\tRenderSpriteHook.BLEND=0x20;\r\n\tRenderSpriteHook.CLIP=0x40;\r\n\tRenderSpriteHook.STYLE=0x80;\r\n\tRenderSpriteHook.GRAPHICS=0x100;\r\n\tRenderSpriteHook.CUSTOM=0x200;\r\n\tRenderSpriteHook.ENABLERENDERMERGE=0x400;\r\n\tRenderSpriteHook.CHILDS=0x800;\r\n\tRenderSpriteHook.INIT=0x11111;\r\n\tRenderSpriteHook.renders=[];\r\n\tRenderSpriteHook.I=null;\r\n\tRenderSpriteHook._preCreateFun=null;\r\n\treturn RenderSpriteHook;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse\r\nvar SpriteRenderForVisibleAnalyse=(function(){\r\n\tfunction SpriteRenderForVisibleAnalyse(){\r\n\t\t/**@private */\r\n\t\tthis._repaint=1;\r\n\t\tthis._renderType=1;\r\n\t\tthis._x=0;\r\n\t\tthis._y=0;\r\n\t\tthis.target=null;\r\n\t\tthis.isTargetRenderd=false;\r\n\t\tthis.preFun=null;\r\n\t\tthis._next=null;\r\n\t\tthis.pgraphic=RenderSprite[\"prototype\"][\"_graphics\"];\r\n\t\tthis.pimage=RenderSprite[\"prototype\"][\"_image\"];\r\n\t\tthis.pimage2=RenderSprite[\"prototype\"][\"_image2\"];\r\n\t}\r\n\r\n\t__class(SpriteRenderForVisibleAnalyse,'laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse');\r\n\tvar __proto=SpriteRenderForVisibleAnalyse.prototype;\r\n\t__proto.setRenderHook=function(){\r\n\t\tSprite[\"prototype\"][\"render\"]=SpriteRenderForVisibleAnalyse.I.render;\r\n\t}\r\n\r\n\t/**\r\n\t*更新、呈现显示对象。\r\n\t*@param context 渲染的上下文引用。\r\n\t*@param x X轴坐标。\r\n\t*@param y Y轴坐标。\r\n\t*/\r\n\t__proto.render=function(context,x,y){\r\n\t\tvar me;\r\n\t\tme=this;\r\n\t\tif (DebugInfoLayer.I.isDebugItem(me))return;\r\n\t\tif (me==laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.target){\r\n\t\t\tlaya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering=true;\r\n\t\t\tlaya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.isTargetRenderd=true;\r\n\t\t\tCanvasTools.clearCanvas(SpriteRenderForVisibleAnalyse.mainCanvas);\r\n\t\t}\r\n\t\tRenderSprite.renders[this._renderType]._fun(this,context,x+this._x,y+this._y);\r\n\t\tif (me==laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.I.target){\r\n\t\t\tSpriteRenderForVisibleAnalyse.tarRec=CanvasTools.getCanvasDisRec(laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.mainCanvas);\r\n\t\t\tconsole.log(\"rec\",SpriteRenderForVisibleAnalyse.tarRec.toString());\r\n\t\t\tif (SpriteRenderForVisibleAnalyse.tarRec.width >0&& SpriteRenderForVisibleAnalyse.tarRec.height > 0){\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.isTarRecOK=true;\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.preImageData=CanvasTools.getImageDataFromCanvasByRec(SpriteRenderForVisibleAnalyse.mainCanvas,SpriteRenderForVisibleAnalyse.tarRec);\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.tarImageData=CanvasTools.getImageDataFromCanvasByRec(SpriteRenderForVisibleAnalyse.mainCanvas,SpriteRenderForVisibleAnalyse.tarRec);\r\n\t\t\t\t}else{\r\n\t\t\t\tconsole.log(\"tarRec Not OK:\",SpriteRenderForVisibleAnalyse.tarRec);\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t\tif (SpriteRenderForVisibleAnalyse.isTarRecOK){\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.tImageData=CanvasTools.getImageDataFromCanvasByRec(SpriteRenderForVisibleAnalyse.mainCanvas,SpriteRenderForVisibleAnalyse.tarRec);\r\n\t\t\t\tvar dRate=NaN;\r\n\t\t\t\tdRate=CanvasTools.getDifferRate(SpriteRenderForVisibleAnalyse.preImageData,SpriteRenderForVisibleAnalyse.tImageData);\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.preImageData=SpriteRenderForVisibleAnalyse.tImageData;\r\n\t\t\t\tif (dRate > 0){\r\n\t\t\t\t\tVisibleAnalyser.addCoverNode(me,dRate);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.analyseNode=function(node){\r\n\t\tVisibleAnalyser.resetCoverList();\r\n\t\tif (Sprite[\"prototype\"][\"render\"] !=SpriteRenderForVisibleAnalyse.I.render){\r\n\t\t\tthis.preFun=Sprite[\"prototype\"][\"render\"];\r\n\t\t}\r\n\t\tthis.target=node;\r\n\t\tSprite[\"prototype\"][\"render\"]=this.render;\r\n\t\tif (!SpriteRenderForVisibleAnalyse.tarCanvas)\r\n\t\t\tSpriteRenderForVisibleAnalyse.tarCanvas=CanvasTools.createCanvas(Laya.stage.width,Laya.stage.height);\r\n\t\tif (!SpriteRenderForVisibleAnalyse.mainCanvas)\r\n\t\t\tSpriteRenderForVisibleAnalyse.mainCanvas=CanvasTools.createCanvas(Laya.stage.width,Laya.stage.height);\r\n\t\tthis.isTargetRenderd=false;\r\n\t\tSpriteRenderForVisibleAnalyse.isVisibleTesting=true;\r\n\t\tSpriteRenderForVisibleAnalyse.allowRendering=false;\r\n\t\tCanvasTools.clearCanvas(SpriteRenderForVisibleAnalyse.mainCanvas);\r\n\t\tCanvasTools.clearCanvas(SpriteRenderForVisibleAnalyse.tarCanvas);\r\n\t\tSpriteRenderForVisibleAnalyse.isTarRecOK=false;\r\n\t\tvar ctx=new RenderContext(SpriteRenderForVisibleAnalyse.mainCanvas.width,SpriteRenderForVisibleAnalyse.mainCanvas.height,SpriteRenderForVisibleAnalyse.mainCanvas);\r\n\t\tSpriteRenderForVisibleAnalyse.mainCanvas=ctx.canvas;\r\n\t\tthis.render.call(Laya.stage,ctx,0,0);\r\n\t\tif (!SpriteRenderForVisibleAnalyse.isTarRecOK){\r\n\t\t\tSpriteRenderForVisibleAnalyse.coverRate=0;\r\n\t\t\t}else{\r\n\t\t\tSpriteRenderForVisibleAnalyse.coverRate=CanvasTools.getDifferRate(SpriteRenderForVisibleAnalyse.preImageData,SpriteRenderForVisibleAnalyse.tarImageData);\r\n\t\t}\r\n\t\tVisibleAnalyser.coverRate=SpriteRenderForVisibleAnalyse.coverRate;\r\n\t\tVisibleAnalyser.isTarRecOK=SpriteRenderForVisibleAnalyse.isTarRecOK;\r\n\t\tconsole.log(\"coverRate:\",SpriteRenderForVisibleAnalyse.coverRate);\r\n\t\tthis.isTargetRenderd=false;\r\n\t\tSpriteRenderForVisibleAnalyse.isVisibleTesting=false;\r\n\t\tSpriteRenderForVisibleAnalyse.allowRendering=true;\r\n\t\tSprite[\"prototype\"][\"render\"]=this.preFun;\r\n\t}\r\n\r\n\t__proto.noRenderMode=function(){\r\n\t\treturn;\r\n\t\tRenderSprite[\"prototype\"][\"_graphics\"]=this.m_graphics;\r\n\t\tRenderSprite[\"prototype\"][\"_image\"]=this.m_image;\r\n\t\tRenderSprite[\"prototype\"][\"_image2\"]=this.m_image2;\r\n\t}\r\n\r\n\t__proto.normalMode=function(){\r\n\t\tRenderSprite[\"prototype\"][\"_graphics\"]=this.pgraphic;\r\n\t\tRenderSprite[\"prototype\"][\"_image\"]=this.pimage;\r\n\t\tRenderSprite[\"prototype\"][\"_image2\"]=this.pimage2;\r\n\t}\r\n\r\n\t__proto.inits=function(){\r\n\t\tthis.noRenderMode();\r\n\t}\r\n\r\n\t__proto.m_graphics=function(sprite,context,x,y){\r\n\t\tif (laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){\r\n\t\t\tvar tf=sprite._style._tf;\r\n\t\t\tsprite._graphics && sprite._graphics._render(sprite,context,x-tf.translateX,y-tf.translateY);\r\n\t\t};\r\n\t\tvar next=this._next;\r\n\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t}\r\n\r\n\t__proto.m_image=function(sprite,context,x,y){\r\n\t\tif (laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){\r\n\t\t\tvar style=sprite._style;\r\n\t\t\tcontext.ctx.drawTexture2(x,y,style._tf.translateX,style._tf.translateY,sprite.transform,style.alpha,style.blendMode,sprite._graphics._one);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.m_image2=function(sprite,context,x,y){\r\n\t\tif (laya.debug.tools.enginehook.SpriteRenderForVisibleAnalyse.allowRendering){\r\n\t\t\tvar tf=sprite._style._tf;\r\n\t\t\tcontext.ctx.drawTexture2(x,y,tf.translateX,tf.translateY,sprite.transform,1,null,sprite._graphics._one);\r\n\t\t}\r\n\t}\r\n\r\n\tSpriteRenderForVisibleAnalyse.tarCanvas=null;\r\n\tSpriteRenderForVisibleAnalyse.mainCanvas=null;\r\n\tSpriteRenderForVisibleAnalyse.preImageData=null;\r\n\tSpriteRenderForVisibleAnalyse.tImageData=null;\r\n\tSpriteRenderForVisibleAnalyse.tarImageData=null;\r\n\tSpriteRenderForVisibleAnalyse.tarRec=null;\r\n\tSpriteRenderForVisibleAnalyse.isTarRecOK=false;\r\n\tSpriteRenderForVisibleAnalyse.isVisibleTesting=false;\r\n\tSpriteRenderForVisibleAnalyse.allowRendering=true;\r\n\tSpriteRenderForVisibleAnalyse.coverRate=NaN;\r\n\t__static(SpriteRenderForVisibleAnalyse,\r\n\t['I',function(){return this.I=new SpriteRenderForVisibleAnalyse();}\r\n\t]);\r\n\treturn SpriteRenderForVisibleAnalyse;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.SpriteRenderHook\r\nvar SpriteRenderHook=(function(){\r\n\tfunction SpriteRenderHook(){\r\n\t\t/**@private */\r\n\t\tthis._repaint=1;\r\n\t\tthis._renderType=1;\r\n\t\tthis._x=0;\r\n\t\tthis._y=0;\r\n\t}\r\n\r\n\t__class(SpriteRenderHook,'laya.debug.tools.enginehook.SpriteRenderHook');\r\n\tvar __proto=SpriteRenderHook.prototype;\r\n\t/**\r\n\t*更新、呈现显示对象。\r\n\t*@param context 渲染的上下文引用。\r\n\t*@param x X轴坐标。\r\n\t*@param y Y轴坐标。\r\n\t*/\r\n\t__proto.render=function(context,x,y){\r\n\t\tif ((this)==Laya.stage){\r\n\t\t\tCacheAnalyser.renderLoopBegin();\r\n\t\t};\r\n\t\tvar preTime=0;\r\n\t\tpreTime=Browser.now();\r\n\t\tStat.spriteCount++;\r\n\t\tif (this[\"ShowBorderSign\"]){\r\n\t\t\tDebugTool.showDisBoundToSprite(this,DebugInfoLayer.I.cacheViewLayer,DebugConsts.SPRITE_REC_COLOR,DebugConsts.SPRITE_REC_LINEWIDTH);\r\n\t\t}\r\n\t\tRenderSprite.renders[this._renderType]._fun(this,context,x+this._x,y+this._y);\r\n\t\tthis._repaint=0;\r\n\t\tRenderAnalyser.I.render(this,Browser.now()-preTime);\r\n\t}\r\n\r\n\tSpriteRenderHook.init=function(){\r\n\t\tif (SpriteRenderHook.I)return;\r\n\t\tSpriteRenderHook.I=new SpriteRenderHook();\r\n\t\tSpriteRenderHook.setRenderHook();\r\n\t}\r\n\r\n\tSpriteRenderHook.setRenderHook=function(){\r\n\t\tSprite[\"prototype\"][\"render\"]=SpriteRenderHook.I.render;\r\n\t}\r\n\r\n\tSpriteRenderHook.showDisplayBorder=function(sprite,ifShowBorder){\r\n\t\t(ifShowBorder===void 0)&& (ifShowBorder=true);\r\n\t\tsprite[\"ShowBorderSign\"]=ifShowBorder;\r\n\t}\r\n\r\n\tSpriteRenderHook.isDisplayShowBorder=function(sprite){\r\n\t\treturn sprite[\"ShowBorderSign\"];\r\n\t}\r\n\r\n\tSpriteRenderHook.I=null;\r\n\tSpriteRenderHook.ShowBorderSign=\"ShowBorderSign\";\r\n\treturn SpriteRenderHook;\r\n})()\r\n\r\n\r\n/**\r\n*本类调用原生observe接口，仅支持部分浏览器，chrome有效\r\n*变化输出为异步方式,所以无法跟踪到是什么函数导致变化\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-26 上午9:35:45\r\n*/\r\n//class laya.debug.tools.exp.Observer\r\nvar Observer=(function(){\r\n\tfunction Observer(){}\r\n\t__class(Observer,'laya.debug.tools.exp.Observer');\r\n\tObserver.observe=function(obj,callBack){\r\n\t\t/*__JS__ */Object.observe(obj,callBack);\r\n\t}\r\n\r\n\tObserver.unobserve=function(obj,callBack){\r\n\t\t/*__JS__ */Object.unobserve(obj,callBack);\r\n\t}\r\n\r\n\tObserver.observeDiffer=function(obj,sign,msg){\r\n\t\t(msg===void 0)&& (msg=\"obDiffer\");\r\n\t\tvar differFun=function (){\r\n\t\t\tDifferTool.differ(sign,obj,msg);\r\n\t\t}\r\n\t\tObserver.observe(obj,differFun);\r\n\t}\r\n\r\n\treturn Observer;\r\n})()\r\n\r\n\r\n/**\r\n*本类调用原生watch接口，仅火狐有效\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-26 上午9:48:18\r\n*/\r\n//class laya.debug.tools.exp.Watch\r\nvar Watch=(function(){\r\n\tfunction Watch(){}\r\n\t__class(Watch,'laya.debug.tools.exp.Watch');\r\n\tWatch.watch=function(obj,name,callBack){\r\n\t\t/*__JS__ */obj.watch(name,callBack);\r\n\t}\r\n\r\n\tWatch.unwatch=function(obj,name,callBack){\r\n\t\t/*__JS__ */obj.unwatch(name,callBack);\r\n\t}\r\n\r\n\treturn Watch;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-30 下午1:06:56\r\n*/\r\n//class laya.debug.tools.FilterTool\r\nvar FilterTool=(function(){\r\n\tfunction FilterTool(){}\r\n\t__class(FilterTool,'laya.debug.tools.FilterTool');\r\n\tFilterTool.getArrByFilter=function(arr,filterFun){\r\n\t\tvar i=0,len=arr.length;\r\n\t\tvar rst=[];\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(filterFun(arr[i]))rst.push(arr[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tFilterTool.getArr=function(arr,sign,value){\r\n\t\tvar i=0,len=arr.length;\r\n\t\tvar rst=[];\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(arr[i][sign]==value)rst.push(arr[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn FilterTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.GetSetProfile\r\nvar GetSetProfile=(function(){\r\n\tfunction GetSetProfile(){}\r\n\t__class(GetSetProfile,'laya.debug.tools.GetSetProfile');\r\n\tGetSetProfile.removeNoDisplayKeys=function(arr){\r\n\t\tvar i=0;\r\n\t\tfor (i=arr.length-1;i >=0;i--){\r\n\t\t\tif (GetSetProfile.noDisplayKeys[arr[i]]){\r\n\t\t\t\tarr.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.getClassCount=function(className){\r\n\t\treturn GetSetProfile.countDic[className];\r\n\t}\r\n\r\n\tGetSetProfile.addClassCount=function(className){\r\n\t\tif (!GetSetProfile.countDic[className]){\r\n\t\t\tGetSetProfile.countDic[className]=1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tGetSetProfile.countDic[className]=GetSetProfile.countDic[className]+1;\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.init=function(){\r\n\t\tif (GetSetProfile._inited)\r\n\t\t\treturn;\r\n\t\tGetSetProfile._inited=true;\r\n\t\tvar createFun=function (sp){\r\n\t\t\tGetSetProfile.classCreated(sp);\r\n\t\t}\r\n\t\tFunHook.hook(Node,\"call\",null,createFun);\r\n\t\tGetSetProfile.handlerO={};\r\n\t\tGetSetProfile.handlerO[\"get\"]=function (target,key,receiver){\r\n\t\t\tconsole.log(\"get\",target,key,receiver);\r\n\t\t\treturn /*__JS__ */Reflect.get(target,key,receiver);\r\n\t\t};\r\n\t\tGetSetProfile.handlerO[\"set\"]=function (target,key,value,receiver){\r\n\t\t\tconsole.log(\"set\",target,key,value,receiver);\r\n\t\t\treturn /*__JS__ */Reflect.set(target,key,value,receiver);\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.classCreated=function(obj,oClas){\r\n\t\tif (GetSetProfile.fromMe)\r\n\t\t\treturn;\r\n\t\tvar className;\r\n\t\tclassName=ClassTool.getClassName(obj);\r\n\t\tGetSetProfile.addClassCount(className);\r\n\t\tGetSetProfile.addClassCount(\"ALL\");\r\n\t\tIDTools.idObj(obj);\r\n\t\tvar classDes;\r\n\t\tclassDes=GetSetProfile.hookClassDic[className];\r\n\t\tif (!classDes){\r\n\t\t\tGetSetProfile.profileClass(obj[\"constructor\"]);\r\n\t\t\tclassDes=GetSetProfile.hookClassDic[className];\r\n\t\t\tif (!classDes)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tGetSetProfile.hookObj2(obj,classDes);\r\n\t}\r\n\r\n\tGetSetProfile.hookObj=function(obj,keys){\r\n\t\tvar handler=GetSetProfile.handlerO;\r\n\t\t/*__JS__ */new Proxy(obj,handler);\r\n\t}\r\n\r\n\tGetSetProfile.hookObj2=function(obj,keys){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tGetSetProfile.hookVar(obj,keys[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.profileClass=function(clz){\r\n\t\tvar className;\r\n\t\tclassName=ClassTool.getClassName(clz);\r\n\t\tGetSetProfile.fromMe=true;\r\n\t\tvar tO=new clz();\r\n\t\tGetSetProfile.fromMe=false;\r\n\t\tvar keys;\r\n\t\tkeys=ClassTool.getObjectDisplayAbleKeys(tO);\r\n\t\tkeys=ObjectTools.getNoSameArr(keys);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tvar tV;\r\n\t\tvar key;\r\n\t\tfor (i=len-1;i >=0;i--){\r\n\t\t\tkey=keys[i];\r\n\t\t\ttV=tO[key];\r\n\t\t\tif ((typeof tV=='function')){\r\n\t\t\t\tkeys.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlen=keys.length;\r\n\t\tGetSetProfile.removeNoDisplayKeys(keys);\r\n\t\tGetSetProfile.hookClassDic[className]=keys;\r\n\t}\r\n\r\n\tGetSetProfile.hookPrototype=function(tO,key){\r\n\t\tconsole.log(\"hook:\",key);\r\n\t\ttry {\r\n\t\t\tGetSetProfile.hookVar(tO,key);\r\n\t\t}\r\n\t\tcatch (e){\r\n\t\t\tconsole.log(\"fail\",key);\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.reportCall=function(obj,name,type){\r\n\t\tIDTools.idObj(obj);\r\n\t\tvar objID=0;\r\n\t\tobjID=IDTools.getObjID(obj);\r\n\t\tvar className;\r\n\t\tclassName=ClassTool.getClassName(obj);\r\n\t\tGetSetProfile.recordInfo(className,name,type,objID);\r\n\t\tGetSetProfile.recordInfo(\"ALL\",name,type,objID);\r\n\t}\r\n\r\n\tGetSetProfile.recordInfo=function(className,name,type,objID){\r\n\t\tvar propCallsDic;\r\n\t\tif (!GetSetProfile.infoDic[className]){\r\n\t\t\tGetSetProfile.infoDic[className]={};\r\n\t\t}\r\n\t\tpropCallsDic=GetSetProfile.infoDic[className];\r\n\t\tvar propCalls;\r\n\t\tif (!propCallsDic[name]){\r\n\t\t\tpropCallsDic[name]={};\r\n\t\t}\r\n\t\tpropCalls=propCallsDic[name];\r\n\t\tvar propCallO;\r\n\t\tif (!propCalls[type]){\r\n\t\t\tpropCalls[type]={};\r\n\t\t}\r\n\t\tpropCallO=propCalls[type];\r\n\t\tif (!propCallO[objID]){\r\n\t\t\tpropCallO[objID]=1;\r\n\t\t\tif (!propCallO[\"objCount\"]){\r\n\t\t\t\tpropCallO[\"objCount\"]=1;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpropCallO[\"objCount\"]=propCallO[\"objCount\"]+1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpropCallO[objID]=propCallO[objID]+1;\r\n\t\t}\r\n\t\tif (!propCallO[\"count\"]){\r\n\t\t\tpropCallO[\"count\"]=1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpropCallO[\"count\"]=propCallO[\"count\"]+1;\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.showInfo=function(){\r\n\t\tvar rstO;\r\n\t\trstO={};\r\n\t\tvar rstO1;\r\n\t\trstO1={};\r\n\t\tvar arr;\r\n\t\tarr=[];\r\n\t\tvar arr1;\r\n\t\tarr1=[];\r\n\t\tvar className;\r\n\t\tvar keyName;\r\n\t\tvar type;\r\n\t\tfor (className in GetSetProfile.infoDic){\r\n\t\t\tvar tClassO;\r\n\t\t\tvar tClassO1;\r\n\t\t\ttClassO=GetSetProfile.infoDic[className];\r\n\t\t\trstO[className]=tClassO1={};\r\n\t\t\tfor (keyName in tClassO){\r\n\t\t\t\tvar tKeyO;\r\n\t\t\t\tvar tKeyO1;\r\n\t\t\t\ttKeyO=tClassO[keyName];\r\n\t\t\t\ttClassO1[keyName]=tKeyO1={};\r\n\t\t\t\tfor(type in tKeyO){\r\n\t\t\t\t\tvar tDataO;\r\n\t\t\t\t\tvar tDataO1;\r\n\t\t\t\t\ttDataO=tKeyO[type];\r\n\t\t\t\t\ttDataO[\"rate\"]=tDataO[\"objCount\"] / GetSetProfile.getClassCount(className);\r\n\t\t\t\t\ttKeyO1[type]=tDataO[\"rate\"];\r\n\t\t\t\t\tvar tSKey;\r\n\t\t\t\t\ttSKey=className+\"_\"+keyName+\"_\"+type;\r\n\t\t\t\t\trstO1[tSKey]=tDataO[\"rate\"];\r\n\t\t\t\t\tif (className==\"ALL\"){\r\n\t\t\t\t\t\tif (type==\"get\"){\r\n\t\t\t\t\t\t\tarr.push([tSKey,tDataO[\"rate\"],tDataO[\"count\"]]);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tarr1.push([tSKey,tDataO[\"rate\"],tDataO[\"count\"]]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(GetSetProfile.infoDic);\r\n\t\tconsole.log(GetSetProfile.countDic);\r\n\t\tconsole.log(rstO);\r\n\t\tconsole.log(rstO1);\r\n\t\tconsole.log(\"nodeCount:\",GetSetProfile.getClassCount(\"ALL\"));\r\n\t\tconsole.log(\"sort by rate\");\r\n\t\tGetSetProfile.showStaticInfo(arr,arr1,\"1\");\r\n\t\tconsole.log(\"sort by count\");\r\n\t\tGetSetProfile.showStaticInfo(arr,arr1,\"2\");\r\n\t}\r\n\r\n\tGetSetProfile.showStaticInfo=function(arr,arr1,sortKey){\r\n\t\tconsole.log(\"get:\");\r\n\t\tGetSetProfile.showStaticArray(arr,sortKey);\r\n\t\tconsole.log(\"set:\");\r\n\t\tGetSetProfile.showStaticArray(arr1,sortKey);\r\n\t}\r\n\r\n\tGetSetProfile.showStaticArray=function(arr,sortKey){\r\n\t\t(sortKey===void 0)&& (sortKey=\"1\");\r\n\t\tarr.sort(MathUtil.sortByKey(sortKey,true,true));\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tvar tArr;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttArr=arr[i];\r\n\t\t\tconsole.log(tArr[0],Math.floor(tArr[1]*100),tArr[2]);\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile.hookVar=function(obj,name,setHook,getHook){\r\n\t\tif (!setHook)\r\n\t\t\tsetHook=[];\r\n\t\tif (!getHook)\r\n\t\t\tgetHook=[];\r\n\t\tvar preO=obj;\r\n\t\tvar preValue;\r\n\t\tvar newKey=\"___@\"+newKey;\r\n\t\tvar des;\r\n\t\tdes=ClassTool.getOwnPropertyDescriptor(obj,name);\r\n\t\tvar ndes={};\r\n\t\tvar mSet=function (value){\r\n\t\t\tpreValue=value;\r\n\t\t};\r\n\t\tvar mGet=function (){\r\n\t\t\treturn preValue;\r\n\t\t};\r\n\t\tvar mSet1=function (value){\r\n\t\t\tvar _t=/*__JS__ */this;\r\n\t\t\tGetSetProfile.reportCall(_t,name,\"set\");\r\n\t\t};\r\n\t\tvar mGet1=function (){\r\n\t\t\tvar _t=/*__JS__ */this;\r\n\t\t\tGetSetProfile.reportCall(_t,name,\"get\");\r\n\t\t\treturn preValue;\r\n\t\t}\r\n\t\tgetHook.push(mGet1);\r\n\t\tsetHook.push(mSet1);\r\n\t\twhile (!des && obj[\"__proto__\"]){\r\n\t\t\tobj=obj[\"__proto__\"];\r\n\t\t\tdes=ClassTool.getOwnPropertyDescriptor(obj,name);\r\n\t\t}\r\n\t\tif (des){\r\n\t\t\tndes.set=des.set ? des.set :mSet;\r\n\t\t\tndes.get=des.get ? des.get :mGet;\r\n\t\t\tif (!des.get){\r\n\t\t\t\tpreValue=preO[name];\r\n\t\t\t}\r\n\t\t\tndes.enumerable=des.enumerable;\r\n\t\t\tsetHook.push(ndes.set);\r\n\t\t\tgetHook.push(ndes.get);\r\n\t\t\tFunHook.hookFuns(ndes,\"set\",setHook);\r\n\t\t\tFunHook.hookFuns(ndes,\"get\",getHook,getHook.length-1);\r\n\t\t\tClassTool.defineProperty(preO,name,ndes);\r\n\t\t}\r\n\t\tif (!des){\r\n\t\t\tndes.set=mSet;\r\n\t\t\tndes.get=mGet;\r\n\t\t\tpreValue=preO[name];\r\n\t\t\tsetHook.push(ndes.set);\r\n\t\t\tgetHook.push(ndes.get);\r\n\t\t\tFunHook.hookFuns(ndes,\"set\",setHook);\r\n\t\t\tFunHook.hookFuns(ndes,\"get\",getHook,getHook.length-1);\r\n\t\t\tClassTool.defineProperty(preO,name,ndes);\r\n\t\t}\r\n\t}\r\n\r\n\tGetSetProfile._inited=false;\r\n\tGetSetProfile.handlerO=null;\r\n\tGetSetProfile.ALL=\"ALL\";\r\n\tGetSetProfile.countDic={};\r\n\tGetSetProfile.fromMe=false;\r\n\tGetSetProfile.hookClassDic={};\r\n\tGetSetProfile.infoDic={};\r\n\t__static(GetSetProfile,\r\n\t['noDisplayKeys',function(){return this.noDisplayKeys={\"conchModel\":true};}\r\n\t]);\r\n\treturn GetSetProfile;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于在对象的函数上挂钩子\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-23 下午1:13:13\r\n*/\r\n//class laya.debug.tools.hook.FunHook\r\nvar FunHook=(function(){\r\n\tfunction FunHook(){}\r\n\t__class(FunHook,'laya.debug.tools.hook.FunHook');\r\n\tFunHook.hook=function(obj,funName,preFun,aftFun){\r\n\t\tFunHook.hookFuns(obj,funName,[preFun,obj[funName],aftFun],1);\r\n\t}\r\n\r\n\tFunHook.hookAllFun=function(obj){\r\n\t\tvar key;\r\n\t\tvar arr;\r\n\t\tarr=ClassTool.getOwnPropertyNames(obj);\r\n\t\tfor(key in arr){\r\n\t\t\tkey=arr[key];\r\n\t\t\tif (FunHook.special[key])continue ;\r\n\t\t\tconsole.log(\"try hook:\",key);\r\n\t\t\tif((typeof (obj[key])=='function')){\r\n\t\t\t\tconsole.log(\"hook:\",key);\r\n\t\t\t\tFunHook.hookFuns(obj,key,[FunHook.getTraceMsg(\"call:\"+key),obj[key]],1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(obj[\"__proto__\"]){\r\n\t\t\tFunHook.hookAllFun(obj[\"__proto__\"]);\r\n\t\t\t}else{\r\n\t\t\tconsole.log(\"end:\",obj);\r\n\t\t}\r\n\t}\r\n\r\n\tFunHook.getTraceMsg=function(msg){\r\n\t\tvar rst;\r\n\t\trst=function (){\r\n\t\t\tconsole.log(msg);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tFunHook.hookFuns=function(obj,funName,funList,rstI){\r\n\t\t(rstI===void 0)&& (rstI=-1);\r\n\t\tvar _preFun=obj[funName];\r\n\t\tvar newFun;\r\n\t\tnewFun=function (__args){\r\n\t\t\tvar args=arguments;\r\n\t\t\tvar rst;\r\n\t\t\tvar i=0;\r\n\t\t\tvar len=0;\r\n\t\t\tlen=funList.length;\r\n\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\tif(!funList[i])continue ;\r\n\t\t\t\tif(i==rstI){\r\n\t\t\t\t\trst=funList[i].apply(this,args);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tfunList[i].apply(this,args);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn rst;\r\n\t\t};\r\n\t\tnewFun[\"pre\"]=_preFun;\r\n\t\tobj[funName]=newFun;\r\n\t}\r\n\r\n\tFunHook.removeHook=function(obj,funName){\r\n\t\tif(obj[funName].pre!=null){\r\n\t\t\tobj[funName]=obj[funName].pre;\r\n\t\t}\r\n\t}\r\n\r\n\tFunHook.debugHere=function(){\r\n\t\t/*__JS__ */debugger;;\r\n\t}\r\n\r\n\tFunHook.traceLoc=function(level,msg){\r\n\t\t(level===void 0)&& (level=0);\r\n\t\t(msg===void 0)&& (msg=\"\");\r\n\t\tconsole.log(msg,\"fun loc:\",TraceTool.getCallLoc(3+level));\r\n\t}\r\n\r\n\tFunHook.getLocFun=function(level,msg){\r\n\t\t(level===void 0)&& (level=0);\r\n\t\t(msg===void 0)&& (msg=\"\");\r\n\t\tlevel+=1;\r\n\t\tvar rst;\r\n\t\trst=function (){\r\n\t\t\tFunHook.traceLoc(level,msg);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__static(FunHook,\r\n\t['special',function(){return this.special={\r\n\t\t\t\"length\":true,\r\n\t\t\t\"name\":true,\r\n\t\t\t\"arguments\":true,\r\n\t\t\t\"caller\":true,\r\n\t\t\t\"prototype\":true,\r\n\t\t\t\"is\":true,\r\n\t\t\t\"isExtensible\":true,\r\n\t\t\t\"isFrozen\":true,\r\n\t\t\t\"isSealed\":true,\r\n\t\t\t\"preventExtensions\":true,\r\n\t\t\t\"seal\":true,\r\n\t\t\t\"unobserve\":true,\r\n\t\t\t\"apply\":true,\r\n\t\t\t\"call\":true,\r\n\t\t\t\"bind\":true,\r\n\t\t\t\"freeze\":true,\r\n\t\t\t\"unobserve\":true\r\n\t};}\r\n\r\n\t]);\r\n\treturn FunHook;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于监控对象 set get 函数的调用\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-23 下午2:52:48\r\n*/\r\n//class laya.debug.tools.hook.VarHook\r\nvar VarHook=(function(){\r\n\tfunction VarHook(){}\r\n\t__class(VarHook,'laya.debug.tools.hook.VarHook');\r\n\tVarHook.hookVar=function(obj,name,setHook,getHook){\r\n\t\tif(!setHook)setHook=[];\r\n\t\tif(!getHook)getHook=[];\r\n\t\tvar preO=obj;\r\n\t\tvar preValue=obj[name];\r\n\t\tvar des;\r\n\t\tdes=ClassTool.getOwnPropertyDescriptor(obj,name);\r\n\t\tvar ndes={};\r\n\t\tvar mSet=function (value){\r\n\t\t\tconsole.log(\"var hook set \"+name+\":\",value);\r\n\t\t\tpreValue=value;\r\n\t\t};\r\n\t\tvar mGet=function (){\r\n\t\t\tconsole.log(\"var hook get\"+name+\":\",preValue);\r\n\t\t\treturn preValue;\r\n\t\t}\r\n\t\tif(des){\r\n\t\t\tndes.set=mSet;\r\n\t\t\tndes.get=mGet;\r\n\t\t\tndes.enumerable=des.enumerable;\r\n\t\t\tsetHook.push(ndes.set);\r\n\t\t\tgetHook.push(ndes.get);\r\n\t\t\tFunHook.hookFuns(ndes,\"set\",setHook);\r\n\t\t\tFunHook.hookFuns(ndes,\"get\",getHook,getHook.length-1);\r\n\t\t\tClassTool.defineProperty(obj,name,ndes);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twhile(!des&&obj[\"__proto__\"]){\r\n\t\t\tobj=obj[\"__proto__\"];\r\n\t\t\tdes=ClassTool.getOwnPropertyDescriptor(obj,name);\r\n\t\t}\r\n\t\tif (des){\r\n\t\t\tndes.set=des.set?des.set:mSet;\r\n\t\t\tndes.get=des.get?des.get:mGet;\r\n\t\t\tndes.enumerable=des.enumerable;\r\n\t\t\tsetHook.push(ndes.set);\r\n\t\t\tgetHook.push(ndes.get);\r\n\t\t\tFunHook.hookFuns(ndes,\"set\",setHook);\r\n\t\t\tFunHook.hookFuns(ndes,\"get\",getHook,getHook.length-1);\r\n\t\t\tClassTool.defineProperty(preO,name,ndes);\r\n\t\t}\r\n\t\tif(!des){\r\n\t\t\tconsole.log(\"get des fail add directly\");\r\n\t\t\tndes.set=mSet;\r\n\t\t\tndes.get=mGet;\r\n\t\t\tsetHook.push(ndes.set);\r\n\t\t\tgetHook.push(ndes.get);\r\n\t\t\tFunHook.hookFuns(ndes,\"set\",setHook);\r\n\t\t\tFunHook.hookFuns(ndes,\"get\",getHook,getHook.length-1);\r\n\t\t\tClassTool.defineProperty(obj,name,ndes);\r\n\t\t}\r\n\t}\r\n\r\n\tVarHook.getLocFun=function(msg,level){\r\n\t\t(msg===void 0)&& (msg=\"\");\r\n\t\t(level===void 0)&& (level=0);\r\n\t\tlevel+=1;\r\n\t\tvar rst;\r\n\t\trst=function (){\r\n\t\t\tFunHook.traceLoc(level,msg);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn VarHook;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-29 上午9:45:33\r\n*/\r\n//class laya.debug.tools.IDTools\r\nvar IDTools=(function(){\r\n\tfunction IDTools(){\r\n\t\tthis.tID=1;\r\n\t}\r\n\r\n\t__class(IDTools,'laya.debug.tools.IDTools');\r\n\tvar __proto=IDTools.prototype;\r\n\t__proto.getID=function(){\r\n\t\treturn this.tID++;\r\n\t}\r\n\r\n\tIDTools.getAID=function(){\r\n\t\treturn IDTools._ID.getID();\r\n\t}\r\n\r\n\tIDTools.idObjE=function(obj,sign){\r\n\t\t(sign===void 0)&& (sign=\"default\");\r\n\t\tif (obj[\"_M_id_\"])return obj;\r\n\t\tif(!sign){\r\n\t\t\tsign=\"default\";\r\n\t\t}\r\n\t\tif(!IDTools._idDic[sign]){\r\n\t\t\tIDTools._idDic[sign]=new IDTools();\r\n\t\t}\r\n\t\tobj[\"_M_id_\"]=IDTools._idDic[sign].getAID();\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tIDTools.setObjID=function(obj,id){\r\n\t\tobj[\"_M_id_\"]=id;\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tIDTools.idObj=function(obj){\r\n\t\tif (obj[\"_M_id_\"])return obj;\r\n\t\tobj[\"_M_id_\"]=IDTools.getAID();\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tIDTools.getObjID=function(obj){\r\n\t\tif(!obj)return-1;\r\n\t\treturn obj[\"_M_id_\"];\r\n\t}\r\n\r\n\tIDTools.idSign=\"_M_id_\";\r\n\t__static(IDTools,\r\n\t['_ID',function(){return this._ID=new IDTools();},'_idDic',function(){return this._idDic={\"default\":new IDTools()};}\r\n\t]);\r\n\treturn IDTools;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-11-27 上午9:58:59\r\n*/\r\n//class laya.debug.tools.JsonTool\r\nvar JsonTool=(function(){\r\n\tfunction JsonTool(){}\r\n\t__class(JsonTool,'laya.debug.tools.JsonTool');\r\n\tJsonTool.getJsonString=function(obj,singleLine,split,depth,Width){\r\n\t\t(singleLine===void 0)&& (singleLine=true);\r\n\t\t(split===void 0)&& (split=\"\\n\");\r\n\t\t(depth===void 0)&& (depth=0);\r\n\t\t(Width===void 0)&& (Width=4);\r\n\t\tvar preStr=\"\";\r\n\t\tpreStr=JsonTool.getEmptyStr(depth*Width);\r\n\t\tvar rst;\r\n\t\tvar keyValues;\r\n\t\tkeyValues={};\r\n\t\tvar tKey;\r\n\t\tvar tValue;\r\n\t\tvar type;\r\n\t\tvar keys;\r\n\t\tkeys=[];\r\n\t\tfor(tKey in obj){\r\n\t\t\tkeys.push(tKey);\r\n\t\t\ttValue=obj[tKey];\r\n\t\t\tif(JsonTool.singleLineKey[tKey]){\r\n\t\t\t\tkeyValues[tKey]=JsonTool.getValueStr(tValue,true,split,depth+1,Width);\r\n\t\t\t\t}else{\r\n\t\t\t\tkeyValues[tKey]=JsonTool.getValueStr(tValue,singleLine,split,depth+1,Width);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tkeys.sort();\r\n\t\tkeys=keys.reverse();\r\n\t\tvar keyPreStr;\r\n\t\tkeyPreStr=JsonTool.getEmptyStr((depth+1)*Width);\r\n\t\tif(singleLine){\r\n\t\t\tsplit=\"\";\r\n\t\t\tpreStr=\"\";\r\n\t\t\tkeyPreStr=\"\";\r\n\t\t};\r\n\t\tvar keyValueStrArr;\r\n\t\tkeyValueStrArr=[];\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttKey=keys[i];\r\n\t\t\tkeyValueStrArr.push(keyPreStr+JsonTool.wrapValue(tKey)+\":\"+keyValues[tKey]);\r\n\t\t}\r\n\t\trst=\"{\"+split+keyValueStrArr.join(\",\"+split)+split+preStr+\"}\";\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tJsonTool.wrapValue=function(value,wraper){\r\n\t\t(wraper===void 0)&& (wraper=\"\\\"\");\r\n\t\treturn wraper+value+wraper;\r\n\t}\r\n\r\n\tJsonTool.getArrStr=function(arr,singleLine,split,depth,Width){\r\n\t\t(singleLine===void 0)&& (singleLine=true);\r\n\t\t(split===void 0)&& (split=\"\\n\");\r\n\t\t(depth===void 0)&& (depth=0);\r\n\t\t(Width===void 0)&& (Width=4);\r\n\t\tvar rst;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tvar valueStrArr;\r\n\t\tvalueStrArr=[];\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tvalueStrArr.push(JsonTool.getValueStr(arr[i],singleLine,split,depth+1,Width));\r\n\t\t};\r\n\t\tvar preStr=\"\";\r\n\t\tpreStr=JsonTool.getEmptyStr((depth+1)*Width);\r\n\t\tif(singleLine){\r\n\t\t\tsplit=\"\";\r\n\t\t\tpreStr=\"\";\r\n\t\t}\r\n\t\trst=\"[\"+split+preStr+valueStrArr.join(\",\"+split+preStr)+\"]\";\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tJsonTool.quote=function(string){\r\n\t\tJsonTool.escapable.lastIndex=0;\r\n\t\treturn JsonTool.escapable.test(string)? '\"'+string.replace(JsonTool.escapable,function(a){\r\n\t\t\tvar c=JsonTool.meta[a];\r\n\t\t\treturn typeof c==='string' ? c :\r\n\t\t\t'\\\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);\r\n\t\t})+'\"' :'\"'+string+'\"';\r\n\t}\r\n\r\n\tJsonTool.getValueStr=function(tValue,singleLine,split,depth,Width){\r\n\t\t(singleLine===void 0)&& (singleLine=true);\r\n\t\t(split===void 0)&& (split=\"\\n\");\r\n\t\t(depth===void 0)&& (depth=0);\r\n\t\t(Width===void 0)&& (Width=0);\r\n\t\tvar rst;\r\n\t\tif((typeof tValue=='string')){\r\n\t\t\trst=JsonTool.quote(tValue);\r\n\t\t\t}else if(tValue==null){\r\n\t\t\trst=\"null\";\r\n\t\t\t}else if((typeof tValue=='number')|| ((typeof tValue=='number')&& Math.floor(tValue)==tValue)|| (typeof tValue=='boolean')){\r\n\t\t\trst=tValue;\r\n\t\t\t}else if((tValue instanceof Array)){\r\n\t\t\trst=JsonTool.getArrStr(tValue,singleLine,split,depth,Width);\r\n\t\t\t}else if((typeof tValue=='object')){\r\n\t\t\trst=JsonTool.getJsonString(tValue,singleLine,split,depth,Width);\r\n\t\t\t}else{\r\n\t\t\trst=tValue;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tJsonTool.getEmptyStr=function(width){\r\n\t\tif(!JsonTool.emptyDic.hasOwnProperty(width)){\r\n\t\t\tvar i=0;\r\n\t\t\tvar len=0;\r\n\t\t\tlen=width;\r\n\t\t\tvar rst;\r\n\t\t\trst=\"\";\r\n\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\trst+=\" \";\r\n\t\t\t}\r\n\t\t\tJsonTool.emptyDic[width]=rst;\r\n\t\t}\r\n\t\treturn JsonTool.emptyDic[width];\r\n\t}\r\n\r\n\tJsonTool.emptyDic={};\r\n\t__static(JsonTool,\r\n\t['singleLineKey',function(){return this.singleLineKey={\r\n\t\t\t\"props\":true\r\n\t\t};},'escapable',function(){return this.escapable=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;},'meta',function(){return this.meta = {   \r\n\t\t'\\b':'\\\\b',\r\n\t\t'\\t':'\\\\t',\r\n\t\t'\\n':'\\\\n',\r\n\t\t'\\f':'\\\\f',\r\n\t\t'\\r':'\\\\r',\r\n\t\t'\"' :'\\\\\"',\r\n\t\t'\\\\':'\\\\\\\\'\r\n};}\r\n\r\n\r\n]);\r\nreturn JsonTool;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于操作html对象\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.JSTools\r\nvar JSTools=(function(){\r\n\tfunction JSTools(){}\r\n\t__class(JSTools,'laya.debug.tools.JSTools');\r\n\tJSTools.showToBody=function(el,x,y){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\tBrowser.document.body.appendChild(el);\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle.position=\"absolute\";\r\n\t\tstyle.top=y+\"px\";\r\n\t\tstyle.left=x+\"px\";\r\n\t}\r\n\r\n\tJSTools.showToParent=function(el,x,y,parent){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\tparent.appendChild(el);\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle.position=\"absolute\";\r\n\t\tstyle.top=y+\"px\";\r\n\t\tstyle.left=x+\"px\";\r\n\t}\r\n\r\n\tJSTools.addToBody=function(el){\r\n\t\tBrowser.document.body.appendChild(el);\r\n\t}\r\n\r\n\tJSTools.setPos=function(el,x,y){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle.top=y+\"px\";\r\n\t\tstyle.left=x+\"px\";\r\n\t}\r\n\r\n\tJSTools.setSize=function(el,width,height){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle.width=width+\"px\";\r\n\t\tstyle.height=height+\"px\";\r\n\t}\r\n\r\n\tJSTools.setTransform=function(el,mat){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle.transformOrigin=style.webkitTransformOrigin=style.msTransformOrigin=style.mozTransformOrigin=style.oTransformOrigin=\"0px 0px 0px\";\r\n\t\tstyle.transform=style.webkitTransform=style.msTransform=style.mozTransform=style.oTransform=\"matrix(\"+mat.toString()+\")\";\r\n\t}\r\n\r\n\tJSTools.noMouseEvent=function(el){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle[\"pointer-events\"]=\"none\";\r\n\t}\r\n\r\n\tJSTools.setMouseEnable=function(el,enable){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle[\"pointer-events\"]=enable?\"auto\":\"none\";\r\n\t}\r\n\r\n\tJSTools.setZIndex=function(el,zIndex){\r\n\t\tvar style;\r\n\t\tstyle=el.style;\r\n\t\tstyle[\"z-index\"]=zIndex;\r\n\t}\r\n\r\n\tJSTools.showAboveSprite=function(el,sprite,dx,dy){\r\n\t\t(dx===void 0)&& (dx=0);\r\n\t\t(dy===void 0)&& (dy=0);\r\n\t\tvar pos;\r\n\t\tpos=new Point();\r\n\t\tpos=sprite.localToGlobal(pos);\r\n\t\tpos.x+=dx;\r\n\t\tpos.y+=dy;\r\n\t\tpos.x+=Laya.stage.offset.x;\r\n\t\tpos.y+=Laya.stage.offset.y;\r\n\t\tJSTools.showToBody(el,pos.x,pos.y);\r\n\t}\r\n\r\n\tJSTools.removeElement=function(el){\r\n\t\tBrowser.removeElement(el);\r\n\t}\r\n\r\n\tJSTools.isElementInDom=function(el){\r\n\t\treturn el && el.parentNode;\r\n\t}\r\n\r\n\tJSTools.getImageSpriteByFile=function(file,width,height){\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tvar reader;\r\n\t\t/*__JS__ */reader=new FileReader();;\r\n\t\treader.readAsDataURL(file);\r\n\t\tvar sprite;\r\n\t\tsprite=new Sprite();\r\n\t\treader.onload=function (e){\r\n\t\t\tvar txt;\r\n\t\t\ttxt=new Texture();\r\n\t\t\ttxt.load(reader.result);\r\n\t\t\tsprite.graphics.drawTexture(txt,0,0,width,height);\r\n\t\t}\r\n\t\treturn sprite;\r\n\t}\r\n\r\n\tJSTools.getPixelRatio=function(){\r\n\t\tif (JSTools._pixelRatio > 0)return JSTools._pixelRatio;\r\n\t\tvar canvas=Browser.createElement(\"canvas\");\r\n\t\tvar context=canvas.getContext('2d');\r\n\t\tvar devicePixelRatio=Browser.window.devicePixelRatio || 1;\r\n\t\tvar backingStoreRatio=context.webkitBackingStorePixelRatio ||\r\n\t\tcontext.mozBackingStorePixelRatio ||\r\n\t\tcontext.msBackingStorePixelRatio ||\r\n\t\tcontext.oBackingStorePixelRatio ||\r\n\t\tcontext.backingStorePixelRatio || 1;\r\n\t\tvar ratio=devicePixelRatio / backingStoreRatio;\r\n\t\tconsole.log(\"pixelRatioc:\",ratio);\r\n\t\tJSTools._pixelRatio=ratio;\r\n\t\treturn ratio;\r\n\t}\r\n\r\n\tJSTools._pixelRatio=-1;\r\n\treturn JSTools;\r\n})()\r\n\r\n\r\n/**\r\n*布局工具类,目前只支持水平方向布局\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.layout.Layouter\r\nvar Layouter=(function(){\r\n\tfunction Layouter(){\r\n\t\t/**\r\n\t\t*布局用的数据，与布局方法有关\r\n\t\t*/\r\n\t\tthis.data=null;\r\n\t\t/**\r\n\t\t*布局涉及的对象\r\n\t\t*/\r\n\t\tthis._items=null;\r\n\t\t/**\r\n\t\t*布局用的函数\r\n\t\t*/\r\n\t\tthis.layoutFun=null;\r\n\t\t/**\r\n\t\t*布局起始x\r\n\t\t*/\r\n\t\tthis._sX=0;\r\n\t\t/**\r\n\t\t*布局宽\r\n\t\t*/\r\n\t\tthis._width=0;\r\n\t}\r\n\r\n\t__class(Layouter,'laya.debug.tools.layout.Layouter');\r\n\tvar __proto=Layouter.prototype;\r\n\t__proto.layout=function(){\r\n\t\tthis.layoutFun(this._width,this._items,this.data,this._sX);\r\n\t}\r\n\r\n\t/**\r\n\t*重新布局\r\n\t*\r\n\t*/\r\n\t__proto.changed=function(){\r\n\t\tLaya.timer.callLater(this,this.layout);\r\n\t}\r\n\r\n\t/**\r\n\t*根据当前的对象状态计算位置大小\r\n\t*\r\n\t*/\r\n\t__proto.calSize=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tvar tItem;\r\n\t\ttItem=this.items[0];\r\n\t\tthis._sX=tItem.x;\r\n\t\tvar maxX=NaN;\r\n\t\tmaxX=this._sX+tItem.width;\r\n\t\tlen=this.items.length;\r\n\t\tfor (i=1;i < len;i++){\r\n\t\t\ttItem=this.items[i];\r\n\t\t\tif (this._sX > tItem.x){\r\n\t\t\t\tthis._sX=tItem.x;\r\n\t\t\t}\r\n\t\t\tif (maxX < tItem.x+tItem.width){\r\n\t\t\t\tmaxX=tItem.x+tItem.width;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._width=maxX-this._sX;\r\n\t}\r\n\r\n\t__getset(0,__proto,'width',function(){\r\n\t\treturn this._width;\r\n\t\t},function(v){\r\n\t\tthis._width=v;\r\n\t\tthis.changed();\r\n\t});\r\n\r\n\t__getset(0,__proto,'x',function(){\r\n\t\treturn this._sX;\r\n\t\t},function(v){\r\n\t\tthis._sX=v;\r\n\t\tthis.changed();\r\n\t});\r\n\r\n\t__getset(0,__proto,'items',function(){\r\n\t\treturn this._items;\r\n\t\t},function(arr){\r\n\t\tthis._items=arr;\r\n\t\tthis.calSize();\r\n\t});\r\n\r\n\treturn Layouter;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.layout.LayoutFuns\r\nvar LayoutFuns=(function(){\r\n\tfunction LayoutFuns(){}\r\n\t__class(LayoutFuns,'laya.debug.tools.layout.LayoutFuns');\r\n\tLayoutFuns.sameWidth=function(totalWidth,items,data,sX){\r\n\t\t(sX===void 0)&& (sX=0);\r\n\t\tvar dWidth=0;\r\n\t\tif (data && data.dWidth)\r\n\t\t\tdWidth=data.dWidth;\r\n\t\tvar perWidth=NaN;\r\n\t\tperWidth=(totalWidth-(items.length-1)*dWidth)/ items.length;\r\n\t\tvar tItem;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tX=NaN;\r\n\t\ttX=sX;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\ttItem.x=tX;\r\n\t\t\ttItem.width=perWidth;\r\n\t\t\ttX+=dWidth+perWidth;\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.getSameWidthLayout=function(items,dWidth){\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tdata.dWidth=dWidth;\r\n\t\treturn LayoutFuns.getLayouter(items,data,laya.debug.tools.layout.LayoutFuns.sameWidth);\r\n\t}\r\n\r\n\tLayoutFuns.getLayouter=function(items,data,fun){\r\n\t\tvar layouter;\r\n\t\tlayouter=new Layouter();\r\n\t\tlayouter.items=items;\r\n\t\tlayouter.data=data;\r\n\t\tlayouter.layoutFun=fun;\r\n\t\treturn layouter;\r\n\t}\r\n\r\n\tLayoutFuns.sameDis=function(totalWidth,items,data,sX){\r\n\t\t(sX===void 0)&& (sX=0);\r\n\t\tvar dWidth=NaN;\r\n\t\tdWidth=totalWidth;\r\n\t\tvar tItem;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tLayoutFuns.prepareForLayoutWidth(totalWidth,items);\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\tdWidth-=tItem.width;\r\n\t\t}\r\n\t\tif (items.length > 1)\r\n\t\t\tdWidth=dWidth / (items.length-1);\r\n\t\tvar tX=NaN;\r\n\t\ttX=sX;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\ttItem.x=tX;\r\n\t\t\ttX+=dWidth+tItem.width;\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.getSameDisLayout=function(items,rateSame){\r\n\t\t(rateSame===void 0)&& (rateSame=false);\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tif (rateSame){\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tlen=items.length;\r\n\t\t\tvar tItem;\r\n\t\t\tvar totalWidth=NaN;\r\n\t\t\ttotalWidth=0;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttItem=items[i];\r\n\t\t\t\ttotalWidth+=tItem.width;\r\n\t\t\t}\r\n\t\t\ttotalWidth=tItem.x+tItem.width;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttItem=items[i];\r\n\t\t\t\tLayoutFuns.setItemRate(tItem,tItem.width / totalWidth);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn LayoutFuns.getLayouter(items,data,laya.debug.tools.layout.LayoutFuns.sameDis);\r\n\t}\r\n\r\n\tLayoutFuns.fullFill=function(totalWidth,items,data,sX){\r\n\t\t(sX===void 0)&& (sX=0);\r\n\t\tvar dL=0,dR=0;\r\n\t\tif (data){\r\n\t\t\tif (data.dL)\r\n\t\t\t\tdL=data.dL;\r\n\t\t\tif (data.dR)\r\n\t\t\t\tdR=data.dR;\r\n\t\t};\r\n\t\tvar item;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\titem=items[i];\r\n\t\t\titem.x=sX+dL;\r\n\t\t\titem.width=totalWidth-dL-dR;\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.getFullFillLayout=function(items,dL,dR){\r\n\t\t(dL===void 0)&& (dL=0);\r\n\t\t(dR===void 0)&& (dR=0);\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tdata.dL=dL;\r\n\t\tdata.dR=dR;\r\n\t\treturn LayoutFuns.getLayouter(items,data,laya.debug.tools.layout.LayoutFuns.fullFill);\r\n\t}\r\n\r\n\tLayoutFuns.fixPos=function(totalWidth,items,data,sX){\r\n\t\t(sX===void 0)&& (sX=0);\r\n\t\tvar dLen=0;\r\n\t\tvar poss=[];\r\n\t\tvar isRate=false;\r\n\t\tif (data){\r\n\t\t\tif (data.dLen)\r\n\t\t\t\tdLen=data.dLen;\r\n\t\t\tif (data.poss)\r\n\t\t\t\tposs=data.poss;\r\n\t\t\tif (data.isRate)\r\n\t\t\t\tisRate=data.isRate;\r\n\t\t};\r\n\t\tvar item;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=poss.length;\r\n\t\tvar tX=NaN;\r\n\t\ttX=sX;\r\n\t\tvar tValue=NaN;\r\n\t\tvar preItem;\r\n\t\tpreItem=null;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\titem=items[i];\r\n\t\t\ttValue=sX+poss[i];\r\n\t\t\tif (isRate){\r\n\t\t\t\ttValue=sX+poss[i] *totalWidth;\r\n\t\t\t}\r\n\t\t\titem.x=tValue;\r\n\t\t\tif (preItem){\r\n\t\t\t\tpreItem.width=item.x-dLen-preItem.x;\r\n\t\t\t}\r\n\t\t\tpreItem=item;\r\n\t\t};\r\n\t\tvar lastItem;\r\n\t\tlastItem=items[items.length-1];\r\n\t\tlastItem.width=sX+totalWidth-dLen-lastItem.x;\r\n\t}\r\n\r\n\tLayoutFuns.getFixPos=function(items,dLen,isRate,poss){\r\n\t\t(dLen===void 0)&& (dLen=0);\r\n\t\t(isRate===void 0)&& (isRate=false);\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tvar layout;\r\n\t\tlayout=LayoutFuns.getLayouter(items,data,LayoutFuns.fixPos);\r\n\t\tvar i=0,len=0;\r\n\t\tvar sX=NaN;\r\n\t\tvar totalWidth=NaN;\r\n\t\tsX=layout.x;\r\n\t\ttotalWidth=layout.width;\r\n\t\tif (!poss){\r\n\t\t\tposs=[];\r\n\t\t\tlen=items.length;\r\n\t\t\tvar tValue=NaN;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttValue=items[i].x-sX;\r\n\t\t\t\tif (isRate){\r\n\t\t\t\t\ttValue=tValue / totalWidth;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t}\r\n\t\t\t\tposs.push(tValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.dLen=dLen;\r\n\t\tdata.poss=poss;\r\n\t\tdata.isRate=isRate;\r\n\t\treturn layout;\r\n\t}\r\n\r\n\tLayoutFuns.clearItemsRelativeInfo=function(items){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tLayoutFuns.clearItemRelativeInfo(items[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.clearItemRelativeInfo=function(item){\r\n\t\tvar Nan=\"NaN\";\r\n\t\titem.getLayout().left=Nan;\r\n\t\titem.getLayout().right=Nan;\r\n\t}\r\n\r\n\tLayoutFuns.prepareForLayoutWidth=function(totalWidth,items){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tLayoutFuns.prepareItemForLayoutWidth(totalWidth,items[i]);\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.getSumWidth=function(items){\r\n\t\tvar sum=NaN;\r\n\t\tsum=0;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tsum+=items[i].width;\r\n\t\t}\r\n\t\treturn sum;\r\n\t}\r\n\r\n\tLayoutFuns.prepareItemForLayoutWidth=function(totalWidth,item){\r\n\t\tif (LayoutFuns.getItemRate(item)> 0){\r\n\t\t\titem.width=totalWidth *LayoutFuns.getItemRate(item);\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.setItemRate=function(item,rate){\r\n\t\titem[\"layoutRate\"]=rate;\r\n\t}\r\n\r\n\tLayoutFuns.getItemRate=function(item){\r\n\t\treturn item[\"layoutRate\"] ? item[\"layoutRate\"] :-1;\r\n\t}\r\n\r\n\tLayoutFuns.setItemFreeSize=function(item,free){\r\n\t\t(free===void 0)&& (free=true);\r\n\t\titem[\"layoutFreeSize\"]=free;\r\n\t}\r\n\r\n\tLayoutFuns.isItemFreeSize=function(item){\r\n\t\treturn item[\"layoutFreeSize\"];\r\n\t}\r\n\r\n\tLayoutFuns.lockedDis=function(totalWidth,items,data,sX){\r\n\t\t(sX===void 0)&& (sX=0);\r\n\t\tvar dists;\r\n\t\tdists=data.dists;\r\n\t\tvar sumDis=NaN;\r\n\t\tsumDis=data.sumDis;\r\n\t\tvar sumWidth=NaN;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tItem;\r\n\t\tvar preItem;\r\n\t\tLayoutFuns.prepareForLayoutWidth(totalWidth,items);\r\n\t\tsumWidth=LayoutFuns.getSumWidth(items);\r\n\t\tvar dWidth=NaN;\r\n\t\tdWidth=totalWidth-sumDis-sumWidth;\r\n\t\tvar freeItem;\r\n\t\tfreeItem=LayoutFuns.getFreeItem(items);\r\n\t\tif(freeItem){\r\n\t\t\tfreeItem.width+=dWidth;\r\n\t\t}\r\n\t\tpreItem=items[0];\r\n\t\tpreItem.x=sX;\r\n\t\tlen=items.length;\r\n\t\tfor(i=1;i<len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\ttItem.x=preItem.x+preItem.width+dists[i-1];\r\n\t\t\tpreItem=tItem;\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutFuns.getFreeItem=function(items){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif(LayoutFuns.isItemFreeSize(items[i])){\r\n\t\t\t\treturn items[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tLayoutFuns.getLockedDis=function(items){\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tvar dists;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tItem;\r\n\t\tvar preItem;\r\n\t\tvar sumDis=NaN;\r\n\t\tsumDis=0;\r\n\t\tvar tDis=NaN;\r\n\t\tpreItem=items[0];\r\n\t\tdists=[];\r\n\t\tlen=items.length;\r\n\t\tfor(i=1;i<len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\ttDis=tItem.x-preItem.x-preItem.width;\r\n\t\t\tdists.push(tDis);\r\n\t\t\tsumDis+=tDis;\r\n\t\t\tpreItem=tItem;\r\n\t\t}\r\n\t\tdata.dists=dists;\r\n\t\tdata.sumDis=sumDis;\r\n\t\treturn LayoutFuns.getLayouter(items,data,laya.debug.tools.layout.LayoutFuns.lockedDis);\r\n\t}\r\n\r\n\tLayoutFuns.RateSign=\"layoutRate\";\r\n\tLayoutFuns.FreeSizeSign=\"layoutFreeSize\";\r\n\treturn LayoutFuns;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-11-9 下午3:26:01\r\n*/\r\n//class laya.debug.tools.LayoutTools\r\nvar LayoutTools=(function(){\r\n\tfunction LayoutTools(){}\r\n\t__class(LayoutTools,'laya.debug.tools.LayoutTools');\r\n\tLayoutTools.layoutToXCount=function(items,xCount,dx,dY,sx,sy){\r\n\t\t(xCount===void 0)&& (xCount=1);\r\n\t\t(dx===void 0)&& (dx=0);\r\n\t\t(dY===void 0)&& (dY=0);\r\n\t\t(sx===void 0)&& (sx=0);\r\n\t\t(sy===void 0)&& (sy=0);\r\n\t\tvar tX=NaN,tY=NaN;\r\n\t\tvar tItem;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tCount=0;\r\n\t\tvar maxHeight=0;\r\n\t\ttCount=0;\r\n\t\tmaxHeight=0;\r\n\t\ttX=sx;\r\n\t\ttY=sy;\r\n\t\tlen=items.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\ttItem.x=tX;\r\n\t\t\ttItem.y=tY;\r\n\t\t\tif (tItem.height > maxHeight){\r\n\t\t\t\tmaxHeight=tItem.height;\r\n\t\t\t}\r\n\t\t\ttCount++;\r\n\t\t\tif (tCount >=xCount){\r\n\t\t\t\ttCount=tCount % xCount;\r\n\t\t\t\ttItem.y+=maxHeight+dY;\r\n\t\t\t\tmaxHeight=0;\r\n\t\t\t\t}else{\r\n\t\t\t\ttX+=tItem.width+dx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLayoutTools.layoutToWidth=function(items,width,dX,dY,sx,sy){\r\n\t\tvar tX=NaN,tY=NaN;\r\n\t\tvar tItem;\r\n\t\tvar i=0,len=0;\r\n\t\ttX=sx;\r\n\t\ttY=sy;\r\n\t\tlen=items.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttItem=items[i];\r\n\t\t\tif(tX+tItem.width+dX>width){\r\n\t\t\t\ttX=sx;\r\n\t\t\t\ttY+=dY+tItem.height;\r\n\t\t\t\t}else{\r\n\t\t\t}\r\n\t\t\ttItem.x=tX;\r\n\t\t\ttItem.y=tY;\r\n\t\t\ttX+=dX+tItem.width;\r\n\t\t}\r\n\t}\r\n\r\n\treturn LayoutTools;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.MathTools\r\nvar MathTools=(function(){\r\n\tfunction MathTools(){}\r\n\t__class(MathTools,'laya.debug.tools.MathTools');\r\n\tMathTools.sortBigFirst=function(a,b){\r\n\t\tif (a==b)\r\n\t\t\treturn 0;\r\n\t\treturn b > a ? 1 :-1;\r\n\t}\r\n\r\n\tMathTools.sortSmallFirst=function(a,b){\r\n\t\tif (a==b)\r\n\t\t\treturn 0;\r\n\t\treturn b > a ?-1 :1;\r\n\t}\r\n\r\n\tMathTools.sortNumBigFirst=function(a,b){\r\n\t\treturn parseFloat(b)-parseFloat(a);\r\n\t}\r\n\r\n\tMathTools.sortNumSmallFirst=function(a,b){\r\n\t\treturn parseFloat(a)-parseFloat(b);\r\n\t}\r\n\r\n\tMathTools.sortByKey=function(key,bigFirst,forceNum){\r\n\t\t(bigFirst===void 0)&& (bigFirst=false);\r\n\t\t(forceNum===void 0)&& (forceNum=true);\r\n\t\tvar _sortFun;\r\n\t\tif (bigFirst){\r\n\t\t\t_sortFun=forceNum ? MathTools.sortNumBigFirst :MathTools.sortBigFirst;\r\n\t\t\t}else {\r\n\t\t\t_sortFun=forceNum ? MathTools.sortNumSmallFirst :MathTools.sortSmallFirst;\r\n\t\t}\r\n\t\treturn function (a,b){\r\n\t\t\treturn _sortFun(a[key],b[key]);\r\n\t\t};\r\n\t}\r\n\r\n\treturn MathTools;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.MouseEventAnalyser\r\nvar MouseEventAnalyser=(function(){\r\n\tfunction MouseEventAnalyser(){}\r\n\t__class(MouseEventAnalyser,'laya.debug.tools.MouseEventAnalyser');\r\n\tMouseEventAnalyser.analyseNode=function(node){\r\n\t\tDebugTool.showDisBound(node,true);\r\n\t\tvar _node;\r\n\t\t_node=node;\r\n\t\tObjectTools.clearObj(MouseEventAnalyser.infoO);\r\n\t\tObjectTools.clearObj(MouseEventAnalyser.nodeO);\r\n\t\tObjectTools.clearObj(MouseEventAnalyser.hitO);\r\n\t\tvar nodeList;\r\n\t\tnodeList=[];\r\n\t\twhile (node){\r\n\t\t\tIDTools.idObj(node);\r\n\t\t\tMouseEventAnalyser.nodeO[IDTools.getObjID(node)]=node;\r\n\t\t\tnodeList.push(node);\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t\tMouseEventAnalyser.check(Laya.stage,Laya.stage.mouseX,Laya.stage.mouseY,null);\r\n\t\tvar canStr;\r\n\t\tif (MouseEventAnalyser.hitO[IDTools.getObjID(_node)]){\r\n\t\t\tconsole.log(\"can hit\");\r\n\t\t\tcanStr=\"can hit\";\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconsole.log(\"can't hit\");\r\n\t\t\tcanStr=\"can't hit\";\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tnodeList=nodeList.reverse();\r\n\t\tlen=nodeList.length;\r\n\t\tvar rstTxts;\r\n\t\trstTxts=[\"[分析对象]:\"+ClassTool.getNodeClassAndName(_node)+\":\"+canStr];\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tnode=nodeList[i];\r\n\t\t\tif (MouseEventAnalyser.hitO[IDTools.getObjID(node)]){\r\n\t\t\t\tconsole.log(\"can hit:\",ClassTool.getNodeClassAndName(node));\r\n\t\t\t\tconsole.log(\"原因:\",MouseEventAnalyser.infoO[IDTools.getObjID(node)]);\r\n\t\t\t\trstTxts.push(\"can hit:\"+\" \"+ClassTool.getNodeClassAndName(node));\r\n\t\t\t\trstTxts.push(\"原因:\"+\" \"+MouseEventAnalyser.infoO[IDTools.getObjID(node)]);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tconsole.log(\"can't hit:\"+ClassTool.getNodeClassAndName(node));\r\n\t\t\t\tconsole.log(\"原因:\",MouseEventAnalyser.infoO[IDTools.getObjID(node)] ? MouseEventAnalyser.infoO[IDTools.getObjID(node)] :\"鼠标事件在父级已停止派发\");\r\n\t\t\t\trstTxts.push(\"can't hit:\"+\" \"+ClassTool.getNodeClassAndName(node));\r\n\t\t\t\trstTxts.push(\"原因:\"+\" \"+(MouseEventAnalyser.infoO[IDTools.getObjID(node)] ? MouseEventAnalyser.infoO[IDTools.getObjID(node)] :\"鼠标事件在父级已停止派发\"));\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar rstStr;\r\n\t\trstStr=rstTxts.join(\"\\n\");\r\n\t\tToolPanel.I.showTxtInfo(rstStr);\r\n\t}\r\n\r\n\tMouseEventAnalyser.check=function(sp,mouseX,mouseY,callBack){\r\n\t\tIDTools.idObj(sp);\r\n\t\tvar isInAnlyseChain=false;\r\n\t\tisInAnlyseChain=MouseEventAnalyser.nodeO[IDTools.getObjID(sp)];\r\n\t\tMouseEventAnalyser._point.setTo(mouseX,mouseY);\r\n\t\tsp.fromParentPoint(MouseEventAnalyser._point);\r\n\t\tmouseX=MouseEventAnalyser._point.x;\r\n\t\tmouseY=MouseEventAnalyser._point.y;\r\n\t\tvar scrollRect=sp.scrollRect;\r\n\t\tif (scrollRect){\r\n\t\t\tMouseEventAnalyser._rect.setTo(scrollRect.x,scrollRect.y,scrollRect.width,scrollRect.height);\r\n\t\t\tvar isHit=MouseEventAnalyser._rect.contains(mouseX,mouseY);\r\n\t\t\tif (!isHit){\r\n\t\t\t\tif (isInAnlyseChain){\r\n\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"scrollRect没有包含鼠标\"+MouseEventAnalyser._rect.toString()+\":\"+mouseX+\",\"+mouseY;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=sp._childs;\r\n\t\tlen=cList.length;\r\n\t\tvar child;\r\n\t\tvar childInChain;\r\n\t\tchildInChain=null;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tchild=cList[i];\r\n\t\t\tIDTools.idObj(child);\r\n\t\t\tif (MouseEventAnalyser.nodeO[IDTools.getObjID(child)]){\r\n\t\t\t\tchildInChain=child;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar coverByOthers=false;\r\n\t\tcoverByOthers=childInChain ? true :false;\r\n\t\tvar flag=false;\r\n\t\tif (sp.hitTestPrior && !sp.mouseThrough && !MouseEventAnalyser.hitTest(sp,mouseX,mouseY)){\r\n\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"hitTestPrior=true，宽高区域不包含鼠标:\"+\":\"+mouseX+\",\"+mouseY+\" size:\"+sp.width+\",\"+sp.height;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor (i=sp._childs.length-1;i >-1;i--){\r\n\t\t\tchild=sp._childs[i];\r\n\t\t\tif (child==childInChain){\r\n\t\t\t\tif (!childInChain.mouseEnabled){\r\n\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(childInChain)]=\"mouseEnabled=false\";\r\n\t\t\t\t}\r\n\t\t\t\tif (!childInChain.visible){\r\n\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(childInChain)]=\"visible=false\";\r\n\t\t\t\t}\r\n\t\t\t\tcoverByOthers=false;\r\n\t\t\t}\r\n\t\t\tif (child.mouseEnabled && child.visible){\r\n\t\t\t\tflag=MouseEventAnalyser.check(child,mouseX ,mouseY,callBack);\r\n\t\t\t\tif (flag){\r\n\t\t\t\t\tMouseEventAnalyser.hitO[IDTools.getObjID(sp)]=true;\r\n\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"子对象被击中\";\r\n\t\t\t\t\tif (child==childInChain){\r\n\t\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"子对象被击中,\"+\"击中对象在分析链中\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"子对象被击中,\"+\"击中对象不在分析链中\";\r\n\t\t\t\t\t\tif (coverByOthers){\r\n\t\t\t\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(childInChain)]=\"被兄弟节点挡住,兄弟节点信息:\"+ClassTool.getNodeClassAndName(child)+\",\"+child.getBounds().toString();\r\n\t\t\t\t\t\t\tDebugTool.showDisBound(child,false,\"#ffff00\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tif (child==childInChain){\r\n\t\t\t\t\t\tcoverByOthers=false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar mHitRect=new Rectangle();\r\n\t\tvar graphicHit=false;\r\n\t\tgraphicHit=sp.getGraphicBounds().contains(mouseX,mouseY);\r\n\t\tif (sp.width > 0 && sp.height > 0){\r\n\t\t\tvar hitRect=MouseEventAnalyser._rect;\r\n\t\t\tif (!sp.mouseThrough){\r\n\t\t\t\tif (sp.hitArea)\r\n\t\t\t\t\thitRect=sp.hitArea;\r\n\t\t\t\telse\r\n\t\t\t\thitRect.setTo(0,0,sp.width,sp.height);\r\n\t\t\t\tmHitRect.copyFrom(hitRect);\r\n\t\t\t\tisHit=hitRect.contains(mouseX,mouseY);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tisHit=graphicHit;\r\n\t\t\t\tmHitRect.copyFrom(sp.getGraphicBounds());\r\n\t\t\t}\r\n\t\t\tif (isHit){\r\n\t\t\t\tMouseEventAnalyser.hitO[IDTools.getObjID(sp)]=true;\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t}\r\n\t\tif (!isHit){\r\n\t\t\tif (graphicHit){\r\n\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"子对象未包含鼠标，实际绘图区域包含鼠标，设置的宽高区域不包含鼠标:\"+\":\"+mouseX+\",\"+mouseY+\" hitRec:\"+mHitRect.toString()+\" graphicBounds:\"+sp.getGraphicBounds().toString()+\"，设置mouseThrough=true或将宽高设置到实际绘图区域可解决问题\";\r\n\t\t\t\t}else{\r\n\t\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"子对象未包含鼠标，实际绘图区域不包含鼠标，设置的宽高区域不包含鼠标:\"+\":\"+mouseX+\",\"+mouseY+\" hitRec:\"+mHitRect.toString()+\" graphicBounds:\"+sp.getGraphicBounds().toString();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tMouseEventAnalyser.infoO[IDTools.getObjID(sp)]=\"自身区域被击中\";\r\n\t\t}\r\n\t\treturn isHit;\r\n\t}\r\n\r\n\tMouseEventAnalyser.hitTest=function(sp,mouseX,mouseY){\r\n\t\tvar isHit=false;\r\n\t\tif ((sp.hitArea instanceof laya.utils.HitArea )){\r\n\t\t\treturn sp.hitArea.isHit(mouseX,mouseY);\r\n\t\t}\r\n\t\tif (sp.width > 0 && sp.height > 0 || sp.mouseThrough || sp.hitArea){\r\n\t\t\tvar hitRect=MouseEventAnalyser._rect;\r\n\t\t\tif (!sp.mouseThrough){\r\n\t\t\t\tif (sp.hitArea)hitRect=sp.hitArea;\r\n\t\t\t\telse hitRect.setTo(0,0,sp.width,sp.height);\r\n\t\t\t\tisHit=hitRect.contains(mouseX,mouseY);\r\n\t\t\t\t}else {\r\n\t\t\t\tisHit=sp.getGraphicBounds().contains(mouseX,mouseY);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isHit;\r\n\t}\r\n\r\n\tMouseEventAnalyser.infoO={};\r\n\tMouseEventAnalyser.nodeO={};\r\n\tMouseEventAnalyser.hitO={};\r\n\t__static(MouseEventAnalyser,\r\n\t['_matrix',function(){return this._matrix=new Matrix();},'_point',function(){return this._point=new Point();},'_rect',function(){return this._rect=new Rectangle();}\r\n\t]);\r\n\treturn MouseEventAnalyser;\r\n})()\r\n\r\n\r\n/**\r\n*本类提供obj相关的一些操作\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-21 下午2:03:36\r\n*/\r\n//class laya.debug.tools.ObjectTools\r\nvar ObjectTools=(function(){\r\n\tfunction ObjectTools(){}\r\n\t__class(ObjectTools,'laya.debug.tools.ObjectTools');\r\n\tObjectTools.getFlatKey=function(tKey,aKey){\r\n\t\tif(tKey==\"\")return aKey;\r\n\t\treturn tKey+ObjectTools.sign+aKey;\r\n\t}\r\n\r\n\tObjectTools.flatObj=function(obj,rst,tKey){\r\n\t\t(tKey===void 0)&& (tKey=\"\");\r\n\t\trst=rst?rst:{};\r\n\t\tvar key;\r\n\t\tvar tValue;\r\n\t\tfor(key in obj){\r\n\t\t\tif((typeof (obj[key])=='object')){\r\n\t\t\t\tObjectTools.flatObj(obj[key],rst,ObjectTools.getFlatKey(tKey,key));\r\n\t\t\t\t}else{\r\n\t\t\t\ttValue=obj[key];\r\n\t\t\t\trst[ObjectTools.getFlatKey(tKey,key)]=obj[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.recoverObj=function(obj){\r\n\t\tvar rst={};\r\n\t\tvar tKey;\r\n\t\tfor(tKey in obj){\r\n\t\t\tObjectTools.setKeyValue(rst,tKey,obj[tKey]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.differ=function(objA,objB){\r\n\t\tvar tKey;\r\n\t\tvar valueA;\r\n\t\tvar valueB;\r\n\t\tobjA=ObjectTools.flatObj(objA);\r\n\t\tobjB=ObjectTools.flatObj(objB);\r\n\t\tvar rst={};\r\n\t\tfor(tKey in objA){\r\n\t\t\tif(!objB.hasOwnProperty(tKey)){\r\n\t\t\t\trst[tKey]=\"被删除\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(tKey in objB){\r\n\t\t\tif(objB[tKey]!=objA[tKey]){\r\n\t\t\t\trst[tKey]={\"pre\":objA[tKey],\"now\":objB[tKey]};\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.traceDifferObj=function(obj){\r\n\t\tvar key;\r\n\t\tvar tO;\r\n\t\tfor(key in obj){\r\n\t\t\tif((typeof (obj[key])=='string')){\r\n\t\t\t\tconsole.log(key+\":\",obj[key]);\r\n\t\t\t\t}else{\r\n\t\t\t\ttO=obj[key];\r\n\t\t\t\tconsole.log(key+\":\",\"now:\",tO[\"now\"],\"pre:\",tO[\"pre\"]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.setKeyValue=function(obj,flatKey,value){\r\n\t\tif(flatKey.indexOf(ObjectTools.sign)>=0){\r\n\t\t\tvar keys=flatKey.split(ObjectTools.sign);\r\n\t\t\tvar tKey;\r\n\t\t\twhile(keys.length>1){\r\n\t\t\t\ttKey=keys.shift();\r\n\t\t\t\tif(!obj[tKey]){\r\n\t\t\t\t\tobj[tKey]={};\r\n\t\t\t\t\tconsole.log(\"addKeyObj:\",tKey);\r\n\t\t\t\t}\r\n\t\t\t\tobj=obj[tKey];\r\n\t\t\t\tif(!obj){\r\n\t\t\t\t\tconsole.log(\"wrong flatKey:\",flatKey);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tobj[keys.shift()]=value;\r\n\t\t\t}else{\r\n\t\t\tobj[flatKey]=value;\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.clearObj=function(obj){\r\n\t\tvar key;\r\n\t\tfor (key in obj){\r\n\t\t\tdelete obj[key];\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.copyObjFast=function(obj){\r\n\t\tvar jsStr;\r\n\t\tjsStr=laya.debug.tools.ObjectTools.getJsonString(obj);\r\n\t\treturn laya.debug.tools.ObjectTools.getObj(jsStr);\r\n\t}\r\n\r\n\tObjectTools.copyObj=function(obj){\r\n\t\tif((obj instanceof Array))return ObjectTools.copyArr(obj);\r\n\t\tvar rst={};\r\n\t\tvar key;\r\n\t\tfor(key in obj){\r\n\t\t\tif(obj[key]===null||obj[key]===undefined){\r\n\t\t\t\trst[key]=obj[key];\r\n\t\t\t}else\r\n\t\t\tif(((obj[key])instanceof Array)){\r\n\t\t\t\trst[key]=ObjectTools.copyArr(obj[key]);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\tif((typeof (obj[key])=='object')){\r\n\t\t\t\trst[key]=ObjectTools.copyObj(obj[key]);\r\n\t\t\t\t}else{\r\n\t\t\t\trst[key]=obj[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.copyArr=function(arr){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(ObjectTools.copyObj(arr[i]));\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.concatArr=function(src,a){\r\n\t\tif (!a)return src;\r\n\t\tif (!src)return a;\r\n\t\tvar i=0,len=a.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tsrc.push(a[i]);\r\n\t\t}\r\n\t\treturn src;\r\n\t}\r\n\r\n\tObjectTools.insertArrToArr=function(src,insertArr,pos){\r\n\t\t(pos===void 0)&& (pos=0);\r\n\t\tif (pos < 0)pos=0;\r\n\t\tif (pos > src.length)pos=src.length;\r\n\t\tvar preLen=src.length;\r\n\t\tvar i=0,len=0;\r\n\t\tsrc.length+=insertArr.length;\r\n\t\tvar moveLen=0;\r\n\t\tmoveLen=insertArr.length;\r\n\t\tfor (i=src.length-1;i >=pos;i--){\r\n\t\t\tsrc[i]=src[i-moveLen];\r\n\t\t}\r\n\t\tlen=insertArr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tsrc[pos+i]=insertArr[i];\r\n\t\t}\r\n\t\treturn src;\r\n\t}\r\n\r\n\tObjectTools.clearArr=function(arr){\r\n\t\tif (!arr)return arr;\r\n\t\tarr.length=0;\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tObjectTools.removeFromArr=function(arr,item){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(arr[i]==item){\r\n\t\t\t\tarr[i].splice(i,1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.setValueArr=function(src,v){\r\n\t\tsrc || (src=[]);\r\n\t\tsrc.length=0;\r\n\t\treturn ObjectTools.concatArr(src,v);\r\n\t}\r\n\r\n\tObjectTools.getFrom=function(rst,src,count){\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < count;i++){\r\n\t\t\trst.push(src[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.getFromR=function(rst,src,count){\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < count;i++){\r\n\t\t\trst.push(src.pop());\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.enableDisplayTree=function(dis){\r\n\t\twhile (dis){\r\n\t\t\tdis.mouseEnabled=true;\r\n\t\t\tdis=dis.parent;\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.getJsonString=function(obj){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=JSON.stringify(obj);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.getObj=function(jsonStr){\r\n\t\tvar rst;\r\n\t\t/*__JS__ */rst=JSON.parse(jsonStr);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.getKeyArr=function(obj){\r\n\t\tvar rst;\r\n\t\tvar key;\r\n\t\trst=[];\r\n\t\tfor(key in obj){\r\n\t\t\trst.push(key);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.getObjValues=function(dataList,key){\r\n\t\tvar rst;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=dataList.length;\r\n\t\trst=[];\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(dataList[i][key]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.hasKeys=function(obj,keys){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(!obj.hasOwnProperty(keys[i]))return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tObjectTools.copyValueByArr=function(tar,src,keys){\r\n\t\tvar i=0,len=keys.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(!(src[keys[i]]===null))\r\n\t\t\t\ttar[keys[i]]=src[keys[i]];\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.getNoSameArr=function(arr){\r\n\t\tvar i=0,len=0;\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar tItem;\r\n\t\tlen=arr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttItem=arr[i];\r\n\t\t\tif (rst.indexOf(tItem)< 0){\r\n\t\t\t\trst.push(tItem);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.insertValue=function(tar,src){\r\n\t\tvar key;\r\n\t\tfor (key in src){\r\n\t\t\ttar[key]=src[key];\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.replaceValue=function(obj,replaceO){\r\n\t\tvar key;\r\n\t\tfor(key in obj){\r\n\t\t\tif(replaceO.hasOwnProperty(obj[key])){\r\n\t\t\t\tobj[key]=replaceO[obj[key]];\r\n\t\t\t}\r\n\t\t\tif((typeof (obj[key])=='object')){\r\n\t\t\t\tObjectTools.replaceValue(obj[key],replaceO);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.setKeyValues=function(items,key,value){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\titems[i][key]=value;\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.findItemPos=function(items,sign,value){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=items.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(items[i][sign]==value){\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn-1;\r\n\t}\r\n\r\n\tObjectTools.setObjValue=function(obj,key,value){\r\n\t\tobj[key]=value;\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tObjectTools.setAutoTypeValue=function(obj,key,value){\r\n\t\tif(obj.hasOwnProperty(key)){\r\n\t\t\tif(ObjectTools.isNumber(obj[key])){\r\n\t\t\t\tobj[key]=parseFloat(value);\r\n\t\t\t\t}else{\r\n\t\t\t\tobj[key]=value;\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t\tobj[key]=value;\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tObjectTools.getAutoValue=function(value){\r\n\t\tvar tFloat=parseFloat(value);\r\n\t\tif(typeof(value)==\"string\"){\r\n\t\t\tif(tFloat+\"\"===StringTool.trimSide(value))return tFloat;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tObjectTools.isNumber=function(value){\r\n\t\treturn (parseFloat(value)==value);\r\n\t}\r\n\r\n\tObjectTools.isNaNS=function(value){\r\n\t\treturn (value.toString()==\"NaN\");\r\n\t}\r\n\r\n\tObjectTools.isNaN=function(value){\r\n\t\tif(typeof(value)==\"number\")return false;\r\n\t\tif(typeof(value)==\"string\"){\r\n\t\t\tif(parseFloat(value).toString()!=\"NaN\"){\r\n\t\t\t\tif(parseFloat(value)==value){\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tObjectTools.getStrTypedValue=function(value){\r\n\t\tif(value==\"false\"){\r\n\t\t\treturn false;\r\n\t\t}else\r\n\t\tif(value==\"true\"){\r\n\t\t\treturn true;\r\n\t\t}else\r\n\t\tif(value==\"null\"){\r\n\t\t\treturn null;\r\n\t\t}else\r\n\t\tif(value==\"undefined\"){\r\n\t\t\treturn null;\r\n\t\t\t}else{\r\n\t\t\treturn ObjectTools.getAutoValue(value);\r\n\t\t}\r\n\t}\r\n\r\n\tObjectTools.createKeyValueDic=function(dataList,keySign){\r\n\t\tvar rst;\r\n\t\trst={};\r\n\t\tvar i=0,len=0;\r\n\t\tlen=dataList.length;\r\n\t\tvar tItem;\r\n\t\tvar tKey;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttItem=dataList[i];\r\n\t\t\ttKey=tItem[keySign];\r\n\t\t\trst[tKey]=tItem;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectTools.sign=\"_\";\r\n\treturn ObjectTools;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.ObjTimeCountTool\r\nvar ObjTimeCountTool=(function(){\r\n\tfunction ObjTimeCountTool(){\r\n\t\tthis.timeDic={};\r\n\t\tthis.resultDic={};\r\n\t\tthis.countDic={};\r\n\t\tthis.resultCountDic={};\r\n\t\tthis.nodeDic={};\r\n\t\tthis.resultNodeDic={};\r\n\t}\r\n\r\n\t__class(ObjTimeCountTool,'laya.debug.tools.ObjTimeCountTool');\r\n\tvar __proto=ObjTimeCountTool.prototype;\r\n\t__proto.addTime=function(sprite,time){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\tif (!this.timeDic.hasOwnProperty(key)){\r\n\t\t\tthis.timeDic[key]=0;\r\n\t\t}\r\n\t\tthis.timeDic[key]=this.timeDic[key]+time;\r\n\t\tif (!this.countDic.hasOwnProperty(key)){\r\n\t\t\tthis.countDic[key]=0;\r\n\t\t}\r\n\t\tthis.countDic[key]=this.countDic[key]+1;\r\n\t\tthis.nodeDic[key]=sprite;\r\n\t}\r\n\r\n\t__proto.getTime=function(sprite){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\tif (!this.resultDic[key])return 0;\r\n\t\treturn this.resultDic[key];\r\n\t}\r\n\r\n\t__proto.getCount=function(sprite){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\treturn this.resultCountDic[key];\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tvar key;\r\n\t\tfor (key in this.timeDic){\r\n\t\t\tthis.timeDic[key]=0;\r\n\t\t\tthis.countDic[key]=0;\r\n\t\t}\r\n\t\tObjectTools.clearObj(this.nodeDic);\r\n\t}\r\n\r\n\t__proto.updates=function(){\r\n\t\tObjectTools.clearObj(this.resultDic);\r\n\t\tObjectTools.insertValue(this.resultDic,this.timeDic);\r\n\t\tObjectTools.clearObj(this.resultCountDic);\r\n\t\tObjectTools.insertValue(this.resultCountDic,this.countDic);\r\n\t\tObjectTools.insertValue(this.resultNodeDic,this.nodeDic);\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\treturn ObjTimeCountTool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-23 下午12:00:48\r\n*/\r\n//class laya.debug.tools.RecInfo\r\nvar RecInfo=(function(){\r\n\tfunction RecInfo(){\r\n\t\tthis.oX=0;\r\n\t\tthis.oY=0;\r\n\t\tthis.hX=1;\r\n\t\tthis.hY=0;\r\n\t\tthis.vX=0;\r\n\t\tthis.vY=1;\r\n\t}\r\n\r\n\t__class(RecInfo,'laya.debug.tools.RecInfo');\r\n\tvar __proto=RecInfo.prototype;\r\n\t__proto.initByPoints=function(oPoint,ePoint,vPoint){\r\n\t\tthis.oX=oPoint.x;\r\n\t\tthis.oY=oPoint.y;\r\n\t\tthis.hX=ePoint.x;\r\n\t\tthis.hY=ePoint.y;\r\n\t\tthis.vX=vPoint.x;\r\n\t\tthis.vY=vPoint.y;\r\n\t}\r\n\r\n\t__getset(0,__proto,'rotation',function(){\r\n\t\treturn this.rotationRad/Math.PI*180;\r\n\t});\r\n\r\n\t__getset(0,__proto,'width',function(){\r\n\t\treturn Math.sqrt((this.hX-this.oX)*(this.hX-this.oX)+(this.hY-this.oY)*(this.hY-this.oY));\r\n\t});\r\n\r\n\t__getset(0,__proto,'x',function(){\r\n\t\treturn this.oX;\r\n\t});\r\n\r\n\t__getset(0,__proto,'rotationRadV',function(){\r\n\t\tvar dx=this.vX-this.oX;\r\n\t\tvar dy=this.vY-this.oY;\r\n\t\treturn Math.atan2(dy,dx);\r\n\t});\r\n\r\n\t__getset(0,__proto,'y',function(){\r\n\t\treturn this.oY;\r\n\t});\r\n\r\n\t__getset(0,__proto,'rotationRad',function(){\r\n\t\tvar dx=this.hX-this.oX;\r\n\t\tvar dy=this.hY-this.oY;\r\n\t\treturn Math.atan2(dy,dx);\r\n\t});\r\n\r\n\t__getset(0,__proto,'height',function(){\r\n\t\treturn Math.sqrt((this.vX-this.oX)*(this.vX-this.oX)+(this.vY-this.oY)*(this.vY-this.oY));\r\n\t});\r\n\r\n\t__getset(0,__proto,'rotationV',function(){\r\n\t\treturn this.rotationRadV/Math.PI*180;\r\n\t});\r\n\r\n\tRecInfo.createByPoints=function(oPoint,ePoint,vPoint){\r\n\t\tvar rst;\r\n\t\trst=new RecInfo();\r\n\t\trst.initByPoints(oPoint,ePoint,vPoint);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tRecInfo.getGlobalPoints=function(sprite,x,y){\r\n\t\treturn sprite.localToGlobal(new Point(x,y));\r\n\t}\r\n\r\n\tRecInfo.getGlobalRecInfo=function(sprite,x0,y0,x1,y1,x2,y2){\r\n\t\t(x0===void 0)&& (x0=0);\r\n\t\t(y0===void 0)&& (y0=0);\r\n\t\t(x1===void 0)&& (x1=1);\r\n\t\t(y1===void 0)&& (y1=0);\r\n\t\t(x2===void 0)&& (x2=0);\r\n\t\t(y2===void 0)&& (y2=1);\r\n\t\treturn RecInfo.createByPoints(RecInfo.getGlobalPoints(sprite,x0,y0),RecInfo.getGlobalPoints(sprite,x1,y1),RecInfo.getGlobalPoints(sprite,x2,y2));\r\n\t}\r\n\r\n\treturn RecInfo;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.RenderAnalyser\r\nvar RenderAnalyser=(function(){\r\n\tfunction RenderAnalyser(){\r\n\t\tthis.timeDic={};\r\n\t\tthis.resultDic={};\r\n\t\tthis.countDic={};\r\n\t\tthis.resultCountDic={};\r\n\t\tthis.nodeDic={};\r\n\t\tthis.isWorking=false;\r\n\t\tthis.working=true;\r\n\t}\r\n\r\n\t__class(RenderAnalyser,'laya.debug.tools.RenderAnalyser');\r\n\tvar __proto=RenderAnalyser.prototype;\r\n\t__proto.render=function(sprite,time){\r\n\t\tthis.addTime(sprite,time);\r\n\t}\r\n\r\n\t__proto.addTime=function(sprite,time){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\tif (!this.timeDic.hasOwnProperty(key)){\r\n\t\t\tthis.timeDic[key]=0;\r\n\t\t}\r\n\t\tthis.timeDic[key]=this.timeDic[key]+time;\r\n\t\tif (!this.countDic.hasOwnProperty(key)){\r\n\t\t\tthis.countDic[key]=0;\r\n\t\t}\r\n\t\tthis.countDic[key]=this.countDic[key]+1;\r\n\t\tthis.nodeDic[key]=sprite;\r\n\t}\r\n\r\n\t__proto.getTime=function(sprite){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\tif (!this.resultDic[key])return 0;\r\n\t\treturn this.resultDic[key];\r\n\t}\r\n\r\n\t__proto.getCount=function(sprite){\r\n\t\tIDTools.idObj(sprite);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(sprite);\r\n\t\treturn this.resultCountDic[key];\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tvar key;\r\n\t\tfor (key in this.timeDic){\r\n\t\t\tthis.timeDic[key]=0;\r\n\t\t\tthis.countDic[key]=0;\r\n\t\t}\r\n\t\tObjectTools.clearObj(this.nodeDic);\r\n\t}\r\n\r\n\t__proto.updates=function(){\r\n\t\tObjectTools.clearObj(this.resultDic);\r\n\t\tObjectTools.insertValue(this.resultDic,this.timeDic);\r\n\t\tObjectTools.clearObj(this.resultCountDic);\r\n\t\tObjectTools.insertValue(this.resultCountDic,this.countDic);\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\t__getset(0,__proto,'working',null,function(v){\r\n\t\tthis.isWorking=v;\r\n\t\tif (v){\r\n\t\t\tLaya.timer.loop(NodeConsts.RenderCostMaxTime,this,this.updates);\r\n\t\t\t}else{\r\n\t\t\tLaya.timer.clear(this,this.updates);\r\n\t\t}\r\n\t});\r\n\r\n\t__static(RenderAnalyser,\r\n\t['I',function(){return this.I=new RenderAnalyser();}\r\n\t]);\r\n\treturn RenderAnalyser;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于调整对象的宽高以及坐标\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.resizer.DisResizer\r\nvar DisResizer=(function(){\r\n\tfunction DisResizer(){}\r\n\t__class(DisResizer,'laya.debug.tools.resizer.DisResizer');\r\n\tDisResizer.init=function(){\r\n\t\tif (DisResizer._up)return;\r\n\t\tDisResizer._up=new AutoFillRec(\"T\");\r\n\t\tDisResizer._up.height=2;\r\n\t\tDisResizer._up.type=0;\r\n\t\tDisResizer._down=new AutoFillRec(\"T\");\r\n\t\tDisResizer._down.height=2;\r\n\t\tDisResizer._down.type=0;\r\n\t\tDisResizer._left=new AutoFillRec(\"R\");\r\n\t\tDisResizer._left.width=2;\r\n\t\tDisResizer._left.type=1;\r\n\t\tDisResizer._right=new AutoFillRec(\"R\");\r\n\t\tDisResizer._right.width=2;\r\n\t\tDisResizer._right.type=1;\r\n\t\tDisResizer._barList=[DisResizer._up,DisResizer._down,DisResizer._left,DisResizer._right];\r\n\t\tDisResizer.addEvent();\r\n\t}\r\n\r\n\tDisResizer.stageDown=function(e){\r\n\t\tvar target;\r\n\t\ttarget=e.target;\r\n\t\tif (DisResizer._tar && DisControlTool.isInTree(DisResizer._tar,target)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tDisResizer.clear();\r\n\t}\r\n\r\n\tDisResizer.clear=function(){\r\n\t\tDisResizer._tar=null;\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",null,DisResizer.stageDown);\r\n\t\tDisControlTool.removeItems(DisResizer._barList);\r\n\t\tDisResizer.clearDragEvents();\r\n\t}\r\n\r\n\tDisResizer.addEvent=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tvar tBar;\r\n\t\tlen=DisResizer._barList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttBar=DisResizer._barList[i];\r\n\t\t\ttBar.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",null,DisResizer.barDown);\r\n\t\t}\r\n\t}\r\n\r\n\tDisResizer.barDown=function(e){\r\n\t\tDisResizer.clearDragEvents();\r\n\t\tDisResizer.tBar=e.target;\r\n\t\tif (!DisResizer.tBar)return;\r\n\t\tvar area;\r\n\t\tarea=new Rectangle();\r\n\t\tif (DisResizer.tBar.type==0){\r\n\t\t\tarea.x=DisResizer.tBar.x;\r\n\t\t\tarea.width=0;\r\n\t\t\tarea.y=DisResizer.tBar.y-200;\r\n\t\t\tarea.height=400;\r\n\t\t\t}else{\r\n\t\t\tarea.x=DisResizer.tBar.x-200;\r\n\t\t\tarea.width=400;\r\n\t\t\tarea.y=0;\r\n\t\t\tarea.height=0;\r\n\t\t};\r\n\t\tvar option;\r\n\t\toption={};\r\n\t\toption.area=area;\r\n\t\tDisResizer.tBar.record();\r\n\t\tDisResizer.tBar.startDrag(area);\r\n\t\tDisResizer.tBar.on(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",null,DisResizer.draging);\r\n\t\tDisResizer.tBar.on(/*laya.events.Event.DRAG_END*/\"dragend\",null,DisResizer.dragEnd);\r\n\t}\r\n\r\n\tDisResizer.draging=function(e){\r\n\t\tconsole.log(\"draging\");\r\n\t\tif (!DisResizer.tBar)return;\r\n\t\tif (!DisResizer._tar)return;\r\n\t\tswitch(DisResizer.tBar){\r\n\t\t\tcase DisResizer._left:\r\n\t\t\t\tDisResizer._tar.x+=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._tar.width-=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._up.width-=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._down.width-=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._right.x-=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer.tBar.x-=DisResizer.tBar.getDx();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase DisResizer._right:\r\n\t\t\t\tDisResizer._tar.width+=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._up.width+=DisResizer.tBar.getDx();\r\n\t\t\t\tDisResizer._down.width+=DisResizer.tBar.getDx();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase DisResizer._up:\r\n\t\t\t\tDisResizer._tar.y+=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._tar.height-=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._right.height-=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._left.height-=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._down.y-=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer.tBar.y-=DisResizer.tBar.getDy();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase DisResizer._down:\r\n\t\t\t\tDisResizer._tar.height+=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._right.height+=DisResizer.tBar.getDy();\r\n\t\t\t\tDisResizer._left.height+=DisResizer.tBar.getDy();\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tDisResizer.tBar.record();\r\n\t}\r\n\r\n\tDisResizer.dragEnd=function(e){\r\n\t\tconsole.log(\"dragEnd\");\r\n\t\tDisResizer.clearDragEvents();\r\n\t\tDisResizer.updates();\r\n\t}\r\n\r\n\tDisResizer.clearDragEvents=function(){\r\n\t\tif (!DisResizer.tBar)return;\r\n\t\tDisResizer.tBar.off(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",null,DisResizer.draging);\r\n\t\tDisResizer.tBar.off(/*laya.events.Event.DRAG_END*/\"dragend\",null,DisResizer.dragEnd);\r\n\t}\r\n\r\n\tDisResizer.setUp=function(dis,force){\r\n\t\t(force===void 0)&& (force=false);\r\n\t\tif (force && dis==DisResizer._tar){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tDisControlTool.removeItems(DisResizer._barList);\r\n\t\tif (DisResizer._tar==dis){\r\n\t\t\tDisResizer._tar=null;\r\n\t\t\tDisResizer.clearDragEvents();\r\n\t\t\tif(!force)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tDisResizer._tar=dis;\r\n\t\tDisResizer.updates();\r\n\t\tDisControlTool.addItems(DisResizer._barList,dis);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",null,DisResizer.stageDown);\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",null,DisResizer.stageDown);\r\n\t}\r\n\r\n\tDisResizer.updates=function(){\r\n\t\tvar dis;\r\n\t\tdis=DisResizer._tar;\r\n\t\tif(!dis)return;\r\n\t\tvar bounds;\r\n\t\tbounds=new Rectangle(0,0,dis.width,dis.height);\r\n\t\tDisResizer._up.x=bounds.x;\r\n\t\tDisResizer._up.y=bounds.y;\r\n\t\tDisResizer._up.width=bounds.width;\r\n\t\tDisResizer._down.x=bounds.x;\r\n\t\tDisResizer._down.y=bounds.y+bounds.height-2;\r\n\t\tDisResizer._down.width=bounds.width;\r\n\t\tDisResizer._left.x=bounds.x;\r\n\t\tDisResizer._left.y=bounds.y;\r\n\t\tDisResizer._left.height=bounds.height;\r\n\t\tDisResizer._right.x=bounds.x+bounds.width-2;\r\n\t\tDisResizer._right.y=bounds.y;\r\n\t\tDisResizer._right.height=bounds.height;\r\n\t}\r\n\r\n\tDisResizer.Side=2;\r\n\tDisResizer.Vertical=1;\r\n\tDisResizer.Horizon=0;\r\n\tDisResizer._up=null;\r\n\tDisResizer._down=null;\r\n\tDisResizer._left=null;\r\n\tDisResizer._right=null;\r\n\tDisResizer._barList=null;\r\n\tDisResizer._tar=null;\r\n\tDisResizer.barWidth=2;\r\n\tDisResizer.useGetBounds=false;\r\n\tDisResizer.tBar=null;\r\n\treturn DisResizer;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.resizer.SimpleResizer\r\nvar SimpleResizer=(function(){\r\n\tfunction SimpleResizer(){}\r\n\t__class(SimpleResizer,'laya.debug.tools.resizer.SimpleResizer');\r\n\tSimpleResizer.setResizeAble=function(clickItem,tar,minWidth,minHeight){\r\n\t\t(minWidth===void 0)&& (minWidth=150);\r\n\t\t(minHeight===void 0)&& (minHeight=150);\r\n\t\tclickItem.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",null,SimpleResizer.onMouseDown,[tar,minWidth,minHeight]);\r\n\t}\r\n\r\n\tSimpleResizer.onMouseDown=function(tar,minWidth,minHeight,e){\r\n\t\tSimpleResizer.clearEvents();\r\n\t\tif (!tar)return;\r\n\t\tSimpleResizer.preMousePoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);\r\n\t\tSimpleResizer.preTarSize.setTo(tar.width,tar.height);\r\n\t\tSimpleResizer.preScale.setTo(1,1);\r\n\t\tvar rTar;\r\n\t\trTar=tar;\r\n\t\twhile (rTar&&rTar!=Laya.stage){\r\n\t\t\tSimpleResizer.preScale.x *=rTar.scaleX;\r\n\t\t\tSimpleResizer.preScale.y *=rTar.scaleY;\r\n\t\t\trTar=rTar.parent;\r\n\t\t}\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",null,SimpleResizer.onMouseMoveEnd);\r\n\t\tLaya.timer.loop(100,null,SimpleResizer.onMouseMoving,[tar,minWidth,minHeight]);\r\n\t}\r\n\r\n\tSimpleResizer.onMouseMoving=function(tar,minWidth,minHeight,e){\r\n\t\tvar tWidth=(Laya.stage.mouseX-SimpleResizer.preMousePoint.x)/ SimpleResizer.preScale.x+SimpleResizer.preTarSize.x;\r\n\t\tvar tHeight=(Laya.stage.mouseY-SimpleResizer.preMousePoint.y)/SimpleResizer.preScale.y+SimpleResizer.preTarSize.y;\r\n\t\ttar.width=tWidth > minWidth?tWidth:minWidth;\r\n\t\ttar.height=tHeight>minHeight?tHeight:minHeight;\r\n\t}\r\n\r\n\tSimpleResizer.onMouseMoveEnd=function(e){\r\n\t\tSimpleResizer.clearEvents();\r\n\t}\r\n\r\n\tSimpleResizer.clearEvents=function(){\r\n\t\tLaya.timer.clear(null,SimpleResizer.onMouseMoving);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",null,SimpleResizer.onMouseMoveEnd);\r\n\t}\r\n\r\n\t__static(SimpleResizer,\r\n\t['preMousePoint',function(){return this.preMousePoint=new Point();},'preTarSize',function(){return this.preTarSize=new Point();},'preScale',function(){return this.preScale=new Point();}\r\n\t]);\r\n\treturn SimpleResizer;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.ResTools\r\nvar ResTools=(function(){\r\n\tfunction ResTools(){}\r\n\t__class(ResTools,'laya.debug.tools.ResTools');\r\n\tResTools.getCachedResList=function(){\r\n\t\tif (Render.isWebGL){\r\n\t\t\treturn ResTools.getWebGlResList();\r\n\t\t\t}else{\r\n\t\t\treturn ResTools.getCanvasResList();\r\n\t\t}\r\n\t}\r\n\r\n\tResTools.getWebGlResList=function(){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar tResource;\r\n\t\tvar _resources;\r\n\t\t_resources=ResourceManager.currentResourceManager[\"_resources\"];\r\n\t\tfor(var i=0;i <_resources.length;i++){\r\n\t\t\ttResource=_resources[i];\r\n\t\t\tif(ClassTool.getClassName(tResource)==\"WebGLImage\"){\r\n\t\t\t\tvar url=tResource[\"src\"];\r\n\t\t\t\tif(url&&url.indexOf(\"data:image/png;base64\")<0)\r\n\t\t\t\t\trst.push(url);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tResTools.getCanvasResList=function(){\r\n\t\tvar picDic;\r\n\t\tpicDic={};\r\n\t\tvar dataO;\r\n\t\tdataO=Loader.loadedMap;\r\n\t\tResTools.collectPics(dataO,picDic);\r\n\t\treturn ResTools.getArrFromDic(picDic);\r\n\t}\r\n\r\n\tResTools.getArrFromDic=function(dic){\r\n\t\tvar key;\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tfor (key in dic){\r\n\t\t\trst.push(key);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tResTools.collectPics=function(dataO,picDic){\r\n\t\tif (!dataO)return;\r\n\t\tvar key;\r\n\t\tvar tTexture;\r\n\t\tfor (key in dataO){\r\n\t\t\ttTexture=dataO[key];\r\n\t\t\tif (tTexture){\r\n\t\t\t\tif (tTexture.bitmap&&tTexture.bitmap.src){\r\n\t\t\t\t\tvar url=tTexture.bitmap.src;\r\n\t\t\t\t\tif(url.indexOf(\"data:image/png;base64\")<0)\r\n\t\t\t\t\t\tpicDic[tTexture.bitmap.src]=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn ResTools;\r\n})()\r\n\r\n\r\n/**\r\n*类实例创建分析工具\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-25 下午3:31:46\r\n*/\r\n//class laya.debug.tools.RunProfile\r\nvar RunProfile=(function(){\r\n\tfunction RunProfile(){}\r\n\t__class(RunProfile,'laya.debug.tools.RunProfile');\r\n\tRunProfile.run=function(funName,callLen){\r\n\t\t(callLen===void 0)&& (callLen=3);\r\n\t\tvar tCount;\r\n\t\tif(!RunProfile.infoDic.hasOwnProperty(funName)){\r\n\t\t\tRunProfile.infoDic[funName]=new CountTool();\r\n\t\t}\r\n\t\ttCount=RunProfile.infoDic[funName];\r\n\t\tvar msg;\r\n\t\tmsg=TraceTool.getCallLoc(callLen)+\"\\n\"+TraceTool.getCallStack(1,callLen-3);\r\n\t\ttCount.add(msg);\r\n\t\tif(RunProfile._runShowDic[funName]){\r\n\t\t\tconsole.log(\"Create:\"+funName);\r\n\t\t\tconsole.log(msg);\r\n\t\t}\r\n\t}\r\n\r\n\tRunProfile.showClassCreate=function(funName){\r\n\t\tRunProfile._runShowDic[funName]=true;\r\n\t}\r\n\r\n\tRunProfile.hideClassCreate=function(funName){\r\n\t\tRunProfile._runShowDic[funName]=false;\r\n\t}\r\n\r\n\tRunProfile.getRunInfo=function(funName){\r\n\t\tvar rst;\r\n\t\trst=RunProfile.infoDic[funName];\r\n\t\tif(rst){\r\n\t\t}\r\n\t\treturn RunProfile.infoDic[funName];\r\n\t}\r\n\r\n\tRunProfile.runTest=function(fun,count,sign){\r\n\t\t(sign===void 0)&& (sign=\"runTest\");\r\n\t\tDTrace.timeStart(sign);\r\n\t\tvar i=0;\r\n\t\tfor(i=0;i<count;i++){\r\n\t\t\tfun();\r\n\t\t}\r\n\t\tDTrace.timeEnd(sign);\r\n\t}\r\n\r\n\tRunProfile.runTest2=function(fun,count,sign){\r\n\t\t(sign===void 0)&& (sign=\"runTest\");\r\n\t\tvar preTime=NaN;\r\n\t\tpreTime=Browser.now();\r\n\t\tvar i=0;\r\n\t\tfor(i=0;i<count;i++){\r\n\t\t\tfun();\r\n\t\t}\r\n\t\treturn Browser.now()-preTime;\r\n\t}\r\n\r\n\tRunProfile.infoDic={};\r\n\tRunProfile._runShowDic={};\r\n\treturn RunProfile;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2016-6-24 下午6:07:30\r\n*/\r\n//class laya.debug.tools.SingleTool\r\nvar SingleTool=(function(){\r\n\tfunction SingleTool(){\r\n\t\tthis._objDic={};\r\n\t}\r\n\r\n\t__class(SingleTool,'laya.debug.tools.SingleTool');\r\n\tvar __proto=SingleTool.prototype;\r\n\t__proto.getArr=function(sign){\r\n\t\tvar dic;\r\n\t\tdic=this.getTypeDic(\"Array\");\r\n\t\tif(!dic[sign])dic[sign]=[];\r\n\t\treturn dic[sign];\r\n\t}\r\n\r\n\t__proto.getObject=function(sign){\r\n\t\tvar dic;\r\n\t\tdic=this.getTypeDic(\"Object\");\r\n\t\tif(!dic[sign])dic[sign]={};\r\n\t\treturn dic[sign];\r\n\t}\r\n\r\n\t__proto.getByClass=function(sign,clzSign,clz){\r\n\t\tvar dic;\r\n\t\tdic=this.getTypeDic(clzSign);\r\n\t\tif(!dic[sign])dic[sign]=new clz();\r\n\t\treturn dic[sign];\r\n\t}\r\n\r\n\t__proto.getTypeDic=function(type){\r\n\t\tif(!this._objDic[type])this._objDic[type]={};\r\n\t\treturn this._objDic[type];\r\n\t}\r\n\r\n\t__static(SingleTool,\r\n\t['I',function(){return this.I=new SingleTool();}\r\n\t]);\r\n\treturn SingleTool;\r\n})()\r\n\r\n\r\n/**\r\n*一些字符串操作函数\r\n*@author ww\r\n*\r\n*/\r\n//class laya.debug.tools.StringTool\r\nvar StringTool=(function(){\r\n\tfunction StringTool(){}\r\n\t__class(StringTool,'laya.debug.tools.StringTool');\r\n\tStringTool.toUpCase=function(str){\r\n\t\treturn str.toUpperCase();\r\n\t}\r\n\r\n\tStringTool.toLowCase=function(str){\r\n\t\treturn str.toLowerCase();\r\n\t}\r\n\r\n\tStringTool.toUpHead=function(str){\r\n\t\tvar rst;\r\n\t\tif(str.length<=1)return str.toUpperCase();\r\n\t\trst=str.charAt(0).toUpperCase()+str.substr(1);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.toLowHead=function(str){\r\n\t\tvar rst;\r\n\t\tif(str.length<=1)return str.toLowerCase();\r\n\t\trst=str.charAt(0).toLowerCase()+str.substr(1);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.packageToFolderPath=function(packageName){\r\n\t\tvar rst;\r\n\t\trst=packageName.replace(\".\",\"/\");\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.insert=function(str,iStr,index){\r\n\t\treturn str.substring(0,index)+iStr+str.substr(index);\r\n\t}\r\n\r\n\tStringTool.insertAfter=function(str,iStr,tarStr,isLast){\r\n\t\t(isLast===void 0)&& (isLast=false);\r\n\t\tvar i=0;\r\n\t\tif(isLast){\r\n\t\t\ti=str.lastIndexOf(tarStr);\r\n\t\t\t}else{\r\n\t\t\ti=str.indexOf(tarStr);\r\n\t\t}\r\n\t\tif(i>=0){\r\n\t\t\treturn StringTool.insert(str,iStr,i+tarStr.length);\r\n\t\t}\r\n\t\treturn str;\r\n\t}\r\n\r\n\tStringTool.insertBefore=function(str,iStr,tarStr,isLast){\r\n\t\t(isLast===void 0)&& (isLast=false);\r\n\t\tvar i=0;\r\n\t\tif(isLast){\r\n\t\t\ti=str.lastIndexOf(tarStr);\r\n\t\t\t}else{\r\n\t\t\ti=str.indexOf(tarStr);\r\n\t\t}\r\n\t\tif(i>=0){\r\n\t\t\treturn StringTool.insert(str,iStr,i);\r\n\t\t}\r\n\t\treturn str;\r\n\t}\r\n\r\n\tStringTool.insertParamToFun=function(funStr,params){\r\n\t\tvar oldParam;\r\n\t\toldParam=StringTool.getParamArr(funStr);\r\n\t\tvar inserStr;\r\n\t\tinserStr=params.join(\",\");\r\n\t\tif(oldParam.length>0){\r\n\t\t\tinserStr=\",\"+inserStr;\r\n\t\t}\r\n\t\treturn StringTool.insertBefore(funStr,inserStr,\")\",true);\r\n\t}\r\n\r\n\tStringTool.trim=function(str,vList){\r\n\t\tif(!vList){\r\n\t\t\tvList=[\" \",\"\\r\",\"\\n\",\"\\t\",String.fromCharCode(65279)];\r\n\t\t};\r\n\t\tvar rst;\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\trst=str;\r\n\t\tlen=vList.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst=StringTool.getReplace(rst,vList[i],\"\");\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.isEmpty=function(str){\r\n\t\tif(str.length<1)return true;\r\n\t\treturn StringTool.emptyStrDic.hasOwnProperty(str);\r\n\t}\r\n\r\n\tStringTool.trimLeft=function(str){\r\n\t\tvar i=0;\r\n\t\ti=0;\r\n\t\tvar len=0;\r\n\t\tlen=str.length;\r\n\t\twhile(StringTool.isEmpty(str.charAt(i))&&i<len){\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tif(i<len){\r\n\t\t\treturn str.substr(i);\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tStringTool.trimRight=function(str){\r\n\t\tvar i=0;\r\n\t\ti=str.length-1;\r\n\t\twhile(StringTool.isEmpty(str.charAt(i))&&i>=0){\r\n\t\t\ti--;\r\n\t\t};\r\n\t\tvar rst;\r\n\t\trst=str.substring(0,i)\r\n\t\tif(i>=0){\r\n\t\t\treturn str.substring(0,i+1);\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tStringTool.trimSide=function(str){\r\n\t\tvar rst;\r\n\t\trst=StringTool.trimLeft(str);\r\n\t\trst=StringTool.trimRight(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.isOkFileName=function(fileName){\r\n\t\tif(laya.debug.tools.StringTool.trimSide(fileName)==\"\")return false;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=fileName.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(StringTool.specialChars[fileName.charAt(i)])return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tStringTool.trimButEmpty=function(str){\r\n\t\treturn StringTool.trim(str,[\"\\r\",\"\\n\",\"\\t\"]);\r\n\t}\r\n\r\n\tStringTool.removeEmptyStr=function(strArr){\r\n\t\tvar i=0;\r\n\t\ti=strArr.length-1;\r\n\t\tvar str;\r\n\t\tfor(i=i;i>=0;i--){\r\n\t\t\tstr=strArr[i];\r\n\t\t\tstr=laya.debug.tools.StringTool.trimSide(str);\r\n\t\t\tif(StringTool.isEmpty(str)){\r\n\t\t\t\tstrArr.splice(i,1);\r\n\t\t\t\t}else{\r\n\t\t\t\tstrArr[i]=str;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn strArr;\r\n\t}\r\n\r\n\tStringTool.ifNoAddToTail=function(str,sign){\r\n\t\tif(str.indexOf(sign)>=0){\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\treturn str+sign;\r\n\t}\r\n\r\n\tStringTool.trimEmptyLine=function(str){\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tLines;\r\n\t\tvar tLine;\r\n\t\ttLines=str.split(\"\\n\");\r\n\t\tfor(i=tLines.length-1;i>=0;i--){\r\n\t\t\ttLine=tLines[i];\r\n\t\t\tif(StringTool.isEmptyLine(tLine)){\r\n\t\t\t\ttLines.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tLines.join(\"\\n\");\r\n\t}\r\n\r\n\tStringTool.isEmptyLine=function(str){\r\n\t\tstr=laya.debug.tools.StringTool.trim(str);\r\n\t\tif(str==\"\")return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tStringTool.removeCommentLine=function(lines){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar i=0;\r\n\t\tvar tLine;\r\n\t\tvar adptLine;\r\n\t\ti=0;\r\n\t\tvar len=0;\r\n\t\tvar index=0;\r\n\t\tlen=lines.length;\r\n\t\twhile(i<len){\r\n\t\t\tadptLine=tLine=lines[i];\r\n\t\t\tindex=tLine.indexOf(\"/**\");\r\n\t\t\tif(index>=0){\r\n\t\t\t\tadptLine=tLine.substring(0,index-1);\r\n\t\t\t\tStringTool.addIfNotEmpty(rst,adptLine);\r\n\t\t\t\twhile(i<len){\r\n\t\t\t\t\ttLine=lines[i];\r\n\t\t\t\t\tindex=tLine.indexOf(\"*/\");\r\n\t\t\t\t\tif(index>=0){\r\n\t\t\t\t\t\tadptLine=tLine.substring(index+2);\r\n\t\t\t\t\t\tStringTool.addIfNotEmpty(rst,adptLine);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t\t}else if(tLine.indexOf(\"//\")>=0){\r\n\t\t\t\tif(laya.debug.tools.StringTool.trim(tLine).indexOf(\"//\")==0){\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tStringTool.addIfNotEmpty(rst,adptLine);\r\n\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\tStringTool.addIfNotEmpty(rst,adptLine);\r\n\t\t\t}\r\n\t\t\ti++;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.addIfNotEmpty=function(arr,str){\r\n\t\tif(!str)return;\r\n\t\tvar tStr;\r\n\t\ttStr=StringTool.trim(str);\r\n\t\tif(tStr!=\"\"){\r\n\t\t\tarr.push(str);\r\n\t\t}\r\n\t}\r\n\r\n\tStringTool.trimExt=function(str,vars){\r\n\t\tvar rst;\r\n\t\trst=StringTool.trim(str);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=vars.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst=StringTool.getReplace(rst,vars[i],\"\");\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.getBetween=function(str,left,right,ifMax){\r\n\t\t(ifMax===void 0)&& (ifMax=false);\r\n\t\tif(!str)return \"\";\r\n\t\tif(!left)return \"\";\r\n\t\tif(!right)return \"\";\r\n\t\tvar lId=0;\r\n\t\tvar rId=0;\r\n\t\tlId=str.indexOf(left);\r\n\t\tif(lId<0)return\"\";\r\n\t\tif(ifMax){\r\n\t\t\trId=str.lastIndexOf(right);\r\n\t\t\tif(rId<lId)return \"\";\r\n\t\t\t}else{\r\n\t\t\trId=str.indexOf(right,lId+1);\r\n\t\t}\r\n\t\tif(rId<0)return \"\";\r\n\t\treturn str.substring(lId+left.length,rId);\r\n\t}\r\n\r\n\tStringTool.getSplitLine=function(line,split){\r\n\t\t(split===void 0)&& (split=\" \");\r\n\t\treturn line.split(split);\r\n\t}\r\n\r\n\tStringTool.getLeft=function(str,sign){\r\n\t\tvar i=0;\r\n\t\ti=str.indexOf(sign);\r\n\t\treturn str.substr(0,i);\r\n\t}\r\n\r\n\tStringTool.getRight=function(str,sign){\r\n\t\tvar i=0;\r\n\t\ti=str.indexOf(sign);\r\n\t\treturn str.substr(i+1);\r\n\t}\r\n\r\n\tStringTool.delelteItem=function(arr){\r\n\t\twhile (arr.length>0){\r\n\t\t\tif(arr[0]==\"\"){\r\n\t\t\t\tarr.shift();\r\n\t\t\t\t}else{\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tStringTool.getWords=function(line){\r\n\t\tvar rst=StringTool.getSplitLine(line);\r\n\t\tStringTool.delelteItem(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.getLinesI=function(startLine,endLine,lines){\r\n\t\tvar i=0;\r\n\t\tvar rst=[];\r\n\t\tfor(i=startLine;i<=endLine;i++){\r\n\t\t\trst.push(lines[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.structfy=function(str,inWidth,removeEmpty){\r\n\t\t(inWidth===void 0)&& (inWidth=4);\r\n\t\t(removeEmpty===void 0)&& (removeEmpty=true);\r\n\t\tif(removeEmpty){\r\n\t\t\tstr=laya.debug.tools.StringTool.trimEmptyLine(str);\r\n\t\t};\r\n\t\tvar lines;\r\n\t\tvar tIn=0;\r\n\t\ttIn=0;\r\n\t\tvar tInStr;\r\n\t\ttInStr=StringTool.getEmptyStr(0);\r\n\t\tlines=str.split(\"\\n\");\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tLineStr;\r\n\t\tlen=lines.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttLineStr=lines[i];\r\n\t\t\ttLineStr=laya.debug.tools.StringTool.trimLeft(tLineStr);\r\n\t\t\ttLineStr=laya.debug.tools.StringTool.trimRight(tLineStr);\r\n\t\t\ttIn+=StringTool.getPariCount(tLineStr);\r\n\t\t\tif(tLineStr.indexOf(\"}\")>=0){\r\n\t\t\t\ttInStr=StringTool.getEmptyStr(tIn*inWidth);\r\n\t\t\t}\r\n\t\t\ttLineStr=tInStr+tLineStr;\r\n\t\t\tlines[i]=tLineStr;\r\n\t\t\ttInStr=StringTool.getEmptyStr(tIn*inWidth);\r\n\t\t}\r\n\t\treturn lines.join(\"\\n\");\r\n\t}\r\n\r\n\tStringTool.getEmptyStr=function(width){\r\n\t\tif(!StringTool.emptyDic.hasOwnProperty(width)){\r\n\t\t\tvar i=0;\r\n\t\t\tvar len=0;\r\n\t\t\tlen=width;\r\n\t\t\tvar rst;\r\n\t\t\trst=\"\";\r\n\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\trst+=\" \";\r\n\t\t\t}\r\n\t\t\tStringTool.emptyDic[width]=rst;\r\n\t\t}\r\n\t\treturn StringTool.emptyDic[width];\r\n\t}\r\n\r\n\tStringTool.getPariCount=function(str,inChar,outChar){\r\n\t\t(inChar===void 0)&& (inChar=\"{\");\r\n\t\t(outChar===void 0)&& (outChar=\"}\");\r\n\t\tvar varDic;\r\n\t\tvarDic={};\r\n\t\tvarDic[inChar]=1;\r\n\t\tvarDic[outChar]=-1;\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tChar;\r\n\t\tlen=str.length;\r\n\t\tvar rst=0;\r\n\t\trst=0;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttChar=str.charAt(i);\r\n\t\t\tif(varDic.hasOwnProperty(tChar)){\r\n\t\t\t\trst+=varDic[tChar];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.readInt=function(str,startI){\r\n\t\t(startI===void 0)&& (startI=0);\r\n\t\tvar rst=NaN;\r\n\t\trst=0;\r\n\t\tvar tNum=0;\r\n\t\tvar tC;\r\n\t\tvar i=0;\r\n\t\tvar isBegin=false;\r\n\t\tisBegin=false;\r\n\t\tvar len=0;\r\n\t\tlen=str.length;\r\n\t\tfor(i=startI;i<len;i++){\r\n\t\t\ttC=str.charAt(i);\r\n\t\t\tif(Number(tC)>0||tC==\"0\"){\r\n\t\t\t\trst=10*rst+Number(tC);\r\n\t\t\t\tif(rst>0)isBegin=true;\r\n\t\t\t\t}else{\r\n\t\t\t\tif(isBegin)return rst;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.getReplace=function(str,oStr,nStr){\r\n\t\tif(!str)return \"\";\r\n\t\tvar rst;\r\n\t\trst=str.replace(new RegExp(oStr,\"g\"),nStr);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.getWordCount=function(str,findWord){\r\n\t\tvar rg=new RegExp(findWord,\"g\")\r\n\t\treturn str.match(rg).length;\r\n\t}\r\n\r\n\tStringTool.getResolvePath=function(path,basePath){\r\n\t\tif(StringTool.isAbsPath(path)){\r\n\t\t\treturn path;\r\n\t\t};\r\n\t\tvar tSign;\r\n\t\ttSign=\"\\\\\";\r\n\t\tif(basePath.indexOf(\"/\")>=0){\r\n\t\t\ttSign=\"/\";\r\n\t\t}\r\n\t\tif(basePath.charAt(basePath.length-1)==tSign){\r\n\t\t\tbasePath=basePath.substr(0,basePath.length-1);\r\n\t\t};\r\n\t\tvar parentSign;\r\n\t\tparentSign=\"..\"+tSign;\r\n\t\tvar tISign;\r\n\t\ttISign=\".\"+tSign;\r\n\t\tvar pCount=0;\r\n\t\tpCount=StringTool.getWordCount(path,parentSign);\r\n\t\tpath=laya.debug.tools.StringTool.getReplace(path,parentSign,\"\");\r\n\t\tpath=laya.debug.tools.StringTool.getReplace(path,tISign,\"\");\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=pCount;\r\n\t\tvar iPos=0;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tbasePath=StringTool.removeLastSign(path,tSign);\r\n\t\t}\r\n\t\treturn basePath+tSign+path;\r\n\t}\r\n\r\n\tStringTool.isAbsPath=function(path){\r\n\t\tif(path.indexOf(\":\")>=0)return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tStringTool.removeLastSign=function(str,sign){\r\n\t\tvar iPos=0;\r\n\t\tiPos=str.lastIndexOf(sign);\r\n\t\tstr=str.substring(0,iPos);\r\n\t\treturn str;\r\n\t}\r\n\r\n\tStringTool.getParamArr=function(str){\r\n\t\tvar paramStr;\r\n\t\tparamStr=laya.debug.tools.StringTool.getBetween(str,\"(\",\")\",true);\r\n\t\tif(StringTool.trim(paramStr).length<1)return [];\r\n\t\treturn paramStr.split(\",\");\r\n\t}\r\n\r\n\tStringTool.copyStr=function(str){\r\n\t\treturn str.substring();\r\n\t}\r\n\r\n\tStringTool.ArrayToString=function(arr){\r\n\t\tvar rst;\r\n\t\trst=\"[{items}]\".replace(new RegExp(\"\\\\{items\\\\}\",\"g\"),StringTool.getArrayItems(arr));\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.getArrayItems=function(arr){\r\n\t\tvar rst;\r\n\t\tif(arr.length<1)return \"\";\r\n\t\trst=StringTool.parseItem(arr[0]);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=arr.length;\r\n\t\tfor(i=1;i<len;i++){\r\n\t\t\trst+=\",\"+StringTool.parseItem(arr[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tStringTool.parseItem=function(item){\r\n\t\tvar rst;\r\n\t\trst=\"\\\"\"+item+\"\\\"\";\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tStringTool.initAlphaSign=function(){\r\n\t\tif (StringTool.alphaSigns)return;\r\n\t\tStringTool.alphaSigns={};\r\n\t\tStringTool.addSign(\"a\",\"z\",StringTool.alphaSigns);\r\n\t\tStringTool.addSign(\"A\",\"Z\",StringTool.alphaSigns);\r\n\t\tStringTool.addSign(\"0\",\"9\",StringTool.alphaSigns);\r\n\t}\r\n\r\n\tStringTool.addSign=function(ss,e,tar){\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar s=0;\r\n\t\ts=ss.charCodeAt(0);\r\n\t\tlen=e.charCodeAt(0);\r\n\t\tfor(i=s;i<=len;i++){\r\n\t\t\ttar[String.fromCharCode(i)]=true;\r\n\t\t\tconsole.log(\"add :\"+String.fromCharCode(i));\r\n\t\t}\r\n\t}\r\n\r\n\tStringTool.isPureAlphaNum=function(str){\r\n\t\tStringTool.initAlphaSign();\r\n\t\tif (!str)return true;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=str.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (!StringTool.alphaSigns[str.charAt(i)])return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tStringTool.emptyDic={};\r\n\tStringTool.alphaSigns=null;\r\n\t__static(StringTool,\r\n\t['emptyStrDic',function(){return this.emptyStrDic={\r\n\t\t\t\" \":true,\r\n\t\t\t\"\\r\":true,\r\n\t\t\t\"\\n\":true,\r\n\t\t\t\"\\t\":true\r\n\t};},'specialChars',function(){return this.specialChars={\"*\":true,\"&\":true,\"%\":true,\"#\":true,\"?\":true};}\r\n\r\n\t]);\r\n\treturn StringTool;\r\n})()\r\n\r\n\r\n/**\r\n*全局时间速率控制类\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.TimerControlTool\r\nvar TimerControlTool=(function(){\r\n\tfunction TimerControlTool(){}\r\n\t__class(TimerControlTool,'laya.debug.tools.TimerControlTool');\r\n\tTimerControlTool.now=function(){\r\n\t\tif (TimerControlTool._timeRate !=1)return TimerControlTool.getRatedNow();\r\n\t\treturn Date.now();\r\n\t}\r\n\r\n\tTimerControlTool.getRatedNow=function(){\r\n\t\tvar dTime=NaN;\r\n\t\tdTime=TimerControlTool.getNow()-TimerControlTool._startTime;\r\n\t\treturn dTime *TimerControlTool._timeRate+TimerControlTool._startTime;\r\n\t}\r\n\r\n\tTimerControlTool.getNow=function(){\r\n\t\treturn Date.now();\r\n\t}\r\n\r\n\tTimerControlTool.setTimeRate=function(rate){\r\n\t\tif (TimerControlTool._browerNow==null)TimerControlTool._browerNow=Browser[\"now\"];\r\n\t\tTimerControlTool._startTime=TimerControlTool.getNow();\r\n\t\tTimerControlTool._timeRate=rate;\r\n\t\tif (rate !=1){\r\n\t\t\tBrowser[\"now\"]=TimerControlTool.now;\r\n\t\t\t}else{\r\n\t\t\tif(TimerControlTool._browerNow!=null)\r\n\t\t\t\tBrowser[\"now\"]=TimerControlTool._browerNow;\r\n\t\t}\r\n\t}\r\n\r\n\tTimerControlTool.recoverRate=function(){\r\n\t\tTimerControlTool.setTimeRate(1);\r\n\t}\r\n\r\n\tTimerControlTool._startTime=NaN;\r\n\tTimerControlTool._timeRate=1;\r\n\tTimerControlTool._browerNow=null;\r\n\treturn TimerControlTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.TimeTool\r\nvar TimeTool=(function(){\r\n\tfunction TimeTool(){}\r\n\t__class(TimeTool,'laya.debug.tools.TimeTool');\r\n\tTimeTool.getTime=function(sign,update){\r\n\t\t(update===void 0)&& (update=true);\r\n\t\tif (!TimeTool.timeDic[sign]){\r\n\t\t\tTimeTool.timeDic[sign]=0;\r\n\t\t};\r\n\t\tvar tTime=NaN;\r\n\t\ttTime=Browser.now();\r\n\t\tvar rst=NaN;\r\n\t\trst=tTime-TimeTool.timeDic[sign];\r\n\t\tTimeTool.timeDic[sign]=tTime;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tTimeTool.runAllCallLater=function(){\r\n\t\tif(TimeTool._deep>0)debugger;\r\n\t\tTimeTool._deep++;\r\n\t\tvar timer;\r\n\t\ttimer=Laya.timer;\r\n\t\tvar laters=timer[\"_laters\"];\r\n\t\tfor (var i=0,n=laters.length-1;i <=n;i++){\r\n\t\t\tvar handler=laters[i];\r\n\t\t\tif(handler){\r\n\t\t\t\thandler.method!==null && handler.run(false);\r\n\t\t\t\ttimer[\"_recoverHandler\"](handler);\r\n\t\t\t\t}else{\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t\ti===n && (n=laters.length-1);\r\n\t\t}\r\n\t\tlaters.length=0;\r\n\t\tTimeTool._deep--;\r\n\t}\r\n\r\n\tTimeTool.timeDic={};\r\n\tTimeTool._deep=0;\r\n\treturn TimeTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.TouchDebugTools\r\nvar TouchDebugTools=(function(){\r\n\tfunction TouchDebugTools(){}\r\n\t__class(TouchDebugTools,'laya.debug.tools.TouchDebugTools');\r\n\tTouchDebugTools.getTouchIDs=function(events){\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=events.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst.push(events[i].identifier||0);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tTouchDebugTools.traceTouchIDs=function(msg,events){\r\n\t\tDebugTxt.dTrace(msg+\":\"+TouchDebugTools.getTouchIDs(events).join(\",\"));\r\n\t}\r\n\r\n\treturn TouchDebugTools;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-25 上午10:48:54\r\n*/\r\n//class laya.debug.tools.TraceTool\r\nvar TraceTool=(function(){\r\n\tfunction TraceTool(){}\r\n\t__class(TraceTool,'laya.debug.tools.TraceTool');\r\n\tTraceTool.closeAllLog=function(){\r\n\t\tvar logFun;\r\n\t\tlogFun=TraceTool.emptyLog;\r\n\t\tBrowser.window.console.log=logFun;\r\n\t}\r\n\r\n\tTraceTool.emptyLog=function(){}\r\n\tTraceTool.traceObj=function(obj){\r\n\t\tTraceTool.tempArr.length=0;\r\n\t\tvar key;\r\n\t\tfor(key in obj){\r\n\t\t\tTraceTool.tempArr.push(key+\":\"+obj[key]);\r\n\t\t};\r\n\t\tvar rst;\r\n\t\trst=TraceTool.tempArr.join(\"\\n\");\r\n\t\tconsole.log(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tTraceTool.traceObjR=function(obj){\r\n\t\tTraceTool.tempArr.length=0;\r\n\t\tvar key;\r\n\t\tfor(key in obj){\r\n\t\t\tTraceTool.tempArr.push(obj[key]+\":\"+key);\r\n\t\t};\r\n\t\tvar rst;\r\n\t\trst=TraceTool.tempArr.join(\"\\n\");\r\n\t\tconsole.log(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tTraceTool.traceSize=function(tar){\r\n\t\tDebugTool.dTrace(\"Size: x:\"+tar.x+\" y:\"+tar.y+\" w:\"+tar.width+\" h:\"+tar.height+\" scaleX:\"+tar.scaleX+\" scaleY:\"+tar.scaleY);\r\n\t}\r\n\r\n\tTraceTool.traceSplit=function(msg){\r\n\t\tconsole.log(\"---------------------\"+msg+\"---------------------------\");\r\n\t}\r\n\r\n\tTraceTool.group=function(gName){\r\n\t\t/*__JS__ */console.group(gName);;\r\n\t}\r\n\r\n\tTraceTool.groupEnd=function(){\r\n\t\t/*__JS__ */console.groupEnd();;\r\n\t}\r\n\r\n\tTraceTool.getCallStack=function(life,s){\r\n\t\t(life===void 0)&& (life=1);\r\n\t\t(s===void 0)&& (s=1);\r\n\t\tvar caller;\r\n\t\tcaller=TraceTool.getCallStack;\r\n\t\tcaller=caller.caller.caller;\r\n\t\tvar msg;\r\n\t\tmsg=\"\";\r\n\t\twhile(caller&&life>0){\r\n\t\t\tif(s<=0){\r\n\t\t\t\tmsg+=caller+\"<-\";\r\n\t\t\t\tlife--;\r\n\t\t\t\t}else{\r\n\t\t\t}\r\n\t\t\tcaller=caller.caller;\r\n\t\t\ts--;\r\n\t\t}\r\n\t\treturn msg;\r\n\t}\r\n\r\n\tTraceTool.getCallLoc=function(index){\r\n\t\t(index===void 0)&& (index=2);\r\n\t\tvar loc;\r\n\t\ttry {\r\n\t\t\tTraceTool.Erroer.i++;\r\n\t\t\t}catch (e){\r\n\t\t\tvar arr;\r\n\t\t\tarr=e.stack.replace(/Error\\n/).split(/\\n/);\r\n\t\t\tif (arr[index]){\r\n\t\t\t\tloc=arr[index].replace(/^\\s+|\\s+$/,\"\");\r\n\t\t\t\t}else{\r\n\t\t\t\tloc=\"unknow\";\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn loc;\r\n\t}\r\n\r\n\tTraceTool.traceCallStack=function(){\r\n\t\tvar loc;\r\n\t\ttry {\r\n\t\t\tTraceTool.Erroer.i++;\r\n\t\t\t}catch (e){\r\n\t\t\tloc=e.stack;\r\n\t\t}\r\n\t\tconsole.log(loc);\r\n\t\treturn loc;\r\n\t}\r\n\r\n\tTraceTool.getPlaceHolder=function(len){\r\n\t\tif(!TraceTool.holderDic.hasOwnProperty(len)){\r\n\t\t\tvar rst;\r\n\t\t\trst=\"\";\r\n\t\t\tvar i=0;\r\n\t\t\tfor(i=0;i<len;i++){\r\n\t\t\t\trst+=\"-\";\r\n\t\t\t}\r\n\t\t\tTraceTool.holderDic[len]=rst;\r\n\t\t}\r\n\t\treturn TraceTool.holderDic[len];\r\n\t}\r\n\r\n\tTraceTool.traceTree=function(tar,depth,isFirst){\r\n\t\t(depth===void 0)&& (depth=0);\r\n\t\t(isFirst===void 0)&& (isFirst=true);\r\n\t\tif(isFirst){\r\n\t\t\tconsole.log(\"traceTree\");\r\n\t\t}\r\n\t\tif(!tar)return;\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tif(tar.numChildren<1){\r\n\t\t\tconsole.log(tar);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tTraceTool.group(tar);\r\n\t\tlen=tar.numChildren;\r\n\t\tdepth++;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tTraceTool.traceTree(tar.getChildAt(i),depth,false);\r\n\t\t}\r\n\t\tTraceTool.groupEnd();\r\n\t}\r\n\r\n\tTraceTool.getClassName=function(tar){\r\n\t\treturn tar[\"constructor\"].name;\r\n\t}\r\n\r\n\tTraceTool.traceSpriteInfo=function(tar,showBounds,showSize,showTree){\r\n\t\t(showBounds===void 0)&& (showBounds=true);\r\n\t\t(showSize===void 0)&& (showSize=true);\r\n\t\t(showTree===void 0)&& (showTree=true);\r\n\t\tif(!((tar instanceof laya.display.Sprite ))){\r\n\t\t\tconsole.log(\"not Sprite\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(!tar){\r\n\t\t\tconsole.log(\"null Sprite\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tTraceTool.traceSplit(\"traceSpriteInfo\");\r\n\t\tDebugTool.dTrace(laya.debug.tools.TraceTool.getClassName(tar)+\":\"+tar.name);\r\n\t\tif(showTree){\r\n\t\t\tTraceTool.traceTree(tar);\r\n\t\t\t}else{\r\n\t\t\tconsole.log(tar);\r\n\t\t}\r\n\t\tif(showSize){\r\n\t\t\tTraceTool.traceSize(tar);\r\n\t\t}\r\n\t\tif(showBounds){\r\n\t\t\tconsole.log(\"bounds:\"+tar.getBounds());\r\n\t\t}\r\n\t}\r\n\r\n\tTraceTool.tempArr=[];\r\n\tTraceTool.Erroer=null;\r\n\tTraceTool.holderDic={};\r\n\treturn TraceTool;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.UVTools\r\nvar UVTools$1=(function(){\r\n\tfunction UVTools(){}\r\n\t__class(UVTools,'laya.debug.tools.UVTools',null,'UVTools$1');\r\n\tUVTools.getUVByRec=function(x,y,width,height){\r\n\t\treturn [x,y,x+width,y,x+width,y+height,x,y+height];\r\n\t}\r\n\r\n\tUVTools.getRecFromUV=function(uv){\r\n\t\tvar rst;\r\n\t\trst=new Rectangle(uv[0],uv[1],uv[2]-uv[0],uv[5]-uv[1]);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tUVTools.isUVRight=function(uv){\r\n\t\tif(uv[0]!=uv[6])return false;\r\n\t\tif(uv[1]!=uv[3])return false;\r\n\t\tif(uv[2]!=uv[4])return false;\r\n\t\tif(uv[5]!=uv[7])return false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tUVTools.getTextureRec=function(texture){\r\n\t\tvar rst;\r\n\t\trst=UVTools.getRecFromUV(texture.uv);\r\n\t\trst.x*=texture.bitmap.width;\r\n\t\trst.y*=texture.bitmap.height;\r\n\t\trst.width*=texture.bitmap.width;\r\n\t\trst.height*=texture.bitmap.height;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn UVTools;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-30 下午5:12:53\r\n*/\r\n//class laya.debug.tools.ValueChanger\r\nvar ValueChanger=(function(){\r\n\tfunction ValueChanger(){\r\n\t\tthis.target=null;\r\n\t\tthis.key=null;\r\n\t\tthis._tValue=NaN;\r\n\t\tthis.preValue=0;\r\n\t}\r\n\r\n\t__class(ValueChanger,'laya.debug.tools.ValueChanger');\r\n\tvar __proto=ValueChanger.prototype;\r\n\t__proto.record=function(){\r\n\t\tthis.preValue=this.value;\r\n\t}\r\n\r\n\t__proto.showValueByAdd=function(addValue){\r\n\t\tthis.value=this.preValue+addValue;\r\n\t}\r\n\r\n\t__proto.showValueByScale=function(scale){\r\n\t\tthis.value=this.preValue *scale;\r\n\t}\r\n\r\n\t__proto.recover=function(){\r\n\t\tthis.value=this.preValue;\r\n\t}\r\n\r\n\t__proto.dispose=function(){\r\n\t\tthis.target=null;\r\n\t}\r\n\r\n\t__getset(0,__proto,'value',function(){\r\n\t\tif(this.target){\r\n\t\t\tthis._tValue=this.target[this.key];\r\n\t\t}\r\n\t\treturn this._tValue;\r\n\t\t},function(nValue){\r\n\t\tthis._tValue=nValue;\r\n\t\tif(this.target){\r\n\t\t\tthis.target[this.key]=nValue;\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(0,__proto,'dValue',function(){\r\n\t\treturn this.value-this.preValue;\r\n\t});\r\n\r\n\t__getset(0,__proto,'scaleValue',function(){\r\n\t\treturn this.value/this.preValue;\r\n\t});\r\n\r\n\tValueChanger.create=function(target,key){\r\n\t\tvar rst;\r\n\t\trst=new ValueChanger();\r\n\t\trst.target=target;\r\n\t\trst.key=key;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn ValueChanger;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.VisibleAnalyser\r\nvar VisibleAnalyser=(function(){\r\n\tfunction VisibleAnalyser(){}\r\n\t__class(VisibleAnalyser,'laya.debug.tools.VisibleAnalyser');\r\n\tVisibleAnalyser.analyseTarget=function(node){\r\n\t\tvar isInstage=false;\r\n\t\tisInstage=node.displayedInStage;\r\n\t\tvar gRec;\r\n\t\tgRec=NodeUtils.getGRec(node);\r\n\t\tvar stageRec=new Rectangle();\r\n\t\tstageRec.setTo(0,0,Laya.stage.width,Laya.stage.height);\r\n\t\tvar isInVisibleRec=false;\r\n\t\tvar visibleRec;\r\n\t\tvisibleRec=stageRec.intersection(gRec);\r\n\t\tif (visibleRec.width > 0 && visibleRec.height > 0){\r\n\t\t\tisInVisibleRec=true;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tisInVisibleRec=false;\r\n\t\t};\r\n\t\tvar gAlpha=NaN;\r\n\t\tgAlpha=NodeUtils.getGAlpha(node);\r\n\t\tvar gVisible=false;\r\n\t\tgVisible=NodeUtils.getGVisible(node);\r\n\t\tvar msg;\r\n\t\tmsg=\"\";\r\n\t\tmsg+=\"isInstage:\"+isInstage+\"\\n\";\r\n\t\tmsg+=\"isInVisibleRec:\"+isInVisibleRec+\"\\n\";\r\n\t\tmsg+=\"gVisible:\"+gVisible+\"\\n\";\r\n\t\tmsg+=\"gAlpha:\"+gAlpha+\"\\n\";\r\n\t\tif (isInstage && isInVisibleRec && gVisible && gAlpha > 0){\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tVisibleAnalyser.anlyseRecVisible(node);\r\n\t\t\t\t}else{\r\n\t\t\t\tSpriteRenderForVisibleAnalyse.I.analyseNode(node);\r\n\t\t\t}\r\n\t\t\tmsg+=\"coverRate:\"+VisibleAnalyser.coverRate+\"\\n\";\r\n\t\t\tif (VisibleAnalyser._coverList.length > 0){\r\n\t\t\t\tLaya.timer.once(1000,null,VisibleAnalyser.showListLater);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(msg);\r\n\t\tOutPutView.I.showTxt(msg);\r\n\t}\r\n\r\n\tVisibleAnalyser.showListLater=function(){\r\n\t\tNodeListPanelView.I.showList(VisibleAnalyser._coverList);\r\n\t}\r\n\r\n\tVisibleAnalyser.isCoverByBrother=function(node){\r\n\t\tvar parent=node.parent;\r\n\t\tif (!parent)\r\n\t\t\treturn;\r\n\t\tvar _childs;\r\n\t\t_childs=parent._childs;\r\n\t\tvar index=0;\r\n\t\tindex=_childs.indexOf(node);\r\n\t\tif (index < 0)\r\n\t\t\treturn;\r\n\t\tvar i=0,len=0;\r\n\t\tvar canvas;\r\n\t\tvar rec;\r\n\t\trec=parent.getSelfBounds();\r\n\t\tif (rec.width <=0 || rec.height <=0)\r\n\t\t\treturn;\r\n\t}\r\n\r\n\tVisibleAnalyser.anlyseRecVisible=function(node){\r\n\t\tVisibleAnalyser.isNodeWalked=false;\r\n\t\tVisibleAnalyser._analyseTarget=node;\r\n\t\tif (!VisibleAnalyser.mainCanvas)\r\n\t\t\tVisibleAnalyser.mainCanvas=CanvasTools.createCanvas(Laya.stage.width,Laya.stage.height);\r\n\t\tCanvasTools.clearCanvas(VisibleAnalyser.mainCanvas);\r\n\t\tVisibleAnalyser.tColor=1;\r\n\t\tVisibleAnalyser.resetCoverList();\r\n\t\tWalkTools.walkTargetEX(Laya.stage,VisibleAnalyser.recVisibleWalker,null,VisibleAnalyser.filterFun);\r\n\t\tif (!VisibleAnalyser.isTarRecOK){\r\n\t\t\tVisibleAnalyser.coverRate=0;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tVisibleAnalyser.coverRate=CanvasTools.getDifferRate(VisibleAnalyser.preImageData,VisibleAnalyser.tarImageData);\r\n\t\t}\r\n\t\tconsole.log(\"coverRate:\",VisibleAnalyser.coverRate);\r\n\t}\r\n\r\n\tVisibleAnalyser.getRecArea=function(rec){\r\n\t\treturn rec.width *rec.height;\r\n\t}\r\n\r\n\tVisibleAnalyser.addCoverNode=function(node,coverRate){\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tdata.path=node;\r\n\t\tdata.label=ClassTool.getNodeClassAndName(node)+\":\"+coverRate;\r\n\t\tdata.coverRate=coverRate;\r\n\t\tVisibleAnalyser._coverList.push(data);\r\n\t\tconsole.log(\"coverByNode:\",node,coverRate);\r\n\t}\r\n\r\n\tVisibleAnalyser.resetCoverList=function(){\r\n\t\tVisibleAnalyser._coverList.length=0;\r\n\t}\r\n\r\n\tVisibleAnalyser.recVisibleWalker=function(node){\r\n\t\tif (node==VisibleAnalyser._analyseTarget){\r\n\t\t\tVisibleAnalyser.isNodeWalked=true;\r\n\t\t\tVisibleAnalyser.tarRec.copyFrom(NodeUtils.getGRec(node));\r\n\t\t\tconsole.log(\"tarRec:\",VisibleAnalyser.tarRec.toString());\r\n\t\t\tif (VisibleAnalyser.tarRec.width > 0 && VisibleAnalyser.tarRec.height > 0){\r\n\t\t\t\tVisibleAnalyser.isTarRecOK=true;\r\n\t\t\t\tVisibleAnalyser.tColor++;\r\n\t\t\t\tCanvasTools.fillCanvasRec(VisibleAnalyser.mainCanvas,VisibleAnalyser.tarRec,ColorTool.toHexColor(VisibleAnalyser.tColor));\r\n\t\t\t\tVisibleAnalyser.preImageData=CanvasTools.getImageDataFromCanvasByRec(VisibleAnalyser.mainCanvas,VisibleAnalyser.tarRec);\r\n\t\t\t\tVisibleAnalyser.tarImageData=CanvasTools.getImageDataFromCanvasByRec(VisibleAnalyser.mainCanvas,VisibleAnalyser.tarRec);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tconsole.log(\"tarRec Not OK:\",VisibleAnalyser.tarRec);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif (VisibleAnalyser.isTarRecOK){\r\n\t\t\t\tvar tRec;\r\n\t\t\t\ttRec=NodeUtils.getGRec(node);\r\n\t\t\t\tVisibleAnalyser.interRec=VisibleAnalyser.tarRec.intersection(tRec,VisibleAnalyser.interRec);\r\n\t\t\t\tif (VisibleAnalyser.interRec && VisibleAnalyser.interRec.width > 0 && VisibleAnalyser.interRec.height > 0){\r\n\t\t\t\t\tVisibleAnalyser.tColor++;\r\n\t\t\t\t\tCanvasTools.fillCanvasRec(VisibleAnalyser.mainCanvas,tRec,ColorTool.toHexColor(VisibleAnalyser.tColor));\r\n\t\t\t\t\tVisibleAnalyser.tImageData=CanvasTools.getImageDataFromCanvasByRec(VisibleAnalyser.mainCanvas,VisibleAnalyser.tarRec);\r\n\t\t\t\t\tvar dRate=NaN;\r\n\t\t\t\t\tdRate=CanvasTools.getDifferRate(VisibleAnalyser.preImageData,VisibleAnalyser.tImageData);\r\n\t\t\t\t\tVisibleAnalyser.preImageData=VisibleAnalyser.tImageData;\r\n\t\t\t\t\tVisibleAnalyser.addCoverNode(node,dRate);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tVisibleAnalyser.filterFun=function(node){\r\n\t\tif (node.visible==false)\r\n\t\t\treturn false;\r\n\t\tif (node.alpha < 0)\r\n\t\t\treturn false;\r\n\t\tif (DebugInfoLayer.I.isDebugItem(node))return false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tVisibleAnalyser.isNodeWalked=false;\r\n\tVisibleAnalyser._analyseTarget=null;\r\n\tVisibleAnalyser.isTarRecOK=false;\r\n\tVisibleAnalyser.mainCanvas=null;\r\n\tVisibleAnalyser.preImageData=null;\r\n\tVisibleAnalyser.tImageData=null;\r\n\tVisibleAnalyser.tarImageData=null;\r\n\tVisibleAnalyser.coverRate=NaN;\r\n\tVisibleAnalyser.tColor=0;\r\n\tVisibleAnalyser._coverList=[];\r\n\t__static(VisibleAnalyser,\r\n\t['tarRec',function(){return this.tarRec=new Rectangle();},'interRec',function(){return this.interRec=new Rectangle();}\r\n\t]);\r\n\treturn VisibleAnalyser;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-24 下午6:15:01\r\n*/\r\n//class laya.debug.tools.WalkTools\r\nvar WalkTools=(function(){\r\n\tfunction WalkTools(){}\r\n\t__class(WalkTools,'laya.debug.tools.WalkTools');\r\n\tWalkTools.walkTarget=function(target,fun,_this){\r\n\t\tfun.apply(_this,[target]);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tChild;\r\n\t\tlen=target.numChildren;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttChild=target.getChildAt(i);\r\n\t\t\tWalkTools.walkTarget(tChild,fun,tChild);\r\n\t\t}\r\n\t}\r\n\r\n\tWalkTools.walkTargetEX=function(target,fun,_this,filterFun){\r\n\t\tif (filterFun !=null && !filterFun(target))return;\r\n\t\tfun.apply(_this,[target]);\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tvar tChild;\r\n\t\tvar childs;\r\n\t\tchilds=target._childs;\r\n\t\tlen=childs.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttChild=childs[i];\r\n\t\t\tWalkTools.walkTarget(tChild,fun,tChild);\r\n\t\t}\r\n\t}\r\n\r\n\tWalkTools.walkChildren=function(target,fun,_this){\r\n\t\tif(!target||target.numChildren<1)return;\r\n\t\tWalkTools.walkArr(DisControlTool.getAllChild(target),fun,_this);\r\n\t}\r\n\r\n\tWalkTools.walkArr=function(arr,fun,_this){\r\n\t\tif(!arr)return;\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=arr.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tfun.apply(_this,[arr[i],i]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn WalkTools;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于监控对象值变化\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-23 下午4:18:27\r\n*/\r\n//class laya.debug.tools.Watcher\r\nvar Watcher=(function(){\r\n\tfunction Watcher(){}\r\n\t__class(Watcher,'laya.debug.tools.Watcher');\r\n\tWatcher.watch=function(obj,name,funs){\r\n\t\tVarHook.hookVar(obj,name,funs);\r\n\t}\r\n\r\n\tWatcher.traceChange=function(obj,name,sign){\r\n\t\t(sign===void 0)&& (sign=\"var changed:\");\r\n\t\tVarHook.hookVar(obj,name,[Watcher.getTraceValueFun(name),VarHook.getLocFun(sign)]);\r\n\t}\r\n\r\n\tWatcher.debugChange=function(obj,name){\r\n\t\tVarHook.hookVar(obj,name,[VarHook.getLocFun(\"debug loc\"),FunHook.debugHere]);\r\n\t}\r\n\r\n\tWatcher.differChange=function(obj,name,sign,msg){\r\n\t\t(msg===void 0)&& (msg=\"\");\r\n\t\tVarHook.hookVar(obj,name,[Watcher.getDifferFun(obj,name,sign,msg)]);\r\n\t}\r\n\r\n\tWatcher.getDifferFun=function(obj,name,sign,msg){\r\n\t\t(msg===void 0)&& (msg=\"\");\r\n\t\tvar rst;\r\n\t\trst=function (){\r\n\t\t\tDifferTool.differ(sign,obj[name],msg);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tWatcher.traceValue=function(value){\r\n\t\tconsole.log(\"value:\",value);\r\n\t}\r\n\r\n\tWatcher.getTraceValueFun=function(name){\r\n\t\tvar rst;\r\n\t\trst=function (value){\r\n\t\t\tconsole.log(\"set \"+name+\" :\",value);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn Watcher;\r\n})()\r\n\r\n\r\n/**\r\n*XML转Object类\r\n*@author ww\r\n*\r\n*/\r\n//class laya.debug.tools.XML2Object\r\nvar XML2Object=(function(){\r\n\tfunction XML2Object(){}\r\n\t__class(XML2Object,'laya.debug.tools.XML2Object');\r\n\t__getset(1,XML2Object,'arrays',function(){\r\n\t\tif(!XML2Object._arrays){\r\n\t\t\tXML2Object._arrays=[];\r\n\t\t}\r\n\t\treturn XML2Object._arrays;\r\n\t\t},function(a){\r\n\t\tXML2Object._arrays=a;\r\n\t});\r\n\r\n\tXML2Object.parse=function(node,isFirst){\r\n\t\t(isFirst===void 0)&& (isFirst=true);\r\n\t\tvar obj={};\r\n\t\tif(isFirst)\r\n\t\t\tobj.Name=node.localName;\r\n\t\tvar numOfChilds=node.children.length;\r\n\t\tvar childs=[];\r\n\t\tvar children={};\r\n\t\tobj.c=children;\r\n\t\tobj.cList=childs;\r\n\t\tfor(var i=0;i<numOfChilds;i++){\r\n\t\t\tvar childNode=node.children[i];\r\n\t\t\tvar childNodeName=childNode.localName;\r\n\t\t\tvar value;\r\n\t\t\tvar numOfAttributes\r\n\t\t\tvalue=XML2Object.parse(childNode,true);\r\n\t\t\tchilds.push(value);\r\n\t\t\tif(children[childNodeName]){\r\n\t\t\t\tif(XML2Object.getTypeof(children[childNodeName])==\"array\"){\r\n\t\t\t\t\tchildren[childNodeName].push(value);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tchildren[childNodeName]=[children[childNodeName],value];\r\n\t\t\t\t}\r\n\t\t\t\t}else if(XML2Object.isArray(childNodeName)){\r\n\t\t\t\tchildren[childNodeName]=[value];\r\n\t\t\t\t}else {\r\n\t\t\t\tchildren[childNodeName]=value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tnumOfAttributes=0;\r\n\t\tif(node.attributes){\r\n\t\t\tnumOfAttributes=node.attributes.length;\r\n\t\t\tvar prop={};\r\n\t\t\tobj.p=prop;\r\n\t\t\tfor(i=0;i<numOfAttributes;i++){\r\n\t\t\t\tprop[node.attributes[i].name.toString()]=String(node.attributes[i].nodeValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(numOfChilds==0){\r\n\t\t\tif(numOfAttributes==0){\r\n\t\t\t\tobj=\"\";\r\n\t\t\t}else {}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tXML2Object.getArr=function(v){\r\n\t\tif(!v)return [];\r\n\t\tif(XML2Object.getTypeof(v)==\"array\")return v;\r\n\t\treturn [v];\r\n\t}\r\n\r\n\tXML2Object.isArray=function(nodeName){\r\n\t\tvar numOfArrays=XML2Object._arrays ? XML2Object._arrays.length :0;\r\n\t\tfor(var i=0;i<numOfArrays;i++){\r\n\t\t\tif(nodeName==XML2Object._arrays[i]){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tXML2Object.getTypeof=function(o){\r\n\t\tif(typeof(o)==\"object\"){\r\n\t\t\tif(o.length==null){\r\n\t\t\t\treturn \"object\";\r\n\t\t\t\t}else if(typeof(o.length)==\"number\"){\r\n\t\t\t\treturn \"array\";\r\n\t\t\t\t}else {\r\n\t\t\t\treturn \"object\";\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\treturn typeof(o);\r\n\t\t}\r\n\t}\r\n\r\n\tXML2Object._arrays=null;\r\n\treturn XML2Object;\r\n})()\r\n\r\n\r\n/**\r\n*XML转Object类\r\n*@author ww\r\n*\r\n*/\r\n//class laya.debug.tools.XML2ObjectNodejs\r\nvar XML2ObjectNodejs=(function(){\r\n\tfunction XML2ObjectNodejs(){}\r\n\t__class(XML2ObjectNodejs,'laya.debug.tools.XML2ObjectNodejs');\r\n\t__getset(1,XML2ObjectNodejs,'arrays',function(){\r\n\t\tif(!XML2ObjectNodejs._arrays){\r\n\t\t\tXML2ObjectNodejs._arrays=[];\r\n\t\t}\r\n\t\treturn XML2ObjectNodejs._arrays;\r\n\t\t},function(a){\r\n\t\tXML2ObjectNodejs._arrays=a;\r\n\t});\r\n\r\n\tXML2ObjectNodejs.parse=function(node,isFirst){\r\n\t\t(isFirst===void 0)&& (isFirst=true);\r\n\t\tvar obj={};\r\n\t\tif(isFirst)\r\n\t\t\tobj.Name=node.localName;\r\n\t\tvar numOfChilds=node[XML2ObjectNodejs.ChildrenSign]?node[XML2ObjectNodejs.ChildrenSign].length:0;\r\n\t\tvar childs=[];\r\n\t\tvar children={};\r\n\t\tobj.c=children;\r\n\t\tobj.cList=childs;\r\n\t\tfor(var i=0;i<numOfChilds;i++){\r\n\t\t\tvar childNode=node[XML2ObjectNodejs.ChildrenSign][i];\r\n\t\t\tvar childNodeName=childNode.localName;\r\n\t\t\tvar value;\r\n\t\t\tvar numOfAttributes=0\r\n\t\t\tif (!childNodeName)continue ;\r\n\t\t\tvalue=XML2ObjectNodejs.parse(childNode,true);\r\n\t\t\tchilds.push(value);\r\n\t\t\tif(children[childNodeName]){\r\n\t\t\t\tif(XML2ObjectNodejs.getTypeof(children[childNodeName])==\"array\"){\r\n\t\t\t\t\tchildren[childNodeName].push(value);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tchildren[childNodeName]=[children[childNodeName],value];\r\n\t\t\t\t}\r\n\t\t\t\t}else if(XML2ObjectNodejs.isArray(childNodeName)){\r\n\t\t\t\tchildren[childNodeName]=[value];\r\n\t\t\t\t}else {\r\n\t\t\t\tchildren[childNodeName]=value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tnumOfAttributes=0;\r\n\t\tif(node.attributes){\r\n\t\t\tnumOfAttributes=node.attributes.length;\r\n\t\t\tvar prop={};\r\n\t\t\tobj.p=prop;\r\n\t\t\tfor(i=0;i<numOfAttributes;i++){\r\n\t\t\t\tprop[node.attributes[i].name.toString()]=String(node.attributes[i].nodeValue);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(numOfChilds==0){\r\n\t\t\tif(numOfAttributes==0){\r\n\t\t\t}else {}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tXML2ObjectNodejs.getArr=function(v){\r\n\t\tif(!v)return [];\r\n\t\tif(XML2ObjectNodejs.getTypeof(v)==\"array\")return v;\r\n\t\treturn [v];\r\n\t}\r\n\r\n\tXML2ObjectNodejs.isArray=function(nodeName){\r\n\t\tvar numOfArrays=XML2ObjectNodejs._arrays ? XML2ObjectNodejs._arrays.length :0;\r\n\t\tfor(var i=0;i<numOfArrays;i++){\r\n\t\t\tif(nodeName==XML2ObjectNodejs._arrays[i]){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tXML2ObjectNodejs.getTypeof=function(o){\r\n\t\tif(typeof(o)==\"object\"){\r\n\t\t\tif(o.length==null){\r\n\t\t\t\treturn \"object\";\r\n\t\t\t\t}else if(typeof(o.length)==\"number\"){\r\n\t\t\t\treturn \"array\";\r\n\t\t\t\t}else {\r\n\t\t\t\treturn \"object\";\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\treturn typeof(o);\r\n\t\t}\r\n\t}\r\n\r\n\tXML2ObjectNodejs._arrays=null;\r\n\tXML2ObjectNodejs.ChildrenSign=\"childNodes\";\r\n\treturn XML2ObjectNodejs;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.menus.NodeMenu\r\nvar NodeMenu=(function(){\r\n\tfunction NodeMenu(){\r\n\t\tthis._tar=null;\r\n\t\tthis._menu=null;\r\n\t\tthis._shareBtns=[\r\n\t\t\"信息面板\",\r\n\t\t\"边框\",\r\n\t\t\"进入节点\",\r\n\t\t\"树定位\",\r\n\t\t\"Enable链\",\r\n\t\t\"Size链\",\r\n\t\t\"节点工具\",\r\n\t\t\"可见分析\",\r\n\t\t\"输出到控制台\"];\r\n\t\tthis._menuItems=[\"隐藏节点\"];\r\n\t\tthis._menuHide=null;\r\n\t\tthis._menuItemsHide=[\"显示节点\"];\r\n\t\tthis._menu1=null;\r\n\t\tthis._menuItems1=[\"输出到控制台\"];\r\n\t}\r\n\r\n\t__class(NodeMenu,'laya.debug.view.nodeInfo.menus.NodeMenu');\r\n\tvar __proto=NodeMenu.prototype;\r\n\t__proto.showNodeMenu=function(node){\r\n\t\tif (!node._style){\r\n\t\t\tDebugTool.log(\"该节点已不存在，请刷新列表\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._tar=node;\r\n\t\tif (!this._menu){\r\n\t\t\tthis._menuItems=this._menuItems.concat(this._shareBtns);\r\n\t\t\tthis._menu=ContextMenu.createMenuByArray(this._menuItems);\r\n\t\t\tthis._menu.on(/*laya.events.Event.SELECT*/\"select\",this,this.onEmunSelect);\r\n\t\t\tthis._menuItemsHide=this._menuItemsHide.concat(this._shareBtns);\r\n\t\t\tthis._menuHide=ContextMenu.createMenuByArray(this._menuItemsHide);\r\n\t\t\tthis._menuHide.on(/*laya.events.Event.SELECT*/\"select\",this,this.onEmunSelect);\r\n\t\t}\r\n\t\tif (node.visible){\r\n\t\t\tthis._menu.show();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis._menuHide.show();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.nodeDoubleClick=function(node){\r\n\t\tNodeToolView.I.showByNode(node);\r\n\t}\r\n\r\n\t__proto.setNodeListDoubleClickAction=function(list){\r\n\t\tif (Browser.onMobile)return;\r\n\t\tlist.on(/*laya.events.Event.DOUBLE_CLICK*/\"doubleclick\",this,this.onListDoubleClick,[list]);\r\n\t}\r\n\r\n\t__proto.onListDoubleClick=function(list){\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tlaya.debug.view.nodeInfo.menus.NodeMenu.I.nodeDoubleClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setNodeListAction=function(list){\r\n\t\tlist.on(DebugTool.getMenuShowEvent(),this,this.onListRightClick,[list]);\r\n\t}\r\n\r\n\t//setNodeListDoubleClickAction(list);\r\n\t__proto.onListRightClick=function(list){\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tlaya.debug.view.nodeInfo.menus.NodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.objRightClick=function(obj){\r\n\t\tif ((obj instanceof laya.display.Sprite )){\r\n\t\t\tlaya.debug.view.nodeInfo.menus.NodeMenu.I.showNodeMenu(obj);\r\n\t\t}\r\n\t\telse if ((typeof obj=='object')){\r\n\t\t\tlaya.debug.view.nodeInfo.menus.NodeMenu.I.showObjectMenu(obj);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.showObjectMenu=function(obj){\r\n\t\tthis._tar=obj;\r\n\t\tif (!this._menu1){\r\n\t\t\tthis._menu1=ContextMenu.createMenuByArray(this._menuItems1);\r\n\t\t\tthis._menu1.on(/*laya.events.Event.SELECT*/\"select\",this,this.onEmunSelect);\r\n\t\t}\r\n\t\tthis._menu1.show();\r\n\t}\r\n\r\n\t__proto.onEmunSelect=function(e){\r\n\t\tvar data=(e.target).data;\r\n\t\tif ((typeof data=='string')){\r\n\t\t\tvar key;\r\n\t\t\tkey=data;\r\n\t\t\tswitch (key){\r\n\t\t\t\tcase \"信息面板\":\r\n\t\t\t\t\tObjectInfoView.showObject(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"边框\":\r\n\t\t\t\t\tDebugTool.showDisBound(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"输出到控制台\":\r\n\t\t\t\t\tconsole.log(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"树节点\":\r\n\t\t\t\t\tToolPanel.I.showNodeTree(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"进入节点\":\r\n\t\t\t\t\tToolPanel.I.showNodeTree(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"树定位\":\r\n\t\t\t\t\tToolPanel.I.showSelectInStage(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"Enable链\":\r\n\t\t\t\t\tOutPutView.I.dTrace(DebugTool.traceDisMouseEnable(this._tar));\r\n\t\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"Size链\":\r\n\t\t\t\t\tOutPutView.I.dTrace(DebugTool.traceDisSizeChain(this._tar));\r\n\t\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"节点工具\":\r\n\t\t\t\t\tNodeToolView.I.showByNode(this._tar);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"显示节点\":\r\n\t\t\t\t\tthis._tar.visible=true;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"隐藏节点\":\r\n\t\t\t\t\tthis._tar.visible=false;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"可见分析\":\r\n\t\t\t\t\tif (this._tar){\r\n\t\t\t\t\t\tVisibleAnalyser.analyseTarget(this._tar);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__getset(1,NodeMenu,'I',function(){\r\n\t\tif (!NodeMenu._I)\r\n\t\t\tNodeMenu._I=new NodeMenu();\r\n\t\treturn NodeMenu._I;\r\n\t});\r\n\r\n\tNodeMenu._I=null;\r\n\treturn NodeMenu;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.NodeConsts\r\nvar NodeConsts=(function(){\r\n\tfunction NodeConsts(){}\r\n\t__class(NodeConsts,'laya.debug.view.nodeInfo.NodeConsts');\r\n\tNodeConsts.defaultFitlerStr=\"x,y,width,height,scaleX,scaleY,alpha,renderCost\";\r\n\tNodeConsts.RenderCostMaxTime=3000;\r\n\treturn NodeConsts;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.NodeUtils\r\nvar NodeUtils=(function(){\r\n\tfunction NodeUtils(){}\r\n\t__class(NodeUtils,'laya.debug.view.nodeInfo.NodeUtils');\r\n\tNodeUtils.getFilterdTree=function(sprite,keys){\r\n\t\tif (!keys)\r\n\t\t\tkeys=NodeUtils.defaultKeys;\r\n\t\tvar me;\r\n\t\tme={};\r\n\t\tvar key;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=keys[i];\r\n\t\t\tme[key]=sprite[key];\r\n\t\t};\r\n\t\tvar cList;\r\n\t\tvar tChild;\r\n\t\tcList=sprite._childs;\r\n\t\tlen=cList.length;\r\n\t\tvar mClist;\r\n\t\tmClist=[];\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=cList[i];\r\n\t\t\tmClist.push(NodeUtils.getFilterdTree(tChild,keys));\r\n\t\t}\r\n\t\tme.childs=mClist;\r\n\t\treturn me;\r\n\t}\r\n\r\n\tNodeUtils.getPropertyDesO=function(tValue,keys){\r\n\t\tif (!keys)\r\n\t\t\tkeys=NodeUtils.defaultKeys;\r\n\t\tvar rst={};\r\n\t\tif ((typeof tValue=='object')){\r\n\t\t\trst.label=\"\"+ClassTool.getNodeClassAndName(tValue);\r\n\t\t}\r\n\t\telse{\r\n\t\t\trst.label=\"\"+tValue;\r\n\t\t}\r\n\t\trst.type=\"\";\r\n\t\trst.path=tValue;\r\n\t\trst.childs=[];\r\n\t\trst.isDirectory=false;\r\n\t\tvar key;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tChild;\r\n\t\tif ((tValue instanceof laya.display.Node )){\r\n\t\t\trst.des=ClassTool.getNodeClassAndName(tValue);\r\n\t\t\trst.isDirectory=true;\r\n\t\t\tlen=keys.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tkey=keys[i];\r\n\t\t\t\ttChild=NodeUtils.getPropertyDesO(tValue[key],keys);\r\n\t\t\t\tif (tValue.hasOwnProperty(key)){\r\n\t\t\t\t\ttChild.label=\"\"+key+\":\"+tChild.des;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\ttChild.label=\"\"+key+\":\"+ObjectInfoView.getNodeValue(tValue,key);\r\n\t\t\t\t}\r\n\t\t\t\trst.childs.push(tChild);\r\n\t\t\t}\r\n\t\t\tkey=\"_childs\";\r\n\t\t\ttChild=NodeUtils.getPropertyDesO(tValue[key],keys);\r\n\t\t\ttChild.label=\"\"+key+\":\"+tChild.des;\r\n\t\t\ttChild.isChilds=true;\r\n\t\t\trst.childs.push(tChild);\r\n\t\t}\r\n\t\telse if ((tValue instanceof Array)){\r\n\t\t\trst.des=\"Array[\"+(tValue).length+\"]\";\r\n\t\t\trst.isDirectory=true;\r\n\t\t\tvar tList;\r\n\t\t\ttList=tValue;\r\n\t\t\tlen=tList.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttChild=NodeUtils.getPropertyDesO(tList[i],keys);\r\n\t\t\t\ttChild.label=\"\"+i+\":\"+tChild.des;\r\n\t\t\t\trst.childs.push(tChild);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ((typeof tValue=='object')){\r\n\t\t\trst.des=ClassTool.getNodeClassAndName(tValue);\r\n\t\t\trst.isDirectory=true;\r\n\t\t\tfor (key in tValue){\r\n\t\t\t\ttChild=NodeUtils.getPropertyDesO(tValue[key],keys);\r\n\t\t\t\ttChild.label=\"\"+key+\":\"+tChild.des;\r\n\t\t\t\trst.childs.push(tChild);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\trst.des=\"\"+tValue;\r\n\t\t}\r\n\t\trst.hasChild=rst.childs.length > 0;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.adptShowKeys=function(keys){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=keys.length;\r\n\t\tfor (i=len-1;i >=0;i--){\r\n\t\t\tkeys[i]=StringTool.trimSide(keys[i]);\r\n\t\t\tif (keys[i].length < 1){\r\n\t\t\t\tkeys.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keys;\r\n\t}\r\n\r\n\tNodeUtils.getNodeTreeData=function(sprite,keys){\r\n\t\tNodeUtils.adptShowKeys(keys);\r\n\t\tvar treeO;\r\n\t\ttreeO=NodeUtils.getPropertyDesO(sprite,keys);\r\n\t\tvar treeArr;\r\n\t\ttreeArr=[];\r\n\t\tNodeUtils.getTreeArr(treeO,treeArr);\r\n\t\treturn treeArr;\r\n\t}\r\n\r\n\tNodeUtils.getTreeArr=function(treeO,arr,add){\r\n\t\t(add===void 0)&& (add=true);\r\n\t\tif (add)\r\n\t\t\tarr.push(treeO);\r\n\t\tvar tArr=treeO.childs;\r\n\t\tvar i=0,len=tArr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (!add){\r\n\t\t\t\ttArr[i].nodeParent=null;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttArr[i].nodeParent=treeO;\r\n\t\t\t}\r\n\t\t\tif (tArr[i].isDirectory){\r\n\t\t\t\tNodeUtils.getTreeArr(tArr[i],arr);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tarr.push(tArr[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tNodeUtils.traceStage=function(){\r\n\t\tconsole.log(NodeUtils.getFilterdTree(Laya.stage,null));\r\n\t\tconsole.log(\"treeArr:\",NodeUtils.getNodeTreeData(Laya.stage,null));\r\n\t}\r\n\r\n\tNodeUtils.getNodeCount=function(node,visibleRequire){\r\n\t\t(visibleRequire===void 0)&& (visibleRequire=false);\r\n\t\tif (visibleRequire){\r\n\t\t\tif (!node.visible)return 0;\r\n\t\t};\r\n\t\tvar rst=0;\r\n\t\trst=1;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=node._childs;\r\n\t\tlen=cList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst+=NodeUtils.getNodeCount(cList[i],visibleRequire);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.getGVisible=function(node){\r\n\t\twhile (node){\r\n\t\t\tif (!node.visible)return false;\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tNodeUtils.getGAlpha=function(node){\r\n\t\tvar rst=NaN;\r\n\t\trst=1;\r\n\t\twhile (node){\r\n\t\t\trst *=node.alpha;\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.getGPos=function(node){\r\n\t\tvar point;\r\n\t\tpoint=new Point();\r\n\t\tnode.localToGlobal(point);\r\n\t\treturn point;\r\n\t}\r\n\r\n\tNodeUtils.getGRec=function(node){\r\n\t\tvar pointList;\r\n\t\tpointList=node._getBoundPointsM(true);\r\n\t\tif (!pointList || pointList.length < 1)\r\n\t\t\treturn Rectangle.TEMP.setTo(0,0,0,0);\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,node.localToGlobal,node);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tvar _disBoundRec;\r\n\t\t_disBoundRec=Rectangle._getWrapRec(pointList,_disBoundRec);\r\n\t\treturn _disBoundRec;\r\n\t}\r\n\r\n\tNodeUtils.getGGraphicRec=function(node){\r\n\t\tvar pointList;\r\n\t\tpointList=node.getGraphicBounds()._getBoundPoints();\r\n\t\tif (!pointList || pointList.length < 1)\r\n\t\t\treturn Rectangle.TEMP.setTo(0,0,0,0);\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,node.localToGlobal,node);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tvar _disBoundRec;\r\n\t\t_disBoundRec=Rectangle._getWrapRec(pointList,_disBoundRec);\r\n\t\treturn _disBoundRec;\r\n\t}\r\n\r\n\tNodeUtils.getNodeCmdCount=function(node){\r\n\t\tvar rst=0;\r\n\t\tif (node.graphics){\r\n\t\t\tif (node.graphics.cmds){\r\n\t\t\t\trst=node.graphics.cmds.length;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif (node.graphics._one){\r\n\t\t\t\t\trst=1;\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\trst=0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\trst=0;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.getNodeCmdTotalCount=function(node){\r\n\t\tvar rst=0;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=node._childs;\r\n\t\tlen=cList.length;\r\n\t\trst=NodeUtils.getNodeCmdCount(node);\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst+=NodeUtils.getNodeCmdTotalCount(cList[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.getRenderNodeCount=function(node){\r\n\t\tif (node.cacheAs !=\"none\")return 1;\r\n\t\tvar rst=0;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=node._childs;\r\n\t\tlen=cList.length;\r\n\t\trst=1;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst+=NodeUtils.getRenderNodeCount(cList[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.getReFreshRenderNodeCount=function(node){\r\n\t\tvar rst=0;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=node._childs;\r\n\t\tlen=cList.length;\r\n\t\trst=1;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst+=NodeUtils.getRenderNodeCount(cList[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeUtils.showCachedSpriteRecs=function(){\r\n\t\tNodeUtils.g=DebugInfoLayer.I.graphicLayer.graphics;\r\n\t\tNodeUtils.g.clear();\r\n\t\tWalkTools.walkTarget(Laya.stage,NodeUtils.drawCachedBounds,null);\r\n\t}\r\n\r\n\tNodeUtils.drawCachedBounds=function(sprite){\r\n\t\tif (sprite.cacheAs==\"none\")return;\r\n\t\tif (DebugInfoLayer.I.isDebugItem(sprite))return;\r\n\t\tvar rec;\r\n\t\trec=NodeUtils.getGRec(sprite);\r\n\t\tNodeUtils.g.drawRect(rec.x,rec.y,rec.width,rec.height,null,\"#0000ff\",2);\r\n\t}\r\n\r\n\tNodeUtils.g=null;\r\n\t__static(NodeUtils,\r\n\t['defaultKeys',function(){return this.defaultKeys=[\"x\",\"y\",\"width\",\"height\"];}\r\n\t]);\r\n\treturn NodeUtils;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.StyleConsts\r\nvar StyleConsts=(function(){\r\n\tfunction StyleConsts(){}\r\n\t__class(StyleConsts,'laya.debug.view.StyleConsts');\r\n\tStyleConsts.setViewScale=function(view){\r\n\t\tview.scaleX=view.scaleY=StyleConsts.PanelScale;\r\n\t}\r\n\r\n\t__static(StyleConsts,\r\n\t['PanelScale',function(){return this.PanelScale=Browser.onPC?1:Browser.pixelRatio;}\r\n\t]);\r\n\treturn StyleConsts;\r\n})()\r\n\r\n\r\n/**\r\n*本类用于模块间消息传递\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.Notice extends laya.events.EventDispatcher\r\nvar Notice=(function(_super){\r\n\tfunction Notice(){\r\n\t\tNotice.__super.call(this);\r\n\t}\r\n\r\n\t__class(Notice,'laya.debug.tools.Notice',_super);\r\n\tNotice.notify=function(type,data){\r\n\t\tNotice.I.event(type,data);\r\n\t}\r\n\r\n\tNotice.listen=function(type,_scope,fun,args,cancelBefore){\r\n\t\t(cancelBefore===void 0)&& (cancelBefore=false);\r\n\t\tif(cancelBefore)Notice.cancel(type,_scope,fun);\r\n\t\tNotice.I.on(type,_scope,fun,args);\r\n\t}\r\n\r\n\tNotice.cancel=function(type,_scope,fun){\r\n\t\tNotice.I.off(type,_scope,fun);\r\n\t}\r\n\r\n\t__static(Notice,\r\n\t['I',function(){return this.I=new Notice();}\r\n\t]);\r\n\treturn Notice;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.enginehook.LoaderHook extends laya.net.LoaderManager\r\nvar LoaderHook=(function(_super){\r\n\tfunction LoaderHook(){\r\n\t\tLoaderHook.__super.call(this);\r\n\t}\r\n\r\n\t__class(LoaderHook,'laya.debug.tools.enginehook.LoaderHook',_super);\r\n\tvar __proto=LoaderHook.prototype;\r\n\t__proto.checkUrls=function(url){\r\n\t\tvar tarUrl;\r\n\t\tif ((typeof url=='string')){\r\n\t\t\ttarUrl=url;\r\n\t\t\t}else{\r\n\t\t\ttarUrl=url.url;\r\n\t\t}\r\n\t\tif (LoaderHook.preFails[tarUrl]){\r\n\t\t\tif (LoaderHook.enableFailDebugger){\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.chekUrlList=function(urls){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=urls.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis.checkUrls(urls[i]);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.load=function(url,complete,progress,type,priority,cache,group,ignoreCache){\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\tif ((url instanceof Array)){\r\n\t\t\tthis.chekUrlList(url);\r\n\t\t\t}else{\r\n\t\t\tthis.checkUrls(url);\r\n\t\t}\r\n\t\treturn _super.prototype.load.call(this,url,complete,progress,type,priority,cache,group,ignoreCache);\r\n\t}\r\n\r\n\tLoaderHook.init=function(){\r\n\t\tif (LoaderHook.isInited)return;\r\n\t\tLoaderHook.isInited=true;\r\n\t\tLaya.loader=new LoaderHook();\r\n\t\tLaya.loader.on(/*laya.events.Event.ERROR*/\"error\",null,LoaderHook.onFail);\r\n\t\tLoaderHook.preFails=LocalStorage.getJSON(\"LoadFailItems\");\r\n\t\tif (!LoaderHook.preFails)LoaderHook.preFails={};\r\n\t}\r\n\r\n\tLoaderHook.onFail=function(failFile){\r\n\t\tOutPutView.I.dTrace(\"LoadFail:\"+failFile);\r\n\t\tLoaderHook.nowFails[failFile]=true;\r\n\t\tLocalStorage.setJSON(\"LoadFailItems\",LoaderHook.nowFails);\r\n\t}\r\n\r\n\tLoaderHook.resetFails=function(){\r\n\t\tLoaderHook.nowFails={};\r\n\t\tLocalStorage.setJSON(\"LoadFailItems\",LoaderHook.nowFails);\r\n\t}\r\n\r\n\tLoaderHook.preFails={};\r\n\tLoaderHook.nowFails={};\r\n\tLoaderHook.enableFailDebugger=true;\r\n\tLoaderHook.FailSign=\"LoadFailItems\";\r\n\tLoaderHook.isInited=false;\r\n\treturn LoaderHook;\r\n})(LoaderManager)\r\n\r\n\r\n/**\r\n*颜色选取类\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.ColorSelector extends laya.display.Sprite\r\nvar ColorSelector=(function(_super){\r\n\tfunction ColorSelector(){\r\n\t\tthis.sideColor=null;\r\n\t\tthis.mainColor=null;\r\n\t\tthis.demoColor=null;\r\n\t\tthis.posSp=null;\r\n\t\tthis.hPos=null;\r\n\t\tthis.container=null;\r\n\t\tthis.isChanging=false;\r\n\t\tthis.tColor=null;\r\n\t\tthis.tH=NaN;\r\n\t\tColorSelector.__super.call(this);\r\n\t\tthis.container=this;\r\n\t\tthis.createUI();\r\n\t}\r\n\r\n\t__class(ColorSelector,'laya.debug.tools.ColorSelector',_super);\r\n\tvar __proto=ColorSelector.prototype;\r\n\t__proto.createUI=function(){\r\n\t\tthis.sideColor=new Sprite();\r\n\t\tthis.container.addChild(this.sideColor);\r\n\t\tthis.posSp=new Sprite();\r\n\t\tthis.posSp.pos(100,100);\r\n\t\tthis.posSp.graphics.drawCircle(0,0,5,null,\"#ff0000\");\r\n\t\tthis.posSp.graphics.drawCircle(0,0,6,null,\"#ffff00\");\r\n\t\tthis.posSp.autoSize=true;\r\n\t\tthis.posSp.cacheAsBitmap=true;\r\n\t\tthis.sideColor.addChild(this.posSp);\r\n\t\tthis.sideColor.pos(0,0);\r\n\t\tthis.sideColor.size(150,150);\r\n\t\tthis.sideColor.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.sideColorClick);\r\n\t\tvar i=0;\r\n\t\tthis.mainColor=new Sprite();\r\n\t\tvar g;\r\n\t\tg=this.mainColor.graphics;\r\n\t\tvar h=NaN;\r\n\t\tvar s=NaN;\r\n\t\tvar b=NaN;\r\n\t\tvar rgb;\r\n\t\tfor (i=0;i < 150;i++){\r\n\t\t\trgb=ColorTool.hsb2rgb(i/150*360,1,1);\r\n\t\t\tg.drawLine(0,i,20,i,ColorTool.getRGBStr(rgb));\r\n\t\t}\r\n\t\tthis.mainColor.pos(150+10,0);\r\n\t\tthis.mainColor.size(20,i);\r\n\t\tthis.mainColor.cacheAsBitmap=true;\r\n\t\tthis.hPos=new Sprite();\r\n\t\tthis.hPos.graphics.drawPie(0,0,10,-10,10,\"#ff0000\");\r\n\t\tthis.hPos.x=this.mainColor.x+22;\r\n\t\tthis.container.addChild(this.hPos);\r\n\t\tthis.container.addChild(this.mainColor);\r\n\t\tthis.mainColor.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.mainColorClick);\r\n\t\tthis.demoColor=new Sprite();\r\n\t\tthis.demoColor.pos(this.sideColor.x,this.sideColor.y+this.sideColor.height+10);\r\n\t\tthis.demoColor.size(150,20);\r\n\t\tthis.container.addChild(this.demoColor);\r\n\t\tthis.setColorByRGBStr(\"#099599\");\r\n\t\tthis.posSp.on(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",this,this.posDraging);\r\n\t}\r\n\r\n\t// posSp.on(Event.MOUSE_DOWN,this,posMouseDown);\r\n\t__proto.posMouseDown=function(e){}\r\n\t__proto.posDraging=function(){\r\n\t\tthis.updatePosSpAndShowColor();\r\n\t}\r\n\r\n\t__proto.posDragEnd=function(){\r\n\t\tthis.isChanging=false;\r\n\t\tthis.updatePosSpAndShowColor();\r\n\t}\r\n\r\n\t__proto.setColorByRGBStr=function(rgbStr){\r\n\t\tvar rgb;\r\n\t\trgb=ColorTool.getRGBByRGBStr(rgbStr);\r\n\t\tthis.setColor(rgb[0],rgb[1],rgb[2]);\r\n\t}\r\n\r\n\t__proto.setColor=function(red,green,blue,notice){\r\n\t\t(notice===void 0)&& (notice=true);\r\n\t\tvar hsb;\r\n\t\thsb=ColorTool.rgb2hsb(red,green,blue);\r\n\t\tvar tRGB;\r\n\t\ttRGB=ColorTool.hsb2rgb(hsb[0],hsb[1],hsb[2]);\r\n\t\tthis.setColorByHSB(hsb[0],hsb[1],hsb[2],notice);\r\n\t}\r\n\r\n\t__proto.setColorByHSB=function(h,s,b,notice){\r\n\t\t(notice===void 0)&& (notice=true);\r\n\t\tthis.hPos.y=this.mainColor.y+h/360*150;\r\n\t\tthis.posSp.x=s *150;\r\n\t\tthis.posSp.y=(1-b)*150;\r\n\t\tthis.updateSideColor(h,notice);\r\n\t}\r\n\r\n\t__proto.sideColorClick=function(e){\r\n\t\tthis.isChanging=true;\r\n\t\tthis.posSp.startDrag();\r\n\t\tthis.updatePosSpAndShowColor();\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.sideColorMouseUp);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.sideColorMouseUp);\r\n\t}\r\n\r\n\t__proto.sideColorMouseUp=function(e){\r\n\t\tthis.isChanging=false;\r\n\t\tthis.updatePosSpAndShowColor();\r\n\t}\r\n\r\n\t__proto.updatePosSpAndShowColor=function(){\r\n\t\tthis.posSp.x=this.sideColor.mouseX;\r\n\t\tthis.posSp.y=this.sideColor.mouseY;\r\n\t\tif(this.posSp.x<0)this.posSp.x=0;\r\n\t\tif(this.posSp.y<0)this.posSp.y=0;\r\n\t\tif(this.posSp.x>150)this.posSp.x=150;\r\n\t\tif(this.posSp.y>150)this.posSp.y=150;\r\n\t\tthis.updateDemoColor();\r\n\t}\r\n\r\n\t__proto.updateDemoColor=function(notice){\r\n\t\t(notice===void 0)&& (notice=true);\r\n\t\tvar h=NaN;\r\n\t\tvar s=NaN;\r\n\t\tvar b=NaN;\r\n\t\th=this.tH;\r\n\t\ts=this.posSp.x / 150;\r\n\t\tb=1-this.posSp.y / 150;\r\n\t\tthis.tColor=ColorTool.hsb2rgb(h,s,b);\r\n\t\tvar g;\r\n\t\tg=this.demoColor.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this.demoColor.width,this.demoColor.height,ColorTool.getRGBStr(this.tColor));\r\n\t\tif(this.isChanging)return;\r\n\t\tif(notice)\r\n\t\t\tthis.event(\"ColorChanged\",this);\r\n\t}\r\n\r\n\t__proto.mainColorClick=function(e){\r\n\t\tvar yPos=NaN;\r\n\t\tyPos=this.mainColor.mouseY;\r\n\t\tthis.hPos.y=yPos+this.mainColor.y;\r\n\t\tvar h=NaN;\r\n\t\th=yPos / 150 *360;\r\n\t\tthis.updateSideColor(h);\r\n\t}\r\n\r\n\t__proto.updateSideColor=function(h,notice){\r\n\t\t(notice===void 0)&& (notice=true);\r\n\t\tthis.tH=h;\r\n\t\tvar s=NaN;\r\n\t\tvar b=NaN;\r\n\t\tvar g;\r\n\t\tg=this.sideColor.graphics;\r\n\t\tg.clear();\r\n\t\tthis.sideColor.cacheAsBitmap=false;\r\n\t\tvar rgb;\r\n\t\trgb=ColorTool.hsb2rgb(h,1,1);\r\n\t\tvar gradient=Browser.context.createLinearGradient(0,0,80,0);\r\n\t\tgradient.addColorStop(0,\"white\");\r\n\t\tgradient.addColorStop(1,ColorTool.getRGBStr(rgb));\r\n\t\tthis.sideColor.graphics.drawRect(0,0,150,150,gradient);\r\n\t\tthis.sideColor.graphics.loadImage(\"comp/colorpicker_overlay.png\",0,0);\r\n\t\tthis.sideColor.size(150,150);\r\n\t\tthis.sideColor.cacheAsBitmap=true;\r\n\t\tthis.updateDemoColor(notice);\r\n\t}\r\n\r\n\tColorSelector.COLOR_CHANGED=\"ColorChanged\";\r\n\tColorSelector.COLOR_CLEARED=\"COLOR_CLEARED\";\r\n\tColorSelector.RecWidth=150;\r\n\treturn ColorSelector;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-30 下午1:59:34\r\n*/\r\n//class laya.debug.tools.comps.Arrow extends laya.display.Sprite\r\nvar Arrow=(function(_super){\r\n\tfunction Arrow(){\r\n\t\tArrow.__super.call(this);\r\n\t\tthis.drawMe();\r\n\t}\r\n\r\n\t__class(Arrow,'laya.debug.tools.comps.Arrow',_super);\r\n\tvar __proto=Arrow.prototype;\r\n\t__proto.drawMe=function(){\r\n\t\tvar g;\r\n\t\tg=this.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawLine(0,0,-1,-1,\"#ff0000\");\r\n\t\tg.drawLine(0,0,1,-1,\"#ff0000\");\r\n\t}\r\n\r\n\treturn Arrow;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-30 下午2:03:32\r\n*/\r\n//class laya.debug.tools.comps.ArrowLine extends laya.display.Sprite\r\nvar ArrowLine=(function(_super){\r\n\tfunction ArrowLine(sign){\r\n\t\tthis.lineLen=160;\r\n\t\tthis.arrowLen=10;\r\n\t\tthis.sign=\"Y\";\r\n\t\tthis._targetChanger=null;\r\n\t\tthis._isMoving=false;\r\n\t\tthis.lenControl=new Rect();\r\n\t\tthis.rotationControl=new Rect();\r\n\t\tthis.lenChanger=ValueChanger.create(this,\"lineLen\");\r\n\t\tthis.lenControlXChanger=ValueChanger.create(this.lenControl,\"x\");\r\n\t\t(sign===void 0)&& (sign=\"X\");\r\n\t\tArrowLine.__super.call(this);\r\n\t\tthis.sign=sign;\r\n\t\tthis.addChild(this.lenControl);\r\n\t\tthis.addChild(this.rotationControl);\r\n\t\tthis.lenControl.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.controlMouseDown);\r\n\t\tthis.drawMe();\r\n\t}\r\n\r\n\t__class(ArrowLine,'laya.debug.tools.comps.ArrowLine',_super);\r\n\tvar __proto=ArrowLine.prototype;\r\n\t__proto.drawMe=function(){\r\n\t\tvar g;\r\n\t\tg=this.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawLine(0,0,this.lineLen,0,\"#ffff00\");\r\n\t\tg.drawLine(this.lineLen,0,this.lineLen-this.arrowLen,-this.arrowLen,\"#ff0000\");\r\n\t\tg.drawLine(this.lineLen,0,this.lineLen-this.arrowLen,this.arrowLen,\"#ff0000\");\r\n\t\tg.fillText(this.sign,50,-5,\"\",\"#ff0000\",\"left\");\r\n\t\tif(this._isMoving&&this._targetChanger){\r\n\t\t\tg.fillText(this._targetChanger.key+\":\"+this._targetChanger.value.toFixed(2),this.lineLen-15,-25,\"\",\"#ffff00\",\"center\");\r\n\t\t}\r\n\t\tthis.lenControl.posTo(this.lineLen-15,0);\r\n\t\tthis.rotationControl.posTo(this.lineLen+10,0);\r\n\t\tthis.size(this.arrowLen,this.lineLen);\r\n\t}\r\n\r\n\t__proto.clearMoveEvents=function(){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.stageMouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.stageMouseUp);\r\n\t}\r\n\r\n\t__proto.controlMouseDown=function(e){\r\n\t\tthis.clearMoveEvents();\r\n\t\tthis.lenControlXChanger.record();\r\n\t\tthis.lenChanger.record();\r\n\t\tif(this.targetChanger){\r\n\t\t\tthis.targetChanger.record();\r\n\t\t}\r\n\t\tthis._isMoving=true;\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.stageMouseMove);\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.stageMouseUp);\r\n\t}\r\n\r\n\t__proto.stageMouseMove=function(e){\r\n\t\tthis.lenControlXChanger.value=this.mouseX;\r\n\t\tthis.lenChanger.showValueByScale(this.lenControlXChanger.scaleValue);\r\n\t\tif(this.targetChanger){\r\n\t\t\tthis.targetChanger.showValueByScale(this.lenControlXChanger.scaleValue);\r\n\t\t}\r\n\t\tthis.drawMe();\r\n\t}\r\n\r\n\t__proto.stageMouseUp=function(e){\r\n\t\tthis._isMoving=false;\r\n\t\tthis.noticeChange();\r\n\t\tthis.clearMoveEvents();\r\n\t\tthis.lenControlXChanger.recover();\r\n\t\tthis.lenChanger.recover();\r\n\t\tthis.drawMe();\r\n\t}\r\n\r\n\t__proto.noticeChange=function(){\r\n\t\tvar dLen=NaN;\r\n\t\tdLen=this.lenChanger.dValue;\r\n\t\tconsole.log(\"lenChange:\",dLen);\r\n\t}\r\n\r\n\t__getset(0,__proto,'targetChanger',function(){\r\n\t\treturn this._targetChanger;\r\n\t\t},function(changer){\r\n\t\tif(this._targetChanger){\r\n\t\t\tthis._targetChanger.dispose();\r\n\t\t}\r\n\t\tthis._targetChanger=changer;\r\n\t});\r\n\r\n\treturn ArrowLine;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.comps.AutoSizeRec extends laya.display.Sprite\r\nvar AutoSizeRec=(function(_super){\r\n\tfunction AutoSizeRec(type){\r\n\t\tthis.type=0;\r\n\t\tthis._color=\"#ffffff\";\r\n\t\tthis.preX=NaN;\r\n\t\tthis.preY=NaN;\r\n\t\tAutoSizeRec.__super.call(this);\r\n\t}\r\n\r\n\t__class(AutoSizeRec,'laya.debug.tools.comps.AutoSizeRec',_super);\r\n\tvar __proto=AutoSizeRec.prototype;\r\n\t__proto.setColor=function(color){\r\n\t\tthis._color=color;\r\n\t\tthis.reRender();\r\n\t}\r\n\r\n\t__proto.changeSize=function(){\r\n\t\tthis.reRender();\r\n\t}\r\n\r\n\t__proto.reRender=function(){\r\n\t\tvar g=this.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this.width,this.height,this._color);\r\n\t}\r\n\r\n\t__proto.record=function(){\r\n\t\tthis.preX=this.x;\r\n\t\tthis.preY=this.y;\r\n\t}\r\n\r\n\t__proto.getDx=function(){\r\n\t\treturn this.x-this.preX;\r\n\t}\r\n\r\n\t__proto.getDy=function(){\r\n\t\treturn this.y-this.preY;\r\n\t}\r\n\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Sprite,this,'height',value);\r\n\t\tthis.changeSize();\r\n\t});\r\n\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Sprite,this,'width',value);\r\n\t\tthis.changeSize();\r\n\t});\r\n\r\n\treturn AutoSizeRec;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-30 下午2:37:05\r\n*/\r\n//class laya.debug.tools.comps.Axis extends laya.display.Sprite\r\nvar Axis=(function(_super){\r\n\tfunction Axis(){\r\n\t\tthis._target=null;\r\n\t\tthis._lenType=\r\n\t\t[\r\n\t\t[\"width\",\"height\"],\r\n\t\t[\"scaleX\",\"scaleY\"]];\r\n\t\tthis._type=1;\r\n\t\tthis.xAxis=new ArrowLine(\"X\");\r\n\t\tthis.yAxis=new ArrowLine(\"Y\");\r\n\t\tthis.controlBox=new Rect();\r\n\t\tthis._point=new Point();\r\n\t\tthis.oPoint=new Point();\r\n\t\tthis.myRotationChanger=ValueChanger.create(this,\"rotation\");\r\n\t\tthis.targetRotationChanger=ValueChanger.create(null,\"rotation\");\r\n\t\tthis.stageMouseRotationChanger=new ValueChanger();\r\n\t\tAxis.__super.call(this);\r\n\t\tthis.mouseEnabled=true;\r\n\t\tthis.size(1,1);\r\n\t\tthis.initMe();\r\n\t\tthis.xAxis.rotationControl.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.controlMouseDown);\r\n\t\tthis.yAxis.rotationControl.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.controlMouseDown);\r\n\t\tthis.controlBox.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.controlBoxMouseDown);\r\n\t\tthis.on(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",this,this.dragging);\r\n\t}\r\n\r\n\t__class(Axis,'laya.debug.tools.comps.Axis',_super);\r\n\tvar __proto=Axis.prototype;\r\n\t__proto.updateChanges=function(){\r\n\t\tif(this._target){\r\n\t\t\tvar params;\r\n\t\t\tparams=this._lenType[this._type];\r\n\t\t\tthis.xAxis.targetChanger=ValueChanger.create(this._target,params[0]);\r\n\t\t\tthis.yAxis.targetChanger=ValueChanger.create(this._target,params[1]);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.switchType=function(){\r\n\t\tthis._type++;\r\n\t\tthis._type=this._type%this._lenType.length;\r\n\t\tthis.type=this._type;\r\n\t}\r\n\r\n\t__proto.controlBoxMouseDown=function(e){\r\n\t\tthis.startDrag();\r\n\t}\r\n\r\n\t__proto.dragging=function(){\r\n\t\tif (this._target){\r\n\t\t\tthis._point.setTo(this.x,this.y);\r\n\t\t\tDisControlTool.transPoint(this.parent,this._target.parent,this._point);\r\n\t\t\tthis._target.pos(this._point.x,this._point.y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.initMe=function(){\r\n\t\tthis.addChild(this.xAxis);\r\n\t\tthis.addChild(this.yAxis);\r\n\t\tthis.yAxis.rotation=90;\r\n\t\tthis.addChild(this.controlBox);\r\n\t\tthis.controlBox.posTo(0,0);\r\n\t}\r\n\r\n\t__proto.clearMoveEvents=function(){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.stageMouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.stageMouseUp);\r\n\t}\r\n\r\n\t__proto.controlMouseDown=function(e){\r\n\t\tthis.targetRotationChanger.target=this.target;\r\n\t\tthis.clearMoveEvents();\r\n\t\tthis.oPoint.setTo(0,0);\r\n\t\tthis.myRotationChanger.record();\r\n\t\tthis.oPoint=this.localToGlobal(this.oPoint);\r\n\t\tthis.stageMouseRotationChanger.value=this.getStageMouseRatation();\r\n\t\tthis.stageMouseRotationChanger.record();\r\n\t\tthis.targetRotationChanger.record();\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.stageMouseMove);\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.stageMouseUp);\r\n\t}\r\n\r\n\t__proto.getStageMouseRatation=function(){\r\n\t\treturn MathUtil.getRotation(this.oPoint.x,this.oPoint.y,Laya.stage.mouseX,Laya.stage.mouseY);\r\n\t}\r\n\r\n\t__proto.stageMouseMove=function(e){\r\n\t\tthis.stageMouseRotationChanger.value=this.getStageMouseRatation();\r\n\t\tvar dRotation=NaN;\r\n\t\tdRotation=-this.stageMouseRotationChanger.dValue;\r\n\t\tif(this.target){\r\n\t\t\tthis.targetRotationChanger.showValueByAdd(dRotation);\r\n\t\t\t}else{\r\n\t\t\tthis.myRotationChanger.showValueByAdd(dRotation);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.stageMouseUp=function(e){\r\n\t\tthis.noticeChange();\r\n\t\tthis.clearMoveEvents();\r\n\t}\r\n\r\n\t__proto.noticeChange=function(){\r\n\t\tconsole.log(\"rotate:\",-this.stageMouseRotationChanger.dValue);\r\n\t}\r\n\r\n\t__getset(0,__proto,'target',function(){\r\n\t\treturn this._target;\r\n\t\t},function(tar){\r\n\t\tthis._target=tar;\r\n\t\tthis.updateChanges();\r\n\t});\r\n\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn this._type;\r\n\t\t},function(lenType){\r\n\t\tthis._type=lenType;\r\n\t\tthis.updateChanges();\r\n\t});\r\n\r\n\treturn Axis;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-12-30 下午3:23:06\r\n*/\r\n//class laya.debug.tools.comps.Rect extends laya.display.Sprite\r\nvar Rect=(function(_super){\r\n\tfunction Rect(){\r\n\t\tthis.recWidth=10;\r\n\t\tRect.__super.call(this);\r\n\t\tthis.drawMe();\r\n\t}\r\n\r\n\t__class(Rect,'laya.debug.tools.comps.Rect',_super);\r\n\tvar __proto=Rect.prototype;\r\n\t__proto.drawMe=function(){\r\n\t\tvar g;\r\n\t\tg=this.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this.recWidth,this.recWidth,\"#22ff22\");\r\n\t\tthis.size(this.recWidth,this.recWidth);\r\n\t}\r\n\r\n\t__proto.posTo=function(x,y){\r\n\t\tthis.x=x-this.recWidth*0.5;\r\n\t\tthis.y=y-this.recWidth*0.5;\r\n\t}\r\n\r\n\treturn Rect;\r\n})(Sprite)\r\n\r\n\r\n//class laya.debug.tools.DragBox extends laya.display.Sprite\r\nvar DragBox=(function(_super){\r\n\tfunction DragBox(type){\r\n\t\tthis._box=null;\r\n\t\tthis._target=null;\r\n\t\tthis._currDir=null;\r\n\t\t/**0-无，1-水平，2-垂直，3-全部*/\r\n\t\tthis._type=0;\r\n\t\tthis.fixScale=NaN;\r\n\t\tDragBox.__super.call(this);\r\n\t\tthis._left=this.drawBlock();\r\n\t\tthis._right=this.drawBlock();\r\n\t\tthis._top=this.drawBlock();\r\n\t\tthis._bottom=this.drawBlock();\r\n\t\tthis._topLeft=this.drawBlock();\r\n\t\tthis._topRight=this.drawBlock();\r\n\t\tthis._bottomLeft=this.drawBlock();\r\n\t\tthis._bottomRight=this.drawBlock();\r\n\t\tthis._lastPoint=new Point();\r\n\t\tthis._type=type=3;\r\n\t\tthis.addChild(this._box=this.drawBorder(0,0,0xff0000));\r\n\t\tif (type==1 || type==3){\r\n\t\t\tthis.addChild(this._left);\r\n\t\t\tthis.addChild(this._right);\r\n\t\t}\r\n\t\tif (type==2 || type==3){\r\n\t\t\tthis.addChild(this._top);\r\n\t\t\tthis.addChild(this._bottom);\r\n\t\t}\r\n\t\tif (type==3){\r\n\t\t\tthis.addChild(this._topLeft);\r\n\t\t\tthis.addChild(this._topRight);\r\n\t\t\tthis.addChild(this._bottomLeft);\r\n\t\t\tthis.addChild(this._bottomRight);\r\n\t\t}\r\n\t\tthis.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onMouseDown);\r\n\t\tthis.mouseThrough=true;\r\n\t}\r\n\r\n\t__class(DragBox,'laya.debug.tools.DragBox',_super);\r\n\tvar __proto=DragBox.prototype;\r\n\t__proto.onMouseDown=function(e){\r\n\t\tthis._currDir=e.target;\r\n\t\tif(e.nativeEvent.shiftKey){\r\n\t\t\tthis.initFixScale();\r\n\t\t}\r\n\t\tif (this._currDir !=this){\r\n\t\t\tthis._lastPoint.x=Laya.stage.mouseX;\r\n\t\t\tthis._lastPoint.y=Laya.stage.mouseY;\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.onMouseMove);\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onMouseUp);\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onMouseUp=function(e){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.onMouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onMouseUp);\r\n\t}\r\n\r\n\t__proto.initFixScale=function(){\r\n\t\tthis.fixScale=this._target.height / this._target.width;\r\n\t}\r\n\r\n\t__proto.onMouseMove=function(e){\r\n\t\tvar scale=1;\r\n\t\tvar tx=(Laya.stage.mouseX-this._lastPoint.x)/ scale;\r\n\t\tvar ty=(Laya.stage.mouseY-this._lastPoint.y)/ scale;\r\n\t\tvar sameScale=false;\r\n\t\tvar adptX=NaN;\r\n\t\tvar adptY=NaN;\r\n\t\tif(e.nativeEvent.shiftKey){\r\n\t\t\tif(this.fixScale<0)this.initFixScale();\r\n\t\t\tadptY=tx *this.fixScale;\r\n\t\t\tadptX=ty/this.fixScale;\r\n\t\t\tsameScale=true;\r\n\t\t\tswitch(this._currDir){\r\n\t\t\t\tcase this._topLeft:\r\n\t\t\t\tcase this._bottomLeft:\r\n\t\t\t\t\tthis._currDir=this._left;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase this._topRight:\r\n\t\t\t\tcase this._bottomRight:\r\n\t\t\t\t\tthis._currDir=this._right;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tif (tx !=0 || ty !=0){\r\n\t\t\tthis._lastPoint.x+=tx *scale;\r\n\t\t\tthis._lastPoint.y+=ty *scale;\r\n\t\t\tvar tw=tx / this._target.scaleX;\r\n\t\t\tvar th=ty / this._target.scaleY;\r\n\t\t\tif (this._currDir==this._left){\r\n\t\t\t\tthis._target.x+=tx;\r\n\t\t\t\tthis._target.width-=tw;\r\n\t\t\t\tif (sameScale){\r\n\t\t\t\t\tthis._target.height=this._target.width*this.fixScale;\r\n\t\t\t\t}\r\n\t\t\t\t}else if (this._currDir==this._right){\r\n\t\t\t\tthis._target.width+=tw;\r\n\t\t\t\tif (sameScale){\r\n\t\t\t\t\tthis._target.height=this._target.width*this.fixScale;\r\n\t\t\t\t}\r\n\t\t\t\t}else if (this._currDir==this._top){\r\n\t\t\t\tthis._target.y+=ty;\r\n\t\t\t\tthis._target.height-=th;\r\n\t\t\t\tif (sameScale){\r\n\t\t\t\t\tthis._target.width=this._target.height/this.fixScale;\r\n\t\t\t\t}\r\n\t\t\t\t}else if (this._currDir==this._bottom){\r\n\t\t\t\tthis._target.height+=th;\r\n\t\t\t\tif (sameScale){\r\n\t\t\t\t\tthis._target.width=this._target.height/this.fixScale;\r\n\t\t\t\t}\r\n\t\t\t\t}else if (this._currDir==this._topLeft){\r\n\t\t\t\tthis._target.x+=tx;\r\n\t\t\t\tthis._target.y+=ty;\r\n\t\t\t\tthis._target.width-=tw;\r\n\t\t\t\tthis._target.height-=th;\r\n\t\t\t\t}else if (this._currDir==this._topRight){\r\n\t\t\t\tthis._target.y+=ty;\r\n\t\t\t\tthis._target.width+=tw;\r\n\t\t\t\tthis._target.height-=th;\r\n\t\t\t\t}else if (this._currDir==this._bottomLeft){\r\n\t\t\t\tthis._target.x+=tx;\r\n\t\t\t\tthis._target.width-=tw;\r\n\t\t\t\tthis._target.height+=th;\r\n\t\t\t\t}else if (this._currDir==this._bottomRight){\r\n\t\t\t\tthis._target.width+=tw;\r\n\t\t\t\tthis._target.height+=th;\r\n\t\t\t}\r\n\t\t\tif (this._target.width < 1){\r\n\t\t\t\tthis._target.width=1;\r\n\t\t\t}\r\n\t\t\tif (this._target.height < 1){\r\n\t\t\t\tthis._target.height=1;\r\n\t\t\t}\r\n\t\t\tthis._target.width=Math.round(this._target.width);\r\n\t\t\tthis._target.x=Math.round(this._target.x);\r\n\t\t\tthis._target.y=Math.round(this._target.y);\r\n\t\t\tthis._target.height=Math.round(this._target.height);\r\n\t\t\tthis.refresh();\r\n\t\t}\r\n\t}\r\n\r\n\t/**画矩形*/\r\n\t__proto.drawBorder=function(width,height,color,alpha){\r\n\t\t(alpha===void 0)&& (alpha=1);\r\n\t\tvar box=new Sprite();\r\n\t\tvar g=box.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,width,height,null,\"#\"+color);\r\n\t\treturn box;\r\n\t}\r\n\r\n\t/**画矩形*/\r\n\t__proto.drawBlock=function(){\r\n\t\tvar box=new Sprite();\r\n\t\tvar g=box.graphics;\r\n\t\tg.clear();\r\n\t\tbox.width=DragBox.BLOCK_WIDTH;\r\n\t\tbox.height=DragBox.BLOCK_WIDTH;\r\n\t\tg.drawRect(-DragBox.BLOCK_WIDTH *0.5,-DragBox.BLOCK_WIDTH *0.5,DragBox.BLOCK_WIDTH,DragBox.BLOCK_WIDTH,\"#ffffff\",\"#ff0000\",1);\r\n\t\tbox.mouseEnabled=true;\r\n\t\tbox.mouseThrough=true;\r\n\t\treturn box;\r\n\t}\r\n\r\n\t/**设置对象*/\r\n\t__proto.setTarget=function(target){\r\n\t\tthis._target=target;\r\n\t\tthis.refresh();\r\n\t}\r\n\r\n\t__proto.refresh=function(){\r\n\t\tthis.changePoint();\r\n\t\tthis.changeSize();\r\n\t}\r\n\r\n\t__proto.changePoint=function(){\r\n\t\tvar p=this._target.localToGlobal(new Point());\r\n\t\tvar np=(this.parent).globalToLocal(p);\r\n\t\tthis.x=np.x;\r\n\t\tthis.y=np.y;\r\n\t}\r\n\r\n\t/**设置大小*/\r\n\t__proto.changeSize=function(){\r\n\t\tvar width=this._target.width *this._target.scaleX;\r\n\t\tvar height=this._target.height *this._target.scaleY;\r\n\t\tconsole.log(\"change size\");\r\n\t\tthis.rotation=this._target.rotation;\r\n\t\tif (this._box.width !=width || this._box.height !=height){\r\n\t\t\tthis._box.graphics.clear();\r\n\t\t\tthis._box.graphics.drawRect(0,0,Math.abs(width),Math.abs(height),null,\"#ff0000\");\r\n\t\t\tthis._box.size(width,height);\r\n\t\t\tthis.size(width,height);\r\n\t\t\tthis._box.scaleX=Math.abs(this._box.scaleX)*(this._target.scaleX > 0 ? 1 :-1);\r\n\t\t\tthis._box.scaleY=Math.abs(this._box.scaleY)*(this._target.scaleY > 0 ? 1 :-1);\r\n\t\t\tthis._left.x=0;\r\n\t\t\tthis._left.y=height *0.5;\r\n\t\t\tthis._right.x=width;\r\n\t\t\tthis._right.y=height *0.5;\r\n\t\t\tthis._top.x=width *0.5;\r\n\t\t\tthis._top.y=0;\r\n\t\t\tthis._bottom.x=width *0.5;\r\n\t\t\tthis._bottom.y=height;\r\n\t\t\tthis._topLeft.x=this._topLeft.y=0;\r\n\t\t\tthis._topRight.x=width;\r\n\t\t\tthis._topRight.y=0;\r\n\t\t\tthis._bottomLeft.x=0;\r\n\t\t\tthis._bottomLeft.y=height;\r\n\t\t\tthis._bottomRight.x=width;\r\n\t\t\tthis._bottomRight.y=height;\r\n\t\t}\r\n\t}\r\n\r\n\tDragBox.BLOCK_WIDTH=6;\r\n\treturn DragBox;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.DebugInfoLayer extends laya.display.Sprite\r\nvar DebugInfoLayer=(function(_super){\r\n\tfunction DebugInfoLayer(){\r\n\t\tthis.nodeRecInfoLayer=null;\r\n\t\tthis.lineLayer=null;\r\n\t\tthis.txtLayer=null;\r\n\t\tthis.popLayer=null;\r\n\t\tthis.graphicLayer=null;\r\n\t\tthis.cacheViewLayer=null;\r\n\t\tDebugInfoLayer.__super.call(this);\r\n\t\tthis.nodeRecInfoLayer=new Sprite();\r\n\t\tthis.lineLayer=new Sprite();\r\n\t\tthis.txtLayer=new Sprite();\r\n\t\tthis.popLayer=new Sprite();\r\n\t\tthis.graphicLayer=new Sprite();\r\n\t\tthis.cacheViewLayer=new Sprite();\r\n\t\tthis.nodeRecInfoLayer.name=\"nodeRecInfoLayer\";\r\n\t\tthis.lineLayer.name=\"lineLayer\";\r\n\t\tthis.txtLayer.name=\"txtLayer\";\r\n\t\tthis.popLayer.name=\"popLayer\";\r\n\t\tthis.graphicLayer.name=\"graphicLayer\";\r\n\t\tthis.cacheViewLayer.name=\"cacheViewLayer\";\r\n\t\tthis.addChild(this.lineLayer);\r\n\t\tthis.addChild(this.cacheViewLayer);\r\n\t\tthis.addChild(this.nodeRecInfoLayer);\r\n\t\tthis.addChild(this.txtLayer);\r\n\t\tthis.addChild(this.popLayer);\r\n\t\tthis.addChild(this.graphicLayer);\r\n\t\tDebugInfoLayer.I=this;\r\n\t\tthis.zOrder=999;\r\n\t\tLaya.stage.on(/*laya.events.Event.DOUBLE_CLICK*/\"doubleclick\",this,this.setTop);\r\n\t}\r\n\r\n\t__class(DebugInfoLayer,'laya.debug.view.nodeInfo.DebugInfoLayer',_super);\r\n\tvar __proto=DebugInfoLayer.prototype;\r\n\t__proto.setTop=function(){\r\n\t\tDisControlTool.setTop(this);\r\n\t}\r\n\r\n\t__proto.isDebugItem=function(sprite){\r\n\t\treturn DisControlTool.isInTree(this,sprite);\r\n\t}\r\n\r\n\tDebugInfoLayer.init=function(){\r\n\t\tif (!DebugInfoLayer.I){\r\n\t\t\tnew DebugInfoLayer();\r\n\t\t\tLaya.stage.addChild(DebugInfoLayer.I);\r\n\t\t}\r\n\t}\r\n\r\n\tDebugInfoLayer.I=null;\r\n\treturn DebugInfoLayer;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.NodeInfoPanel extends laya.display.Sprite\r\nvar NodeInfoPanel=(function(_super){\r\n\tfunction NodeInfoPanel(){\r\n\t\tthis._stateDic={};\r\n\t\tthis.isWorkState=false;\r\n\t\tNodeInfoPanel.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeInfoPanel,'laya.debug.view.nodeInfo.NodeInfoPanel',_super);\r\n\tvar __proto=NodeInfoPanel.prototype;\r\n\t__proto.showDisInfo=function(node){\r\n\t\tthis.recoverNodes();\r\n\t\tNodeInfosItem.showDisInfos(node);\r\n\t\tthis.showOnly(node);\r\n\t\tthis.isWorkState=true;\r\n\t}\r\n\r\n\t__proto.showOnly=function(node){\r\n\t\tif (!node)\r\n\t\t\treturn;\r\n\t\tthis.hideBrothers(node);\r\n\t\tthis.showOnly(node.parent);\r\n\t}\r\n\r\n\t__proto.recoverNodes=function(){\r\n\t\tNodeInfosItem.hideAllInfos();\r\n\t\tvar key;\r\n\t\tvar data;\r\n\t\tvar tTar;\r\n\t\tfor (key in this._stateDic){\r\n\t\t\tdata=this._stateDic[key];\r\n\t\t\ttTar=data[\"target\"];\r\n\t\t\tif (tTar){\r\n\t\t\t\ttry{\r\n\t\t\t\t\ttTar.visible=data.visible;\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.isWorkState=false;\r\n\t}\r\n\r\n\t__proto.hideOtherChain=function(node){\r\n\t\tif (!node)\r\n\t\t\treturn;\r\n\t\twhile (node){\r\n\t\t\tthis.hideBrothers(node);\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.hideChilds=function(node){\r\n\t\tif (!node)\r\n\t\t\treturn;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=node._childs;\r\n\t\tlen=cList.length;\r\n\t\tvar tChild;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=cList[i];\r\n\t\t\tif (tChild==NodeInfosItem.NodeInfoContainer)continue ;\r\n\t\t\tthis.saveNodeInfo(tChild);\r\n\t\t\ttChild.visible=false;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.hideBrothers=function(node){\r\n\t\tif (!node)\r\n\t\t\treturn;\r\n\t\tvar p;\r\n\t\tp=node.parent;\r\n\t\tif (!p)\r\n\t\t\treturn;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=p._childs;\r\n\t\tlen=cList.length;\r\n\t\tvar tChild;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=cList[i];\r\n\t\t\tif (tChild==NodeInfosItem.NodeInfoContainer)continue ;\r\n\t\t\tif (tChild !=node){\r\n\t\t\t\tthis.saveNodeInfo(tChild);\r\n\t\t\t\ttChild.visible=false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.saveNodeInfo=function(node){\r\n\t\tIDTools.idObj(node);\r\n\t\tif(this._stateDic.hasOwnProperty(IDTools.getObjID(node)))return;\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tdata.target=node;\r\n\t\tdata.visible=node.visible;\r\n\t\tthis._stateDic[IDTools.getObjID(node)]=data;\r\n\t}\r\n\r\n\t__proto.recoverNodeInfo=function(node){\r\n\t\tIDTools.idObj(node);\r\n\t\tif (this._stateDic.hasOwnProperty(IDTools.getObjID(node))){\r\n\t\t\tvar data;\r\n\t\t\tdata=this._stateDic[IDTools.getObjID(node)];\r\n\t\t\tnode[\"visible\"]=data.visible;\r\n\t\t}\r\n\t}\r\n\r\n\tNodeInfoPanel.init=function(){\r\n\t\tif (!NodeInfoPanel.I){\r\n\t\t\tNodeInfoPanel.I=new NodeInfoPanel();\r\n\t\t\tNodeInfosItem.init();\r\n\t\t\tToolPanel.init();\r\n\t\t}\r\n\t}\r\n\r\n\tNodeInfoPanel.I=null;\r\n\treturn NodeInfoPanel;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.NodeInfosItem extends laya.display.Sprite\r\nvar NodeInfosItem=(function(_super){\r\n\tfunction NodeInfosItem(){\r\n\t\t//addChild(_infoTxt);\r\n\t\tthis._infoTxt=null;\r\n\t\tthis._tar=null;\r\n\t\tNodeInfosItem.__super.call(this);\r\n\t\tthis._infoTxt=new Text();\r\n\t\tthis._infoTxt.color=\"#ff0000\";\r\n\t\tthis._infoTxt.bgColor=\"#00ff00\";\r\n\t\tthis._infoTxt.fontSize=12;\r\n\t}\r\n\r\n\t__class(NodeInfosItem,'laya.debug.view.nodeInfo.NodeInfosItem',_super);\r\n\tvar __proto=NodeInfosItem.prototype;\r\n\t__proto.removeSelf=function(){\r\n\t\tthis._infoTxt.removeSelf();\r\n\t\treturn laya.display.Node.prototype.removeSelf.call(this);\r\n\t}\r\n\r\n\t__proto.showToUI=function(){\r\n\t\tNodeInfosItem.NodeInfoContainer.nodeRecInfoLayer.addChild(this);\r\n\t\tthis._infoTxt.removeSelf();\r\n\t\tNodeInfosItem.NodeInfoContainer.txtLayer.addChild(this._infoTxt);\r\n\t\tthis.findOkPos();\r\n\t}\r\n\r\n\t__proto.randomAPos=function(r){\r\n\t\tthis._infoTxt.x=this.x+Laya.stage.width*Math.random();\r\n\t\tthis._infoTxt.y=this.y+r *Math.random();\r\n\t}\r\n\r\n\t__proto.findOkPos=function(){\r\n\t\tvar len=0;\r\n\t\tlen=20;\r\n\t\tthis.randomAPos(len);\r\n\t\treturn;\r\n\t\tvar count=0;\r\n\t\tcount=1;\r\n\t\twhile (!this.isPosOk()){\r\n\t\t\tcount++;\r\n\t\t\tif (count >=500){\r\n\t\t\t\tlen+=10;\r\n\t\t\t\tcount=0;\r\n\t\t\t}\r\n\t\t\tthis.randomAPos(len);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.isPosOk=function(){\r\n\t\tvar tParent;\r\n\t\ttParent=NodeInfosItem.NodeInfoContainer.nodeRecInfoLayer;\r\n\t\tvar i=0,len=0;\r\n\t\tvar cList;\r\n\t\tcList=tParent._childs;\r\n\t\tlen=cList.length;\r\n\t\tvar tChild;\r\n\t\tvar mRec;\r\n\t\tmRec=this._infoTxt.getBounds();\r\n\t\tif (mRec.x < 0)return false;\r\n\t\tif (mRec.y < 0)return false;\r\n\t\tif (mRec.right > Laya.stage.width)return false;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttChild=cList[i];\r\n\t\t\tif (tChild==this._infoTxt)continue ;\r\n\t\t\tif (mRec.intersects(tChild.getBounds()))return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto.showInfo=function(node){\r\n\t\tthis._tar=node;\r\n\t\tif (!node)return;\r\n\t\tNodeInfosItem._txts.length=0;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tKey;\r\n\t\tlen=NodeInfosItem.showValues.length;\r\n\t\tif (node.name){\r\n\t\t\tNodeInfosItem._txts.push(ClassTool.getClassName(node)+\"(\"+node.name+\")\");\r\n\t\t\t}else{\r\n\t\t\tNodeInfosItem._txts.push(ClassTool.getClassName(node));\r\n\t\t}\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttKey=NodeInfosItem.showValues[i];\r\n\t\t\tNodeInfosItem._txts.push(tKey+\":\"+NodeInfosItem.getNodeValue(node,tKey));\r\n\t\t}\r\n\t\tthis._infoTxt.text=NodeInfosItem._txts.join(\"\\n\");\r\n\t\tthis.graphics.clear();\r\n\t\tvar pointList;\r\n\t\tpointList=node._getBoundPointsM(true);\r\n\t\tif(!pointList||pointList.length<1)return;\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,node.localToGlobal,node);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tNodeInfosItem._disBoundRec=Rectangle._getWrapRec(pointList,NodeInfosItem._disBoundRec);\r\n\t\tthis.graphics.drawRect(0,0,NodeInfosItem._disBoundRec.width,NodeInfosItem._disBoundRec.height,null,\"#00ffff\");\r\n\t\tthis.pos(NodeInfosItem._disBoundRec.x,NodeInfosItem._disBoundRec.y);\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tthis.showInfo(this._tar);\r\n\t}\r\n\r\n\t__proto.clearMe=function(){\r\n\t\tthis._tar=null;\r\n\t}\r\n\r\n\t__proto.recover=function(){\r\n\t\tPool.recover(\"NodeInfosItem\",this);\r\n\t}\r\n\r\n\tNodeInfosItem.init=function(){\r\n\t\tif (!NodeInfosItem.NodeInfoContainer){\r\n\t\t\tDebugInfoLayer.init();\r\n\t\t\tNodeInfosItem.NodeInfoContainer=DebugInfoLayer.I;\r\n\t\t\tLaya.stage.addChild(NodeInfosItem.NodeInfoContainer);\r\n\t\t}\r\n\t}\r\n\r\n\tNodeInfosItem.getNodeInfoByNode=function(node){\r\n\t\tIDTools.idObj(node);\r\n\t\tvar key=0;\r\n\t\tkey=IDTools.getObjID(node);\r\n\t\tif (!NodeInfosItem._nodeInfoDic[key]){\r\n\t\t\tNodeInfosItem._nodeInfoDic[key]=new NodeInfosItem();\r\n\t\t}\r\n\t\treturn NodeInfosItem._nodeInfoDic[key];\r\n\t}\r\n\r\n\tNodeInfosItem.hideAllInfos=function(){\r\n\t\tvar key;\r\n\t\tvar tInfo;\r\n\t\tfor (key in NodeInfosItem._nodeInfoDic){\r\n\t\t\ttInfo=NodeInfosItem._nodeInfoDic[key];\r\n\t\t\ttInfo.removeSelf();\r\n\t\t}\r\n\t\tNodeInfosItem.clearRelations();\r\n\t}\r\n\r\n\tNodeInfosItem.showNodeInfo=function(node){\r\n\t\tvar nodeInfo;\r\n\t\tnodeInfo=NodeInfosItem.getNodeInfoByNode(node);\r\n\t\tnodeInfo.showInfo(node);\r\n\t\tnodeInfo.showToUI();\r\n\t}\r\n\r\n\tNodeInfosItem.showDisInfos=function(node){\r\n\t\tvar _node;\r\n\t\t_node=node;\r\n\t\tif (!node)\r\n\t\t\treturn;\r\n\t\twhile (node){\r\n\t\t\tNodeInfosItem.showNodeInfo(node);\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t\tDisControlTool.setTop(NodeInfosItem.NodeInfoContainer);\r\n\t\tNodeInfosItem.apdtTxtInfoPoss(_node);\r\n\t\tNodeInfosItem.updateRelations();\r\n\t}\r\n\r\n\tNodeInfosItem.apdtTxtInfoPoss=function(node){\r\n\t\tvar disList;\r\n\t\tdisList=[];\r\n\t\twhile (node){\r\n\t\t\tdisList.push(node);\r\n\t\t\tnode=node.parent;\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tvar tInfo;\r\n\t\tvar tTxt;\r\n\t\tlen=disList.length;\r\n\t\tvar xPos=NaN;\r\n\t\txPos=Laya.stage.width-150;\r\n\t\tvar heightLen=0;\r\n\t\theightLen=100;\r\n\t\tnode=disList[0];\r\n\t\tif (node){\r\n\t\t\ttInfo=NodeInfosItem.getNodeInfoByNode(node);\r\n\t\t\tif (tInfo){\r\n\t\t\t\ttTxt=tInfo._infoTxt;\r\n\t\t\t\txPos=Laya.stage.width-tTxt.width-10;\r\n\t\t\t\theightLen=tTxt.height+10;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdisList=disList.reverse();\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tnode=disList[i];\r\n\t\t\ttInfo=NodeInfosItem.getNodeInfoByNode(node);\r\n\t\t\tif (tInfo){\r\n\t\t\t\ttTxt=tInfo._infoTxt;\r\n\t\t\t\ttTxt.pos(xPos,heightLen *i);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tNodeInfosItem.clearRelations=function(){\r\n\t\tvar g;\r\n\t\tg=NodeInfosItem.NodeInfoContainer.lineLayer.graphics;\r\n\t\tg.clear();\r\n\t}\r\n\r\n\tNodeInfosItem.updateRelations=function(){\r\n\t\tvar g;\r\n\t\tg=NodeInfosItem.NodeInfoContainer.lineLayer.graphics;\r\n\t\tg.clear();\r\n\t\tvar key;\r\n\t\tvar tInfo;\r\n\t\tfor (key in NodeInfosItem._nodeInfoDic){\r\n\t\t\ttInfo=NodeInfosItem._nodeInfoDic[key];\r\n\t\t\tif (tInfo.parent){\r\n\t\t\t\tg.drawLine(tInfo.x,tInfo.y,tInfo._infoTxt.x,tInfo._infoTxt.y,\"#0000ff\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tNodeInfosItem.getNodeValue=function(node,key){\r\n\t\tvar rst;\r\n\t\tNodeInfosItem._nodePoint.setTo(0,0);\r\n\t\tswitch(key){\r\n\t\t\tcase \"x\":\r\n\t\t\t\trst=node[\"x\"]+\" (g:\"+node.localToGlobal(NodeInfosItem._nodePoint).x+\")\"\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"y\":\r\n\t\t\t\trst=node[\"y\"]+\" (g:\"+node.localToGlobal(NodeInfosItem._nodePoint).y+\")\"\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\trst=node[key];\r\n\t\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tNodeInfosItem.NodeInfoContainer=null;\r\n\tNodeInfosItem._nodeInfoDic={};\r\n\tNodeInfosItem._txts=[];\r\n\t__static(NodeInfosItem,\r\n\t['showValues',function(){return this.showValues=[\"x\",\"y\",\"scaleX\",\"scaleY\",\"width\",\"height\",\"visible\",\"mouseEnabled\"];},'_disBoundRec',function(){return this._disBoundRec=new Rectangle();},'_nodePoint',function(){return this._nodePoint=new Point();}\r\n\t]);\r\n\treturn NodeInfosItem;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.recinfos.NodeRecInfo extends laya.display.Sprite\r\nvar NodeRecInfo=(function(_super){\r\n\tfunction NodeRecInfo(){\r\n\t\tthis.txt=null;\r\n\t\tthis._tar=null;\r\n\t\tthis.recColor=\"#00ff00\";\r\n\t\tNodeRecInfo.__super.call(this);\r\n\t\tthis.txt=new Text();\r\n\t\tthis.txt.color=\"#ff0000\";\r\n\t\tthis.txt.bgColor=\"#00ff00\";\r\n\t\tthis.txt.fontSize=12;\r\n\t\tthis.addChild(this.txt);\r\n\t}\r\n\r\n\t__class(NodeRecInfo,'laya.debug.view.nodeInfo.recinfos.NodeRecInfo',_super);\r\n\tvar __proto=NodeRecInfo.prototype;\r\n\t__proto.setInfo=function(str){\r\n\t\tthis.txt.text=str;\r\n\t}\r\n\r\n\t__proto.setTarget=function(tar){\r\n\t\tthis._tar=tar;\r\n\t}\r\n\r\n\t__proto.showInfo=function(node){\r\n\t\tthis._tar=node;\r\n\t\tif (!node)return;\r\n\t\tif(!node._$P)return;\r\n\t\tthis.graphics.clear();\r\n\t\tvar pointList;\r\n\t\tpointList=node._getBoundPointsM(true);\r\n\t\tif(!pointList||pointList.length<1)return;\r\n\t\tpointList=GrahamScan.pListToPointList(pointList,true);\r\n\t\tWalkTools.walkArr(pointList,node.localToGlobal,node);\r\n\t\tpointList=GrahamScan.pointListToPlist(pointList);\r\n\t\tNodeRecInfo._disBoundRec=Rectangle._getWrapRec(pointList,NodeRecInfo._disBoundRec);\r\n\t\tthis.graphics.drawRect(0,0,NodeRecInfo._disBoundRec.width,NodeRecInfo._disBoundRec.height,null,DebugConsts.RECACHE_REC_COLOR,2);\r\n\t\tthis.pos(NodeRecInfo._disBoundRec.x,NodeRecInfo._disBoundRec.y);\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tthis.showInfo(this._tar);\r\n\t}\r\n\r\n\t__proto.clearMe=function(){\r\n\t\tthis._tar=null;\r\n\t}\r\n\r\n\t__static(NodeRecInfo,\r\n\t['_disBoundRec',function(){return this._disBoundRec=new Rectangle();}\r\n\t]);\r\n\treturn NodeRecInfo;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.ToolPanel extends laya.display.Sprite\r\nvar ToolPanel=(function(_super){\r\n\tfunction ToolPanel(){\r\n\t\tToolPanel.__super.call(this);\r\n\t\tBase64AtlasManager.base64.preLoad(Handler.create(this,this.showToolBar));\r\n\t\tContextMenu.init();\r\n\t\tDisResizer.init();\r\n\t\tvar tipManager;\r\n\t\ttipManager=new TipManagerForDebug();\r\n\t}\r\n\r\n\t__class(ToolPanel,'laya.debug.view.nodeInfo.ToolPanel',_super);\r\n\tvar __proto=ToolPanel.prototype;\r\n\t//Laya.timer.once(1000,this,showToolBar);\r\n\t__proto.showToolBar=function(){\r\n\t\tDebugPanelView.I.show();\r\n\t}\r\n\r\n\t__proto.createViews=function(){\r\n\t\tToolPanel.typeClassDic[\"Find\"]=FindView;\r\n\t\tToolPanel.typeClassDic[\"Filter\"]=FilterView;\r\n\t\tToolPanel.typeClassDic[\"TxtInfo\"]=TxtInfoView;\r\n\t\tToolPanel.typeClassDic[\"Tree\"]=NodeTreeView;\r\n\t}\r\n\r\n\t__proto.switchShow=function(type){\r\n\t\tvar view;\r\n\t\tview=this.getView(type);\r\n\t\tif (view){\r\n\t\t\tview.switchShow();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getView=function(type){\r\n\t\tvar view;\r\n\t\tview=ToolPanel.viewDic[type];\r\n\t\tif (!view && ToolPanel.typeClassDic[type]){\r\n\t\t\tview=ToolPanel.viewDic[type]=new ToolPanel.typeClassDic[type]();\r\n\t\t}\r\n\t\treturn view;\r\n\t}\r\n\r\n\t__proto.showTxtInfo=function(txt){\r\n\t\tOutPutView.I.showTxt(txt);\r\n\t}\r\n\r\n\t__proto.showNodeTree=function(node){\r\n\t\tNodeTree.I.setDis(node);\r\n\t\tDebugPanelView.I.switchToTree();\r\n\t}\r\n\r\n\t__proto.showSelectInStage=function(node){\r\n\t\tNodeTree.I.showSelectInStage(node);\r\n\t\tDebugPanelView.I.switchToTree();\r\n\t}\r\n\r\n\t__proto.showSelectItems=function(selectList){\r\n\t\tDebugPanelView.I.swichToSelect();\r\n\t\tSelectInfosView.I.setSelectList(selectList);\r\n\t}\r\n\r\n\tToolPanel.init=function(){\r\n\t\tif (!ToolPanel.I)ToolPanel.I=new ToolPanel();\r\n\t}\r\n\r\n\tToolPanel.I=null;\r\n\tToolPanel.viewDic={};\r\n\tToolPanel.Find=\"Find\";\r\n\tToolPanel.Filter=\"Filter\";\r\n\tToolPanel.TxtInfo=\"TxtInfo\";\r\n\tToolPanel.Tree=\"Tree\";\r\n\t__static(ToolPanel,\r\n\t['typeClassDic',function(){return this.typeClassDic={\r\n\t};}\r\n\r\n\t]);\r\n\treturn ToolPanel;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-9-29 上午11:17:35\r\n*/\r\n//class laya.debug.tools.debugUI.DButton extends laya.display.Text\r\nvar DButton=(function(_super){\r\n\tfunction DButton(){\r\n\t\tDButton.__super.call(this);\r\n\t\tthis.bgColor=\"#ffff00\";\r\n\t\tthis.wordWrap=false;\r\n\t\tthis.mouseEnabled=true;\r\n\t}\r\n\r\n\t__class(DButton,'laya.debug.tools.debugUI.DButton',_super);\r\n\treturn DButton;\r\n})(Text)\r\n\r\n\r\n/**\r\n*自动根据大小填充自己全部区域的显示对象\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.resizer.AutoFillRec extends laya.ui.Component\r\nvar AutoFillRec=(function(_super){\r\n\tfunction AutoFillRec(type){\r\n\t\tthis.type=0;\r\n\t\tthis.preX=NaN;\r\n\t\tthis.preY=NaN;\r\n\t\tAutoFillRec.__super.call(this);\r\n\t}\r\n\r\n\t__class(AutoFillRec,'laya.debug.tools.resizer.AutoFillRec',_super);\r\n\tvar __proto=AutoFillRec.prototype;\r\n\t//super(type);\r\n\t__proto.changeSize=function(){\r\n\t\t_super.prototype.changeSize.call(this);\r\n\t\tvar g=this.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this.width,this.height,\"#33c5f5\");\r\n\t}\r\n\r\n\t__proto.record=function(){\r\n\t\tthis.preX=this.x;\r\n\t\tthis.preY=this.y;\r\n\t}\r\n\r\n\t__proto.getDx=function(){\r\n\t\treturn this.x-this.preX;\r\n\t}\r\n\r\n\t__proto.getDy=function(){\r\n\t\treturn this.y-this.preY;\r\n\t}\r\n\r\n\treturn AutoFillRec;\r\n})(Component)\r\n\r\n\r\n/**鼠标提示管理类*/\r\n//class laya.debug.tools.TipManagerForDebug extends laya.ui.Component\r\nvar TipManagerForDebug=(function(_super){\r\n\tfunction TipManagerForDebug(){\r\n\t\tthis._tipBox=null;\r\n\t\tthis._tipText=null;\r\n\t\tthis._defaultTipHandler=null;\r\n\t\tTipManagerForDebug.__super.call(this);\r\n\t\tthis._tipBox=new Component();\r\n\t\tthis._tipBox.addChild(this._tipText=new Text());\r\n\t\tthis._tipText.x=this._tipText.y=5;\r\n\t\tthis._tipText.color=TipManagerForDebug.tipTextColor;\r\n\t\tthis._defaultTipHandler=this.showDefaultTip;\r\n\t\tLaya.stage.on(/*laya.ui.UIEvent.SHOW_TIP*/\"showtip\",this,this.onStageShowTip);\r\n\t\tLaya.stage.on(/*laya.ui.UIEvent.HIDE_TIP*/\"hidetip\",this,this.onStageHideTip);\r\n\t}\r\n\r\n\t__class(TipManagerForDebug,'laya.debug.tools.TipManagerForDebug',_super);\r\n\tvar __proto=TipManagerForDebug.prototype;\r\n\t__proto.onStageHideTip=function(e){\r\n\t\tLaya.timer.clear(this,this.showTip);\r\n\t\tthis.closeAll();\r\n\t\tthis.removeSelf();\r\n\t}\r\n\r\n\t__proto.onStageShowTip=function(data){\r\n\t\tLaya.timer.once(TipManagerForDebug.tipDelay,this,this.showTip,[data],true);\r\n\t}\r\n\r\n\t__proto.showTip=function(tip){\r\n\t\tif ((typeof tip=='string')){\r\n\t\t\tvar text=String(tip);\r\n\t\t\tif (Boolean(text)){\r\n\t\t\t\tthis._defaultTipHandler(text);\r\n\t\t\t}\r\n\t\t\t}else if ((tip instanceof laya.utils.Handler )){\r\n\t\t\t(tip).run();\r\n\t\t\t}else if ((typeof tip=='function')){\r\n\t\t\t(tip).apply();\r\n\t\t}\r\n\t\tif (true){\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.onStageMouseMove);\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onStageMouseDown);\r\n\t\t}\r\n\t\tthis.onStageMouseMove(null);\r\n\t}\r\n\r\n\t__proto.onStageMouseDown=function(e){\r\n\t\tthis.closeAll();\r\n\t}\r\n\r\n\t__proto.onStageMouseMove=function(e){\r\n\t\tthis.showToStage(this,TipManagerForDebug.offsetX,TipManagerForDebug.offsetY);\r\n\t}\r\n\r\n\t__proto.showToStage=function(dis,offX,offY){\r\n\t\t(offX===void 0)&& (offX=0);\r\n\t\t(offY===void 0)&& (offY=0);\r\n\t\tvar rec=dis.getBounds();\r\n\t\tdis.x=Laya.stage.mouseX+offX;\r\n\t\tdis.y=Laya.stage.mouseY+offY;\r\n\t\tif (dis.x+rec.width > Laya.stage.width){\r\n\t\t\tdis.x-=rec.width+offX;\r\n\t\t}\r\n\t\tif (dis.y+rec.height > Laya.stage.height){\r\n\t\t\tdis.y-=rec.height+offY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**关闭所有鼠标提示*/\r\n\t__proto.closeAll=function(){\r\n\t\tLaya.timer.clear(this,this.showTip);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.onStageMouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onStageMouseDown);\r\n\t\tthis.removeChildren();\r\n\t}\r\n\r\n\t__proto.showDisTip=function(tip){\r\n\t\tthis.addChild(tip);\r\n\t\tthis.showToStage(this);\r\n\t\tLaya.stage.addChild(this);\r\n\t}\r\n\r\n\t__proto.showDefaultTip=function(text){\r\n\t\tthis._tipText.text=text;\r\n\t\tvar g=this._tipBox.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,TipManagerForDebug.tipBackColor);\r\n\t\tthis.addChild(this._tipBox);\r\n\t\tthis.showToStage(this);\r\n\t\tLaya.stage.addChild(this);\r\n\t}\r\n\r\n\t/**默认鼠标提示函数*/\r\n\t__getset(0,__proto,'defaultTipHandler',function(){\r\n\t\treturn this._defaultTipHandler;\r\n\t\t},function(value){\r\n\t\tthis._defaultTipHandler=value;\r\n\t});\r\n\r\n\tTipManagerForDebug.offsetX=10;\r\n\tTipManagerForDebug.offsetY=15;\r\n\tTipManagerForDebug.tipTextColor=\"#ffffff\";\r\n\tTipManagerForDebug.tipBackColor=\"#111111\";\r\n\tTipManagerForDebug.tipDelay=200;\r\n\treturn TipManagerForDebug;\r\n})(Component)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.UIViewBase extends laya.ui.Component\r\nvar UIViewBase=(function(_super){\r\n\tfunction UIViewBase(){\r\n\t\tthis.minHandler=null;\r\n\t\tthis.maxHandler=null;\r\n\t\tthis.isFirstShow=true;\r\n\t\tthis.dis=null;\r\n\t\tUIViewBase.__super.call(this);\r\n\t\tthis.dis=this;\r\n\t\tthis.minHandler=new Handler(this,this.close);\r\n\t\tthis.maxHandler=new Handler(this,this.show);\r\n\t\tthis.createPanel();\r\n\t\tif (this.dis){\r\n\t\t\tthis.dis.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.bringToTop);\r\n\t\t\tthis.dis.cacheAsBitmap=true;\r\n\t\t}\r\n\t}\r\n\r\n\t__class(UIViewBase,'laya.debug.view.nodeInfo.views.UIViewBase',_super);\r\n\tvar __proto=UIViewBase.prototype;\r\n\t__proto.show=function(){\r\n\t\tDebugInfoLayer.I.setTop();\r\n\t\tDebugInfoLayer.I.popLayer.addChild(this.dis);\r\n\t\tif (this.isFirstShow){\r\n\t\t\tthis.firstShowFun();\r\n\t\t\tthis.isFirstShow=false;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.firstShowFun=function(){\r\n\t\tthis.dis.x=(Laya.stage.width-this.dis.width)*0.5;\r\n\t\tthis.dis.y=(Laya.stage.height-this.dis.height)*0.5;\r\n\t\tDisControlTool.intFyDisPos(this.dis);\r\n\t}\r\n\r\n\t__proto.bringToTop=function(){\r\n\t\tDisControlTool.setTop(this.dis);\r\n\t}\r\n\r\n\t__proto.switchShow=function(){\r\n\t\tif (this.dis.parent){\r\n\t\t\tthis.close();\r\n\t\t\t}else{\r\n\t\t\tthis.show();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.close=function(){\r\n\t\tthis.dis.removeSelf();\r\n\t}\r\n\r\n\t__proto.createPanel=function(){}\r\n\t__proto.getInput=function(){\r\n\t\tvar input;\r\n\t\tinput=new DInput();\r\n\t\tinput.size(200,30);\r\n\t\tinput.fontSize=30;\r\n\t\treturn input;\r\n\t}\r\n\r\n\t__proto.getButton=function(){\r\n\t\tvar btn;\r\n\t\tbtn=new DButton();\r\n\t\tbtn.size(40,30);\r\n\t\tbtn.fontSize=30;\r\n\t\treturn btn;\r\n\t}\r\n\r\n\treturn UIViewBase;\r\n})(Component)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.recinfos.ReCacheRecInfo extends laya.debug.view.nodeInfo.recinfos.NodeRecInfo\r\nvar ReCacheRecInfo=(function(_super){\r\n\tfunction ReCacheRecInfo(){\r\n\t\tthis.isWorking=false;\r\n\t\tthis.count=0;\r\n\t\tthis.mTime=0;\r\n\t\tReCacheRecInfo.__super.call(this);\r\n\t\tthis.txt.fontSize=12;\r\n\t}\r\n\r\n\t__class(ReCacheRecInfo,'laya.debug.view.nodeInfo.recinfos.ReCacheRecInfo',_super);\r\n\tvar __proto=ReCacheRecInfo.prototype;\r\n\t__proto.addCount=function(time){\r\n\t\t(time===void 0)&& (time=0);\r\n\t\tthis.count++;\r\n\t\tthis.mTime+=time;\r\n\t\tif (!this.isWorking){\r\n\t\t\tthis.working=true;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.updates=function(){\r\n\t\tif (!this._tar[\"displayedInStage\"]){\r\n\t\t\tthis.working=false;\r\n\t\t\tthis.removeSelf();\r\n\t\t}\r\n\t\tthis.txt.text=ClassTool.getNodeClassAndName(this._tar)+\"\\n\"+\"reCache:\"+this.count+\"\\ntime:\"+this.mTime;\r\n\t\tif (this.count > 0){\r\n\t\t\tthis.fresh();\r\n\t\t\tLaya.timer.clear(this,this.removeSelfLater);\r\n\t\t\t}else{\r\n\t\t\tthis.working=false;\r\n\t\t\tLaya.timer.once(3000,this,this.removeSelfLater);\r\n\t\t}\r\n\t\tthis.count=0;\r\n\t\tthis.mTime=0;\r\n\t}\r\n\r\n\t__proto.removeSelfLater=function(){\r\n\t\tthis.working=false;\r\n\t\tthis.removeSelf();\r\n\t}\r\n\r\n\t__getset(0,__proto,'working',null,function(v){\r\n\t\tthis.isWorking=v;\r\n\t\tif (v){\r\n\t\t\tLaya.timer.loop(1000,this,this.updates);\r\n\t\t\t}else{\r\n\t\t\tLaya.timer.clear(this,this.updates);\r\n\t\t}\r\n\t});\r\n\r\n\tReCacheRecInfo.showTime=3000;\r\n\treturn ReCacheRecInfo;\r\n})(NodeRecInfo)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.tools.debugUI.DInput extends laya.display.Input\r\nvar DInput=(function(_super){\r\n\tfunction DInput(){\r\n\t\tDInput.__super.call(this);\r\n\t\tthis.bgColor=\"#11ff00\";\r\n\t}\r\n\r\n\t__class(DInput,'laya.debug.tools.debugUI.DInput',_super);\r\n\treturn DInput;\r\n})(Input)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2015-10-24 下午2:58:37\r\n*/\r\n//class laya.debug.uicomps.ContextMenu extends laya.ui.Box\r\nvar ContextMenu=(function(_super){\r\n\tfunction ContextMenu(){\r\n\t\tthis._tY=0;\r\n\t\tContextMenu.__super.call(this);\r\n\t\tStyleConsts.setViewScale(this);\r\n\t}\r\n\r\n\t__class(ContextMenu,'laya.debug.uicomps.ContextMenu',_super);\r\n\tvar __proto=ContextMenu.prototype;\r\n\t__proto.addItem=function(item){\r\n\t\tthis.addChild(item);\r\n\t\titem.y=this._tY;\r\n\t\tthis._tY+=item.height;\r\n\t\titem.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onClick);\r\n\t}\r\n\r\n\t__proto.onClick=function(e){\r\n\t\tthis.event(/*laya.events.Event.SELECT*/\"select\",e);\r\n\t\tthis.removeSelf();\r\n\t}\r\n\r\n\t__proto.show=function(posX,posY){\r\n\t\t(posX===void 0)&& (posX=-999);\r\n\t\t(posY===void 0)&& (posY=-999);\r\n\t\tLaya.timer.once(100,this,ContextMenu.showMenu,[this,posX,posY]);\r\n\t}\r\n\r\n\tContextMenu.init=function(){\r\n\t\tLaya.stage.on(/*laya.events.Event.CLICK*/\"click\",null,ContextMenu.cleanMenu);\r\n\t}\r\n\r\n\tContextMenu.cleanMenu=function(e){\r\n\t\tvar i=0;\r\n\t\tvar len=0;\r\n\t\tlen=ContextMenu._menuList.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\tif(ContextMenu._menuList[i]){\r\n\t\t\t\tContextMenu._menuList[i].removeSelf();\r\n\t\t\t}\r\n\t\t}\r\n\t\tContextMenu._menuList.length=0;\r\n\t}\r\n\r\n\tContextMenu.showMenu=function(menu,posX,posY){\r\n\t\t(posX===void 0)&& (posX=-999);\r\n\t\t(posY===void 0)&& (posY=-999);\r\n\t\tContextMenu.cleanMenu();\r\n\t\tContextMenu.adptMenu(menu);\r\n\t\tLaya.stage.addChild(menu);\r\n\t\tDisControlTool.showToStage(menu);\r\n\t\tif (posX !=-999 && posY !=-999){\r\n\t\t\tmenu.pos(posX,posY);\r\n\t\t}\r\n\t\tContextMenu._menuList.push(menu);\r\n\t}\r\n\r\n\tContextMenu.createMenu=function(__args){\r\n\t\tvar args=arguments;\r\n\t\treturn ContextMenu.createMenuByArray(args);\r\n\t}\r\n\r\n\tContextMenu.createMenuByArray=function(args){\r\n\t\tvar menu=new ContextMenu();\r\n\t\tvar separatorBefore=false;\r\n\t\tvar item;\r\n\t\tfor (var i=0,n=args.length;i < n;i++){\r\n\t\t\tvar obj=args[i];\r\n\t\t\tvar info={};\r\n\t\t\tif ((typeof obj=='string')){\r\n\t\t\t\tinfo.label=obj;\r\n\t\t\t\t}else {\r\n\t\t\t\tinfo=obj;\r\n\t\t\t}\r\n\t\t\tif (info.label !=\"\"){\r\n\t\t\t\titem=new ContextMenuItem(info.label,separatorBefore);\r\n\t\t\t\titem.data=obj;\r\n\t\t\t\tmenu.addItem(item);\r\n\t\t\t\tseparatorBefore=false;\r\n\t\t\t\t}else {\r\n\t\t\t\titem=new ContextMenuItem(\"\",separatorBefore);\r\n\t\t\t\titem.data=obj;\r\n\t\t\t\tmenu.addItem(item);\r\n\t\t\t\tseparatorBefore=true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmenu.zOrder=9999;\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tContextMenu.adptMenu=function(menu){\r\n\t\tvar tWidth=80;\r\n\t\tvar maxWidth=80;\r\n\t\tvar i=0,len=menu.numChildren;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttWidth=(menu.getChildAt(i)).width;\r\n\t\t\tif (maxWidth < tWidth){\r\n\t\t\t\tmaxWidth=tWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\t(menu.getChildAt(i)).width=maxWidth;\r\n\t\t}\r\n\t}\r\n\r\n\tContextMenu._menuList=[];\r\n\treturn ContextMenu;\r\n})(Box)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.uicomps.ContextMenuItem extends laya.ui.Button\r\nvar ContextMenuItem=(function(_super){\r\n\tfunction ContextMenuItem(txt,isSeparator){\r\n\t\tthis.data=null;\r\n\t\tthis.img=null;\r\n\t\tContextMenuItem.__super.call(this);\r\n\t\tif(!this.img)this.img=new Image();\r\n\t\tif(txt!=\"\"){\r\n\t\t\tthis.label=txt;\r\n\t\t\tthis.name=txt;\r\n\t\t\t}else{\r\n\t\t\tthis.label=\"------\";\r\n\t\t\tthis.height=5;\r\n\t\t\tthis.mouseEnabled=false;\r\n\t\t\tthis.img.skin=Base64AtlasManager.base64.getAdptUrl(\"comp/line2.png\");\r\n\t\t\tthis.img.sizeGrid=\"0,2,0,2\";\r\n\t\t\tthis.addChild(this.img);\r\n\t\t}\r\n\t\tthis.labelColors=\"#000000,#000000,#000000,#000000\";\r\n\t\tthis._text.x=10;\r\n\t\tthis._text.padding=[-2,0,0,0];\r\n\t\tthis._text.align=\"left\";\r\n\t\tthis._text.wordWrap=false;\r\n\t\tthis._text.typeset();\r\n\t\tthis.width=this._text.width+25;\r\n\t\tthis.sizeGrid=\"3,3,3,3\";\r\n\t\tthis.skin=Base64AtlasManager.base64.getAdptUrl(\"comp/button1.png\");\r\n\t}\r\n\r\n\t__class(ContextMenuItem,'laya.debug.uicomps.ContextMenuItem',_super);\r\n\tvar __proto=ContextMenuItem.prototype;\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(v){\r\n\t\tLaya.superSet(Button,this,'width',v);\r\n\t\tthis.img.width=this.width;\r\n\t\tthis.img.x=0;\r\n\t});\r\n\r\n\treturn ContextMenuItem;\r\n})(Button)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.CacheRankView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar CacheRankView=(function(_super){\r\n\tfunction CacheRankView(){\r\n\t\tthis.view=null;\r\n\t\tCacheRankView.__super.call(this);\r\n\t}\r\n\r\n\t__class(CacheRankView,'laya.debug.view.nodeInfo.views.CacheRankView',_super);\r\n\tvar __proto=CacheRankView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new Rank();\r\n\t\tthis.view.top=this.view.bottom=this.view.left=this.view.right=0;\r\n\t\tthis.addChild(this.view);\r\n\t\tNodeMenu.I.setNodeListAction(this.view.itemList);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.fresh);\r\n\t\tthis.view.itemList.scrollBar.hide=true;\r\n\t\tthis.view.autoUpdate.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onAutoUpdateChange);\r\n\t\tthis.dis=this;\r\n\t\tthis.view.itemList.array=[];\r\n\t\tthis.onAutoUpdateChange();\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.itemList;\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onAutoUpdateChange=function(){\r\n\t\tthis.autoUpdate=this.view.autoUpdate.selected;\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tCacheAnalyser.counter.updates();\r\n\t\tthis.view.title.text=\"ReCache排行\";\r\n\t\tif (!DebugTool.enableCacheAnalyse){\r\n\t\t\tthis.view.title.text=\"ReCache排行(未开启)\";\r\n\t\t\tthis.view.title.toolTip=\"DebugTool.init(true)可开启该功能\";\r\n\t\t};\r\n\t\tvar nodeDic;\r\n\t\tnodeDic=CacheAnalyser.counter.resultNodeDic;\r\n\t\tvar key;\r\n\t\tvar tNode;\r\n\t\tvar tData;\r\n\t\tvar dataList;\r\n\t\tdataList=[];\r\n\t\tfor (key in nodeDic){\r\n\t\t\ttNode=nodeDic[key];\r\n\t\t\tif (CacheRankView.filterDebugNodes && DisControlTool.isInTree(DebugInfoLayer.I,tNode))continue ;\r\n\t\t\tif (CacheAnalyser.counter.getCount(tNode)<=0)continue ;\r\n\t\t\ttData={};\r\n\t\t\ttData.time=CacheAnalyser.counter.getCount(tNode);\r\n\t\t\ttData.path=tNode;\r\n\t\t\ttData.label=ClassTool.getNodeClassAndName(tNode)+\":\"+tData.time;\r\n\t\t\tdataList.push(tData);\r\n\t\t}\r\n\t\tdataList.sort(MathTools.sortByKey(\"time\",true,true));\r\n\t\tthis.view.itemList.array=dataList;\r\n\t}\r\n\r\n\t__getset(0,__proto,'autoUpdate',null,function(v){\r\n\t\tLaya.timer.clear(this,this.fresh);\r\n\t\tif (v){\r\n\t\t\tthis.fresh();\r\n\t\t\tLaya.timer.loop(NodeConsts.RenderCostMaxTime,this,this.fresh);\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(1,CacheRankView,'I',function(){\r\n\t\tif (!CacheRankView._I)\r\n\t\t\tCacheRankView._I=new CacheRankView();\r\n\t\treturn CacheRankView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tCacheRankView._I=null;\r\n\tCacheRankView.filterDebugNodes=true;\r\n\treturn CacheRankView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.DebugPanelView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar DebugPanelView=(function(_super){\r\n\tfunction DebugPanelView(){\r\n\t\tthis.view=null;\r\n\t\tthis.dragIcon=null;\r\n\t\tthis.tSelectTar=null;\r\n\t\tthis._selectTip=new Sprite();\r\n\t\tDebugPanelView.__super.call(this);\r\n\t\tthis._selectTip.setBounds(new Rectangle(0,0,0,0));\r\n\t}\r\n\r\n\t__class(DebugPanelView,'laya.debug.view.nodeInfo.views.DebugPanelView',_super);\r\n\tvar __proto=DebugPanelView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new DebugPage();\r\n\t\tthis.dis=this.view;\r\n\t\tthis.view.minBtn.minHandler=this.minHandler;\r\n\t\tthis.view.minBtn.maxHandler=this.maxHandler;\r\n\t\tthis.view.minBtn.tar=this.view;\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.tab,this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.clearBtn,this.view);\r\n\t\tthis.clickSelectChange();\r\n\t\tthis.view.selectWhenClick.on(/*laya.events.Event.CHANGE*/\"change\",this,this.clickSelectChange);\r\n\t\tNotice.listen(/*laya.debug.tools.DisplayHook.ITEM_CLICKED*/\"ItemClicked\",this,this.itemClicked);\r\n\t\tStyleConsts.setViewScale(this.view);\r\n\t\tthis.dragIcon=this.view.dragIcon;\r\n\t\tthis.dragIcon.removeSelf();\r\n\t\tthis.view.mouseAnalyseBtn.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.mouseAnalyserMouseDown);\r\n\t\tthis.dragIcon.on(/*laya.events.Event.DRAG_END*/\"dragend\",this,this.mouseAnalyserDragEnd);\r\n\t\tthis.view.clearBtn.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.clearBtnClick);\r\n\t}\r\n\r\n\t__proto.clearBtnClick=function(){\r\n\t\tDebugTool.clearDebugLayer();\r\n\t}\r\n\r\n\t__proto.mouseAnalyserMouseDown=function(){\r\n\t\tvar gPos=DebugPanelView.tempPos;\r\n\t\tgPos.setTo(0,0);\r\n\t\tgPos=this.view.mouseAnalyseBtn.localToGlobal(gPos);\r\n\t\tthis.dragIcon.pos(gPos.x,gPos.y);\r\n\t\tthis.dragIcon.mouseEnabled=false;\r\n\t\tLaya.stage.addChild(this.dragIcon);\r\n\t\tthis.dragIcon.startDrag();\r\n\t}\r\n\r\n\t__proto.mouseAnalyserDragEnd=function(){\r\n\t\tthis.dragIcon.removeSelf();\r\n\t\tthis.selectTarget(DisplayHook.instance.getDisUnderMouse());\r\n\t\tNodeToolView.I.showByNode(DisplayHook.instance.getDisUnderMouse(),false);\r\n\t}\r\n\r\n\t//}\r\n\t__proto.switchToTree=function(){\r\n\t\tthis.view.tab.selectedIndex=0;\r\n\t}\r\n\r\n\t__proto.swichToSelect=function(){\r\n\t\tthis.view.tab.selectedIndex=1;\r\n\t}\r\n\r\n\t__proto.itemClicked=function(tar){\r\n\t\tif (!DebugPanelView.isClickSelectState)return;\r\n\t\tif (DebugPanelView.ignoreDebugTool){\r\n\t\t\tif (DebugInfoLayer.I.isDebugItem(tar))return;\r\n\t\t}\r\n\t\tif ((tar instanceof laya.debug.uicomps.ContextMenuItem )|| (tar.parent instanceof laya.debug.uicomps.ContextMenuItem )){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tToolPanel.I.showSelectInStage(tar);\r\n\t\tNodeToolView.I.showByNode(tar,false);\r\n\t\tthis.view.selectWhenClick.selected=false;\r\n\t\tDebugTool.showDisBound(tar);\r\n\t\tthis.clickSelectChange();\r\n\t}\r\n\r\n\t__proto.selectTarget=function(tar){\r\n\t\tif (!tar)return;\r\n\t\tToolPanel.I.showSelectInStage(tar);\r\n\t\tDebugTool.showDisBound(tar);\r\n\t}\r\n\r\n\t__proto.clickSelectChange=function(){\r\n\t\tDebugPanelView.isClickSelectState=this.view.selectWhenClick.selected;\r\n\t\tif (!Browser.onPC)return;\r\n\t\tthis.tSelectTar=null;\r\n\t\tthis.clearSelectTip();\r\n\t\tif (DebugPanelView.isClickSelectState){\r\n\t\t\tLaya.timer.loop(200,this,this.updateSelectTar,null,true);\r\n\t\t\t}else{\r\n\t\t\tLaya.timer.clear(this,this.updateSelectTar);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.clearSelectTip=function(){\r\n\t\tthis._selectTip.removeSelf();\r\n\t}\r\n\r\n\t__proto.updateSelectTar=function(){\r\n\t\tthis.clearSelectTip();\r\n\t\tthis.tSelectTar=DisplayHook.instance.getDisUnderMouse();\r\n\t\tif (!this.tSelectTar){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (DebugInfoLayer.I.isDebugItem(this.tSelectTar))return;\r\n\t\tvar g;\r\n\t\tg=this._selectTip.graphics;\r\n\t\tg.clear();\r\n\t\tvar rec;\r\n\t\trec=NodeUtils.getGRec(this.tSelectTar);\r\n\t\tDebugInfoLayer.I.popLayer.addChild(this._selectTip);\r\n\t\tg.drawRect(0,0,rec.width,rec.height,null,\"#00ffff\",2);\r\n\t\tthis._selectTip.pos(rec.x,rec.y);\r\n\t}\r\n\r\n\t__getset(1,DebugPanelView,'I',function(){\r\n\t\tif (!DebugPanelView._I)DebugPanelView._I=new DebugPanelView();\r\n\t\treturn DebugPanelView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tDebugPanelView._I=null;\r\n\tDebugPanelView.ignoreDebugTool=true;\r\n\tDebugPanelView.isClickSelectState=false;\r\n\t__static(DebugPanelView,\r\n\t['tempPos',function(){return this.tempPos=new Point();}\r\n\t]);\r\n\treturn DebugPanelView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.FilterView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar FilterView=(function(_super){\r\n\tfunction FilterView(){\r\n\t\tthis.input=null;\r\n\t\tFilterView.__super.call(this);\r\n\t}\r\n\r\n\t__class(FilterView,'laya.debug.view.nodeInfo.views.FilterView',_super);\r\n\tvar __proto=FilterView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.input=new Input();\r\n\t\tthis.input.size(400,500);\r\n\t\tthis.input.multiline=true;\r\n\t\tthis.input.bgColor=\"#ff00ff\";\r\n\t\tthis.input.fontSize=24;\r\n\t\tthis.addChild(this.input);\r\n\t}\r\n\r\n\t__proto.show=function(){\r\n\t\tthis.input.text=NodeInfosItem.showValues.join(\"\\n\");\r\n\t\t_super.prototype.show.call(this);\r\n\t}\r\n\r\n\t__proto.close=function(){\r\n\t\t_super.prototype.close.call(this);\r\n\t\tNodeInfosItem.showValues=this.input.text.split(\"\\n\");\r\n\t}\r\n\r\n\treturn FilterView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.FindSmallView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar FindSmallView=(function(_super){\r\n\tfunction FindSmallView(){\r\n\t\tthis.view=null;\r\n\t\tFindSmallView.__super.call(this);\r\n\t}\r\n\r\n\t__class(FindSmallView,'laya.debug.view.nodeInfo.views.FindSmallView',_super);\r\n\tvar __proto=FindSmallView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new FindNodeSmall();\r\n\t\tStyleConsts.setViewScale(this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tthis.view.typeSelect.selectedIndex=1;\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.findBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onFind);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.onFind=function(){\r\n\t\tvar key;\r\n\t\tkey=this.view.findTxt.text;\r\n\t\tkey=StringTool.trimSide(key);\r\n\t\tvar nodeList;\r\n\t\tif (this.view.typeSelect.selectedIndex==0){\r\n\t\t\tnodeList=DebugTool.findNameHas(key,false);\r\n\t\t\t}else{\r\n\t\t\tnodeList=DebugTool.findClassHas(Laya.stage,key);\r\n\t\t}\r\n\t\tToolPanel.I.showSelectItems(nodeList);\r\n\t\tthis.close();\r\n\t}\r\n\r\n\t__getset(1,FindSmallView,'I',function(){\r\n\t\tif (!FindSmallView._I)FindSmallView._I=new FindSmallView();\r\n\t\treturn FindSmallView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tFindSmallView._I=null;\r\n\treturn FindSmallView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.FindView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar FindView=(function(_super){\r\n\tfunction FindView(){\r\n\t\tthis.view=null;\r\n\t\tFindView.__super.call(this);\r\n\t}\r\n\r\n\t__class(FindView,'laya.debug.view.nodeInfo.views.FindView',_super);\r\n\tvar __proto=FindView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new FindNode();\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tthis.view.result.scrollBar.hide=true;\r\n\t\tthis.view.result.array=[];\r\n\t\tthis.view.typeSelect.selectedIndex=1;\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.findBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onFind);\r\n\t\tNodeMenu.I.setNodeListAction(this.view.result);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.result;\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.onFind=function(){\r\n\t\tvar key;\r\n\t\tkey=this.view.findTxt.text;\r\n\t\tkey=StringTool.trimSide(key);\r\n\t\tvar nodeList;\r\n\t\tif (this.view.typeSelect.selectedIndex==0){\r\n\t\t\tnodeList=DebugTool.findNameHas(key,false);\r\n\t\t\t}else{\r\n\t\t\tnodeList=DebugTool.findClassHas(Laya.stage,key);\r\n\t\t}\r\n\t\tthis.showFindResult(nodeList);\r\n\t}\r\n\r\n\t__proto.showFindResult=function(nodeList){\r\n\t\tif (!nodeList)return;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=nodeList.length;\r\n\t\tvar showList;\r\n\t\tshowList=[];\r\n\t\tvar tData;\r\n\t\tvar tSprite;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttSprite=nodeList[i];\r\n\t\t\ttData={};\r\n\t\t\ttData.label=ClassTool.getNodeClassAndName(tSprite);\r\n\t\t\ttData.path=tSprite;\r\n\t\t\tshowList.push(tData);\r\n\t\t}\r\n\t\tthis.view.result.array=showList;\r\n\t}\r\n\r\n\t__getset(1,FindView,'I',function(){\r\n\t\tif (!FindView._I)FindView._I=new FindView();\r\n\t\treturn FindView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tFindView._I=null;\r\n\treturn FindView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.NodeListPanelView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar NodeListPanelView=(function(_super){\r\n\tfunction NodeListPanelView(){\r\n\t\tthis.view=null;\r\n\t\tNodeListPanelView.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeListPanelView,'laya.debug.view.nodeInfo.views.NodeListPanelView',_super);\r\n\tvar __proto=NodeListPanelView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new NodeListPanel();\r\n\t\tthis.addChild(this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tNodeMenu.I.setNodeListAction(this.view.itemList);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.itemList.scrollBar.hide=true;\r\n\t\tthis.dis=this;\r\n\t\tthis.view.itemList.array=[];\r\n\t}\r\n\r\n\t//fresh();\r\n\t__proto.showList=function(list){\r\n\t\tthis.view.itemList.array=list;\r\n\t\tthis.show();\r\n\t}\r\n\r\n\t__getset(1,NodeListPanelView,'I',function(){\r\n\t\tif (!NodeListPanelView._I)\r\n\t\t\tNodeListPanelView._I=new NodeListPanelView();\r\n\t\treturn NodeListPanelView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tNodeListPanelView._I=null;\r\n\tNodeListPanelView.filterDebugNodes=true;\r\n\treturn NodeListPanelView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.NodeToolView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar NodeToolView=(function(_super){\r\n\tfunction NodeToolView(){\r\n\t\tthis.view=null;\r\n\t\tthis.dragIcon=null;\r\n\t\tthis._tar=null;\r\n\t\tNodeToolView.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeToolView,'laya.debug.view.nodeInfo.views.NodeToolView',_super);\r\n\tvar __proto=NodeToolView.prototype;\r\n\t__proto.show=function(){\r\n\t\tthis.showByNode();\r\n\t}\r\n\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new NodeTool();\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.view.on(/*laya.events.Event.CLICK*/\"click\",this,this.onBtnClick);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onCloseBtn);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tthis.dis=this.view;\r\n\t\tthis.view.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onFreshBtn);\r\n\t\tthis.dragIcon=this.view.dragIcon;\r\n\t\tthis.dragIcon.removeSelf();\r\n\t\tthis.dragIcon.on(/*laya.events.Event.DRAG_END*/\"dragend\",this,this.mouseAnalyserDragEnd);\r\n\t\tthis.view.mouseAnalyseBtn.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.mouseAnalyserMouseDown);\r\n\t}\r\n\r\n\t__proto.mouseAnalyserMouseDown=function(){\r\n\t\tvar gPos=NodeToolView.tempPos;\r\n\t\tgPos.setTo(0,0);\r\n\t\tgPos=this.view.mouseAnalyseBtn.localToGlobal(gPos);\r\n\t\tthis.dragIcon.pos(gPos.x,gPos.y);\r\n\t\tthis.dragIcon.mouseEnabled=false;\r\n\t\tLaya.stage.addChild(this.dragIcon);\r\n\t\tthis.dragIcon.startDrag();\r\n\t}\r\n\r\n\t__proto.mouseAnalyserDragEnd=function(){\r\n\t\tthis.dragIcon.removeSelf();\r\n\t\tif (laya.debug.view.nodeInfo.views.NodeToolView.I.target){\r\n\t\t\tMouseEventAnalyser.analyseNode(laya.debug.view.nodeInfo.views.NodeToolView.I.target);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onFreshBtn=function(){\r\n\t\tif (!this._tar)return;\r\n\t\tthis._tar.reCache();\r\n\t\tthis._tar.repaint();\r\n\t}\r\n\r\n\t__proto.onCloseBtn=function(){\r\n\t\tthis.close();\r\n\t}\r\n\r\n\t__proto.onBtnClick=function(e){\r\n\t\tif (!this._tar)return;\r\n\t\tvar tar;\r\n\t\ttar=e.target;\r\n\t\tconsole.log(\"onBtnClick:\",tar);\r\n\t\tvar txt;\r\n\t\ttxt=(tar).label;\r\n\t\tswitch(txt){\r\n\t\t\tcase \"父链\":\r\n\t\t\t\tDebugTool.showParentChain(this._tar);\r\n\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"子\":\r\n\t\t\t\tDebugTool.showAllChild(this._tar);\r\n\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"兄弟\":\r\n\t\t\t\tDebugTool.showAllBrother(this._tar);\r\n\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"Enable链\":\r\n\t\t\t\tOutPutView.I.dTrace(DebugTool.traceDisMouseEnable(this._tar));\r\n\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"Size链\":\r\n\t\t\t\tOutPutView.I.dTrace(DebugTool.traceDisSizeChain(this._tar));\r\n\t\t\t\tSelectInfosView.I.setSelectList(DebugTool.selectedNodes);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"隐藏旁支\":\r\n\t\t\t\tNodeInfoPanel.I.recoverNodes();\r\n\t\t\t\tNodeInfoPanel.I.hideOtherChain(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"隐藏兄弟\":\r\n\t\t\t\tNodeInfoPanel.I.recoverNodes();\r\n\t\t\t\tNodeInfoPanel.I.hideBrothers(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"隐藏子\":\r\n\t\t\t\tNodeInfoPanel.I.recoverNodes();\r\n\t\t\t\tNodeInfoPanel.I.hideChilds(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"恢复\":\r\n\t\t\t\tNodeInfoPanel.I.recoverNodes();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"节点树定位\":\r\n\t\t\t\tToolPanel.I.showSelectInStage(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"显示边框\":\r\n\t\t\t\tDebugTool.showDisBound(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"输出到控制台\":\r\n\t\t\t\tconsole.log(this._tar);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"显示切换\":\r\n\t\t\t\tthis._tar.visible=!this._tar.visible;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__proto.showByNode=function(node,ifShow){\r\n\t\t(ifShow===void 0)&& (ifShow=true);\r\n\t\tif (!node)node=Laya.stage;\r\n\t\tif(ifShow)\r\n\t\t\t_super.prototype.show.call(this);\r\n\t\tthis._tar=node;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tif (!this._tar)return;\r\n\t\tthis.view.tarTxt.text=ClassTool.getNodeClassAndName(this._tar);\r\n\t}\r\n\r\n\t__getset(0,__proto,'target',function(){\r\n\t\treturn this._tar;\r\n\t});\r\n\r\n\t__getset(1,NodeToolView,'I',function(){\r\n\t\tif (!NodeToolView._I)NodeToolView._I=new NodeToolView();\r\n\t\treturn NodeToolView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tNodeToolView._I=null;\r\n\t__static(NodeToolView,\r\n\t['tempPos',function(){return this.tempPos=new Point();}\r\n\t]);\r\n\treturn NodeToolView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.NodeTreeSettingView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar NodeTreeSettingView=(function(_super){\r\n\tfunction NodeTreeSettingView(){\r\n\t\tthis.view=null;\r\n\t\tthis._handler=null;\r\n\t\tNodeTreeSettingView.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeTreeSettingView,'laya.debug.view.nodeInfo.views.NodeTreeSettingView',_super);\r\n\tvar __proto=NodeTreeSettingView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\t_super.prototype.createPanel.call(this);\r\n\t\tthis.view=new NodeTreeSetting();\r\n\t\tStyleConsts.setViewScale(this.view);\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.inits();\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.show=function(){\r\n\t\t_super.prototype.show.call(this);\r\n\t}\r\n\r\n\t__proto.showSetting=function(filters,callBack,tar){\r\n\t\tif ((tar instanceof laya.display.Node )){\r\n\t\t\tthis.view.showTxt.text=NodeConsts.defaultFitlerStr.split(\",\").join(\"\\n\");\r\n\t\t\t}else{\r\n\t\t\tthis.view.showTxt.text=filters.join(\"\\n\");\r\n\t\t}\r\n\t\tthis._handler=callBack;\r\n\t\tthis.show();\r\n\t}\r\n\r\n\t__proto.inits=function(){\r\n\t\tthis.view.okBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onOkBtn);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onCloseBtn);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.onCloseBtn=function(){\r\n\t\tthis.close();\r\n\t}\r\n\r\n\t__proto.onOkBtn=function(){\r\n\t\tthis.close();\r\n\t\tvar showArr;\r\n\t\tshowArr=this.view.showTxt.text.split(\"\\n\");\r\n\t\tif (this._handler){\r\n\t\t\tthis._handler.runWith([showArr]);\r\n\t\t\tthis._handler=null\r\n\t\t}\r\n\t}\r\n\r\n\t__getset(1,NodeTreeSettingView,'I',function(){\r\n\t\tif (!NodeTreeSettingView._I)NodeTreeSettingView._I=new NodeTreeSettingView();\r\n\t\treturn NodeTreeSettingView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tNodeTreeSettingView._I=null;\r\n\treturn NodeTreeSettingView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.NodeTreeView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar NodeTreeView=(function(_super){\r\n\tfunction NodeTreeView(){\r\n\t\tthis.nodeTree=null;\r\n\t\tNodeTreeView.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeTreeView,'laya.debug.view.nodeInfo.views.NodeTreeView',_super);\r\n\tvar __proto=NodeTreeView.prototype;\r\n\t__proto.show=function(){\r\n\t\tthis.showByNode();\r\n\t}\r\n\r\n\t__proto.showByNode=function(node){\r\n\t\tif (!node)node=Laya.stage;\r\n\t\tthis.nodeTree.setDis(node);\r\n\t}\r\n\r\n\t//super.show();\r\n\t__proto.createPanel=function(){\r\n\t\t_super.prototype.createPanel.call(this);\r\n\t\tif (!this.nodeTree)this.nodeTree=new NodeTree();\r\n\t\tthis.dis=null;\r\n\t\tvar view;\r\n\t\tview=this.nodeTree;\r\n\t\tview.top=view.bottom=view.left=view.right=0;\r\n\t\tthis.addChild(view);\r\n\t\tthis.showByNode(Laya.stage);\r\n\t}\r\n\r\n\t__proto.showSelectInStage=function(node){\r\n\t\tthis.showByNode(Laya.stage);\r\n\t\tthis.nodeTree.selectByNode(node);\r\n\t}\r\n\r\n\treturn NodeTreeView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.ObjectCreateView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar ObjectCreateView=(function(_super){\r\n\tfunction ObjectCreateView(){\r\n\t\tthis.view=null;\r\n\t\tthis._menu=null;\r\n\t\tthis._menuItems=[\"统计详情\",\"增量详情\"];\r\n\t\tthis._tSelectKey=null;\r\n\t\tthis.preInfo={};\r\n\t\tObjectCreateView.__super.call(this);\r\n\t\tObjectCreateView._I=this;\r\n\t}\r\n\r\n\t__class(ObjectCreateView,'laya.debug.view.nodeInfo.views.ObjectCreateView',_super);\r\n\tvar __proto=ObjectCreateView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new ObjectCreate();\r\n\t\tthis.view.top=this.view.bottom=this.view.left=this.view.right=0;\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.view.itemList.on(DebugTool.getMenuShowEvent(),this,this.onRightClick);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.fresh);\r\n\t\tthis.view.itemList.scrollBar.hide=true;\r\n\t\tthis._menu=ContextMenu.createMenuByArray(this._menuItems);\r\n\t\tthis._menu.on(/*laya.events.Event.SELECT*/\"select\",this,this.onEmunSelect);\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.onEmunSelect=function(e){\r\n\t\tif (!this._tSelectKey)return;\r\n\t\tvar data=(e.target).data;\r\n\t\tif ((typeof data=='string')){\r\n\t\t\tvar key;\r\n\t\t\tkey=data;\r\n\t\t\tvar count;\r\n\t\t\tswitch (key){\r\n\t\t\t\tcase \"统计详情\":\r\n\t\t\t\t\tcount=RunProfile.getRunInfo(this._tSelectKey);\r\n\t\t\t\t\tif (count){\r\n\t\t\t\t\t\tOutPutView.I.showTxt(this._tSelectKey+\" createInfo:\\n\"+count.traceSelfR());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"增量详情\":\r\n\t\t\t\t\tcount=RunProfile.getRunInfo(this._tSelectKey);\r\n\t\t\t\t\tif (count){\r\n\t\t\t\t\t\tOutPutView.I.showTxt(this._tSelectKey+\" createInfo:\\n\"+count.traceSelfR(count.changeO));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.itemList;\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tthis._tSelectKey=tarNode;\r\n\t\t\tif (this._tSelectKey){\r\n\t\t\t\tthis._menu.show();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.show=function(){\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tvar dataO;\r\n\t\tdataO=ClassCreateHook.I.createInfo;\r\n\t\tvar key;\r\n\t\tvar dataList;\r\n\t\tdataList=[];\r\n\t\tvar tData;\r\n\t\tvar count;\r\n\t\tfor (key in dataO){\r\n\t\t\tif (!this.preInfo[key])\r\n\t\t\t\tthis.preInfo[key]=0;\r\n\t\t\ttData={};\r\n\t\t\ttData.path=key;\r\n\t\t\ttData.count=dataO[key];\r\n\t\t\ttData.add=dataO[key]-this.preInfo[key];\r\n\t\t\tif (tData.add > 0){\r\n\t\t\t\ttData.label=key+\":\"+dataO[key]+\" +\"+tData.add;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ttData.label=key+\":\"+dataO[key];\r\n\t\t\t}\r\n\t\t\tcount=RunProfile.getRunInfo(key);\r\n\t\t\tif (count){\r\n\t\t\t\tcount.record();\r\n\t\t\t}\r\n\t\t\ttData.rank=tData.add *1000+tData.count;\r\n\t\t\tthis.preInfo[key]=dataO[key];\r\n\t\t\tdataList.push(tData);\r\n\t\t}\r\n\t\tdataList.sort(MathTools.sortByKey(\"rank\",true,true));\r\n\t\tthis.view.itemList.array=dataList;\r\n\t}\r\n\r\n\t__getset(1,ObjectCreateView,'I',function(){\r\n\t\tif (!ObjectCreateView._I)\r\n\t\t\tObjectCreateView._I=new ObjectCreateView();\r\n\t\treturn ObjectCreateView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tObjectCreateView._I=null;\r\n\treturn ObjectCreateView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.ObjectInfoView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar ObjectInfoView=(function(_super){\r\n\tfunction ObjectInfoView(){\r\n\t\tthis.view=null;\r\n\t\tthis.showKeys=[\"x\",\"y\",\"width\",\"height\",\"renderCost\"];\r\n\t\tthis._closeSettingHandler=null;\r\n\t\tthis._tar=null;\r\n\t\tObjectInfoView.__super.call(this);\r\n\t}\r\n\r\n\t__class(ObjectInfoView,'laya.debug.view.nodeInfo.views.ObjectInfoView',_super);\r\n\tvar __proto=ObjectInfoView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\t_super.prototype.createPanel.call(this);\r\n\t\tthis.view=new ObjectInfo();\r\n\t\tStyleConsts.setViewScale(this.view);\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.inits();\r\n\t}\r\n\r\n\t__proto.inits=function(){\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.settingBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onSettingBtn);\r\n\t\tthis.view.autoUpdate.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onAutoUpdateChange);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tDisControlTool.setResizeAbleEx(this.view);\r\n\t\tthis._closeSettingHandler=new Handler(this,this.closeSetting);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.onAutoUpdateChange=function(){\r\n\t\tthis.autoUpdate=this.view.autoUpdate.selected;\r\n\t}\r\n\r\n\t__proto.onSettingBtn=function(){\r\n\t\tNodeTreeSettingView.I.showSetting(this.showKeys,this._closeSettingHandler,this._tar);\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tthis.showKeys=[\"x\",\"y\",\"width\",\"height\",\"renderCost\"];\r\n\t}\r\n\r\n\t__proto.closeSetting=function(newKeys){\r\n\t\tthis.showKeys=newKeys;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.showObjectInfo=function(obj){\r\n\t\tthis._tar=obj;\r\n\t\tthis.fresh();\r\n\t\tthis.show();\r\n\t\tthis.onAutoUpdateChange();\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tif (!this._tar){\r\n\t\t\tthis.view.showTxt.text=\"\";\r\n\t\t\tthis.view.title.text=\"未选中对象\";\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.view.title.text=ClassTool.getNodeClassAndName(this._tar);\r\n\t\t\tthis.view.showTxt.text=ObjectInfoView.getObjValueStr(this._tar,this.showKeys,false);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.freshKeyInfos=function(){\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.close=function(){\r\n\t\t_super.prototype.close.call(this);\r\n\t\tthis.autoUpdate=false;\r\n\t\tPool.recover(\"ObjectInfoView\",this);\r\n\t}\r\n\r\n\t__proto.show=function(){\r\n\t\t_super.prototype.show.call(this);\r\n\t}\r\n\r\n\t__getset(0,__proto,'autoUpdate',null,function(v){\r\n\t\tLaya.timer.clear(this,this.freshKeyInfos);\r\n\t\tif (v){\r\n\t\t\tLaya.timer.loop(2000,this,this.freshKeyInfos);\r\n\t\t}\r\n\t});\r\n\r\n\tObjectInfoView.getObjValueStr=function(obj,keys,withTitle){\r\n\t\t(withTitle===void 0)&& (withTitle=true);\r\n\t\tvar i=0,len=0;\r\n\t\tvar tKey;\r\n\t\tObjectInfoView._txts.length=0;\r\n\t\tlen=keys.length;\r\n\t\tif (withTitle){\r\n\t\t\tif (obj.name){\r\n\t\t\t\tObjectInfoView._txts.push(ClassTool.getClassName(obj)+\"(\"+obj.name+\")\");\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tObjectInfoView._txts.push(ClassTool.getClassName(obj));\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttKey=keys[i];\r\n\t\t\tObjectInfoView._txts.push(tKey+\":\"+ObjectInfoView.getNodeValue(obj,tKey));\r\n\t\t}\r\n\t\treturn ObjectInfoView._txts.join(\"\\n\");\r\n\t}\r\n\r\n\tObjectInfoView.getNodeValue=function(node,key){\r\n\t\tvar rst;\r\n\t\tif ((node instanceof laya.display.Sprite )){\r\n\t\t\tvar tNode;\r\n\t\t\ttNode=node;\r\n\t\t\tswitch (key){\r\n\t\t\t\tcase \"gRec\":\r\n\t\t\t\t\trst=NodeUtils.getGRec(tNode).toString();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"gAlpha\":\r\n\t\t\t\t\trst=NodeUtils.getGAlpha(tNode)+\"\";\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"cmdCount\":\r\n\t\t\t\t\trst=NodeUtils.getNodeCmdCount(tNode)+\"\";\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"cmdAll\":\r\n\t\t\t\t\trst=NodeUtils.getNodeCmdTotalCount(tNode)+\"\";\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"nodeAll\":\r\n\t\t\t\t\trst=\"\"+NodeUtils.getNodeCount(tNode);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"nodeVisible\":\r\n\t\t\t\t\trst=\"\"+NodeUtils.getNodeCount(tNode,true);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"nodeRender\":\r\n\t\t\t\t\trst=\"\"+NodeUtils.getRenderNodeCount(tNode);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"nodeReCache\":\r\n\t\t\t\t\trst=\"\"+NodeUtils.getReFreshRenderNodeCount(tNode);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"renderCost\":\r\n\t\t\t\t\trst=\"\"+RenderAnalyser.I.getTime(tNode);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"renderCount\":\r\n\t\t\t\t\trst=\"\"+RenderAnalyser.I.getCount(tNode);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\trst=node[key]+\"\";\r\n\t\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\trst=node[key]+\"\";\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tObjectInfoView.showObject=function(obj){\r\n\t\tvar infoView;\r\n\t\tinfoView=Pool.getItemByClass(\"ObjectInfoView\",ObjectInfoView);\r\n\t\tinfoView.reset();\r\n\t\tinfoView.showObjectInfo(obj);\r\n\t}\r\n\r\n\tObjectInfoView._txts=[];\r\n\treturn ObjectInfoView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.OutPutView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar OutPutView=(function(_super){\r\n\tfunction OutPutView(){\r\n\t\tthis.view=null;\r\n\t\tOutPutView.__super.call(this);\r\n\t\tDebugTool._logFun=OutPutView.log;\r\n\t}\r\n\r\n\t__class(OutPutView,'laya.debug.view.nodeInfo.views.OutPutView',_super);\r\n\tvar __proto=OutPutView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new OutPut();\r\n\t\tDisControlTool.setDragingItem(this.view.txt,this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tStyleConsts.setViewScale(this.view);\r\n\t\tthis.view.txt.textField.overflow=Text.SCROLL;\r\n\t\tthis.view.txt.textField.wordWrap=true;\r\n\t\tthis.view.on(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this,this.mouseWheel);\r\n\t\tthis.view.txt.text=\"\";\r\n\t\tDisControlTool.setResizeAbleEx(this.view);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.clearBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onClearBtn);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.onClearBtn=function(){\r\n\t\tthis.clearText();\r\n\t}\r\n\r\n\t__proto.mouseWheel=function(e){\r\n\t\tthis.view.txt.textField.scrollY-=e.delta*10;\r\n\t}\r\n\r\n\t__proto.showTxt=function(str){\r\n\t\tthis.view.txt.text=str;\r\n\t\tthis.show();\r\n\t\tthis.view.txt.textField.scrollY=this.view.txt.textField.maxScrollY;\r\n\t}\r\n\r\n\t__proto.clearText=function(){\r\n\t\tthis.view.txt.text=\"\";\r\n\t}\r\n\r\n\t__proto.dTrace=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\tif (this.view.txt.textField.scrollY > 1000){\r\n\t\t\tthis.view.txt.text=\"\";\r\n\t\t};\r\n\t\tvar str;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arg.length;\r\n\t\tstr=arg[0];\r\n\t\tfor (i=1;i < len;i++){\r\n\t\t\tstr+=\" \"+arg[i];\r\n\t\t}\r\n\t\tthis.addStr(str);\r\n\t}\r\n\r\n\t__proto.addStr=function(str){\r\n\t\tthis.view.txt.text+=\"\\n\"+str;\r\n\t\tthis.show();\r\n\t\tthis.view.txt.textField.scrollY=this.view.txt.textField.maxScrollY;\r\n\t}\r\n\r\n\t__getset(1,OutPutView,'I',function(){\r\n\t\tif (!OutPutView._I)OutPutView._I=new OutPutView();\r\n\t\treturn OutPutView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tOutPutView.log=function(str){\r\n\t\tOutPutView.I.addStr(str);\r\n\t}\r\n\r\n\tOutPutView._I=null;\r\n\treturn OutPutView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.RenderCostRankView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar RenderCostRankView=(function(_super){\r\n\tfunction RenderCostRankView(){\r\n\t\tthis.view=null;\r\n\t\tRenderCostRankView.__super.call(this);\r\n\t}\r\n\r\n\t__class(RenderCostRankView,'laya.debug.view.nodeInfo.views.RenderCostRankView',_super);\r\n\tvar __proto=RenderCostRankView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new Rank();\r\n\t\tthis.view.top=this.view.bottom=this.view.left=this.view.right=0;\r\n\t\tthis.addChild(this.view);\r\n\t\tNodeMenu.I.setNodeListAction(this.view.itemList);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.fresh);\r\n\t\tthis.view.itemList.scrollBar.hide=true;\r\n\t\tthis.view.autoUpdate.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onAutoUpdateChange);\r\n\t\tthis.dis=this;\r\n\t\tthis.view.itemList.array=[];\r\n\t\tthis.onAutoUpdateChange();\r\n\t\tthis.fresh();\r\n\t\tLaya.timer.once(5000,this,this.fresh);\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.itemList;\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onAutoUpdateChange=function(){\r\n\t\tthis.autoUpdate=this.view.autoUpdate.selected;\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tthis.view.title.text=\"渲染用时排行(\"+NodeConsts.RenderCostMaxTime+\"ms)\";\r\n\t\tvar nodeDic;\r\n\t\tnodeDic=RenderAnalyser.I.nodeDic;\r\n\t\tvar key;\r\n\t\tvar tNode;\r\n\t\tvar tData;\r\n\t\tvar dataList;\r\n\t\tdataList=[];\r\n\t\tfor (key in nodeDic){\r\n\t\t\ttNode=nodeDic[key];\r\n\t\t\tif (RenderCostRankView.filterDebugNodes && DisControlTool.isInTree(DebugInfoLayer.I,tNode))continue ;\r\n\t\t\tif (RenderAnalyser.I.getTime(tNode)<=0)continue ;\r\n\t\t\ttData={};\r\n\t\t\ttData.time=RenderAnalyser.I.getTime(tNode);\r\n\t\t\tif (RenderCostRankView.filterDebugNodes && tNode==Laya.stage){\r\n\t\t\t\ttData.time-=RenderAnalyser.I.getTime(DebugInfoLayer.I);\r\n\t\t\t}\r\n\t\t\ttData.path=tNode;\r\n\t\t\ttData.label=ClassTool.getNodeClassAndName(tNode)+\":\"+tData.time;\r\n\t\t\tdataList.push(tData);\r\n\t\t}\r\n\t\tdataList.sort(MathTools.sortByKey(\"time\",true,true));\r\n\t\tthis.view.itemList.array=dataList;\r\n\t}\r\n\r\n\t__getset(0,__proto,'autoUpdate',null,function(v){\r\n\t\tLaya.timer.clear(this,this.fresh);\r\n\t\tif (v){\r\n\t\t\tthis.fresh();\r\n\t\t\tLaya.timer.loop(NodeConsts.RenderCostMaxTime,this,this.fresh);\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(1,RenderCostRankView,'I',function(){\r\n\t\tif (!RenderCostRankView._I)\r\n\t\t\tRenderCostRankView._I=new RenderCostRankView();\r\n\t\treturn RenderCostRankView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tRenderCostRankView._I=null;\r\n\tRenderCostRankView.filterDebugNodes=true;\r\n\treturn RenderCostRankView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.ResRankView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar ResRankView=(function(_super){\r\n\tfunction ResRankView(){\r\n\t\tthis.view=null;\r\n\t\tResRankView.__super.call(this);\r\n\t}\r\n\r\n\t__class(ResRankView,'laya.debug.view.nodeInfo.views.ResRankView',_super);\r\n\tvar __proto=ResRankView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new Rank();\r\n\t\tthis.view.top=this.view.bottom=this.view.left=this.view.right=0;\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.fresh);\r\n\t\tthis.view.itemList.scrollBar.hide=true;\r\n\t\tthis.view.autoUpdate.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onAutoUpdateChange);\r\n\t\tthis.dis=this;\r\n\t\tthis.view.itemList.array=[];\r\n\t\tthis.view.itemList.on(/*laya.events.Event.RIGHT_CLICK*/\"rightclick\",this,this.onRightClick);\r\n\t\tthis.onAutoUpdateChange();\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.itemList;\r\n\t\tif (list.selectedItem){\r\n\t\t\tconsole.log(list.selectedItem[\"url\"]);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onAutoUpdateChange=function(){\r\n\t\tthis.autoUpdate=this.view.autoUpdate.selected;\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tthis.view.title.text=\"图片缓存列表\";\r\n\t\tvar resList;\r\n\t\tresList=ResTools.getCachedResList();\r\n\t\tvar key;\r\n\t\tvar tNode;\r\n\t\tvar tData;\r\n\t\tvar dataList;\r\n\t\tdataList=[];\r\n\t\tvar i=0,len=0;\r\n\t\tlen=resList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttData={};\r\n\t\t\tvar tUrl;\r\n\t\t\ttUrl=resList[i];\r\n\t\t\ttUrl=tUrl.replace(URL.rootPath,\"\")\r\n\t\t\ttData.label=tUrl;\r\n\t\t\ttData.url=tUrl;\r\n\t\t\tdataList.push(tData);\r\n\t\t}\r\n\t\tthis.view.itemList.array=dataList;\r\n\t}\r\n\r\n\t__getset(0,__proto,'autoUpdate',null,function(v){\r\n\t\tLaya.timer.clear(this,this.fresh);\r\n\t\tif (v){\r\n\t\t\tthis.fresh();\r\n\t\t\tLaya.timer.loop(NodeConsts.RenderCostMaxTime,this,this.fresh);\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(1,ResRankView,'I',function(){\r\n\t\tif (!ResRankView._I)\r\n\t\t\tResRankView._I=new ResRankView();\r\n\t\treturn ResRankView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tResRankView._I=null;\r\n\tResRankView.filterDebugNodes=true;\r\n\treturn ResRankView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.SelectInfosView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar SelectInfosView=(function(_super){\r\n\tfunction SelectInfosView(){\r\n\t\tthis.showKeys=[];\r\n\t\tthis.view=null;\r\n\t\tthis.fliterTxt=null;\r\n\t\tthis.itemList=null;\r\n\t\tSelectInfosView.__super.call(this);\r\n\t\tSelectInfosView._I=this;\r\n\t\tthis.setSelectList(null);\r\n\t}\r\n\r\n\t__class(SelectInfosView,'laya.debug.view.nodeInfo.views.SelectInfosView',_super);\r\n\tvar __proto=SelectInfosView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new SelectInfos();\r\n\t\tthis.addChild(this.view);\r\n\t\tthis.view.top=this.view.bottom=this.view.left=this.view.right=0;\r\n\t\tNodeMenu.I.setNodeListAction(this.view.selectList);\r\n\t\tthis.view.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.close);\r\n\t\tthis.view.selectList.scrollBar.hide=true;\r\n\t\tthis.dis=null;\r\n\t\tthis.view.findBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onFindBtn);\r\n\t\tthis.fliterTxt=this.view.fliterTxt;\r\n\t\tthis.view.fliterTxt.on(/*laya.events.Event.ENTER*/\"enter\",this,this.onFliterTxtChange);\r\n\t\tthis.view.fliterTxt.on(/*laya.events.Event.BLUR*/\"blur\",this,this.onFliterTxtChange);\r\n\t}\r\n\r\n\t__proto.onFliterTxtChange=function(e){\r\n\t\tvar key;\r\n\t\tkey=this.fliterTxt.text;\r\n\t\tif (key==\"\"){\r\n\t\t\tif (this.showKeys.length !=0){\r\n\t\t\t\tthis.showKeys.length=0;\r\n\t\t\t\tthis.fresh();\r\n\t\t\t}\r\n\t\t}else\r\n\t\tif (key !=this.showKeys.join(\",\")){\r\n\t\t\tthis.showKeys=key.split(\",\");\r\n\t\t\tthis.fresh();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onFindBtn=function(){\r\n\t\tFindSmallView.I.show();\r\n\t}\r\n\r\n\t__proto.onRightClick=function(){\r\n\t\tvar list;\r\n\t\tlist=this.view.selectList;\r\n\t\tif (list.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=list.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.setSelectTarget=function(node){\r\n\t\tif (!node)return;\r\n\t\tthis.setSelectList([node]);\r\n\t}\r\n\r\n\t__proto.setSelectList=function(list){\r\n\t\tthis.itemList=list;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t//show();\r\n\t__proto.fresh=function(){\r\n\t\tvar list;\r\n\t\tlist=this.itemList;\r\n\t\tif (!list || list.length < 1){\r\n\t\t\tthis.view.selectList.array=[];\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tvar tDis;\r\n\t\tvar tData;\r\n\t\tlen=list.length;\r\n\t\tvar disList;\r\n\t\tdisList=[];\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttDis=list[i];\r\n\t\t\ttData={};\r\n\t\t\ttData.label=this.getLabelTxt(tDis);\r\n\t\t\ttData.path=tDis;\r\n\t\t\tdisList.push(tData);\r\n\t\t}\r\n\t\tthis.view.selectList.array=disList;\r\n\t}\r\n\r\n\t__proto.getLabelTxt=function(item){\r\n\t\tvar rst;\r\n\t\trst=ClassTool.getNodeClassAndName(item);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=this.showKeys.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst+=\",\"+ObjectInfoView.getNodeValue(item,this.showKeys[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__getset(1,SelectInfosView,'I',function(){\r\n\t\tif (!SelectInfosView._I)SelectInfosView._I=new SelectInfosView();\r\n\t\treturn SelectInfosView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tSelectInfosView._I=null;\r\n\treturn SelectInfosView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.ToolBarView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar ToolBarView=(function(_super){\r\n\tfunction ToolBarView(){\r\n\t\tthis.view=null;\r\n\t\tToolBarView.__super.call(this);\r\n\t}\r\n\r\n\t__class(ToolBarView,'laya.debug.view.nodeInfo.views.ToolBarView',_super);\r\n\tvar __proto=ToolBarView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.view=new ToolBar();\r\n\t\tthis.addChild(this.view);\r\n\t\tDisControlTool.setDragingItem(this.view.bg,this.view);\r\n\t\tthis.view.on(/*laya.events.Event.CLICK*/\"click\",this,this.onBtnClick);\r\n\t\tthis.view.minBtn.minHandler=this.minHandler;\r\n\t\tthis.view.minBtn.maxHandler=this.maxHandler;\r\n\t\tthis.view.minBtn.tar=this.view;\r\n\t\tthis.clickSelectChange();\r\n\t\tthis.view.selectWhenClick.on(/*laya.events.Event.CHANGE*/\"change\",this,this.clickSelectChange);\r\n\t\tNotice.listen(/*laya.debug.tools.DisplayHook.ITEM_CLICKED*/\"ItemClicked\",this,this.itemClicked);\r\n\t\tthis.dis=this.view;\r\n\t}\r\n\r\n\t__proto.itemClicked=function(tar){\r\n\t\tif (!ToolBarView.isClickSelectState)return;\r\n\t\tif (DisControlTool.isInTree(this.view.selectWhenClick,tar))return;\r\n\t\tif (ToolBarView.ignoreDebugTool){\r\n\t\t\tif (DebugInfoLayer.I.isDebugItem(tar))return;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.clickSelectChange=function(){\r\n\t\tToolBarView.isClickSelectState=this.view.selectWhenClick.selected;\r\n\t}\r\n\r\n\t__proto.firstShowFun=function(){\r\n\t\tthis.dis.x=Laya.stage.width-this.dis.width-20;\r\n\t\tthis.dis.y=5;\r\n\t}\r\n\r\n\t__proto.onBtnClick=function(e){\r\n\t\tswitch(e.target){\r\n\t\t\tcase this.view.treeBtn:\r\n\t\t\t\tToolPanel.I.switchShow(/*laya.debug.view.nodeInfo.ToolPanel.Tree*/\"Tree\");\r\n\t\t\t\tbreak ;\r\n\t\t\tcase this.view.findBtn:\r\n\t\t\t\tToolPanel.I.switchShow(/*laya.debug.view.nodeInfo.ToolPanel.Find*/\"Find\");\r\n\t\t\t\tbreak ;\r\n\t\t\tcase this.view.clearBtn:\r\n\t\t\t\tDebugTool.clearDebugLayer();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase this.view.rankBtn:\r\n\t\t\t\tRenderCostRankView.I.show();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase this.view.nodeRankBtn:\r\n\t\t\t\tObjectCreateView.I.show();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase this.view.cacheBtn:\r\n\t\t\t\tNodeUtils.showCachedSpriteRecs();\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__getset(1,ToolBarView,'I',function(){\r\n\t\tif (!ToolBarView._I)ToolBarView._I=new ToolBarView();\r\n\t\treturn ToolBarView._I;\r\n\t},laya.debug.view.nodeInfo.views.UIViewBase._$SET_I);\r\n\r\n\tToolBarView._I=null;\r\n\tToolBarView.ignoreDebugTool=true;\r\n\tToolBarView.isClickSelectState=false;\r\n\treturn ToolBarView;\r\n})(UIViewBase)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.views.TxtInfoView extends laya.debug.view.nodeInfo.views.UIViewBase\r\nvar TxtInfoView=(function(_super){\r\n\tfunction TxtInfoView(){\r\n\t\tthis.input=null;\r\n\t\tthis.btn=null;\r\n\t\tTxtInfoView.__super.call(this);\r\n\t}\r\n\r\n\t__class(TxtInfoView,'laya.debug.view.nodeInfo.views.TxtInfoView',_super);\r\n\tvar __proto=TxtInfoView.prototype;\r\n\t__proto.createPanel=function(){\r\n\t\tthis.input=new Input();\r\n\t\tthis.input.size(200,400);\r\n\t\tthis.input.multiline=true;\r\n\t\tthis.input.bgColor=\"#ff00ff\";\r\n\t\tthis.input.fontSize=12;\r\n\t\tthis.input.wordWrap=true;\r\n\t\tthis.addChild(this.input);\r\n\t\tthis.btn=this.getButton();\r\n\t\tthis.btn.text=\"关闭\";\r\n\t\tthis.btn.size(50,20);\r\n\t\tthis.btn.align=\"center\";\r\n\t\tthis.btn.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onCloseBtn);\r\n\t\tthis.btn.pos(5,this.input.height+5);\r\n\t\tthis.addChild(this.btn);\r\n\t}\r\n\r\n\t__proto.showInfo=function(txt){\r\n\t\tthis.input.text=txt;\r\n\t\tthis.show();\r\n\t}\r\n\r\n\t__proto.show=function(){\r\n\t\tDebugInfoLayer.I.setTop();\r\n\t\tDebugInfoLayer.I.popLayer.addChild(this);\r\n\t\tthis.x=(Laya.stage.width-this.width);\r\n\t\tthis.y=0;\r\n\t}\r\n\r\n\t__proto.onCloseBtn=function(){\r\n\t\tthis.close();\r\n\t}\r\n\r\n\treturn TxtInfoView;\r\n})(UIViewBase)\r\n\r\n\r\n//class laya.debug.ui.debugui.CodeUsedResUI extends laya.ui.View\r\nvar CodeUsedResUI=(function(_super){\r\n\tfunction CodeUsedResUI(){\r\n\t\tthis.tab=null;\r\n\t\tCodeUsedResUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(CodeUsedResUI,'laya.debug.ui.debugui.CodeUsedResUI',_super);\r\n\tvar __proto=CodeUsedResUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(CodeUsedResUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(CodeUsedResUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":359,\"y\":91,\"skin\":\"comp/button1.png\"},\"type\":\"Image\"},{\"props\":{\"x\":309,\"y\":283,\"skin\":\"comp/line2.png\"},\"type\":\"Image\"},{\"type\":\"Tab\",\"child\":[{\"props\":{\"skin\":\"view/create.png\",\"label\":\"  对象创建\",\"width\":70,\"height\":17,\"name\":\"item0\"},\"type\":\"CheckBox\"},{\"props\":{\"x\":70,\"skin\":\"view/rendertime.png\",\"label\":\"渲染用时\",\"width\":70,\"height\":19,\"name\":\"item1\"},\"type\":\"CheckBox\"},{\"props\":{\"x\":140,\"skin\":\"view/cache.png\",\"label\":\"Cache\",\"width\":70,\"height\":16,\"name\":\"item2\"},\"type\":\"CheckBox\"}],\"props\":{\"x\":76,\"y\":210,\"selectedIndex\":0,\"var\":\"tab\"}}],\"props\":{\"width\":600,\"height\":400,\"base64pic\":true}};}\r\n\t]);\r\n\treturn CodeUsedResUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.comps.ListItemUI extends laya.ui.View\r\nvar ListItemUI=(function(_super){\r\n\tfunction ListItemUI(){\r\n\t\tListItemUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(ListItemUI,'laya.debug.ui.debugui.comps.ListItemUI',_super);\r\n\tvar __proto=ListItemUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(ListItemUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(ListItemUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"base64pic\":true,\"width\":244,\"height\":19},\"child\":[{\"type\":\"Clip\",\"props\":{\"y\":-1,\"skin\":\"comp/clip_selectBox.png\",\"clipY\":2,\"height\":19,\"name\":\"selectBox\",\"left\":2,\"right\":2,\"x\":0}},{\"type\":\"Label\",\"props\":{\"x\":25,\"text\":\"render\",\"color\":\"#dcea36\",\"width\":77,\"height\":17,\"name\":\"label\",\"y\":2,\"fontSize\":12}},{\"type\":\"Clip\",\"props\":{\"skin\":\"comp/clip_tree_arrow.png\",\"clipY\":2,\"name\":\"arrow\",\"x\":8,\"y\":4,\"mouseEnabled\":false}}]};}\r\n\t]);\r\n\treturn ListItemUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.comps.RankListItemUI extends laya.ui.View\r\nvar RankListItemUI=(function(_super){\r\n\tfunction RankListItemUI(){\r\n\t\tRankListItemUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(RankListItemUI,'laya.debug.ui.debugui.comps.RankListItemUI',_super);\r\n\tvar __proto=RankListItemUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(RankListItemUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(RankListItemUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"y\":-1,\"skin\":\"comp/clip_selectBox.png\",\"clipY\":2,\"height\":19,\"name\":\"selectBox\",\"left\":0,\"right\":0,\"x\":0},\"type\":\"Clip\"},{\"props\":{\"text\":\"render\",\"color\":\"#a0a0a0\",\"height\":15,\"name\":\"label\",\"y\":2,\"left\":11,\"right\":5,\"fontSize\":12,\"x\":11,\"width\":163},\"type\":\"Label\"}],\"props\":{\"width\":179,\"height\":19}};}\r\n\t]);\r\n\treturn RankListItemUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.DebugPanelUI extends laya.ui.View\r\nvar DebugPanelUI=(function(_super){\r\n\tfunction DebugPanelUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.minBtn=null;\r\n\t\tthis.treePanel=null;\r\n\t\tthis.selectWhenClick=null;\r\n\t\tthis.profilePanel=null;\r\n\t\tthis.resizeBtn=null;\r\n\t\tthis.mouseAnalyseBtn=null;\r\n\t\tthis.dragIcon=null;\r\n\t\tthis.clearBtn=null;\r\n\t\tthis.selectPanel=null;\r\n\t\tthis.tab=null;\r\n\t\tDebugPanelUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(DebugPanelUI,'laya.debug.ui.debugui.DebugPanelUI',_super);\r\n\tvar __proto=DebugPanelUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(DebugPanelUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.nodetree.MinBtnComp\",MinBtnComp);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.NodeTreeView\",NodeTreeView);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.nodetree.Profile\",Profile);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.SelectInfosView\",SelectInfosView);\r\n\t}\r\n\r\n\t__static(DebugPanelUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"base64pic\":true,\"width\":260,\"height\":400},\"child\":[{\"type\":\"Image\",\"props\":{\"x\":205,\"y\":254,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"}},{\"type\":\"Image\",\"props\":{\"y\":0,\"skin\":\"view/bg_top.png\",\"left\":0,\"right\":0}},{\"type\":\"MinBtnComp\",\"props\":{\"y\":-3,\"var\":\"minBtn\",\"runtime\":\"laya.debug.view.nodeInfo.nodetree.MinBtnComp\",\"right\":-3,\"x\":207}},{\"type\":\"NodeTree\",\"props\":{\"left\":0,\"right\":0,\"top\":32,\"bottom\":0,\"name\":\"节点树\",\"var\":\"treePanel\",\"runtime\":\"laya.debug.view.nodeInfo.views.NodeTreeView\"}},{\"type\":\"CheckBox\",\"props\":{\"x\":8,\"y\":9,\"skin\":\"view/clickselect.png\",\"toolTip\":\"点击选取\",\"var\":\"selectWhenClick\",\"mouseEnabled\":true,\"width\":14,\"height\":14}},{\"type\":\"Profile\",\"props\":{\"name\":\"性能\",\"top\":32,\"right\":0,\"left\":0,\"bottom\":0,\"var\":\"profilePanel\",\"runtime\":\"laya.debug.view.nodeInfo.nodetree.Profile\"}},{\"type\":\"Button\",\"props\":{\"x\":169,\"y\":247,\"skin\":\"view/resize.png\",\"right\":2,\"bottom\":2,\"name\":\"resizeBtn\",\"var\":\"resizeBtn\",\"stateNum\":3}},{\"type\":\"Clip\",\"props\":{\"y\":9,\"skin\":\"view/clickanalyse.png\",\"var\":\"mouseAnalyseBtn\",\"toolTip\":\"拖动选取\",\"left\":33,\"x\":33,\"clipY\":3}},{\"type\":\"Clip\",\"props\":{\"y\":0,\"skin\":\"view/clickanalyse.png\",\"var\":\"dragIcon\",\"x\":33,\"clipY\":3}},{\"type\":\"Button\",\"props\":{\"y\":7,\"skin\":\"view/res.png\",\"stateNum\":2,\"toolTip\":\"清除边框\",\"var\":\"clearBtn\",\"right\":34,\"x\":184}},{\"type\":\"SelectInfos\",\"props\":{\"top\":32,\"left\":0,\"right\":0,\"bottom\":0,\"name\":\"选中\",\"var\":\"selectPanel\",\"runtime\":\"laya.debug.view.nodeInfo.views.SelectInfosView\"}},{\"type\":\"Tab\",\"props\":{\"x\":59,\"y\":0,\"name\":\"tab\",\"var\":\"tab\",\"selectedIndex\":0},\"child\":[{\"type\":\"Button\",\"props\":{\"skin\":\"view/tab_panel.png\",\"label\":\"节点\",\"width\":42,\"height\":32,\"name\":\"item0\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":42,\"skin\":\"view/tab_panel.png\",\"label\":\"查询\",\"width\":42,\"height\":32,\"name\":\"item1\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":84,\"skin\":\"view/tab_panel.png\",\"label\":\"性能\",\"width\":42,\"height\":32,\"name\":\"item2\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}}]}]};}\r\n\t]);\r\n\treturn DebugPanelUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.FindNodeSmallUI extends laya.ui.View\r\nvar FindNodeSmallUI=(function(_super){\r\n\tfunction FindNodeSmallUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.title=null;\r\n\t\tthis.typeSelect=null;\r\n\t\tthis.findTxt=null;\r\n\t\tthis.findBtn=null;\r\n\t\tFindNodeSmallUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(FindNodeSmallUI,'laya.debug.ui.debugui.FindNodeSmallUI',_super);\r\n\tvar __proto=FindNodeSmallUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(FindNodeSmallUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(FindNodeSmallUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":185,\"y\":234,\"skin\":\"view/bg_tool.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\"},\"type\":\"Image\"},{\"props\":{\"x\":185,\"y\":15,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2},\"type\":\"Button\"},{\"props\":{\"x\":6,\"y\":4,\"text\":\"查找对象\",\"width\":67,\"height\":20,\"color\":\"#288edf\",\"var\":\"title\"},\"type\":\"Label\"},{\"props\":{\"x\":60,\"y\":81,\"skin\":\"comp/combobox.png\",\"labels\":\"name,class\",\"width\":63,\"height\":21,\"var\":\"typeSelect\",\"sizeGrid\":\"5,35,5,5\",\"labelColors\":\"#a0a0a0,#fffff,#ffffff#fffff\"},\"type\":\"ComboBox\"},{\"props\":{\"x\":27,\"y\":83,\"text\":\"类型\",\"width\":27,\"height\":20,\"color\":\"#288edf\",\"align\":\"right\"},\"type\":\"Label\"},{\"props\":{\"x\":7,\"y\":40,\"text\":\"包含内容\",\"width\":47,\"height\":20,\"color\":\"#288edf\",\"align\":\"right\"},\"type\":\"Label\"},{\"props\":{\"x\":60,\"y\":37,\"skin\":\"comp/textinput.png\",\"text\":\"Sprite\",\"width\":164,\"height\":22,\"var\":\"findTxt\",\"sizeGrid\":\"5,5,5,5\",\"color\":\"#a0a0a0\"},\"type\":\"TextInput\"},{\"props\":{\"x\":158,\"y\":79,\"skin\":\"comp/button.png\",\"label\":\"查找\",\"width\":65,\"height\":23,\"var\":\"findBtn\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"},\"type\":\"Button\"}],\"props\":{\"base64pic\":true,\"width\":233,\"height\":120}};}\r\n\t]);\r\n\treturn FindNodeSmallUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.FindNodeUI extends laya.ui.View\r\nvar FindNodeUI=(function(_super){\r\n\tfunction FindNodeUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.title=null;\r\n\t\tthis.typeSelect=null;\r\n\t\tthis.findTxt=null;\r\n\t\tthis.result=null;\r\n\t\tthis.findBtn=null;\r\n\t\tFindNodeUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(FindNodeUI,'laya.debug.ui.debugui.FindNodeUI',_super);\r\n\tvar __proto=FindNodeUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(FindNodeUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.RankListItem\",RankListItem);\r\n\t}\r\n\r\n\t__static(FindNodeUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":185,\"y\":234,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":185,\"y\":15,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2},\"type\":\"Button\"},{\"props\":{\"x\":6,\"y\":4,\"text\":\"查找对象\",\"width\":67,\"height\":20,\"color\":\"#88ef19\",\"var\":\"title\"},\"type\":\"Label\"},{\"props\":{\"x\":52,\"y\":75,\"skin\":\"comp/combobox.png\",\"labels\":\"name,class\",\"width\":63,\"height\":21,\"var\":\"typeSelect\",\"sizeGrid\":\"5,35,5,5\",\"labelColors\":\"#a0a0a0,#fffff,#ffffff#fffff\"},\"type\":\"ComboBox\"},{\"props\":{\"x\":10,\"y\":77,\"text\":\"类型\",\"width\":27,\"height\":20,\"color\":\"#88ef19\",\"align\":\"right\"},\"type\":\"Label\"},{\"props\":{\"x\":7,\"y\":34,\"text\":\"包含内容\",\"width\":47,\"height\":20,\"color\":\"#88ef19\",\"align\":\"right\"},\"type\":\"Label\"},{\"props\":{\"x\":59,\"y\":31,\"skin\":\"comp/textinput.png\",\"text\":\"Sprite\",\"width\":131,\"height\":22,\"var\":\"findTxt\",\"sizeGrid\":\"5,5,5,5\",\"color\":\"#a0a0a0\"},\"type\":\"TextInput\"},{\"type\":\"List\",\"child\":[{\"type\":\"RankListItem\",\"props\":{\"y\":30,\"left\":5,\"right\":5,\"name\":\"render\",\"x\":30,\"runtime\":\"laya.debug.uicomps.RankListItem\"}}],\"props\":{\"x\":6,\"y\":106,\"width\":188,\"height\":180,\"vScrollBarSkin\":\"comp/vscroll.png\",\"var\":\"result\"}},{\"props\":{\"x\":125,\"y\":73,\"skin\":\"comp/button.png\",\"label\":\"查找\",\"width\":65,\"height\":23,\"var\":\"findBtn\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"},\"type\":\"Button\"}],\"props\":{\"width\":200,\"height\":300,\"base64pic\":true}};}\r\n\t]);\r\n\treturn FindNodeUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.MinBtnCompUI extends laya.ui.View\r\nvar MinBtnCompUI=(function(_super){\r\n\tfunction MinBtnCompUI(){\r\n\t\tthis.minBtn=null;\r\n\t\tthis.maxUI=null;\r\n\t\tthis.bg=null;\r\n\t\tthis.maxBtn=null;\r\n\t\tMinBtnCompUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(MinBtnCompUI,'laya.debug.ui.debugui.MinBtnCompUI',_super);\r\n\tvar __proto=MinBtnCompUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(MinBtnCompUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(MinBtnCompUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":7,\"y\":8,\"skin\":\"comp/minBtn.png\",\"stateNum\":\"3\",\"var\":\"minBtn\",\"width\":22,\"height\":20,\"toolTip\":\"最小化\"},\"type\":\"Button\"},{\"type\":\"Box\",\"child\":[{\"props\":{\"x\":0,\"y\":0,\"skin\":\"view/bg_panel.png\",\"var\":\"bg\",\"width\":36,\"height\":36,\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":6,\"y\":8,\"skin\":\"view/zoom_out.png\",\"stateNum\":\"2\",\"var\":\"maxBtn\"},\"type\":\"Button\"}],\"props\":{\"var\":\"maxUI\"}}],\"props\":{\"width\":36,\"height\":36,\"base64pic\":true}};}\r\n\t]);\r\n\treturn MinBtnCompUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.NodeListPanelUI extends laya.ui.View\r\nvar NodeListPanelUI=(function(_super){\r\n\tfunction NodeListPanelUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.title=null;\r\n\t\tthis.itemList=null;\r\n\t\tNodeListPanelUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeListPanelUI,'laya.debug.ui.debugui.NodeListPanelUI',_super);\r\n\tvar __proto=NodeListPanelUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(NodeListPanelUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.RankListItem\",RankListItem);\r\n\t}\r\n\r\n\t__static(NodeListPanelUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":235,\"y\":284,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":204,\"y\":32,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2,\"visible\":true},\"type\":\"Button\"},{\"props\":{\"x\":10,\"y\":6,\"text\":\"节点信息\",\"width\":147,\"height\":16,\"color\":\"#288edf\",\"var\":\"title\"},\"type\":\"Label\"},{\"type\":\"List\",\"child\":[{\"type\":\"RankListItem\",\"props\":{\"left\":5,\"right\":5,\"name\":\"render\",\"runtime\":\"laya.debug.uicomps.RankListItem\"}}],\"props\":{\"vScrollBarSkin\":\"comp/vscroll.png\",\"var\":\"itemList\",\"left\":2,\"right\":2,\"top\":26,\"bottom\":0,\"repeatX\":1,\"x\":20}}],\"props\":{\"width\":200,\"height\":300}};}\r\n\t]);\r\n\treturn NodeListPanelUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.NodeToolUI extends laya.ui.View\r\nvar NodeToolUI=(function(_super){\r\n\tfunction NodeToolUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.tarTxt=null;\r\n\t\tthis.freshBtn=null;\r\n\t\tthis.mouseAnalyseBtn=null;\r\n\t\tthis.dragIcon=null;\r\n\t\tNodeToolUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeToolUI,'laya.debug.ui.debugui.NodeToolUI',_super);\r\n\tvar __proto=NodeToolUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(NodeToolUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(NodeToolUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"base64pic\":true,\"width\":200,\"height\":341},\"child\":[{\"type\":\"Image\",\"props\":{\"x\":195,\"y\":244,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"}},{\"type\":\"Label\",\"props\":{\"x\":9,\"y\":5,\"text\":\"当前选中对象\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Button\",\"props\":{\"x\":195,\"y\":25,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2}},{\"type\":\"Label\",\"props\":{\"x\":10,\"y\":25,\"text\":\"当前对象\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\",\"var\":\"tarTxt\"}},{\"type\":\"Button\",\"props\":{\"x\":15,\"y\":65,\"skin\":\"comp/button.png\",\"label\":\"父链\",\"width\":39,\"height\":23,\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":66,\"y\":65,\"skin\":\"comp/button.png\",\"label\":\"子\",\"width\":35,\"height\":23,\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":112,\"y\":65,\"skin\":\"comp/button.png\",\"label\":\"兄弟\",\"width\":49,\"height\":23,\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":13,\"y\":117,\"skin\":\"comp/button.png\",\"label\":\"Enable链\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":100,\"y\":117,\"skin\":\"comp/button.png\",\"label\":\"Size链\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Label\",\"props\":{\"x\":14,\"y\":97,\"text\":\"节点链信息\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Label\",\"props\":{\"x\":15,\"y\":45,\"text\":\"对象选取\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Label\",\"props\":{\"x\":16,\"y\":145,\"text\":\"节点显示\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Button\",\"props\":{\"x\":13,\"y\":164,\"skin\":\"comp/button.png\",\"label\":\"隐藏旁支\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":100,\"y\":164,\"skin\":\"comp/button.png\",\"label\":\"隐藏兄弟\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":13,\"y\":197,\"skin\":\"comp/button.png\",\"label\":\"隐藏子\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":99,\"y\":197,\"skin\":\"comp/button.png\",\"label\":\"恢复\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Label\",\"props\":{\"x\":15,\"y\":228,\"text\":\"其他\",\"width\":67,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Button\",\"props\":{\"x\":12,\"y\":247,\"skin\":\"comp/button.png\",\"label\":\"节点树定位\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":99,\"y\":247,\"skin\":\"comp/button.png\",\"label\":\"显示边框\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Label\",\"props\":{\"x\":12,\"y\":315,\"text\":\"Alt+A分析鼠标能否够点中对象\",\"width\":173,\"height\":16,\"color\":\"#a0a0a0\"}},{\"type\":\"Button\",\"props\":{\"x\":156,\"y\":1,\"skin\":\"view/refresh2.png\",\"var\":\"freshBtn\",\"left\":156,\"toolTip\":\"recache节点\"}},{\"type\":\"Button\",\"props\":{\"x\":12,\"y\":279,\"skin\":\"comp/button.png\",\"label\":\"输出到控制台\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Button\",\"props\":{\"x\":99,\"y\":279,\"skin\":\"comp/button.png\",\"label\":\"显示切换\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"}},{\"type\":\"Clip\",\"props\":{\"y\":44,\"skin\":\"view/clickanalyse.png\",\"var\":\"mouseAnalyseBtn\",\"toolTip\":\"拖动到对象上方判断是否能够点中\",\"left\":84,\"x\":84,\"clipY\":3}},{\"type\":\"Clip\",\"props\":{\"y\":35,\"skin\":\"view/clickanalyse.png\",\"var\":\"dragIcon\",\"x\":94,\"clipY\":3}}]};}\r\n\t]);\r\n\treturn NodeToolUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.NodeTreeSettingUI extends laya.ui.View\r\nvar NodeTreeSettingUI=(function(_super){\r\n\tfunction NodeTreeSettingUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.showTxt=null;\r\n\t\tthis.okBtn=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tNodeTreeSettingUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeTreeSettingUI,'laya.debug.ui.debugui.NodeTreeSettingUI',_super);\r\n\tvar __proto=NodeTreeSettingUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(NodeTreeSettingUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(NodeTreeSettingUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":0,\"y\":0,\"skin\":\"view/bg_panel.png\",\"left\":0,\"top\":0,\"bottom\":0,\"right\":0,\"var\":\"bg\",\"width\":200,\"height\":300,\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":9,\"y\":7,\"text\":\"要显示的属性\",\"width\":76,\"height\":16,\"color\":\"#ffffff\",\"align\":\"left\"},\"type\":\"Label\"},{\"props\":{\"x\":6,\"y\":29,\"skin\":\"comp/textinput.png\",\"text\":\"x\\\\ny\\\\nwidth\\\\nheight\",\"width\":188,\"height\":230,\"multiline\":true,\"var\":\"showTxt\",\"color\":\"#a0a0a0\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"TextInput\"},{\"props\":{\"x\":57,\"y\":269,\"skin\":\"comp/button.png\",\"label\":\"确定\",\"var\":\"okBtn\",\"mouseEnabled\":\"true\",\"labelColors\":\"#ffffff,#ffffff,#ffffff,#ffffff\"},\"type\":\"Button\"},{\"props\":{\"x\":175,\"y\":5,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\"},\"type\":\"Button\"}],\"props\":{\"base64pic\":true,\"width\":200,\"height\":300}};}\r\n\t]);\r\n\treturn NodeTreeSettingUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.NodeTreeUI extends laya.ui.View\r\nvar NodeTreeUI=(function(_super){\r\n\tfunction NodeTreeUI(){\r\n\t\tthis.nodeTree=null;\r\n\t\tthis.controlBar=null;\r\n\t\tthis.settingBtn=null;\r\n\t\tthis.freshBtn=null;\r\n\t\tthis.fliterTxt=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.ifShowProps=null;\r\n\t\tNodeTreeUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(NodeTreeUI,'laya.debug.ui.debugui.NodeTreeUI',_super);\r\n\tvar __proto=NodeTreeUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(NodeTreeUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.TreeListItem\",TreeListItem);\r\n\t}\r\n\r\n\t__static(NodeTreeUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"width\":200,\"height\":260,\"base64pic\":true},\"child\":[{\"type\":\"Image\",\"props\":{\"x\":-22,\"y\":-47,\"skin\":\"view/bg_panel.png\",\"width\":211,\"height\":206,\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"sizeGrid\":\"5,5,5,5\"}},{\"props\":{\"y\":0,\"skin\":\"view/bg_tool.png\",\"left\":0,\"right\":0},\"type\":\"Image\"},{\"type\":\"Tree\",\"props\":{\"x\":0,\"scrollBarSkin\":\"comp/vscroll.png\",\"width\":195,\"height\":229,\"var\":\"nodeTree\",\"left\":0,\"right\":0,\"top\":38,\"bottom\":20},\"child\":[{\"type\":\"ListItem\",\"props\":{\"y\":0,\"name\":\"render\",\"left\":0,\"right\":0,\"runtime\":\"laya.debug.uicomps.TreeListItem\"}}]},{\"type\":\"Box\",\"props\":{\"x\":3,\"y\":5,\"var\":\"controlBar\",\"left\":3,\"right\":3,\"top\":5,\"height\":23},\"child\":[{\"type\":\"Button\",\"props\":{\"x\":6,\"skin\":\"view/setting.png\",\"stateNum\":3,\"var\":\"settingBtn\",\"toolTip\":\"设置显示的属性\",\"y\":6}},{\"type\":\"Button\",\"props\":{\"y\":6,\"skin\":\"view/refresh.png\",\"var\":\"freshBtn\",\"left\":30,\"toolTip\":\"刷新数据\"}},{\"type\":\"TextInput\",\"props\":{\"y\":0,\"skin\":\"view/bg_top.png\",\"height\":22,\"var\":\"fliterTxt\",\"left\":53,\"right\":0,\"color\":\"#a0a0a0\"}},{\"type\":\"Button\",\"props\":{\"x\":172,\"y\":2,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"right\":1,\"visible\":false}}]},{\"props\":{\"y\":243,\"skin\":\"comp/checkbox.png\",\"label\":\"显示属性\",\"var\":\"ifShowProps\",\"bottom\":3,\"selected\":true,\"visible\":true,\"x\":2,\"width\":70,\"height\":14,\"labelColors\":\"#a0a0a0,#fffff,#ffffff,#fffff\"},\"type\":\"CheckBox\"}]};}\r\n\t]);\r\n\treturn NodeTreeUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.ObjectCreateUI extends laya.ui.View\r\nvar ObjectCreateUI=(function(_super){\r\n\tfunction ObjectCreateUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.itemList=null;\r\n\t\tthis.freshBtn=null;\r\n\t\tObjectCreateUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(ObjectCreateUI,'laya.debug.ui.debugui.ObjectCreateUI',_super);\r\n\tvar __proto=ObjectCreateUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(ObjectCreateUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.RankListItem\",RankListItem);\r\n\t}\r\n\r\n\t__static(ObjectCreateUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":215,\"y\":264,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":184,\"y\":12,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2,\"visible\":false},\"type\":\"Button\"},{\"props\":{\"x\":11,\"y\":5,\"text\":\"对象创建统计\",\"width\":83,\"height\":16,\"color\":\"#288edf\"},\"type\":\"Label\"},{\"type\":\"List\",\"child\":[{\"type\":\"RankListItem\",\"props\":{\"y\":0,\"left\":5,\"right\":5,\"name\":\"render\",\"runtime\":\"laya.debug.uicomps.RankListItem\"}}],\"props\":{\"vScrollBarSkin\":\"comp/vscroll.png\",\"var\":\"itemList\",\"top\":26,\"bottom\":5,\"left\":5,\"right\":5,\"repeatX\":1}},{\"props\":{\"y\":1,\"skin\":\"view/refresh2.png\",\"var\":\"freshBtn\",\"toolTip\":\"刷新数据\",\"right\":1,\"x\":178},\"type\":\"Button\"}],\"props\":{\"width\":200,\"height\":300,\"base64pic\":true}};}\r\n\t]);\r\n\treturn ObjectCreateUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.ObjectInfoUI extends laya.ui.View\r\nvar ObjectInfoUI=(function(_super){\r\n\tfunction ObjectInfoUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.title=null;\r\n\t\tthis.showTxt=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.autoUpdate=null;\r\n\t\tthis.settingBtn=null;\r\n\t\tObjectInfoUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(ObjectInfoUI,'laya.debug.ui.debugui.ObjectInfoUI',_super);\r\n\tvar __proto=ObjectInfoUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(ObjectInfoUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(ObjectInfoUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":-1,\"y\":0,\"skin\":\"view/bg_panel.png\",\"left\":-1,\"right\":1,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":7,\"y\":5,\"text\":\"对象类型\",\"width\":67,\"height\":20,\"color\":\"#ffffff\",\"var\":\"title\",\"left\":7,\"right\":6},\"type\":\"Label\"},{\"props\":{\"x\":2,\"skin\":\"comp/textinput.png\",\"text\":\"属性内容\",\"width\":196,\"height\":228,\"left\":2,\"right\":2,\"var\":\"showTxt\",\"top\":25,\"bottom\":20,\"editable\":false,\"multiline\":true,\"sizeGrid\":\"5,5,5,5\",\"color\":\"#a0a0a0\"},\"type\":\"TextArea\"},{\"props\":{\"x\":178,\"y\":4,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":4,\"right\":2},\"type\":\"Button\"},{\"props\":{\"skin\":\"comp/checkbox.png\",\"label\":\"自动刷新属性\",\"var\":\"autoUpdate\",\"bottom\":2,\"x\":3,\"labelColors\":\"#a0a0a0,#fffff,#ffffff,#fffff\"},\"type\":\"CheckBox\"},{\"props\":{\"x\":164,\"skin\":\"view/setting.png\",\"stateNum\":\"3\",\"var\":\"settingBtn\",\"y\":6,\"top\":6,\"right\":24,\"toolTip\":\"设置显示属性\"},\"type\":\"Button\"},{\"props\":{\"x\":179,\"y\":257,\"skin\":\"view/resize.png\",\"right\":2,\"bottom\":2,\"name\":\"resizeBtn\",\"stateNum\":3},\"type\":\"Button\"}],\"props\":{\"base64pic\":true,\"width\":200,\"height\":200}};}\r\n\t]);\r\n\treturn ObjectInfoUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.OutPutUI extends laya.ui.View\r\nvar OutPutUI=(function(_super){\r\n\tfunction OutPutUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.txt=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.clearBtn=null;\r\n\t\tOutPutUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(OutPutUI,'laya.debug.ui.debugui.OutPutUI',_super);\r\n\tvar __proto=OutPutUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(OutPutUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){}\r\n\t__static(OutPutUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"width\":300,\"height\":200,\"base64pic\":true},\"child\":[{\"type\":\"Image\",\"props\":{\"x\":205,\"y\":254,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"}},{\"type\":\"Label\",\"props\":{\"skin\":\"comp/textarea.png\",\"text\":\"TextArea\",\"color\":\"#a0a0a0\",\"var\":\"txt\",\"left\":5,\"right\":5,\"top\":22,\"bottom\":5,\"mouseEnabled\":true,\"sizeGrid\":\"3,3,3,3\"}},{\"type\":\"Button\",\"props\":{\"x\":185,\"y\":15,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2}},{\"props\":{\"x\":253,\"y\":1,\"skin\":\"view/re.png\",\"stateNum\":\"2\",\"var\":\"clearBtn\",\"right\":25},\"type\":\"Button\"},{\"props\":{\"x\":169,\"y\":247,\"skin\":\"view/resize.png\",\"right\":2,\"bottom\":2,\"name\":\"resizeBtn\",\"stateNum\":3},\"type\":\"Button\"}]};}\r\n\t]);\r\n\treturn OutPutUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.ProfileUI extends laya.ui.View\r\nvar ProfileUI=(function(_super){\r\n\tfunction ProfileUI(){\r\n\t\tthis.renderPanel=null;\r\n\t\tthis.createPanel=null;\r\n\t\tthis.cachePanel=null;\r\n\t\tthis.tab=null;\r\n\t\tthis.resPanel=null;\r\n\t\tProfileUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(ProfileUI,'laya.debug.ui.debugui.ProfileUI',_super);\r\n\tvar __proto=ProfileUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(ProfileUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.RenderCostRankView\",RenderCostRankView);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.ObjectCreateView\",ObjectCreateView);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.CacheRankView\",CacheRankView);\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.views.ResRankView\",ResRankView);\r\n\t}\r\n\r\n\t__static(ProfileUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"width\":260,\"height\":329,\"base64pic\":true},\"child\":[{\"type\":\"Image\",\"props\":{\"y\":0,\"skin\":\"view/bg_tool.png\",\"right\":0,\"left\":0}},{\"type\":\"Rank\",\"props\":{\"var\":\"renderPanel\",\"top\":29,\"runtime\":\"laya.debug.view.nodeInfo.views.RenderCostRankView\",\"right\":0,\"name\":\"渲染用时\",\"left\":0,\"bottom\":0}},{\"type\":\"ObjectCreate\",\"props\":{\"var\":\"createPanel\",\"top\":29,\"runtime\":\"laya.debug.view.nodeInfo.views.ObjectCreateView\",\"right\":0,\"name\":\"对象创建统计\",\"left\":0,\"bottom\":0}},{\"type\":\"Rank\",\"props\":{\"x\":10,\"var\":\"cachePanel\",\"top\":29,\"runtime\":\"laya.debug.view.nodeInfo.views.CacheRankView\",\"right\":0,\"name\":\"cache用时\",\"left\":0,\"bottom\":0}},{\"type\":\"Tab\",\"props\":{\"y\":9,\"x\":7,\"width\":191,\"var\":\"tab\",\"selectedIndex\":0,\"height\":19},\"child\":[{\"type\":\"CheckBox\",\"props\":{\"y\":0,\"x\":0,\"width\":50,\"skin\":\"view/create.png\",\"name\":\"item0\",\"labelColors\":\"#a0a0a0,#ffffff,#ffffff,#ffffff\",\"label\":\"  对象\",\"height\":17}},{\"type\":\"CheckBox\",\"props\":{\"y\":0,\"x\":55,\"width\":50,\"skin\":\"view/rendertime.png\",\"name\":\"item1\",\"labelColors\":\"#a0a0a0,#ffffff,#ffffff,#ffffff\",\"label\":\" 渲染\",\"height\":19}},{\"type\":\"CheckBox\",\"props\":{\"y\":0,\"x\":110,\"width\":50,\"skin\":\"view/cache.png\",\"name\":\"item2\",\"labelColors\":\"#a0a0a0,#ffffff,#ffffff,#ffffff\",\"label\":\" 重绘\",\"height\":16}},{\"type\":\"CheckBox\",\"props\":{\"y\":0,\"x\":165,\"width\":50,\"skin\":\"view/cache.png\",\"name\":\"item3\",\"labelColors\":\"#a0a0a0,#ffffff,#ffffff,#ffffff\",\"label\":\" 资源\",\"height\":16}}]},{\"type\":\"Rank\",\"props\":{\"y\":40,\"x\":50,\"var\":\"resPanel\",\"top\":29,\"runtime\":\"laya.debug.view.nodeInfo.views.ResRankView\",\"right\":0,\"name\":\"资源缓存\",\"left\":0,\"bottom\":0}}]};}\r\n\t]);\r\n\treturn ProfileUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.RankUI extends laya.ui.View\r\nvar RankUI=(function(_super){\r\n\tfunction RankUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.title=null;\r\n\t\tthis.itemList=null;\r\n\t\tthis.autoUpdate=null;\r\n\t\tthis.freshBtn=null;\r\n\t\tRankUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(RankUI,'laya.debug.ui.debugui.RankUI',_super);\r\n\tvar __proto=RankUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(RankUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.RankListItem\",RankListItem);\r\n\t}\r\n\r\n\t__static(RankUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":225,\"y\":274,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"x\":194,\"y\":22,\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":2,\"right\":2,\"visible\":false},\"type\":\"Button\"},{\"props\":{\"x\":8,\"y\":5,\"text\":\"渲染用时表(3000ms)\",\"width\":109,\"height\":16,\"color\":\"#288edf\",\"var\":\"title\"},\"type\":\"Label\"},{\"type\":\"List\",\"child\":[{\"type\":\"RankListItem\",\"props\":{\"left\":5,\"right\":5,\"name\":\"render\",\"runtime\":\"laya.debug.uicomps.RankListItem\"}}],\"props\":{\"vScrollBarSkin\":\"comp/vscroll.png\",\"var\":\"itemList\",\"left\":2,\"right\":2,\"top\":26,\"bottom\":25,\"repeatX\":1,\"x\":10,\"y\":10}},{\"props\":{\"skin\":\"comp/checkbox.png\",\"label\":\"自动刷新属性\",\"var\":\"autoUpdate\",\"bottom\":3,\"selected\":false,\"visible\":true,\"left\":2,\"labelColors\":\"#a0a0a0,#fffff,#ffffff,#fffff\"},\"type\":\"CheckBox\"},{\"props\":{\"y\":1,\"skin\":\"view/refresh2.png\",\"var\":\"freshBtn\",\"toolTip\":\"刷新数据\",\"right\":1},\"type\":\"Button\"}],\"props\":{\"width\":200,\"height\":300}};}\r\n\t]);\r\n\treturn RankUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.SelectInfosUI extends laya.ui.View\r\nvar SelectInfosUI=(function(_super){\r\n\tfunction SelectInfosUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.closeBtn=null;\r\n\t\tthis.selectList=null;\r\n\t\tthis.findBtn=null;\r\n\t\tthis.fliterTxt=null;\r\n\t\tSelectInfosUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(SelectInfosUI,'laya.debug.ui.debugui.SelectInfosUI',_super);\r\n\tvar __proto=SelectInfosUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(SelectInfosUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.uicomps.RankListItem\",RankListItem);\r\n\t}\r\n\r\n\t__static(SelectInfosUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"child\":[{\"props\":{\"x\":205,\"y\":254,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"},\"type\":\"Image\"},{\"props\":{\"skin\":\"view/btn_close.png\",\"var\":\"closeBtn\",\"top\":32,\"visible\":false,\"right\":2},\"type\":\"Button\"},{\"props\":{\"x\":7,\"y\":36,\"text\":\"当前选中列表\",\"width\":83,\"height\":16,\"color\":\"#288edf\"},\"type\":\"Label\"},{\"type\":\"List\",\"child\":[{\"type\":\"RankListItem\",\"props\":{\"left\":5,\"right\":5,\"name\":\"render\",\"runtime\":\"laya.debug.uicomps.RankListItem\"}}],\"props\":{\"vScrollBarSkin\":\"comp/vscroll.png\",\"var\":\"selectList\",\"left\":5,\"right\":5,\"top\":56,\"bottom\":25,\"repeatX\":1,\"x\":20}},{\"props\":{\"x\":6,\"text\":\"Alt+V选取鼠标下的对象\",\"width\":189,\"height\":16,\"color\":\"#a0a0a0\",\"bottom\":3},\"type\":\"Label\"},{\"type\":\"Image\",\"props\":{\"y\":0,\"skin\":\"view/bg_tool.png\",\"left\":0,\"right\":0}},{\"type\":\"Clip\",\"props\":{\"y\":6,\"skin\":\"view/search.png\",\"clipY\":2,\"var\":\"findBtn\",\"right\":5,\"toolTip\":\"查找\",\"x\":174}},{\"type\":\"TextInput\",\"props\":{\"y\":6,\"skin\":\"view/bg_top.png\",\"height\":22,\"var\":\"fliterTxt\",\"left\":8,\"right\":45,\"color\":\"#a0a0a0\",\"x\":8,\"width\":147}}],\"props\":{\"width\":200,\"height\":300,\"base64pic\":true}};}\r\n\t]);\r\n\treturn SelectInfosUI;\r\n})(View)\r\n\r\n\r\n//class laya.debug.ui.debugui.ToolBarUI extends laya.ui.View\r\nvar ToolBarUI=(function(_super){\r\n\tfunction ToolBarUI(){\r\n\t\tthis.bg=null;\r\n\t\tthis.treeBtn=null;\r\n\t\tthis.findBtn=null;\r\n\t\tthis.minBtn=null;\r\n\t\tthis.selectWhenClick=null;\r\n\t\tthis.clearBtn=null;\r\n\t\tthis.rankBtn=null;\r\n\t\tthis.nodeRankBtn=null;\r\n\t\tthis.cacheBtn=null;\r\n\t\tToolBarUI.__super.call(this);\r\n\t}\r\n\r\n\t__class(ToolBarUI,'laya.debug.ui.debugui.ToolBarUI',_super);\r\n\tvar __proto=ToolBarUI.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t\tlaya.ui.Component.prototype.createChildren.call(this);\r\n\t\tthis.createView(ToolBarUI.uiView);\r\n\t}\r\n\r\n\t__proto.viewMapRegists=function(){\r\n\t\tView.regComponent(\"laya.debug.view.nodeInfo.nodetree.MinBtnComp\",MinBtnComp);\r\n\t}\r\n\r\n\t__static(ToolBarUI,\r\n\t['uiView',function(){return this.uiView={\"type\":\"View\",\"props\":{\"base64pic\":true,\"width\":250,\"height\":30},\"child\":[{\"type\":\"Image\",\"props\":{\"x\":195,\"y\":244,\"skin\":\"view/bg_panel.png\",\"left\":0,\"right\":0,\"top\":0,\"bottom\":0,\"var\":\"bg\",\"sizeGrid\":\"5,5,5,5\"}},{\"type\":\"Button\",\"props\":{\"x\":2,\"y\":6,\"skin\":\"view/save.png\",\"stateNum\":2,\"var\":\"treeBtn\",\"toolTip\":\"节点树\"}},{\"type\":\"Button\",\"props\":{\"x\":25,\"y\":6,\"skin\":\"view/save.png\",\"stateNum\":2,\"var\":\"findBtn\",\"toolTip\":\"查找面板\"}},{\"type\":\"MinBtnComp\",\"props\":{\"x\":218,\"y\":-3,\"var\":\"minBtn\",\"runtime\":\"laya.debug.view.nodeInfo.nodetree.MinBtnComp\"}},{\"type\":\"CheckBox\",\"props\":{\"x\":124,\"y\":8,\"skin\":\"comp/checkbox.png\",\"label\":\"点击选取\",\"var\":\"selectWhenClick\",\"labelColors\":\"#a0a0a0,#fffff,#ffffff,#fffff\"}},{\"type\":\"Button\",\"props\":{\"x\":193,\"y\":5,\"skin\":\"view/res.png\",\"stateNum\":2,\"toolTip\":\"清除边框\",\"var\":\"clearBtn\"}},{\"type\":\"Button\",\"props\":{\"x\":49,\"y\":6,\"skin\":\"view/save.png\",\"stateNum\":2,\"var\":\"rankBtn\",\"toolTip\":\"渲染用时排行\"}},{\"type\":\"Button\",\"props\":{\"x\":72,\"y\":6,\"skin\":\"view/save.png\",\"stateNum\":2,\"var\":\"nodeRankBtn\",\"toolTip\":\"创建对象排行\"}},{\"type\":\"Button\",\"props\":{\"x\":94,\"y\":6,\"skin\":\"view/save.png\",\"stateNum\":2,\"var\":\"cacheBtn\",\"toolTip\":\"cache对象\"}}]};}\r\n\t]);\r\n\treturn ToolBarUI;\r\n})(View)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2016-7-6 上午9:42:46\r\n*/\r\n//class laya.debug.uicomps.ListBase extends laya.ui.List\r\nvar ListBase=(function(_super){\r\n\tfunction ListBase(){\r\n\t\tListBase.__super.call(this);\r\n\t}\r\n\r\n\t__class(ListBase,'laya.debug.uicomps.ListBase',_super);\r\n\tvar __proto=ListBase.prototype;\r\n\t__getset(0,__proto,'selectedIndex',_super.prototype._$get_selectedIndex,function(value){\r\n\t\tif (this._selectedIndex !=value){\r\n\t\t\tthis._selectedIndex=value;\r\n\t\t\tthis.changeSelectStatus();\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tthis.selectHandler && this.selectHandler.runWith(value);\r\n\t\t}\r\n\t\tif (this.selectEnable && this._scrollBar){\r\n\t\t\tvar numX=this._isVertical ? this.repeatX :this.repeatY;\r\n\t\t\tif (value < this._startIndex || (value+numX > this._startIndex+this.repeatX *this.repeatY)){\r\n\t\t\t\tthis.scrollTo(value);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn ListBase;\r\n})(List)\r\n\r\n\r\n/**\r\n*\r\n*@author ww\r\n*@version 1.0\r\n*\r\n*@created 2016-7-6 上午9:49:47\r\n*/\r\n//class laya.debug.uicomps.TreeBase extends laya.ui.Tree\r\nvar TreeBase=(function(_super){\r\n\tfunction TreeBase(){\r\n\t\tTreeBase.__super.call(this);\r\n\t}\r\n\r\n\t__class(TreeBase,'laya.debug.uicomps.TreeBase',_super);\r\n\tvar __proto=TreeBase.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._list=new ListBase());\r\n\t\tthis._list.renderHandler=Handler.create(this,this.renderItem,null,false);\r\n\t\tthis._list.repeatX=1;\r\n\t\tthis._list.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onListChange);\r\n\t}\r\n\r\n\treturn TreeBase;\r\n})(Tree)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.uicomps.RankListItem extends laya.debug.ui.debugui.comps.RankListItemUI\r\nvar RankListItem=(function(_super){\r\n\tfunction RankListItem(){\r\n\t\tRankListItem.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(RankListItemUI.uiView);\r\n\t\tthis.createView(RankListItemUI.uiView);\r\n\t}\r\n\r\n\t__class(RankListItem,'laya.debug.uicomps.RankListItem',_super);\r\n\tvar __proto=RankListItem.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn RankListItem;\r\n})(RankListItemUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.uicomps.TreeListItem extends laya.debug.ui.debugui.comps.ListItemUI\r\nvar TreeListItem=(function(_super){\r\n\tfunction TreeListItem(){\r\n\t\tTreeListItem.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(ListItemUI.uiView);\r\n\t\tthis.createView(ListItemUI.uiView);\r\n\t}\r\n\r\n\t__class(TreeListItem,'laya.debug.uicomps.TreeListItem',_super);\r\n\tvar __proto=TreeListItem.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn TreeListItem;\r\n})(ListItemUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.DebugPage extends laya.debug.ui.debugui.DebugPanelUI\r\nvar DebugPage=(function(_super){\r\n\tfunction DebugPage(){\r\n\t\tthis.views=null;\r\n\t\tDebugPage.__super.call(this);\r\n\t\tthis.msRec=new Rectangle();\r\n\t\tBase64AtlasManager.replaceRes(DebugPanelUI.uiView);\r\n\t\tthis.createView(DebugPanelUI.uiView);\r\n\t\tDisControlTool.setResizeAbleEx(this);\r\n\t\tthis.views=[this.treePanel,this.selectPanel,this.profilePanel];\r\n\t\tthis.tab.selectedIndex=0;\r\n\t\tthis.tabChange();\r\n\t\tthis.tab.on(/*laya.events.Event.CHANGE*/\"change\",this,this.tabChange);\r\n\t\tthis.changeSize();\r\n\t}\r\n\r\n\t__class(DebugPage,'laya.debug.view.nodeInfo.nodetree.DebugPage',_super);\r\n\tvar __proto=DebugPage.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\t__proto.tabChange=function(){\r\n\t\tDisControlTool.addOnlyByIndex(this.views,this.tab.selectedIndex,this);\r\n\t\tDisControlTool.setTop(this.resizeBtn);\r\n\t}\r\n\r\n\t__proto.changeSize=function(){\r\n\t\tif (this.width < 245){\r\n\t\t\tthis.width=245;\r\n\t\t}\r\n\t\tif (this.height < 100){\r\n\t\t\tthis.height=200;\r\n\t\t}\r\n\t\tlaya.ui.Component.prototype.changeSize.call(this);\r\n\t\tthis.msRec.setTo(0,0,this.width,this.height);\r\n\t\tthis.scrollRect=this.msRec;\r\n\t}\r\n\r\n\treturn DebugPage;\r\n})(DebugPanelUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.FindNodeSmall extends laya.debug.ui.debugui.FindNodeSmallUI\r\nvar FindNodeSmall=(function(_super){\r\n\tfunction FindNodeSmall(){\r\n\t\tFindNodeSmall.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(FindNodeSmallUI.uiView);\r\n\t\tthis.createView(FindNodeSmallUI.uiView);\r\n\t}\r\n\r\n\t__class(FindNodeSmall,'laya.debug.view.nodeInfo.nodetree.FindNodeSmall',_super);\r\n\tvar __proto=FindNodeSmall.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn FindNodeSmall;\r\n})(FindNodeSmallUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.FindNode extends laya.debug.ui.debugui.FindNodeUI\r\nvar FindNode=(function(_super){\r\n\tfunction FindNode(){\r\n\t\tFindNode.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(FindNodeUI.uiView);\r\n\t\tthis.createView(FindNodeUI.uiView);\r\n\t}\r\n\r\n\t__class(FindNode,'laya.debug.view.nodeInfo.nodetree.FindNode',_super);\r\n\tvar __proto=FindNode.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\treturn FindNode;\r\n})(FindNodeUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.MinBtnComp extends laya.debug.ui.debugui.MinBtnCompUI\r\nvar MinBtnComp=(function(_super){\r\n\tfunction MinBtnComp(){\r\n\t\tthis.tar=null;\r\n\t\tthis.minHandler=null;\r\n\t\tthis.maxHandler=null;\r\n\t\tthis.prePos=new Point();\r\n\t\tMinBtnComp.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(MinBtnCompUI.uiView);\r\n\t\tthis.createView(MinBtnCompUI.uiView);\r\n\t\tthis.init();\r\n\t}\r\n\r\n\t__class(MinBtnComp,'laya.debug.view.nodeInfo.nodetree.MinBtnComp',_super);\r\n\tvar __proto=MinBtnComp.prototype;\r\n\t__proto.createChildren=function(){}\r\n\t__proto.init=function(){\r\n\t\tthis.minBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onMinBtn);\r\n\t\tthis.maxBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onMaxBtn);\r\n\t\tthis.minState=false;\r\n\t\tthis.maxUI.removeSelf();\r\n\t\tDisControlTool.setDragingItem(this.bg,this.maxUI);\r\n\t}\r\n\r\n\t__proto.onMaxBtn=function(){\r\n\t\tthis.maxUI.removeSelf();\r\n\t\tif (this.maxHandler){\r\n\t\t\tthis.maxHandler.run();\r\n\t\t}\r\n\t\tif (this.tar){\r\n\t\t\tthis.tar.x+=this.maxUI.x-this.prePos.x;\r\n\t\t\tthis.tar.y+=this.maxUI.y-this.prePos.y;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onMinBtn=function(){\r\n\t\tif (!this.displayedInStage)return;\r\n\t\tvar tPos;\r\n\t\ttPos=Point.TEMP;\r\n\t\ttPos.setTo(0,0);\r\n\t\ttPos=this.localToGlobal(tPos);\r\n\t\ttPos=DebugInfoLayer.I.popLayer.globalToLocal(tPos);\r\n\t\tthis.maxUI.pos(tPos.x,tPos.y);\r\n\t\tDebugInfoLayer.I.popLayer.addChild(this.maxUI);\r\n\t\tif (this.tar){\r\n\t\t\tthis.prePos.setTo(tPos.x,tPos.y);\r\n\t\t}\r\n\t\tif (this.minHandler){\r\n\t\t\tthis.minHandler.run();\r\n\t\t}\r\n\t}\r\n\r\n\t__getset(0,__proto,'minState',null,function(v){\r\n\t});\r\n\r\n\treturn MinBtnComp;\r\n})(MinBtnCompUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.NodeListPanel extends laya.debug.ui.debugui.NodeListPanelUI\r\nvar NodeListPanel=(function(_super){\r\n\tfunction NodeListPanel(){\r\n\t\tNodeListPanel.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(NodeListPanelUI.uiView);\r\n\t\tthis.createView(NodeListPanelUI.uiView);\r\n\t}\r\n\r\n\t__class(NodeListPanel,'laya.debug.view.nodeInfo.nodetree.NodeListPanel',_super);\r\n\tvar __proto=NodeListPanel.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\treturn NodeListPanel;\r\n})(NodeListPanelUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.NodeTool extends laya.debug.ui.debugui.NodeToolUI\r\nvar NodeTool=(function(_super){\r\n\tfunction NodeTool(){\r\n\t\tNodeTool.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(NodeToolUI.uiView);\r\n\t\tthis.createView(NodeToolUI.uiView);\r\n\t}\r\n\r\n\t__class(NodeTool,'laya.debug.view.nodeInfo.nodetree.NodeTool',_super);\r\n\tvar __proto=NodeTool.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn NodeTool;\r\n})(NodeToolUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.NodeTreeSetting extends laya.debug.ui.debugui.NodeTreeSettingUI\r\nvar NodeTreeSetting=(function(_super){\r\n\tfunction NodeTreeSetting(){\r\n\t\tNodeTreeSetting.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(NodeTreeSettingUI.uiView);\r\n\t\tthis.createView(NodeTreeSettingUI.uiView);\r\n\t}\r\n\r\n\t__class(NodeTreeSetting,'laya.debug.view.nodeInfo.nodetree.NodeTreeSetting',_super);\r\n\tvar __proto=NodeTreeSetting.prototype;\r\n\t//inits();\r\n\t__proto.createChildren=function(){}\r\n\treturn NodeTreeSetting;\r\n})(NodeTreeSettingUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.NodeTree extends laya.debug.ui.debugui.NodeTreeUI\r\nvar NodeTree=(function(_super){\r\n\tfunction NodeTree(){\r\n\t\tthis.showProps=false;\r\n\t\tthis._closeSettingHandler=null;\r\n\t\tthis._tar=null;\r\n\t\tNodeTree.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(NodeTreeUI.uiView);\r\n\t\tView.regComponent(\"Tree\",TreeBase);\r\n\t\tthis.createView(NodeTreeUI.uiView);\r\n\t\tView.regComponent(\"Tree\",Tree);\r\n\t\tthis.inits();\r\n\t\tNodeTree.I=this;\r\n\t}\r\n\r\n\t__class(NodeTree,'laya.debug.view.nodeInfo.nodetree.NodeTree',_super);\r\n\tvar __proto=NodeTree.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\t__proto.inits=function(){\r\n\t\tthis.nodeTree.list.scrollBar.hide=true;\r\n\t\tthis.nodeTree.list.selectEnable=true;\r\n\t\tthis.settingBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onSettingBtn);\r\n\t\tthis.freshBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.fresh);\r\n\t\tthis.closeBtn.on(/*laya.events.Event.CLICK*/\"click\",this,this.onCloseBtn);\r\n\t\tthis.fliterTxt.on(/*laya.events.Event.ENTER*/\"enter\",this,this.onFliterTxtChange);\r\n\t\tthis.fliterTxt.on(/*laya.events.Event.BLUR*/\"blur\",this,this.onFliterTxtChange);\r\n\t\tNodeMenu.I.setNodeListAction(this.nodeTree.list);\r\n\t\tthis.nodeTree.list.on(/*laya.events.Event.CLICK*/\"click\",this,this.onListClick,[this.nodeTree.list]);\r\n\t\tthis.nodeTree.renderHandler=new Handler(this,this.treeRender);\r\n\t\tthis._closeSettingHandler=new Handler(this,this.closeSetting);\r\n\t\tthis.onIfShowPropsChange();\r\n\t\tthis.ifShowProps.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onIfShowPropsChange);\r\n\t}\r\n\r\n\t__proto.onIfShowPropsChange=function(){\r\n\t\tthis.showProps=this.ifShowProps.selected;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.onListClick=function(list){\r\n\t\tif (list.selectedItem){\r\n\t\t\tif (list.selectedItem.isDirectory){\r\n\t\t\t\tlist.selectedItem.isOpen=!list.selectedItem.isOpen;\r\n\t\t\t\tthis.nodeTree.fresh();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.onFindBtn=function(){\r\n\t\tFindSmallView.I.show();\r\n\t}\r\n\r\n\t__proto.onCloseBtn=function(){\r\n\t\tthis.removeSelf();\r\n\t}\r\n\r\n\t__proto.onTreeDoubleClick=function(e){\r\n\t\tif (this.nodeTree.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=this.nodeTree.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.onTreeRightMouseDown=function(e){\r\n\t\tif (this.nodeTree.selectedItem){\r\n\t\t\tvar tarNode;\r\n\t\t\ttarNode=this.nodeTree.selectedItem.path;\r\n\t\t\tNodeMenu.I.objRightClick(tarNode);\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.onSettingBtn=function(){\r\n\t\tNodeTreeSettingView.I.showSetting(NodeTree.showKeys,this._closeSettingHandler,this._tar);\r\n\t}\r\n\r\n\t__proto.closeSetting=function(newKeys){\r\n\t\tNodeTree.showKeys=newKeys;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.onFliterTxtChange=function(e){\r\n\t\tvar key;\r\n\t\tkey=this.fliterTxt.text;\r\n\t\tif (key==\"\")return;\r\n\t\tif (key !=NodeTree.showKeys.join(\",\")){\r\n\t\t\tNodeTree.showKeys=key.split(\",\");\r\n\t\t\tthis.fresh();\r\n\t\t}\r\n\t\treturn;\r\n\t\tthis.selecteByFile(key);\r\n\t}\r\n\r\n\t__proto.selecteByFile=function(key){\r\n\t\tvar arr;\r\n\t\tarr=this.nodeTree.source;\r\n\t\tvar rsts;\r\n\t\trsts=DebugTool.findNameHas(key,false);\r\n\t\tif (rsts && rsts.length > 0){\r\n\t\t\tvar tar;\r\n\t\t\ttar=rsts[0];\r\n\t\t\tthis.parseOpen(arr,tar);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.showSelectInStage=function(node){\r\n\t\tthis.setDis(Laya.stage);\r\n\t\tthis.selectByNode(node);\r\n\t}\r\n\r\n\t__proto.selectByNode=function(node){\r\n\t\tif (!node)return;\r\n\t\tvar arr;\r\n\t\tarr=this.nodeTree.source;\r\n\t\tthis.parseOpen(arr,node);\r\n\t}\r\n\r\n\t__proto.showNodeList=function(nodeList){\r\n\t\tif (!nodeList)return;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=nodeList.length;\r\n\t\tvar showList;\r\n\t\tshowList=[];\r\n\t\tvar tData;\r\n\t\tvar tSprite;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttSprite=nodeList[i];\r\n\t\t\ttData={};\r\n\t\t\ttData.label=ClassTool.getNodeClassAndName(tSprite);\r\n\t\t\ttData.path=tSprite;\r\n\t\t\tshowList.push(tData);\r\n\t\t}\r\n\t\tthis.nodeTree.array=showList;\r\n\t}\r\n\r\n\t__proto.parseOpen=function(tree,node){\r\n\t\tif (tree.length < 1)return;\r\n\t\tif (!node)return;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=tree.length;\r\n\t\tvar tItem;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttItem=tree[i];\r\n\t\t\tif(tItem.path==node){\r\n\t\t\t\tvar sItem;\r\n\t\t\t\tsItem=tItem;\r\n\t\t\t\twhile (tItem){\r\n\t\t\t\t\ttItem.isOpen=true;\r\n\t\t\t\t\tthis.nodeTree.fresh();\r\n\t\t\t\t\ttItem=tItem.nodeParent;\r\n\t\t\t\t}\r\n\t\t\t\tthis.nodeTree.selectedItem=sItem;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取数据源中指定键名的值。\r\n\t*/\r\n\t__proto.getFilterSource=function(array,result,key){\r\n\t\tkey=key.toLocaleLowerCase();\r\n\t\tvar item;\r\n\t\t/*for each*/for(var $each_item in array){\r\n\t\t\titem=array[$each_item];\r\n\t\t\tif (item.isDirectory && String(item.label).toLowerCase().indexOf(key)>-1){\r\n\t\t\t\titem.x=0;\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t\tif (item.child && item.child.length > 0){\r\n\t\t\t\tthis.getFilterSource(item.child,result,key);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onControlDown=function(){\r\n\t\tthis.startDrag();\r\n\t}\r\n\r\n\t__proto.setDis=function(sprite){\r\n\t\tthis._tar=sprite;\r\n\t\tthis.fresh();\r\n\t}\r\n\r\n\t__proto.fresh=function(){\r\n\t\tvar preTar;\r\n\t\tif (this.nodeTree.selectedItem){\r\n\t\t\tvar tItem;\r\n\t\t\ttItem=this.nodeTree.selectedItem;\r\n\t\t\twhile (tItem && (! (tItem.path instanceof laya.display.Sprite ))){\r\n\t\t\t\ttItem=tItem.nodeParent;\r\n\t\t\t}\r\n\t\t\tif (tItem && tItem.path){\r\n\t\t\t\tpreTar=tItem.path;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._tar){\r\n\t\t\tthis.nodeTree.array=[];\r\n\t\t\t}else{\r\n\t\t\tthis.nodeTree.array=NodeUtils.getNodeTreeData(this._tar,this.showProps?NodeTree.showKeys:NodeTree.emptyShowKey);\r\n\t\t}\r\n\t\tif (preTar){\r\n\t\t\tthis.selectByNode(preTar);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.treeRender=function(cell,index){\r\n\t\tvar item=cell.dataSource;\r\n\t\tif (item){\r\n\t\t\tvar isDirectory=item.child || item.isDirectory;\r\n\t\t\tvar label=cell.getChildByName(\"label\");\r\n\t\t\tif ((item.path instanceof laya.display.Node )){\r\n\t\t\t\tlabel.color=\"#09a4f6\";\r\n\t\t\t\t}else{\r\n\t\t\t\tif (item.isChilds){\r\n\t\t\t\t\tlabel.color=\"#00ff11\";\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tlabel.color=\"#838bc5\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tNodeTree.I=null;\r\n\tNodeTree.emptyShowKey=[];\r\n\t__static(NodeTree,\r\n\t['showKeys',function(){return this.showKeys=[\"x\",\"y\",\"width\",\"height\",\"renderCost\"];}\r\n\t]);\r\n\treturn NodeTree;\r\n})(NodeTreeUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.ObjectCreate extends laya.debug.ui.debugui.ObjectCreateUI\r\nvar ObjectCreate=(function(_super){\r\n\tfunction ObjectCreate(){\r\n\t\tObjectCreate.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(ObjectCreateUI.uiView);\r\n\t\tthis.createView(ObjectCreateUI.uiView);\r\n\t}\r\n\r\n\t__class(ObjectCreate,'laya.debug.view.nodeInfo.nodetree.ObjectCreate',_super);\r\n\tvar __proto=ObjectCreate.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\treturn ObjectCreate;\r\n})(ObjectCreateUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.ObjectInfo extends laya.debug.ui.debugui.ObjectInfoUI\r\nvar ObjectInfo=(function(_super){\r\n\tfunction ObjectInfo(){\r\n\t\tObjectInfo.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(ObjectInfoUI.uiView);\r\n\t\tthis.createView(ObjectInfoUI.uiView);\r\n\t}\r\n\r\n\t__class(ObjectInfo,'laya.debug.view.nodeInfo.nodetree.ObjectInfo',_super);\r\n\tvar __proto=ObjectInfo.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn ObjectInfo;\r\n})(ObjectInfoUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.OutPut extends laya.debug.ui.debugui.OutPutUI\r\nvar OutPut=(function(_super){\r\n\tfunction OutPut(){\r\n\t\tOutPut.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(OutPutUI.uiView);\r\n\t\tthis.createView(OutPutUI.uiView);\r\n\t}\r\n\r\n\t__class(OutPut,'laya.debug.view.nodeInfo.nodetree.OutPut',_super);\r\n\tvar __proto=OutPut.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn OutPut;\r\n})(OutPutUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.Profile extends laya.debug.ui.debugui.ProfileUI\r\nvar Profile=(function(_super){\r\n\tfunction Profile(){\r\n\t\tthis.views=null;\r\n\t\tProfile.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(ProfileUI.uiView);\r\n\t\tthis.createView(ProfileUI.uiView);\r\n\t\tthis.views=[this.createPanel,this.renderPanel,this.cachePanel,this.resPanel];\r\n\t\tthis.tab.selectedIndex=0;\r\n\t\tthis.tabChange();\r\n\t\tthis.tab.on(/*laya.events.Event.CHANGE*/\"change\",this,this.tabChange);\r\n\t}\r\n\r\n\t__class(Profile,'laya.debug.view.nodeInfo.nodetree.Profile',_super);\r\n\tvar __proto=Profile.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\t__proto.tabChange=function(){\r\n\t\tDisControlTool.addOnlyByIndex(this.views,this.tab.selectedIndex,this);\r\n\t}\r\n\r\n\treturn Profile;\r\n})(ProfileUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.Rank extends laya.debug.ui.debugui.RankUI\r\nvar Rank=(function(_super){\r\n\tfunction Rank(){\r\n\t\tRank.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(RankUI.uiView);\r\n\t\tthis.createView(RankUI.uiView);\r\n\t}\r\n\r\n\t__class(Rank,'laya.debug.view.nodeInfo.nodetree.Rank',_super);\r\n\tvar __proto=Rank.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\treturn Rank;\r\n})(RankUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.SelectInfos extends laya.debug.ui.debugui.SelectInfosUI\r\nvar SelectInfos=(function(_super){\r\n\tfunction SelectInfos(){\r\n\t\tSelectInfos.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(SelectInfosUI.uiView);\r\n\t\tthis.createView(SelectInfosUI.uiView);\r\n\t}\r\n\r\n\t__class(SelectInfos,'laya.debug.view.nodeInfo.nodetree.SelectInfos',_super);\r\n\tvar __proto=SelectInfos.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis.viewMapRegists();\r\n\t}\r\n\r\n\treturn SelectInfos;\r\n})(SelectInfosUI)\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.debug.view.nodeInfo.nodetree.ToolBar extends laya.debug.ui.debugui.ToolBarUI\r\nvar ToolBar=(function(_super){\r\n\tfunction ToolBar(){\r\n\t\tToolBar.__super.call(this);\r\n\t\tBase64AtlasManager.replaceRes(ToolBarUI.uiView);\r\n\t\tthis.createView(ToolBarUI.uiView);\r\n\t}\r\n\r\n\t__class(ToolBar,'laya.debug.view.nodeInfo.nodetree.ToolBar',_super);\r\n\tvar __proto=ToolBar.prototype;\r\n\t__proto.createChildren=function(){}\r\n\treturn ToolBar;\r\n})(ToolBarUI)\r\n\r\n\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.debugtool.js?");

/***/ }),

/***/ "./bin/libs/laya.filter.js":
/*!*********************************!*\
  !*** ./bin/libs/laya.filter.js ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Browser=laya.utils.Browser,Color=laya.utils.Color,ColorFilterAction=laya.filters.ColorFilterAction;\r\n\tvar ColorFilterActionGL=laya.filters.webgl.ColorFilterActionGL,Filter=laya.filters.Filter,FilterActionGL=laya.filters.webgl.FilterActionGL;\r\n\tvar Matrix=laya.maths.Matrix,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext;\r\n\tvar RenderTarget2D=laya.webgl.resource.RenderTarget2D,RunDriver=laya.utils.RunDriver,ShaderDefines2D=laya.webgl.shader.d2.ShaderDefines2D;\r\n\tvar Sprite=laya.display.Sprite,Texture=laya.resource.Texture,Value2D=laya.webgl.shader.d2.value.Value2D;\r\n/**\r\n*默认的FILTER,什么都不做\r\n*@private\r\n*/\r\n//class laya.filters.FilterAction\r\nvar FilterAction=(function(){\r\n\tfunction FilterAction(){\r\n\t\tthis.data=null;\r\n\t}\r\n\r\n\t__class(FilterAction,'laya.filters.FilterAction');\r\n\tvar __proto=FilterAction.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilterAction\":true})\r\n\t__proto.apply=function(data){\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn FilterAction;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.filters.WebGLFilter\r\nvar WebGLFilter=(function(){\r\n\tfunction WebGLFilter(){}\r\n\t__class(WebGLFilter,'laya.filters.WebGLFilter');\r\n\tWebGLFilter.enable=function(){\r\n\t\tif (WebGLFilter.isInit)return;\r\n\t\tWebGLFilter.isInit=true;\r\n\t\tif (!Render.isWebGL)return;\r\n\t\tRunDriver.createFilterAction=function (type){\r\n\t\t\tvar action;\r\n\t\t\tswitch (type){\r\n\t\t\t\tcase /*laya.filters.Filter.COLOR*/0x20:\r\n\t\t\t\t\taction=new ColorFilterActionGL();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.filters.Filter.BLUR*/0x10:\r\n\t\t\t\t\taction=new BlurFilterActionGL();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.filters.Filter.GLOW*/0x08:\r\n\t\t\t\t\taction=new GlowFilterActionGL();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\treturn action;\r\n\t\t}\r\n\t}\r\n\r\n\tWebGLFilter.isInit=false;\r\n\tWebGLFilter.__init$=function(){\r\n\t\tBlurFilterActionGL;\r\n\t\tColorFilterActionGL;\r\n\t\tGlowFilterActionGL;\r\n\t\tRender;\r\n\t\tRunDriver;{\r\n\t\t\tRunDriver.createFilterAction=function (type){\r\n\t\t\t\tvar action;\r\n\t\t\t\tswitch (type){\r\n\t\t\t\t\tcase /*laya.filters.Filter.BLUR*/0x10:\r\n\t\t\t\t\t\taction=new FilterAction();\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase /*laya.filters.Filter.GLOW*/0x08:\r\n\t\t\t\t\t\taction=new FilterAction();\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase /*laya.filters.Filter.COLOR*/0x20:\r\n\t\t\t\t\t\taction=new ColorFilterAction();\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\treturn action;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn WebGLFilter;\r\n})()\r\n\r\n\r\n/**\r\n*模糊滤镜\r\n*/\r\n//class laya.filters.BlurFilter extends laya.filters.Filter\r\nvar BlurFilter=(function(_super){\r\n\tfunction BlurFilter(strength){\r\n\t\t/**模糊滤镜的强度(值越大，越不清晰 */\r\n\t\tthis.strength=NaN;\r\n\t\tthis.strength_sig2_2sig2_gauss1=[];\r\n\t\tBlurFilter.__super.call(this);\r\n\t\t(strength===void 0)&& (strength=4);\r\n\t\tif (Render.isWebGL)WebGLFilter.enable();\r\n\t\tthis.strength=strength;\r\n\t\tthis._action=RunDriver.createFilterAction(0x10);\r\n\t\tthis._action.data=this;\r\n\t}\r\n\r\n\t__class(BlurFilter,'laya.filters.BlurFilter',_super);\r\n\tvar __proto=BlurFilter.prototype;\r\n\t/**\r\n\t*@private 通知微端\r\n\t*/\r\n\t__proto.callNative=function(sp){\r\n\t\tsp.conchModel &&sp.conchModel.blurFilter&&sp.conchModel.blurFilter(this.strength);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*当前滤镜对应的操作器\r\n\t*/\r\n\t__getset(0,__proto,'action',function(){\r\n\t\treturn this._action;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*当前滤镜的类型\r\n\t*/\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn 0x10;\r\n\t});\r\n\r\n\treturn BlurFilter;\r\n})(Filter)\r\n\r\n\r\n/**\r\n*发光滤镜(也可以当成阴影滤使用）\r\n*/\r\n//class laya.filters.GlowFilter extends laya.filters.Filter\r\nvar GlowFilter=(function(_super){\r\n\tfunction GlowFilter(color,blur,offX,offY){\r\n\t\t/**滤镜的颜色*/\r\n\t\tthis._color=null;\r\n\t\tGlowFilter.__super.call(this);\r\n\t\tthis._elements=new Float32Array(9);\r\n\t\t(blur===void 0)&& (blur=4);\r\n\t\t(offX===void 0)&& (offX=6);\r\n\t\t(offY===void 0)&& (offY=6);\r\n\t\tif (Render.isWebGL){\r\n\t\t\tWebGLFilter.enable();\r\n\t\t}\r\n\t\tthis._color=new Color(color);\r\n\t\tthis.blur=Math.min(blur,20);\r\n\t\tthis.offX=offX;\r\n\t\tthis.offY=offY;\r\n\t\tthis._action=RunDriver.createFilterAction(0x08);\r\n\t\tthis._action.data=this;\r\n\t}\r\n\r\n\t__class(GlowFilter,'laya.filters.GlowFilter',_super);\r\n\tvar __proto=GlowFilter.prototype;\r\n\t/**@private */\r\n\t__proto.getColor=function(){\r\n\t\treturn this._color._color;\r\n\t}\r\n\r\n\t/**\r\n\t*@private 通知微端\r\n\t*/\r\n\t__proto.callNative=function(sp){\r\n\t\tsp.conchModel &&sp.conchModel.glowFilter&&sp.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滤镜类型\r\n\t*/\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn 0x08;\r\n\t});\r\n\r\n\t/**@private */\r\n\t__getset(0,__proto,'action',function(){\r\n\t\treturn this._action;\r\n\t});\r\n\r\n\t/**@private */\r\n\t/**@private */\r\n\t__getset(0,__proto,'offY',function(){\r\n\t\treturn this._elements[6];\r\n\t\t},function(value){\r\n\t\tthis._elements[6]=value;\r\n\t});\r\n\r\n\t/**@private */\r\n\t/**@private */\r\n\t__getset(0,__proto,'offX',function(){\r\n\t\treturn this._elements[5];\r\n\t\t},function(value){\r\n\t\tthis._elements[5]=value;\r\n\t});\r\n\r\n\t/**@private */\r\n\t/**@private */\r\n\t__getset(0,__proto,'blur',function(){\r\n\t\treturn this._elements[4];\r\n\t\t},function(value){\r\n\t\tthis._elements[4]=value;\r\n\t});\r\n\r\n\treturn GlowFilter;\r\n})(Filter)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.filters.webgl.BlurFilterActionGL extends laya.filters.webgl.FilterActionGL\r\nvar BlurFilterActionGL=(function(_super){\r\n\tfunction BlurFilterActionGL(){\r\n\t\tthis.data=null;\r\n\t\tBlurFilterActionGL.__super.call(this);\r\n\t}\r\n\r\n\t__class(BlurFilterActionGL,'laya.filters.webgl.BlurFilterActionGL',_super);\r\n\tvar __proto=BlurFilterActionGL.prototype;\r\n\t__proto.setValueMix=function(shader){\r\n\t\tshader.defines.add(this.data.type);\r\n\t\tvar o=shader;\r\n\t}\r\n\r\n\t__proto.apply3d=function(scope,sprite,context,x,y){\r\n\t\tvar b=scope.getValue(\"bounds\");\r\n\t\tvar shaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\tshaderValue.setFilters([this.data]);\r\n\t\tvar tMatrix=Matrix.EMPTY;\r\n\t\ttMatrix.identity();\r\n\t\tcontext.ctx.drawTarget(scope,0,0,b.width,b.height,Matrix.EMPTY,\"src\",shaderValue);\r\n\t\tshaderValue.setFilters(null);\r\n\t}\r\n\r\n\t__proto.setValue=function(shader){\r\n\t\tshader.strength=this.data.strength;\r\n\t\tvar sigma=this.data.strength/3.0;\r\n\t\tvar sigma2=sigma*sigma;\r\n\t\tthis.data.strength_sig2_2sig2_gauss1[0]=this.data.strength;\r\n\t\tthis.data.strength_sig2_2sig2_gauss1[1]=sigma2;\r\n\t\tthis.data.strength_sig2_2sig2_gauss1[2]=2.0*sigma2;\r\n\t\tthis.data.strength_sig2_2sig2_gauss1[3]=1.0/(2.0*Math.PI*sigma2);\r\n\t\tshader.strength_sig2_2sig2_gauss1=this.data.strength_sig2_2sig2_gauss1;\r\n\t}\r\n\r\n\t__getset(0,__proto,'typeMix',function(){return /*laya.filters.Filter.BLUR*/0x10;});\r\n\treturn BlurFilterActionGL;\r\n})(FilterActionGL)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.filters.webgl.GlowFilterActionGL extends laya.filters.webgl.FilterActionGL\r\nvar GlowFilterActionGL=(function(_super){\r\n\tfunction GlowFilterActionGL(){\r\n\t\tthis.data=null;\r\n\t\tthis._initKey=false;\r\n\t\tthis._textureWidth=0;\r\n\t\tthis._textureHeight=0;\r\n\t\tGlowFilterActionGL.__super.call(this);\r\n\t}\r\n\r\n\t__class(GlowFilterActionGL,'laya.filters.webgl.GlowFilterActionGL',_super);\r\n\tvar __proto=GlowFilterActionGL.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilterActionGL\":true})\r\n\t__proto.setValueMix=function(shader){}\r\n\t__proto.apply3d=function(scope,sprite,context,x,y){\r\n\t\tvar b=scope.getValue(\"bounds\");\r\n\t\tscope.addValue(\"color\",this.data.getColor());\r\n\t\tvar w=b.width,h=b.height;\r\n\t\tthis._textureWidth=w;\r\n\t\tthis._textureHeight=h;\r\n\t\tvar shaderValue;\r\n\t\tvar mat=Matrix.TEMP;\r\n\t\tmat.identity();\r\n\t\tshaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\tshaderValue.setFilters([this.data]);\r\n\t\tcontext.ctx.drawTarget(scope,0,0,this._textureWidth,this._textureHeight,mat,\"src\",shaderValue,null);\r\n\t\tshaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\tcontext.ctx.drawTarget(scope,0,0,this._textureWidth,this._textureHeight,mat,\"src\",shaderValue);\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.setSpriteWH=function(sprite){\r\n\t\tthis._textureWidth=sprite.width;\r\n\t\tthis._textureHeight=sprite.height;\r\n\t}\r\n\r\n\t__proto.setValue=function(shader){\r\n\t\tshader.u_offsetX=this.data.offX;\r\n\t\tshader.u_offsetY=-this.data.offY;\r\n\t\tshader.u_strength=1.0;\r\n\t\tshader.u_blurX=this.data.blur;\r\n\t\tshader.u_blurY=this.data.blur;\r\n\t\tshader.u_textW=this._textureWidth;\r\n\t\tshader.u_textH=this._textureHeight;\r\n\t\tshader.u_color=this.data.getColor();\r\n\t}\r\n\r\n\t__getset(0,__proto,'typeMix',function(){return /*laya.filters.Filter.GLOW*/0x08;});\r\n\tGlowFilterActionGL.tmpTarget=function(scope,sprite,context,x,y){\r\n\t\tvar b=scope.getValue(\"bounds\");\r\n\t\tvar out=scope.getValue(\"out\");\r\n\t\tout.end();\r\n\t\tvar tmpTarget=RenderTarget2D.create(b.width,b.height);\r\n\t\ttmpTarget.start();\r\n\t\tvar color=scope.getValue(\"color\");\r\n\t\tif (color){\r\n\t\t\ttmpTarget.clear(color[0],color[1],color[2],0);\r\n\t\t}\r\n\t\tscope.addValue(\"tmpTarget\",tmpTarget);\r\n\t}\r\n\r\n\tGlowFilterActionGL.startOut=function(scope,sprite,context,x,y){\r\n\t\tvar tmpTarget=scope.getValue(\"tmpTarget\");\r\n\t\ttmpTarget.end();\r\n\t\tvar out=scope.getValue(\"out\");\r\n\t\tout.start();\r\n\t\tvar color=scope.getValue(\"color\");\r\n\t\tif (color){\r\n\t\t\tout.clear(color[0],color[1],color[2],0);\r\n\t\t}\r\n\t}\r\n\r\n\tGlowFilterActionGL.recycleTarget=function(scope,sprite,context,x,y){\r\n\t\tvar src=scope.getValue(\"src\");\r\n\t\tvar tmpTarget=scope.getValue(\"tmpTarget\");\r\n\t\ttmpTarget.recycle();\r\n\t}\r\n\r\n\treturn GlowFilterActionGL;\r\n})(FilterActionGL)\r\n\r\n\r\n\tLaya.__init([WebGLFilter]);\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.filter.js?");

/***/ }),

/***/ "./bin/libs/laya.html.js":
/*!*******************************!*\
  !*** ./bin/libs/laya.html.js ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Browser=laya.utils.Browser,CSSStyle=laya.display.css.CSSStyle,ClassUtils=laya.utils.ClassUtils;\r\n\tvar Event=laya.events.Event,HTMLChar=laya.utils.HTMLChar,Loader=laya.net.Loader,Node=laya.display.Node,Rectangle=laya.maths.Rectangle;\r\n\tvar Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;\r\n\tvar Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Text=laya.display.Text,Texture=laya.resource.Texture;\r\n\tvar URL=laya.net.URL,Utils=laya.utils.Utils;\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.utils.HTMLParse\r\nvar HTMLParse=(function(){\r\n\tfunction HTMLParse(){}\r\n\t__class(HTMLParse,'laya.html.utils.HTMLParse');\r\n\tHTMLParse.parse=function(ower,xmlString,url){\r\n\t\txmlString=xmlString.replace(/<br>/g,\"<br/>\");\r\n\t\txmlString=\"<root>\"+xmlString+\"</root>\";\r\n\t\txmlString=xmlString.replace(HTMLParse.spacePattern,HTMLParse.char255);\r\n\t\tvar xml=Utils.parseXMLFromString(xmlString);\r\n\t\tHTMLParse._parseXML(ower,xml.childNodes[0].childNodes,url);\r\n\t}\r\n\r\n\tHTMLParse._parseXML=function(parent,xml,url,href){\r\n\t\tvar i=0,n=0;\r\n\t\tif (xml.join || xml.item){\r\n\t\t\tfor (i=0,n=xml.length;i < n;++i){\r\n\t\t\t\tHTMLParse._parseXML(parent,xml[i],url,href);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tvar node;\r\n\t\t\tvar nodeName;\r\n\t\t\tif (xml.nodeType==3){\r\n\t\t\t\tvar txt;\r\n\t\t\t\tif ((parent instanceof laya.html.dom.HTMLDivElement )){\r\n\t\t\t\t\tif (xml.nodeName==null){\r\n\t\t\t\t\t\txml.nodeName=\"#text\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnodeName=xml.nodeName.toLowerCase();\r\n\t\t\t\t\ttxt=xml.textContent.replace(/^\\s+|\\s+$/g,'');\r\n\t\t\t\t\tif (txt.length > 0){\r\n\t\t\t\t\t\tnode=ClassUtils.getInstance(nodeName);\r\n\t\t\t\t\t\tif (node){\r\n\t\t\t\t\t\t\tparent.addChild(node);\r\n\t\t\t\t\t\t\t((node).innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern,\" \"));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttxt=xml.textContent.replace(/^\\s+|\\s+$/g,'');\r\n\t\t\t\t\tif (txt.length > 0){\r\n\t\t\t\t\t\t((parent).innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern,\" \"));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t\t}else {\r\n\t\t\t\tnodeName=xml.nodeName.toLowerCase();\r\n\t\t\t\tif (nodeName==\"#comment\")return;\r\n\t\t\t\tnode=ClassUtils.getInstance(nodeName);\r\n\t\t\t\tif (node){\r\n\t\t\t\t\tnode=parent.addChild(node);\r\n\t\t\t\t\t(node).URI=url;\r\n\t\t\t\t\t(node).href=href;\r\n\t\t\t\t\tvar attributes=xml.attributes;\r\n\t\t\t\t\tif (attributes && attributes.length > 0){\r\n\t\t\t\t\t\tfor (i=0,n=attributes.length;i < n;++i){\r\n\t\t\t\t\t\t\tvar attribute=attributes[i];\r\n\t\t\t\t\t\t\tvar attrName=attribute.nodeName;\r\n\t\t\t\t\t\t\tvar value=attribute.value;\r\n\t\t\t\t\t\t\tnode._setAttributes(attrName,value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tHTMLParse._parseXML(node,xml.childNodes,url,(node).href);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tHTMLParse._parseXML(parent,xml.childNodes,url,href);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__static(HTMLParse,\r\n\t['char255',function(){return this.char255=String.fromCharCode(255);},'spacePattern',function(){return this.spacePattern=/&nbsp;|&#160;/g;},'char255AndOneSpacePattern',function(){return this.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+\"|(\\\\s+)\",\"g\");}\r\n\t]);\r\n\treturn HTMLParse;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*HTML的布局类\r\n*对HTML的显示对象进行排版\r\n*/\r\n//class laya.html.utils.Layout\r\nvar Layout=(function(){\r\n\tfunction Layout(){}\r\n\t__class(Layout,'laya.html.utils.Layout');\r\n\tLayout.later=function(element){\r\n\t\tif (Layout._will==null){\r\n\t\t\tLayout._will=[];\r\n\t\t\tLaya.stage.frameLoop(1,null,function(){\r\n\t\t\t\tif (Layout._will.length < 1)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tfor (var i=0;i < Layout._will.length;i++){\r\n\t\t\t\t\tlaya.html.utils.Layout.layout(Layout._will[i]);\r\n\t\t\t\t}\r\n\t\t\t\tLayout._will.length=0;\r\n\t\t\t});\r\n\t\t}\r\n\t\tLayout._will.push(element);\r\n\t}\r\n\r\n\tLayout.layout=function(element){\r\n\t\tif (!element || !element._style)return null;\r\n\t\tif ((element._style._type & /*laya.display.css.CSSStyle.ADDLAYOUTED*/0x200)===0)\r\n\t\t\treturn null;\r\n\t\telement.getStyle()._type &=~ /*laya.display.css.CSSStyle.ADDLAYOUTED*/0x200;\r\n\t\tvar arr=Layout._multiLineLayout(element);\r\n\t\tif (Render.isConchApp&&element[\"layaoutCallNative\"]){\r\n\t\t\t(element).layaoutCallNative();\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tLayout._multiLineLayout=function(element){\r\n\t\tif (Text.RightToLeft)return Layout._multiLineLayout2(element);\r\n\t\tvar elements=new Array;\r\n\t\telement._addChildsToLayout(elements);\r\n\t\tvar i=0,n=elements.length,j=0;\r\n\t\tvar style=element._getCSSStyle();\r\n\t\tvar letterSpacing=style.letterSpacing;\r\n\t\tvar leading=style.leading;\r\n\t\tvar lineHeight=style.lineHeight;\r\n\t\tvar widthAuto=style._widthAuto()|| !style.wordWrap;\r\n\t\tvar width=widthAuto ? 999999 :element.width;\r\n\t\tvar height=element.height;\r\n\t\tvar maxWidth=0;\r\n\t\tvar exWidth=style.italic ? style.fontSize / 3 :0;\r\n\t\tvar align=style._getAlign();\r\n\t\tvar valign=style._getValign();\r\n\t\tvar endAdjust=valign!==0 || align!==0 || lineHeight !=0;\r\n\t\tvar oneLayout;\r\n\t\tvar x=0;\r\n\t\tvar y=0;\r\n\t\tvar w=0;\r\n\t\tvar h=0;\r\n\t\tvar tBottom=0;\r\n\t\tvar lines=new Array;\r\n\t\tvar curStyle;\r\n\t\tvar curPadding;\r\n\t\tvar curLine=lines[0]=new LayoutLine();\r\n\t\tvar newLine=false,nextNewline=false;\r\n\t\tvar htmlWord;\r\n\t\tvar sprite;\r\n\t\tcurLine.h=0;\r\n\t\tif (style.italic)\r\n\t\t\twidth-=style.fontSize / 3;\r\n\t\tvar tWordWidth=0;\r\n\t\tvar tLineFirstKey=true;\r\n\t\tfunction addLine (){\r\n\t\t\tcurLine.y=y;\r\n\t\t\ty+=curLine.h+leading;\r\n\t\t\tif (curLine.h==0)y+=lineHeight;\r\n\t\t\tcurLine.mWidth=tWordWidth;\r\n\t\t\ttWordWidth=0;\r\n\t\t\tcurLine=new LayoutLine();\r\n\t\t\tlines.push(curLine);\r\n\t\t\tcurLine.h=0;\r\n\t\t\tx=0;\r\n\t\t\ttLineFirstKey=true;\r\n\t\t\tnewLine=false;\r\n\t\t}\r\n\t\tfor (i=0;i < n;i++){\r\n\t\t\toneLayout=elements[i];\r\n\t\t\tif (oneLayout==null){\r\n\t\t\t\tif (!tLineFirstKey){\r\n\t\t\t\t\tx+=Layout.DIV_ELEMENT_PADDING;\r\n\t\t\t\t}\r\n\t\t\t\tcurLine.wordStartIndex=curLine.elements.length;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\ttLineFirstKey=false;\r\n\t\t\tif ((oneLayout instanceof laya.html.dom.HTMLBrElement )){\r\n\t\t\t\taddLine();\r\n\t\t\t\tcurLine.y=y;\r\n\t\t\t\tcontinue ;\r\n\t\t\t\t}else if (oneLayout._isChar()){\r\n\t\t\t\thtmlWord=oneLayout;\r\n\t\t\t\tif (!htmlWord.isWord){\r\n\t\t\t\t\tif (lines.length > 0 && (x+w)> width && curLine.wordStartIndex > 0){\r\n\t\t\t\t\t\tvar tLineWord=0;\r\n\t\t\t\t\t\ttLineWord=curLine.elements.length-curLine.wordStartIndex+1;\r\n\t\t\t\t\t\tcurLine.elements.length=curLine.wordStartIndex;\r\n\t\t\t\t\t\ti-=tLineWord;\r\n\t\t\t\t\t\taddLine();\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnewLine=false;\r\n\t\t\t\t\ttWordWidth+=htmlWord.width;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tnewLine=nextNewline || (htmlWord.char==='\\n');\r\n\t\t\t\t\tcurLine.wordStartIndex=curLine.elements.length;\r\n\t\t\t\t}\r\n\t\t\t\tw=htmlWord.width+letterSpacing;\r\n\t\t\t\th=htmlWord.height;\r\n\t\t\t\tnextNewline=false;\r\n\t\t\t\tnewLine=newLine || ((x+w)> width);\r\n\t\t\t\tnewLine && addLine();\r\n\t\t\t\tcurLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height);\r\n\t\t\t\t}else {\r\n\t\t\t\tcurStyle=oneLayout._getCSSStyle();\r\n\t\t\t\tsprite=oneLayout;\r\n\t\t\t\tcurPadding=curStyle.padding;\r\n\t\t\t\tcurStyle._getCssFloat()===0 || (endAdjust=true);\r\n\t\t\t\tnewLine=nextNewline || curStyle.lineElement;\r\n\t\t\t\tw=sprite.width *sprite._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing;\r\n\t\t\t\th=sprite.height *sprite._style._tf.scaleY+curPadding[0]+curPadding[2];\r\n\t\t\t\tnextNewline=curStyle.lineElement;\r\n\t\t\t\tnewLine=newLine || ((x+w)> width && curStyle.wordWrap);\r\n\t\t\t\tnewLine && addLine();\r\n\t\t\t}\r\n\t\t\tcurLine.elements.push(oneLayout);\r\n\t\t\tcurLine.h=Math.max(curLine.h,h);\r\n\t\t\toneLayout.x=x;\r\n\t\t\toneLayout.y=y;\r\n\t\t\tx+=w;\r\n\t\t\tcurLine.w=x-letterSpacing;\r\n\t\t\tcurLine.y=y;\r\n\t\t\tmaxWidth=Math.max(x+exWidth,maxWidth);\r\n\t\t}\r\n\t\ty=curLine.y+curLine.h;\r\n\t\tif (endAdjust){\r\n\t\t\tvar tY=0;\r\n\t\t\tvar tWidth=width;\r\n\t\t\tif (widthAuto && element.width > 0){\r\n\t\t\t\ttWidth=element.width;\r\n\t\t\t}\r\n\t\t\tfor (i=0,n=lines.length;i < n;i++){\r\n\t\t\t\tlines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight);\r\n\t\t\t\ttY+=Math.max(lineHeight,lines[i].h+leading);\r\n\t\t\t}\r\n\t\t\ty=tY;\r\n\t\t}\r\n\t\twidthAuto && (element.width=maxWidth);\r\n\t\t(y > element.height)&& (element.height=y);\r\n\t\treturn [maxWidth,y];\r\n\t}\r\n\r\n\tLayout._multiLineLayout2=function(element){\r\n\t\tvar elements=new Array;\r\n\t\telement._addChildsToLayout(elements);\r\n\t\tvar i=0,n=elements.length,j=0;\r\n\t\tvar style=element._getCSSStyle();\r\n\t\tvar letterSpacing=style.letterSpacing;\r\n\t\tvar leading=style.leading;\r\n\t\tvar lineHeight=style.lineHeight;\r\n\t\tvar widthAuto=style._widthAuto()|| !style.wordWrap;\r\n\t\tvar width=widthAuto ? 999999 :element.width;\r\n\t\tvar height=element.height;\r\n\t\tvar maxWidth=0;\r\n\t\tvar exWidth=style.italic ? style.fontSize / 3 :0;\r\n\t\tvar align=2-style._getAlign();\r\n\t\tvar valign=style._getValign();\r\n\t\tvar endAdjust=valign!==0 || align!==0 || lineHeight !=0;\r\n\t\tvar oneLayout;\r\n\t\tvar x=0;\r\n\t\tvar y=0;\r\n\t\tvar w=0;\r\n\t\tvar h=0;\r\n\t\tvar tBottom=0;\r\n\t\tvar lines=new Array;\r\n\t\tvar curStyle;\r\n\t\tvar curPadding;\r\n\t\tvar curLine=lines[0]=new LayoutLine();\r\n\t\tvar newLine=false,nextNewline=false;\r\n\t\tvar htmlWord;\r\n\t\tvar sprite;\r\n\t\tcurLine.h=0;\r\n\t\tif (style.italic)\r\n\t\t\twidth-=style.fontSize / 3;\r\n\t\tvar tWordWidth=0;\r\n\t\tvar tLineFirstKey=true;\r\n\t\tfunction addLine (){\r\n\t\t\tcurLine.y=y;\r\n\t\t\ty+=curLine.h+leading;\r\n\t\t\tif (curLine.h==0)y+=lineHeight;\r\n\t\t\tcurLine.mWidth=tWordWidth;\r\n\t\t\ttWordWidth=0;\r\n\t\t\tcurLine=new LayoutLine();\r\n\t\t\tlines.push(curLine);\r\n\t\t\tcurLine.h=0;\r\n\t\t\tx=0;\r\n\t\t\ttLineFirstKey=true;\r\n\t\t\tnewLine=false;\r\n\t\t}\r\n\t\tfor (i=0;i < n;i++){\r\n\t\t\toneLayout=elements[i];\r\n\t\t\tif (oneLayout==null){\r\n\t\t\t\tif (!tLineFirstKey){\r\n\t\t\t\t\tx+=Layout.DIV_ELEMENT_PADDING;\r\n\t\t\t\t}\r\n\t\t\t\tcurLine.wordStartIndex=curLine.elements.length;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\ttLineFirstKey=false;\r\n\t\t\tif ((oneLayout instanceof laya.html.dom.HTMLBrElement )){\r\n\t\t\t\taddLine();\r\n\t\t\t\tcurLine.y=y;\r\n\t\t\t\tcontinue ;\r\n\t\t\t\t}else if (oneLayout._isChar()){\r\n\t\t\t\thtmlWord=oneLayout;\r\n\t\t\t\tif (!htmlWord.isWord){\r\n\t\t\t\t\tif (lines.length > 0 && (x+w)> width && curLine.wordStartIndex > 0){\r\n\t\t\t\t\t\tvar tLineWord=0;\r\n\t\t\t\t\t\ttLineWord=curLine.elements.length-curLine.wordStartIndex+1;\r\n\t\t\t\t\t\tcurLine.elements.length=curLine.wordStartIndex;\r\n\t\t\t\t\t\ti-=tLineWord;\r\n\t\t\t\t\t\taddLine();\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnewLine=false;\r\n\t\t\t\t\ttWordWidth+=htmlWord.width;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tnewLine=nextNewline || (htmlWord.char==='\\n');\r\n\t\t\t\t\tcurLine.wordStartIndex=curLine.elements.length;\r\n\t\t\t\t}\r\n\t\t\t\tw=htmlWord.width+letterSpacing;\r\n\t\t\t\th=htmlWord.height;\r\n\t\t\t\tnextNewline=false;\r\n\t\t\t\tnewLine=newLine || ((x+w)> width);\r\n\t\t\t\tnewLine && addLine();\r\n\t\t\t\tcurLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height);\r\n\t\t\t\t}else {\r\n\t\t\t\tcurStyle=oneLayout._getCSSStyle();\r\n\t\t\t\tsprite=oneLayout;\r\n\t\t\t\tcurPadding=curStyle.padding;\r\n\t\t\t\tcurStyle._getCssFloat()===0 || (endAdjust=true);\r\n\t\t\t\tnewLine=nextNewline || curStyle.lineElement;\r\n\t\t\t\tw=sprite.width *sprite._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing;\r\n\t\t\t\th=sprite.height *sprite._style._tf.scaleY+curPadding[0]+curPadding[2];\r\n\t\t\t\tnextNewline=curStyle.lineElement;\r\n\t\t\t\tnewLine=newLine || ((x+w)> width && curStyle.wordWrap);\r\n\t\t\t\tnewLine && addLine();\r\n\t\t\t}\r\n\t\t\tcurLine.elements.push(oneLayout);\r\n\t\t\tcurLine.h=Math.max(curLine.h,h);\r\n\t\t\toneLayout.x=x;\r\n\t\t\toneLayout.y=y;\r\n\t\t\tx+=w;\r\n\t\t\tcurLine.w=x-letterSpacing;\r\n\t\t\tcurLine.y=y;\r\n\t\t\tmaxWidth=Math.max(x+exWidth,maxWidth);\r\n\t\t}\r\n\t\ty=curLine.y+curLine.h;\r\n\t\tif (endAdjust){\r\n\t\t\tvar tY=0;\r\n\t\t\tvar tWidth=width;\r\n\t\t\tfor (i=0,n=lines.length;i < n;i++){\r\n\t\t\t\tlines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight);\r\n\t\t\t\ttY+=Math.max(lineHeight,lines[i].h+leading);\r\n\t\t\t}\r\n\t\t\ty=tY;\r\n\t\t}\r\n\t\twidthAuto && (element.width=maxWidth);\r\n\t\t(y > element.height)&& (element.height=y);\r\n\t\tfor (i=0,n=lines.length;i < n;i++){\r\n\t\t\tlines[i].revertOrder(width);\r\n\t\t}\r\n\t\treturn [maxWidth,y];\r\n\t}\r\n\r\n\tLayout._will=null;\r\n\tLayout.DIV_ELEMENT_PADDING=0;\r\n\treturn Layout;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.utils.LayoutLine\r\nvar LayoutLine=(function(){\r\n\tfunction LayoutLine(){\r\n\t\tthis.x=0;\r\n\t\tthis.y=0;\r\n\t\tthis.w=0;\r\n\t\tthis.h=0;\r\n\t\tthis.wordStartIndex=0;\r\n\t\tthis.minTextHeight=99999;\r\n\t\tthis.mWidth=0;\r\n\t\tthis.elements=new Array;\r\n\t}\r\n\r\n\t__class(LayoutLine,'laya.html.utils.LayoutLine');\r\n\tvar __proto=LayoutLine.prototype;\r\n\t/**\r\n\t*底对齐（默认）\r\n\t*@param left\r\n\t*@param width\r\n\t*@param dy\r\n\t*@param align 水平\r\n\t*@param valign 垂直\r\n\t*@param lineHeight 行高\r\n\t*/\r\n\t__proto.updatePos=function(left,width,lineNum,dy,align,valign,lineHeight){\r\n\t\tvar w=0;\r\n\t\tvar one\r\n\t\tif (this.elements.length > 0){\r\n\t\t\tone=this.elements[this.elements.length-1];\r\n\t\t\tw=one.x+one.width-this.elements[0].x;\r\n\t\t};\r\n\t\tvar dx=0,ddy=NaN;\r\n\t\talign===/*laya.display.css.CSSStyle.ALIGN_CENTER*/1 && (dx=(width-w)/ 2);\r\n\t\talign===/*laya.display.css.CSSStyle.ALIGN_RIGHT*/2 && (dx=(width-w));\r\n\t\tlineHeight===0 || valign !=0 || (valign=1);\r\n\t\tfor (var i=0,n=this.elements.length;i < n;i++){\r\n\t\t\tone=this.elements[i];\r\n\t\t\tvar tCSSStyle=one._getCSSStyle();\r\n\t\t\tdx!==0 && (one.x+=dx);\r\n\t\t\tswitch (tCSSStyle._getValign()){\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tone.y=dy;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.display.css.CSSStyle.VALIGN_MIDDLE*/1:;\r\n\t\t\t\t\tvar tMinTextHeight=0;\r\n\t\t\t\t\tif (this.minTextHeight !=99999){\r\n\t\t\t\t\t\ttMinTextHeight=this.minTextHeight;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar tBottomLineY=(tMinTextHeight+lineHeight)/ 2;\r\n\t\t\t\t\ttBottomLineY=Math.max(tBottomLineY,this.h);\r\n\t\t\t\t\tif ((one instanceof laya.html.dom.HTMLImageElement )){\r\n\t\t\t\t\t\tddy=dy+tBottomLineY-one.height;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tddy=dy+tBottomLineY-one.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tone.y=ddy;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.display.css.CSSStyle.VALIGN_BOTTOM*/2:\r\n\t\t\t\t\tone.y=dy+(lineHeight-one.height);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*布局反向,目前用于将ltr模式布局转为rtl模式布局\r\n\t*/\r\n\t__proto.revertOrder=function(width){\r\n\t\tvar one\r\n\t\tif (this.elements.length > 0){\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tlen=this.elements.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tone=this.elements[i];\r\n\t\t\t\tone.x=width-one.x-one.width;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn LayoutLine;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLElement extends laya.display.Sprite\r\nvar HTMLElement=(function(_super){\r\n\tfunction HTMLElement(){\r\n\t\tthis.URI=null;\r\n\t\tthis._href=null;\r\n\t\tHTMLElement.__super.call(this);\r\n\t\tthis._text=HTMLElement._EMPTYTEXT;\r\n\t\tthis.setStyle(new CSSStyle(this));\r\n\t\tthis._getCSSStyle().valign=\"middle\";\r\n\t\tthis.mouseEnabled=true;\r\n\t}\r\n\r\n\t__class(HTMLElement,'laya.html.dom.HTMLElement',_super);\r\n\tvar __proto=HTMLElement.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.layaoutCallNative=function(){\r\n\t\tvar n=0;\r\n\t\tif (this._childs &&(n=this._childs.length)> 0){\r\n\t\t\tfor (var i=0;i < n;i++){\r\n\t\t\t\tthis._childs[i].layaoutCallNative && this._childs[i].layaoutCallNative();\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar word=this._getWords();\r\n\t\tword ? laya.html.dom.HTMLElement.fillWords(this,word,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear();\r\n\t}\r\n\r\n\t__proto.appendChild=function(c){\r\n\t\treturn this.addChild(c);\r\n\t}\r\n\r\n\t/**\r\n\t*rtl模式的getWords函數\r\n\t*/\r\n\t__proto._getWords2=function(){\r\n\t\tvar txt=this._text.text;\r\n\t\tif (!txt || txt.length===0)\r\n\t\t\treturn null;\r\n\t\tvar i=0,n=0;\r\n\t\tvar realWords;\r\n\t\tvar drawWords;\r\n\t\tif (!this._text.drawWords){\r\n\t\t\trealWords=txt.split(\" \");\r\n\t\t\tn=realWords.length-1;\r\n\t\t\tdrawWords=[];\r\n\t\t\tfor (i=0;i < n;i++){\r\n\t\t\t\tdrawWords.push(realWords[i],\" \")\r\n\t\t\t}\r\n\t\t\tif(n>=0)\r\n\t\t\t\tdrawWords.push(realWords[n]);\r\n\t\t\tthis._text.drawWords=drawWords;\r\n\t\t\t}else{\r\n\t\t\tdrawWords=this._text.drawWords;\r\n\t\t};\r\n\t\tvar words=this._text.words;\r\n\t\tif (words && words.length===drawWords.length)\r\n\t\t\treturn words;\r\n\t\twords===null && (this._text.words=words=[]);\r\n\t\twords.length=drawWords.length;\r\n\t\tvar size;\r\n\t\tvar style=this.style;\r\n\t\tvar fontStr=style.font;\r\n\t\tfor (i=0,n=drawWords.length;i < n;i++){\r\n\t\t\tsize=Utils.measureText(drawWords[i],fontStr);\r\n\t\t\tvar tHTMLChar=words[i]=new HTMLChar(drawWords[i],size.width,size.height || style.fontSize,style);\r\n\t\t\tif (tHTMLChar.char.length > 1){\r\n\t\t\t\ttHTMLChar.charNum=tHTMLChar.char;\r\n\t\t\t}\r\n\t\t\tif (this.href){\r\n\t\t\t\tvar tSprite=new Sprite();\r\n\t\t\t\tthis.addChild(tSprite);\r\n\t\t\t\ttHTMLChar.setSprite(tSprite);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn words;\r\n\t}\r\n\r\n\t__proto._getWords=function(){\r\n\t\tif (!Text.CharacterCache)return this._getWords2();\r\n\t\tvar txt=this._text.text;\r\n\t\tif (!txt || txt.length===0)\r\n\t\t\treturn null;\r\n\t\tvar words=this._text.words;\r\n\t\tif (words && words.length===txt.length)\r\n\t\t\treturn words;\r\n\t\twords===null && (this._text.words=words=[]);\r\n\t\twords.length=txt.length;\r\n\t\tvar size;\r\n\t\tvar style=this.style;\r\n\t\tvar fontStr=style.font;\r\n\t\tvar startX=0;\r\n\t\tfor (var i=0,n=txt.length;i < n;i++){\r\n\t\t\tsize=Utils.measureText(txt.charAt(i),fontStr);\r\n\t\t\tvar tHTMLChar=words[i]=new HTMLChar(txt.charAt(i),size.width,size.height||style.fontSize,style);\r\n\t\t\tif (this.href){\r\n\t\t\t\tvar tSprite=new Sprite();\r\n\t\t\t\tthis.addChild(tSprite);\r\n\t\t\t\ttHTMLChar.setSprite(tSprite);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn words;\r\n\t}\r\n\r\n\t__proto.showLinkSprite=function(){\r\n\t\tvar words=this._text.words;\r\n\t\tif (words){\r\n\t\t\tvar tLinkSpriteList=[];\r\n\t\t\tvar tSprite;\r\n\t\t\tvar tHtmlChar;\r\n\t\t\tfor (var i=0;i < words.length;i++){\r\n\t\t\t\ttHtmlChar=words[i];\r\n\t\t\t\ttSprite=new Sprite();\r\n\t\t\t\ttSprite.graphics.drawRect(0,0,tHtmlChar.width,tHtmlChar.height,\"#ff0000\");\r\n\t\t\t\ttSprite.width=tHtmlChar.width;\r\n\t\t\t\ttSprite.height=tHtmlChar.height;\r\n\t\t\t\tthis.addChild(tSprite);\r\n\t\t\t\ttLinkSpriteList.push(tSprite);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._layoutLater=function(){\r\n\t\tvar style=this.style;\r\n\t\tif ((style._type & /*laya.display.css.CSSStyle.ADDLAYOUTED*/0x200))return;\r\n\t\tif (style.widthed(this)&& (this._childs.length>0 || this._getWords()!=null)&& style.block){\r\n\t\t\tLayout.later(this);\r\n\t\t\tstyle._type |=/*laya.display.css.CSSStyle.ADDLAYOUTED*/0x200;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.parent && (this.parent)._layoutLater();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._setAttributes=function(name,value){\r\n\t\tswitch (name){\r\n\t\t\tcase 'style':\r\n\t\t\t\tthis.style.cssText(value);\r\n\t\t\t\treturn;\r\n\t\t\tcase 'class':\r\n\t\t\t\tthis.className=value;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t_super.prototype._setAttributes.call(this,name,value);\r\n\t}\r\n\r\n\t__proto.updateHref=function(){\r\n\t\tif (this._href !=null){\r\n\t\t\tvar words=this._getWords();\r\n\t\t\tif (words){\r\n\t\t\t\tvar tHTMLChar;\r\n\t\t\t\tvar tSprite;\r\n\t\t\t\tfor (var i=0;i < words.length;i++){\r\n\t\t\t\t\ttHTMLChar=words[i];\r\n\t\t\t\t\ttSprite=tHTMLChar.getSprite();\r\n\t\t\t\t\tif (tSprite){\r\n\t\t\t\t\t\ttSprite.size(tHTMLChar.width,tHTMLChar.height);\r\n\t\t\t\t\t\ttSprite.on(/*laya.events.Event.CLICK*/\"click\",this,this.onLinkHandler);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onLinkHandler=function(e){\r\n\t\tswitch(e.type){\r\n\t\t\tcase /*laya.events.Event.CLICK*/\"click\":;\r\n\t\t\t\tvar target=this;\r\n\t\t\t\twhile (target){\r\n\t\t\t\t\ttarget.event(/*laya.events.Event.LINK*/\"link\",[this.href]);\r\n\t\t\t\t\ttarget=target.parent;\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__proto.formatURL=function(url){\r\n\t\tif (!this.URI)return url;\r\n\t\treturn URL.formatURL(url,this.URI ? this.URI.path :null);\r\n\t}\r\n\r\n\t__getset(0,__proto,'href',function(){\r\n\t\treturn this._href;\r\n\t\t},function(url){\r\n\t\tthis._href=url;\r\n\t\tif (url !=null){\r\n\t\t\tthis._getCSSStyle().underLine=1;\r\n\t\t\tthis.updateHref();\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(0,__proto,'color',null,function(value){\r\n\t\tthis.style.color=value;\r\n\t});\r\n\r\n\t__getset(0,__proto,'onClick',null,function(value){\r\n\t\tvar fn;\r\n\t\t/*__JS__ */eval(\"fn=function(event){\"+value+\";}\");\r\n\t\tthis.on(/*laya.events.Event.CLICK*/\"click\",this,fn);\r\n\t});\r\n\r\n\t__getset(0,__proto,'id',null,function(value){\r\n\t\tHTMLDocument.document.setElementById(value,this);\r\n\t});\r\n\r\n\t__getset(0,__proto,'innerTEXT',function(){\r\n\t\treturn this._text.text;\r\n\t\t},function(value){\r\n\t\tthis.text=value;\r\n\t});\r\n\r\n\t__getset(0,__proto,'style',function(){\r\n\t\treturn this._style;\r\n\t});\r\n\r\n\t__getset(0,__proto,'text',function(){\r\n\t\treturn this._text.text;\r\n\t\t},function(value){\r\n\t\tif (this._text==HTMLElement._EMPTYTEXT){\r\n\t\t\tthis._text={text:value,words:null};\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis._text.text=value;\r\n\t\t\tthis._text.words && (this._text.words.length=0);\r\n\t\t}\r\n\t\tRender.isConchApp && this.layaoutCallNative();\r\n\t\tthis._renderType |=/*laya.renders.RenderSprite.CHILDS*/0x800;\r\n\t\tthis.repaint();\r\n\t\tthis.updateHref();\r\n\t});\r\n\r\n\t__getset(0,__proto,'parent',_super.prototype._$get_parent,function(value){\r\n\t\tif ((value instanceof laya.html.dom.HTMLElement )){\r\n\t\t\tvar p=value;\r\n\t\t\tthis.URI || (this.URI=p.URI);\r\n\t\t\tthis.style.inherit(p.style);\r\n\t\t}\r\n\t\tLaya.superSet(Sprite,this,'parent',value);\r\n\t});\r\n\r\n\t__getset(0,__proto,'className',null,function(value){\r\n\t\tthis.style.attrs(HTMLDocument.document.styleSheets['.'+value]);\r\n\t});\r\n\r\n\tHTMLElement.fillWords=function(ele,words,x,y,font,color,underLine){\r\n\t\tele.graphics.clear();\r\n\t\tfor (var i=0,n=words.length;i < n;i++){\r\n\t\t\tvar a=words[i];\r\n\t\t\tele.graphics.fillText(a.char,a.x+x,a.y+y,font,color,'left',underLine);\r\n\t\t}\r\n\t}\r\n\r\n\t__static(HTMLElement,\r\n\t['_EMPTYTEXT',function(){return this._EMPTYTEXT={text:null,words:null};}\r\n\t]);\r\n\treturn HTMLElement;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLBrElement extends laya.html.dom.HTMLElement\r\nvar HTMLBrElement=(function(_super){\r\n\tfunction HTMLBrElement(){\r\n\t\tHTMLBrElement.__super.call(this);\r\n\t\tthis.style.lineElement=true;\r\n\t\tthis.style.block=true;\r\n\t}\r\n\r\n\t__class(HTMLBrElement,'laya.html.dom.HTMLBrElement',_super);\r\n\treturn HTMLBrElement;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*DIV标签\r\n*/\r\n//class laya.html.dom.HTMLDivElement extends laya.html.dom.HTMLElement\r\nvar HTMLDivElement=(function(_super){\r\n\tfunction HTMLDivElement(){\r\n\t\t/**实际内容的高 */\r\n\t\tthis.contextHeight=NaN;\r\n\t\t/**实际内容的宽 */\r\n\t\tthis.contextWidth=NaN;\r\n\t\tHTMLDivElement.__super.call(this);\r\n\t\tthis.style.block=true;\r\n\t\tthis.style.lineElement=true;\r\n\t\tthis.style.width=200;\r\n\t\tthis.style.height=200;\r\n\t\tHTMLStyleElement;\r\n\t}\r\n\r\n\t__class(HTMLDivElement,'laya.html.dom.HTMLDivElement',_super);\r\n\tvar __proto=HTMLDivElement.prototype;\r\n\t/**\r\n\t*追加内容，解析并对显示对象排版\r\n\t*@param text\r\n\t*/\r\n\t__proto.appendHTML=function(text){\r\n\t\tHTMLParse.parse(this,text,this.URI);\r\n\t\tthis.layout();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@param out\r\n\t*@return\r\n\t*/\r\n\t__proto._addChildsToLayout=function(out){\r\n\t\tvar words=this._getWords();\r\n\t\tif (words==null && this._childs.length==0)return false;\r\n\t\twords && words.forEach(function(o){\r\n\t\t\tout.push(o);\r\n\t\t});\r\n\t\tvar tFirstKey=true;\r\n\t\tfor (var i=0,len=this._childs.length;i < len;i++){\r\n\t\t\tvar o=this._childs[i];\r\n\t\t\tif (tFirstKey){\r\n\t\t\t\ttFirstKey=false;\r\n\t\t\t\t}else {\r\n\t\t\t\tout.push(null);\r\n\t\t\t}\r\n\t\t\to._addToLayout(out)\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@param out\r\n\t*/\r\n\t__proto._addToLayout=function(out){\r\n\t\tthis.layout();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*对显示内容进行排版\r\n\t*/\r\n\t__proto.layout=function(){\r\n\t\tif (!this.style)return;\r\n\t\tthis.style._type |=/*laya.display.css.CSSStyle.ADDLAYOUTED*/0x200;\r\n\t\tvar tArray=Layout.layout(this);\r\n\t\tif (tArray){\r\n\t\t\tif (!this._$P.mHtmlBounds)this._set$P(\"mHtmlBounds\",new Rectangle());\r\n\t\t\tvar tRectangle=this._$P.mHtmlBounds;\r\n\t\t\ttRectangle.x=tRectangle.y=0;\r\n\t\t\ttRectangle.width=this.contextWidth=tArray[0];\r\n\t\t\ttRectangle.height=this.contextHeight=tArray[1];\r\n\t\t\tthis.setBounds(tRectangle);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取对象的高\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._height)return this._height;\r\n\t\treturn this.contextHeight;\r\n\t},_super.prototype._$set_height);\r\n\r\n\t/**\r\n\t*设置标签内容\r\n\t*/\r\n\t__getset(0,__proto,'innerHTML',null,function(text){\r\n\t\tthis.destroyChildren();\r\n\t\tthis.appendHTML(text);\r\n\t});\r\n\r\n\t/**\r\n\t*获取对象的宽\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._width)return this._width;\r\n\t\treturn this.contextWidth;\r\n\t\t},function(value){\r\n\t\tvar changed=false;\r\n\t\tif (value===0){\r\n\t\t\tchanged=value !=this._width;\r\n\t\t\t}else{\r\n\t\t\tchanged=value !=this.width;\r\n\t\t}\r\n\t\tLaya.superSet(HTMLElement,this,'width',value);\r\n\t\tif(changed)\r\n\t\t\tthis.layout();\r\n\t});\r\n\r\n\treturn HTMLDivElement;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLDocument extends laya.html.dom.HTMLElement\r\nvar HTMLDocument=(function(_super){\r\n\tfunction HTMLDocument(){\r\n\t\tthis.all=new Array;\r\n\t\tthis.styleSheets=CSSStyle.styleSheets;\r\n\t\tHTMLDocument.__super.call(this);\r\n\t}\r\n\r\n\t__class(HTMLDocument,'laya.html.dom.HTMLDocument',_super);\r\n\tvar __proto=HTMLDocument.prototype;\r\n\t__proto.getElementById=function(id){\r\n\t\treturn this.all[id];\r\n\t}\r\n\r\n\t__proto.setElementById=function(id,e){\r\n\t\tthis.all[id]=e;\r\n\t}\r\n\r\n\t__static(HTMLDocument,\r\n\t['document',function(){return this.document=new HTMLDocument();}\r\n\t]);\r\n\treturn HTMLDocument;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLImageElement extends laya.html.dom.HTMLElement\r\nvar HTMLImageElement=(function(_super){\r\n\tfunction HTMLImageElement(){\r\n\t\tthis._tex=null;\r\n\t\tthis._url=null;\r\n\t\tthis._renderArgs=[];\r\n\t\tHTMLImageElement.__super.call(this);\r\n\t\tthis.style.block=true;\r\n\t}\r\n\r\n\t__class(HTMLImageElement,'laya.html.dom.HTMLImageElement',_super);\r\n\tvar __proto=HTMLImageElement.prototype;\r\n\t__proto._addToLayout=function(out){\r\n\t\t!this._style.absolute && out.push(this);\r\n\t}\r\n\r\n\t__proto.render=function(context,x,y){\r\n\t\tif (!this._tex || !this._tex.loaded || !this._tex.loaded || this._width < 1 || this._height < 1)return;\r\n\t\tStat.spriteCount++;\r\n\t\tthis._renderArgs[0]=this._tex;\r\n\t\tthis._renderArgs[1]=this.x;\r\n\t\tthis._renderArgs[2]=this.y;\r\n\t\tthis._renderArgs[3]=this.width || this._tex.width;\r\n\t\tthis._renderArgs[4]=this.height || this._tex.height;\r\n\t\tcontext.ctx.drawTexture2(x,y,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.layaoutCallNative=function(){\r\n\t\tvar n=0;\r\n\t\tif (this._childs &&(n=this._childs.length)> 0){\r\n\t\t\tfor (var i=0;i < n;i++){\r\n\t\t\t\tthis._childs[i].layaoutCallNative && this._childs[i].layaoutCallNative();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__getset(0,__proto,'src',null,function(url){\r\n\t\tvar _$this=this;\r\n\t\turl=this.formatURL(url);\r\n\t\tif (this._url==url)return;\r\n\t\tthis._url=url;\r\n\t\tvar tex=this._tex=Loader.getRes(url);\r\n\t\tif (!tex){\r\n\t\t\tthis._tex=tex=new Texture();\r\n\t\t\ttex.load(url);\r\n\t\t\tLoader.cacheRes(url,tex);\r\n\t\t}\r\n\t\tfunction onloaded (){\r\n\t\t\tvar style=_$this._style;\r\n\t\t\tvar w=style.widthed(_$this)?-1:_$this._tex.width;\r\n\t\t\tvar h=style.heighted(_$this)?-1:_$this._tex.height;\r\n\t\t\tif (!style.widthed(_$this)&& _$this._width !=_$this._tex.width){\r\n\t\t\t\t_$this.width=_$this._tex.width;\r\n\t\t\t\t_$this.parent && (_$this.parent)._layoutLater();\r\n\t\t\t}\r\n\t\t\tif (!style.heighted(_$this)&& _$this._height !=_$this._tex.height){\r\n\t\t\t\t_$this.height=_$this._tex.height;\r\n\t\t\t\t_$this.parent && (_$this.parent)._layoutLater();\r\n\t\t\t}\r\n\t\t\tif (Render.isConchApp){\r\n\t\t\t\t_$this._renderArgs[0]=_$this._tex;\r\n\t\t\t\t_$this._renderArgs[1]=_$this.x;\r\n\t\t\t\t_$this._renderArgs[2]=_$this.y;\r\n\t\t\t\t_$this._renderArgs[3]=_$this.width || _$this._tex.width;\r\n\t\t\t\t_$this._renderArgs[4]=_$this.height || _$this._tex.height;\r\n\t\t\t\t_$this.graphics.drawTexture(_$this._tex,0,0,_$this._renderArgs[3],_$this._renderArgs[4]);\r\n\t\t\t}\r\n\t\t\t_$this.repaint();\r\n\t\t\t_$this.parentRepaint();\r\n\t\t}\r\n\t\ttex.loaded?onloaded():tex.on(/*laya.events.Event.LOADED*/\"loaded\",null,onloaded);\r\n\t});\r\n\r\n\treturn HTMLImageElement;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLLinkElement extends laya.html.dom.HTMLElement\r\nvar HTMLLinkElement=(function(_super){\r\n\tfunction HTMLLinkElement(){\r\n\t\tthis.type=null;\r\n\t\tHTMLLinkElement.__super.call(this);\r\n\t\tthis.visible=false;\r\n\t}\r\n\r\n\t__class(HTMLLinkElement,'laya.html.dom.HTMLLinkElement',_super);\r\n\tvar __proto=HTMLLinkElement.prototype;\r\n\t__proto._onload=function(data){\r\n\t\tswitch(this.type){\r\n\t\t\tcase 'text/css':\r\n\t\t\t\tCSSStyle.parseCSS(data,this.URI);\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__getset(0,__proto,'href',_super.prototype._$get_href,function(url){\r\n\t\tvar _$this=this;\r\n\t\turl=this.formatURL(url);\r\n\t\tthis.URI=new URL(url);\r\n\t\tvar l=new Loader();\r\n\t\tl.once(/*laya.events.Event.COMPLETE*/\"complete\",null,function(data){\r\n\t\t\t_$this._onload(data);\r\n\t\t});\r\n\t\tl.load(url,/*laya.net.Loader.TEXT*/\"text\");\r\n\t});\r\n\r\n\t__static(HTMLLinkElement,\r\n\t['_cuttingStyle',function(){return this._cuttingStyle=new RegExp(\"((@keyframes[\\\\s\\\\t]+|)(.+))[\\\\t\\\\n\\\\r\\\\\\s]*{\",\"g\");}\r\n\t]);\r\n\treturn HTMLLinkElement;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.html.dom.HTMLStyleElement extends laya.html.dom.HTMLElement\r\nvar HTMLStyleElement=(function(_super){\r\n\tfunction HTMLStyleElement(){\r\n\t\tHTMLStyleElement.__super.call(this);\r\n\t\tthis.visible=false;\r\n\t}\r\n\r\n\t__class(HTMLStyleElement,'laya.html.dom.HTMLStyleElement',_super);\r\n\tvar __proto=HTMLStyleElement.prototype;\r\n\t/**\r\n\t*解析样式\r\n\t*/\r\n\t__getset(0,__proto,'text',_super.prototype._$get_text,function(value){\r\n\t\tCSSStyle.parseCSS(value,null);\r\n\t});\r\n\r\n\treturn HTMLStyleElement;\r\n})(HTMLElement)\r\n\r\n\r\n/**\r\n*iframe标签类，目前用于加载外并解析数据\r\n*/\r\n//class laya.html.dom.HTMLIframeElement extends laya.html.dom.HTMLDivElement\r\nvar HTMLIframeElement=(function(_super){\r\n\tfunction HTMLIframeElement(){\r\n\t\tHTMLIframeElement.__super.call(this);\r\n\t\tthis._getCSSStyle().valign=\"middle\";\r\n\t}\r\n\r\n\t__class(HTMLIframeElement,'laya.html.dom.HTMLIframeElement',_super);\r\n\tvar __proto=HTMLIframeElement.prototype;\r\n\t/**\r\n\t*加载html文件，并解析数据\r\n\t*@param url\r\n\t*/\r\n\t__getset(0,__proto,'href',_super.prototype._$get_href,function(url){\r\n\t\tvar _$this=this;\r\n\t\turl=this.formatURL(url);\r\n\t\tvar l=new Loader();\r\n\t\tl.once(/*laya.events.Event.COMPLETE*/\"complete\",null,function(data){\r\n\t\t\tvar pre=_$this.URI;\r\n\t\t\t_$this.URI=new URL(url);\r\n\t\t\t_$this.innerHTML=data;\r\n\t\t\t!pre || (_$this.URI=pre);\r\n\t\t});\r\n\t\tl.load(url,/*laya.net.Loader.TEXT*/\"text\");\r\n\t});\r\n\r\n\treturn HTMLIframeElement;\r\n})(HTMLDivElement)\r\n\r\n\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.html.js?");

/***/ }),

/***/ "./bin/libs/laya.particle.js":
/*!***********************************!*\
  !*** ./bin/libs/laya.particle.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar BlendMode=laya.webgl.canvas.BlendMode,Event=laya.events.Event,HTMLCanvas=laya.resource.HTMLCanvas;\r\n\tvar Handler=laya.utils.Handler,IndexBuffer2D=laya.webgl.utils.IndexBuffer2D,Loader=laya.net.Loader,MathUtil=laya.maths.MathUtil;\r\n\tvar Matrix=laya.maths.Matrix,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;\r\n\tvar Shader=laya.webgl.shader.Shader,Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Texture=laya.resource.Texture;\r\n\tvar Utils=laya.utils.Utils,Value2D=laya.webgl.shader.d2.value.Value2D,VertexBuffer2D=laya.webgl.utils.VertexBuffer2D;\r\n\tvar WebGL=laya.webgl.WebGL,WebGLContext=laya.webgl.WebGLContext;\r\n/**\r\n*<code>EmitterBase</code> 类是粒子发射器类\r\n*/\r\n//class laya.particle.emitter.EmitterBase\r\nvar EmitterBase=(function(){\r\n\tfunction EmitterBase(){\r\n\t\t/**\r\n\t\t*积累的帧时间\r\n\t\t*/\r\n\t\tthis._frameTime=0;\r\n\t\t/**\r\n\t\t*粒子发射速率\r\n\t\t*/\r\n\t\tthis._emissionRate=60;\r\n\t\t/**\r\n\t\t*当前剩余发射时间\r\n\t\t*/\r\n\t\tthis._emissionTime=0;\r\n\t\t/**\r\n\t\t*发射粒子最小时间间隔\r\n\t\t*/\r\n\t\tthis.minEmissionTime=1 / 60;\r\n\t\t/**@private */\r\n\t\tthis._particleTemplate=null;\r\n\t}\r\n\r\n\t__class(EmitterBase,'laya.particle.emitter.EmitterBase');\r\n\tvar __proto=EmitterBase.prototype;\r\n\t/**\r\n\t*开始发射粒子\r\n\t*@param duration 发射持续的时间(秒)\r\n\t*/\r\n\t__proto.start=function(duration){\r\n\t\t(duration===void 0)&& (duration=2147483647);\r\n\t\tif (this._emissionRate !=0)\r\n\t\t\tthis._emissionTime=duration;\r\n\t}\r\n\r\n\t/**\r\n\t*停止发射粒子\r\n\t*@param clearParticles 是否清理当前的粒子\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis._emissionTime=0;\r\n\t}\r\n\r\n\t/**\r\n\t*清理当前的活跃粒子\r\n\t*@param clearTexture 是否清理贴图数据,若清除贴图数据将无法再播放\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis._emissionTime=0;\r\n\t}\r\n\r\n\t/**\r\n\t*发射一个粒子\r\n\t*\r\n\t*/\r\n\t__proto.emit=function(){}\r\n\t/**\r\n\t*时钟前进\r\n\t*@param passedTime 前进时间\r\n\t*\r\n\t*/\r\n\t__proto.advanceTime=function(passedTime){\r\n\t\t(passedTime===void 0)&& (passedTime=1);\r\n\t\tthis._emissionTime-=passedTime;\r\n\t\tif (this._emissionTime < 0)return;\r\n\t\tthis._frameTime+=passedTime;\r\n\t\tif (this._frameTime < this.minEmissionTime)return;\r\n\t\twhile (this._frameTime > this.minEmissionTime){\r\n\t\t\tthis._frameTime-=this.minEmissionTime;\r\n\t\t\tthis.emit();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置粒子粒子模板\r\n\t*@param particleTemplate 粒子模板\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'particleTemplate',null,function(particleTemplate){\r\n\t\tthis._particleTemplate=particleTemplate;\r\n\t});\r\n\r\n\t/**\r\n\t*设置粒子发射速率\r\n\t*@param emissionRate 粒子发射速率 (个/秒)\r\n\t*/\r\n\t/**\r\n\t*获取粒子发射速率\r\n\t*@return 发射速率 粒子发射速率 (个/秒)\r\n\t*/\r\n\t__getset(0,__proto,'emissionRate',function(){\r\n\t\treturn this._emissionRate;\r\n\t\t},function(_emissionRate){\r\n\t\tif (_emissionRate <=0)return;\r\n\t\tthis._emissionRate=_emissionRate;\r\n\t\t(_emissionRate > 0)&& (this.minEmissionTime=1 / _emissionRate);\r\n\t});\r\n\r\n\treturn EmitterBase;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.ParticleData\r\nvar ParticleData=(function(){\r\n\tfunction ParticleData(){\r\n\t\tthis.position=null;\r\n\t\tthis.velocity=null;\r\n\t\tthis.startColor=null;\r\n\t\tthis.endColor=null;\r\n\t\tthis.sizeRotation=null;\r\n\t\tthis.radius=null;\r\n\t\tthis.radian=null;\r\n\t\tthis.durationAddScale=NaN;\r\n\t\tthis.time=NaN;\r\n\t}\r\n\r\n\t__class(ParticleData,'laya.particle.ParticleData');\r\n\tParticleData.Create=function(settings,position,velocity,time){\r\n\t\tvar particleData=new ParticleData();\r\n\t\tparticleData.position=position;\r\n\t\tMathUtil.scaleVector3(velocity,settings.emitterVelocitySensitivity,ParticleData._tempVelocity);\r\n\t\tvar horizontalVelocity=MathUtil.lerp(settings.minHorizontalVelocity,settings.maxHorizontalVelocity,Math.random());\r\n\t\tvar horizontalAngle=Math.random()*Math.PI *2;\r\n\t\tParticleData._tempVelocity[0]+=horizontalVelocity *Math.cos(horizontalAngle);\r\n\t\tParticleData._tempVelocity[2]+=horizontalVelocity *Math.sin(horizontalAngle);\r\n\t\tParticleData._tempVelocity[1]+=MathUtil.lerp(settings.minVerticalVelocity,settings.maxVerticalVelocity,Math.random());\r\n\t\tparticleData.velocity=ParticleData._tempVelocity;\r\n\t\tparticleData.startColor=ParticleData._tempStartColor;\r\n\t\tparticleData.endColor=ParticleData._tempEndColor;\r\n\t\tvar i=0;\r\n\t\tif (settings.disableColor){\r\n\t\t\tfor (i=0;i < 4;i++){\r\n\t\t\t\tparticleData.startColor[i]=1;\r\n\t\t\t\tparticleData.endColor[i]=1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif (settings.colorComponentInter){\r\n\t\t\t\tfor (i=0;i < 4;i++){\r\n\t\t\t\t\tparticleData.startColor[i]=MathUtil.lerp(settings.minStartColor[i],settings.maxStartColor[i],Math.random());\r\n\t\t\t\t\tparticleData.endColor[i]=MathUtil.lerp(settings.minEndColor[i],settings.maxEndColor[i],Math.random());\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tMathUtil.lerpVector4(settings.minStartColor,settings.maxStartColor,Math.random(),particleData.startColor);\r\n\t\t\t\tMathUtil.lerpVector4(settings.minEndColor,settings.maxEndColor,Math.random(),particleData.endColor);\r\n\t\t\t}\r\n\t\t}\r\n\t\tparticleData.sizeRotation=ParticleData._tempSizeRotation;\r\n\t\tvar sizeRandom=Math.random();\r\n\t\tparticleData.sizeRotation[0]=MathUtil.lerp(settings.minStartSize,settings.maxStartSize,sizeRandom);\r\n\t\tparticleData.sizeRotation[1]=MathUtil.lerp(settings.minEndSize,settings.maxEndSize,sizeRandom);\r\n\t\tparticleData.sizeRotation[2]=MathUtil.lerp(settings.minRotateSpeed,settings.maxRotateSpeed,Math.random());\r\n\t\tparticleData.radius=ParticleData._tempRadius;\r\n\t\tvar radiusRandom=Math.random();\r\n\t\tparticleData.radius[0]=MathUtil.lerp(settings.minStartRadius,settings.maxStartRadius,radiusRandom);\r\n\t\tparticleData.radius[1]=MathUtil.lerp(settings.minEndRadius,settings.maxEndRadius,radiusRandom);\r\n\t\tparticleData.radian=ParticleData._tempRadian;\r\n\t\tparticleData.radian[0]=MathUtil.lerp(settings.minHorizontalStartRadian,settings.maxHorizontalStartRadian,Math.random());\r\n\t\tparticleData.radian[1]=MathUtil.lerp(settings.minVerticalStartRadian,settings.maxVerticalStartRadian,Math.random());\r\n\t\tvar useEndRadian=settings.useEndRadian;\r\n\t\tparticleData.radian[2]=useEndRadian?MathUtil.lerp(settings.minHorizontalEndRadian,settings.maxHorizontalEndRadian,Math.random()):particleData.radian[0];\r\n\t\tparticleData.radian[3]=useEndRadian?MathUtil.lerp(settings.minVerticalEndRadian,settings.maxVerticalEndRadian,Math.random()):particleData.radian[1];\r\n\t\tparticleData.durationAddScale=settings.ageAddScale *Math.random();\r\n\t\tparticleData.time=time;\r\n\t\treturn particleData;\r\n\t}\r\n\r\n\t__static(ParticleData,\r\n\t['_tempVelocity',function(){return this._tempVelocity=new Float32Array(3);},'_tempStartColor',function(){return this._tempStartColor=new Float32Array(4);},'_tempEndColor',function(){return this._tempEndColor=new Float32Array(4);},'_tempSizeRotation',function(){return this._tempSizeRotation=new Float32Array(3);},'_tempRadius',function(){return this._tempRadius=new Float32Array(2);},'_tempRadian',function(){return this._tempRadian=new Float32Array(4);}\r\n\t]);\r\n\treturn ParticleData;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.ParticleEmitter\r\nvar ParticleEmitter=(function(){\r\n\tfunction ParticleEmitter(templet,particlesPerSecond,initialPosition){\r\n\t\tthis._templet=null;\r\n\t\tthis._timeBetweenParticles=NaN;\r\n\t\tthis._previousPosition=null;\r\n\t\tthis._timeLeftOver=0;\r\n\t\tthis._tempVelocity=new Float32Array([0,0,0]);\r\n\t\tthis._tempPosition=new Float32Array([0,0,0]);\r\n\t\tthis._templet=templet;\r\n\t\tthis._timeBetweenParticles=1.0 / particlesPerSecond;\r\n\t\tthis._previousPosition=initialPosition;\r\n\t}\r\n\r\n\t__class(ParticleEmitter,'laya.particle.ParticleEmitter');\r\n\tvar __proto=ParticleEmitter.prototype;\r\n\t__proto.update=function(elapsedTime,newPosition){\r\n\t\telapsedTime=elapsedTime / 1000;\r\n\t\tif (elapsedTime > 0){\r\n\t\t\tMathUtil.subtractVector3(newPosition,this._previousPosition,this._tempVelocity);\r\n\t\t\tMathUtil.scaleVector3(this._tempVelocity,1 / elapsedTime,this._tempVelocity);\r\n\t\t\tvar timeToSpend=this._timeLeftOver+elapsedTime;\r\n\t\t\tvar currentTime=-this._timeLeftOver;\r\n\t\t\twhile (timeToSpend > this._timeBetweenParticles){\r\n\t\t\t\tcurrentTime+=this._timeBetweenParticles;\r\n\t\t\t\ttimeToSpend-=this._timeBetweenParticles;\r\n\t\t\t\tMathUtil.lerpVector3(this._previousPosition,newPosition,currentTime / elapsedTime,this._tempPosition);\r\n\t\t\t\tthis._templet.addParticleArray(this._tempPosition,this._tempVelocity);\r\n\t\t\t}\r\n\t\t\tthis._timeLeftOver=timeToSpend;\r\n\t\t}\r\n\t\tthis._previousPosition[0]=newPosition[0];\r\n\t\tthis._previousPosition[1]=newPosition[1];\r\n\t\tthis._previousPosition[2]=newPosition[2];\r\n\t}\r\n\r\n\treturn ParticleEmitter;\r\n})()\r\n\r\n\r\n/**\r\n*<code>ParticleSettings</code> 类是粒子配置数据类\r\n*/\r\n//class laya.particle.ParticleSetting\r\nvar ParticleSetting=(function(){\r\n\tfunction ParticleSetting(){\r\n\t\t/**贴图*/\r\n\t\tthis.textureName=null;\r\n\t\t/**贴图个数,默认为1可不设置*/\r\n\t\tthis.textureCount=1;\r\n\t\t/**最大同屏粒子个数，最大饱和粒子数为maxPartices-1。注意:WebGL模式下释放粒子时间为最大声明周期，可能会出现释放延迟,实际看到的同屏粒子数小于该数值，如连续喷发出现中断，请调大该数值。*/\r\n\t\tthis.maxPartices=100;\r\n\t\t/**粒子持续时间(单位:秒）*/\r\n\t\tthis.duration=1;\r\n\t\t/**如果大于0，某些粒子的持续时间会小于其他粒子,并具有随机性(单位:无）*/\r\n\t\tthis.ageAddScale=0;\r\n\t\t/**粒子受发射器速度的敏感度（需在自定义发射器中编码设置）*/\r\n\t\tthis.emitterVelocitySensitivity=1;\r\n\t\t/**最小开始尺寸（单位：2D像素、3D坐标）*/\r\n\t\tthis.minStartSize=100;\r\n\t\t/**最大开始尺寸（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxStartSize=100;\r\n\t\t/**最小结束尺寸（单位：2D像素、3D坐标）*/\r\n\t\tthis.minEndSize=100;\r\n\t\t/**最大结束尺寸（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxEndSize=100;\r\n\t\t/**最小水平速度（单位：2D像素、3D坐标）*/\r\n\t\tthis.minHorizontalVelocity=0;\r\n\t\t/**最大水平速度（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxHorizontalVelocity=0;\r\n\t\t/**最小垂直速度（单位：2D像素、3D坐标）*/\r\n\t\tthis.minVerticalVelocity=0;\r\n\t\t/**最大垂直速度（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxVerticalVelocity=0;\r\n\t\t/**等于1时粒子从出生到消亡保持一致的速度，等于0时粒子消亡时速度为0，大于1时粒子会保持加速（单位：无）*/\r\n\t\tthis.endVelocity=1;\r\n\t\t/**最小旋转速度（单位：2D弧度/秒、3D弧度/秒）*/\r\n\t\tthis.minRotateSpeed=0;\r\n\t\t/**最大旋转速度（单位：2D弧度/秒、3D弧度/秒）*/\r\n\t\tthis.maxRotateSpeed=0;\r\n\t\t/**最小开始半径（单位：2D像素、3D坐标）*/\r\n\t\tthis.minStartRadius=0;\r\n\t\t/**最大开始半径（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxStartRadius=0;\r\n\t\t/**最小结束半径（单位：2D像素、3D坐标）*/\r\n\t\tthis.minEndRadius=0;\r\n\t\t/**最大结束半径（单位：2D像素、3D坐标）*/\r\n\t\tthis.maxEndRadius=0;\r\n\t\t/**最小水平开始弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.minHorizontalStartRadian=0;\r\n\t\t/**最大水平开始弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.maxHorizontalStartRadian=0;\r\n\t\t/**最小垂直开始弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.minVerticalStartRadian=0;\r\n\t\t/**最大垂直开始弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.maxVerticalStartRadian=0;\r\n\t\t/**是否使用结束弧度,false为结束时与起始弧度保持一致,true为根据minHorizontalEndRadian、maxHorizontalEndRadian、minVerticalEndRadian、maxVerticalEndRadian计算结束弧度。*/\r\n\t\tthis.useEndRadian=true;\r\n\t\t/**最小水平结束弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.minHorizontalEndRadian=0;\r\n\t\t/**最大水平结束弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.maxHorizontalEndRadian=0;\r\n\t\t/**最小垂直结束弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.minVerticalEndRadian=0;\r\n\t\t/**最大垂直结束弧度（单位：2D弧度、3D弧度）*/\r\n\t\tthis.maxVerticalEndRadian=0;\r\n\t\t/**false代表RGBA整体插值，true代表RGBA逐分量插值*/\r\n\t\tthis.colorComponentInter=false;\r\n\t\t/**false代表使用参数颜色数据，true代表使用原图颜色数据*/\r\n\t\tthis.disableColor=false;\r\n\t\t/**混合模式，待调整，引擎中暂无BlendState抽象*/\r\n\t\tthis.blendState=0;\r\n\t\t/**发射器类型,\"point\",\"box\",\"sphere\",\"ring\"*/\r\n\t\tthis.emitterType=\"null\";\r\n\t\t/**发射器发射速率*/\r\n\t\tthis.emissionRate=0;\r\n\t\t/**球发射器半径*/\r\n\t\tthis.sphereEmitterRadius=1;\r\n\t\t/**球发射器速度*/\r\n\t\tthis.sphereEmitterVelocity=0;\r\n\t\t/**球发射器速度随机值*/\r\n\t\tthis.sphereEmitterVelocityAddVariance=0;\r\n\t\t/**环发射器半径*/\r\n\t\tthis.ringEmitterRadius=30;\r\n\t\t/**环发射器速度*/\r\n\t\tthis.ringEmitterVelocity=0;\r\n\t\t/**环发射器速度随机值*/\r\n\t\tthis.ringEmitterVelocityAddVariance=0;\r\n\t\t/**环发射器up向量，0代表X轴,1代表Y轴,2代表Z轴*/\r\n\t\tthis.ringEmitterUp=2;\r\n\t\tthis.gravity=new Float32Array([0,0,0]);\r\n\t\tthis.minStartColor=new Float32Array([1,1,1,1]);\r\n\t\tthis.maxStartColor=new Float32Array([1,1,1,1]);\r\n\t\tthis.minEndColor=new Float32Array([1,1,1,1]);\r\n\t\tthis.maxEndColor=new Float32Array([1,1,1,1]);\r\n\t\tthis.pointEmitterPosition=new Float32Array([0,0,0]);\r\n\t\tthis.pointEmitterPositionVariance=new Float32Array([0,0,0]);\r\n\t\tthis.pointEmitterVelocity=new Float32Array([0,0,0]);\r\n\t\tthis.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]);\r\n\t\tthis.boxEmitterCenterPosition=new Float32Array([0,0,0]);\r\n\t\tthis.boxEmitterSize=new Float32Array([0,0,0]);\r\n\t\tthis.boxEmitterVelocity=new Float32Array([0,0,0]);\r\n\t\tthis.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]);\r\n\t\tthis.sphereEmitterCenterPosition=new Float32Array([0,0,0]);\r\n\t\tthis.ringEmitterCenterPosition=new Float32Array([0,0,0]);\r\n\t\tthis.positionVariance=new Float32Array([0,0,0]);\r\n\t}\r\n\r\n\t__class(ParticleSetting,'laya.particle.ParticleSetting');\r\n\tParticleSetting.checkSetting=function(setting){\r\n\t\tvar key;\r\n\t\tfor (key in ParticleSetting._defaultSetting){\r\n\t\t\tif (!setting.hasOwnProperty(key)){\r\n\t\t\t\tsetting[key]=ParticleSetting._defaultSetting[key];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__static(ParticleSetting,\r\n\t['_defaultSetting',function(){return this._defaultSetting=new ParticleSetting();}\r\n\t]);\r\n\treturn ParticleSetting;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*<code>ParticleTemplateBase</code> 类是粒子模板基类\r\n*\r\n*/\r\n//class laya.particle.ParticleTemplateBase\r\nvar ParticleTemplateBase=(function(){\r\n\tfunction ParticleTemplateBase(){\r\n\t\t/**\r\n\t\t*粒子配置数据\r\n\t\t*/\r\n\t\tthis.settings=null;\r\n\t\t/**\r\n\t\t*粒子贴图\r\n\t\t*/\r\n\t\tthis.texture=null;\r\n\t}\r\n\r\n\t__class(ParticleTemplateBase,'laya.particle.ParticleTemplateBase');\r\n\tvar __proto=ParticleTemplateBase.prototype;\r\n\t/**\r\n\t*添加一个粒子\r\n\t*@param position 粒子位置\r\n\t*@param velocity 粒子速度\r\n\t*\r\n\t*/\r\n\t__proto.addParticleArray=function(position,velocity){}\r\n\treturn ParticleTemplateBase;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.particleUtils.CanvasShader\r\nvar CanvasShader=(function(){\r\n\tfunction CanvasShader(){\r\n\t\tthis.u_Duration=NaN;\r\n\t\tthis.u_EndVelocity=NaN;\r\n\t\tthis.u_Gravity=null;\r\n\t\tthis.a_Position=null;\r\n\t\tthis.a_Velocity=null;\r\n\t\tthis.a_StartColor=null;\r\n\t\tthis.a_EndColor=null;\r\n\t\tthis.a_SizeRotation=null;\r\n\t\tthis.a_Radius=null;\r\n\t\tthis.a_Radian=null;\r\n\t\tthis.a_AgeAddScale=NaN;\r\n\t\tthis.gl_Position=null;\r\n\t\tthis.v_Color=null;\r\n\t\tthis.oSize=NaN;\r\n\t\tthis._color=new Float32Array(4);\r\n\t\tthis._position=new Float32Array(3);\r\n\t}\r\n\r\n\t__class(CanvasShader,'laya.particle.particleUtils.CanvasShader');\r\n\tvar __proto=CanvasShader.prototype;\r\n\t__proto.getLen=function(position){\r\n\t\treturn Math.sqrt(position[0] *position[0]+position[1] *position[1]+position[2] *position[2]);\r\n\t}\r\n\r\n\t__proto.ComputeParticlePosition=function(position,velocity,age,normalizedAge){\r\n\t\tthis._position[0]=position[0];\r\n\t\tthis._position[1]=position[1];\r\n\t\tthis._position[2]=position[2];\r\n\t\tvar startVelocity=this.getLen(velocity);\r\n\t\tvar endVelocity=startVelocity *this.u_EndVelocity;\r\n\t\tvar velocityIntegral=startVelocity *normalizedAge+(endVelocity-startVelocity)*normalizedAge *normalizedAge / 2.0;\r\n\t\tvar lenVelocity=NaN;\r\n\t\tlenVelocity=this.getLen(velocity);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=3;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._position[i]=this._position[i]+(velocity[i] / lenVelocity)*velocityIntegral *this.u_Duration;\r\n\t\t\tthis._position[i]+=this.u_Gravity[i] *age *normalizedAge;\r\n\t\t};\r\n\t\tvar radius=MathUtil.lerp(this.a_Radius[0],this.a_Radius[1],normalizedAge);\r\n\t\tvar radianHorizontal=MathUtil.lerp(this.a_Radian[0],this.a_Radian[2],normalizedAge);\r\n\t\tvar radianVertical=MathUtil.lerp(this.a_Radian[1],this.a_Radian[3],normalizedAge);\r\n\t\tvar r=Math.cos(radianVertical)*radius;\r\n\t\tthis._position[1]+=Math.sin(radianVertical)*radius;\r\n\t\tthis._position[0]+=Math.cos(radianHorizontal)*r;\r\n\t\tthis._position[2]+=Math.sin(radianHorizontal)*r;\r\n\t\treturn new Float32Array([this._position[0],this._position[1],0.0,1.0]);\r\n\t}\r\n\r\n\t__proto.ComputeParticleSize=function(startSize,endSize,normalizedAge){\r\n\t\tvar size=MathUtil.lerp(startSize,endSize,normalizedAge);\r\n\t\treturn size;\r\n\t}\r\n\r\n\t__proto.ComputeParticleRotation=function(rot,age){\r\n\t\treturn rot *age;\r\n\t}\r\n\r\n\t__proto.ComputeParticleColor=function(startColor,endColor,normalizedAge){\r\n\t\tvar rst=this._color;\r\n\t\tMathUtil.lerpVector4(startColor,endColor,normalizedAge,rst);\r\n\t\trst[3]=rst[3]*normalizedAge *(1.0-normalizedAge)*(1.0-normalizedAge)*6.7;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto.clamp=function(value,min,max){\r\n\t\tif(value<min)return min;\r\n\t\tif(value>max)return max;\r\n\t\treturn value;\r\n\t}\r\n\r\n\t__proto.getData=function(age){\r\n\t\tage *=1.0+this.a_AgeAddScale;\r\n\t\tvar normalizedAge=this.clamp(age / this.u_Duration,0.0,1.0);\r\n\t\tthis.gl_Position=this.ComputeParticlePosition(this.a_Position,this.a_Velocity,age,normalizedAge);\r\n\t\tvar pSize=this.ComputeParticleSize(this.a_SizeRotation[0],this.a_SizeRotation[1],normalizedAge);\r\n\t\tvar rotation=this.ComputeParticleRotation(this.a_SizeRotation[2],age);\r\n\t\tthis.v_Color=this.ComputeParticleColor(this.a_StartColor,this.a_EndColor,normalizedAge);\r\n\t\tvar matric=new Matrix();\r\n\t\tvar scale=NaN;\r\n\t\tscale=pSize/this.oSize*2;\r\n\t\tmatric.scale(scale,scale);\r\n\t\tmatric.rotate(rotation);\r\n\t\tmatric.setTranslate(this.gl_Position[0],-this.gl_Position[1]);\r\n\t\tvar alpha=NaN;\r\n\t\talpha=this.v_Color[3];\r\n\t\treturn [this.v_Color,alpha,matric,this.v_Color[0]*alpha,this.v_Color[1]*alpha,this.v_Color[2]*alpha];\r\n\t}\r\n\r\n\treturn CanvasShader;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@private\r\n*\r\n*@created 2015-8-25 下午3:41:07\r\n*/\r\n//class laya.particle.particleUtils.CMDParticle\r\nvar CMDParticle=(function(){\r\n\tfunction CMDParticle(){\r\n\t\t/**\r\n\t\t*最大帧\r\n\t\t*/\r\n\t\tthis.maxIndex=0;\r\n\t\t/**\r\n\t\t*帧命令数组\r\n\t\t*/\r\n\t\tthis.cmds=null;\r\n\t\t/**\r\n\t\t*粒子id\r\n\t\t*/\r\n\t\tthis.id=0;\r\n\t}\r\n\r\n\t__class(CMDParticle,'laya.particle.particleUtils.CMDParticle');\r\n\tvar __proto=CMDParticle.prototype;\r\n\t__proto.setCmds=function(cmds){\r\n\t\tthis.cmds=cmds;\r\n\t\tthis.maxIndex=cmds.length-1;\r\n\t}\r\n\r\n\treturn CMDParticle;\r\n})()\r\n\r\n\r\n//class laya.particle.particleUtils.PicTool\r\nvar PicTool=(function(){\r\n\tfunction PicTool(){}\r\n\t__class(PicTool,'laya.particle.particleUtils.PicTool');\r\n\tPicTool.getCanvasPic=function(img,color){\r\n\t\timg=img.bitmap;\r\n\t\tvar canvas=new HTMLCanvas(\"2D\");\r\n\t\tvar ctx=canvas.getContext('2d');\r\n\t\tcanvas.size(img.width,img.height);\r\n\t\tvar red=(color >> 16 & 0xFF);\r\n\t\tvar green=(color >> 8 & 0xFF);\r\n\t\tvar blue=(color & 0xFF);\r\n\t\tif(Render.isConchApp){\r\n\t\t\tctx.setFilter(red/255,green/255,blue/255,0);\r\n\t\t}\r\n\t\tctx.drawImage(img.source,0,0);\r\n\t\tif (!Render.isConchApp){\r\n\t\t\tvar imgdata=ctx.getImageData(0,0,canvas.width,canvas.height);\r\n\t\t\tvar data=imgdata.data;\r\n\t\t\tfor (var i=0,n=data.length;i < n;i+=4){\r\n\t\t\t\tif (data[i+3]==0)continue ;\r\n\t\t\t\tdata[i] *=red/255;\r\n\t\t\t\tdata[i+1] *=green/255;\r\n\t\t\t\tdata[i+2] *=blue/255;\r\n\t\t\t}\r\n\t\t\tctx.putImageData(imgdata,0,0);\r\n\t\t}\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\tPicTool.getRGBPic=function(img){\r\n\t\tvar rst;\r\n\t\trst=[new Texture(PicTool.getCanvasPic(img,0xFF0000)),new Texture(PicTool.getCanvasPic(img,0x00FF00)),new Texture(PicTool.getCanvasPic(img,0x0000FF))];\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn PicTool;\r\n})()\r\n\r\n\r\n/**\r\n*\r\n*@private\r\n*/\r\n//class laya.particle.emitter.Emitter2D extends laya.particle.emitter.EmitterBase\r\nvar Emitter2D=(function(_super){\r\n\tfunction Emitter2D(_template){\r\n\t\tthis.setting=null;\r\n\t\tthis._posRange=null;\r\n\t\tthis._canvasTemplate=null;\r\n\t\tthis._emitFun=null;\r\n\t\tEmitter2D.__super.call(this);\r\n\t\tthis.template=_template;\r\n\t}\r\n\r\n\t__class(Emitter2D,'laya.particle.emitter.Emitter2D',_super);\r\n\tvar __proto=Emitter2D.prototype;\r\n\t__proto.emit=function(){\r\n\t\t_super.prototype.emit.call(this);\r\n\t\tif(this._emitFun!=null)\r\n\t\t\tthis._emitFun();\r\n\t}\r\n\r\n\t__proto.getRandom=function(value){\r\n\t\treturn (Math.random()*2-1)*value;\r\n\t}\r\n\r\n\t__proto.webGLEmit=function(){\r\n\t\tvar pos=new Float32Array(3);\r\n\t\tpos[0]=this.getRandom(this._posRange[0]);\r\n\t\tpos[1]=this.getRandom(this._posRange[1]);\r\n\t\tpos[2]=this.getRandom(this._posRange[2]);\r\n\t\tvar v=new Float32Array(3);\r\n\t\tv[0]=0;\r\n\t\tv[1]=0;\r\n\t\tv[2]=0;\r\n\t\tthis._particleTemplate.addParticleArray(pos,v);\r\n\t}\r\n\r\n\t__proto.canvasEmit=function(){\r\n\t\tvar pos=new Float32Array(3);\r\n\t\tpos[0]=this.getRandom(this._posRange[0]);\r\n\t\tpos[1]=this.getRandom(this._posRange[1]);\r\n\t\tpos[2]=this.getRandom(this._posRange[2]);\r\n\t\tvar v=new Float32Array(3);\r\n\t\tv[0]=0;\r\n\t\tv[1]=0;\r\n\t\tv[2]=0;\r\n\t\tthis._particleTemplate.addParticleArray(pos,v);\r\n\t}\r\n\r\n\t__getset(0,__proto,'template',function(){\r\n\t\treturn this._particleTemplate;\r\n\t\t},function(template){\r\n\t\tthis._particleTemplate=template;\r\n\t\tif (!template){\r\n\t\t\tthis._emitFun=null;\r\n\t\t\tthis.setting=null;\r\n\t\t\tthis._posRange=null;\r\n\t\t};\r\n\t\tthis.setting=template.settings;\r\n\t\tthis._posRange=this.setting.positionVariance;\r\n\t\tif((this._particleTemplate instanceof laya.particle.ParticleTemplate2D )){\r\n\t\t\tthis._emitFun=this.webGLEmit;\r\n\t\t}else\r\n\t\tif((this._particleTemplate instanceof laya.particle.ParticleTemplateCanvas )){\r\n\t\t\tthis._canvasTemplate=template;\r\n\t\t\tthis._emitFun=this.canvasEmit;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Emitter2D;\r\n})(EmitterBase)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.ParticleTemplateWebGL extends laya.particle.ParticleTemplateBase\r\nvar ParticleTemplateWebGL=(function(_super){\r\n\tfunction ParticleTemplateWebGL(parSetting){\r\n\t\tthis._vertices=null;\r\n\t\tthis._vertexBuffer=null;\r\n\t\tthis._indexBuffer=null;\r\n\t\tthis._floatCountPerVertex=29;\r\n\t\t//0~3为CornerTextureCoordinate,4~6为Position,7~9Velocity,10到13为StartColor,14到17为EndColor,18到20位SizeRotation，21到22位Radius,23到26位Radian，27为DurationAddScaleShaderValue,28为Time\r\n\t\tthis._firstActiveElement=0;\r\n\t\tthis._firstNewElement=0;\r\n\t\tthis._firstFreeElement=0;\r\n\t\tthis._firstRetiredElement=0;\r\n\t\tthis._currentTime=0;\r\n\t\tthis._drawCounter=0;\r\n\t\tParticleTemplateWebGL.__super.call(this);\r\n\t\tthis.settings=parSetting;\r\n\t}\r\n\r\n\t__class(ParticleTemplateWebGL,'laya.particle.ParticleTemplateWebGL',_super);\r\n\tvar __proto=ParticleTemplateWebGL.prototype;\r\n\t__proto.initialize=function(){\r\n\t\tthis._vertices=new Float32Array(this.settings.maxPartices *this._floatCountPerVertex *4);\r\n\t\tvar particleOffset=0;\r\n\t\tfor (var i=0;i < this.settings.maxPartices;i++){\r\n\t\t\tvar random=Math.random();\r\n\t\t\tvar cornerYSegement=this.settings.textureCount ? 1.0 / this.settings.textureCount :1.0;\r\n\t\t\tvar cornerY=NaN;\r\n\t\t\tfor (cornerY=0;cornerY < this.settings.textureCount;cornerY+=cornerYSegement){\r\n\t\t\t\tif (random < cornerY+cornerYSegement)\r\n\t\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tparticleOffset=i *this._floatCountPerVertex *4;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *0+0]=-1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *0+1]=-1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *0+2]=0;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *0+3]=cornerY;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *1+0]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *1+1]=-1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *1+2]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *1+3]=cornerY;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *2+0]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *2+1]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *2+2]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *2+3]=cornerY+cornerYSegement;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *3+0]=-1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *3+1]=1;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *3+2]=0;\r\n\t\t\tthis._vertices[particleOffset+this._floatCountPerVertex *3+3]=cornerY+cornerYSegement;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.loadContent=function(){}\r\n\t__proto.update=function(elapsedTime){\r\n\t\tthis._currentTime+=elapsedTime / 1000;\r\n\t\tthis.retireActiveParticles();\r\n\t\tthis.freeRetiredParticles();\r\n\t\tif (this._firstActiveElement==this._firstFreeElement)\r\n\t\t\tthis._currentTime=0;\r\n\t\tif (this._firstRetiredElement==this._firstActiveElement)\r\n\t\t\tthis._drawCounter=0;\r\n\t}\r\n\r\n\t__proto.retireActiveParticles=function(){\r\n\t\tvar epsilon=0.0001;\r\n\t\tvar particleDuration=this.settings.duration;\r\n\t\twhile (this._firstActiveElement !=this._firstNewElement){\r\n\t\t\tvar offset=this._firstActiveElement *this._floatCountPerVertex *4;\r\n\t\t\tvar index=offset+28;\r\n\t\t\tvar particleAge=this._currentTime-this._vertices[index];\r\n\t\t\tparticleAge *=(1.0+this._vertices[offset+27]);\r\n\t\t\tif (particleAge+epsilon < particleDuration)\r\n\t\t\t\tbreak ;\r\n\t\t\tthis._vertices[index]=this._drawCounter;\r\n\t\t\tthis._firstActiveElement++;\r\n\t\t\tif (this._firstActiveElement >=this.settings.maxPartices)\r\n\t\t\t\tthis._firstActiveElement=0;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.freeRetiredParticles=function(){\r\n\t\twhile (this._firstRetiredElement !=this._firstActiveElement){\r\n\t\t\tvar age=this._drawCounter-this._vertices[this._firstRetiredElement *this._floatCountPerVertex *4+28];\r\n\t\t\tif (age < 3)\r\n\t\t\t\tbreak ;\r\n\t\t\tthis._firstRetiredElement++;\r\n\t\t\tif (this._firstRetiredElement >=this.settings.maxPartices)\r\n\t\t\t\tthis._firstRetiredElement=0;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.addNewParticlesToVertexBuffer=function(){}\r\n\t__proto.addParticleArray=function(position,velocity){\r\n\t\tvar nextFreeParticle=this._firstFreeElement+1;\r\n\t\tif (nextFreeParticle >=this.settings.maxPartices)\r\n\t\t\tnextFreeParticle=0;\r\n\t\tif (nextFreeParticle===this._firstRetiredElement)\r\n\t\t\treturn;\r\n\t\tvar particleData=ParticleData.Create(this.settings,position,velocity,this._currentTime);\r\n\t\tvar startIndex=this._firstFreeElement *this._floatCountPerVertex *4;\r\n\t\tfor (var i=0;i < 4;i++){\r\n\t\t\tvar j=0,offset=0;\r\n\t\t\tfor (j=0,offset=4;j < 3;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.position[j];\r\n\t\t\tfor (j=0,offset=7;j < 3;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.velocity[j];\r\n\t\t\tfor (j=0,offset=10;j < 4;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.startColor[j];\r\n\t\t\tfor (j=0,offset=14;j < 4;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.endColor[j];\r\n\t\t\tfor (j=0,offset=18;j < 3;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.sizeRotation[j];\r\n\t\t\tfor (j=0,offset=21;j < 2;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.radius[j];\r\n\t\t\tfor (j=0,offset=23;j < 4;j++)\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+offset+j]=particleData.radian[j];\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+27]=particleData.durationAddScale;\r\n\t\t\tthis._vertices[startIndex+i *this._floatCountPerVertex+28]=particleData.time;\r\n\t\t}\r\n\t\tthis._firstFreeElement=nextFreeParticle;\r\n\t}\r\n\r\n\treturn ParticleTemplateWebGL;\r\n})(ParticleTemplateBase)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.ParticleTemplateCanvas extends laya.particle.ParticleTemplateBase\r\nvar ParticleTemplateCanvas=(function(_super){\r\n\tfunction ParticleTemplateCanvas(particleSetting){\r\n\t\t/**\r\n\t\t*是否处于可播放状态\r\n\t\t*/\r\n\t\tthis._ready=false;\r\n\t\t/**\r\n\t\t*贴图列表\r\n\t\t*/\r\n\t\tthis.textureList=[];\r\n\t\t/**\r\n\t\t*粒子列表\r\n\t\t*/\r\n\t\tthis.particleList=[];\r\n\t\t/**\r\n\t\t*贴图中心偏移x\r\n\t\t*/\r\n\t\tthis.pX=0;\r\n\t\t/**\r\n\t\t*贴图中心偏移y\r\n\t\t*/\r\n\t\tthis.pY=0;\r\n\t\t/**\r\n\t\t*当前活跃的粒子\r\n\t\t*/\r\n\t\tthis.activeParticles=[];\r\n\t\t/**\r\n\t\t*粒子pool\r\n\t\t*/\r\n\t\tthis.deadParticles=[];\r\n\t\t/**\r\n\t\t*粒子播放进度列表\r\n\t\t*/\r\n\t\tthis.iList=[];\r\n\t\t/**\r\n\t\t*粒子系统使用的最大粒子数\r\n\t\t*/\r\n\t\tthis._maxNumParticles=0;\r\n\t\t/**\r\n\t\t*纹理的宽度\r\n\t\t*/\r\n\t\tthis.textureWidth=NaN;\r\n\t\t/**\r\n\t\t*宽度倒数\r\n\t\t*/\r\n\t\tthis.dTextureWidth=NaN;\r\n\t\t/**\r\n\t\t*是否支持颜色变化\r\n\t\t*/\r\n\t\tthis.colorChange=true;\r\n\t\t/**\r\n\t\t*采样步长\r\n\t\t*/\r\n\t\tthis.step=1/60;\r\n\t\tthis.canvasShader=new CanvasShader();\r\n\t\tParticleTemplateCanvas.__super.call(this);\r\n\t\tthis.settings=particleSetting;\r\n\t\tthis._maxNumParticles=particleSetting.maxPartices;\r\n\t\tthis.texture=new Texture();\r\n\t\tthis.texture.on(/*laya.events.Event.LOADED*/\"loaded\",this,this._textureLoaded);\r\n\t\tthis.texture.load(particleSetting.textureName);\r\n\t}\r\n\r\n\t__class(ParticleTemplateCanvas,'laya.particle.ParticleTemplateCanvas',_super);\r\n\tvar __proto=ParticleTemplateCanvas.prototype;\r\n\t__proto._textureLoaded=function(e){\r\n\t\tthis.setTexture(this.texture);\r\n\t\tthis._ready=true;\r\n\t}\r\n\r\n\t__proto.clear=function(clearTexture){\r\n\t\t(clearTexture===void 0)&& (clearTexture=true);\r\n\t\tthis.deadParticles.length=0;\r\n\t\tthis.activeParticles.length=0;\r\n\t\tthis.textureList.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*设置纹理\r\n\t*@param texture\r\n\t*\r\n\t*/\r\n\t__proto.setTexture=function(texture){\r\n\t\tthis.texture=texture;\r\n\t\tthis.textureWidth=texture.width;\r\n\t\tthis.dTextureWidth=1/this.textureWidth;\r\n\t\tthis.pX=-texture.width*0.5;\r\n\t\tthis.pY=-texture.height*0.5;\r\n\t\tthis.textureList=ParticleTemplateCanvas.changeTexture(texture,this.textureList);\r\n\t\tthis.particleList.length=0;\r\n\t\tthis.deadParticles.length=0;\r\n\t\tthis.activeParticles.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*创建一个粒子数据\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto._createAParticleData=function(position,velocity){\r\n\t\tthis.canvasShader.u_EndVelocity=this.settings.endVelocity;\r\n\t\tthis.canvasShader.u_Gravity=this.settings.gravity;\r\n\t\tthis.canvasShader.u_Duration=this.settings.duration;\r\n\t\tvar particle;\r\n\t\tparticle=ParticleData.Create(this.settings,position,velocity,0);\r\n\t\tthis.canvasShader.a_Position=particle.position;\r\n\t\tthis.canvasShader.a_Velocity=particle.velocity;\r\n\t\tthis.canvasShader.a_StartColor=particle.startColor;\r\n\t\tthis.canvasShader.a_EndColor=particle.endColor;\r\n\t\tthis.canvasShader.a_SizeRotation=particle.sizeRotation;\r\n\t\tthis.canvasShader.a_Radius=particle.radius;\r\n\t\tthis.canvasShader.a_Radian=particle.radian;\r\n\t\tthis.canvasShader.a_AgeAddScale=particle.durationAddScale;\r\n\t\tthis.canvasShader.oSize=this.textureWidth;\r\n\t\tvar rst=new CMDParticle();\r\n\t\tvar i=0,len=this.settings.duration/(1+particle.durationAddScale);\r\n\t\tvar params=[];\r\n\t\tvar mStep=NaN;\r\n\t\tfor(i=0;i<len;i+=this.step){\r\n\t\t\tparams.push(this.canvasShader.getData(i));\r\n\t\t}\r\n\t\trst.id=this.particleList.length;\r\n\t\tthis.particleList.push(rst);\r\n\t\trst.setCmds(params);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto.addParticleArray=function(position,velocity){\r\n\t\tif(!this._ready)return;\r\n\t\tvar tParticle;\r\n\t\tif(this.particleList.length<this._maxNumParticles){\r\n\t\t\ttParticle=this._createAParticleData(position,velocity);\r\n\t\t\tthis.iList[tParticle.id]=0;\r\n\t\t\tthis.activeParticles.push(tParticle);\r\n\t\t\t}else{\r\n\t\t\tif(this.deadParticles.length>0){\r\n\t\t\t\ttParticle=this.deadParticles.pop();\r\n\t\t\t\tthis.iList[tParticle.id]=0;\r\n\t\t\t\tthis.activeParticles.push(tParticle);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.advanceTime=function(passedTime){\r\n\t\t(passedTime===void 0)&& (passedTime=1);\r\n\t\tif(!this._ready)return;\r\n\t\tvar particleList=this.activeParticles;\r\n\t\tvar pool=this.deadParticles;\r\n\t\tvar i=0,len=particleList.length;\r\n\t\tvar tcmd;\r\n\t\tvar tI=0;\r\n\t\tvar iList=this.iList;\r\n\t\tfor(i=len-1;i>-1;i--){\r\n\t\t\ttcmd=particleList[i];\r\n\t\t\ttI=iList[tcmd.id];\r\n\t\t\tif(tI>=tcmd.maxIndex){\r\n\t\t\t\ttI=0;\r\n\t\t\t\tparticleList.splice(i,1);\r\n\t\t\t\tpool.push(tcmd);\r\n\t\t\t\t}else{\r\n\t\t\t\ttI+=1;\r\n\t\t\t}\r\n\t\t\tiList[tcmd.id]=tI;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.render=function(context,x,y){\r\n\t\tif(!this._ready)return;\r\n\t\tif(this.activeParticles.length<1)return;\r\n\t\tif (this.textureList.length < 2)return;\r\n\t\tif (this.settings.disableColor){\r\n\t\t\tthis.noColorRender(context,x,y);\r\n\t\t\t}else{\r\n\t\t\tthis.canvasRender(context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.noColorRender=function(context,x,y){\r\n\t\tvar particleList=this.activeParticles;\r\n\t\tvar i=0,len=particleList.length;\r\n\t\tvar tcmd;\r\n\t\tvar tParam;\r\n\t\tvar tAlpha=NaN;\r\n\t\tvar px=this.pX,py=this.pY;\r\n\t\tvar pw=-px*2,ph=-py*2;\r\n\t\tvar tI=0;\r\n\t\tvar textureList=this.textureList;\r\n\t\tvar iList=this.iList;\r\n\t\tvar preAlpha=NaN;\r\n\t\tcontext.translate(x,y);\r\n\t\tpreAlpha=context.ctx.globalAlpha;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttcmd=particleList[i];\r\n\t\t\ttI=iList[tcmd.id];\r\n\t\t\ttParam=tcmd.cmds[tI];\r\n\t\t\tif (!tParam)continue ;\r\n\t\t\tif ((tAlpha=tParam[1])<=0.01)continue ;\r\n\t\t\tcontext.setAlpha(preAlpha*tAlpha);\r\n\t\t\tcontext.drawTextureWithTransform(this.texture,px,py,pw,ph,tParam[2],1);\r\n\t\t}\r\n\t\tcontext.setAlpha(preAlpha);\r\n\t\tcontext.translate(-x,-y);\r\n\t}\r\n\r\n\t__proto.canvasRender=function(context,x,y){\r\n\t\tvar particleList=this.activeParticles;\r\n\t\tvar i=0,len=particleList.length;\r\n\t\tvar tcmd;\r\n\t\tvar tParam;\r\n\t\tvar tAlpha=NaN;\r\n\t\tvar px=this.pX,py=this.pY;\r\n\t\tvar pw=-px*2,ph=-py*2;\r\n\t\tvar tI=0;\r\n\t\tvar textureList=this.textureList;\r\n\t\tvar iList=this.iList;\r\n\t\tvar preAlpha=NaN;\r\n\t\tvar preB;\r\n\t\tcontext.translate(x,y);\r\n\t\tpreAlpha=context.ctx.globalAlpha;\r\n\t\tpreB=context.ctx.globalCompositeOperation;\r\n\t\tcontext.blendMode(\"lighter\");\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\ttcmd=particleList[i];\r\n\t\t\ttI=iList[tcmd.id];\r\n\t\t\ttParam=tcmd.cmds[tI];\r\n\t\t\tif (!tParam)continue ;\r\n\t\t\tif ((tAlpha=tParam[1])<=0.01)continue ;\r\n\t\t\tcontext.save();\r\n\t\t\tcontext.transformByMatrix(tParam[2]);\r\n\t\t\tif(tParam[3]>0.01){\r\n\t\t\t\tcontext.setAlpha(preAlpha*tParam[3]);\r\n\t\t\t\tcontext.drawTexture(textureList[0],px,py,pw,ph);\r\n\t\t\t}\r\n\t\t\tif(tParam[4]>0.01){\r\n\t\t\t\tcontext.setAlpha(preAlpha*tParam[4]);\r\n\t\t\t\tcontext.drawTexture(textureList[1],px,py,pw,ph);\r\n\t\t\t}\r\n\t\t\tif(tParam[5]>0.01){\r\n\t\t\t\tcontext.setAlpha(preAlpha*tParam[5]);\r\n\t\t\t\tcontext.drawTexture(textureList[2],px,py,pw,ph);\r\n\t\t\t}\r\n\t\t\tcontext.restore();\r\n\t\t}\r\n\t\tcontext.setAlpha(preAlpha);\r\n\t\tcontext.translate(-x,-y);\r\n\t\tcontext.blendMode(preB);\r\n\t}\r\n\r\n\tParticleTemplateCanvas.changeTexture=function(texture,rst,settings){\r\n\t\tif(!rst)rst=[];\r\n\t\trst.length=0;\r\n\t\tif (settings&&settings.disableColor){\r\n\t\t\trst.push(texture,texture,texture);\r\n\t\t\t}else{\r\n\t\t\tUtils.copyArray(rst,PicTool.getRGBPic(texture));\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn ParticleTemplateCanvas;\r\n})(ParticleTemplateBase)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.ParticleTemplate2D extends laya.particle.ParticleTemplateWebGL\r\nvar ParticleTemplate2D=(function(_super){\r\n\tfunction ParticleTemplate2D(parSetting){\r\n\t\tthis._vertexBuffer2D=null;\r\n\t\tthis._indexBuffer2D=null;\r\n\t\tthis.x=0;\r\n\t\tthis.y=0;\r\n\t\tthis._blendFn=null;\r\n\t\tthis._startTime=0;\r\n\t\tthis.sv=new ParticleShaderValue();\r\n\t\tParticleTemplate2D.__super.call(this,parSetting);\r\n\t\tvar _this=this;\r\n\t\tLaya.loader.load(this.settings.textureName,Handler.create(null,function(texture){\r\n\t\t\t(texture.bitmap).enableMerageInAtlas=false;\r\n\t\t\t_this.texture=texture;\r\n\t\t}));\r\n\t\tthis.sv.u_Duration=this.settings.duration;\r\n\t\tthis.sv.u_Gravity=this.settings.gravity;\r\n\t\tthis.sv.u_EndVelocity=this.settings.endVelocity;\r\n\t\tthis._blendFn=BlendMode.fns[parSetting.blendState];\r\n\t\tthis.initialize();\r\n\t\tthis._vertexBuffer=this._vertexBuffer2D=VertexBuffer2D.create(-1,/*laya.webgl.WebGLContext.DYNAMIC_DRAW*/0x88E8);\r\n\t\tthis._indexBuffer=this._indexBuffer2D=IndexBuffer2D.create(/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4);\r\n\t\tthis.loadContent();\r\n\t}\r\n\r\n\t__class(ParticleTemplate2D,'laya.particle.ParticleTemplate2D',_super);\r\n\tvar __proto=ParticleTemplate2D.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.getRenderType=function(){return-111}\r\n\t__proto.releaseRender=function(){}\r\n\t__proto.addParticleArray=function(position,velocity){\r\n\t\tposition[0]+=this.x;\r\n\t\tposition[1]+=this.y;\r\n\t\t_super.prototype.addParticleArray.call(this,position,velocity);\r\n\t}\r\n\r\n\t__proto.loadContent=function(){\r\n\t\tvar indexes=new Uint16Array(this.settings.maxPartices *6);\r\n\t\tfor (var i=0;i < this.settings.maxPartices;i++){\r\n\t\t\tindexes[i *6+0]=(i *4+0);\r\n\t\t\tindexes[i *6+1]=(i *4+1);\r\n\t\t\tindexes[i *6+2]=(i *4+2);\r\n\t\t\tindexes[i *6+3]=(i *4+0);\r\n\t\t\tindexes[i *6+4]=(i *4+2);\r\n\t\t\tindexes[i *6+5]=(i *4+3);\r\n\t\t}\r\n\t\tthis._indexBuffer2D.clear();\r\n\t\tthis._indexBuffer2D.append(indexes);\r\n\t\tthis._indexBuffer2D.upload();\r\n\t}\r\n\r\n\t__proto.addNewParticlesToVertexBuffer=function(){\r\n\t\tthis._vertexBuffer2D.clear();\r\n\t\tthis._vertexBuffer2D.append(this._vertices);\r\n\t\tvar start=0;\r\n\t\tif (this._firstNewElement < this._firstFreeElement){\r\n\t\t\tstart=this._firstNewElement *4 *this._floatCountPerVertex *4;\r\n\t\t\tthis._vertexBuffer2D.subUpload(start,start,start+(this._firstFreeElement-this._firstNewElement)*4 *this._floatCountPerVertex *4);\r\n\t\t\t}else {\r\n\t\t\tstart=this._firstNewElement *4 *this._floatCountPerVertex *4;\r\n\t\t\tthis._vertexBuffer2D.subUpload(start,start,start+(this.settings.maxPartices-this._firstNewElement)*4 *this._floatCountPerVertex *4);\r\n\t\t\tif (this._firstFreeElement > 0){\r\n\t\t\t\tthis._vertexBuffer2D.setNeedUpload();\r\n\t\t\t\tthis._vertexBuffer2D.subUpload(0,0,this._firstFreeElement *4 *this._floatCountPerVertex *4);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._firstNewElement=this._firstFreeElement;\r\n\t}\r\n\r\n\t__proto.renderSubmit=function(){\r\n\t\tif (this.texture&&this.texture.loaded){\r\n\t\t\tthis.update(Laya.timer.delta);\r\n\t\t\tthis.sv.u_CurrentTime=this._currentTime;\r\n\t\t\tif (this._firstNewElement !=this._firstFreeElement){\r\n\t\t\t\tthis.addNewParticlesToVertexBuffer();\r\n\t\t\t}\r\n\t\t\tthis.blend();\r\n\t\t\tif (this._firstActiveElement !=this._firstFreeElement){\r\n\t\t\t\tvar gl=WebGL.mainContext;\r\n\t\t\t\tthis._vertexBuffer2D.bind(this._indexBuffer2D);\r\n\t\t\t\tthis.sv.u_texture=this.texture.source;\r\n\t\t\t\tthis.sv.upload();\r\n\t\t\t\tif (this._firstActiveElement < this._firstFreeElement){\r\n\t\t\t\t\tWebGL.mainContext.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,(this._firstFreeElement-this._firstActiveElement)*6,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._firstActiveElement *6 *2);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tWebGL.mainContext.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,(this.settings.maxPartices-this._firstActiveElement)*6,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._firstActiveElement *6 *2);\r\n\t\t\t\t\tif (this._firstFreeElement > 0)\r\n\t\t\t\t\t\tWebGL.mainContext.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,this._firstFreeElement *6,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,0);\r\n\t\t\t\t}\r\n\t\t\t\tStat.drawCall++;\r\n\t\t\t}\r\n\t\t\tthis._drawCounter++;\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto.blend=function(){\r\n\t\tif (BlendMode.activeBlendFunction!==this._blendFn){\r\n\t\t\tvar gl=WebGL.mainContext;\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.BLEND*/0x0BE2);\r\n\t\t\tthis._blendFn(gl);\r\n\t\t\tBlendMode.activeBlendFunction=this._blendFn;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.dispose=function(){\r\n\t\tthis._vertexBuffer2D.dispose();\r\n\t\tthis._indexBuffer2D.dispose();\r\n\t}\r\n\r\n\tParticleTemplate2D.activeBlendType=-1;\r\n\treturn ParticleTemplate2D;\r\n})(ParticleTemplateWebGL)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.shader.value.ParticleShaderValue extends laya.webgl.shader.d2.value.Value2D\r\nvar ParticleShaderValue=(function(_super){\r\n\tfunction ParticleShaderValue(){\r\n\t\tthis.a_CornerTextureCoordinate=[4,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,0];\r\n\t\tthis.a_Position=[3,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,16];\r\n\t\tthis.a_Velocity=[3,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,28];\r\n\t\tthis.a_StartColor=[4,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,40];\r\n\t\tthis.a_EndColor=[4,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,56];\r\n\t\tthis.a_SizeRotation=[3,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,72];\r\n\t\tthis.a_Radius=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,84];\r\n\t\tthis.a_Radian=[4,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,92];\r\n\t\tthis.a_AgeAddScale=[1,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,108];\r\n\t\tthis.a_Time=[1,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,116,112];\r\n\t\tthis.u_CurrentTime=NaN;\r\n\t\tthis.u_Duration=NaN;\r\n\t\tthis.u_Gravity=null;\r\n\t\t//v3\r\n\t\tthis.u_EndVelocity=NaN;\r\n\t\tthis.u_texture=null;\r\n\t\tParticleShaderValue.__super.call(this,0,0);\r\n\t}\r\n\r\n\t__class(ParticleShaderValue,'laya.particle.shader.value.ParticleShaderValue',_super);\r\n\tvar __proto=ParticleShaderValue.prototype;\r\n\t__proto.upload=function(){\r\n\t\tthis.refresh();\r\n\t\tParticleShaderValue.pShader.upload(this);\r\n\t}\r\n\r\n\t__static(ParticleShaderValue,\r\n\t['pShader',function(){return this.pShader=new ParticleShader();}\r\n\t]);\r\n\treturn ParticleShaderValue;\r\n})(Value2D)\r\n\r\n\r\n/**\r\n*<code>Particle2D</code> 类是2D粒子播放类\r\n*\r\n*/\r\n//class laya.particle.Particle2D extends laya.display.Sprite\r\nvar Particle2D=(function(_super){\r\n\tfunction Particle2D(setting){\r\n\t\t/**@private */\r\n\t\tthis._matrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];\r\n\t\t/**@private */\r\n\t\tthis._particleTemplate=null;\r\n\t\t/**@private */\r\n\t\tthis._canvasTemplate=null;\r\n\t\t/**@private */\r\n\t\tthis._emitter=null;\r\n\t\t/**是否自动播放*/\r\n\t\tthis.autoPlay=true;\r\n\t\tParticle2D.__super.call(this);\r\n\t\tif (setting)this.setParticleSetting(setting);\r\n\t}\r\n\r\n\t__class(Particle2D,'laya.particle.Particle2D',_super);\r\n\tvar __proto=Particle2D.prototype;\r\n\t/**\r\n\t*加载粒子文件\r\n\t*@param url 粒子文件地址\r\n\t*/\r\n\t__proto.load=function(url){\r\n\t\tLaya.loader.load(url,Handler.create(this,this.setParticleSetting),null,/*laya.net.Loader.JSON*/\"json\");\r\n\t}\r\n\r\n\t/**\r\n\t*设置粒子配置数据\r\n\t*@param settings 粒子配置数据\r\n\t*/\r\n\t__proto.setParticleSetting=function(setting){\r\n\t\tvar _$this=this;\r\n\t\tif (!setting)return this.stop();\r\n\t\tParticleSetting.checkSetting(setting);\r\n\t\tif(/*__JS__ */!window.ConchParticleTemplate2D||Render.isWebGL)this.customRenderEnable=true;\r\n\t\tif (Render.isWebGL){\r\n\t\t\tthis._particleTemplate=new ParticleTemplate2D(setting);\r\n\t\t\tthis.graphics._saveToCmd(Render.context._drawParticle,[this._particleTemplate]);\r\n\t\t}\r\n\t\telse if (Render.isConchApp&&/*__JS__ */window.ConchParticleTemplate2D){\r\n\t\t\tthis._particleTemplate=/*__JS__ */new ConchParticleTemplate2D();\r\n\t\t\tvar _this=this;\r\n\t\t\tLaya.loader.load(setting.textureName,Handler.create(null,function(texture){\r\n\t\t\t\t/*__JS__ */_this._particleTemplate.texture=texture;\r\n\t\t\t\t_this._particleTemplate.settings=setting;\r\n\t\t\t\tif (Render.isConchNode){\r\n\t\t\t\t\t/*__JS__ */_this.graphics.drawParticle(_this._particleTemplate);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\t_this.graphics._saveToCmd(Render.context._drawParticle,[_$this._particleTemplate]);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t\tthis._emitter={start:function (){}};\r\n\t\t\t/*__JS__ */this.play=this._particleTemplate.play.bind(this._particleTemplate);\r\n\t\t\t/*__JS__ */this.stop=this._particleTemplate.stop.bind(this._particleTemplate);\r\n\t\t\tif (this.autoPlay)this.play();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._particleTemplate=this._canvasTemplate=new ParticleTemplateCanvas(setting);\r\n\t\t}\r\n\t\tif (!this._emitter){\r\n\t\t\tthis._emitter=new Emitter2D(this._particleTemplate);\r\n\t\t\t}else {\r\n\t\t\t(this._emitter).template=this._particleTemplate;\r\n\t\t}\r\n\t\tif (this.autoPlay){\r\n\t\t\tthis.emitter.start();\r\n\t\t\tthis.play();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*播放\r\n\t*/\r\n\t__proto.play=function(){\r\n\t\tthis.timer.frameLoop(1,this,this._loop);\r\n\t}\r\n\r\n\t/**\r\n\t*停止\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis.timer.clear(this,this._loop);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._loop=function(){\r\n\t\tthis.advanceTime(1 / 60);\r\n\t}\r\n\r\n\t/**\r\n\t*时钟前进\r\n\t*@param passedTime 时钟前进时间\r\n\t*/\r\n\t__proto.advanceTime=function(passedTime){\r\n\t\t(passedTime===void 0)&& (passedTime=1);\r\n\t\tif (this._canvasTemplate){\r\n\t\t\tthis._canvasTemplate.advanceTime(passedTime);\r\n\t\t}\r\n\t\tif (this._emitter){\r\n\t\t\tthis._emitter.advanceTime(passedTime);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.customRender=function(context,x,y){\r\n\t\tif (Render.isWebGL){\r\n\t\t\tthis._matrix4[0]=context.ctx._curMat.a;\r\n\t\t\tthis._matrix4[1]=context.ctx._curMat.b;\r\n\t\t\tthis._matrix4[4]=context.ctx._curMat.c;\r\n\t\t\tthis._matrix4[5]=context.ctx._curMat.d;\r\n\t\t\tthis._matrix4[12]=context.ctx._curMat.tx;\r\n\t\t\tthis._matrix4[13]=context.ctx._curMat.ty;\r\n\t\t\tvar sv=(this._particleTemplate).sv;\r\n\t\t\tsv.u_mmat=this._matrix4;\r\n\t\t}\r\n\t\tif (this._canvasTemplate){\r\n\t\t\tthis._canvasTemplate.render(context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tif ((this._particleTemplate instanceof laya.particle.ParticleTemplate2D ))\r\n\t\t\t(this._particleTemplate).dispose();\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t}\r\n\r\n\t/**\r\n\t*设置 粒子文件地址\r\n\t*@param path 粒子文件地址\r\n\t*/\r\n\t__getset(0,__proto,'url',null,function(url){\r\n\t\tthis.load(url);\r\n\t});\r\n\r\n\t/**\r\n\t*获取粒子发射器\r\n\t*/\r\n\t__getset(0,__proto,'emitter',function(){\r\n\t\treturn this._emitter;\r\n\t});\r\n\r\n\treturn Particle2D;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.particle.shader.ParticleShader extends laya.webgl.shader.Shader\r\nvar ParticleShader=(function(_super){\r\n\tfunction ParticleShader(){\r\n\t\tParticleShader.__super.call(this,ParticleShader.vs,ParticleShader.ps,\"ParticleShader\");\r\n\t}\r\n\r\n\t__class(ParticleShader,'laya.particle.shader.ParticleShader',_super);\r\n\t__static(ParticleShader,\r\n\t['vs',function(){return this.vs=\"attribute vec4 a_CornerTextureCoordinate;\\nattribute vec3 a_Position;\\nattribute vec3 a_Velocity;\\nattribute vec4 a_StartColor;\\nattribute vec4 a_EndColor;\\nattribute vec3 a_SizeRotation;\\nattribute vec2 a_Radius;\\nattribute vec4 a_Radian;\\nattribute float a_AgeAddScale;\\nattribute float a_Time;\\n\\nvarying vec4 v_Color;\\nvarying vec2 v_TextureCoordinate;\\n\\nuniform float u_CurrentTime;\\nuniform float u_Duration;\\nuniform float u_EndVelocity;\\nuniform vec3 u_Gravity;\\n\\n#ifdef PARTICLE3D\\n uniform mat4 u_WorldMat;\\n uniform mat4 u_View;\\n uniform mat4 u_Projection;\\n uniform vec2 u_ViewportScale;\\n#else\\n uniform vec2 size;\\n uniform mat4 mmat;\\n uniform mat4 u_mmat;\\n#endif\\n\\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\\n{\\n\\n   float startVelocity = length(velocity);//起始标量速度\\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\\n\\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\\n   \\n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \\n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\\n   \\n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\\n   \\n   float r =cos(radianVertical)* radius;\\n   addPosition.y += sin(radianVertical) * radius;\\n\t\\n   addPosition.x += cos(radianHorizontal) *r;\\n   addPosition.z += sin(radianHorizontal) *r;\\n  \\n   #ifdef PARTICLE3D\\n   position+=addPosition;\\n    return  u_Projection*u_View*u_WorldMat*(vec4(position, 1.0));\\n   #else\\n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\\n   position+=addPosition;\\n    return  vec4(position,1.0);\\n   #endif\\n}\\n\\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\\n{    \\n    float size = mix(startSize, endSize, normalizedAge);\\n    \\n\t#ifdef PARTICLE3D\\n    //Project the size into screen coordinates.\\n     return size * u_Projection[1][1];\\n\t#else\\n\t return size;\\n\t#endif\\n}\\n\\nmat2 ComputeParticleRotation(in float rot,in float age)\\n{    \\n    float rotation =rot * age;\\n    //计算2x2旋转矩阵.\\n    float c = cos(rotation);\\n    float s = sin(rotation);\\n    return mat2(c, -s, s, c);\\n}\\n\\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\\n{\\n\tvec4 color=mix(startColor,endColor,normalizedAge);\\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\\n   \\n    return color;\\n}\\n\\nvoid main()\\n{\\n   float age = u_CurrentTime - a_Time;\\n   age *= 1.0 + a_AgeAddScale;\\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\\n\t\\n   #ifdef PARTICLE3D\\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize * u_ViewportScale;\\n   #else\\n    mat4 mat=u_mmat*mmat;\\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\\n\tgl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\\n   #endif\\n   \\n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\\n}\\n\\n\";},'ps',function(){return this.ps=\"#ifdef FSHIGHPRECISION\\nprecision highp float;\\n#else\\nprecision mediump float;\\n#endif\\n\\nvarying vec4 v_Color;\\nvarying vec2 v_TextureCoordinate;\\nuniform sampler2D u_texture;\\n\\nvoid main()\\n{\t\\n\tgl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\\n\tgl_FragColor.xyz *= v_Color.w;\\n}\";}\r\n\t]);\r\n\treturn ParticleShader;\r\n})(Shader)\r\n\r\n\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.particle.js?");

/***/ }),

/***/ "./bin/libs/laya.tiledmap.js":
/*!***********************************!*\
  !*** ./bin/libs/laya.tiledmap.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Browser=laya.utils.Browser,HTMLCanvas=laya.resource.HTMLCanvas,Handler=laya.utils.Handler,Loader=laya.net.Loader;\r\n\tvar Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext;\r\n\tvar Sprite=laya.display.Sprite,Texture=laya.resource.Texture;\r\n/**\r\n*tiledMap是整个地图的核心\r\n*地图以层级来划分地图（例如：地表层，植被层，建筑层）\r\n*每层又以分块（GridSprite)来处理显示对象，只显示在视口区域的区\r\n*每块又包括N*N个格子（tile)\r\n*格子类型又分为动画格子跟图片格子两种\r\n*@author ...\r\n*/\r\n//class laya.map.TiledMap\r\nvar TiledMap=(function(){\r\n\tvar GRect,TileMapAniData,TileSet;\r\n\tfunction TiledMap(){\r\n\t\t//json数据\r\n\t\tthis._jsonData=null;\r\n\t\t//存放地图中用到的所有子纹理数据\r\n\t\tthis._tileTexSetArr=[];\r\n\t\t//主纹理数据，主要在释放纹理资源时使用\r\n\t\tthis._texArray=[];\r\n\t\t//地图信息中的一些基本数据\r\n\t\tthis._x=0;\r\n\t\t//地图的坐标\r\n\t\tthis._y=0;\r\n\t\t//_height=_mapTileH *_mapH\r\n\t\tthis._width=0;\r\n\t\t//地图的宽度\r\n\t\tthis._height=0;\r\n\t\t//地图的高度\r\n\t\tthis._mapW=0;\r\n\t\t//地图的横向格子数\r\n\t\tthis._mapH=0;\r\n\t\t//地图的竖向格子数\r\n\t\tthis._mapTileW=0;\r\n\t\t//tile的宽度\r\n\t\tthis._mapTileH=0;\r\n\t\t//地图的显示对象\r\n\t\tthis._mapSprite=null;\r\n\t\t//地图的显示对象\r\n\t\tthis._layerArray=[];\r\n\t\t//这里保存所有的MapLayer对象\r\n\t\tthis._renderLayerArray=[];\r\n\t\t//这里保存需要渲染的MapLayer对象\r\n\t\tthis._gridArray=[];\r\n\t\t//地图块相关的\r\n\t\tthis._showGridKey=false;\r\n\t\t//是否显示块边界线（用来调试用）\r\n\t\tthis._totalGridNum=0;\r\n\t\t//一层中的GridSprite的总数\r\n\t\tthis._gridW=0;\r\n\t\t//地图的横向块数\r\n\t\tthis._gridH=0;\r\n\t\t//地图的坚向块数\r\n\t\tthis._gridWidth=450;\r\n\t\t//块的默认宽度\r\n\t\tthis._gridHeight=450;\r\n\t\t//块的默认高度\r\n\t\tthis._jsonLoader=null;\r\n\t\t//用来加载JSON文件用的LOADER\r\n\t\tthis._loader=null;\r\n\t\t//用来加载纹理数据用的LOADER\r\n\t\tthis._tileSetArray=[];\r\n\t\t//用来存放还需要哪些儿纹理等待加载\r\n\t\tthis._currTileSet=null;\r\n\t\t//正在加载的纹理需要的数据源\r\n\t\tthis._completeHandler=null;\r\n\t\t//上次视口显示的块范围\r\n\t\tthis._index=0;\r\n\t\tthis._animationDic={};\r\n\t\t//需要创建的动画数据\r\n\t\tthis._properties=null;\r\n\t\t//当前地图的自定义属性\r\n\t\tthis._tileProperties={};\r\n\t\t//图块属性\r\n\t\tthis._tileProperties2={};\r\n\t\t//默认的地图类型（具体要看JSON文件）\r\n\t\tthis._orientation=\"orthogonal\";\r\n\t\t//默认的tile渲染顺序（具体要看JSON文件）\r\n\t\tthis._renderOrder=\"right-down\";\r\n\t\t//调试用的颜色组合\r\n\t\tthis._colorArray=[\"FF\",\"00\",\"33\",\"66\"];\r\n\t\t//缩放相关的操作\r\n\t\tthis._scale=1;\r\n\t\tthis._pivotScaleX=0.5;\r\n\t\tthis._pivotScaleY=0.5;\r\n\t\tthis._centerX=0;\r\n\t\tthis._centerY=0;\r\n\t\t/**@private */\r\n\t\tthis._viewPortX=0;\r\n\t\t/**@private */\r\n\t\tthis._viewPortY=0;\r\n\t\tthis._viewPortWidth=0;\r\n\t\tthis._viewPortHeight=0;\r\n\t\t//是否开启线性取样\r\n\t\tthis._enableLinear=true;\r\n\t\t//资源的相对路径\r\n\t\tthis._resPath=null;\r\n\t\tthis._pathArray=null;\r\n\t\t//把地图限制在显示区域\r\n\t\tthis._limitRange=false;\r\n\t\t/**\r\n\t\t*快速更新模式是否不可用\r\n\t\t*/\r\n\t\tthis._fastDirty=true;\r\n\t\t/**\r\n\t\t*是否自动缓存没有动画的地块\r\n\t\t*/\r\n\t\tthis.autoCache=true;\r\n\t\t/**\r\n\t\t*自动缓存类型,地图较大时建议使用normal\r\n\t\t*/\r\n\t\tthis.autoCacheType=\"normal\";\r\n\t\t/**\r\n\t\t*是否合并图层,开启合并图层时，图层属性内可添加layer属性，运行时将会将相邻的layer属性相同的图层进行合并以提高性能\r\n\t\t*/\r\n\t\tthis.enableMergeLayer=false;\r\n\t\t/**\r\n\t\t*是否移除被覆盖的格子,地块可添加type属性，type不为0时表示不透明，被不透明地块遮挡的地块将会被剔除以提高性能\r\n\t\t*/\r\n\t\tthis.removeCoveredTile=false;\r\n\t\t/**\r\n\t\t*是否显示大格子里显示的贴图数量\r\n\t\t*/\r\n\t\tthis.showGridTextureCount=false;\r\n\t\t/**\r\n\t\t*是否调整地块边缘消除缩放导致的缝隙\r\n\t\t*/\r\n\t\tthis.antiCrack=true;\r\n\t\t/**\r\n\t\t*是否在加载完成之后cache所有大格子\r\n\t\t*/\r\n\t\tthis.cacheAllAfterInit=false;\r\n\t\tthis._texutreStartDic={};\r\n\t\tthis._rect=new Rectangle();\r\n\t\tthis._paddingRect=new Rectangle();\r\n\t\tthis._mapRect=new GRect();\r\n\t\tthis._mapLogicRect=new GRect();\r\n\t\tthis._mapLastRect=new GRect();\r\n\t\tthis._mapSprite=new Sprite();\r\n\t}\r\n\r\n\t__class(TiledMap,'laya.map.TiledMap');\r\n\tvar __proto=TiledMap.prototype;\r\n\t/**\r\n\t*创建地图\r\n\t*@param mapName JSON文件名字\r\n\t*@param viewRect 视口区域\r\n\t*@param completeHandler 地图创建完成的回调函数\r\n\t*@param viewRectPadding 视口扩充区域，把视口区域上、下、左、右扩充一下，防止视口移动时的穿帮\r\n\t*@param gridSize grid大小\r\n\t*@param enableLinear 是否开启线性取样（为false时，可以解决地图黑线的问题，但画质会锐化）\r\n\t*@param limitRange 把地图限制在显示区域\r\n\t*/\r\n\t__proto.createMap=function(mapName,viewRect,completeHandler,viewRectPadding,gridSize,enableLinear,limitRange){\r\n\t\t(enableLinear===void 0)&& (enableLinear=true);\r\n\t\t(limitRange===void 0)&& (limitRange=false);\r\n\t\tthis._enableLinear=enableLinear;\r\n\t\tthis._limitRange=limitRange;\r\n\t\tthis._rect.x=viewRect.x;\r\n\t\tthis._rect.y=viewRect.y;\r\n\t\tthis._rect.width=viewRect.width;\r\n\t\tthis._rect.height=viewRect.height;\r\n\t\tthis._viewPortWidth=viewRect.width / this._scale;\r\n\t\tthis._viewPortHeight=viewRect.height / this._scale;\r\n\t\tthis._completeHandler=completeHandler;\r\n\t\tif (viewRectPadding){\r\n\t\t\tthis._paddingRect.copyFrom(viewRectPadding);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._paddingRect.setTo(0,0,0,0);\r\n\t\t}\r\n\t\tif (gridSize){\r\n\t\t\tthis._gridWidth=gridSize.x;\r\n\t\t\tthis._gridHeight=gridSize.y;\r\n\t\t};\r\n\t\tvar tIndex=mapName.lastIndexOf(\"/\");\r\n\t\tif (tIndex >-1){\r\n\t\t\tthis._resPath=mapName.substr(0,tIndex);\r\n\t\t\tthis._pathArray=this._resPath.split(\"/\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._resPath=\"\";\r\n\t\t\tthis._pathArray=[];\r\n\t\t}\r\n\t\tthis._jsonLoader=new Loader();\r\n\t\tthis._jsonLoader.once(\"complete\",this,this.onJsonComplete);\r\n\t\tthis._jsonLoader.load(mapName,/*laya.net.Loader.JSON*/\"json\",false);\r\n\t}\r\n\r\n\t/**\r\n\t*json文件读取成功后，解析里面的纹理数据，进行加载\r\n\t*@param e JSON数据\r\n\t*/\r\n\t__proto.onJsonComplete=function(e){\r\n\t\tvar tJsonData=this._jsonData=e;\r\n\t\tthis._properties=tJsonData.properties;\r\n\t\tthis._orientation=tJsonData.orientation;\r\n\t\tthis._renderOrder=tJsonData.renderorder;\r\n\t\tthis._mapW=tJsonData.width;\r\n\t\tthis._mapH=tJsonData.height;\r\n\t\tthis._mapTileW=tJsonData.tilewidth;\r\n\t\tthis._mapTileH=tJsonData.tileheight;\r\n\t\tthis._width=this._mapTileW *this._mapW;\r\n\t\tthis._height=this._mapTileH *this._mapH;\r\n\t\tif (this._orientation==\"staggered\"){\r\n\t\t\tthis._height=(0.5+this._mapH *0.5)*this._mapTileH;\r\n\t\t}\r\n\t\tthis._mapLastRect.top=this._mapLastRect.bottom=this._mapLastRect.left=this._mapLastRect.right=-1;\r\n\t\tvar tArray=tJsonData.tilesets;\r\n\t\tvar tileset;\r\n\t\tvar tTileSet;\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < tArray.length;i++){\r\n\t\t\ttileset=tArray[i];\r\n\t\t\ttTileSet=new TileSet();\r\n\t\t\ttTileSet.init(tileset);\r\n\t\t\tif (tTileSet.properties && tTileSet.properties.ignore)continue ;\r\n\t\t\tthis._tileProperties[i]=tTileSet.tileproperties;\r\n\t\t\tthis.addTileProperties(tTileSet.tileproperties);\r\n\t\t\tthis._tileSetArray.push(tTileSet);\r\n\t\t\tvar tTiles=tileset.tiles;\r\n\t\t\tif (tTiles){\r\n\t\t\t\tfor (var p in tTiles){\r\n\t\t\t\t\tvar tAnimation=tTiles[p].animation;\r\n\t\t\t\t\tif (tAnimation){\r\n\t\t\t\t\t\tvar tAniData=new TileMapAniData();\r\n\t\t\t\t\t\tthis._animationDic[p]=tAniData;\r\n\t\t\t\t\t\ttAniData.image=tileset.image;\r\n\t\t\t\t\t\tfor (var j=0;j < tAnimation.length;j++){\r\n\t\t\t\t\t\t\tvar tAnimationItem=tAnimation[j];\r\n\t\t\t\t\t\t\ttAniData.mAniIdArray.push(tAnimationItem.tileid);\r\n\t\t\t\t\t\t\ttAniData.mDurationTimeArray.push(tAnimationItem.duration);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._tileTexSetArr.push(null);\r\n\t\tif (this._tileSetArray.length > 0){\r\n\t\t\ttTileSet=this._currTileSet=this._tileSetArray.shift();\r\n\t\t\tthis._loader=new Loader();\r\n\t\t\tthis._loader.once(\"complete\",this,this.onTextureComplete);\r\n\t\t\tvar tPath=this.mergePath(this._resPath,tTileSet.image);\r\n\t\t\tthis._loader.load(tPath,/*laya.net.Loader.IMAGE*/\"image\",false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*合并路径\r\n\t*@param resPath\r\n\t*@param relativePath\r\n\t*@return\r\n\t*/\r\n\t__proto.mergePath=function(resPath,relativePath){\r\n\t\tvar tResultPath=\"\";\r\n\t\tvar tImageArray=relativePath.split(\"/\");\r\n\t\tvar tParentPathNum=0;\r\n\t\tvar i=0;\r\n\t\tfor (i=tImageArray.length-1;i >=0;i--){\r\n\t\t\tif (tImageArray[i]==\"..\"){\r\n\t\t\t\ttParentPathNum++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tParentPathNum==0){\r\n\t\t\tif (this._pathArray.length > 0){\r\n\t\t\t\ttResultPath=resPath+\"/\"+relativePath;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttResultPath=relativePath;\r\n\t\t\t}\r\n\t\t\treturn tResultPath;\r\n\t\t};\r\n\t\tvar tSrcNum=this._pathArray.length-tParentPathNum;\r\n\t\tif (tSrcNum < 0){\r\n\t\t\tconsole.log(\"[error]path does not exist\",this._pathArray,tImageArray,resPath,relativePath);\r\n\t\t}\r\n\t\tfor (i=0;i < tSrcNum;i++){\r\n\t\t\tif (i==0){\r\n\t\t\t\ttResultPath+=this._pathArray[i];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttResultPath=tResultPath+\"/\"+this._pathArray[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=tParentPathNum;i < tImageArray.length;i++){\r\n\t\t\ttResultPath=tResultPath+\"/\"+tImageArray[i];\r\n\t\t}\r\n\t\treturn tResultPath;\r\n\t}\r\n\r\n\t/**\r\n\t*纹理加载完成，如果所有的纹理加载，开始初始化地图\r\n\t*@param e 纹理数据\r\n\t*/\r\n\t__proto.onTextureComplete=function(e){\r\n\t\tvar json=this._jsonData;\r\n\t\tvar tTexture=e;\r\n\t\tif (Render.isWebGL && (!this._enableLinear)){\r\n\t\t\ttTexture.bitmap.minFifter=0x2600;\r\n\t\t\ttTexture.bitmap.magFifter=0x2600;\r\n\t\t\ttTexture.bitmap.enableMerageInAtlas=false;\r\n\t\t}\r\n\t\tthis._texArray.push(tTexture);\r\n\t\tvar tSubTexture=null;\r\n\t\tvar tTileSet=this._currTileSet;\r\n\t\tvar tTileTextureW=tTileSet.tilewidth;\r\n\t\tvar tTileTextureH=tTileSet.tileheight;\r\n\t\tvar tImageWidth=tTileSet.imagewidth;\r\n\t\tvar tImageHeight=tTileSet.imageheight;\r\n\t\tvar tFirstgid=tTileSet.firstgid;\r\n\t\tvar tTileWNum=Math.floor((tImageWidth-tTileSet.margin-tTileTextureW)/ (tTileTextureW+tTileSet.spacing))+1;\r\n\t\tvar tTileHNum=Math.floor((tImageHeight-tTileSet.margin-tTileTextureH)/ (tTileTextureH+tTileSet.spacing))+1;\r\n\t\tvar tTileTexSet=null;\r\n\t\tthis._texutreStartDic[tTileSet.image]=this._tileTexSetArr.length;\r\n\t\tfor (var i=0;i < tTileHNum;i++){\r\n\t\t\tfor (var j=0;j < tTileWNum;j++){\r\n\t\t\t\ttTileTexSet=new TileTexSet();\r\n\t\t\t\ttTileTexSet.offX=tTileSet.titleoffsetX;\r\n\t\t\t\ttTileTexSet.offY=tTileSet.titleoffsetY-(tTileTextureH-this._mapTileH);\r\n\t\t\t\ttTileTexSet.texture=Texture.createFromTexture(tTexture,tTileSet.margin+(tTileTextureW+tTileSet.spacing)*j,tTileSet.margin+(tTileTextureH+tTileSet.spacing)*i,tTileTextureW,tTileTextureH);\r\n\t\t\t\tif(this.antiCrack)\r\n\t\t\t\t\tthis.adptTexture(tTileTexSet.texture);\r\n\t\t\t\tthis._tileTexSetArr.push(tTileTexSet);\r\n\t\t\t\ttTileTexSet.gid=this._tileTexSetArr.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._tileSetArray.length > 0){\r\n\t\t\ttTileSet=this._currTileSet=this._tileSetArray.shift();\r\n\t\t\tthis._loader.once(\"complete\",this,this.onTextureComplete);\r\n\t\t\tvar tPath=this.mergePath(this._resPath,tTileSet.image);\r\n\t\t\tthis._loader.load(tPath,/*laya.net.Loader.IMAGE*/\"image\",false);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._currTileSet=null;\r\n\t\t\tthis.initMap();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.adptTexture=function(tex){\r\n\t\tif (!tex)return;\r\n\t\tvar pX=tex.uv[0];\r\n\t\tvar pX1=tex.uv[2];\r\n\t\tvar pY=tex.uv[1];\r\n\t\tvar pY1=tex.uv[7];\r\n\t\tvar dW=1 / tex.bitmap.width;\r\n\t\tvar dH=1 / tex.bitmap.height;\r\n\t\ttex.uv[0]=tex.uv[6]=pX+dW;\r\n\t\ttex.uv[2]=tex.uv[4]=pX1-dW;\r\n\t\ttex.uv[1]=tex.uv[3]=pY+dH;\r\n\t\ttex.uv[5]=tex.uv[7]=pY1-dH;\r\n\t}\r\n\r\n\t/**\r\n\t*初始化地图\r\n\t*/\r\n\t__proto.initMap=function(){\r\n\t\tvar i=0,n=0;\r\n\t\tfor (var p in this._animationDic){\r\n\t\t\tvar tAniData=this._animationDic[p];\r\n\t\t\tvar gStart=0;\r\n\t\t\tgStart=this._texutreStartDic[tAniData.image];\r\n\t\t\tvar tTileTexSet=this.getTexture(parseInt(p)+gStart);\r\n\t\t\tif (tAniData.mAniIdArray.length > 0){\r\n\t\t\t\ttTileTexSet.textureArray=[];\r\n\t\t\t\ttTileTexSet.durationTimeArray=tAniData.mDurationTimeArray;\r\n\t\t\t\ttTileTexSet.isAnimation=true;\r\n\t\t\t\ttTileTexSet.animationTotalTime=0;\r\n\t\t\t\tfor (i=0,n=tTileTexSet.durationTimeArray.length;i < n;i++){\r\n\t\t\t\t\ttTileTexSet.animationTotalTime+=tTileTexSet.durationTimeArray[i];\r\n\t\t\t\t}\r\n\t\t\t\tfor (i=0,n=tAniData.mAniIdArray.length;i < n;i++){\r\n\t\t\t\t\tvar tTexture=this.getTexture(tAniData.mAniIdArray[i]+gStart);\r\n\t\t\t\t\ttTileTexSet.textureArray.push(tTexture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._gridWidth=Math.floor(this._gridWidth / this._mapTileW)*this._mapTileW;\r\n\t\tthis._gridHeight=Math.floor(this._gridHeight / this._mapTileH)*this._mapTileH;\r\n\t\tif (this._gridWidth < this._mapTileW){\r\n\t\t\tthis._gridWidth=this._mapTileW;\r\n\t\t}\r\n\t\tif (this._gridHeight < this._mapTileH){\r\n\t\t\tthis._gridHeight=this._mapTileH;\r\n\t\t}\r\n\t\tthis._gridW=Math.ceil(this._width / this._gridWidth);\r\n\t\tthis._gridH=Math.ceil(this._height / this._gridHeight);\r\n\t\tthis._totalGridNum=this._gridW *this._gridH;\r\n\t\tfor (i=0;i < this._gridH;i++){\r\n\t\t\tvar tGridArray=[];\r\n\t\t\tthis._gridArray.push(tGridArray);\r\n\t\t\tfor (var j=0;j < this._gridW;j++){\r\n\t\t\t\ttGridArray.push(null);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tLayerArray=this._jsonData.layers;\r\n\t\tvar isFirst=true;\r\n\t\tvar tTarLayerID=1;\r\n\t\tvar tLayerTarLayerName;\r\n\t\tvar preLayerTarName;\r\n\t\tvar preLayer;\r\n\t\tfor (var tLayerLoop=0;tLayerLoop < tLayerArray.length;tLayerLoop++){\r\n\t\t\tvar tLayerData=tLayerArray[tLayerLoop];\r\n\t\t\tif (tLayerData.visible==true){\r\n\t\t\t\tvar tMapLayer=new MapLayer();\r\n\t\t\t\ttMapLayer.init(tLayerData,this);\r\n\t\t\t\tif (!this.enableMergeLayer){\r\n\t\t\t\t\tthis._mapSprite.addChild(tMapLayer);\r\n\t\t\t\t\tthis._renderLayerArray.push(tMapLayer);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\ttLayerTarLayerName=tMapLayer.getLayerProperties(\"layer\");\r\n\t\t\t\t\tisFirst=isFirst || (!preLayer)|| (tLayerTarLayerName !=preLayerTarName);\r\n\t\t\t\t\tif (isFirst){\r\n\t\t\t\t\t\tisFirst=false;\r\n\t\t\t\t\t\ttMapLayer.tarLayer=tMapLayer;\r\n\t\t\t\t\t\tpreLayer=tMapLayer;\r\n\t\t\t\t\t\tthis._mapSprite.addChild(tMapLayer);\r\n\t\t\t\t\t\tthis._renderLayerArray.push(tMapLayer);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttMapLayer.tarLayer=preLayer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpreLayerTarName=tLayerTarLayerName;\r\n\t\t\t\t}\r\n\t\t\t\tthis._layerArray.push(tMapLayer);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.removeCoveredTile){\r\n\t\t\tthis.adptTiledMapData();\r\n\t\t}\r\n\t\tif (this.cacheAllAfterInit){\r\n\t\t\tthis.cacheAllGrid();\r\n\t\t}\r\n\t\tthis.moveViewPort(this._rect.x,this._rect.y);\r\n\t\tLaya.stage.addChild(this.mapSprite());\r\n\t\tif (this._completeHandler !=null){\r\n\t\t\tthis._completeHandler.run();\r\n\t\t}\r\n\t}\r\n\r\n\t//这里应该发送消息，通知上层，地图创建完成\r\n\t__proto.addTileProperties=function(tileDataDic){\r\n\t\tvar key;\r\n\t\tfor (key in tileDataDic){\r\n\t\t\tthis._tileProperties2[key]=tileDataDic[key];\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getTileUserData=function(id,sign,defaultV){\r\n\t\tif (!this._tileProperties2 || !this._tileProperties2[id] || !(sign in this._tileProperties2[id]))return defaultV;\r\n\t\treturn this._tileProperties2[id][sign];\r\n\t}\r\n\r\n\t__proto.adptTiledMapData=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=this._layerArray.length;\r\n\t\tvar tLayer;\r\n\t\tvar noNeeds={};\r\n\t\tvar tDatas;\r\n\t\tfor (i=len-1;i >=0;i--){\r\n\t\t\ttLayer=this._layerArray[i];\r\n\t\t\ttDatas=tLayer._mapData;\r\n\t\t\tif (!tDatas)continue ;\r\n\t\t\tthis.removeCoverd(tDatas,noNeeds);\r\n\t\t\tthis.collectCovers(tDatas,noNeeds,i);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.removeCoverd=function(datas,noNeeds){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=datas.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (noNeeds[i]){\r\n\t\t\t\tdatas[i]=0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.collectCovers=function(datas,noNeeds,layer){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=datas.length;\r\n\t\tvar tTileData=0;\r\n\t\tvar isCover=0;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttTileData=datas[i];\r\n\t\t\tif (tTileData > 0){\r\n\t\t\t\tisCover=this.getTileUserData(tTileData-1,\"type\",0);\r\n\t\t\t\tif (isCover > 0){\r\n\t\t\t\t\tnoNeeds[i]=tTileData;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*得到一块指定的地图纹理\r\n\t*@param index 纹理的索引值，默认从1开始\r\n\t*@return\r\n\t*/\r\n\t__proto.getTexture=function(index){\r\n\t\tif (index < this._tileTexSetArr.length){\r\n\t\t\treturn this._tileTexSetArr[index];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*得到地图的自定义属性\r\n\t*@param name 属性名称\r\n\t*@return\r\n\t*/\r\n\t__proto.getMapProperties=function(name){\r\n\t\tif (this._properties){\r\n\t\t\treturn this._properties[name];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*得到tile自定义属性\r\n\t*@param index 地图块索引\r\n\t*@param id 具体的TileSetID\r\n\t*@param name 属性名称\r\n\t*@return\r\n\t*/\r\n\t__proto.getTileProperties=function(index,id,name){\r\n\t\tif (this._tileProperties[index] && this._tileProperties[index][id]){\r\n\t\t\treturn this._tileProperties[index][id][name];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*通过纹理索引，生成一个可控制物件\r\n\t*@param index 纹理的索引值，默认从1开始\r\n\t*@return\r\n\t*/\r\n\t__proto.getSprite=function(index,width,height){\r\n\t\tif (0 < this._tileTexSetArr.length){\r\n\t\t\tvar tGridSprite=new GridSprite();\r\n\t\t\ttGridSprite.initData(this,true);\r\n\t\t\ttGridSprite.size(width,height);\r\n\t\t\tvar tTileTexSet=this._tileTexSetArr[index];\r\n\t\t\tif (tTileTexSet !=null && tTileTexSet.texture !=null){\r\n\t\t\t\tif (tTileTexSet.isAnimation){\r\n\t\t\t\t\tvar tAnimationSprite=new TileAniSprite();\r\n\t\t\t\t\tthis._index++;\r\n\t\t\t\t\ttAnimationSprite.setTileTextureSet(this._index.toString(),tTileTexSet);\r\n\t\t\t\t\ttGridSprite.addAniSprite(tAnimationSprite);\r\n\t\t\t\t\ttGridSprite.addChild(tAnimationSprite);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttGridSprite.graphics.drawTexture(tTileTexSet.texture,0,0,width,height);\r\n\t\t\t\t}\r\n\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t}\r\n\t\t\treturn tGridSprite;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*设置视口的缩放中心点（例如：scaleX=scaleY=0.5,就是以视口中心缩放）\r\n\t*@param scaleX\r\n\t*@param scaleY\r\n\t*/\r\n\t__proto.setViewPortPivotByScale=function(scaleX,scaleY){\r\n\t\tthis._pivotScaleX=scaleX;\r\n\t\tthis._pivotScaleY=scaleY;\r\n\t\tthis._fastDirty=true;\r\n\t}\r\n\r\n\t/**\r\n\t*移动视口\r\n\t*@param moveX 视口的坐标x\r\n\t*@param moveY 视口的坐标y\r\n\t*/\r\n\t__proto.moveViewPort=function(moveX,moveY){\r\n\t\tthis._x=-moveX;\r\n\t\tthis._y=-moveY;\r\n\t\tif (this._fastDirty){\r\n\t\t\tthis._rect.x=moveX;\r\n\t\t\tthis._rect.y=moveY;\r\n\t\t\tthis.updateViewPort();\r\n\t\t\t}else{\r\n\t\t\tvar dx=NaN,dy=NaN;\r\n\t\t\tdx=moveX-this._rect.x;\r\n\t\t\tdy=moveY-this._rect.y;\r\n\t\t\tthis._rect.x=moveX;\r\n\t\t\tthis._rect.y=moveY;\r\n\t\t\tthis.updateViewPortFast(dx,dy);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*改变视口大小\r\n\t*@param moveX 视口的坐标x\r\n\t*@param moveY 视口的坐标y\r\n\t*@param width 视口的宽\r\n\t*@param height 视口的高\r\n\t*/\r\n\t__proto.changeViewPort=function(moveX,moveY,width,height){\r\n\t\tif (moveX==this._rect.x && moveY==this._rect.y && width==this._rect.width && height==this._rect.height)return;\r\n\t\tif (width==this._rect.width && height==this._rect.height){\r\n\t\t\tthis.moveViewPort(moveX,moveY);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._fastDirty=true;\r\n\t\tthis._x=-moveX;\r\n\t\tthis._y=-moveY;\r\n\t\tthis._rect.x=moveX;\r\n\t\tthis._rect.y=moveY;\r\n\t\tthis._rect.width=width;\r\n\t\tthis._rect.height=height;\r\n\t\tthis._viewPortWidth=width / this._scale;\r\n\t\tthis._viewPortHeight=height / this._scale;\r\n\t\tthis.updateViewPort();\r\n\t}\r\n\r\n\t/**\r\n\t*在锚点的基础上计算，通过宽和高，重新计算视口\r\n\t*@param width 新视口宽\r\n\t*@param height 新视口高\r\n\t*@param rect 返回的结果\r\n\t*@return\r\n\t*/\r\n\t__proto.changeViewPortBySize=function(width,height,rect){\r\n\t\tif (rect==null){\r\n\t\t\trect=new Rectangle();\r\n\t\t}\r\n\t\tthis._centerX=this._rect.x+this._rect.width *this._pivotScaleX;\r\n\t\tthis._centerY=this._rect.y+this._rect.height *this._pivotScaleY;\r\n\t\trect.x=this._centerX-width *this._pivotScaleX;\r\n\t\trect.y=this._centerY-height *this._pivotScaleY;\r\n\t\trect.width=width;\r\n\t\trect.height=height;\r\n\t\tthis.changeViewPort(rect.x,rect.y,rect.width,rect.height);\r\n\t\treturn rect;\r\n\t}\r\n\r\n\t/**\r\n\t*快速更新视口 ,只有在视口大小和各种缩放信息没有改变时才可以使用这个函数更新\r\n\t*@param dx 视口偏移x\r\n\t*@param dy 视口偏移y\r\n\t*/\r\n\t__proto.updateViewPortFast=function(dx,dy){\r\n\t\tthis._centerX+=dx;\r\n\t\tthis._centerY+=dy;\r\n\t\tthis._viewPortX+=dx;\r\n\t\tthis._viewPortY+=dy;\r\n\t\tvar posChanged=false;\r\n\t\tvar dyG=dy / this._gridHeight;\r\n\t\tvar dxG=dx / this._gridWidth;\r\n\t\tthis._mapLogicRect.top+=dyG;\r\n\t\tthis._mapLogicRect.bottom+=dyG;\r\n\t\tthis._mapLogicRect.left+=dxG;\r\n\t\tthis._mapLogicRect.right+=dxG;\r\n\t\tthis._mapRect.top=0|this._mapLogicRect.top;\r\n\t\tthis._mapRect.bottom=0|this._mapLogicRect.bottom;\r\n\t\tthis._mapRect.left=0|this._mapLogicRect.left;\r\n\t\tthis._mapRect.right=0|this._mapLogicRect.right;\r\n\t\tif (this._mapRect.top !=this._mapLastRect.top || this._mapRect.bottom !=this._mapLastRect.bottom || this._mapRect.left !=this._mapLastRect.left || this._mapRect.right !=this._mapLastRect.right){\r\n\t\t\tthis.clipViewPort();\r\n\t\t\tthis._mapLastRect.top=this._mapRect.top;\r\n\t\t\tthis._mapLastRect.bottom=this._mapRect.bottom;\r\n\t\t\tthis._mapLastRect.left=this._mapRect.left;\r\n\t\t\tthis._mapLastRect.right=this._mapRect.right;\r\n\t\t\tposChanged=true;\r\n\t\t};posChanged=posChanged|| (dx !=0 || dy !=0);\r\n\t\tif (!posChanged)return;\r\n\t\tthis.updateMapLayersPos();\r\n\t}\r\n\r\n\t/**\r\n\t*刷新地图层坐标\r\n\t*/\r\n\t__proto.updateMapLayersPos=function(){\r\n\t\tvar tMapLayer;\r\n\t\tvar len=this._renderLayerArray.length;\r\n\t\tfor (var i=0;i < len;i++){\r\n\t\t\ttMapLayer=this._renderLayerArray[i];\r\n\t\t\tif (tMapLayer._gridSpriteArray.length > 0){\r\n\t\t\t\ttMapLayer.updateAloneObject();\r\n\t\t\t\ttMapLayer.pos(-this._viewPortX,-this._viewPortY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*刷新视口\r\n\t*/\r\n\t__proto.updateViewPort=function(){\r\n\t\tthis._fastDirty=false;\r\n\t\tvar dw=this._rect.width *this._pivotScaleX;\r\n\t\tvar dh=this._rect.height *this._pivotScaleY;\r\n\t\tthis._centerX=this._rect.x+dw;\r\n\t\tthis._centerY=this._rect.y+dh;\r\n\t\tvar posChanged=false;\r\n\t\tvar preValue=this._viewPortX;\r\n\t\tthis._viewPortX=this._centerX-dw / this._scale;\r\n\t\tif (preValue !=this._viewPortX){\r\n\t\t\tposChanged=true;\r\n\t\t\t}else {\r\n\t\t\tpreValue=this._viewPortY;\r\n\t\t}\r\n\t\tthis._viewPortY=this._centerY-dh/ this._scale;\r\n\t\tif (!posChanged && preValue !=this._viewPortY){\r\n\t\t\tposChanged=true;\r\n\t\t}\r\n\t\tif (this._limitRange){\r\n\t\t\tvar tRight=this._viewPortX+this._viewPortWidth;\r\n\t\t\tif (tRight > this._width){\r\n\t\t\t\tthis._viewPortX=this._width-this._viewPortWidth;\r\n\t\t\t};\r\n\t\t\tvar tBottom=this._viewPortY+this._viewPortHeight;\r\n\t\t\tif (tBottom > this._height){\r\n\t\t\t\tthis._viewPortY=this._height-this._viewPortHeight;\r\n\t\t\t}\r\n\t\t\tif (this._viewPortX < 0){\r\n\t\t\t\tthis._viewPortX=0;\r\n\t\t\t}\r\n\t\t\tif (this._viewPortY < 0){\r\n\t\t\t\tthis._viewPortY=0;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tPaddingRect=this._paddingRect;\r\n\t\tthis._mapLogicRect.top=(this._viewPortY-tPaddingRect.y)/ this._gridHeight;\r\n\t\tthis._mapLogicRect.bottom=(this._viewPortY+this._viewPortHeight+tPaddingRect.height+tPaddingRect.y)/ this._gridHeight;\r\n\t\tthis._mapLogicRect.left=(this._viewPortX-tPaddingRect.x)/ this._gridWidth;\r\n\t\tthis._mapLogicRect.right=(this._viewPortX+this._viewPortWidth+tPaddingRect.width+tPaddingRect.x)/ this._gridWidth;\r\n\t\tthis._mapRect.top=0|this._mapLogicRect.top;\r\n\t\tthis._mapRect.bottom=0|this._mapLogicRect.bottom;\r\n\t\tthis._mapRect.left=0|this._mapLogicRect.left;\r\n\t\tthis._mapRect.right=0|this._mapLogicRect.right;\r\n\t\tif (this._mapRect.top !=this._mapLastRect.top || this._mapRect.bottom !=this._mapLastRect.bottom || this._mapRect.left !=this._mapLastRect.left || this._mapRect.right !=this._mapLastRect.right){\r\n\t\t\tthis.clipViewPort();\r\n\t\t\tthis._mapLastRect.top=this._mapRect.top;\r\n\t\t\tthis._mapLastRect.bottom=this._mapRect.bottom;\r\n\t\t\tthis._mapLastRect.left=this._mapRect.left;\r\n\t\t\tthis._mapLastRect.right=this._mapRect.right;\r\n\t\t\tposChanged=true;\r\n\t\t}\r\n\t\tif (!posChanged)return;\r\n\t\tthis.updateMapLayersPos();\r\n\t}\r\n\r\n\t/**\r\n\t*GRID裁剪\r\n\t*/\r\n\t__proto.clipViewPort=function(){\r\n\t\tvar tSpriteNum=0;\r\n\t\tvar tSprite;\r\n\t\tvar tIndex=0;\r\n\t\tvar tSub=0;\r\n\t\tvar tAdd=0;\r\n\t\tvar i=0,j=0;\r\n\t\tif (this._mapRect.left > this._mapLastRect.left){\r\n\t\t\ttSub=this._mapRect.left-this._mapLastRect.left;\r\n\t\t\tif (tSub > 0){\r\n\t\t\t\tfor (j=this._mapLastRect.left;j < this._mapLastRect.left+tSub;j++){\r\n\t\t\t\t\tfor (i=this._mapLastRect.top;i <=this._mapLastRect.bottom;i++){\r\n\t\t\t\t\t\tthis.hideGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttAdd=Math.min(this._mapLastRect.left,this._mapRect.right+1)-this._mapRect.left;\r\n\t\t\tif (tAdd > 0){\r\n\t\t\t\tfor (j=this._mapRect.left;j < this._mapRect.left+tAdd;j++){\r\n\t\t\t\t\tfor (i=this._mapRect.top;i <=this._mapRect.bottom;i++){\r\n\t\t\t\t\t\tthis.showGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._mapRect.right > this._mapLastRect.right){\r\n\t\t\ttAdd=this._mapRect.right-this._mapLastRect.right;\r\n\t\t\tif (tAdd > 0){\r\n\t\t\t\tfor (j=Math.max(this._mapLastRect.right+1,this._mapRect.left);j <=this._mapLastRect.right+tAdd;j++){\r\n\t\t\t\t\tfor (i=this._mapRect.top;i <=this._mapRect.bottom;i++){\r\n\t\t\t\t\t\tthis.showGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttSub=this._mapLastRect.right-this._mapRect.right\r\n\t\t\tif (tSub > 0){\r\n\t\t\t\tfor (j=this._mapRect.right+1;j <=this._mapRect.right+tSub;j++){\r\n\t\t\t\t\tfor (i=this._mapLastRect.top;i <=this._mapLastRect.bottom;i++){\r\n\t\t\t\t\t\tthis.hideGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._mapRect.top > this._mapLastRect.top){\r\n\t\t\ttSub=this._mapRect.top-this._mapLastRect.top;\r\n\t\t\tif (tSub > 0){\r\n\t\t\t\tfor (i=this._mapLastRect.top;i < this._mapLastRect.top+tSub;i++){\r\n\t\t\t\t\tfor (j=this._mapLastRect.left;j <=this._mapLastRect.right;j++){\r\n\t\t\t\t\t\tthis.hideGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttAdd=Math.min(this._mapLastRect.top,this._mapRect.bottom+1)-this._mapRect.top;\r\n\t\t\tif (tAdd > 0){\r\n\t\t\t\tfor (i=this._mapRect.top;i < this._mapRect.top+tAdd;i++){\r\n\t\t\t\t\tfor (j=this._mapRect.left;j <=this._mapRect.right;j++){\r\n\t\t\t\t\t\tthis.showGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._mapRect.bottom > this._mapLastRect.bottom){\r\n\t\t\ttAdd=this._mapRect.bottom-this._mapLastRect.bottom;\r\n\t\t\tif (tAdd > 0){\r\n\t\t\t\tfor (i=Math.max(this._mapLastRect.bottom+1,this._mapRect.top);i <=this._mapLastRect.bottom+tAdd;i++){\r\n\t\t\t\t\tfor (j=this._mapRect.left;j <=this._mapRect.right;j++){\r\n\t\t\t\t\t\tthis.showGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttSub=this._mapLastRect.bottom-this._mapRect.bottom\r\n\t\t\tif (tSub > 0){\r\n\t\t\t\tfor (i=this._mapRect.bottom+1;i <=this._mapRect.bottom+tSub;i++){\r\n\t\t\t\t\tfor (j=this._mapLastRect.left;j <=this._mapLastRect.right;j++){\r\n\t\t\t\t\t\tthis.hideGrid(j,i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*显示指定的GRID\r\n\t*@param gridX\r\n\t*@param gridY\r\n\t*/\r\n\t__proto.showGrid=function(gridX,gridY){\r\n\t\tif (gridX < 0 || gridX >=this._gridW || gridY < 0 || gridY >=this._gridH){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar i=0,j=0;\r\n\t\tvar tGridSprite;\r\n\t\tvar tTempArray=this._gridArray[gridY][gridX];\r\n\t\tif (tTempArray==null){\r\n\t\t\ttTempArray=this.getGridArray(gridX,gridY);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor (i=0;i < tTempArray.length && i < this._layerArray.length;i++){\r\n\t\t\t\tvar tLayerSprite=this._layerArray[i];\r\n\t\t\t\tif (tLayerSprite && tTempArray[i]){\r\n\t\t\t\t\ttGridSprite=tTempArray[i];\r\n\t\t\t\t\tif (tGridSprite.visible==false && tGridSprite.drawImageNum > 0){\r\n\t\t\t\t\t\ttGridSprite.show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.cacheAllGrid=function(){\r\n\t\tvar i=0,j=0;\r\n\t\tvar tempArr;\r\n\t\tfor (i=0;i < this._gridW;i++){\r\n\t\t\tfor (j=0;j < this._gridH;j++){\r\n\t\t\t\ttempArr=this.getGridArray(i,j);\r\n\t\t\t\tthis.cacheGridsArray(tempArr);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.cacheGridsArray=function(arr){\r\n\t\tvar canvas;\r\n\t\tif (!TiledMap._tempContext){\r\n\t\t\tTiledMap._tempContext=new RenderContext(1,1,HTMLCanvas.create(/*laya.resource.HTMLCanvas.TYPEAUTO*/\"AUTO\"));\r\n\t\t}\r\n\t\tcanvas=TiledMap._tempContext.canvas;\r\n\t\tcanvas.context.asBitmap=false;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tvar tGrid;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttGrid=arr[i];\r\n\t\t\tcanvas.clear();\r\n\t\t\tcanvas.size(1,1);\r\n\t\t\ttGrid.render(TiledMap._tempContext,0,0);\r\n\t\t\ttGrid.hide();\r\n\t\t}\r\n\t\tcanvas.clear();\r\n\t\tcanvas.size(1,1);\r\n\t}\r\n\r\n\t__proto.getGridArray=function(gridX,gridY){\r\n\t\tvar i=0,j=0;\r\n\t\tvar tGridSprite;\r\n\t\tvar tTempArray=this._gridArray[gridY][gridX];\r\n\t\tif (tTempArray==null){\r\n\t\t\ttTempArray=this._gridArray[gridY][gridX]=[];\r\n\t\t\tvar tLeft=0;\r\n\t\t\tvar tRight=0;\r\n\t\t\tvar tTop=0;\r\n\t\t\tvar tBottom=0;\r\n\t\t\tvar tGridWidth=this._gridWidth;\r\n\t\t\tvar tGridHeight=this._gridHeight;\r\n\t\t\tswitch (this.orientation){\r\n\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":\r\n\t\t\t\t\ttLeft=Math.floor(gridX *tGridWidth);\r\n\t\t\t\t\ttRight=Math.floor(gridX *tGridWidth+tGridWidth);\r\n\t\t\t\t\ttTop=Math.floor(gridY *tGridHeight);\r\n\t\t\t\t\ttBottom=Math.floor(gridY *tGridHeight+tGridHeight);\r\n\t\t\t\t\tvar tLeft1=0,tRight1=0,tTop1=0,tBottom1=0;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\t\ttLeft=Math.floor(gridX *tGridWidth / this._mapTileW);\r\n\t\t\t\t\ttRight=Math.floor((gridX *tGridWidth+tGridWidth)/ this._mapTileW);\r\n\t\t\t\t\ttTop=Math.floor(gridY *tGridHeight / (this._mapTileH / 2));\r\n\t\t\t\t\ttBottom=Math.floor((gridY *tGridHeight+tGridHeight)/ (this._mapTileH / 2));\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\t\ttLeft=Math.floor(gridX *tGridWidth / this._mapTileW);\r\n\t\t\t\t\ttRight=Math.floor((gridX *tGridWidth+tGridWidth)/ this._mapTileW);\r\n\t\t\t\t\ttTop=Math.floor(gridY *tGridHeight / this._mapTileH);\r\n\t\t\t\t\ttBottom=Math.floor((gridY *tGridHeight+tGridHeight)/ this._mapTileH);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":;\r\n\t\t\t\t\tvar tHeight=this._mapTileH *2 / 3;\r\n\t\t\t\t\ttLeft=Math.floor(gridX *tGridWidth / this._mapTileW);\r\n\t\t\t\t\ttRight=Math.ceil((gridX *tGridWidth+tGridWidth)/ this._mapTileW);\r\n\t\t\t\t\ttTop=Math.floor(gridY *tGridHeight / tHeight);\r\n\t\t\t\t\ttBottom=Math.ceil((gridY *tGridHeight+tGridHeight)/ tHeight);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t};\r\n\t\t\tvar tLayer=null;\r\n\t\t\tvar tTGridSprite;\r\n\t\t\tvar tDrawMapLayer;\r\n\t\t\tfor (var z=0;z < this._layerArray.length;z++){\r\n\t\t\t\ttLayer=this._layerArray[z];\r\n\t\t\t\tif (this.enableMergeLayer){\r\n\t\t\t\t\tif (tLayer.tarLayer !=tDrawMapLayer){\r\n\t\t\t\t\t\ttTGridSprite=null;\r\n\t\t\t\t\t\ttDrawMapLayer=tLayer.tarLayer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!tTGridSprite){\r\n\t\t\t\t\t\ttTGridSprite=tDrawMapLayer.getDrawSprite(gridX,gridY);\r\n\t\t\t\t\t\ttTempArray.push(tTGridSprite);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttGridSprite=tTGridSprite;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttGridSprite=tLayer.getDrawSprite(gridX,gridY);\r\n\t\t\t\t\ttTempArray.push(tGridSprite);\r\n\t\t\t\t};\r\n\t\t\t\tvar tColorStr;\r\n\t\t\t\tif (this._showGridKey){\r\n\t\t\t\t\ttColorStr=\"#\";\r\n\t\t\t\t\ttColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];\r\n\t\t\t\t\ttColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];\r\n\t\t\t\t\ttColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];\r\n\t\t\t\t}\r\n\t\t\t\tswitch (this.orientation){\r\n\t\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":;\r\n\t\t\t\t\t\tvar tHalfTileHeight=this.tileHeight / 2;\r\n\t\t\t\t\t\tvar tHalfTileWidth=this.tileWidth / 2;\r\n\t\t\t\t\t\tvar tHalfMapWidth=this._width / 2;\r\n\t\t\t\t\t\ttTop1=Math.floor(tTop / tHalfTileHeight);\r\n\t\t\t\t\t\ttBottom1=Math.floor(tBottom / tHalfTileHeight);\r\n\t\t\t\t\t\ttLeft1=this._mapW+Math.floor((tLeft-tHalfMapWidth)/ tHalfTileWidth);\r\n\t\t\t\t\t\ttRight1=this._mapW+Math.floor((tRight-tHalfMapWidth)/ tHalfTileWidth);\r\n\t\t\t\t\t\tvar tMapW=this._mapW *2;\r\n\t\t\t\t\t\tvar tMapH=this._mapH *2;\r\n\t\t\t\t\t\tif (tTop1 < 0){\r\n\t\t\t\t\t\t\ttTop1=0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tTop1 >=tMapH){\r\n\t\t\t\t\t\t\ttTop1=tMapH-1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tBottom1 < 0){\r\n\t\t\t\t\t\t\ttBottom=0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tBottom1 >=tMapH){\r\n\t\t\t\t\t\t\ttBottom1=tMapH-1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttGridSprite.zOrder=this._totalGridNum *z+gridY *this._gridW+gridX;\r\n\t\t\t\t\t\tfor (i=tTop1;i < tBottom1;i++){\r\n\t\t\t\t\t\t\tfor (j=0;j <=i;j++){\r\n\t\t\t\t\t\t\t\tvar tIndexX=i-j;\r\n\t\t\t\t\t\t\t\tvar tIndexY=j;\r\n\t\t\t\t\t\t\t\tvar tIndexValue=(tIndexX-tIndexY)+this._mapW;\r\n\t\t\t\t\t\t\t\tif (tIndexValue > tLeft1 && tIndexValue <=tRight1){\r\n\t\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,tIndexX,tIndexY)){\r\n\t\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\t\t\ttGridSprite.zOrder=z *this._totalGridNum+gridY *this._gridW+gridX;\r\n\t\t\t\t\t\tfor (i=tTop;i < tBottom;i++){\r\n\t\t\t\t\t\t\tfor (j=tLeft;j < tRight;j++){\r\n\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,j,i)){\r\n\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\t\tcase /*CLASS CONST:laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":\r\n\t\t\t\t\tswitch (this._renderOrder){\r\n\t\t\t\t\t\tcase \"right-down\":\r\n\t\t\t\t\t\t\ttGridSprite.zOrder=z *this._totalGridNum+gridY *this._gridW+gridX;\r\n\t\t\t\t\t\t\tfor (i=tTop;i < tBottom;i++){\r\n\t\t\t\t\t\t\t\tfor (j=tLeft;j < tRight;j++){\r\n\t\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,j,i)){\r\n\t\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\tcase \"right-up\":\r\n\t\t\t\t\t\t\ttGridSprite.zOrder=z *this._totalGridNum+(this._gridH-1-gridY)*this._gridW+gridX;\r\n\t\t\t\t\t\t\tfor (i=tBottom-1;i >=tTop;i--){\r\n\t\t\t\t\t\t\t\tfor (j=tLeft;j < tRight;j++){\r\n\t\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,j,i)){\r\n\t\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\tcase \"left-down\":\r\n\t\t\t\t\t\t\ttGridSprite.zOrder=z *this._totalGridNum+gridY *this._gridW+(this._gridW-1-gridX);\r\n\t\t\t\t\t\t\tfor (i=tTop;i < tBottom;i++){\r\n\t\t\t\t\t\t\t\tfor (j=tRight-1;j >=tLeft;j--){\r\n\t\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,j,i)){\r\n\t\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\tcase \"left-up\":\r\n\t\t\t\t\t\t\ttGridSprite.zOrder=z *this._totalGridNum+(this._gridH-1-gridY)*this._gridW+(this._gridW-1-gridX);\r\n\t\t\t\t\t\t\tfor (i=tBottom-1;i >=tTop;i--){\r\n\t\t\t\t\t\t\t\tfor (j=tRight-1;j >=tLeft;j--){\r\n\t\t\t\t\t\t\t\t\tif (tLayer.drawTileTexture(tGridSprite,j,i)){\r\n\t\t\t\t\t\t\t\t\t\ttGridSprite.drawImageNum++;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!tGridSprite.isHaveAnimation){\r\n\t\t\t\t\ttGridSprite.autoSize=true;\r\n\t\t\t\t\tif (this.autoCache)\r\n\t\t\t\t\t\ttGridSprite.cacheAs=this.autoCacheType;\r\n\t\t\t\t\ttGridSprite.autoSize=false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.enableMergeLayer){\r\n\t\t\t\t\tif (tGridSprite.drawImageNum > 0){\r\n\t\t\t\t\t\ttLayer.addChild(tGridSprite);\r\n\t\t\t\t\t\ttGridSprite.visible=false;\r\n\t\t\t\t\t\ttGridSprite.show();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this._showGridKey){\r\n\t\t\t\t\t\ttGridSprite.graphics.drawRect(0,0,tGridWidth,tGridHeight,null,tColorStr);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tif (tTGridSprite && tTGridSprite.drawImageNum > 0&&tDrawMapLayer){\r\n\t\t\t\t\t\ttDrawMapLayer.addChild(tTGridSprite);\r\n\t\t\t\t\t\ttTGridSprite.visible=false;\r\n\t\t\t\t\t\ttTGridSprite.show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.enableMergeLayer&&this.showGridTextureCount){\r\n\t\t\t\tif (tTGridSprite){\r\n\t\t\t\t\ttTGridSprite.graphics.fillText(tTGridSprite.drawImageNum+\"\",20,20,null,\"#ff0000\",\"left\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tTempArray;\r\n\t}\r\n\r\n\t/**\r\n\t*隐藏指定的GRID\r\n\t*@param gridX\r\n\t*@param gridY\r\n\t*/\r\n\t__proto.hideGrid=function(gridX,gridY){\r\n\t\tif (gridX < 0 || gridX >=this._gridW || gridY < 0 || gridY >=this._gridH){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tTempArray=this._gridArray[gridY][gridX];\r\n\t\tif (tTempArray){\r\n\t\t\tvar tGridSprite;\r\n\t\t\tfor (var i=0;i < tTempArray.length;i++){\r\n\t\t\t\ttGridSprite=tTempArray[i];\r\n\t\t\t\tif (tGridSprite.drawImageNum > 0){\r\n\t\t\t\t\tif (tGridSprite !=null){\r\n\t\t\t\t\t\ttGridSprite.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*得到对象层上的某一个物品\r\n\t*@param layerName 层的名称\r\n\t*@param objectName 所找物品的名称\r\n\t*@return\r\n\t*/\r\n\t__proto.getLayerObject=function(layerName,objectName){\r\n\t\tvar tLayer=null;\r\n\t\tfor (var i=0;i < this._layerArray.length;i++){\r\n\t\t\ttLayer=this._layerArray[i];\r\n\t\t\tif (tLayer.layerName==layerName){\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tLayer){\r\n\t\t\treturn tLayer.getObjectByName(objectName);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*销毁地图\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis._orientation=\"orthogonal\";\r\n\t\tthis._jsonData=null;\r\n\t\tvar i=0;\r\n\t\tvar j=0;\r\n\t\tvar z=0;\r\n\t\tthis._gridArray=[];\r\n\t\tvar tTileTexSet;\r\n\t\tfor (i=0;i < this._tileTexSetArr.length;i++){\r\n\t\t\ttTileTexSet=this._tileTexSetArr[i];\r\n\t\t\tif (tTileTexSet){\r\n\t\t\t\ttTileTexSet.clearAll();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._tileTexSetArr=[];\r\n\t\tvar tTexture;\r\n\t\tfor (i=0;i < this._texArray.length;i++){\r\n\t\t\ttTexture=this._texArray[i];\r\n\t\t\ttTexture.destroy();\r\n\t\t}\r\n\t\tthis._texArray=[];\r\n\t\tthis._width=0;\r\n\t\tthis._height=0;\r\n\t\tthis._mapW=0;\r\n\t\tthis._mapH=0;\r\n\t\tthis._mapTileW=0;\r\n\t\tthis._mapTileH=0;\r\n\t\tthis._rect.setTo(0,0,0,0);\r\n\t\tvar tLayer;\r\n\t\tfor (i=0;i < this._layerArray.length;i++){\r\n\t\t\ttLayer=this._layerArray[i];\r\n\t\t\ttLayer.clearAll();\r\n\t\t}\r\n\t\tthis._layerArray=[];\r\n\t\tthis._renderLayerArray=[];\r\n\t\tif (this._mapSprite){\r\n\t\t\tthis._mapSprite.destroy();\r\n\t\t\tthis._mapSprite=null;\r\n\t\t}\r\n\t\tthis._jsonLoader=null;\r\n\t\tthis._loader=null;\r\n\t\tvar tDic=this._animationDic;\r\n\t\tfor (var p in tDic){\r\n\t\t\tdelete tDic[p];\r\n\t\t}\r\n\t\tthis._properties=null;\r\n\t\ttDic=this._tileProperties;\r\n\t\tfor (p in tDic){\r\n\t\t\tdelete tDic[p];\r\n\t\t}\r\n\t\tthis._currTileSet=null;\r\n\t\tthis._completeHandler=null;\r\n\t\tthis._mapRect.clearAll();\r\n\t\tthis._mapLastRect.clearAll();\r\n\t\tthis._tileSetArray=[];\r\n\t\tthis._gridWidth=450;\r\n\t\tthis._gridHeight=450;\r\n\t\tthis._gridW=0;\r\n\t\tthis._gridH=0;\r\n\t\tthis._x=0;\r\n\t\tthis._y=0;\r\n\t\tthis._index=0;\r\n\t\tthis._enableLinear=true;\r\n\t\tthis._resPath=null;\r\n\t\tthis._pathArray=null;\r\n\t}\r\n\r\n\t/**\r\n\t*整个地图的显示容器\r\n\t*@return 地图的显示容器\r\n\t*/\r\n\t__proto.mapSprite=function(){\r\n\t\treturn this._mapSprite;\r\n\t}\r\n\r\n\t/**\r\n\t*得到指定的MapLayer\r\n\t*@param layerName 要找的层名称\r\n\t*@return\r\n\t*/\r\n\t__proto.getLayerByName=function(layerName){\r\n\t\tvar tMapLayer;\r\n\t\tfor (var i=0;i < this._layerArray.length;i++){\r\n\t\t\ttMapLayer=this._layerArray[i];\r\n\t\t\tif (layerName==tMapLayer.layerName){\r\n\t\t\t\treturn tMapLayer;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*通过索引得MapLayer\r\n\t*@param index 要找的层索引\r\n\t*@return\r\n\t*/\r\n\t__proto.getLayerByIndex=function(index){\r\n\t\tif (index < this._layerArray.length){\r\n\t\t\treturn this._layerArray[index];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*当前地图类型\r\n\t*/\r\n\t__getset(0,__proto,'orientation',function(){\r\n\t\treturn this._orientation;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*视口x坐标\r\n\t*/\r\n\t__getset(0,__proto,'viewPortX',function(){\r\n\t\treturn-this._viewPortX;\r\n\t});\r\n\r\n\t/**\r\n\t*设置地图缩放\r\n\t*@param scale\r\n\t*/\r\n\t/**\r\n\t*得到当前地图的缩放\r\n\t*/\r\n\t__getset(0,__proto,'scale',function(){\r\n\t\treturn this._scale;\r\n\t\t},function(scale){\r\n\t\tif (scale <=0)\r\n\t\t\treturn;\r\n\t\tthis._scale=scale;\r\n\t\tthis._viewPortWidth=this._rect.width / scale;\r\n\t\tthis._viewPortHeight=this._rect.height / scale;\r\n\t\tthis._mapSprite.scale(this._scale,this._scale);\r\n\t\tthis.updateViewPort();\r\n\t});\r\n\r\n\t/**\r\n\t*格子的宽度\r\n\t*/\r\n\t__getset(0,__proto,'tileWidth',function(){\r\n\t\treturn this._mapTileW;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*视口的y坐标\r\n\t*/\r\n\t__getset(0,__proto,'viewPortY',function(){\r\n\t\treturn-this._viewPortY;\r\n\t});\r\n\r\n\t/**\r\n\t*格子的高度\r\n\t*/\r\n\t__getset(0,__proto,'tileHeight',function(){\r\n\t\treturn this._mapTileH;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的宽度\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\treturn this._width;\r\n\t});\r\n\r\n\t/**\r\n\t*地图竖向的格子数\r\n\t*/\r\n\t__getset(0,__proto,'numRowsTile',function(){\r\n\t\treturn this._mapH;\r\n\t});\r\n\r\n\t/**\r\n\t*地图横向的格子数\r\n\t*/\r\n\t__getset(0,__proto,'numColumnsTile',function(){\r\n\t\treturn this._mapW;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的高度\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\treturn this._height;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*视口的宽度\r\n\t*/\r\n\t__getset(0,__proto,'viewPortWidth',function(){\r\n\t\treturn this._viewPortWidth;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*视口的高度\r\n\t*/\r\n\t__getset(0,__proto,'viewPortHeight',function(){\r\n\t\treturn this._viewPortHeight;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的x坐标\r\n\t*/\r\n\t__getset(0,__proto,'x',function(){\r\n\t\treturn this._x;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的y坐标\r\n\t*/\r\n\t__getset(0,__proto,'y',function(){\r\n\t\treturn this._y;\r\n\t});\r\n\r\n\t/**\r\n\t*块的宽度\r\n\t*/\r\n\t__getset(0,__proto,'gridWidth',function(){\r\n\t\treturn this._gridWidth;\r\n\t});\r\n\r\n\t/**\r\n\t*块的高度\r\n\t*/\r\n\t__getset(0,__proto,'gridHeight',function(){\r\n\t\treturn this._gridHeight;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的横向块数\r\n\t*/\r\n\t__getset(0,__proto,'numColumnsGrid',function(){\r\n\t\treturn this._gridW;\r\n\t});\r\n\r\n\t/**\r\n\t*地图的坚向块数\r\n\t*/\r\n\t__getset(0,__proto,'numRowsGrid',function(){\r\n\t\treturn this._gridH;\r\n\t});\r\n\r\n\t/**\r\n\t*tile渲染顺序\r\n\t*/\r\n\t__getset(0,__proto,'renderOrder',function(){\r\n\t\treturn this._renderOrder;\r\n\t});\r\n\r\n\tTiledMap.ORIENTATION_ORTHOGONAL=\"orthogonal\";\r\n\tTiledMap.ORIENTATION_ISOMETRIC=\"isometric\";\r\n\tTiledMap.ORIENTATION_STAGGERED=\"staggered\";\r\n\tTiledMap.ORIENTATION_HEXAGONAL=\"hexagonal\";\r\n\tTiledMap.RENDERORDER_RIGHTDOWN=\"right-down\";\r\n\tTiledMap.RENDERORDER_RIGHTUP=\"right-up\";\r\n\tTiledMap.RENDERORDER_LEFTDOWN=\"left-down\";\r\n\tTiledMap.RENDERORDER_LEFTUP=\"left-up\";\r\n\tTiledMap._tempContext=null;\r\n\tTiledMap.__init$=function(){\r\n\t\t//class GRect\r\n\t\tGRect=(function(){\r\n\t\t\tfunction GRect(){\r\n\t\t\t\tthis.left=0;\r\n\t\t\t\tthis.top=0;\r\n\t\t\t\tthis.right=0;\r\n\t\t\t\tthis.bottom=0;\r\n\t\t\t}\r\n\t\t\t__class(GRect,'');\r\n\t\t\tvar __proto=GRect.prototype;\r\n\t\t\t__proto.clearAll=function(){\r\n\t\t\t\tthis.left=this.top=this.right=this.bottom=0;\r\n\t\t\t}\r\n\t\t\treturn GRect;\r\n\t\t})()\r\n\t\t//class TileMapAniData\r\n\t\tTileMapAniData=(function(){\r\n\t\t\tfunction TileMapAniData(){\r\n\t\t\t\tthis.mAniIdArray=[];\r\n\t\t\t\tthis.mDurationTimeArray=[];\r\n\t\t\t\tthis.mTileTexSetArr=[];\r\n\t\t\t\tthis.image=null;\r\n\t\t\t}\r\n\t\t\t__class(TileMapAniData,'');\r\n\t\t\treturn TileMapAniData;\r\n\t\t})()\r\n\t\t//class TileSet\r\n\t\tTileSet=(function(){\r\n\t\t\tfunction TileSet(){\r\n\t\t\t\tthis.firstgid=0;\r\n\t\t\t\tthis.image=\"\";\r\n\t\t\t\tthis.imageheight=0;\r\n\t\t\t\tthis.imagewidth=0;\r\n\t\t\t\tthis.margin=0;\r\n\t\t\t\tthis.name=0;\r\n\t\t\t\tthis.properties=null;\r\n\t\t\t\tthis.spacing=0;\r\n\t\t\t\tthis.tileheight=0;\r\n\t\t\t\tthis.tilewidth=0;\r\n\t\t\t\tthis.titleoffsetX=0;\r\n\t\t\t\tthis.titleoffsetY=0;\r\n\t\t\t\tthis.tileproperties=null;\r\n\t\t\t}\r\n\t\t\t__class(TileSet,'');\r\n\t\t\tvar __proto=TileSet.prototype;\r\n\t\t\t__proto.init=function(data){\r\n\t\t\t\tthis.firstgid=data.firstgid;\r\n\t\t\t\tthis.image=data.image;\r\n\t\t\t\tthis.imageheight=data.imageheight;\r\n\t\t\t\tthis.imagewidth=data.imagewidth;\r\n\t\t\t\tthis.margin=data.margin;\r\n\t\t\t\tthis.name=data.name;\r\n\t\t\t\tthis.properties=data.properties;\r\n\t\t\t\tthis.spacing=data.spacing;\r\n\t\t\t\tthis.tileheight=data.tileheight;\r\n\t\t\t\tthis.tilewidth=data.tilewidth;\r\n\t\t\t\tthis.tileproperties=data.tileproperties;\r\n\t\t\t\tvar tTileoffset=data.tileoffset;\r\n\t\t\t\tif (tTileoffset){\r\n\t\t\t\t\tthis.titleoffsetX=tTileoffset.x;\r\n\t\t\t\t\tthis.titleoffsetY=tTileoffset.y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn TileSet;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn TiledMap;\r\n})()\r\n\r\n\r\n/**\r\n*此类是子纹理类，也包括同类动画的管理\r\n*TiledMap会把纹理分割成无数子纹理，也可以把其中的某块子纹理替换成一个动画序列\r\n*本类的实现就是如果发现子纹理被替换成一个动画序列，animationKey会被设为true\r\n*即animationKey为true,就使用TileAniSprite来做显示，把动画序列根据时间画到TileAniSprite上\r\n*@author ...\r\n*/\r\n//class laya.map.TileTexSet\r\nvar TileTexSet=(function(){\r\n\tfunction TileTexSet(){\r\n\t\t/**唯一标识*/\r\n\t\tthis.gid=-1;\r\n\t\t/**子纹理的引用*/\r\n\t\tthis.texture=null;\r\n\t\t/**纹理显示时的坐标偏移X*/\r\n\t\tthis.offX=0;\r\n\t\t/**纹理显示时的坐标偏移Y*/\r\n\t\tthis.offY=0;\r\n\t\t/**当前要播放动画的纹理序列*/\r\n\t\tthis.textureArray=null;\r\n\t\t/**当前动画每帧的时间间隔*/\r\n\t\tthis.durationTimeArray=null;\r\n\t\t/**动画播放的总时间 */\r\n\t\tthis.animationTotalTime=0;\r\n\t\t/**true表示当前纹理，是一组动画，false表示当前只有一个纹理*/\r\n\t\tthis.isAnimation=false;\r\n\t\tthis._spriteNum=0;\r\n\t\t//当前动画有多少个显示对象\r\n\t\tthis._aniDic=null;\r\n\t\t//通过显示对象的唯一名字，去保存显示显示对象\r\n\t\tthis._frameIndex=0;\r\n\t\t//当前动画播放到第几帧\r\n\t\tthis._time=0;\r\n\t\t//距离上次动画刷新，过了多少长时间\r\n\t\tthis._interval=0;\r\n\t\t//每帧刷新的时间间隔\r\n\t\tthis._preFrameTime=0;\r\n\t}\r\n\r\n\t__class(TileTexSet,'laya.map.TileTexSet');\r\n\tvar __proto=TileTexSet.prototype;\r\n\t/**\r\n\t*加入一个动画显示对象到此动画中\r\n\t*@param aniName //显示对象的名字\r\n\t*@param sprite //显示对象\r\n\t*/\r\n\t__proto.addAniSprite=function(aniName,sprite){\r\n\t\tif (this.animationTotalTime==0){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._aniDic==null){\r\n\t\t\tthis._aniDic={};\r\n\t\t}\r\n\t\tif (this._spriteNum==0){\r\n\t\t\tLaya.timer.frameLoop(3,this,this.animate);\r\n\t\t\tthis._preFrameTime=Browser.now();\r\n\t\t\tthis._frameIndex=0;\r\n\t\t\tthis._time=0;\r\n\t\t\tthis._interval=0;\r\n\t\t}\r\n\t\tthis._spriteNum++;\r\n\t\tthis._aniDic[aniName]=sprite;\r\n\t\tif (this.textureArray && this._frameIndex < this.textureArray.length){\r\n\t\t\tvar tTileTextureSet=this.textureArray[this._frameIndex];\r\n\t\t\tthis.drawTexture(sprite,tTileTextureSet);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*把动画画到所有注册的SPRITE上\r\n\t*/\r\n\t__proto.animate=function(){\r\n\t\tif (this.textureArray && this.textureArray.length > 0 && this.durationTimeArray && this.durationTimeArray.length > 0){\r\n\t\t\tvar tNow=Browser.now();\r\n\t\t\tthis._interval=tNow-this._preFrameTime;\r\n\t\t\tthis._preFrameTime=tNow;\r\n\t\t\tif (this._interval > this.animationTotalTime){\r\n\t\t\t\tthis._interval=this._interval % this.animationTotalTime;\r\n\t\t\t}\r\n\t\t\tthis._time+=this._interval;\r\n\t\t\tvar tTime=this.durationTimeArray[this._frameIndex];\r\n\t\t\twhile (this._time > tTime){\r\n\t\t\t\tthis._time-=tTime;\r\n\t\t\t\tthis._frameIndex++;\r\n\t\t\t\tif (this._frameIndex >=this.durationTimeArray.length || this._frameIndex >=this.textureArray.length){\r\n\t\t\t\t\tthis._frameIndex=0;\r\n\t\t\t\t};\r\n\t\t\t\tvar tTileTextureSet=this.textureArray[this._frameIndex];\r\n\t\t\t\tvar tSprite;\r\n\t\t\t\tfor (var p in this._aniDic){\r\n\t\t\t\t\ttSprite=this._aniDic[p];\r\n\t\t\t\t\tthis.drawTexture(tSprite,tTileTextureSet);\r\n\t\t\t\t}\r\n\t\t\t\ttTime=this.durationTimeArray[this._frameIndex];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.drawTexture=function(sprite,tileTextSet){\r\n\t\tsprite.graphics.clear();\r\n\t\tsprite.graphics.drawTexture(tileTextSet.texture,tileTextSet.offX,tileTextSet.offY);\r\n\t}\r\n\r\n\t/**\r\n\t*移除不需要更新的SPRITE\r\n\t*@param _name\r\n\t*/\r\n\t__proto.removeAniSprite=function(_name){\r\n\t\tif (this._aniDic && this._aniDic[_name]){\r\n\t\t\tdelete this._aniDic[_name];\r\n\t\t\tthis._spriteNum--\r\n\t\t\tif (this._spriteNum==0){\r\n\t\t\t\tLaya.timer.clear(this,this.animate);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*显示当前动画的使用情况\r\n\t*/\r\n\t__proto.showDebugInfo=function(){\r\n\t\tvar tInfo=null;\r\n\t\tif (this._spriteNum > 0){\r\n\t\t\ttInfo=\"TileTextureSet::gid:\"+this.gid.toString()+\" 动画数:\"+this._spriteNum.toString();\r\n\t\t}\r\n\t\treturn tInfo;\r\n\t}\r\n\r\n\t/**\r\n\t*清理\r\n\t*/\r\n\t__proto.clearAll=function(){\r\n\t\tthis.gid=-1;\r\n\t\tif (this.texture){\r\n\t\t\tthis.texture.destroy();\r\n\t\t\tthis.texture=null;\r\n\t\t}\r\n\t\tthis.offX=0;\r\n\t\tthis.offY=0;\r\n\t\tthis.textureArray=null;\r\n\t\tthis.durationTimeArray=null;\r\n\t\tthis.isAnimation=false;\r\n\t\tthis._spriteNum=0;\r\n\t\tthis._aniDic=null;\r\n\t\tthis._frameIndex=0;\r\n\t\tthis._preFrameTime=0;\r\n\t\tthis._time=0;\r\n\t\tthis._interval=0;\r\n\t}\r\n\r\n\treturn TileTexSet;\r\n})()\r\n\r\n\r\n/**\r\n*地图的每层都会分块渲染处理\r\n*本类就是地图的块数据\r\n*@author ...\r\n*/\r\n//class laya.map.GridSprite extends laya.display.Sprite\r\nvar GridSprite=(function(_super){\r\n\tfunction GridSprite(){\r\n\t\t/**相对于地图X轴的坐标*/\r\n\t\tthis.relativeX=0;\r\n\t\t/**相对于地图Y轴的坐标*/\r\n\t\tthis.relativeY=0;\r\n\t\t/**是否用于对象层的独立物件*/\r\n\t\tthis.isAloneObject=false;\r\n\t\t/**当前GRID中是否有动画*/\r\n\t\tthis.isHaveAnimation=false;\r\n\t\t/**当前GRID包含的动画*/\r\n\t\tthis.aniSpriteArray=null;\r\n\t\t/**当前GRID包含多少个TILE(包含动画)*/\r\n\t\tthis.drawImageNum=0;\r\n\t\tthis._map=null;\r\n\t\tGridSprite.__super.call(this);\r\n\t}\r\n\r\n\t__class(GridSprite,'laya.map.GridSprite',_super);\r\n\tvar __proto=GridSprite.prototype;\r\n\t/**\r\n\t*传入必要的参数，用于裁剪，跟确认此对象类型\r\n\t*@param map 把地图的引用传进来，参与一些裁剪计算\r\n\t*@param objectKey true:表示当前GridSprite是个活动对象，可以控制，false:地图层的组成块\r\n\t*/\r\n\t__proto.initData=function(map,objectKey){\r\n\t\t(objectKey===void 0)&& (objectKey=false);\r\n\t\tthis._map=map;\r\n\t\tthis.isAloneObject=objectKey;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setDisplay=function(value){\r\n\t\tif (!value){\r\n\t\t\tvar cc=this._$P.cacheCanvas;\r\n\t\t\tif (cc && cc.ctx){\r\n\t\t\t\tcc.ctx.canvas.destroy();\r\n\t\t\t\tcc.ctx=null;\r\n\t\t\t};\r\n\t\t\tvar fc=this._$P._filterCache;\r\n\t\t\tif (fc){\r\n\t\t\t\tfc.destroy();\r\n\t\t\t\tfc.recycle();\r\n\t\t\t\tthis._set$P('_filterCache',null);\r\n\t\t\t}\r\n\t\t\tthis._$P._isHaveGlowFilter && this._set$P('_isHaveGlowFilter',false);\r\n\t\t}\r\n\t\t_super.prototype._setDisplay.call(this,value);\r\n\t}\r\n\r\n\t/**\r\n\t*把一个动画对象绑定到当前GridSprite\r\n\t*@param sprite 动画的显示对象\r\n\t*/\r\n\t__proto.addAniSprite=function(sprite){\r\n\t\tif (this.aniSpriteArray==null){\r\n\t\t\tthis.aniSpriteArray=[];\r\n\t\t}\r\n\t\tthis.aniSpriteArray.push(sprite);\r\n\t}\r\n\r\n\t/**\r\n\t*显示当前GridSprite，并把上面的动画全部显示\r\n\t*/\r\n\t__proto.show=function(){\r\n\t\tif (!this.visible){\r\n\t\t\tthis.visible=true;\r\n\t\t\tif (!this.isAloneObject){\r\n\t\t\t\tvar tParent;\r\n\t\t\t\ttParent=this.parent;\r\n\t\t\t\tif (tParent){\r\n\t\t\t\t\ttParent.showGridSprite(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!Render.isWebGL&&this._map.autoCache){\r\n\t\t\t\tthis.cacheAs=this._map.autoCacheType;\r\n\t\t\t}\r\n\t\t\tif (this.aniSpriteArray==null){\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t\tvar tAniSprite;\r\n\t\t\tfor (var i=0;i < this.aniSpriteArray.length;i++){\r\n\t\t\t\ttAniSprite=this.aniSpriteArray[i];\r\n\t\t\t\ttAniSprite.show();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*隐藏当前GridSprite，并把上面绑定的动画全部移除\r\n\t*/\r\n\t__proto.hide=function(){\r\n\t\tif (this.visible){\r\n\t\t\tthis.visible=false;\r\n\t\t\tif (!this.isAloneObject){\r\n\t\t\t\tvar tParent;\r\n\t\t\t\ttParent=this.parent;\r\n\t\t\t\tif (tParent){\r\n\t\t\t\t\ttParent.hideGridSprite(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!Render.isWebGL&&this._map.autoCache){\r\n\t\t\t\tthis.cacheAs=\"none\";\r\n\t\t\t}\r\n\t\t\tif (this.aniSpriteArray==null){\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t\tvar tAniSprite;\r\n\t\t\tfor (var i=0;i < this.aniSpriteArray.length;i++){\r\n\t\t\t\ttAniSprite=this.aniSpriteArray[i];\r\n\t\t\t\ttAniSprite.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*刷新坐标，当我们自己控制一个GridSprite移动时，需要调用此函数，手动刷新\r\n\t*/\r\n\t__proto.updatePos=function(){\r\n\t\tif (this.isAloneObject){\r\n\t\t\tif (this._map){\r\n\t\t\t\tthis.x=this.relativeX;\r\n\t\t\t\tthis.y=this.relativeY;\r\n\t\t\t}\r\n\t\t\tif (this.x < 0 || this.x > this._map.viewPortWidth || this.y < 0 || this.y > this._map.viewPortHeight){\r\n\t\t\t\tthis.hide();\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.show();\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (this._map){\r\n\t\t\t\tthis.x=this.relativeX;\r\n\t\t\t\tthis.y=this.relativeY;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*重置当前对象的所有属性\r\n\t*/\r\n\t__proto.clearAll=function(){\r\n\t\tif (this._map){\r\n\t\t\tthis._map=null;\r\n\t\t}\r\n\t\tthis.visible=false;\r\n\t\tif (this.aniSpriteArray==null){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tAniSprite;\r\n\t\tfor (var i=0;i < this.aniSpriteArray.length;i++){\r\n\t\t\ttAniSprite=this.aniSpriteArray[i];\r\n\t\t\ttAniSprite.clearAll();\r\n\t\t}\r\n\t\tthis.destroy();\r\n\t\tthis.relativeX=0;\r\n\t\tthis.relativeY=0;\r\n\t\tthis.isHaveAnimation=false;\r\n\t\tthis.aniSpriteArray=null;\r\n\t\tthis.drawImageNum=0;\r\n\t}\r\n\r\n\treturn GridSprite;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*地图支持多层渲染（例如，地表层，植被层，建筑层等）\r\n*本类就是层级类\r\n*@author ...\r\n*/\r\n//class laya.map.MapLayer extends laya.display.Sprite\r\nvar MapLayer=(function(_super){\r\n\tfunction MapLayer(){\r\n\t\tthis._map=null;\r\n\t\tthis._mapData=null;\r\n\t\tthis._tileWidthHalf=0;\r\n\t\tthis._tileHeightHalf=0;\r\n\t\tthis._mapWidthHalf=0;\r\n\t\tthis._mapHeightHalf=0;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._gridSpriteArray=[];\r\n\t\tthis._objDic=null;\r\n\t\t//用来做字典，方便查询\r\n\t\tthis._dataDic=null;\r\n\t\t//临时变量\r\n\t\tthis._properties=null;\r\n\t\t/**被合到的层*/\r\n\t\tthis.tarLayer=null;\r\n\t\t/**当前Layer的名称*/\r\n\t\tthis.layerName=null;\r\n\t\t/**\r\n\t\t*当前需要更新的gridSprite列表\r\n\t\t*/\r\n\t\tthis._showGridList=[];\r\n\t\t/**\r\n\t\t*活动对象列表,活动对象不管是否显示都需要更新\r\n\t\t*/\r\n\t\tthis._aloneObjs=[];\r\n\t\tMapLayer.__super.call(this);\r\n\t\tthis._tempMapPos=new Point();\r\n\t}\r\n\r\n\t__class(MapLayer,'laya.map.MapLayer',_super);\r\n\tvar __proto=MapLayer.prototype;\r\n\t/**\r\n\t*解析LAYER数据，以及初始化一些数据\r\n\t*@param layerData 地图数据中，layer数据的引用\r\n\t*@param map 地图的引用\r\n\t*/\r\n\t__proto.init=function(layerData,map){\r\n\t\tthis._map=map;\r\n\t\tthis._mapData=layerData.data;\r\n\t\tvar tHeight=layerData.height;\r\n\t\tvar tWidth=layerData.width;\r\n\t\tvar tTileW=map.tileWidth;\r\n\t\tvar tTileH=map.tileHeight;\r\n\t\tthis.layerName=layerData.name;\r\n\t\tthis._properties=layerData.properties;\r\n\t\tthis.alpha=layerData.opacity;\r\n\t\tthis._tileWidthHalf=tTileW / 2;\r\n\t\tthis._tileHeightHalf=tTileH / 2;\r\n\t\tthis._mapWidthHalf=this._map.width / 2-this._tileWidthHalf;\r\n\t\tthis._mapHeightHalf=this._map.height / 2;\r\n\t\tswitch (layerData.type){\r\n\t\t\tcase \"tilelayer\":\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"objectgroup\":;\r\n\t\t\t\tvar tObjectGid=0;\r\n\t\t\t\tvar tArray=layerData.objects;\r\n\t\t\t\tif (tArray.length > 0){\r\n\t\t\t\t\tthis._objDic={};\r\n\t\t\t\t\tthis._dataDic={};\r\n\t\t\t\t};\r\n\t\t\t\tvar tObjectData;\r\n\t\t\t\tvar tObjWidth=NaN;\r\n\t\t\t\tvar tObjHeight=NaN;\r\n\t\t\t\tfor (var i=0;i < tArray.length;i++){\r\n\t\t\t\t\ttObjectData=tArray[i];\r\n\t\t\t\t\tthis._dataDic[tObjectData.name]=tObjectData;\r\n\t\t\t\t\tif (tObjectData.visible==true){\r\n\t\t\t\t\t\ttObjWidth=tObjectData.width;\r\n\t\t\t\t\t\ttObjHeight=tObjectData.height;\r\n\t\t\t\t\t\tvar tSprite=map.getSprite(tObjectData.gid,tObjWidth,tObjHeight);\r\n\t\t\t\t\t\tif (tSprite !=null){\r\n\t\t\t\t\t\tswitch (this._map.orientation){\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":\r\n\t\t\t\t\t\t\t\tthis.getScreenPositionByTilePos(tObjectData.x / tTileH,tObjectData.y / tTileH,Point.TEMP);\r\n\t\t\t\t\t\t\t\ttSprite.pivot(tObjWidth / 2,tObjHeight / 2);\r\n\t\t\t\t\t\t\t\ttSprite.rotation=tObjectData.rotation;\r\n\t\t\t\t\t\t\t\ttSprite.x=tSprite.relativeX=Point.TEMP.x+this._map.viewPortX;\r\n\t\t\t\t\t\t\t\ttSprite.y=tSprite.relativeY=Point.TEMP.y+this._map.viewPortY-tObjHeight / 2;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\t\t\t\t\ttSprite.pivot(tObjWidth / 2,tObjHeight / 2);\r\n\t\t\t\t\t\t\t\ttSprite.rotation=tObjectData.rotation;\r\n\t\t\t\t\t\t\t\ttSprite.x=tSprite.relativeX=tObjectData.x+tObjWidth / 2;\r\n\t\t\t\t\t\t\t\ttSprite.y=tSprite.relativeY=tObjectData.y-tObjHeight / 2;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\t\t\t\t\ttSprite.pivot(tObjWidth / 2,tObjHeight / 2);\r\n\t\t\t\t\t\t\t\ttSprite.rotation=tObjectData.rotation;\r\n\t\t\t\t\t\t\t\ttSprite.x=tSprite.relativeX=tObjectData.x+tObjWidth / 2;\r\n\t\t\t\t\t\t\t\ttSprite.y=tSprite.relativeY=tObjectData.y-tObjHeight / 2;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":\r\n\t\t\t\t\t\t\t\ttSprite.x=tSprite.relativeX=tObjectData.x;\r\n\t\t\t\t\t\t\t\ttSprite.y=tSprite.relativeY=tObjectData.y;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addChild(tSprite);\r\n\t\t\t\t\t\tthis._gridSpriteArray.push(tSprite);\r\n\t\t\t\t\t\tif (tSprite.isAloneObject){\r\n\t\t\t\t\t\t\tthis._showGridList.push(tSprite);\r\n\t\t\t\t\t\t\tthis._aloneObjs.push(tSprite);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._objDic[tObjectData.name]=tSprite;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak ;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*通过名字获取控制对象，如果找不到返回为null\r\n\t*@param objName 所要获取对象的名字\r\n\t*@return\r\n\t*/\r\n\t__proto.getObjectByName=function(objName){\r\n\t\tif (this._objDic){\r\n\t\t\treturn this._objDic[objName];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*通过名字获取数据，如果找不到返回为null\r\n\t*@param objName 所要获取对象的名字\r\n\t*@return\r\n\t*/\r\n\t__proto.getObjectDataByName=function(objName){\r\n\t\tif (this._dataDic){\r\n\t\t\treturn this._dataDic[objName];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*得到地图层的自定义属性\r\n\t*@param name\r\n\t*@return\r\n\t*/\r\n\t__proto.getLayerProperties=function(name){\r\n\t\tif (this._properties){\r\n\t\t\treturn this._properties[name];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*得到指定格子的数据\r\n\t*@param tileX 格子坐标X\r\n\t*@param tileY 格子坐标Y\r\n\t*@return\r\n\t*/\r\n\t__proto.getTileData=function(tileX,tileY){\r\n\t\tif (tileY >=0 && tileY < this._map.numRowsTile && tileX >=0 && tileX < this._map.numColumnsTile){\r\n\t\t\tvar tIndex=tileY *this._map.numColumnsTile+tileX;\r\n\t\t\tvar tMapData=this._mapData;\r\n\t\t\tif (tMapData !=null && tIndex < tMapData.length){\r\n\t\t\t\treturn tMapData[tIndex];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t*通过地图坐标得到屏幕坐标\r\n\t*@param tileX 格子坐标X\r\n\t*@param tileY 格子坐标Y\r\n\t*@param screenPos 把计算好的屏幕坐标数据，放到此对象中\r\n\t*/\r\n\t__proto.getScreenPositionByTilePos=function(tileX,tileY,screenPos){\r\n\t\tif (screenPos){\r\n\t\t\tswitch (this._map.orientation){\r\n\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":\r\n\t\t\t\t\tscreenPos.x=this._map.width / 2-(tileY-tileX)*this._tileWidthHalf;\r\n\t\t\t\t\tscreenPos.y=(tileY+tileX)*this._tileHeightHalf;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\t\ttileX=Math.floor(tileX);\r\n\t\t\t\t\ttileY=Math.floor(tileY);\r\n\t\t\t\t\tscreenPos.x=tileX *this._map.tileWidth+(tileY & 1)*this._tileWidthHalf;\r\n\t\t\t\t\tscreenPos.y=tileY *this._tileHeightHalf;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\t\tscreenPos.x=tileX *this._map.tileWidth;\r\n\t\t\t\t\tscreenPos.y=tileY *this._map.tileHeight;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":\r\n\t\t\t\t\ttileX=Math.floor(tileX);\r\n\t\t\t\t\ttileY=Math.floor(tileY);\r\n\t\t\t\t\tvar tTileHeight=this._map.tileHeight *2 / 3;\r\n\t\t\t\t\tscreenPos.x=(tileX *this._map.tileWidth+tileY % 2 *this._tileWidthHalf)% this._map.gridWidth;\r\n\t\t\t\t\tscreenPos.y=(tileY *tTileHeight)% this._map.gridHeight;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\tscreenPos.x=(screenPos.x+this._map.viewPortX)*this._map.scale;\r\n\t\t\tscreenPos.y=(screenPos.y+this._map.viewPortY)*this._map.scale;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*通过屏幕坐标来获取选中格子的数据\r\n\t*@param screenX 屏幕坐标x\r\n\t*@param screenY 屏幕坐标y\r\n\t*@return\r\n\t*/\r\n\t__proto.getTileDataByScreenPos=function(screenX,screenY){\r\n\t\tvar tData=0;\r\n\t\tif (this.getTilePositionByScreenPos(screenX,screenY,this._tempMapPos)){\r\n\t\t\ttData=this.getTileData(Math.floor(this._tempMapPos.x),Math.floor(this._tempMapPos.y));\r\n\t\t}\r\n\t\treturn tData;\r\n\t}\r\n\r\n\t/**\r\n\t*通过屏幕坐标来获取选中格子的索引\r\n\t*@param screenX 屏幕坐标x\r\n\t*@param screenY 屏幕坐标y\r\n\t*@param result 把计算好的格子坐标，放到此对象中\r\n\t*@return\r\n\t*/\r\n\t__proto.getTilePositionByScreenPos=function(screenX,screenY,result){\r\n\t\tscreenX=screenX/this._map.scale-this._map.viewPortX;\r\n\t\tscreenY=screenY/this._map.scale-this._map.viewPortY;\r\n\t\tvar tTileW=this._map.tileWidth;\r\n\t\tvar tTileH=this._map.tileHeight;\r\n\t\tvar tV=0;\r\n\t\tvar tU=0;\r\n\t\tswitch (this._map.orientation){\r\n\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":;\r\n\t\t\t\tvar tDirX=screenX-this._map.width / 2;\r\n\t\t\t\tvar tDirY=screenY;\r\n\t\t\t\ttV=-(tDirX / tTileW-tDirY / tTileH);\r\n\t\t\t\ttU=tDirX / tTileW+tDirY / tTileH;\r\n\t\t\t\tif (result){\r\n\t\t\t\t\tresult.x=tU;\r\n\t\t\t\t\tresult.y=tV;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase /*laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\tif (result){\r\n\t\t\t\t\tvar cx=0,cy=0,rx=0,ry=0;\r\n\t\t\t\t\tcx=Math.floor(screenX / tTileW)*tTileW+tTileW / 2;\r\n\t\t\t\t\tcy=Math.floor(screenY / tTileH)*tTileH+tTileH / 2;\r\n\t\t\t\t\trx=(screenX-cx)*tTileH / 2;\r\n\t\t\t\t\try=(screenY-cy)*tTileW / 2;\r\n\t\t\t\t\tif (Math.abs(rx)+Math.abs(ry)<=tTileW *tTileH / 4){\r\n\t\t\t\t\t\ttU=Math.floor(screenX / tTileW);\r\n\t\t\t\t\t\ttV=Math.floor(screenY / tTileH)*2;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tscreenX=screenX-tTileW / 2;\r\n\t\t\t\t\t\ttU=Math.floor(screenX / tTileW)+1;\r\n\t\t\t\t\t\tscreenY=screenY-tTileH / 2;\r\n\t\t\t\t\t\ttV=Math.floor(screenY / tTileH)*2+1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult.x=tU-(tV & 1);\r\n\t\t\t\t\tresult.y=tV;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\ttU=screenX / tTileW;\r\n\t\t\t\ttV=screenY / tTileH;\r\n\t\t\t\tif (result){\r\n\t\t\t\t\tresult.x=tU;\r\n\t\t\t\t\tresult.y=tV;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase /*laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":;\r\n\t\t\t\tvar tTileHeight=tTileH *2 / 3;\r\n\t\t\t\ttV=screenY / tTileHeight;\r\n\t\t\t\ttU=(screenX-tV % 2 *this._tileWidthHalf)/ tTileW;\r\n\t\t\t\tif (result){\r\n\t\t\t\t\tresult.x=tU;\r\n\t\t\t\t\tresult.y=tV;\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*得到一个GridSprite\r\n\t*@param gridX 当前Grid的X轴索引\r\n\t*@param gridY 当前Grid的Y轴索引\r\n\t*@return 一个GridSprite对象\r\n\t*/\r\n\t__proto.getDrawSprite=function(gridX,gridY){\r\n\t\tvar tSprite=new GridSprite();\r\n\t\ttSprite.relativeX=gridX *this._map.gridWidth;\r\n\t\ttSprite.relativeY=gridY *this._map.gridHeight;\r\n\t\ttSprite.initData(this._map);\r\n\t\ttSprite.updatePos();\r\n\t\tthis._gridSpriteArray.push(tSprite);\r\n\t\treturn tSprite;\r\n\t}\r\n\r\n\t/**\r\n\t*将gridSprite设为显示状态\r\n\t*@param gridSprite\r\n\t*/\r\n\t__proto.showGridSprite=function(gridSprite){\r\n\t\tvar gridList=this._showGridList;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=gridList.length;\r\n\t\tvar ok_i=-1;\r\n\t\tvar tGridSprite;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttGridSprite=gridList[i];\r\n\t\t\tif (tGridSprite==gridSprite)return;\r\n\t\t\tif (!tGridSprite.isAloneObject && !tGridSprite.visible){\r\n\t\t\t\tok_i=i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ok_i >=0){\r\n\t\t\tgridList[ok_i]=gridSprite;\r\n\t\t\t}else{\r\n\t\t\tgridList.push(gridSprite);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*将gridSprite设为隐藏状态\r\n\t*@param gridSprite\r\n\t*\r\n\t*/\r\n\t__proto.hideGridSprite=function(gridSprite){\r\n\t\tgridSprite.visible=false;\r\n\t}\r\n\r\n\t/**\r\n\t*更新此层中块的坐标\r\n\t*手动刷新的目的是，保持层级的宽和高保持最小，加快渲染\r\n\t*/\r\n\t__proto.updateGridPos=function(){\r\n\t\tvar tSprite;\r\n\t\tvar tList;\r\n\t\ttList=this._showGridList;\r\n\t\tvar len=0;\r\n\t\tlen=tList.length;\r\n\t\tfor (var i=0;i < len;i++){\r\n\t\t\ttSprite=tList[i];\r\n\t\t\tif ((tSprite._style.visible || tSprite.isAloneObject)&& tSprite.drawImageNum > 0){\r\n\t\t\t\ttSprite.updatePos();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*更新此层中的活动对象\r\n\t*/\r\n\t__proto.updateAloneObject=function(){\r\n\t\tvar tSprite;\r\n\t\tvar tList;\r\n\t\ttList=this._aloneObjs;\r\n\t\tvar len=0;\r\n\t\tlen=tList.length;\r\n\t\tfor (var i=0;i < len;i++){\r\n\t\t\ttSprite=tList[i];\r\n\t\t\tif (tSprite.drawImageNum > 0){\r\n\t\t\t\ttSprite.updatePos();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*渲染时使用需要更新的列表进行渲染，减少遍历\r\n\t*@param context\r\n\t*@param x\r\n\t*@param y\r\n\t*\r\n\t*/\r\n\t__proto.render=function(context,x,y){\r\n\t\tvar childs=this._childs;\r\n\t\tthis._childs=this._showGridList;\r\n\t\t_super.prototype.render.call(this,context,x,y);\r\n\t\tthis._childs=childs;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*把tile画到指定的显示对象上\r\n\t*@param gridSprite 被指定显示的目标\r\n\t*@param tileX 格子的X轴坐标\r\n\t*@param tileY 格子的Y轴坐标\r\n\t*@return\r\n\t*/\r\n\t__proto.drawTileTexture=function(gridSprite,tileX,tileY){\r\n\t\tif (tileY >=0 && tileY < this._map.numRowsTile && tileX >=0 && tileX < this._map.numColumnsTile){\r\n\t\t\tvar tIndex=tileY *this._map.numColumnsTile+tileX;\r\n\t\t\tvar tMapData=this._mapData;\r\n\t\t\tif (tMapData !=null && tIndex < tMapData.length){\r\n\t\t\t\tif (tMapData[tIndex] !=0){\r\n\t\t\t\t\tvar tTileTexSet=this._map.getTexture(tMapData[tIndex]);\r\n\t\t\t\t\tif (tTileTexSet){\r\n\t\t\t\t\t\tvar tX=0;\r\n\t\t\t\t\t\tvar tY=0;\r\n\t\t\t\t\t\tvar tTexture=tTileTexSet.texture;\r\n\t\t\t\t\t\tswitch (this._map.orientation){\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_STAGGERED*/\"staggered\":\r\n\t\t\t\t\t\t\t\ttX=tileX *this._map.tileWidth % this._map.gridWidth+(tileY & 1)*this._tileWidthHalf;\r\n\t\t\t\t\t\t\t\ttY=tileY *this._tileHeightHalf % this._map.gridHeight;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ORTHOGONAL*/\"orthogonal\":\r\n\t\t\t\t\t\t\t\ttX=tileX *this._map.tileWidth % this._map.gridWidth;\r\n\t\t\t\t\t\t\t\ttY=tileY *this._map.tileHeight % this._map.gridHeight;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_ISOMETRIC*/\"isometric\":\r\n\t\t\t\t\t\t\t\ttX=(this._mapWidthHalf+(tileX-tileY)*this._tileWidthHalf)% this._map.gridWidth;\r\n\t\t\t\t\t\t\t\ttY=((tileX+tileY)*this._tileHeightHalf)% this._map.gridHeight;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\tcase /*laya.map.TiledMap.ORIENTATION_HEXAGONAL*/\"hexagonal\":;\r\n\t\t\t\t\t\t\t\tvar tTileHeight=this._map.tileHeight *2 / 3;\r\n\t\t\t\t\t\t\t\ttX=(tileX *this._map.tileWidth+tileY % 2 *this._tileWidthHalf)% this._map.gridWidth;\r\n\t\t\t\t\t\t\t\ttY=(tileY *tTileHeight)% this._map.gridHeight;\r\n\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (tTileTexSet.isAnimation){\r\n\t\t\t\t\t\t\tvar tAnimationSprite=new TileAniSprite();\r\n\t\t\t\t\t\t\ttAnimationSprite.x=tX;\r\n\t\t\t\t\t\t\ttAnimationSprite.y=tY;\r\n\t\t\t\t\t\t\ttAnimationSprite.setTileTextureSet(tIndex.toString(),tTileTexSet);\r\n\t\t\t\t\t\t\tgridSprite.addAniSprite(tAnimationSprite);\r\n\t\t\t\t\t\t\tgridSprite.addChild(tAnimationSprite);\r\n\t\t\t\t\t\t\tgridSprite.isHaveAnimation=true;\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\tgridSprite.graphics.drawTexture(tTileTexSet.texture,tX+tTileTexSet.offX,tY+tTileTexSet.offY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*清理当前对象\r\n\t*/\r\n\t__proto.clearAll=function(){\r\n\t\tthis._map=null;\r\n\t\tthis._mapData=null;\r\n\t\tthis._tileWidthHalf=0;\r\n\t\tthis._tileHeightHalf=0;\r\n\t\tthis._mapWidthHalf=0;\r\n\t\tthis._mapHeightHalf=0;\r\n\t\tthis.layerName=null;\r\n\t\tvar i=0;\r\n\t\tif (this._objDic){\r\n\t\t\tfor (var p in this._objDic){\r\n\t\t\t\tdelete this._objDic[p];\r\n\t\t\t}\r\n\t\t\tthis._objDic=null;\r\n\t\t}\r\n\t\tif (this._dataDic){\r\n\t\t\tfor (p in this._dataDic){\r\n\t\t\t\tdelete this._dataDic[p];\r\n\t\t\t}\r\n\t\t\tthis._dataDic=null;\r\n\t\t};\r\n\t\tvar tGridSprite;\r\n\t\tfor (i=0;i < this._gridSpriteArray.length;i++){\r\n\t\t\ttGridSprite=this._gridSpriteArray[i];\r\n\t\t\ttGridSprite.clearAll();\r\n\t\t}\r\n\t\tthis._properties=null;\r\n\t\tthis._tempMapPos=null;\r\n\t\tthis.tarLayer=null;\r\n\t}\r\n\r\n\treturn MapLayer;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*TildMap的动画显示对象（一个动画（TileTexSet），可以绑定多个动画显示对象（TileAniSprite））\r\n*@author ...\r\n*/\r\n//class laya.map.TileAniSprite extends laya.display.Sprite\r\nvar TileAniSprite=(function(_super){\r\n\tfunction TileAniSprite(){\r\n\t\tthis._tileTextureSet=null;\r\n\t\t//动画的引用\r\n\t\tthis._aniName=null;\r\n\t\tTileAniSprite.__super.call(this);\r\n\t}\r\n\r\n\t__class(TileAniSprite,'laya.map.TileAniSprite',_super);\r\n\tvar __proto=TileAniSprite.prototype;\r\n\t/**\r\n\t*确定当前显示对象的名称以及属于哪个动画\r\n\t*@param aniName 当前动画显示对象的名字，名字唯一\r\n\t*@param tileTextureSet 当前显示对象属于哪个动画（一个动画，可以绑定多个同类显示对象）\r\n\t*/\r\n\t__proto.setTileTextureSet=function(aniName,tileTextureSet){\r\n\t\tthis._aniName=aniName;\r\n\t\tthis._tileTextureSet=tileTextureSet;\r\n\t\ttileTextureSet.addAniSprite(this._aniName,this);\r\n\t}\r\n\r\n\t/**\r\n\t*把当前动画加入到对应的动画刷新列表中\r\n\t*/\r\n\t__proto.show=function(){\r\n\t\tthis._tileTextureSet.addAniSprite(this._aniName,this);\r\n\t}\r\n\r\n\t/**\r\n\t*把当前动画从对应的动画刷新列表中移除\r\n\t*/\r\n\t__proto.hide=function(){\r\n\t\tthis._tileTextureSet.removeAniSprite(this._aniName);\r\n\t}\r\n\r\n\t/**\r\n\t*清理\r\n\t*/\r\n\t__proto.clearAll=function(){\r\n\t\tthis._tileTextureSet.removeAniSprite(this._aniName);\r\n\t\tthis.destroy();\r\n\t\tthis._tileTextureSet=null;\r\n\t\tthis._aniName=null;\r\n\t}\r\n\r\n\treturn TileAniSprite;\r\n})(Sprite)\r\n\r\n\r\n\tLaya.__init([TiledMap]);\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.tiledmap.js?");

/***/ }),

/***/ "./bin/libs/laya.ui.js":
/*!*****************************!*\
  !*** ./bin/libs/laya.ui.js ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Animation=laya.display.Animation,Browser=laya.utils.Browser,ClassUtils=laya.utils.ClassUtils,ColorFilter=laya.filters.ColorFilter;\r\n\tvar Ease=laya.utils.Ease,Event=laya.events.Event,Font=laya.display.css.Font,FrameAnimation=laya.display.FrameAnimation;\r\n\tvar Graphics=laya.display.Graphics,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader;\r\n\tvar Node=laya.display.Node,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render;\r\n\tvar Sprite=laya.display.Sprite,Text=laya.display.Text,Texture=laya.resource.Texture,Tween=laya.utils.Tween;\r\n\tvar Utils=laya.utils.Utils,WeakObject=laya.utils.WeakObject;\r\nLaya.interface('laya.ui.IItem');\r\nLaya.interface('laya.ui.IRender');\r\nLaya.interface('laya.ui.ISelect');\r\nLaya.interface('laya.ui.IComponent');\r\nLaya.interface('laya.ui.IBox','IComponent');\r\n/**\r\n*<code>LayoutStyle</code> 是一个布局样式类。\r\n*/\r\n//class laya.ui.LayoutStyle\r\nvar LayoutStyle=(function(){\r\n\tfunction LayoutStyle(){\r\n\t\t/**一个布尔值，表示是否有效。*/\r\n\t\tthis.enable=false;\r\n\t\tthis.top=NaN;\r\n\t\tthis.bottom=NaN;\r\n\t\tthis.left=NaN;\r\n\t\tthis.right=NaN;\r\n\t\tthis.centerX=NaN;\r\n\t\tthis.centerY=NaN;\r\n\t\tthis.anchorX=NaN;\r\n\t\tthis.anchorY=NaN;\r\n\t}\r\n\r\n\t__class(LayoutStyle,'laya.ui.LayoutStyle');\r\n\t__static(LayoutStyle,\r\n\t['EMPTY',function(){return this.EMPTY=new LayoutStyle();}\r\n\t]);\r\n\treturn LayoutStyle;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Styles</code> 定义了组件常用的样式属性。\r\n*/\r\n//class laya.ui.Styles\r\nvar Styles=(function(){\r\n\tfunction Styles(){}\r\n\t__class(Styles,'laya.ui.Styles');\r\n\tStyles.labelColor=\"#000000\";\r\n\tStyles.buttonStateNum=3;\r\n\tStyles.scrollBarMinNum=15;\r\n\tStyles.scrollBarDelayTime=500;\r\n\t__static(Styles,\r\n\t['defaultSizeGrid',function(){return this.defaultSizeGrid=[4,4,4,4,0];},'labelPadding',function(){return this.labelPadding=[2,2,2,2];},'inputLabelPadding',function(){return this.inputLabelPadding=[1,1,1,3];},'buttonLabelColors',function(){return this.buttonLabelColors=[\"#32556b\",\"#32cc6b\",\"#ff0000\",\"#C0C0C0\"];},'comboBoxItemColors',function(){return this.comboBoxItemColors=[\"#5e95b6\",\"#ffffff\",\"#000000\",\"#8fa4b1\",\"#ffffff\"];}\r\n\t]);\r\n\treturn Styles;\r\n})()\r\n\r\n\r\n/**\r\n*<code>UIUtils</code> 是文本工具集。\r\n*/\r\n//class laya.ui.UIUtils\r\nvar UIUtils=(function(){\r\n\tfunction UIUtils(){}\r\n\t__class(UIUtils,'laya.ui.UIUtils');\r\n\tUIUtils.fillArray=function(arr,str,type){\r\n\t\tvar temp=arr.concat();\r\n\t\tif (str){\r\n\t\t\tvar a=str.split(\",\");\r\n\t\t\tfor (var i=0,n=Math.min(temp.length,a.length);i < n;i++){\r\n\t\t\t\tvar value=a[i];\r\n\t\t\t\ttemp[i]=(value==\"true\" ? true :(value==\"false\" ? false :value));\r\n\t\t\t\tif (type !=null)temp[i]=type(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn temp;\r\n\t}\r\n\r\n\tUIUtils.toColor=function(color){\r\n\t\treturn Utils.toHexColor(color);\r\n\t}\r\n\r\n\tUIUtils.gray=function(traget,isGray){\r\n\t\t(isGray===void 0)&& (isGray=true);\r\n\t\tif (isGray){\r\n\t\t\tUIUtils.addFilter(traget,UIUtils.grayFilter);\r\n\t\t\t}else {\r\n\t\t\tUIUtils.clearFilter(traget,ColorFilter);\r\n\t\t}\r\n\t}\r\n\r\n\tUIUtils.addFilter=function(target,filter){\r\n\t\tvar filters=target.filters || [];\r\n\t\tfilters.push(filter);\r\n\t\ttarget.filters=filters;\r\n\t}\r\n\r\n\tUIUtils.clearFilter=function(target,filterType){\r\n\t\tvar filters=target.filters;\r\n\t\tif (filters !=null && filters.length > 0){\r\n\t\t\tfor (var i=filters.length-1;i >-1;i--){\r\n\t\t\t\tvar filter=filters[i];\r\n\t\t\t\tif (Laya.__typeof(filter,filterType))filters.splice(i,1);\r\n\t\t\t}\r\n\t\t\ttarget.filters=filters;\r\n\t\t}\r\n\t}\r\n\r\n\tUIUtils._getReplaceStr=function(word){\r\n\t\treturn UIUtils.escapeSequence[word];\r\n\t}\r\n\r\n\tUIUtils.adptString=function(str){\r\n\t\treturn str.replace(/\\\\(\\w)/g,UIUtils._getReplaceStr);\r\n\t}\r\n\r\n\tUIUtils.getBindFun=function(value){\r\n\t\tvar fun=UIUtils._funMap.get(value);\r\n\t\tif (fun==null){\r\n\t\t\tvar temp=\"\\\"\"+value+\"\\\"\";\r\n\t\t\ttemp=temp.replace(/^\"\\${|}\"$/g,\"\").replace(/\\${/g,\"\\\"+\").replace(/}/g,\"+\\\"\");\r\n\t\t\tvar str=\"(function(data){if(data==null)return;with(data){try{\\nreturn \"+temp+\"\\n}catch(e){}}})\";\r\n\t\t\tfun=Browser.window.eval(str);\r\n\t\t\tUIUtils._funMap.set(value,fun);\r\n\t\t}\r\n\t\treturn fun;\r\n\t}\r\n\r\n\t__static(UIUtils,\r\n\t['grayFilter',function(){return this.grayFilter=new ColorFilter([0.3086,0.6094,0.082,0,0,0.3086,0.6094,0.082,0,0,0.3086,0.6094,0.082,0,0,0,0,0,1,0]);},'escapeSequence',function(){return this.escapeSequence={\"\\\\n\":\"\\n\",\"\\\\t\":\"\\t\"};},'_funMap',function(){return this._funMap=new WeakObject();}\r\n\t]);\r\n\treturn UIUtils;\r\n})()\r\n\r\n\r\n/**全局配置*/\r\n//class UIConfig\r\nvar UIConfig=(function(){\r\n\tfunction UIConfig(){}\r\n\t__class(UIConfig,'UIConfig');\r\n\tUIConfig.touchScrollEnable=true;\r\n\tUIConfig.mouseWheelEnable=true;\r\n\tUIConfig.showButtons=true;\r\n\tUIConfig.popupBgColor=\"#000000\";\r\n\tUIConfig.popupBgAlpha=0.5;\r\n\tUIConfig.closeDialogOnSide=true;\r\n\treturn UIConfig;\r\n})()\r\n\r\n\r\n/**\r\n*<code>AutoBitmap</code> 类是用于表示位图图像或绘制图形的显示对象。\r\n*<p>封装了位置，宽高及九宫格的处理，供UI组件使用。</p>\r\n*/\r\n//class laya.ui.AutoBitmap extends laya.display.Graphics\r\nvar AutoBitmap=(function(_super){\r\n\tfunction AutoBitmap(){\r\n\t\t/**@private 是否自动缓存命令*/\r\n\t\tthis.autoCacheCmd=true;\r\n\t\t/**@private 宽度*/\r\n\t\tthis._width=0;\r\n\t\t/**@private 高度*/\r\n\t\tthis._height=0;\r\n\t\t/**@private 源数据*/\r\n\t\tthis._source=null;\r\n\t\t/**@private 网格数据*/\r\n\t\tthis._sizeGrid=null;\r\n\t\t/**@private */\r\n\t\tthis._isChanged=false;\r\n\t\t/**@private */\r\n\t\tthis._offset=null;\r\n\t\tAutoBitmap.__super.call(this);\r\n\t}\r\n\r\n\t__class(AutoBitmap,'laya.ui.AutoBitmap',_super);\r\n\tvar __proto=AutoBitmap.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(){\r\n\t\t_super.prototype.destroy.call(this);\r\n\t\tthis._source=null;\r\n\t\tthis._sizeGrid=null;\r\n\t\tthis._offset=null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setChanged=function(){\r\n\t\tif (!this._isChanged){\r\n\t\t\tthis._isChanged=true;\r\n\t\t\tLaya.timer.callLater(this,this.changeSource);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*修改纹理资源。\r\n\t*/\r\n\t__proto.changeSource=function(){\r\n\t\tthis._isChanged=false;\r\n\t\tvar source=this._source;\r\n\t\tif (!source || !source.bitmap)return;\r\n\t\tvar width=this.width;\r\n\t\tvar height=this.height;\r\n\t\tvar sizeGrid=this._sizeGrid;\r\n\t\tvar sw=source.sourceWidth;\r\n\t\tvar sh=source.sourceHeight;\r\n\t\tif (!sizeGrid || (sw===width && sh===height)){\r\n\t\t\tthis.cleanByTexture(source,this._offset ? this._offset[0] :0,this._offset ? this._offset[1] :0,width,height);\r\n\t\t\t}else {\r\n\t\t\tsource.$_GID || (source.$_GID=Utils.getGID());\r\n\t\t\tvar key=source.$_GID+\".\"+width+\".\"+height+\".\"+sizeGrid.join(\".\");\r\n\t\t\tif (Utils.isOKCmdList(WeakObject.I.get(key))){\r\n\t\t\t\tthis.cmds=WeakObject.I.get(key);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.clear();\r\n\t\t\tvar top=sizeGrid[0];\r\n\t\t\tvar right=sizeGrid[1];\r\n\t\t\tvar bottom=sizeGrid[2];\r\n\t\t\tvar left=sizeGrid[3];\r\n\t\t\tvar repeat=sizeGrid[4];\r\n\t\t\tvar needClip=false;\r\n\t\t\tif (width==sw){\r\n\t\t\t\tleft=right=0;\r\n\t\t\t}\r\n\t\t\tif (height==sh){\r\n\t\t\t\ttop=bottom=0;\r\n\t\t\t}\r\n\t\t\tif (left+right > width){\r\n\t\t\t\tvar clipWidth=width;\r\n\t\t\t\tneedClip=true;\r\n\t\t\t\twidth=left+right;\r\n\t\t\t\tthis.save();\r\n\t\t\t\tthis.clipRect(0,0,clipWidth,height);\r\n\t\t\t}\r\n\t\t\tleft && top && this.drawTexture(AutoBitmap.getTexture(source,0,0,left,top),0,0,left,top);\r\n\t\t\tright && top && this.drawTexture(AutoBitmap.getTexture(source,sw-right,0,right,top),width-right,0,right,top);\r\n\t\t\tleft && bottom && this.drawTexture(AutoBitmap.getTexture(source,0,sh-bottom,left,bottom),0,height-bottom,left,bottom);\r\n\t\t\tright && bottom && this.drawTexture(AutoBitmap.getTexture(source,sw-right,sh-bottom,right,bottom),width-right,height-bottom,right,bottom);\r\n\t\t\ttop && this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,0,sw-left-right,top),left,0,width-left-right,top);\r\n\t\t\tbottom && this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,sh-bottom,sw-left-right,bottom),left,height-bottom,width-left-right,bottom);\r\n\t\t\tleft && this.drawBitmap(repeat,AutoBitmap.getTexture(source,0,top,left,sh-top-bottom),0,top,left,height-top-bottom);\r\n\t\t\tright && this.drawBitmap(repeat,AutoBitmap.getTexture(source,sw-right,top,right,sh-top-bottom),width-right,top,right,height-top-bottom);\r\n\t\t\tthis.drawBitmap(repeat,AutoBitmap.getTexture(source,left,top,sw-left-right,sh-top-bottom),left,top,width-left-right,height-top-bottom);\r\n\t\t\tif (needClip)this.restore();\r\n\t\t\tif (this.autoCacheCmd && !Render.isConchApp)WeakObject.I.set(key,this.cmds);\r\n\t\t}\r\n\t\tthis._repaint();\r\n\t}\r\n\r\n\t__proto.drawBitmap=function(repeat,tex,x,y,width,height){\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tif (width < 0.1 || height < 0.1)return;\r\n\t\tif (repeat && (tex.width !=width || tex.height !=height))this.fillTexture(tex,x,y,width,height);\r\n\t\telse this.drawTexture(tex,x,y,width,height);\r\n\t}\r\n\r\n\t__proto.clear=function(recoverCmds){\r\n\t\t(recoverCmds===void 0)&& (recoverCmds=true);\r\n\t\t_super.prototype.clear.call(this,false);\r\n\t}\r\n\r\n\t/**\r\n\t*当前实例的有效缩放网格数据。\r\n\t*<p>如果设置为null,则在应用任何缩放转换时，将正常缩放整个显示对象。</p>\r\n\t*<p>数据格式：[上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)]。\r\n\t*<ul><li>例如：[4,4,4,4,1]</li></ul></p>\r\n\t*<p> <code>sizeGrid</code> 的值如下所示：\r\n\t*<ol>\r\n\t*<li>上边距</li>\r\n\t*<li>右边距</li>\r\n\t*<li>下边距</li>\r\n\t*<li>左边距</li>\r\n\t*<li>是否重复填充(值为0：不重复填充，1：重复填充)</li>\r\n\t*</ol></p>\r\n\t*<p>当定义 <code>sizeGrid</code> 属性时，该显示对象被分割到以 <code>sizeGrid</code> 数据中的\"上边距,右边距,下边距,左边距\" 组成的矩形为基础的具有九个区域的网格中，该矩形定义网格的中心区域。网格的其它八个区域如下所示：\r\n\t*<ul>\r\n\t*<li>矩形上方的区域</li>\r\n\t*<li>矩形外的右上角</li>\r\n\t*<li>矩形左侧的区域</li>\r\n\t*<li>矩形右侧的区域</li>\r\n\t*<li>矩形外的左下角</li>\r\n\t*<li>矩形下方的区域</li>\r\n\t*<li>矩形外的右下角</li>\r\n\t*<li>矩形外的左上角</li>\r\n\t*</ul>\r\n\t*同时也支持3宫格，比如0,4,0,4,1为水平3宫格，4,0,4,0,1为垂直3宫格，3宫格性能比9宫格高。\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this._sizeGrid;\r\n\t\t},function(value){\r\n\t\tthis._sizeGrid=value;\r\n\t\tthis._setChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示显示对象的宽度，以像素为单位。\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._width)return this._width;\r\n\t\tif (this._source)return this._source.sourceWidth;\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tif (this._width !=value){\r\n\t\t\tthis._width=value;\r\n\t\t\tthis._setChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示显示对象的高度，以像素为单位。\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._height)return this._height;\r\n\t\tif (this._source)return this._source.sourceHeight;\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tif (this._height !=value){\r\n\t\t\tthis._height=value;\r\n\t\t\tthis._setChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*对象的纹理资源。\r\n\t*@see laya.resource.Texture\r\n\t*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\treturn this._source;\r\n\t\t},function(value){\r\n\t\tif (value){\r\n\t\t\tthis._source=value\r\n\t\t\tthis._setChanged();\r\n\t\t\t}else {\r\n\t\t\tthis._source=null;\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t});\r\n\r\n\tAutoBitmap.getTexture=function(tex,x,y,width,height){\r\n\t\tif (width <=0)width=1;\r\n\t\tif (height <=0)height=1;\r\n\t\ttex.$_GID || (tex.$_GID=Utils.getGID())\r\n\t\tvar key=tex.$_GID+\".\"+x+\".\"+y+\".\"+width+\".\"+height;\r\n\t\tvar texture=WeakObject.I.get(key);\r\n\t\tif (!texture||!texture.source){\r\n\t\t\ttexture=Texture.createFromTexture(tex,x,y,width,height);\r\n\t\t\tWeakObject.I.set(key,texture);\r\n\t\t}\r\n\t\treturn texture;\r\n\t}\r\n\r\n\treturn AutoBitmap;\r\n})(Graphics)\r\n\r\n\r\n/**\r\n*<code>UIEvent</code> 类用来定义UI组件类的事件类型。\r\n*/\r\n//class laya.ui.UIEvent extends laya.events.Event\r\nvar UIEvent=(function(_super){\r\n\tfunction UIEvent(){\r\n\t\tUIEvent.__super.call(this);;\r\n\t}\r\n\r\n\t__class(UIEvent,'laya.ui.UIEvent',_super);\r\n\tUIEvent.SHOW_TIP=\"showtip\";\r\n\tUIEvent.HIDE_TIP=\"hidetip\";\r\n\treturn UIEvent;\r\n})(Event)\r\n\r\n\r\n/**\r\n*<code>Component</code> 是ui控件类的基类。\r\n*<p>生命周期：preinitialize > createChildren > initialize > 组件构造函数</p>\r\n*/\r\n//class laya.ui.Component extends laya.display.Sprite\r\nvar Component=(function(_super){\r\n\tfunction Component(){\r\n\t\tthis._comXml=null;\r\n\t\t/**@private 控件的元数据。 */\r\n\t\tthis._dataSource=null;\r\n\t\t/**@private 鼠标悬停提示 */\r\n\t\tthis._toolTip=null;\r\n\t\t/**@private 标签 */\r\n\t\tthis._tag=null;\r\n\t\t/**@private 禁用 */\r\n\t\tthis._disabled=false;\r\n\t\t/**@private 变灰*/\r\n\t\tthis._gray=false;\r\n\t\t/**\r\n\t\t*是否启用相对布局\r\n\t\t*/\r\n\t\tthis.layoutEnabled=true;\r\n\t\tComponent.__super.call(this);\r\n\t\tthis._layout=LayoutStyle.EMPTY;\r\n\t\tthis.preinitialize();\r\n\t\tthis.createChildren();\r\n\t\tthis.initialize();\r\n\t}\r\n\r\n\t__class(Component,'laya.ui.Component',_super);\r\n\tvar __proto=Component.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IComponent\":true})\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._dataSource=this._layout=null;\r\n\t\tthis._tag=null;\r\n\t\tthis._toolTip=null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>预初始化。</p>\r\n\t*@internal 子类可在此函数内设置、修改属性默认值\r\n\t*/\r\n\t__proto.preinitialize=function(){}\r\n\t/**\r\n\t*<p>创建并添加控件子节点。</p>\r\n\t*@internal 子类可在此函数内创建并添加子节点。\r\n\t*/\r\n\t__proto.createChildren=function(){}\r\n\t/**\r\n\t*<p>控件初始化。</p>\r\n\t*@internal 在此子对象已被创建，可以对子对象进行修改。\r\n\t*/\r\n\t__proto.initialize=function(){}\r\n\t/**\r\n\t*<p>延迟运行指定的函数。</p>\r\n\t*<p>在控件被显示在屏幕之前调用，一般用于延迟计算数据。</p>\r\n\t*@param method 要执行的函数的名称。例如，functionName。\r\n\t*@param args 传递给 <code>method</code> 函数的可选参数列表。\r\n\t*\r\n\t*@see #runCallLater()\r\n\t*/\r\n\t__proto.callLater=function(method,args){\r\n\t\tLaya.timer.callLater(this,method,args);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>如果有需要延迟调用的函数（通过 <code>callLater</code> 函数设置），则立即执行延迟调用函数。</p>\r\n\t*@param method 要执行的函数名称。例如，functionName。\r\n\t*@see #callLater()\r\n\t*/\r\n\t__proto.runCallLater=function(method){\r\n\t\tLaya.timer.runCallLater(this,method);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>立即执行影响宽高度量的延迟调用函数。</p>\r\n\t*@internal <p>使用 <code>runCallLater</code> 函数，立即执行影响宽高度量的延迟运行函数(使用 <code>callLater</code> 设置延迟执行函数)。</p>\r\n\t*@see #callLater()\r\n\t*@see #runCallLater()\r\n\t*/\r\n\t__proto.commitMeasure=function(){}\r\n\t/**\r\n\t*<p>重新调整对象的大小。</p>\r\n\t*/\r\n\t__proto.changeSize=function(){\r\n\t\tthis.event(/*laya.events.Event.RESIZE*/\"resize\");\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*<p>获取对象的布局样式。</p>\r\n\t*/\r\n\t__proto.getLayout=function(){\r\n\t\tthis._layout===LayoutStyle.EMPTY && (this._layout=new LayoutStyle());\r\n\t\treturn this._layout;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*<p>指定对象是否可使用布局。</p>\r\n\t*<p>如果值为true,则此对象可以使用布局样式，否则不使用布局样式。</p>\r\n\t*@param value 一个 Boolean 值，指定对象是否可使用布局。\r\n\t*/\r\n\t__proto._setLayoutEnabled=function(value){\r\n\t\tif (this._layout && this._layout.enable !=value){\r\n\t\t\tthis._layout.enable=value;\r\n\t\t\tthis.on(/*laya.events.Event.ADDED*/\"added\",this,this.onAdded);\r\n\t\t\tthis.on(/*laya.events.Event.REMOVED*/\"removed\",this,this.onRemoved);\r\n\t\t\tif (this.parent){\r\n\t\t\t\tthis.onAdded();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*对象从显示列表移除的事件侦听处理函数。\r\n\t*/\r\n\t__proto.onRemoved=function(){\r\n\t\tthis.parent.off(/*laya.events.Event.RESIZE*/\"resize\",this,this.onCompResize);\r\n\t}\r\n\r\n\t/**\r\n\t*对象被添加到显示列表的事件侦听处理函数。\r\n\t*/\r\n\t__proto.onAdded=function(){\r\n\t\tthis.parent.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.onCompResize);\r\n\t\tthis.resetLayoutX();\r\n\t\tthis.resetLayoutY();\r\n\t}\r\n\r\n\t/**\r\n\t*父容器的 <code>Event.RESIZE</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onCompResize=function(){\r\n\t\tif (this._layout && this._layout.enable){\r\n\t\t\tthis.resetLayoutX();\r\n\t\t\tthis.resetLayoutY();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>重置对象的 <code>X</code> 轴（水平方向）布局。</p>\r\n\t*/\r\n\t__proto.resetLayoutX=function(){\r\n\t\tvar layout=this._layout;\r\n\t\tif (!isNaN(layout.anchorX))this.pivotX=layout.anchorX *this.width;\r\n\t\tif (!this.layoutEnabled)return;\r\n\t\tvar parent=this.parent;\r\n\t\tif (parent){\r\n\t\t\tif (!isNaN(layout.centerX)){\r\n\t\t\t\tthis.x=Math.round((parent.width-this.displayWidth)*0.5+layout.centerX+this.pivotX *this.scaleX);\r\n\t\t\t\t}else if (!isNaN(layout.left)){\r\n\t\t\t\tthis.x=Math.round(layout.left+this.pivotX *this.scaleX);\r\n\t\t\t\tif (!isNaN(layout.right)){\r\n\t\t\t\t\tthis.width=(parent._width-layout.left-layout.right)/ (this.scaleX || 0.01);\r\n\t\t\t\t}\r\n\t\t\t\t}else if (!isNaN(layout.right)){\r\n\t\t\t\tthis.x=Math.round(parent.width-this.displayWidth-layout.right+this.pivotX *this.scaleX);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>重置对象的 <code>Y</code> 轴（垂直方向）布局。</p>\r\n\t*/\r\n\t__proto.resetLayoutY=function(){\r\n\t\tvar layout=this._layout;\r\n\t\tif (!isNaN(layout.anchorY))this.pivotY=layout.anchorY *this.height;\r\n\t\tif (!this.layoutEnabled)return;\r\n\t\tvar parent=this.parent;\r\n\t\tif (parent){\r\n\t\t\tif (!isNaN(layout.centerY)){\r\n\t\t\t\tthis.y=Math.round((parent.height-this.displayHeight)*0.5+layout.centerY+this.pivotY *this.scaleY);\r\n\t\t\t\t}else if (!isNaN(layout.top)){\r\n\t\t\t\tthis.y=Math.round(layout.top+this.pivotY *this.scaleY);\r\n\t\t\t\tif (!isNaN(layout.bottom)){\r\n\t\t\t\t\tthis.height=(parent._height-layout.top-layout.bottom)/ (this.scaleY || 0.01);\r\n\t\t\t\t}\r\n\t\t\t\t}else if (!isNaN(layout.bottom)){\r\n\t\t\t\tthis.y=Math.round(parent.height-this.displayHeight-layout.bottom+this.pivotY *this.scaleY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*对象的 <code>Event.MOUSE_OVER</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onMouseOver=function(e){\r\n\t\tLaya.stage.event(/*laya.ui.UIEvent.SHOW_TIP*/\"showtip\",this._toolTip);\r\n\t}\r\n\r\n\t/**\r\n\t*对象的 <code>Event.MOUSE_OUT</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onMouseOut=function(e){\r\n\t\tLaya.stage.event(/*laya.ui.UIEvent.HIDE_TIP*/\"hidetip\",this._toolTip);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>对象的显示宽度（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'displayWidth',function(){\r\n\t\treturn this.width *this.scaleX;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示显示对象的宽度，以像素为单位。</p>\r\n\t*<p><b>注：</b>当值为0时，宽度为自适应大小。</p>\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._width)return this._width;\r\n\t\treturn this.measureWidth;\r\n\t\t},function(value){\r\n\t\tif (this._width !=value){\r\n\t\t\tthis._width=value;\r\n\t\t\tthis.conchModel && this.conchModel.size(this._width,this._height);\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t\tif (this._layout.enable && (!isNaN(this._layout.centerX)|| !isNaN(this._layout.right)|| !isNaN(this._layout.anchorX)))this.resetLayoutX();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>显示对象的实际显示区域宽度（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\tvar max=0;\r\n\t\tthis.commitMeasure();\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar comp=this.getChildAt(i);\r\n\t\t\tif (comp.visible){\r\n\t\t\t\tmax=Math.max(comp.x+comp.width *comp.scaleX,max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn max;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>对象的显示高度（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'displayHeight',function(){\r\n\t\treturn this.height *this.scaleY;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示显示对象的高度，以像素为单位。</p>\r\n\t*<p><b>注：</b>当值为0时，高度为自适应大小。</p>\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._height)return this._height;\r\n\t\treturn this.measureHeight;\r\n\t\t},function(value){\r\n\t\tif (this._height !=value){\r\n\t\t\tthis._height=value;\r\n\t\t\tthis.conchModel && this.conchModel.size(this._width,this._height);\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t\tif (this._layout.enable && (!isNaN(this._layout.centerY)|| !isNaN(this._layout.bottom)|| !isNaN(this._layout.anchorY)))this.resetLayoutY();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>数据赋值，通过对UI赋值来控制UI显示逻辑。</p>\r\n\t*<p>简单赋值会更改组件的默认属性，使用大括号可以指定组件的任意属性进行赋值。</p>\r\n\t*@example\r\n\t//默认属性赋值\r\n\tdataSource={label1:\"改变了label\",checkbox1:true};//(更改了label1的text属性值，更改checkbox1的selected属性)。\r\n\t//任意属性赋值\r\n\tdataSource={label2:{text:\"改变了label\",size:14},checkbox2:{selected:true,x:10}};\r\n\t*/\r\n\t__getset(0,__proto,'dataSource',function(){\r\n\t\treturn this._dataSource;\r\n\t\t},function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tfor (var prop in this._dataSource){\r\n\t\t\tif (this.hasOwnProperty(prop)&& !((typeof (this[prop])=='function'))){\r\n\t\t\t\tthis[prop]=this._dataSource[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'scaleY',_super.prototype._$get_scaleY,function(value){\r\n\t\tif (Laya.superGet(Sprite,this,'scaleY')!=value){\r\n\t\t\tLaya.superSet(Sprite,this,'scaleY',value);\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t\tthis._layout.enable && this.resetLayoutY();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>显示对象的实际显示区域高度（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\tvar max=0;\r\n\t\tthis.commitMeasure();\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar comp=this.getChildAt(i);\r\n\t\t\tif (comp.visible){\r\n\t\t\t\tmax=Math.max(comp.y+comp.height *comp.scaleY,max);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn max;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'scaleX',_super.prototype._$get_scaleX,function(value){\r\n\t\tif (Laya.superGet(Sprite,this,'scaleX')!=value){\r\n\t\t\tLaya.superSet(Sprite,this,'scaleX',value);\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t\tthis._layout.enable && this.resetLayoutX();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>从组件顶边到其内容区域顶边之间的垂直距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'top',function(){\r\n\t\treturn this._layout.top;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.top){\r\n\t\t\tthis.getLayout().top=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutY();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>从组件底边到其内容区域底边之间的垂直距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'bottom',function(){\r\n\t\treturn this._layout.bottom;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.bottom){\r\n\t\t\tthis.getLayout().bottom=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutY();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>从组件左边到其内容区域左边之间的水平距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'left',function(){\r\n\t\treturn this._layout.left;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.left){\r\n\t\t\tthis.getLayout().left=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutX();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>从组件右边到其内容区域右边之间的水平距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'right',function(){\r\n\t\treturn this._layout.right;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.right){\r\n\t\t\tthis.getLayout().right=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutX();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>在父容器中，此对象的水平方向中轴线与父容器的水平方向中心线的距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'centerX',function(){\r\n\t\treturn this._layout.centerX;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.centerX){\r\n\t\t\tthis.getLayout().centerX=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutX();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>在父容器中，此对象的垂直方向中轴线与父容器的垂直方向中心线的距离（以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'centerY',function(){\r\n\t\treturn this._layout.centerY;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.centerY){\r\n\t\t\tthis.getLayout().centerY=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutY();\r\n\t});\r\n\r\n\t/**X轴锚点，值为0-1*/\r\n\t__getset(0,__proto,'anchorX',function(){\r\n\t\treturn this._layout.anchorX;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.anchorX){\r\n\t\t\tthis.getLayout().anchorX=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutX();\r\n\t});\r\n\r\n\t/**Y轴锚点，值为0-1*/\r\n\t__getset(0,__proto,'anchorY',function(){\r\n\t\treturn this._layout.anchorY;\r\n\t\t},function(value){\r\n\t\tif (value !=this._layout.anchorY){\r\n\t\t\tthis.getLayout().anchorY=value;\r\n\t\t\tthis._setLayoutEnabled(true);\r\n\t\t}\r\n\t\tthis.resetLayoutY();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>对象的标签。</p>\r\n\t*@internal 冗余字段，可以用来储存数据。\r\n\t*/\r\n\t__getset(0,__proto,'tag',function(){\r\n\t\treturn this._tag;\r\n\t\t},function(value){\r\n\t\tthis._tag=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>鼠标悬停提示。</p>\r\n\t*<p>可以赋值为文本 <code>String</code> 或函数 <code>Handler</code> ，用来实现自定义样式的鼠标提示和参数携带等。</p>\r\n\t*@example\r\n\t*private var _testTips:TestTipsUI=new TestTipsUI();\r\n\t*private function testTips():void {\r\n\t\t//简单鼠标提示\r\n\t\t*btn2.toolTip=\"这里是鼠标提示&lt;b&gt;粗体&lt;/b&gt;&lt;br&gt;换行\";\r\n\t\t//自定义的鼠标提示\r\n\t\t*btn1.toolTip=showTips1;\r\n\t\t//带参数的自定义鼠标提示\r\n\t\t*clip.toolTip=new Handler(this,showTips2,[\"clip\"]);\r\n\t\t*}\r\n\t*private function showTips1():void {\r\n\t\t*_testTips.label.text=\"这里是按钮[\"+btn1.label+\"]\";\r\n\t\t*tip.addChild(_testTips);\r\n\t\t*}\r\n\t*private function showTips2(name:String):void {\r\n\t\t*_testTips.label.text=\"这里是\"+name;\r\n\t\t*tip.addChild(_testTips);\r\n\t\t*}\r\n\t*/\r\n\t__getset(0,__proto,'toolTip',function(){\r\n\t\treturn this._toolTip;\r\n\t\t},function(value){\r\n\t\tif (this._toolTip !=value){\r\n\t\t\tthis._toolTip=value;\r\n\t\t\tif (value !=null){\r\n\t\t\t\tthis.on(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",this,this.onMouseOver);\r\n\t\t\t\tthis.on(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onMouseOut);\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.off(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",this,this.onMouseOver);\r\n\t\t\t\tthis.off(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onMouseOut);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*XML 数据。\r\n\t*/\r\n\t__getset(0,__proto,'comXml',function(){\r\n\t\treturn this._comXml;\r\n\t\t},function(value){\r\n\t\tthis._comXml=value;\r\n\t});\r\n\r\n\t/**是否变灰。*/\r\n\t__getset(0,__proto,'gray',function(){\r\n\t\treturn this._gray;\r\n\t\t},function(value){\r\n\t\tif (value!==this._gray){\r\n\t\t\tthis._gray=value;\r\n\t\t\tUIUtils.gray(this,value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**是否禁用页面，设置为true后，会变灰并且禁用鼠标。*/\r\n\t__getset(0,__proto,'disabled',function(){\r\n\t\treturn this._disabled;\r\n\t\t},function(value){\r\n\t\tif (value!==this._disabled){\r\n\t\t\tthis.gray=this._disabled=value;\r\n\t\t\tthis.mouseEnabled=!value;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Component;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*<code>DialogManager</code> 对话框管理容器，所有的对话框都在该容器内，并且受管理器管理。\r\n*任意对话框打开和关闭，都会出发管理类的open和close事件\r\n*可以通过UIConfig设置弹出框背景透明度，模式窗口点击边缘是否关闭，点击窗口是否切换层次等\r\n*通过设置对话框的zOrder属性，可以更改弹出的层次\r\n*/\r\n//class laya.ui.DialogManager extends laya.display.Sprite\r\nvar DialogManager=(function(_super){\r\n\tfunction DialogManager(){\r\n\t\t/**锁屏层*/\r\n\t\tthis.lockLayer=null;\r\n\t\t/**@private 全局默认弹出对话框效果，可以设置一个效果代替默认的弹出效果，如果不想有任何效果，可以赋值为null*/\r\n\t\tthis.popupEffect=function(dialog){\r\n\t\t\tdialog.scale(1,1);\r\n\t\t\tTween.from(dialog,{x:Laya.stage.width / 2,y:Laya.stage.height / 2,scaleX:0,scaleY:0},300,Ease.backOut,Handler.create(this,this.doOpen,[dialog]));\r\n\t\t}\r\n\t\t/**@private 全局默认关闭对话框效果，可以设置一个效果代替默认的关闭效果，如果不想有任何效果，可以赋值为null*/\r\n\t\tthis.closeEffect=function(dialog,type){\r\n\t\t\tTween.to(dialog,{x:Laya.stage.width / 2,y:Laya.stage.height / 2,scaleX:0,scaleY:0},300,Ease.strongOut,Handler.create(this,this.doClose,[dialog,type]));\r\n\t\t}\r\n\t\tDialogManager.__super.call(this);\r\n\t\tthis.maskLayer=new Sprite();\r\n\t\tthis.popupEffectHandler=new Handler(this,this.popupEffect);\r\n\t\tthis.closeEffectHandler=new Handler(this,this.closeEffect);\r\n\t\tthis.mouseEnabled=this.maskLayer.mouseEnabled=true;\r\n\t\tthis.zOrder=1000;\r\n\t\tLaya.stage.addChild(this);\r\n\t\tLaya.stage.on(/*laya.events.Event.RESIZE*/\"resize\",this,this._onResize);\r\n\t\tif (UIConfig.closeDialogOnSide)this.maskLayer.on(\"click\",this,this._closeOnSide);\r\n\t\tthis._onResize(null);\r\n\t}\r\n\r\n\t__class(DialogManager,'laya.ui.DialogManager',_super);\r\n\tvar __proto=DialogManager.prototype;\r\n\t__proto._closeOnSide=function(){\r\n\t\tvar dialog=this.getChildAt(this.numChildren-1);\r\n\t\tif ((dialog instanceof laya.ui.Dialog ))dialog.close(\"side\");\r\n\t}\r\n\r\n\t/**设置锁定界面，如果为空则什么都不显示*/\r\n\t__proto.setLockView=function(value){\r\n\t\tif (!this.lockLayer){\r\n\t\t\tthis.lockLayer=new Box();\r\n\t\t\tthis.lockLayer.mouseEnabled=true;\r\n\t\t\tthis.lockLayer.size(Laya.stage.width,Laya.stage.height);\r\n\t\t}\r\n\t\tthis.lockLayer.removeChildren();\r\n\t\tif (value){\r\n\t\t\tvalue.centerX=value.centerY=0;\r\n\t\t\tthis.lockLayer.addChild(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onResize=function(e){\r\n\t\tvar width=this.maskLayer.width=Laya.stage.width;\r\n\t\tvar height=this.maskLayer.height=Laya.stage.height;\r\n\t\tif (this.lockLayer)this.lockLayer.size(width,height);\r\n\t\tthis.maskLayer.graphics.clear();\r\n\t\tthis.maskLayer.graphics.drawRect(0,0,width,height,UIConfig.popupBgColor);\r\n\t\tthis.maskLayer.alpha=UIConfig.popupBgAlpha;\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item.popupCenter)this._centerDialog(item);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._centerDialog=function(dialog){\r\n\t\tdialog.x=Math.round(((Laya.stage.width-dialog.width)>> 1)+dialog.pivotX);\r\n\t\tdialog.y=Math.round(((Laya.stage.height-dialog.height)>> 1)+dialog.pivotY);\r\n\t}\r\n\r\n\t/**\r\n\t*显示对话框(非模式窗口类型)。\r\n\t*@param dialog 需要显示的对象框 <code>Dialog</code> 实例。\r\n\t*@param closeOther 是否关闭其它对话框，若值为ture，则关闭其它的对话框。\r\n\t*@param showEffect 是否显示弹出效果\r\n\t*/\r\n\t__proto.open=function(dialog,closeOther,showEffect){\r\n\t\t(closeOther===void 0)&& (closeOther=false);\r\n\t\t(showEffect===void 0)&& (showEffect=false);\r\n\t\tif (closeOther)this._closeAll();\r\n\t\tif (dialog.popupCenter)this._centerDialog(dialog);\r\n\t\tthis.addChild(dialog);\r\n\t\tif (dialog.isModal || this._$P[\"hasZorder\"])this.timer.callLater(this,this._checkMask);\r\n\t\tif (showEffect && dialog.popupEffect !=null)dialog.popupEffect.runWith(dialog);\r\n\t\telse this.doOpen(dialog);\r\n\t\tthis.event(/*laya.events.Event.OPEN*/\"open\");\r\n\t}\r\n\r\n\t/**\r\n\t*执行打开对话框。\r\n\t*@param dialog 需要关闭的对象框 <code>Dialog</code> 实例。\r\n\t*@param type 关闭的类型，默认为空\r\n\t*/\r\n\t__proto.doOpen=function(dialog){\r\n\t\tdialog.onOpened();\r\n\t}\r\n\r\n\t/**\r\n\t*锁定所有层，显示加载条信息，防止双击\r\n\t*/\r\n\t__proto.lock=function(value){\r\n\t\tif (this.lockLayer){\r\n\t\t\tif (value)this.addChild(this.lockLayer);\r\n\t\t\telse this.lockLayer.removeSelf();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*关闭对话框。\r\n\t*@param dialog 需要关闭的对象框 <code>Dialog</code> 实例。\r\n\t*@param type 关闭的类型，默认为空\r\n\t*@param showEffect 是否显示弹出效果\r\n\t*/\r\n\t__proto.close=function(dialog,type,showEffect){\r\n\t\t(showEffect===void 0)&& (showEffect=false);\r\n\t\tif (showEffect && dialog.closeEffect !=null)dialog.closeEffect.runWith([dialog,type]);\r\n\t\telse this.doClose(dialog,type);\r\n\t\tthis.event(/*laya.events.Event.CLOSE*/\"close\");\r\n\t}\r\n\r\n\t/**\r\n\t*执行关闭对话框。\r\n\t*@param dialog 需要关闭的对象框 <code>Dialog</code> 实例。\r\n\t*@param type 关闭的类型，默认为空\r\n\t*/\r\n\t__proto.doClose=function(dialog,type){\r\n\t\tdialog.removeSelf();\r\n\t\tdialog.isModal && this._checkMask();\r\n\t\tdialog.closeHandler && dialog.closeHandler.runWith(type);\r\n\t\tdialog.onClosed(type);\r\n\t}\r\n\r\n\t/**\r\n\t*关闭所有的对话框。\r\n\t*/\r\n\t__proto.closeAll=function(){\r\n\t\tthis._closeAll();\r\n\t\tthis.event(/*laya.events.Event.CLOSE*/\"close\");\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._closeAll=function(){\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item && item.close !=null){\r\n\t\t\t\tthis.doClose(item);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*根据组获取所有对话框\r\n\t*@param group 组名称\r\n\t*@return 对话框数组\r\n\t*/\r\n\t__proto.getDialogsByGroup=function(group){\r\n\t\tvar arr=[];\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item && item.group===group){\r\n\t\t\t\tarr.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\t/**\r\n\t*根据组关闭所有弹出框\r\n\t*@param group 需要关闭的组名称\r\n\t*@return 需要关闭的对话框数组\r\n\t*/\r\n\t__proto.closeByGroup=function(group){\r\n\t\tvar arr=[];\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item && item.group===group){\r\n\t\t\t\titem.close();\r\n\t\t\t\tarr.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\t/**@private 发生层次改变后，重新检查遮罩层是否正确*/\r\n\t__proto._checkMask=function(){\r\n\t\tthis.maskLayer.removeSelf();\r\n\t\tfor (var i=this.numChildren-1;i >-1;i--){\r\n\t\t\tvar dialog=this.getChildAt(i);\r\n\t\t\tif (dialog && dialog.isModal){\r\n\t\t\t\tthis.addChildAt(this.maskLayer,i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn DialogManager;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*<code>Box</code> 类是一个控件容器类。\r\n*/\r\n//class laya.ui.Box extends laya.ui.Component\r\nvar Box=(function(_super){\r\n\tfunction Box(){\r\n\t\tBox.__super.call(this);;\r\n\t}\r\n\r\n\t__class(Box,'laya.ui.Box',_super);\r\n\tvar __proto=Box.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IBox\":true})\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tfor (var name in value){\r\n\t\t\tvar comp=this.getChildByName(name);\r\n\t\t\tif (comp)comp.dataSource=value[name];\r\n\t\t\telse if (this.hasOwnProperty(name)&& !((typeof (this[name])=='function')))this[name]=value[name];\r\n\t\t}\r\n\t});\r\n\r\n\treturn Box;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>Button</code> 组件用来表示常用的多态按钮。 <code>Button</code> 组件可显示文本标签、图标或同时显示两者。 *\r\n*<p>可以是单态，两态和三态，默认三态(up,over,down)。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>Button</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Button;\r\n\t*import laya.utils.Handler;\r\n\t*public class Button_Example\r\n\t*{\r\n\t\t*public function Button_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load(\"resource/ui/button.png\",Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*trace(\"资源加载完成！\");\r\n\t\t\t*var button:Button=new Button(\"resource/ui/button.png\",\"label\");//创建一个 Button 类的实例对象 button ,并传入它的皮肤。\r\n\t\t\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.clickHandler=new Handler(this,onClickButton,[button]);//设置 button 的点击事件处理器。\r\n\t\t\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onClickButton(button:Button):void\r\n\t\t*{\r\n\t\t\t*trace(\"按钮button被点击了！\");\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n*Laya.loader.load(\"resource/ui/button.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*function loadComplete()\r\n*{\r\n\t*console.log(\"资源加载完成！\");\r\n\t*var button=new laya.ui.Button(\"resource/ui/button.png\",\"label\");//创建一个 Button 类的实例对象 button ,传入它的皮肤skin和标签label。\r\n\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t*button.clickHandler=laya.utils.Handler.create(this,onClickButton,[button],false);//设置 button 的点击事件处理函数。\r\n\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t*}\r\n*function onClickButton(button)\r\n*{\r\n\t*console.log(\"按钮被点击了。\",button);\r\n\t*}\r\n*@example\r\n*import Button=laya.ui.Button;\r\n*import Handler=laya.utils.Handler;\r\n*class Button_Example{\r\n\t*constructor()\r\n\t*{\r\n\t\t*Laya.init(640,800);\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/button.png\",laya.utils.Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete()\r\n\t*{\r\n\t\t*var button:Button=new Button(\"resource/ui/button.png\",\"label\");//创建一个 Button 类的实例对象 button ,并传入它的皮肤。\r\n\t\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t*button.clickHandler=new Handler(this,this.onClickButton,[button]);//设置 button 的点击事件处理器。\r\n\t\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onClickButton(button:Button):void\r\n\t*{\r\n\t\t*console.log(\"按钮button被点击了！\")\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.Button extends laya.ui.Component\r\nvar Button=(function(_super){\r\n\tfunction Button(skin,label){\r\n\t\t/**\r\n\t\t*指定按钮按下时是否是切换按钮的显示状态。\r\n\t\t*\r\n\t\t*@example 以下示例代码，创建了一个 <code>Button</code> 实例，并设置为切换按钮。\r\n\t\t*@example\r\n\t\t*package\r\n\t\t*{\r\n\t\t\t*import laya.ui.Button;\r\n\t\t\t*import laya.utils.Handler;\r\n\t\t\t*public class Button_toggle\r\n\t\t\t*{\r\n\t\t\t\t*public function Button_toggle()\r\n\t\t\t\t*{\r\n\t\t\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t\t\t*Laya.loader.load(\"resource/ui/button.png\",Handler.create(this,onLoadComplete));\r\n\t\t\t\t\t*}\r\n\t\t\t\t*private function onLoadComplete():void\r\n\t\t\t\t*{\r\n\t\t\t\t\t*trace(\"资源加载完成！\");\r\n\t\t\t\t\t*var button:Button=new Button(\"resource/ui/button.png\",\"label\");//创建一个 Button 实例对象 button ,传入它的皮肤skin和标签label。\r\n\t\t\t\t\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t\t\t\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t\t\t\t*button.toggle=true;//设置 button 对象为切换按钮。\r\n\t\t\t\t\t*button.clickHandler=new Handler(this,onClickButton,[button]);//设置 button 的点击事件处理器。\r\n\t\t\t\t\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t\t\t\t\t*}\r\n\t\t\t\t*private function onClickButton(button:Button):void\r\n\t\t\t\t*{\r\n\t\t\t\t\t*trace(\"button.selected = \"+button.selected);\r\n\t\t\t\t\t*}\r\n\t\t\t\t*}\r\n\t\t\t*}\r\n\t\t*@example\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/button.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n\t\t*function loadComplete()\r\n\t\t*{\r\n\t\t\t*console.log(\"资源加载完成！\");\r\n\t\t\t*var button=new laya.ui.Button(\"resource/ui/button.png\",\"label\");//创建一个 Button 类的实例对象 button ,传入它的皮肤skin和标签label。\r\n\t\t\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.toggle=true;//设置 button 对象为切换按钮。\r\n\t\t\t*button.clickHandler=laya.utils.Handler.create(this,onClickButton,[button],false);//设置 button 的点击事件处理器。\r\n\t\t\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*function onClickButton(button)\r\n\t\t*{\r\n\t\t\t*console.log(\"button.selected = \",button.selected);\r\n\t\t\t*}\r\n\t\t*@example\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"button.png\",null,null,null,null,null);//加载资源\r\n\t\t*function loadComplete(){\r\n\t\t\t*console.log(\"资源加载完成！\");\r\n\t\t\t*var button:laya.ui.Button=new laya.ui.Button(\"button.png\",\"label\");//创建一个 Button 类的实例对象 button ,传入它的皮肤skin和标签label。\r\n\t\t\t*button.x=100;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.y=100;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t\t*button.toggle=true;//设置 button 对象为切换按钮。\r\n\t\t\t*button.clickHandler=laya.utils.Handler.create(this,onClickButton,[button],false);//设置 button 的点击事件处理器。\r\n\t\t\t*Laya.stage.addChild(button);//将此 button 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*function onClickButton(button){\r\n\t\t\t*console.log(\"button.selected = \",button.selected);\r\n\t\t\t*}\r\n\t\t*/\r\n\t\tthis.toggle=false;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._bitmap=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*按钮上的文本。\r\n\t\t*/\r\n\t\tthis._text=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*按钮文本标签描边的颜色值。\r\n\t\t*/\r\n\t\tthis._strokeColors=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*按钮的状态值。\r\n\t\t*/\r\n\t\tthis._state=0;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示按钮的选中状态。\r\n\t\t*/\r\n\t\tthis._selected=false;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*按钮的皮肤资源。\r\n\t\t*/\r\n\t\tthis._skin=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*指定此显示对象是否自动计算并改变大小等属性。\r\n\t\t*/\r\n\t\tthis._autoSize=true;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*源数据。\r\n\t\t*/\r\n\t\tthis._sources=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*按钮的点击事件函数。\r\n\t\t*/\r\n\t\tthis._clickHandler=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._stateChanged=false;\r\n\t\tButton.__super.call(this);\r\n\t\tthis._labelColors=Styles.buttonLabelColors;\r\n\t\tthis._stateNum=Styles.buttonStateNum;\r\n\t\t(label===void 0)&& (label=\"\");\r\n\t\tthis.skin=skin;\r\n\t\tthis.label=label;\r\n\t}\r\n\r\n\t__class(Button,'laya.ui.Button',_super);\r\n\tvar __proto=Button.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.ISelect\":true})\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._bitmap && this._bitmap.destroy();\r\n\t\tthis._text && this._text.destroy(destroyChild);\r\n\t\tthis._bitmap=null;\r\n\t\tthis._text=null;\r\n\t\tthis._clickHandler=null;\r\n\t\tthis._labelColors=this._sources=this._strokeColors=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.graphics=this._bitmap=new AutoBitmap();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.createText=function(){\r\n\t\tif (!this._text){\r\n\t\t\tthis._text=new Text();\r\n\t\t\tthis._text.overflow=Text.HIDDEN;\r\n\t\t\tthis._text.align=\"center\";\r\n\t\t\tthis._text.valign=\"middle\";\r\n\t\t\tthis._text.width=this._width;\r\n\t\t\tthis._text.height=this._height;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tif (this._mouseEnableState!==1){\r\n\t\t\tthis.mouseEnabled=true;\r\n\t\t\tthis._setBit(/*laya.display.Node.MOUSEENABLE*/0x2,true);\r\n\t\t}\r\n\t\tthis._createListener(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",this,this.onMouse,null,false,false);\r\n\t\tthis._createListener(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onMouse,null,false,false);\r\n\t\tthis._createListener(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onMouse,null,false,false);\r\n\t\tthis._createListener(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onMouse,null,false,false);\r\n\t\tthis._createListener(/*laya.events.Event.CLICK*/\"click\",this,this.onMouse,null,false,false);\r\n\t}\r\n\r\n\t/**\r\n\t*对象的 <code>Event.MOUSE_OVER、Event.MOUSE_OUT、Event.MOUSE_DOWN、Event.MOUSE_UP、Event.CLICK</code> 事件侦听处理函数。\r\n\t*@param e Event 对象。\r\n\t*/\r\n\t__proto.onMouse=function(e){\r\n\t\tif (this.toggle===false && this._selected)return;\r\n\t\tif (e.type===/*laya.events.Event.CLICK*/\"click\"){\r\n\t\t\tthis.toggle && (this.selected=!this._selected);\r\n\t\t\tthis._clickHandler && this._clickHandler.run();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t!this._selected && (this.state=Button.stateMap[e.type]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*对象的资源切片发生改变。\r\n\t*/\r\n\t__proto.changeClips=function(){\r\n\t\tvar img=Loader.getRes(this._skin);\r\n\t\tif (!img){\r\n\t\t\tconsole.log(\"lose skin\",this._skin);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar width=img.sourceWidth;\r\n\t\tvar height=img.sourceHeight / this._stateNum;\r\n\t\timg.$_GID || (img.$_GID=Utils.getGID());\r\n\t\tvar key=img.$_GID+\"-\"+this._stateNum;\r\n\t\tvar clips=WeakObject.I.get(key);\r\n\t\tif (!Utils.isOkTextureList(clips)){\r\n\t\t\tclips=null;\r\n\t\t}\r\n\t\tif (clips)this._sources=clips;\r\n\t\telse {\r\n\t\t\tthis._sources=[];\r\n\t\t\tif (this._stateNum===1){\r\n\t\t\t\tthis._sources.push(img);\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (var i=0;i < this._stateNum;i++){\r\n\t\t\t\t\tthis._sources.push(Texture.createFromTexture(img,0,height *i,width,height));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tWeakObject.I.set(key,this._sources);\r\n\t\t}\r\n\t\tif (this._autoSize){\r\n\t\t\tthis._bitmap.width=this._width || width;\r\n\t\t\tthis._bitmap.height=this._height || height;\r\n\t\t\tif (this._text){\r\n\t\t\t\tthis._text.width=this._bitmap.width;\r\n\t\t\t\tthis._text.height=this._bitmap.height;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis._text && (this._text.x=width);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*改变对象的状态。\r\n\t*/\r\n\t__proto.changeState=function(){\r\n\t\tthis._stateChanged=false;\r\n\t\tthis.runCallLater(this.changeClips);\r\n\t\tvar index=this._state < this._stateNum ? this._state :this._stateNum-1;\r\n\t\tthis._sources && (this._bitmap.source=this._sources[index]);\r\n\t\tif (this.label){\r\n\t\t\tthis._text.color=this._labelColors[index];\r\n\t\t\tif (this._strokeColors)this._text.strokeColor=this._strokeColors[index];\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setStateChanged=function(){\r\n\t\tif (!this._stateChanged){\r\n\t\t\tthis._stateChanged=true;\r\n\t\t\tthis.callLater(this.changeState);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>描边颜色，以字符串表示。</p>\r\n\t*默认值为 \"#000000\"（黑色）;\r\n\t*@see laya.display.Text.strokeColor()\r\n\t*/\r\n\t__getset(0,__proto,'labelStrokeColor',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.strokeColor;\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.strokeColor=value\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\tthis.runCallLater(this.changeClips);\r\n\t\treturn this._text ? Math.max(this._bitmap.height,this._text.height):this._bitmap.height;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>对象的皮肤资源地址。</p>\r\n\t*支持单态，两态和三态，用 <code>stateNum</code> 属性设置\r\n\t*<p>对象的皮肤地址，以字符串表示。</p>\r\n\t*@see #stateNum\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis.callLater(this.changeClips);\r\n\t\t\tthis._setStateChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*对象的状态值。\r\n\t*@see #stateMap\r\n\t*/\r\n\t__getset(0,__proto,'state',function(){\r\n\t\treturn this._state;\r\n\t\t},function(value){\r\n\t\tif (this._state !=value){\r\n\t\t\tthis._state=value;\r\n\t\t\tthis._setStateChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*按钮文本标签 <code>Text</code> 控件。\r\n\t*/\r\n\t__getset(0,__proto,'text',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指定对象的状态值，以数字表示。</p>\r\n\t*<p>默认值为3。此值决定皮肤资源图片的切割方式。</p>\r\n\t*<p><b>取值：</b>\r\n\t*<li>1：单态。图片不做切割，按钮的皮肤状态只有一种。</li>\r\n\t*<li>2：两态。图片将以竖直方向被等比切割为2部分，从上向下，依次为\r\n\t*弹起状态皮肤、\r\n\t*按下和经过及选中状态皮肤。</li>\r\n\t*<li>3：三态。图片将以竖直方向被等比切割为3部分，从上向下，依次为\r\n\t*弹起状态皮肤、\r\n\t*经过状态皮肤、\r\n\t*按下和选中状态皮肤</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'stateNum',function(){\r\n\t\treturn this._stateNum;\r\n\t\t},function(value){\r\n\t\tif ((typeof value=='string')){\r\n\t\t\tvalue=parseInt(value);\r\n\t\t}\r\n\t\tif (this._stateNum !=value){\r\n\t\t\tthis._stateNum=value < 1 ? 1 :value > 3 ? 3 :value;\r\n\t\t\tthis.callLater(this.changeClips);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮各个状态下的描边颜色。\r\n\t*<p><b>格式:</b> \"upColor,overColor,downColor,disableColor\"。</p>\r\n\t*/\r\n\t__getset(0,__proto,'strokeColors',function(){\r\n\t\treturn this._strokeColors ? this._strokeColors.join(\",\"):\"\";\r\n\t\t},function(value){\r\n\t\tthis._strokeColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String);\r\n\t\tthis._setStateChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮各个状态下的文本颜色。\r\n\t*<p><b>格式:</b> \"upColor,overColor,downColor,disableColor\"。</p>\r\n\t*/\r\n\t__getset(0,__proto,'labelColors',function(){\r\n\t\treturn this._labelColors.join(\",\");\r\n\t\t},function(value){\r\n\t\tthis._labelColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String);\r\n\t\tthis._setStateChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\tthis.runCallLater(this.changeClips);\r\n\t\tif (this._autoSize)return this._bitmap.width;\r\n\t\tthis.runCallLater(this.changeState);\r\n\t\treturn this._bitmap.width+(this._text ? this._text.width :0);\r\n\t});\r\n\r\n\t/**\r\n\t*按钮的文本内容。\r\n\t*/\r\n\t__getset(0,__proto,'label',function(){\r\n\t\treturn this._text ? this._text.text :null;\r\n\t\t},function(value){\r\n\t\tif (!this._text && !value)return;\r\n\t\tthis.createText();\r\n\t\tif (this._text.text !=value){\r\n\t\t\tvalue && !this._text.parent && this.addChild(this._text);\r\n\t\t\tthis._text.text=(value+\"\").replace(/\\\\n/g,\"\\n\");\r\n\t\t\tthis._setStateChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮的选中状态。\r\n\t*<p>如果值为true，表示该对象处于选中状态。否则该对象处于未选中状态。</p>\r\n\t*/\r\n\t__getset(0,__proto,'selected',function(){\r\n\t\treturn this._selected;\r\n\t\t},function(value){\r\n\t\tif (this._selected !=value){\r\n\t\t\tthis._selected=value;\r\n\t\t\tthis.state=this._selected ? 2 :0;\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的边距。\r\n\t*<p><b>格式：</b>\"上边距,右边距,下边距,左边距\"。</p>\r\n\t*/\r\n\t__getset(0,__proto,'labelPadding',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.padding.join(\",\");\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的字体大小。\r\n\t*@see laya.display.Text.fontSize()\r\n\t*/\r\n\t__getset(0,__proto,'labelSize',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.fontSize;\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.fontSize=value\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边宽度（以像素为单位）。</p>\r\n\t*默认值0，表示不描边。\r\n\t*@see laya.display.Text.stroke()\r\n\t*/\r\n\t__getset(0,__proto,'labelStroke',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.stroke;\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.stroke=value\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签是否为粗体字。\r\n\t*@see laya.display.Text.bold()\r\n\t*/\r\n\t__getset(0,__proto,'labelBold',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.bold;\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.bold=value;\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的字体名称，以字符串形式表示。\r\n\t*@see laya.display.Text.font()\r\n\t*/\r\n\t__getset(0,__proto,'labelFont',function(){\r\n\t\tthis.createText();\r\n\t\treturn this._text.font;\r\n\t\t},function(value){\r\n\t\tthis.createText();\r\n\t\tthis._text.font=value;\r\n\t});\r\n\r\n\t/**标签对齐模式，默认为居中对齐。*/\r\n\t__getset(0,__proto,'labelAlign',function(){\r\n\t\tthis.createText()\r\n\t\treturn this._text.align;\r\n\t\t},function(value){\r\n\t\tthis.createText()\r\n\t\tthis._text.align=value;\r\n\t});\r\n\r\n\t/**\r\n\t*对象的点击事件处理器函数（无默认参数）。\r\n\t*/\r\n\t__getset(0,__proto,'clickHandler',function(){\r\n\t\treturn this._clickHandler;\r\n\t\t},function(value){\r\n\t\tthis._clickHandler=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的位图 <code>AutoImage</code> 实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\tif (this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(\",\");\r\n\t\treturn null;\r\n\t\t},function(value){\r\n\t\tthis._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tif (this._autoSize){\r\n\t\t\tthis._bitmap.width=value;\r\n\t\t\tthis._text && (this._text.width=value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tif (this._autoSize){\r\n\t\t\tthis._bitmap.height=value;\r\n\t\t\tthis._text && (this._text.height=value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='number')|| (typeof value=='string'))this.label=value+\"\";\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**图标x,y偏移，格式：100,100*/\r\n\t__getset(0,__proto,'iconOffset',function(){\r\n\t\treturn this._bitmap._offset ? this._bitmap._offset.join(\",\"):null;\r\n\t\t},function(value){\r\n\t\tif (value)this._bitmap._offset=UIUtils.fillArray([1,1],value,Number);\r\n\t\telse this._bitmap._offset=[];\r\n\t});\r\n\r\n\t__static(Button,\r\n\t['stateMap',function(){return this.stateMap={\"mouseup\":0,\"mouseover\":1,\"mousedown\":2,\"mouseout\":0};}\r\n\t]);\r\n\treturn Button;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<p> <code>Clip</code> 类是位图切片动画。</p>\r\n*<p> <code>Clip</code> 可将一张图片，按横向分割数量 <code>clipX</code> 、竖向分割数量 <code>clipY</code> ，\r\n*或横向分割每个切片的宽度 <code>clipWidth</code> 、竖向分割每个切片的高度 <code>clipHeight</code> ，\r\n*从左向右，从上到下，分割组合为一个切片动画。</p>\r\n*Image和Clip组件是唯一支持异步加载的两个组件，比如clip.skin=\"abc/xxx.png\"，其他UI组件均不支持异步加载。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>Clip</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Clip;\r\n\t*public class Clip_Example\r\n\t*{\r\n\t\t*private var clip:Clip;\r\n\t\t*public function Clip_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*onInit();\r\n\t\t\t*}\r\n\t\t*private function onInit():void\r\n\t\t*{\r\n\t\t\t*clip=new Clip(\"resource/ui/clip_num.png\",10,1);//创建一个 Clip 类的实例对象 clip ,传入它的皮肤skin和横向分割数量、竖向分割数量。\r\n\t\t\t*clip.autoPlay=true;//设置 clip 动画自动播放。\r\n\t\t\t*clip.interval=100;//设置 clip 动画的播放时间间隔。\r\n\t\t\t*clip.x=100;//设置 clip 对象的属性 x 的值，用于控制 clip 对象的显示位置。\r\n\t\t\t*clip.y=100;//设置 clip 对象的属性 y 的值，用于控制 clip 对象的显示位置。\r\n\t\t\t*clip.on(Event.CLICK,this,onClick);//给 clip 添加点击事件函数侦听。\r\n\t\t\t*Laya.stage.addChild(clip);//将此 clip 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onClick():void\r\n\t\t*{\r\n\t\t\t*trace(\"clip 的点击事件侦听处理函数。clip.total=\"+clip.total);\r\n\t\t\t*if (clip.isPlaying==true)\r\n\t\t\t*{\r\n\t\t\t\t*clip.stop();//停止动画。\r\n\t\t\t\t*}else {\r\n\t\t\t\t*clip.play();//播放动画。\r\n\t\t\t\t*}\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var clip;\r\n*Laya.loader.load(\"resource/ui/clip_num.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*function loadComplete(){\r\n\t*console.log(\"资源加载完成！\");\r\n\t*clip=new laya.ui.Clip(\"resource/ui/clip_num.png\",10,1);//创建一个 Clip 类的实例对象 clip ,传入它的皮肤skin和横向分割数量、竖向分割数量。\r\n\t*clip.autoPlay=true;//设置 clip 动画自动播放。\r\n\t*clip.interval=100;//设置 clip 动画的播放时间间隔。\r\n\t*clip.x=100;//设置 clip 对象的属性 x 的值，用于控制 clip 对象的显示位置。\r\n\t*clip.y=100;//设置 clip 对象的属性 y 的值，用于控制 clip 对象的显示位置。\r\n\t*clip.on(Event.CLICK,this,onClick);//给 clip 添加点击事件函数侦听。\r\n\t*Laya.stage.addChild(clip);//将此 clip 对象添加到显示列表。\r\n\t*}\r\n*function onClick()\r\n*{\r\n\t*console.log(\"clip 的点击事件侦听处理函数。\");\r\n\t*if(clip.isPlaying==true)\r\n\t*{\r\n\t\t*clip.stop();\r\n\t\t*}else {\r\n\t\t*clip.play();\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*import Clip=laya.ui.Clip;\r\n*import Handler=laya.utils.Handler;\r\n*class Clip_Example {\r\n\t*private clip:Clip;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.onInit();\r\n\t\t*}\r\n\t*private onInit():void {\r\n\t\t*this.clip=new Clip(\"resource/ui/clip_num.png\",10,1);//创建一个 Clip 类的实例对象 clip ,传入它的皮肤skin和横向分割数量、竖向分割数量。\r\n\t\t*this.clip.autoPlay=true;//设置 clip 动画自动播放。\r\n\t\t*this.clip.interval=100;//设置 clip 动画的播放时间间隔。\r\n\t\t*this.clip.x=100;//设置 clip 对象的属性 x 的值，用于控制 clip 对象的显示位置。\r\n\t\t*this.clip.y=100;//设置 clip 对象的属性 y 的值，用于控制 clip 对象的显示位置。\r\n\t\t*this.clip.on(laya.events.Event.CLICK,this,this.onClick);//给 clip 添加点击事件函数侦听。\r\n\t\t*Laya.stage.addChild(this.clip);//将此 clip 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onClick():void {\r\n\t\t*console.log(\"clip 的点击事件侦听处理函数。clip.total=\"+this.clip.total);\r\n\t\t*if (this.clip.isPlaying==true){\r\n\t\t\t*this.clip.stop();//停止动画。\r\n\t\t\t*}else {\r\n\t\t\t*this.clip.play();//播放动画。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*\r\n*/\r\n//class laya.ui.Clip extends laya.ui.Component\r\nvar Clip=(function(_super){\r\n\tfunction Clip(url,clipX,clipY){\r\n\t\t/**@private */\r\n\t\tthis._sources=null;\r\n\t\t/**@private */\r\n\t\tthis._bitmap=null;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._clipX=1;\r\n\t\t/**@private */\r\n\t\tthis._clipY=1;\r\n\t\t/**@private */\r\n\t\tthis._clipWidth=0;\r\n\t\t/**@private */\r\n\t\tthis._clipHeight=0;\r\n\t\t/**@private */\r\n\t\tthis._autoPlay=false;\r\n\t\t/**@private */\r\n\t\tthis._interval=50;\r\n\t\t/**@private */\r\n\t\tthis._complete=null;\r\n\t\t/**@private */\r\n\t\tthis._isPlaying=false;\r\n\t\t/**@private */\r\n\t\tthis._index=0;\r\n\t\t/**@private */\r\n\t\tthis._clipChanged=false;\r\n\t\t/**@private */\r\n\t\tthis._group=null;\r\n\t\t/**@private */\r\n\t\tthis._toIndex=-1;\r\n\t\tClip.__super.call(this);\r\n\t\t(clipX===void 0)&& (clipX=1);\r\n\t\t(clipY===void 0)&& (clipY=1);\r\n\t\tthis._clipX=clipX;\r\n\t\tthis._clipY=clipY;\r\n\t\tthis.skin=url;\r\n\t}\r\n\r\n\t__class(Clip,'laya.ui.Clip',_super);\r\n\tvar __proto=Clip.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,true);\r\n\t\tthis._bitmap && this._bitmap.destroy();\r\n\t\tthis._bitmap=null;\r\n\t\tthis._sources=null;\r\n\t}\r\n\r\n\t/**\r\n\t*销毁对象并释放加载的皮肤资源。\r\n\t*/\r\n\t__proto.dispose=function(){\r\n\t\tthis.destroy(true);\r\n\t\tLaya.loader.clearRes(this._skin);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.graphics=this._bitmap=new AutoBitmap();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onDisplay=function(e){\r\n\t\tif (this._isPlaying){\r\n\t\t\tif (this._displayedInStage)this.play();\r\n\t\t\telse this.stop();\r\n\t\t\t}else if (this._autoPlay){\r\n\t\t\tthis.play();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*改变切片的资源、切片的大小。\r\n\t*/\r\n\t__proto.changeClip=function(){\r\n\t\tthis._clipChanged=false;\r\n\t\tif (!this._skin)return;\r\n\t\tvar img=Loader.getRes(this._skin);\r\n\t\tif (img){\r\n\t\t\tthis.loadComplete(this._skin,img);\r\n\t\t\t}else {\r\n\t\t\tLaya.loader.load(this._skin,Handler.create(this,this.loadComplete,[this._skin]));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载切片图片资源完成函数。\r\n\t*@param url 资源地址。\r\n\t*@param img 纹理。\r\n\t*/\r\n\t__proto.loadComplete=function(url,img){\r\n\t\tif (url===this._skin && img){\r\n\t\t\tvar w=this._clipWidth || Math.ceil(img.sourceWidth / this._clipX);\r\n\t\t\tvar h=this._clipHeight || Math.ceil(img.sourceHeight / this._clipY);\r\n\t\t\tvar key=this._skin+w+h;\r\n\t\t\tvar clips=WeakObject.I.get(key);\r\n\t\t\tif (!Utils.isOkTextureList(clips)){\r\n\t\t\t\tclips=null;\r\n\t\t\t}\r\n\t\t\tif (clips)this._sources=clips;\r\n\t\t\telse {\r\n\t\t\t\tthis._sources=[];\r\n\t\t\t\tfor (var i=0;i < this._clipY;i++){\r\n\t\t\t\t\tfor (var j=0;j < this._clipX;j++){\r\n\t\t\t\t\t\tthis._sources.push(Texture.createFromTexture(img,w *j,h *i,w,h));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tWeakObject.I.set(key,this._sources);\r\n\t\t\t}\r\n\t\t\tthis.index=this._index;\r\n\t\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\");\r\n\t\t\tthis.onCompResize();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画。\r\n\t*@param from 开始索引\r\n\t*@param to 结束索引，-1为不限制\r\n\t*/\r\n\t__proto.play=function(from,to){\r\n\t\t(from===void 0)&& (from=0);\r\n\t\t(to===void 0)&& (to=-1);\r\n\t\tthis._isPlaying=true;\r\n\t\tthis.index=from;\r\n\t\tthis._toIndex=to;\r\n\t\tthis._index++;\r\n\t\tLaya.timer.loop(this.interval,this,this._loop);\r\n\t\tthis.on(/*laya.events.Event.DISPLAY*/\"display\",this,this._onDisplay);\r\n\t\tthis.on(/*laya.events.Event.UNDISPLAY*/\"undisplay\",this,this._onDisplay);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._loop=function(){\r\n\t\tif (this._style.visible && this._sources){\r\n\t\t\tthis._index++;\r\n\t\t\tif (this._toIndex >-1 && this._index >=this._toIndex)this.stop();\r\n\t\t\telse if (this._index >=this._sources.length)this._index=0;\r\n\t\t\tthis.index=this._index;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止动画。\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis._isPlaying=false;\r\n\t\tLaya.timer.clear(this,this._loop);\r\n\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setClipChanged=function(){\r\n\t\tif (!this._clipChanged){\r\n\t\t\tthis._clipChanged=true;\r\n\t\t\tthis.callLater(this.changeClip);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*表示动画播放间隔时间(以毫秒为单位)。\r\n\t*/\r\n\t__getset(0,__proto,'interval',function(){\r\n\t\treturn this._interval;\r\n\t\t},function(value){\r\n\t\tif (this._interval !=value){\r\n\t\t\tthis._interval=value;\r\n\t\t\tif (this._isPlaying)this.play();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tif (value){\r\n\t\t\t\tthis._setClipChanged()\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._bitmap.source=null;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*源数据。\r\n\t*/\r\n\t__getset(0,__proto,'sources',function(){\r\n\t\treturn this._sources;\r\n\t\t},function(value){\r\n\t\tthis._sources=value;\r\n\t\tthis.index=this._index;\r\n\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\");\r\n\t});\r\n\r\n\t/**X轴（横向）切片数量。*/\r\n\t__getset(0,__proto,'clipX',function(){\r\n\t\treturn this._clipX;\r\n\t\t},function(value){\r\n\t\tthis._clipX=value || 1;\r\n\t\tthis._setClipChanged()\r\n\t});\r\n\r\n\t/**Y轴(竖向)切片数量。*/\r\n\t__getset(0,__proto,'clipY',function(){\r\n\t\treturn this._clipY;\r\n\t\t},function(value){\r\n\t\tthis._clipY=value || 1;\r\n\t\tthis._setClipChanged()\r\n\t});\r\n\r\n\t/**\r\n\t*切片动画的总帧数。\r\n\t*/\r\n\t__getset(0,__proto,'total',function(){\r\n\t\tthis.runCallLater(this.changeClip);\r\n\t\treturn this._sources ? this._sources.length :0;\r\n\t});\r\n\r\n\t/**\r\n\t*横向分割时每个切片的宽度，与 <code>clipX</code> 同时设置时优先级高于 <code>clipX</code> 。\r\n\t*/\r\n\t__getset(0,__proto,'clipWidth',function(){\r\n\t\treturn this._clipWidth;\r\n\t\t},function(value){\r\n\t\tthis._clipWidth=value;\r\n\t\tthis._setClipChanged()\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的位图 <code>AutoImage</code> 实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\tif (this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(\",\");\r\n\t\treturn null;\r\n\t\t},function(value){\r\n\t\tthis._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);\r\n\t});\r\n\r\n\t/**\r\n\t*资源分组。\r\n\t*/\r\n\t__getset(0,__proto,'group',function(){\r\n\t\treturn this._group;\r\n\t\t},function(value){\r\n\t\tif (value && this._skin)Loader.setGroup(this._skin,value);\r\n\t\tthis._group=value;\r\n\t});\r\n\r\n\t/**\r\n\t*竖向分割时每个切片的高度，与 <code>clipY</code> 同时设置时优先级高于 <code>clipY</code> 。\r\n\t*/\r\n\t__getset(0,__proto,'clipHeight',function(){\r\n\t\treturn this._clipHeight;\r\n\t\t},function(value){\r\n\t\tthis._clipHeight=value;\r\n\t\tthis._setClipChanged()\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tthis._bitmap.width=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tthis._bitmap.height=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\tthis.runCallLater(this.changeClip);\r\n\t\treturn this._bitmap.width;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\tthis.runCallLater(this.changeClip);\r\n\t\treturn this._bitmap.height;\r\n\t});\r\n\r\n\t/**\r\n\t*当前帧索引。\r\n\t*/\r\n\t__getset(0,__proto,'index',function(){\r\n\t\treturn this._index;\r\n\t\t},function(value){\r\n\t\tthis._index=value;\r\n\t\tthis._bitmap && this._sources && (this._bitmap.source=this._sources[value]);\r\n\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否自动播放动画，若自动播放值为true,否则值为false;\r\n\t*<p>可控制切片动画的播放、停止。</p>\r\n\t*/\r\n\t__getset(0,__proto,'autoPlay',function(){\r\n\t\treturn this._autoPlay;\r\n\t\t},function(value){\r\n\t\tif (this._autoPlay !=value){\r\n\t\t\tthis._autoPlay=value;\r\n\t\t\tvalue ? this.play():this.stop();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示动画的当前播放状态。\r\n\t*如果动画正在播放中，则为true，否则为flash。\r\n\t*/\r\n\t__getset(0,__proto,'isPlaying',function(){\r\n\t\treturn this._isPlaying;\r\n\t\t},function(value){\r\n\t\tthis._isPlaying=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif (((typeof value=='number')&& Math.floor(value)==value)|| (typeof value=='string'))this.index=parseInt(value);\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*<code>AutoBitmap</code> 位图实例。\r\n\t*/\r\n\t__getset(0,__proto,'bitmap',function(){\r\n\t\treturn this._bitmap;\r\n\t});\r\n\r\n\treturn Clip;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>ColorPicker</code> 组件将显示包含多个颜色样本的列表，用户可以从中选择颜色。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>ColorPicker</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.ColorPicker;\r\n\t*import laya.utils.Handler;\r\n\t*public class ColorPicker_Example\r\n\t*{\r\n\t\t*public function ColorPicker_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load(\"resource/ui/color.png\",Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*trace(\"资源加载完成！\");\r\n\t\t\t*var colorPicket:ColorPicker=new ColorPicker();//创建一个 ColorPicker 类的实例对象 colorPicket 。\r\n\t\t\t*colorPicket.skin=\"resource/ui/color.png\";//设置 colorPicket 的皮肤。\r\n\t\t\t*colorPicket.x=100;//设置 colorPicket 对象的属性 x 的值，用于控制 colorPicket 对象的显示位置。\r\n\t\t\t*colorPicket.y=100;//设置 colorPicket 对象的属性 y 的值，用于控制 colorPicket 对象的显示位置。\r\n\t\t\t*colorPicket.changeHandler=new Handler(this,onChangeColor,[colorPicket]);//设置 colorPicket 的颜色改变回调函数。\r\n\t\t\t*Laya.stage.addChild(colorPicket);//将此 colorPicket 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onChangeColor(colorPicket:ColorPicker):void\r\n\t\t*{\r\n\t\t\t*trace(\"当前选择的颜色： \"+colorPicket.selectedColor);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load(\"resource/ui/color.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*function loadComplete()\r\n*{\r\n\t*console.log(\"资源加载完成！\");\r\n\t*var colorPicket=new laya.ui.ColorPicker();//创建一个 ColorPicker 类的实例对象 colorPicket 。\r\n\t*colorPicket.skin=\"resource/ui/color.png\";//设置 colorPicket 的皮肤。\r\n\t*colorPicket.x=100;//设置 colorPicket 对象的属性 x 的值，用于控制 colorPicket 对象的显示位置。\r\n\t*colorPicket.y=100;//设置 colorPicket 对象的属性 y 的值，用于控制 colorPicket 对象的显示位置。\r\n\t*colorPicket.changeHandler=laya.utils.Handler.create(this,onChangeColor,[colorPicket],false);//设置 colorPicket 的颜色改变回调函数。\r\n\t*Laya.stage.addChild(colorPicket);//将此 colorPicket 对象添加到显示列表。\r\n\t*}\r\n*function onChangeColor(colorPicket)\r\n*{\r\n\t*console.log(\"当前选择的颜色： \"+colorPicket.selectedColor);\r\n\t*}\r\n*@example\r\n*import ColorPicker=laya.ui.ColorPicker;\r\n*import Handler=laya.utils.Handler;\r\n*class ColorPicker_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/color.png\",Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*console.log(\"资源加载完成！\");\r\n\t\t*var colorPicket:ColorPicker=new ColorPicker();//创建一个 ColorPicker 类的实例对象 colorPicket 。\r\n\t\t*colorPicket.skin=\"resource/ui/color.png\";//设置 colorPicket 的皮肤。\r\n\t\t*colorPicket.x=100;//设置 colorPicket 对象的属性 x 的值，用于控制 colorPicket 对象的显示位置。\r\n\t\t*colorPicket.y=100;//设置 colorPicket 对象的属性 y 的值，用于控制 colorPicket 对象的显示位置。\r\n\t\t*colorPicket.changeHandler=new Handler(this,this.onChangeColor,[colorPicket]);//设置 colorPicket 的颜色改变回调函数。\r\n\t\t*Laya.stage.addChild(colorPicket);//将此 colorPicket 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onChangeColor(colorPicket:ColorPicker):void {\r\n\t\t*console.log(\"当前选择的颜色： \"+colorPicket.selectedColor);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.ColorPicker extends laya.ui.Component\r\nvar ColorPicker=(function(_super){\r\n\tfunction ColorPicker(){\r\n\t\t/**\r\n\t\t*当颜色发生改变时执行的函数处理器。\r\n\t\t*默认返回参数color：颜色值字符串。\r\n\t\t*/\r\n\t\tthis.changeHandler=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*指定每个正方形的颜色小格子的宽高（以像素为单位）。\r\n\t\t*/\r\n\t\tthis._gridSize=11;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色样本列表面板的背景颜色值。\r\n\t\t*/\r\n\t\tthis._bgColor=\"#ffffff\";\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色样本列表面板的边框颜色值。\r\n\t\t*/\r\n\t\tthis._borderColor=\"#000000\";\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色样本列表面板选择或输入的颜色值。\r\n\t\t*/\r\n\t\tthis._inputColor=\"#000000\";\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色输入框的背景颜色值。\r\n\t\t*/\r\n\t\tthis._inputBgColor=\"#efefef\";\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色样本列表面板。\r\n\t\t*/\r\n\t\tthis._colorPanel=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色网格。\r\n\t\t*/\r\n\t\tthis._colorTiles=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色块显示对象。\r\n\t\t*/\r\n\t\tthis._colorBlock=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色输入框控件 <code>Input</code> 。\r\n\t\t*/\r\n\t\tthis._colorInput=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示点击后显示颜色样本列表面板的按钮控件 <code>Button</code> 。\r\n\t\t*/\r\n\t\tthis._colorButton=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示颜色值列表。\r\n\t\t*/\r\n\t\tthis._colors=[];\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示选择的颜色值。\r\n\t\t*/\r\n\t\tthis._selectedColor=\"#000000\";\r\n\t\t/**@private */\r\n\t\tthis._panelChanged=false;\r\n\t\tColorPicker.__super.call(this);\r\n\t}\r\n\r\n\t__class(ColorPicker,'laya.ui.ColorPicker',_super);\r\n\tvar __proto=ColorPicker.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._colorPanel && this._colorPanel.destroy(destroyChild);\r\n\t\tthis._colorButton && this._colorButton.destroy(destroyChild);\r\n\t\tthis._colorPanel=null;\r\n\t\tthis._colorTiles=null;\r\n\t\tthis._colorBlock=null;\r\n\t\tthis._colorInput=null;\r\n\t\tthis._colorButton=null;\r\n\t\tthis._colors=null;\r\n\t\tthis.changeHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._colorButton=new Button());\r\n\t\tthis._colorPanel=new Box();\r\n\t\tthis._colorPanel.size(230,166);\r\n\t\tthis._colorPanel.addChild(this._colorTiles=new Sprite());\r\n\t\tthis._colorPanel.addChild(this._colorBlock=new Sprite());\r\n\t\tthis._colorPanel.addChild(this._colorInput=new Input());\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tthis._colorButton.on(/*laya.events.Event.CLICK*/\"click\",this,this.onColorButtonClick);\r\n\t\tthis._colorBlock.pos(5,5);\r\n\t\tthis._colorInput.pos(60,5);\r\n\t\tthis._colorInput.size(60,20);\r\n\t\tthis._colorInput.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onColorInputChange);\r\n\t\tthis._colorInput.on(/*laya.events.Event.KEY_DOWN*/\"keydown\",this,this.onColorFieldKeyDown);\r\n\t\tthis._colorTiles.pos(5,30);\r\n\t\tthis._colorTiles.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.onColorTilesMouseMove);\r\n\t\tthis._colorTiles.on(/*laya.events.Event.CLICK*/\"click\",this,this.onColorTilesClick);\r\n\t\tthis._colorTiles.size(20 *this._gridSize,12 *this._gridSize);\r\n\t\tthis._colorPanel.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onPanelMouseDown);\r\n\t\tthis.bgColor=this._bgColor;\r\n\t}\r\n\r\n\t__proto.onPanelMouseDown=function(e){\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\t/**\r\n\t*改变颜色样本列表面板。\r\n\t*/\r\n\t__proto.changePanel=function(){\r\n\t\tthis._panelChanged=false;\r\n\t\tvar g=this._colorPanel.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,230,166,this._bgColor,this._borderColor);\r\n\t\tthis.drawBlock(this._selectedColor);\r\n\t\tthis._colorInput.borderColor=this._borderColor;\r\n\t\tthis._colorInput.bgColor=this._inputBgColor;\r\n\t\tthis._colorInput.color=this._inputColor;\r\n\t\tg=this._colorTiles.graphics;\r\n\t\tg.clear();\r\n\t\tvar mainColors=[0x000000,0x333333,0x666666,0x999999,0xCCCCCC,0xFFFFFF,0xFF0000,0x00FF00,0x0000FF,0xFFFF00,0x00FFFF,0xFF00FF];\r\n\t\tfor (var i=0;i < 12;i++){\r\n\t\t\tfor (var j=0;j < 20;j++){\r\n\t\t\t\tvar color=0;\r\n\t\t\t\tif (j===0)color=mainColors[i];\r\n\t\t\t\telse if (j===1)color=0x000000;\r\n\t\t\t\telse color=(((i *3+j / 6)% 3 << 0)+((i / 6)<< 0)*3)*0x33 << 16 | j % 6 *0x33 << 8 | (i << 0)% 6 *0x33;\r\n\t\t\t\tvar strColor=UIUtils.toColor(color);\r\n\t\t\t\tthis._colors.push(strColor);\r\n\t\t\t\tvar x=j *this._gridSize;\r\n\t\t\t\tvar y=i *this._gridSize;\r\n\t\t\t\tg.drawRect(x,y,this._gridSize,this._gridSize,strColor,\"#000000\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*颜色样本列表面板的显示按钮的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onColorButtonClick=function(e){\r\n\t\tif (this._colorPanel.parent)this.close();\r\n\t\telse this.open();\r\n\t}\r\n\r\n\t/**\r\n\t*打开颜色样本列表面板。\r\n\t*/\r\n\t__proto.open=function(){\r\n\t\tvar p=this.localToGlobal(new Point());\r\n\t\tvar px=p.x+this._colorPanel.width <=Laya.stage.width ? p.x :Laya.stage.width-this._colorPanel.width;\r\n\t\tvar py=p.y+this._colorButton.height;\r\n\t\tpy=py+this._colorPanel.height <=Laya.stage.height ? py :p.y-this._colorPanel.height;\r\n\t\tthis._colorPanel.pos(px,py);\r\n\t\tthis._colorPanel.zOrder=1001;\r\n\t\tLaya._currentStage.addChild(this._colorPanel);\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.removeColorBox);\r\n\t}\r\n\r\n\t/**\r\n\t*关闭颜色样本列表面板。\r\n\t*/\r\n\t__proto.close=function(){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.removeColorBox);\r\n\t\tthis._colorPanel.removeSelf();\r\n\t}\r\n\r\n\t/**\r\n\t*舞台的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.removeColorBox=function(e){\r\n\t\tthis.close();\r\n\t}\r\n\r\n\t/**\r\n\t*小格子色块的 <code>Event.KEY_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onColorFieldKeyDown=function(e){\r\n\t\tif (e.keyCode==13){\r\n\t\t\tif (this._colorInput.text)this.selectedColor=this._colorInput.text;\r\n\t\t\telse this.selectedColor=null;\r\n\t\t\tthis.close();\r\n\t\t\te.stopPropagation();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*颜色值输入框 <code>Event.CHANGE</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onColorInputChange=function(e){\r\n\t\tif (this._colorInput.text)this.drawBlock(this._colorInput.text);\r\n\t\telse this.drawBlock(\"#FFFFFF\");\r\n\t}\r\n\r\n\t/**\r\n\t*小格子色块的 <code>Event.CLICK</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onColorTilesClick=function(e){\r\n\t\tthis.selectedColor=this.getColorByMouse();\r\n\t\tthis.close();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*小格子色块的 <code>Event.MOUSE_MOVE</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onColorTilesMouseMove=function(e){\r\n\t\tthis._colorInput.focus=false;\r\n\t\tvar color=this.getColorByMouse();\r\n\t\tthis._colorInput.text=color;\r\n\t\tthis.drawBlock(color);\r\n\t}\r\n\r\n\t/**\r\n\t*通过鼠标位置取对应的颜色块的颜色值。\r\n\t*/\r\n\t__proto.getColorByMouse=function(){\r\n\t\tvar point=this._colorTiles.getMousePoint();\r\n\t\tvar x=Math.floor(point.x / this._gridSize);\r\n\t\tvar y=Math.floor(point.y / this._gridSize);\r\n\t\treturn this._colors[y *20+x];\r\n\t}\r\n\r\n\t/**\r\n\t*绘制颜色块。\r\n\t*@param color 需要绘制的颜色块的颜色值。\r\n\t*/\r\n\t__proto.drawBlock=function(color){\r\n\t\tvar g=this._colorBlock.graphics;\r\n\t\tg.clear();\r\n\t\tvar showColor=color ? color :\"#ffffff\";\r\n\t\tg.drawRect(0,0,50,20,showColor,this._borderColor);\r\n\t\tcolor || g.drawLine(0,0,50,20,\"#ff0000\");\r\n\t}\r\n\r\n\t/**\r\n\t*改变颜色。\r\n\t*/\r\n\t__proto.changeColor=function(){\r\n\t\tvar g=this.graphics;\r\n\t\tg.clear();\r\n\t\tvar showColor=this._selectedColor || \"#000000\";\r\n\t\tg.drawRect(0,0,this._colorButton.width,this._colorButton.height,showColor);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setPanelChanged=function(){\r\n\t\tif (!this._panelChanged){\r\n\t\t\tthis._panelChanged=true;\r\n\t\t\tthis.callLater(this.changePanel);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*表示颜色输入框的背景颜色值。\r\n\t*/\r\n\t__getset(0,__proto,'inputBgColor',function(){\r\n\t\treturn this._inputBgColor;\r\n\t\t},function(value){\r\n\t\tthis._inputBgColor=value;\r\n\t\tthis._setPanelChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示选择的颜色值。\r\n\t*/\r\n\t__getset(0,__proto,'selectedColor',function(){\r\n\t\treturn this._selectedColor;\r\n\t\t},function(value){\r\n\t\tif (this._selectedColor !=value){\r\n\t\t\tthis._selectedColor=this._colorInput.text=value;\r\n\t\t\tthis.drawBlock(value);\r\n\t\t\tthis.changeColor();\r\n\t\t\tthis.changeHandler && this.changeHandler.runWith(this._selectedColor);\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\",Event.EMPTY.setTo(/*laya.events.Event.CHANGE*/\"change\",this,this));\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Button#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._colorButton.skin;\r\n\t\t},function(value){\r\n\t\tthis._colorButton.skin=value;\r\n\t\tthis.changeColor();\r\n\t});\r\n\r\n\t/**\r\n\t*表示颜色样本列表面板的背景颜色值。\r\n\t*/\r\n\t__getset(0,__proto,'bgColor',function(){\r\n\t\treturn this._bgColor;\r\n\t\t},function(value){\r\n\t\tthis._bgColor=value;\r\n\t\tthis._setPanelChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示颜色样本列表面板的边框颜色值。\r\n\t*/\r\n\t__getset(0,__proto,'borderColor',function(){\r\n\t\treturn this._borderColor;\r\n\t\t},function(value){\r\n\t\tthis._borderColor=value;\r\n\t\tthis._setPanelChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示颜色样本列表面板选择或输入的颜色值。\r\n\t*/\r\n\t__getset(0,__proto,'inputColor',function(){\r\n\t\treturn this._inputColor;\r\n\t\t},function(value){\r\n\t\tthis._inputColor=value;\r\n\t\tthis._setPanelChanged();\r\n\t});\r\n\r\n\treturn ColorPicker;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>ComboBox</code> 组件包含一个下拉列表，用户可以从该列表中选择单个值。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>ComboBox</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.ComboBox;\r\n\t*import laya.utils.Handler;\r\n\t*public class ComboBox_Example\r\n\t*{\r\n\t\t*public function ComboBox_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load(\"resource/ui/button.png\",Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*trace(\"资源加载完成！\");\r\n\t\t\t*var comboBox:ComboBox=new ComboBox(\"resource/ui/button.png\",\"item0,item1,item2,item3,item4,item5\");//创建一个 ComboBox 类的实例对象 comboBox ,传入它的皮肤和标签集。\r\n\t\t\t*comboBox.x=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t\t\t*comboBox.y=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t\t\t*comboBox.selectHandler=new Handler(this,onSelect);//设置 comboBox 选择项改变时执行的处理器。\r\n\t\t\t*Laya.stage.addChild(comboBox);//将此 comboBox 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onSelect(index:int):void\r\n\t\t*{\r\n\t\t\t*trace(\"当前选中的项对象索引： \",index);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高。\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n*Laya.loader.load(\"resource/ui/button.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*function loadComplete(){\r\n\t*console.log(\"资源加载完成！\");\r\n\t*var comboBox=new laya.ui.ComboBox(\"resource/ui/button.png\",\"item0,item1,item2,item3,item4,item5\");//创建一个 ComboBox 类的实例对象 comboBox ,传入它的皮肤和标签集。\r\n\t*comboBox.x=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t*comboBox.y=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t*comboBox.selectHandler=new laya.utils.Handler(this,onSelect);//设置 comboBox 选择项改变时执行的处理器。\r\n\t*Laya.stage.addChild(comboBox);//将此 comboBox 对象添加到显示列表。\r\n\t*}\r\n*function onSelect(index)\r\n*{\r\n\t*console.log(\"当前选中的项对象索引： \",index);\r\n\t*}\r\n*@example\r\n*import ComboBox=laya.ui.ComboBox;\r\n*import Handler=laya.utils.Handler;\r\n*class ComboBox_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/button.png\",Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*console.log(\"资源加载完成！\");\r\n\t\t*var comboBox:ComboBox=new ComboBox(\"resource/ui/button.png\",\"item0,item1,item2,item3,item4,item5\");//创建一个 ComboBox 类的实例对象 comboBox ,传入它的皮肤和标签集。\r\n\t\t*comboBox.x=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t\t*comboBox.y=100;//设置 comboBox 对象的属性 x 的值，用于控制 comboBox 对象的显示位置。\r\n\t\t*comboBox.selectHandler=new Handler(this,this.onSelect);//设置 comboBox 选择项改变时执行的处理器。\r\n\t\t*Laya.stage.addChild(comboBox);//将此 comboBox 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onSelect(index:number):void {\r\n\t\t*console.log(\"当前选中的项对象索引： \",index);\r\n\t\t*}\r\n\t*}\r\n*\r\n*/\r\n//class laya.ui.ComboBox extends laya.ui.Component\r\nvar ComboBox=(function(_super){\r\n\tfunction ComboBox(skin,labels){\r\n\t\t/**@private */\r\n\t\tthis._visibleNum=6;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._button=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._list=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._isOpen=false;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._itemSize=12;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._labels=[];\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._selectedIndex=-1;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._selectHandler=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._itemHeight=NaN;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._listHeight=NaN;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._listChanged=false;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._itemChanged=false;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._scrollBarSkin=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._isCustomList=false;\r\n\t\t/**\r\n\t\t*渲染项，用来显示下拉列表展示对象\r\n\t\t*/\r\n\t\tthis.itemRender=null;\r\n\t\tComboBox.__super.call(this);\r\n\t\tthis._itemColors=Styles.comboBoxItemColors;\r\n\t\tthis.skin=skin;\r\n\t\tthis.labels=labels;\r\n\t}\r\n\r\n\t__class(ComboBox,'laya.ui.ComboBox',_super);\r\n\tvar __proto=ComboBox.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._button && this._button.destroy(destroyChild);\r\n\t\tthis._list && this._list.destroy(destroyChild);\r\n\t\tthis._button=null;\r\n\t\tthis._list=null;\r\n\t\tthis._itemColors=null;\r\n\t\tthis._labels=null;\r\n\t\tthis._selectHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._button=new Button());\r\n\t\tthis._button.text.align=\"left\";\r\n\t\tthis._button.labelPadding=\"0,0,0,5\";\r\n\t\tthis._button.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onButtonMouseDown);\r\n\t}\r\n\r\n\t__proto._createList=function(){\r\n\t\tthis._list=new List();\r\n\t\tif (this._scrollBarSkin)this._list.vScrollBarSkin=this._scrollBarSkin;\r\n\t\tthis._setListEvent(this._list);\r\n\t}\r\n\r\n\t__proto._setListEvent=function(list){\r\n\t\tthis._list.selectEnable=true;\r\n\t\tthis._list.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onListDown);\r\n\t\tthis._list.mouseHandler=Handler.create(this,this.onlistItemMouse,null,false);\r\n\t\tif (this._list.scrollBar)this._list.scrollBar.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onScrollBarDown);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.onListDown=function(e){\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\t__proto.onScrollBarDown=function(e){\r\n\t\te.stopPropagation();\r\n\t}\r\n\r\n\t__proto.onButtonMouseDown=function(e){\r\n\t\tthis.callLater(this.switchTo,[!this._isOpen]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.changeList=function(){\r\n\t\tthis._listChanged=false;\r\n\t\tvar labelWidth=this.width-2;\r\n\t\tvar labelColor=this._itemColors[2];\r\n\t\tthis._itemHeight=this._itemSize+6;\r\n\t\tthis._list.itemRender=this.itemRender || {type:\"Box\",child:[{type:\"Label\",props:{name:\"label\",x:1,padding:\"3,3,3,3\",width:labelWidth,height:this._itemHeight,fontSize:this._itemSize,color:labelColor}}]};\r\n\t\tthis._list.repeatY=this._visibleNum;\r\n\t\tthis._list.refresh();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*下拉列表的鼠标事件响应函数。\r\n\t*/\r\n\t__proto.onlistItemMouse=function(e,index){\r\n\t\tvar type=e.type;\r\n\t\tif (type===/*laya.events.Event.MOUSE_OVER*/\"mouseover\" || type===/*laya.events.Event.MOUSE_OUT*/\"mouseout\"){\r\n\t\t\tif (this._isCustomList)return;\r\n\t\t\tvar box=this._list.getCell(index);\r\n\t\t\tif (!box)return;\r\n\t\t\tvar label=box.getChildByName(\"label\");\r\n\t\t\tif (label){\r\n\t\t\t\tif (type===/*laya.events.Event.ROLL_OVER*/\"mouseover\"){\r\n\t\t\t\t\tlabel.bgColor=this._itemColors[0];\r\n\t\t\t\t\tlabel.color=this._itemColors[1];\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tlabel.bgColor=null;\r\n\t\t\t\t\tlabel.color=this._itemColors[2];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else if (type===/*laya.events.Event.CLICK*/\"click\"){\r\n\t\t\tthis.selectedIndex=index;\r\n\t\t\tthis.isOpen=false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.switchTo=function(value){\r\n\t\tthis.isOpen=value;\r\n\t}\r\n\r\n\t/**\r\n\t*更改下拉列表的打开状态。\r\n\t*/\r\n\t__proto.changeOpen=function(){\r\n\t\tthis.isOpen=!this._isOpen;\r\n\t}\r\n\r\n\t/**\r\n\t*更改下拉列表。\r\n\t*/\r\n\t__proto.changeItem=function(){\r\n\t\tthis._itemChanged=false;\r\n\t\tthis._listHeight=this._labels.length > 0 ? Math.min(this._visibleNum,this._labels.length)*this._itemHeight :this._itemHeight;\r\n\t\tif (!this._isCustomList){\r\n\t\t\tvar g=this._list.graphics;\r\n\t\t\tg.clear();\r\n\t\t\tg.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]);\r\n\t\t};\r\n\t\tvar a=this._list.array || [];\r\n\t\ta.length=0;\r\n\t\tfor (var i=0,n=this._labels.length;i < n;i++){\r\n\t\t\ta.push({label:this._labels[i]});\r\n\t\t}\r\n\t\tthis._list.height=this._listHeight;\r\n\t\tthis._list.array=a;\r\n\t}\r\n\r\n\t__proto.changeSelected=function(){\r\n\t\tthis._button.label=this.selectedLabel;\r\n\t}\r\n\r\n\t__proto._onStageMouseWheel=function(e){\r\n\t\tif(!this._list||this._list.contains(e.target))return;\r\n\t\tthis.removeList(null);\r\n\t}\r\n\r\n\t/**\r\n\t*关闭下拉列表。\r\n\t*/\r\n\t__proto.removeList=function(e){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.removeList);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this,this._onStageMouseWheel);\r\n\t\tthis.isOpen=false;\r\n\t}\r\n\r\n\t/**\r\n\t*表示选择的下拉列表项的索引。\r\n\t*/\r\n\t__getset(0,__proto,'selectedIndex',function(){\r\n\t\treturn this._selectedIndex;\r\n\t\t},function(value){\r\n\t\tif (this._selectedIndex !=value){\r\n\t\t\tthis._selectedIndex=value;\r\n\t\t\tif (this._labels.length > 0)this.changeSelected();\r\n\t\t\telse this.callLater(this.changeSelected);\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\",[Event.EMPTY.setTo(/*laya.events.Event.CHANGE*/\"change\",this,this)]);\r\n\t\t\tthis._selectHandler && this._selectHandler.runWith(this._selectedIndex);\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn this._button.height;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Button#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._button.skin;\r\n\t\t},function(value){\r\n\t\tif (this._button.skin !=value){\r\n\t\t\tthis._button.skin=value;\r\n\t\t\tthis._listChanged=true;\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn this._button.width;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tthis._button.width=this._width;\r\n\t\tthis._itemChanged=true;\r\n\t\tthis._listChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*表示选择的下拉列表项的的标签。\r\n\t*/\r\n\t__getset(0,__proto,'selectedLabel',function(){\r\n\t\treturn this._selectedIndex >-1 && this._selectedIndex < this._labels.length ? this._labels[this._selectedIndex] :null;\r\n\t\t},function(value){\r\n\t\tthis.selectedIndex=this._labels.indexOf(value);\r\n\t});\r\n\r\n\t/**\r\n\t*标签集合字符串。\r\n\t*/\r\n\t__getset(0,__proto,'labels',function(){\r\n\t\treturn this._labels.join(\",\");\r\n\t\t},function(value){\r\n\t\tif (this._labels.length > 0)this.selectedIndex=-1;\r\n\t\tif (value)this._labels=value.split(\",\");\r\n\t\telse this._labels.length=0;\r\n\t\tthis._itemChanged=true;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tthis._button.height=this._height;\r\n\t});\r\n\r\n\t/**\r\n\t*改变下拉列表的选择项时执行的处理器(默认返回参数index:int)。\r\n\t*/\r\n\t__getset(0,__proto,'selectHandler',function(){\r\n\t\treturn this._selectHandler;\r\n\t\t},function(value){\r\n\t\tthis._selectHandler=value;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置没有滚动条的下拉列表中可显示的最大行数。\r\n\t*/\r\n\t__getset(0,__proto,'visibleNum',function(){\r\n\t\treturn this._visibleNum;\r\n\t\t},function(value){\r\n\t\tthis._visibleNum=value;\r\n\t\tthis._listChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签是否为粗体字。\r\n\t*@see laya.display.Text#bold\r\n\t*/\r\n\t__getset(0,__proto,'labelBold',function(){\r\n\t\treturn this._button.text.bold;\r\n\t\t},function(value){\r\n\t\tthis._button.text.bold=value\r\n\t});\r\n\r\n\t/**\r\n\t*下拉列表项颜色。\r\n\t*<p><b>格式：</b>\"悬停或被选中时背景颜色,悬停或被选中时标签颜色,标签颜色,边框颜色,背景颜色\"</p>\r\n\t*/\r\n\t__getset(0,__proto,'itemColors',function(){\r\n\t\treturn String(this._itemColors)\r\n\t\t},function(value){\r\n\t\tthis._itemColors=UIUtils.fillArray(this._itemColors,value,String);\r\n\t\tthis._listChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*下拉列表项标签的字体大小。\r\n\t*/\r\n\t__getset(0,__proto,'itemSize',function(){\r\n\t\treturn this._itemSize;\r\n\t\t},function(value){\r\n\t\tthis._itemSize=value;\r\n\t\tthis._listChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*获取对 <code>ComboBox</code> 组件所包含的 <code>VScrollBar</code> 滚动条组件的引用。\r\n\t*/\r\n\t__getset(0,__proto,'scrollBar',function(){\r\n\t\treturn this.list.scrollBar;\r\n\t});\r\n\r\n\t/**\r\n\t*表示下拉列表的打开状态。\r\n\t*/\r\n\t__getset(0,__proto,'isOpen',function(){\r\n\t\treturn this._isOpen;\r\n\t\t},function(value){\r\n\t\tif (this._isOpen !=value){\r\n\t\t\tthis._isOpen=value;\r\n\t\t\tthis._button.selected=this._isOpen;\r\n\t\t\tif (this._isOpen){\r\n\t\t\t\tthis._list || this._createList();\r\n\t\t\t\tthis._listChanged && !this._isCustomList && this.changeList();\r\n\t\t\t\tthis._itemChanged && this.changeItem();\r\n\t\t\t\tvar p=this.localToGlobal(Point.TEMP.setTo(0,0));\r\n\t\t\t\tvar py=p.y+this._button.height;\r\n\t\t\t\tpy=py+this._listHeight <=Laya.stage.height ? py :p.y-this._listHeight;\r\n\t\t\t\tthis._list.pos(p.x,py);\r\n\t\t\t\tthis._list.zOrder=1001;\r\n\t\t\t\tLaya._currentStage.addChild(this._list);\r\n\t\t\t\tLaya.stage.once(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.removeList);\r\n\t\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this,this._onStageMouseWheel);\r\n\t\t\t\tthis._list.selectedIndex=this._selectedIndex;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._list && this._list.removeSelf();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'scrollBarSkin',function(){\r\n\t\treturn this._scrollBarSkin;\r\n\t\t},function(value){\r\n\t\tthis._scrollBarSkin=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的位图 <code>AutoImage</code> 实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this._button.sizeGrid;\r\n\t\t},function(value){\r\n\t\tthis._button.sizeGrid=value;\r\n\t});\r\n\r\n\t/**\r\n\t*获取对 <code>ComboBox</code> 组件所包含的 <code>Button</code> 组件的引用。\r\n\t*/\r\n\t__getset(0,__proto,'button',function(){\r\n\t\treturn this._button;\r\n\t});\r\n\r\n\t/**\r\n\t*获取对 <code>ComboBox</code> 组件所包含的 <code>List</code> 列表组件的引用。\r\n\t*/\r\n\t__getset(0,__proto,'list',function(){\r\n\t\tthis._list || this._createList();\r\n\t\treturn this._list;\r\n\t\t},function(value){\r\n\t\tif (value){\r\n\t\t\tvalue.removeSelf();\r\n\t\t\tthis._isCustomList=true;\r\n\t\t\tthis._list=value;\r\n\t\t\tthis._setListEvent(value);\r\n\t\t\tthis._itemHeight=value.getCell(0).height+value.spaceY;\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif (((typeof value=='number')&& Math.floor(value)==value)|| (typeof value=='string'))this.selectedIndex=parseInt(value);\r\n\t\telse if ((value instanceof Array))this.labels=(value).join(\",\");\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置对 <code>ComboBox</code> 组件所包含的 <code>Button</code> 组件的文本标签颜色。\r\n\t*<p><b>格式：</b>upColor,overColor,downColor,disableColor</p>\r\n\t*/\r\n\t__getset(0,__proto,'labelColors',function(){\r\n\t\treturn this._button.labelColors;\r\n\t\t},function(value){\r\n\t\tif (this._button.labelColors !=value){\r\n\t\t\tthis._button.labelColors=value;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置对 <code>ComboBox</code> 组件所包含的 <code>Button</code> 组件的文本边距。\r\n\t*<p><b>格式：</b>上边距,右边距,下边距,左边距</p>\r\n\t*/\r\n\t__getset(0,__proto,'labelPadding',function(){\r\n\t\treturn this._button.text.padding.join(\",\");\r\n\t\t},function(value){\r\n\t\tthis._button.text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置对 <code>ComboBox</code> 组件所包含的 <code>Button</code> 组件的标签字体大小。\r\n\t*/\r\n\t__getset(0,__proto,'labelSize',function(){\r\n\t\treturn this._button.text.fontSize;\r\n\t\t},function(value){\r\n\t\tthis._button.text.fontSize=value\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的字体名称，以字符串形式表示。\r\n\t*@see laya.display.Text#font\r\n\t*/\r\n\t__getset(0,__proto,'labelFont',function(){\r\n\t\treturn this._button.text.font;\r\n\t\t},function(value){\r\n\t\tthis._button.text.font=value\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮的状态值。\r\n\t*@see laya.ui.Button#stateNum\r\n\t*/\r\n\t__getset(0,__proto,'stateNum',function(){\r\n\t\treturn this._button.stateNum;\r\n\t\t},function(value){\r\n\t\tthis._button.stateNum=value\r\n\t});\r\n\r\n\treturn ComboBox;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>ScrollBar</code> 组件是一个滚动条组件。\r\n*<p>当数据太多以至于显示区域无法容纳时，最终用户可以使用 <code>ScrollBar</code> 组件控制所显示的数据部分。</p>\r\n*<p> 滚动条由四部分组成：两个箭头按钮、一个轨道和一个滑块。 </p> *\r\n*\r\n*@see laya.ui.VScrollBar\r\n*@see laya.ui.HScrollBar\r\n*/\r\n//class laya.ui.ScrollBar extends laya.ui.Component\r\nvar ScrollBar=(function(_super){\r\n\tfunction ScrollBar(skin){\r\n\t\t/**滚动衰减系数*/\r\n\t\tthis.rollRatio=0.95;\r\n\t\t/**滚动变化时回调，回传value参数。*/\r\n\t\tthis.changeHandler=null;\r\n\t\t/**是否缩放滑动条，默认值为true。 */\r\n\t\tthis.scaleBar=true;\r\n\t\t/**一个布尔值，指定是否自动隐藏滚动条(无需滚动时)，默认值为false。*/\r\n\t\tthis.autoHide=false;\r\n\t\t/**橡皮筋效果极限距离，0为没有橡皮筋效果。*/\r\n\t\tthis.elasticDistance=0;\r\n\t\t/**橡皮筋回弹时间，单位为毫秒。*/\r\n\t\tthis.elasticBackTime=500;\r\n\t\t/**上按钮 */\r\n\t\tthis.upButton=null;\r\n\t\t/**下按钮 */\r\n\t\tthis.downButton=null;\r\n\t\t/**滑条 */\r\n\t\tthis.slider=null;\r\n\t\t/**@private */\r\n\t\tthis._scrollSize=1;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._thumbPercent=1;\r\n\t\t/**@private */\r\n\t\tthis._target=null;\r\n\t\t/**@private */\r\n\t\tthis._lastPoint=null;\r\n\t\t/**@private */\r\n\t\tthis._lastOffset=0;\r\n\t\t/**@private */\r\n\t\tthis._checkElastic=false;\r\n\t\t/**@private */\r\n\t\tthis._isElastic=false;\r\n\t\t/**@private */\r\n\t\tthis._value=NaN;\r\n\t\t/**@private */\r\n\t\tthis._hide=false;\r\n\t\t/**@private */\r\n\t\tthis._clickOnly=true;\r\n\t\t/**@private */\r\n\t\tthis._offsets=null;\r\n\t\tScrollBar.__super.call(this);\r\n\t\tthis._showButtons=UIConfig.showButtons;\r\n\t\tthis._touchScrollEnable=UIConfig.touchScrollEnable;\r\n\t\tthis._mouseWheelEnable=UIConfig.mouseWheelEnable;\r\n\t\tthis.skin=skin;\r\n\t\tthis.max=1;\r\n\t}\r\n\r\n\t__class(ScrollBar,'laya.ui.ScrollBar',_super);\r\n\tvar __proto=ScrollBar.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis.stopScroll();\r\n\t\tthis.target=null;\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis.upButton && this.upButton.destroy(destroyChild);\r\n\t\tthis.downButton && this.downButton.destroy(destroyChild);\r\n\t\tthis.slider && this.slider.destroy(destroyChild);\r\n\t\tthis.upButton=this.downButton=null;\r\n\t\tthis.slider=null;\r\n\t\tthis.changeHandler=null;\r\n\t\tthis._offsets=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this.slider=new Slider());\r\n\t\tthis.addChild(this.upButton=new Button());\r\n\t\tthis.addChild(this.downButton=new Button());\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tthis.slider.showLabel=false;\r\n\t\tthis.slider.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onSliderChange);\r\n\t\tthis.slider.setSlider(0,0,0);\r\n\t\tthis.upButton.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onButtonMouseDown);\r\n\t\tthis.downButton.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onButtonMouseDown);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滑块位置发生改变的处理函数。\r\n\t*/\r\n\t__proto.onSliderChange=function(){\r\n\t\tif(this._value !=this.slider.value)this.value=this.slider.value;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*向上和向下按钮的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onButtonMouseDown=function(e){\r\n\t\tvar isUp=e.currentTarget===this.upButton;\r\n\t\tthis.slide(isUp);\r\n\t\tLaya.timer.once(Styles.scrollBarDelayTime,this,this.startLoop,[isUp]);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.startLoop=function(isUp){\r\n\t\tLaya.timer.frameLoop(1,this,this.slide,[isUp]);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.slide=function(isUp){\r\n\t\tif (isUp)this.value-=this._scrollSize;\r\n\t\telse this.value+=this._scrollSize;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*舞台的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onStageMouseUp=function(e){\r\n\t\tLaya.timer.clear(this,this.startLoop);\r\n\t\tLaya.timer.clear(this,this.slide);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*更改对象的皮肤及位置。\r\n\t*/\r\n\t__proto.changeScrollBar=function(){\r\n\t\tthis.upButton.visible=this._showButtons;\r\n\t\tthis.downButton.visible=this._showButtons;\r\n\t\tif (this._showButtons){\r\n\t\t\tthis.upButton.skin=this._skin.replace(\".png\",\"$up.png\");\r\n\t\t\tthis.downButton.skin=this._skin.replace(\".png\",\"$down.png\");\r\n\t\t}\r\n\t\tif (this.slider.isVertical)this.slider.y=this._showButtons ? this.upButton.height :0;\r\n\t\telse this.slider.x=this._showButtons ? this.upButton.width :0;\r\n\t\tthis.resetPositions();\r\n\t\tthis.repaint();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.changeSize=function(){\r\n\t\t_super.prototype.changeSize.call(this);\r\n\t\tthis.repaint();\r\n\t\tthis.resetPositions();\r\n\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\tthis.changeHandler && this.changeHandler.runWith(this.value);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.resetPositions=function(){\r\n\t\tif (this.slider.isVertical)this.slider.height=this.height-(this._showButtons ? (this.upButton.height+this.downButton.height):0);\r\n\t\telse this.slider.width=this.width-(this._showButtons ? (this.upButton.width+this.downButton.width):0);\r\n\t\tthis.resetButtonPosition();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.resetButtonPosition=function(){\r\n\t\tif (this.slider.isVertical)this.downButton.y=this.slider.y+this.slider.height;\r\n\t\telse this.downButton.x=this.slider.x+this.slider.width;\r\n\t}\r\n\r\n\t/**\r\n\t*设置滚动条信息。\r\n\t*@param min 滚动条最小位置值。\r\n\t*@param max 滚动条最大位置值。\r\n\t*@param value 滚动条当前位置值。\r\n\t*/\r\n\t__proto.setScroll=function(min,max,value){\r\n\t\tthis.runCallLater(this.changeSize);\r\n\t\tthis.slider.setSlider(min,max,value);\r\n\t\tthis.slider.bar.visible=max > 0;\r\n\t\tif (!this._hide && this.autoHide)this.visible=false;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onTargetMouseWheel=function(e){\r\n\t\tthis.value-=e.delta *this._scrollSize;\r\n\t\tthis.target=this._target;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onTargetMouseDown=function(e){\r\n\t\tthis._clickOnly=true;\r\n\t\tthis._lastOffset=0;\r\n\t\tthis._checkElastic=false;\r\n\t\tthis._lastPoint || (this._lastPoint=new Point());\r\n\t\tthis._lastPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);\r\n\t\tLaya.timer.clear(this,this.tweenMove);\r\n\t\tTween.clearTween(this);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp2);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onStageMouseUp2);\r\n\t\tLaya.timer.frameLoop(1,this,this.loop);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.loop=function(){\r\n\t\tvar mouseY=Laya.stage.mouseY;\r\n\t\tvar mouseX=Laya.stage.mouseX;\r\n\t\tthis._lastOffset=this.isVertical ? (mouseY-this._lastPoint.y):(mouseX-this._lastPoint.x);\r\n\t\tif (this._clickOnly){\r\n\t\t\tif (Math.abs(this._lastOffset *(this.isVertical ? Laya.stage._canvasTransform.getScaleY():Laya.stage._canvasTransform.getScaleX()))> 1){\r\n\t\t\t\tthis._clickOnly=false;\r\n\t\t\t\tthis._offsets || (this._offsets=[]);\r\n\t\t\t\tthis._offsets.length=0;\r\n\t\t\t\tthis._target.mouseEnabled=false;\r\n\t\t\t\tif (!this.hide && this.autoHide){\r\n\t\t\t\t\tthis.alpha=1;\r\n\t\t\t\t\tthis.visible=true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.event(/*laya.events.Event.START*/\"start\");\r\n\t\t\t}else return;\r\n\t\t}\r\n\t\tthis._offsets.push(this._lastOffset);\r\n\t\tthis._lastPoint.x=mouseX;\r\n\t\tthis._lastPoint.y=mouseY;\r\n\t\tif (this._lastOffset===0)return;\r\n\t\tif (!this._checkElastic){\r\n\t\t\tif (this.elasticDistance > 0){\r\n\t\t\t\tif (!this._checkElastic && this._lastOffset !=0){\r\n\t\t\t\t\tif ((this._lastOffset > 0 && this._value <=this.min)|| (this._lastOffset < 0 && this._value >=this.max)){\r\n\t\t\t\t\t\tthis._isElastic=true;\r\n\t\t\t\t\t\tthis._checkElastic=true;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tthis._isElastic=false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._checkElastic=true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._isElastic){\r\n\t\t\tif (this._value <=this.min){\r\n\t\t\t\tthis.value-=this._lastOffset *Math.max(0,(1-((this.min-this._value)/ this.elasticDistance)));\r\n\t\t\t\t}else if (this._value >=this.max){\r\n\t\t\t\tthis.value-=this._lastOffset *Math.max(0,(1-((this._value-this.max)/ this.elasticDistance)));\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis.value-=this._lastOffset;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onStageMouseUp2=function(e){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp2);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onStageMouseUp2);\r\n\t\tLaya.timer.clear(this,this.loop);\r\n\t\tif (this._clickOnly){\r\n\t\t\tif(this._value>=this.min&&this._value<=this.max)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\tthis._target.mouseEnabled=true;\r\n\t\tif (this._isElastic){\r\n\t\t\tif (this._value < this.min){\r\n\t\t\t\tTween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));\r\n\t\t\t\t}else if (this._value > this.max){\r\n\t\t\t\tTween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (!this._offsets)return;\r\n\t\t\tif (this._offsets.length < 1){\r\n\t\t\t\tthis._offsets[0]=this.isVertical ? Laya.stage.mouseY-this._lastPoint.y :Laya.stage.mouseX-this._lastPoint.x;\r\n\t\t\t};\r\n\t\t\tvar offset=0;\r\n\t\t\tvar n=Math.min(this._offsets.length,3);\r\n\t\t\tfor (var i=0;i < n;i++){\r\n\t\t\t\toffset+=this._offsets[this._offsets.length-1-i];\r\n\t\t\t}\r\n\t\t\tthis._lastOffset=offset / n;\r\n\t\t\toffset=Math.abs(this._lastOffset);\r\n\t\t\tif (offset < 2){\r\n\t\t\t\tthis.event(/*laya.events.Event.END*/\"end\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (offset > 60)this._lastOffset=this._lastOffset > 0 ? 60 :-60;\r\n\t\t\tvar dis=Math.round(Math.abs(this.elasticDistance *(this._lastOffset / 240)));\r\n\t\t\tLaya.timer.frameLoop(1,this,this.tweenMove,[dis]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.elasticOver=function(){\r\n\t\tthis._isElastic=false;\r\n\t\tif (!this.hide && this.autoHide){\r\n\t\t\tTween.to(this,{alpha:0},500);\r\n\t\t}\r\n\t\tthis.event(/*laya.events.Event.END*/\"end\");\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.tweenMove=function(maxDistance){\r\n\t\tthis._lastOffset *=this.rollRatio;\r\n\t\tvar tarSpeed=NaN;\r\n\t\tif (maxDistance > 0){\r\n\t\t\tif (this._lastOffset > 0 && this.value <=this.min){\r\n\t\t\t\tthis._isElastic=true;\r\n\t\t\t\ttarSpeed=-(this.min-maxDistance-this.value)*0.5;\r\n\t\t\t\tif (this._lastOffset > tarSpeed)this._lastOffset=tarSpeed;\r\n\t\t\t\t}else if (this._lastOffset < 0 && this.value >=this.max){\r\n\t\t\t\tthis._isElastic=true;\r\n\t\t\t\ttarSpeed=-(this.max+maxDistance-this.value)*0.5;\r\n\t\t\t\tif (this._lastOffset < tarSpeed)this._lastOffset=tarSpeed;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.value-=this._lastOffset;\r\n\t\tif (Math.abs(this._lastOffset)< 1){\r\n\t\t\tLaya.timer.clear(this,this.tweenMove);\r\n\t\t\tif (this._isElastic){\r\n\t\t\t\tif (this._value < this.min){\r\n\t\t\t\t\tTween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));\r\n\t\t\t\t\t}else if (this._value > this.max){\r\n\t\t\t\t\tTween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis.elasticOver();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.event(/*laya.events.Event.END*/\"end\");\r\n\t\t\tif (!this.hide && this.autoHide){\r\n\t\t\t\tTween.to(this,{alpha:0},500);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止滑动。\r\n\t*/\r\n\t__proto.stopScroll=function(){\r\n\t\tthis.onStageMouseUp2(null);\r\n\t\tLaya.timer.clear(this,this.tweenMove);\r\n\t\tTween.clearTween(this);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\tif (this.slider.isVertical)return 100;\r\n\t\treturn this.slider.height;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis.slider.skin=this._skin;\r\n\t\t\tthis.callLater(this.changeScrollBar);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示最高滚动位置的数字。\r\n\t*/\r\n\t__getset(0,__proto,'max',function(){\r\n\t\treturn this.slider.max;\r\n\t\t},function(value){\r\n\t\tthis.slider.max=value;\r\n\t});\r\n\r\n\t/**一个布尔值，指定是否显示向上、向下按钮，默认值为true。*/\r\n\t__getset(0,__proto,'showButtons',function(){\r\n\t\treturn this._showButtons;\r\n\t\t},function(value){\r\n\t\tthis._showButtons=value;\r\n\t\tthis.callLater(this.changeScrollBar);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\tif (this.slider.isVertical)return this.slider.width;\r\n\t\treturn 100;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示最低滚动位置的数字。\r\n\t*/\r\n\t__getset(0,__proto,'min',function(){\r\n\t\treturn this.slider.min;\r\n\t\t},function(value){\r\n\t\tthis.slider.min=value;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示当前滚动位置的数字。\r\n\t*/\r\n\t__getset(0,__proto,'value',function(){\r\n\t\treturn this._value;\r\n\t\t},function(v){\r\n\t\tif (v!==this._value){\r\n\t\t\tthis._value=v;\r\n\t\t\tif (!this._isElastic){\r\n\t\t\t\tif (this.slider._value !=v){\r\n\t\t\t\t\tthis.slider._value=v;\r\n\t\t\t\t\tthis.slider.changeValue();\r\n\t\t\t\t}\r\n\t\t\t\tthis._value=this.slider._value;\r\n\t\t\t}\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tthis.changeHandler && this.changeHandler.runWith(this._value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*一个布尔值，指示滚动条是否为垂直滚动。如果值为true，则为垂直滚动，否则为水平滚动。\r\n\t*<p>默认值为：true。</p>\r\n\t*/\r\n\t__getset(0,__proto,'isVertical',function(){\r\n\t\treturn this.slider.isVertical;\r\n\t\t},function(value){\r\n\t\tthis.slider.isVertical=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的 <code>Slider</code> 实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this.slider.sizeGrid;\r\n\t\t},function(value){\r\n\t\tthis.slider.sizeGrid=value;\r\n\t});\r\n\r\n\t/**获取或设置一个值，该值表示按下滚动条轨道时页面滚动的增量。 */\r\n\t__getset(0,__proto,'scrollSize',function(){\r\n\t\treturn this._scrollSize;\r\n\t\t},function(value){\r\n\t\tthis._scrollSize=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='number')|| (typeof value=='string'))this.value=Number(value);\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**获取或设置一个值，该值表示滑条长度比例，值为：（0-1）。 */\r\n\t__getset(0,__proto,'thumbPercent',function(){\r\n\t\treturn this._thumbPercent;\r\n\t\t},function(value){\r\n\t\tthis.runCallLater(this.changeScrollBar);\r\n\t\tthis.runCallLater(this.changeSize);\r\n\t\tvalue=value >=1 ? 0.99 :value;\r\n\t\tthis._thumbPercent=value;\r\n\t\tif (this.scaleBar){\r\n\t\t\tif (this.slider.isVertical)this.slider.bar.height=Math.max(this.slider.height *value,Styles.scrollBarMinNum);\r\n\t\t\telse this.slider.bar.width=Math.max(this.slider.width *value,Styles.scrollBarMinNum);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置滚动对象。\r\n\t*@see laya.ui.TouchScroll#target\r\n\t*/\r\n\t__getset(0,__proto,'target',function(){\r\n\t\treturn this._target;\r\n\t\t},function(value){\r\n\t\tif (this._target){\r\n\t\t\tthis._target.off(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this,this.onTargetMouseWheel);\r\n\t\t\tthis._target.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onTargetMouseDown);\r\n\t\t}\r\n\t\tthis._target=value;\r\n\t\tif (value){\r\n\t\t\tthis._mouseWheelEnable && this._target.on(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this,this.onTargetMouseWheel);\r\n\t\t\tthis._touchScrollEnable && this._target.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onTargetMouseDown);\r\n\t\t}\r\n\t});\r\n\r\n\t/**是否隐藏滚动条，不显示滚动条，但是可以正常滚动，默认为false。*/\r\n\t__getset(0,__proto,'hide',function(){\r\n\t\treturn this._hide;\r\n\t\t},function(value){\r\n\t\tthis._hide=value;\r\n\t\tthis.visible=!value;\r\n\t});\r\n\r\n\t/**一个布尔值，指定是否开启触摸，默认值为true。*/\r\n\t__getset(0,__proto,'touchScrollEnable',function(){\r\n\t\treturn this._touchScrollEnable;\r\n\t\t},function(value){\r\n\t\tthis._touchScrollEnable=value;\r\n\t\tthis.target=this._target;\r\n\t});\r\n\r\n\t/**一个布尔值，指定是否滑轮滚动，默认值为true。*/\r\n\t__getset(0,__proto,'mouseWheelEnable',function(){\r\n\t\treturn this._mouseWheelEnable;\r\n\t\t},function(value){\r\n\t\tthis._mouseWheelEnable=value;\r\n\t});\r\n\r\n\t/**\r\n\t*滚动的刻度值，滑动数值为tick的整数倍。默认值为1。\r\n\t*/\r\n\t__getset(0,__proto,'tick',function(){\r\n\t\treturn this.slider.tick;\r\n\t\t},function(value){\r\n\t\tthis.slider.tick=value;\r\n\t});\r\n\r\n\treturn ScrollBar;\r\n})(Component)\r\n\r\n\r\n/**\r\n*使用 <code>Slider</code> 控件，用户可以通过在滑块轨道的终点之间移动滑块来选择值。\r\n*<p>滑块的当前值由滑块端点（对应于滑块的最小值和最大值）之间滑块的相对位置确定。</p>\r\n*<p>滑块允许最小值和最大值之间特定间隔内的值。滑块还可以使用数据提示显示其当前值。</p>\r\n*\r\n*@see laya.ui.HSlider\r\n*@see laya.ui.VSlider\r\n*/\r\n//class laya.ui.Slider extends laya.ui.Component\r\nvar Slider=(function(_super){\r\n\tfunction Slider(skin){\r\n\t\t/**\r\n\t\t*数据变化处理器。\r\n\t\t*<p>默认回调参数为滑块位置属性 <code>value</code>属性值：Number 。</p>\r\n\t\t*/\r\n\t\tthis.changeHandler=null;\r\n\t\t/**\r\n\t\t*一个布尔值，指示是否为垂直滚动。如果值为true，则为垂直方向，否则为水平方向。\r\n\t\t*<p>默认值为：true。</p>\r\n\t\t*@default true\r\n\t\t*/\r\n\t\tthis.isVertical=true;\r\n\t\t/**\r\n\t\t*一个布尔值，指示是否显示标签。\r\n\t\t*@default true\r\n\t\t*/\r\n\t\tthis.showLabel=true;\r\n\t\t/**@private */\r\n\t\tthis._allowClickBack=false;\r\n\t\t/**@private */\r\n\t\tthis._max=100;\r\n\t\t/**@private */\r\n\t\tthis._min=0;\r\n\t\t/**@private */\r\n\t\tthis._tick=1;\r\n\t\t/**@private */\r\n\t\tthis._value=0;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._bg=null;\r\n\t\t/**@private */\r\n\t\tthis._progress=null;\r\n\t\t/**@private */\r\n\t\tthis._bar=null;\r\n\t\t/**@private */\r\n\t\tthis._tx=NaN;\r\n\t\t/**@private */\r\n\t\tthis._ty=NaN;\r\n\t\t/**@private */\r\n\t\tthis._maxMove=NaN;\r\n\t\t/**@private */\r\n\t\tthis._globalSacle=null;\r\n\t\tSlider.__super.call(this);\r\n\t\tthis.skin=skin;\r\n\t}\r\n\r\n\t__class(Slider,'laya.ui.Slider',_super);\r\n\tvar __proto=Slider.prototype;\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._bg && this._bg.destroy(destroyChild);\r\n\t\tthis._bar && this._bar.destroy(destroyChild);\r\n\t\tthis._progress && this._progress.destroy(destroyChild);\r\n\t\tthis._bg=null;\r\n\t\tthis._bar=null;\r\n\t\tthis._progress=null;\r\n\t\tthis.changeHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._bg=new Image());\r\n\t\tthis.addChild(this._bar=new Button());\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tthis._bar.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onBarMouseDown);\r\n\t\tthis._bg.sizeGrid=this._bar.sizeGrid=\"4,4,4,4,0\";\r\n\t\tif (this._progress)this._progress.sizeGrid=this._bar.sizeGrid;\r\n\t\tthis.allowClickBack=true;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滑块的的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onBarMouseDown=function(e){\r\n\t\tthis._globalSacle || (this._globalSacle=new Point());\r\n\t\tthis._globalSacle.setTo(this.globalScaleX || 0.01,this.globalScaleY || 0.01);\r\n\t\tthis._maxMove=this.isVertical ? (this.height-this._bar.height):(this.width-this._bar.width);\r\n\t\tthis._tx=Laya.stage.mouseX;\r\n\t\tthis._ty=Laya.stage.mouseY;\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.mouseMove);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.mouseUp);\r\n\t\tLaya.stage.once(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.mouseUp);\r\n\t\tthis.showValueText();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*显示标签。\r\n\t*/\r\n\t__proto.showValueText=function(){\r\n\t\tif (this.showLabel){\r\n\t\t\tvar label=laya.ui.Slider.label;\r\n\t\t\tthis.addChild(label);\r\n\t\t\tlabel.textField.changeText(this._value+\"\");\r\n\t\t\tif (this.isVertical){\r\n\t\t\t\tlabel.x=this._bar.x+20;\r\n\t\t\t\tlabel.y=(this._bar.height-label.height)*0.5+this._bar.y;\r\n\t\t\t\t}else {\r\n\t\t\t\tlabel.y=this._bar.y-20;\r\n\t\t\t\tlabel.x=(this._bar.width-label.width)*0.5+this._bar.x;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*隐藏标签。\r\n\t*/\r\n\t__proto.hideValueText=function(){\r\n\t\tlaya.ui.Slider.label && laya.ui.Slider.label.removeSelf();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.mouseUp=function(e){\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this.mouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.mouseUp);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.mouseUp);\r\n\t\tthis.sendChangeEvent(/*laya.events.Event.CHANGED*/\"changed\");\r\n\t\tthis.hideValueText();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.mouseMove=function(e){\r\n\t\tvar oldValue=this._value;\r\n\t\tif (this.isVertical){\r\n\t\t\tthis._bar.y+=(Laya.stage.mouseY-this._ty)/ this._globalSacle.y;\r\n\t\t\tif (this._bar.y > this._maxMove)this._bar.y=this._maxMove;\r\n\t\t\telse if (this._bar.y < 0)this._bar.y=0;\r\n\t\t\tthis._value=this._bar.y / this._maxMove *(this._max-this._min)+this._min;\r\n\t\t\tif(this._progress)this._progress.height=this._bar.y+0.5*this._bar.height;\r\n\t\t\t}else {\r\n\t\t\tthis._bar.x+=(Laya.stage.mouseX-this._tx)/ this._globalSacle.x;\r\n\t\t\tif (this._bar.x > this._maxMove)this._bar.x=this._maxMove;\r\n\t\t\telse if (this._bar.x < 0)this._bar.x=0;\r\n\t\t\tthis._value=this._bar.x / this._maxMove *(this._max-this._min)+this._min;\r\n\t\t\tif(this._progress)this._progress.width=this._bar.x+0.5*this._bar.width;\r\n\t\t}\r\n\t\tthis._tx=Laya.stage.mouseX;\r\n\t\tthis._ty=Laya.stage.mouseY;\r\n\t\tvar pow=Math.pow(10,(this._tick+\"\").length-1);\r\n\t\tthis._value=Math.round(Math.round(this._value / this._tick)*this._tick *pow)/ pow;\r\n\t\tif (this._value !=oldValue){\r\n\t\t\tthis.sendChangeEvent();\r\n\t\t}\r\n\t\tthis.showValueText();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.sendChangeEvent=function(type){\r\n\t\t(type===void 0)&& (type=/*laya.events.Event.CHANGE*/\"change\");\r\n\t\tthis.event(type);\r\n\t\tthis.changeHandler && this.changeHandler.runWith(this._value);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置滑块的位置信息。\r\n\t*/\r\n\t__proto.setBarPoint=function(){\r\n\t\tif (this.isVertical)this._bar.x=Math.round((this._bg.width-this._bar.width)*0.5);\r\n\t\telse this._bar.y=Math.round((this._bg.height-this._bar.height)*0.5);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.changeSize=function(){\r\n\t\t_super.prototype.changeSize.call(this);\r\n\t\tif (this.isVertical)this._bg.height=this.height;\r\n\t\telse this._bg.width=this.width;\r\n\t\tthis.setBarPoint();\r\n\t\tthis.changeValue();\r\n\t}\r\n\r\n\t/**\r\n\t*设置滑动条的信息。\r\n\t*@param min 滑块的最小值。\r\n\t*@param max 滑块的最小值。\r\n\t*@param value 滑块的当前值。\r\n\t*/\r\n\t__proto.setSlider=function(min,max,value){\r\n\t\tthis._value=-1;\r\n\t\tthis._min=min;\r\n\t\tthis._max=max > min ? max :min;\r\n\t\tthis.value=value < min ? min :value > max ? max :value;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*改变滑块的位置值。\r\n\t*/\r\n\t__proto.changeValue=function(){\r\n\t\tvar pow=Math.pow(10,(this._tick+\"\").length-1);\r\n\t\tthis._value=Math.round(Math.round(this._value / this._tick)*this._tick *pow)/ pow;\r\n\t\tthis._value=this._value > this._max ? this._max :this._value < this._min ? this._min :this._value;\r\n\t\tvar num=this._max-this._min;\r\n\t\tif (num===0)num=1;\r\n\t\tif (this.isVertical){\r\n\t\t\tthis._bar.y=(this._value-this._min)/ num *(this.height-this._bar.height);\r\n\t\t\tif(this._progress)this._progress.height=this._bar.y+0.5*this._bar.height;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis._bar.x=(this._value-this._min)/ num *(this.width-this._bar.width);\r\n\t\t\tif(this._progress)this._progress.width=this._bar.x+0.5*this._bar.width;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滑动条的 <code>Event.MOUSE_DOWN</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onBgMouseDown=function(e){\r\n\t\tvar point=this._bg.getMousePoint();\r\n\t\tif (this.isVertical)this.value=point.y / (this.height-this._bar.height)*(this._max-this._min)+this._min;\r\n\t\telse this.value=point.x / (this.width-this._bar.width)*(this._max-this._min)+this._min;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn Math.max(this._bg.height,this._bar.height);\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis._bg.skin=this._skin;\r\n\t\t\tthis._bar.skin=this._skin.replace(\".png\",\"$bar.png\");\r\n\t\t\tvar progressSkin=this._skin.replace(\".png\",\"$progress.png\");\r\n\t\t\tif (Loader.getRes(progressSkin)){\r\n\t\t\t\tif (!this._progress){\r\n\t\t\t\t\tthis.addChild(this._progress=new Image());\r\n\t\t\t\t\tthis._progress.sizeGrid=this._bar.sizeGrid;\r\n\t\t\t\t\tthis.setChildIndex(this._progress,1);\r\n\t\t\t\t}\r\n\t\t\t\tthis._progress.skin=progressSkin;\r\n\t\t\t}\r\n\t\t\tthis.setBarPoint();\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*一个布尔值，指定是否允许通过点击滑动条改变 <code>Slider</code> 的 <code>value</code> 属性值。\r\n\t*/\r\n\t__getset(0,__proto,'allowClickBack',function(){\r\n\t\treturn this._allowClickBack;\r\n\t\t},function(value){\r\n\t\tif (this._allowClickBack !=value){\r\n\t\t\tthis._allowClickBack=value;\r\n\t\t\tif (value)this._bg.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onBgMouseDown);\r\n\t\t\telse this._bg.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onBgMouseDown);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示最高位置的数字。 默认值为100。\r\n\t*/\r\n\t__getset(0,__proto,'max',function(){\r\n\t\treturn this._max;\r\n\t\t},function(value){\r\n\t\tif (this._max !=value){\r\n\t\t\tthis._max=value;\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn Math.max(this._bg.width,this._bar.width);\r\n\t});\r\n\r\n\t/**\r\n\t*滑动的刻度值，滑动数值为tick的整数倍。默认值为1。\r\n\t*/\r\n\t__getset(0,__proto,'tick',function(){\r\n\t\treturn this._tick;\r\n\t\t},function(value){\r\n\t\tif (this._tick !=value){\r\n\t\t\tthis._tick=value;\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的背景图（ <code>Image</code> ）和滑块按钮（ <code>Button</code> ）实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this._bg.sizeGrid;\r\n\t\t},function(value){\r\n\t\tthis._bg.sizeGrid=value;\r\n\t\tthis._bar.sizeGrid=value;\r\n\t\tif (this._progress)this._progress.sizeGrid=this._bar.sizeGrid;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示最低位置的数字。 默认值为0。\r\n\t*/\r\n\t__getset(0,__proto,'min',function(){\r\n\t\treturn this._min;\r\n\t\t},function(value){\r\n\t\tif (this._min !=value){\r\n\t\t\tthis._min=value;\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置表示当前滑块位置的数字。\r\n\t*/\r\n\t__getset(0,__proto,'value',function(){\r\n\t\treturn this._value;\r\n\t\t},function(num){\r\n\t\tif (this._value !=num){\r\n\t\t\tvar oldValue=this._value;\r\n\t\t\tthis._value=num;\r\n\t\t\tthis.changeValue();\r\n\t\t\tif (this._value !=oldValue){\r\n\t\t\t\tthis.sendChangeEvent();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='number')|| (typeof value=='string'))this.value=Number(value);\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*表示滑块按钮的引用。\r\n\t*/\r\n\t__getset(0,__proto,'bar',function(){\r\n\t\treturn this._bar;\r\n\t});\r\n\r\n\t__static(Slider,\r\n\t['label',function(){return this.label=new Label();}\r\n\t]);\r\n\treturn Slider;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>Image</code> 类是用于表示位图图像或绘制图形的显示对象。\r\n*Image和Clip组件是唯一支持异步加载的两个组件，比如img.skin=\"abc/xxx.png\"，其他UI组件均不支持异步加载。\r\n*\r\n*@example <caption>以下示例代码，创建了一个新的 <code>Image</code> 实例，设置了它的皮肤、位置信息，并添加到舞台上。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Image;\r\n\t*public class Image_Example\r\n\t*{\r\n\t\t*public function Image_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*onInit();\r\n\t\t\t*}\r\n\t\t*private function onInit():void\r\n\t\t*{\r\n\t\t\t*var bg:Image=new Image(\"resource/ui/bg.png\");//创建一个 Image 类的实例对象 bg ,并传入它的皮肤。\r\n\t\t\t*bg.x=100;//设置 bg 对象的属性 x 的值，用于控制 bg 对象的显示位置。\r\n\t\t\t*bg.y=100;//设置 bg 对象的属性 y 的值，用于控制 bg 对象的显示位置。\r\n\t\t\t*bg.sizeGrid=\"40,10,5,10\";//设置 bg 对象的网格信息。\r\n\t\t\t*bg.width=150;//设置 bg 对象的宽度。\r\n\t\t\t*bg.height=250;//设置 bg 对象的高度。\r\n\t\t\t*Laya.stage.addChild(bg);//将此 bg 对象添加到显示列表。\r\n\t\t\t*var image:Image=new Image(\"resource/ui/image.png\");//创建一个 Image 类的实例对象 image ,并传入它的皮肤。\r\n\t\t\t*image.x=100;//设置 image 对象的属性 x 的值，用于控制 image 对象的显示位置。\r\n\t\t\t*image.y=100;//设置 image 对象的属性 y 的值，用于控制 image 对象的显示位置。\r\n\t\t\t*Laya.stage.addChild(image);//将此 image 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*onInit();\r\n*function onInit(){\r\n\t*var bg=new laya.ui.Image(\"resource/ui/bg.png\");//创建一个 Image 类的实例对象 bg ,并传入它的皮肤。\r\n\t*bg.x=100;//设置 bg 对象的属性 x 的值，用于控制 bg 对象的显示位置。\r\n\t*bg.y=100;//设置 bg 对象的属性 y 的值，用于控制 bg 对象的显示位置。\r\n\t*bg.sizeGrid=\"40,10,5,10\";//设置 bg 对象的网格信息。\r\n\t*bg.width=150;//设置 bg 对象的宽度。\r\n\t*bg.height=250;//设置 bg 对象的高度。\r\n\t*Laya.stage.addChild(bg);//将此 bg 对象添加到显示列表。\r\n\t*var image=new laya.ui.Image(\"resource/ui/image.png\");//创建一个 Image 类的实例对象 image ,并传入它的皮肤。\r\n\t*image.x=100;//设置 image 对象的属性 x 的值，用于控制 image 对象的显示位置。\r\n\t*image.y=100;//设置 image 对象的属性 y 的值，用于控制 image 对象的显示位置。\r\n\t*Laya.stage.addChild(image);//将此 image 对象添加到显示列表。\r\n\t*}\r\n*@example\r\n*class Image_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.onInit();\r\n\t\t*}\r\n\t*private onInit():void {\r\n\t\t*var bg:laya.ui.Image=new laya.ui.Image(\"resource/ui/bg.png\");//创建一个 Image 类的实例对象 bg ,并传入它的皮肤。\r\n\t\t*bg.x=100;//设置 bg 对象的属性 x 的值，用于控制 bg 对象的显示位置。\r\n\t\t*bg.y=100;//设置 bg 对象的属性 y 的值，用于控制 bg 对象的显示位置。\r\n\t\t*bg.sizeGrid=\"40,10,5,10\";//设置 bg 对象的网格信息。\r\n\t\t*bg.width=150;//设置 bg 对象的宽度。\r\n\t\t*bg.height=250;//设置 bg 对象的高度。\r\n\t\t*Laya.stage.addChild(bg);//将此 bg 对象添加到显示列表。\r\n\t\t*var image:laya.ui.Image=new laya.ui.Image(\"resource/ui/image.png\");//创建一个 Image 类的实例对象 image ,并传入它的皮肤。\r\n\t\t*image.x=100;//设置 image 对象的属性 x 的值，用于控制 image 对象的显示位置。\r\n\t\t*image.y=100;//设置 image 对象的属性 y 的值，用于控制 image 对象的显示位置。\r\n\t\t*Laya.stage.addChild(image);//将此 image 对象添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*@see laya.ui.AutoBitmap\r\n*/\r\n//class laya.ui.Image extends laya.ui.Component\r\nvar Image=(function(_super){\r\n\tfunction Image(skin){\r\n\t\t/**@private */\r\n\t\tthis._bitmap=null;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._group=null;\r\n\t\tImage.__super.call(this);\r\n\t\tthis.skin=skin;\r\n\t}\r\n\r\n\t__class(Image,'laya.ui.Image',_super);\r\n\tvar __proto=Image.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,true);\r\n\t\tthis._bitmap && this._bitmap.destroy();\r\n\t\tthis._bitmap=null;\r\n\t}\r\n\r\n\t/**\r\n\t*销毁对象并释放加载的皮肤资源。\r\n\t*/\r\n\t__proto.dispose=function(){\r\n\t\tthis.destroy(true);\r\n\t\tLaya.loader.clearRes(this._skin);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.graphics=this._bitmap=new AutoBitmap();\r\n\t\tthis._bitmap.autoCacheCmd=false;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置皮肤资源。\r\n\t*/\r\n\t__proto.setSource=function(url,img){\r\n\t\tif (url===this._skin && img){\r\n\t\t\tthis.source=img\r\n\t\t\tthis.onCompResize();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@copy laya.ui.AutoBitmap#source\r\n\t*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\treturn this._bitmap.source;\r\n\t\t},function(value){\r\n\t\tif (!this._bitmap)return;\r\n\t\tthis._bitmap.source=value;\r\n\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\");\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='string'))this.skin=value;\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn this._bitmap.height;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>对象的皮肤地址，以字符串表示。</p>\r\n\t*<p>如果资源未加载，则先加载资源，加载完成后应用于此对象。</p>\r\n\t*<b>注意：</b>资源加载完成后，会自动缓存至资源库中。\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tif (value){\r\n\t\t\t\tvar source=Loader.getRes(value);\r\n\t\t\t\tif (source){\r\n\t\t\t\t\tthis.source=source;\r\n\t\t\t\t\tthis.onCompResize();\r\n\t\t\t\t}else Laya.loader.load(this._skin,Handler.create(this,this.setSource,[this._skin]),null,/*laya.net.Loader.IMAGE*/\"image\",1,true,this._group);\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.source=null;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*资源分组。\r\n\t*/\r\n\t__getset(0,__proto,'group',function(){\r\n\t\treturn this._group;\r\n\t\t},function(value){\r\n\t\tif (value && this._skin)Loader.setGroup(this._skin,value);\r\n\t\tthis._group=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的位图 <code>AutoImage</code> 实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"。</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap#sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\tif (this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(\",\");\r\n\t\treturn null;\r\n\t\t},function(value){\r\n\t\tthis._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn this._bitmap.width;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tthis._bitmap.width=value==0 ? 0.0000001 :value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tthis._bitmap.height=value==0 ? 0.0000001 :value;\r\n\t});\r\n\r\n\treturn Image;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<p> <code>Label</code> 类用于创建显示对象以显示文本。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>Label</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Label;\r\n\t*public class Label_Example\r\n\t*{\r\n\t\t*public function Label_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*onInit();\r\n\t\t\t*}\r\n\t\t*private function onInit():void\r\n\t\t*{\r\n\t\t\t*var label:Label=new Label();//创建一个 Label 类的实例对象 label 。\r\n\t\t\t*label.font=\"Arial\";//设置 label 的字体。\r\n\t\t\t*label.bold=true;//设置 label 显示为粗体。\r\n\t\t\t*label.leading=4;//设置 label 的行间距。\r\n\t\t\t*label.wordWrap=true;//设置 label 自动换行。\r\n\t\t\t*label.padding=\"10,10,10,10\";//设置 label 的边距。\r\n\t\t\t*label.color=\"#ff00ff\";//设置 label 的颜色。\r\n\t\t\t*label.text=\"Hello everyone,我是一个可爱的文本！\";//设置 label 的文本内容。\r\n\t\t\t*label.x=100;//设置 label 对象的属性 x 的值，用于控制 label 对象的显示位置。\r\n\t\t\t*label.y=100;//设置 label 对象的属性 y 的值，用于控制 label 对象的显示位置。\r\n\t\t\t*label.width=300;//设置 label 的宽度。\r\n\t\t\t*label.height=200;//设置 label 的高度。\r\n\t\t\t*Laya.stage.addChild(label);//将 label 添加到显示列表。\r\n\t\t\t*var passwordLabel:Label=new Label(\"请原谅我，我不想被人看到我心里话。\");//创建一个 Label 类的实例对象 passwordLabel 。\r\n\t\t\t*passwordLabel.asPassword=true;//设置 passwordLabel 的显示反式为密码显示。\r\n\t\t\t*passwordLabel.x=100;//设置 passwordLabel 对象的属性 x 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t\t\t*passwordLabel.y=350;//设置 passwordLabel 对象的属性 y 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t\t\t*passwordLabel.width=300;//设置 passwordLabel 的宽度。\r\n\t\t\t*passwordLabel.color=\"#000000\";//设置 passwordLabel 的文本颜色。\r\n\t\t\t*passwordLabel.bgColor=\"#ccffff\";//设置 passwordLabel 的背景颜色。\r\n\t\t\t*passwordLabel.fontSize=20;//设置 passwordLabel 的文本字体大小。\r\n\t\t\t*Laya.stage.addChild(passwordLabel);//将 passwordLabel 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*onInit();\r\n*function onInit(){\r\n\t*var label=new laya.ui.Label();//创建一个 Label 类的实例对象 label 。\r\n\t*label.font=\"Arial\";//设置 label 的字体。\r\n\t*label.bold=true;//设置 label 显示为粗体。\r\n\t*label.leading=4;//设置 label 的行间距。\r\n\t*label.wordWrap=true;//设置 label 自动换行。\r\n\t*label.padding=\"10,10,10,10\";//设置 label 的边距。\r\n\t*label.color=\"#ff00ff\";//设置 label 的颜色。\r\n\t*label.text=\"Hello everyone,我是一个可爱的文本！\";//设置 label 的文本内容。\r\n\t*label.x=100;//设置 label 对象的属性 x 的值，用于控制 label 对象的显示位置。\r\n\t*label.y=100;//设置 label 对象的属性 y 的值，用于控制 label 对象的显示位置。\r\n\t*label.width=300;//设置 label 的宽度。\r\n\t*label.height=200;//设置 label 的高度。\r\n\t*Laya.stage.addChild(label);//将 label 添加到显示列表。\r\n\t*var passwordLabel=new laya.ui.Label(\"请原谅我，我不想被人看到我心里话。\");//创建一个 Label 类的实例对象 passwordLabel 。\r\n\t*passwordLabel.asPassword=true;//设置 passwordLabel 的显示反式为密码显示。\r\n\t*passwordLabel.x=100;//设置 passwordLabel 对象的属性 x 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t*passwordLabel.y=350;//设置 passwordLabel 对象的属性 y 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t*passwordLabel.width=300;//设置 passwordLabel 的宽度。\r\n\t*passwordLabel.color=\"#000000\";//设置 passwordLabel 的文本颜色。\r\n\t*passwordLabel.bgColor=\"#ccffff\";//设置 passwordLabel 的背景颜色。\r\n\t*passwordLabel.fontSize=20;//设置 passwordLabel 的文本字体大小。\r\n\t*Laya.stage.addChild(passwordLabel);//将 passwordLabel 添加到显示列表。\r\n\t*}\r\n*@example\r\n*import Label=laya.ui.Label;\r\n*class Label_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.onInit();\r\n\t\t*}\r\n\t*private onInit():void {\r\n\t\t*var label:Label=new Label();//创建一个 Label 类的实例对象 label 。\r\n\t\t*label.font=\"Arial\";//设置 label 的字体。\r\n\t\t*label.bold=true;//设置 label 显示为粗体。\r\n\t\t*label.leading=4;//设置 label 的行间距。\r\n\t\t*label.wordWrap=true;//设置 label 自动换行。\r\n\t\t*label.padding=\"10,10,10,10\";//设置 label 的边距。\r\n\t\t*label.color=\"#ff00ff\";//设置 label 的颜色。\r\n\t\t*label.text=\"Hello everyone,我是一个可爱的文本！\";//设置 label 的文本内容。\r\n\t\t*label.x=100;//设置 label 对象的属性 x 的值，用于控制 label 对象的显示位置。\r\n\t\t*label.y=100;//设置 label 对象的属性 y 的值，用于控制 label 对象的显示位置。\r\n\t\t*label.width=300;//设置 label 的宽度。\r\n\t\t*label.height=200;//设置 label 的高度。\r\n\t\t*Laya.stage.addChild(label);//将 label 添加到显示列表。\r\n\t\t*var passwordLabel:Label=new Label(\"请原谅我，我不想被人看到我心里话。\");//创建一个 Label 类的实例对象 passwordLabel 。\r\n\t\t*passwordLabel.asPassword=true;//设置 passwordLabel 的显示反式为密码显示。\r\n\t\t*passwordLabel.x=100;//设置 passwordLabel 对象的属性 x 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t\t*passwordLabel.y=350;//设置 passwordLabel 对象的属性 y 的值，用于控制 passwordLabel 对象的显示位置。\r\n\t\t*passwordLabel.width=300;//设置 passwordLabel 的宽度。\r\n\t\t*passwordLabel.color=\"#000000\";//设置 passwordLabel 的文本颜色。\r\n\t\t*passwordLabel.bgColor=\"#ccffff\";//设置 passwordLabel 的背景颜色。\r\n\t\t*passwordLabel.fontSize=20;//设置 passwordLabel 的文本字体大小。\r\n\t\t*Laya.stage.addChild(passwordLabel);//将 passwordLabel 添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*@see laya.display.Text\r\n*/\r\n//class laya.ui.Label extends laya.ui.Component\r\nvar Label=(function(_super){\r\n\tfunction Label(text){\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*文本 <code>Text</code> 实例。\r\n\t\t*/\r\n\t\tthis._tf=null;\r\n\t\tLabel.__super.call(this);\r\n\t\t(text===void 0)&& (text=\"\");\r\n\t\tFont.defaultColor=Styles.labelColor;\r\n\t\tthis.text=text;\r\n\t}\r\n\r\n\t__class(Label,'laya.ui.Label',_super);\r\n\tvar __proto=Label.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._tf=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._tf=new Text());\r\n\t}\r\n\r\n\t/**@copy laya.display.Text#changeText()\r\n\t**/\r\n\t__proto.changeText=function(text){\r\n\t\tthis._tf.changeText(text);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>边距信息</p>\r\n\t*<p>\"上边距，右边距，下边距 , 左边距（边距以像素为单位）\"</p>\r\n\t*@see laya.display.Text.padding\r\n\t*/\r\n\t__getset(0,__proto,'padding',function(){\r\n\t\treturn this._tf.padding.join(\",\");\r\n\t\t},function(value){\r\n\t\tthis._tf.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#bold\r\n\t*/\r\n\t__getset(0,__proto,'bold',function(){\r\n\t\treturn this._tf.bold;\r\n\t\t},function(value){\r\n\t\tthis._tf.bold=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#align\r\n\t*/\r\n\t__getset(0,__proto,'align',function(){\r\n\t\treturn this._tf.align;\r\n\t\t},function(value){\r\n\t\tthis._tf.align=value;\r\n\t});\r\n\r\n\t/**\r\n\t*当前文本内容字符串。\r\n\t*@see laya.display.Text.text\r\n\t*/\r\n\t__getset(0,__proto,'text',function(){\r\n\t\treturn this._tf.text;\r\n\t\t},function(value){\r\n\t\tif (this._tf.text !=value){\r\n\t\t\tif(value)\r\n\t\t\t\tvalue=UIUtils.adptString(value+\"\");\r\n\t\t\tthis._tf.text=value;\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tif (!this._width || !this._height)this.onCompResize();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#italic\r\n\t*/\r\n\t__getset(0,__proto,'italic',function(){\r\n\t\treturn this._tf.italic;\r\n\t\t},function(value){\r\n\t\tthis._tf.italic=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#wordWrap\r\n\t*/\r\n\t/**\r\n\t*@copy laya.display.Text#wordWrap\r\n\t*/\r\n\t__getset(0,__proto,'wordWrap',function(){\r\n\t\treturn this._tf.wordWrap;\r\n\t\t},function(value){\r\n\t\tthis._tf.wordWrap=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#font\r\n\t*/\r\n\t__getset(0,__proto,'font',function(){\r\n\t\treturn this._tf.font;\r\n\t\t},function(value){\r\n\t\tthis._tf.font=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='number')|| (typeof value=='string'))this.text=value+\"\";\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#color\r\n\t*/\r\n\t__getset(0,__proto,'color',function(){\r\n\t\treturn this._tf.color;\r\n\t\t},function(value){\r\n\t\tthis._tf.color=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#valign\r\n\t*/\r\n\t__getset(0,__proto,'valign',function(){\r\n\t\treturn this._tf.valign;\r\n\t\t},function(value){\r\n\t\tthis._tf.valign=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#leading\r\n\t*/\r\n\t__getset(0,__proto,'leading',function(){\r\n\t\treturn this._tf.leading;\r\n\t\t},function(value){\r\n\t\tthis._tf.leading=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#fontSize\r\n\t*/\r\n\t__getset(0,__proto,'fontSize',function(){\r\n\t\treturn this._tf.fontSize;\r\n\t\t},function(value){\r\n\t\tthis._tf.fontSize=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#bgColor\r\n\t*/\r\n\t__getset(0,__proto,'bgColor',function(){\r\n\t\treturn this._tf.bgColor\r\n\t\t},function(value){\r\n\t\tthis._tf.bgColor=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#borderColor\r\n\t*/\r\n\t__getset(0,__proto,'borderColor',function(){\r\n\t\treturn this._tf.borderColor\r\n\t\t},function(value){\r\n\t\tthis._tf.borderColor=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#stroke\r\n\t*/\r\n\t__getset(0,__proto,'stroke',function(){\r\n\t\treturn this._tf.stroke;\r\n\t\t},function(value){\r\n\t\tthis._tf.stroke=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#strokeColor\r\n\t*/\r\n\t__getset(0,__proto,'strokeColor',function(){\r\n\t\treturn this._tf.strokeColor;\r\n\t\t},function(value){\r\n\t\tthis._tf.strokeColor=value;\r\n\t});\r\n\r\n\t/**\r\n\t*文本控件实体 <code>Text</code> 实例。\r\n\t*/\r\n\t__getset(0,__proto,'textField',function(){\r\n\t\treturn this._tf;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn this._tf.width;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn this._tf.height;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._width || this._tf.text)return Laya.superGet(Component,this,'width');\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tthis._tf.width=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._height || this._tf.text)return Laya.superGet(Component,this,'height');\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tthis._tf.height=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#overflow\r\n\t*/\r\n\t/**\r\n\t*@copy laya.display.Text#overflow\r\n\t*/\r\n\t__getset(0,__proto,'overflow',function(){\r\n\t\treturn this._tf.overflow;\r\n\t\t},function(value){\r\n\t\tthis._tf.overflow=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#underline\r\n\t*/\r\n\t/**\r\n\t*@copy laya.display.Text#underline\r\n\t*/\r\n\t__getset(0,__proto,'underline',function(){\r\n\t\treturn this._tf.underline;\r\n\t\t},function(value){\r\n\t\tthis._tf.underline=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Text#underlineColor\r\n\t*/\r\n\t/**\r\n\t*@copy laya.display.Text#underlineColor\r\n\t*/\r\n\t__getset(0,__proto,'underlineColor',function(){\r\n\t\treturn this._tf.underlineColor;\r\n\t\t},function(value){\r\n\t\tthis._tf.underlineColor=value;\r\n\t});\r\n\r\n\treturn Label;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>ProgressBar</code> 组件显示内容的加载进度。\r\n*@example <caption>以下示例代码，创建了一个新的 <code>ProgressBar</code> 实例，设置了它的皮肤、位置、宽高、网格等信息，并添加到舞台上。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.ProgressBar;\r\n\t*import laya.utils.Handler;\r\n\t*public class ProgressBar_Example\r\n\t*{\r\n\t\t*private var progressBar:ProgressBar;\r\n\t\t*public function ProgressBar_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/progress.png\",\"resource/ui/progress$bar.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*progressBar=new ProgressBar(\"resource/ui/progress.png\");//创建一个 ProgressBar 类的实例对象 progressBar 。\r\n\t\t\t*progressBar.x=100;//设置 progressBar 对象的属性 x 的值，用于控制 progressBar 对象的显示位置。\r\n\t\t\t*progressBar.y=100;//设置 progressBar 对象的属性 y 的值，用于控制 progressBar 对象的显示位置。\r\n\t\t\t*progressBar.value=0.3;//设置 progressBar 的进度值。\r\n\t\t\t*progressBar.width=200;//设置 progressBar 的宽度。\r\n\t\t\t*progressBar.height=50;//设置 progressBar 的高度。\r\n\t\t\t*progressBar.sizeGrid=\"5,10,5,10\";//设置 progressBar 的网格信息。\r\n\t\t\t*progressBar.changeHandler=new Handler(this,onChange);//设置 progressBar 的value值改变时执行的处理器。\r\n\t\t\t*Laya.stage.addChild(progressBar);//将 progressBar 添加到显示列表。\r\n\t\t\t*Laya.timer.once(3000,this,changeValue);//设定 3000ms（毫秒）后，执行函数changeValue。\r\n\t\t\t*}\r\n\t\t*private function changeValue():void\r\n\t\t*{\r\n\t\t\t*trace(\"改变进度条的进度值。\");\r\n\t\t\t*progressBar.value=0.6;\r\n\t\t\t*}\r\n\t\t*private function onChange(value:Number):void\r\n\t\t*{\r\n\t\t\t*trace(\"进度发生改变： value=\" ,value);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var res=[\"resource/ui/progress.png\",\"resource/ui/progress$bar.png\"];\r\n*Laya.loader.load(res,laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete()\r\n*{\r\n\t*progressBar=new laya.ui.ProgressBar(\"resource/ui/progress.png\");//创建一个 ProgressBar 类的实例对象 progressBar 。\r\n\t*progressBar.x=100;//设置 progressBar 对象的属性 x 的值，用于控制 progressBar 对象的显示位置。\r\n\t*progressBar.y=100;//设置 progressBar 对象的属性 y 的值，用于控制 progressBar 对象的显示位置。\r\n\t*progressBar.value=0.3;//设置 progressBar 的进度值。\r\n\t*progressBar.width=200;//设置 progressBar 的宽度。\r\n\t*progressBar.height=50;//设置 progressBar 的高度。\r\n\t*progressBar.sizeGrid=\"10,5,10,5\";//设置 progressBar 的网格信息。\r\n\t*progressBar.changeHandler=new laya.utils.Handler(this,onChange);//设置 progressBar 的value值改变时执行的处理器。\r\n\t*Laya.stage.addChild(progressBar);//将 progressBar 添加到显示列表。\r\n\t*Laya.timer.once(3000,this,changeValue);//设定 3000ms（毫秒）后，执行函数changeValue。\r\n\t*}\r\n*function changeValue()\r\n*{\r\n\t*console.log(\"改变进度条的进度值。\");\r\n\t*progressBar.value=0.6;\r\n\t*}\r\n*function onChange(value)\r\n*{\r\n\t*console.log(\"进度发生改变： value=\" ,value);\r\n\t*}\r\n*@example\r\n*import ProgressBar=laya.ui.ProgressBar;\r\n*import Handler=laya.utils.Handler;\r\n*class ProgressBar_Example {\r\n\t*private progressBar:ProgressBar;\r\n\t*public ProgressBar_Example(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/progress.png\",\"resource/ui/progress$bar.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.progressBar=new ProgressBar(\"resource/ui/progress.png\");//创建一个 ProgressBar 类的实例对象 progressBar 。\r\n\t\t*this.progressBar.x=100;//设置 progressBar 对象的属性 x 的值，用于控制 progressBar 对象的显示位置。\r\n\t\t*this.progressBar.y=100;//设置 progressBar 对象的属性 y 的值，用于控制 progressBar 对象的显示位置。\r\n\t\t*this.progressBar.value=0.3;//设置 progressBar 的进度值。\r\n\t\t*this.progressBar.width=200;//设置 progressBar 的宽度。\r\n\t\t*this.progressBar.height=50;//设置 progressBar 的高度。\r\n\t\t*this.progressBar.sizeGrid=\"5,10,5,10\";//设置 progressBar 的网格信息。\r\n\t\t*this.progressBar.changeHandler=new Handler(this,this.onChange);//设置 progressBar 的value值改变时执行的处理器。\r\n\t\t*Laya.stage.addChild(this.progressBar);//将 progressBar 添加到显示列表。\r\n\t\t*Laya.timer.once(3000,this,this.changeValue);//设定 3000ms（毫秒）后，执行函数changeValue。\r\n\t\t*}\r\n\t*private changeValue():void {\r\n\t\t*console.log(\"改变进度条的进度值。\");\r\n\t\t*this.progressBar.value=0.6;\r\n\t\t*}\r\n\t*private onChange(value:number):void {\r\n\t\t*console.log(\"进度发生改变： value=\",value);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.ProgressBar extends laya.ui.Component\r\nvar ProgressBar=(function(_super){\r\n\tfunction ProgressBar(skin){\r\n\t\t/**\r\n\t\t*当 <code>ProgressBar</code> 实例的 <code>value</code> 属性发生变化时的函数处理器。\r\n\t\t*<p>默认返回参数<code>value</code> 属性（进度值）。</p>\r\n\t\t*/\r\n\t\tthis.changeHandler=null;\r\n\t\t/**@private */\r\n\t\tthis._bg=null;\r\n\t\t/**@private */\r\n\t\tthis._bar=null;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._value=0.5;\r\n\t\tProgressBar.__super.call(this);\r\n\t\tthis.skin=skin;\r\n\t}\r\n\r\n\t__class(ProgressBar,'laya.ui.ProgressBar',_super);\r\n\tvar __proto=ProgressBar.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._bg && this._bg.destroy(destroyChild);\r\n\t\tthis._bar && this._bar.destroy(destroyChild);\r\n\t\tthis._bg=this._bar=null;\r\n\t\tthis.changeHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._bg=new Image());\r\n\t\tthis.addChild(this._bar=new Image());\r\n\t\tthis._bar._bitmap.autoCacheCmd=false;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*更改进度值的显示。\r\n\t*/\r\n\t__proto.changeValue=function(){\r\n\t\tif (this.sizeGrid){\r\n\t\t\tvar grid=this.sizeGrid.split(\",\");\r\n\t\t\tvar left=Number(grid[3]);\r\n\t\t\tvar right=Number(grid[1]);\r\n\t\t\tvar max=this.width-left-right;\r\n\t\t\tvar sw=max *this._value;\r\n\t\t\tthis._bar.width=left+right+sw;\r\n\t\t\tthis._bar.visible=this._bar.width > left+right;\r\n\t\t\t}else {\r\n\t\t\tthis._bar.width=this.width *this._value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn this._bg.height;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis._bg.skin=this._skin;\r\n\t\t\tthis._bar.skin=this._skin.replace(\".png\",\"$bar.png\");\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn this._bg.width;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Component,this,'height',value);\r\n\t\tthis._bg.height=this._height;\r\n\t\tthis._bar.height=this._height;\r\n\t});\r\n\r\n\t/**\r\n\t*获取进度条对象。\r\n\t*/\r\n\t__getset(0,__proto,'bar',function(){\r\n\t\treturn this._bar;\r\n\t});\r\n\r\n\t/**\r\n\t*当前的进度量。\r\n\t*<p><b>取值：</b>介于0和1之间。</p>\r\n\t*/\r\n\t__getset(0,__proto,'value',function(){\r\n\t\treturn this._value;\r\n\t\t},function(num){\r\n\t\tif (this._value !=num){\r\n\t\t\tnum=num > 1 ? 1 :num < 0 ? 0 :num;\r\n\t\t\tthis._value=num;\r\n\t\t\tthis.callLater(this.changeValue);\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tthis.changeHandler && this.changeHandler.runWith(num);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取背景条对象。\r\n\t*/\r\n\t__getset(0,__proto,'bg',function(){\r\n\t\treturn this._bg;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前 <code>ProgressBar</code> 实例的进度条背景位图（ <code>Image</code> 实例）的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this._bg.sizeGrid;\r\n\t\t},function(value){\r\n\t\tthis._bg.sizeGrid=this._bar.sizeGrid=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Component,this,'width',value);\r\n\t\tthis._bg.width=this._width;\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='number')|| (typeof value=='string'))this.value=Number(value);\r\n\t\telse Laya.superSet(Component,this,'dataSource',value);\r\n\t});\r\n\r\n\treturn ProgressBar;\r\n})(Component)\r\n\r\n\r\n/**鼠标提示管理类*/\r\n//class laya.ui.TipManager extends laya.ui.Component\r\nvar TipManager=(function(_super){\r\n\tfunction TipManager(){\r\n\t\tthis._tipBox=null;\r\n\t\tthis._tipText=null;\r\n\t\tthis._defaultTipHandler=null;\r\n\t\tTipManager.__super.call(this);\r\n\t\tthis._tipBox=new Component();\r\n\t\tthis._tipBox.addChild(this._tipText=new Text());\r\n\t\tthis._tipText.x=this._tipText.y=5;\r\n\t\tthis._tipText.color=TipManager.tipTextColor;\r\n\t\tthis._defaultTipHandler=this._showDefaultTip;\r\n\t\tLaya.stage.on(/*laya.ui.UIEvent.SHOW_TIP*/\"showtip\",this,this._onStageShowTip);\r\n\t\tLaya.stage.on(/*laya.ui.UIEvent.HIDE_TIP*/\"hidetip\",this,this._onStageHideTip);\r\n\t\tthis.zOrder=1100\r\n\t}\r\n\r\n\t__class(TipManager,'laya.ui.TipManager',_super);\r\n\tvar __proto=TipManager.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onStageHideTip=function(e){\r\n\t\tLaya.timer.clear(this,this._showTip);\r\n\t\tthis.closeAll();\r\n\t\tthis.removeSelf();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onStageShowTip=function(data){\r\n\t\tLaya.timer.once(TipManager.tipDelay,this,this._showTip,[data],true);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._showTip=function(tip){\r\n\t\tif ((typeof tip=='string')){\r\n\t\t\tvar text=String(tip);\r\n\t\t\tif (Boolean(text)){\r\n\t\t\t\tthis._defaultTipHandler(text);\r\n\t\t\t}\r\n\t\t\t}else if ((tip instanceof laya.utils.Handler )){\r\n\t\t\t(tip).run();\r\n\t\t\t}else if ((typeof tip=='function')){\r\n\t\t\t(tip).apply();\r\n\t\t}\r\n\t\tif (true){\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this._onStageMouseMove);\r\n\t\t\tLaya.stage.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onStageMouseDown);\r\n\t\t}\r\n\t\tthis._onStageMouseMove(null);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onStageMouseDown=function(e){\r\n\t\tthis.closeAll();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onStageMouseMove=function(e){\r\n\t\tthis._showToStage(this,TipManager.offsetX,TipManager.offsetY);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._showToStage=function(dis,offX,offY){\r\n\t\t(offX===void 0)&& (offX=0);\r\n\t\t(offY===void 0)&& (offY=0);\r\n\t\tvar rec=dis.getBounds();\r\n\t\tdis.x=Laya.stage.mouseX+offX;\r\n\t\tdis.y=Laya.stage.mouseY+offY;\r\n\t\tif (dis.x+rec.width > Laya.stage.width){\r\n\t\t\tdis.x-=rec.width+offX;\r\n\t\t}\r\n\t\tif (dis.y+rec.height > Laya.stage.height){\r\n\t\t\tdis.y-=rec.height+offY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**关闭所有鼠标提示*/\r\n\t__proto.closeAll=function(){\r\n\t\tLaya.timer.clear(this,this._showTip);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this._onStageMouseMove);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onStageMouseDown);\r\n\t\tthis.removeChildren();\r\n\t}\r\n\r\n\t/**\r\n\t*显示显示对象类型的tip\r\n\t*/\r\n\t__proto.showDislayTip=function(tip){\r\n\t\tthis.addChild(tip);\r\n\t\tthis._showToStage(this);\r\n\t\tLaya._currentStage.addChild(this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._showDefaultTip=function(text){\r\n\t\tthis._tipText.text=text;\r\n\t\tvar g=this._tipBox.graphics;\r\n\t\tg.clear();\r\n\t\tg.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,TipManager.tipBackColor);\r\n\t\tthis.addChild(this._tipBox);\r\n\t\tthis._showToStage(this);\r\n\t\tLaya._currentStage.addChild(this);\r\n\t}\r\n\r\n\t/**默认鼠标提示函数*/\r\n\t__getset(0,__proto,'defaultTipHandler',function(){\r\n\t\treturn this._defaultTipHandler;\r\n\t\t},function(value){\r\n\t\tthis._defaultTipHandler=value;\r\n\t});\r\n\r\n\tTipManager.offsetX=10;\r\n\tTipManager.offsetY=15;\r\n\tTipManager.tipTextColor=\"#ffffff\";\r\n\tTipManager.tipBackColor=\"#111111\";\r\n\tTipManager.tipDelay=200;\r\n\treturn TipManager;\r\n})(Component)\r\n\r\n\r\n/**\r\n*<code>View</code> 是一个视图类。\r\n*@internal <p><code>View</code></p>\r\n*/\r\n//class laya.ui.View extends laya.ui.Box\r\nvar View=(function(_super){\r\n\tvar DataWatcher;\r\n\tfunction View(){\r\n\t\t/**@private */\r\n\t\tthis._idMap=null;\r\n\t\t/**@private */\r\n\t\tthis._aniList=null;\r\n\t\t/**@private */\r\n\t\tthis._watchMap={};\r\n\t\tView.__super.call(this);\r\n\t}\r\n\r\n\t__class(View,'laya.ui.View',_super);\r\n\tvar __proto=View.prototype;\r\n\t/**\r\n\t*@private\r\n\t*通过视图数据创建视图。\r\n\t*@param uiView 视图数据信息。\r\n\t*/\r\n\t__proto.createView=function(uiView){\r\n\t\tif (uiView.animations && !this._idMap)this._idMap={};\r\n\t\tView.createComp(uiView,this,this);\r\n\t\tif (uiView.animations){\r\n\t\t\tvar anilist=[];\r\n\t\t\tvar animations=uiView.animations;\r\n\t\t\tvar i=0,len=animations.length;\r\n\t\t\tvar tAni;\r\n\t\t\tvar tAniO;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttAni=new FrameAnimation();\r\n\t\t\t\ttAniO=animations[i];\r\n\t\t\t\ttAni._setUp(this._idMap,tAniO);\r\n\t\t\t\tthis[tAniO.name]=tAni;\r\n\t\t\t\ttAni._setControlNode(this);\r\n\t\t\t\tswitch (tAniO.action){\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\ttAni.play(0,false);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\ttAni.play(0,true);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\tanilist.push(tAni);\r\n\t\t\t}\r\n\t\t\tthis._aniList=anilist;\r\n\t\t}\r\n\t\tif (this._width > 0 && uiView.props.hitTestPrior==null && !this.mouseThrough)this.hitTestPrior=true;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*装载UI视图。用于加载模式。\r\n\t*@param path UI资源地址。\r\n\t*/\r\n\t__proto.loadUI=function(path){\r\n\t\tvar uiView=View.uiMap[path];\r\n\t\tuiView && this.createView(uiView);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>销毁此对象。</p>\r\n\t*@param destroyChild 是否同时销毁子节点，若值为true,则销毁子节点，否则不销毁子节点。\r\n\t*/\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tif (this._aniList)this._aniList.length=0;\r\n\t\tthis._idMap=null;\r\n\t\tthis._aniList=null;\r\n\t\tthis._watchMap=null;\r\n\t\tlaya.ui.Component.prototype.destroy.call(this,destroyChild);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.changeData=function(key){\r\n\t\tvar arr=this._watchMap[key];\r\n\t\tif (!arr)return;\r\n\t\tconsole.log(\"change\",key);\r\n\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\tvar watcher=arr[i];\r\n\t\t\twatcher.exe(this);\r\n\t\t}\r\n\t}\r\n\r\n\tView._regs=function(){\r\n\t\tfor (var key in View.uiClassMap){\r\n\t\t\tClassUtils.regClass(key,View.uiClassMap[key]);\r\n\t\t}\r\n\t}\r\n\r\n\tView.createComp=function(uiView,comp,view,dataMap){\r\n\t\tcomp=comp || View.getCompInstance(uiView);\r\n\t\tif (!comp){\r\n\t\t\tconsole.warn(\"can not create:\"+uiView.type);\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\tvar child=uiView.child;\r\n\t\tif (child){\r\n\t\t\tvar isList=(comp instanceof laya.ui.List );\r\n\t\t\tfor (var i=0,n=child.length;i < n;i++){\r\n\t\t\t\tvar node=child[i];\r\n\t\t\t\tif (comp.hasOwnProperty(\"itemRender\")&& (node.props.name==\"render\" || node.props.renderType===\"render\")){\r\n\t\t\t\t\t(comp).itemRender=node;\r\n\t\t\t\t\t}else if (node.type==\"Graphic\"){\r\n\t\t\t\t\tClassUtils.addGraphicsToSprite(node,comp);\r\n\t\t\t\t\t}else if (ClassUtils.isDrawType(node.type)){\r\n\t\t\t\t\tClassUtils.addGraphicToSprite(node,comp,true);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tif (isList){\r\n\t\t\t\t\t\tvar arr=[];\r\n\t\t\t\t\t\tvar tChild=View.createComp(node,null,view,arr);\r\n\t\t\t\t\t\tif (arr.length)tChild[\"_$bindData\"]=arr;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttChild=View.createComp(node,null,view,dataMap);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (node.type==\"Script\"){\r\n\t\t\t\t\t\tif (\"owner\" in tChild){\r\n\t\t\t\t\t\t\ttChild[\"owner\"]=comp;\r\n\t\t\t\t\t\t\t}else if (\"target\" in tChild){\r\n\t\t\t\t\t\t\ttChild[\"target\"]=comp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else if (node.props.renderType==\"mask\" || node.props.name==\"mask\"){\r\n\t\t\t\t\t\tcomp.mask=tChild;\r\n\t\t\t\t\t\t}else {(\r\n\t\t\t\t\t\ttChild instanceof laya.display.Sprite )&& comp.addChild(tChild);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar props=uiView.props;\r\n\t\tfor (var prop in props){\r\n\t\t\tvar value=props[prop];\r\n\t\t\tView.setCompValue(comp,prop,value,view,dataMap);\r\n\t\t}\r\n\t\tif (Laya.__typeof(comp,'laya.ui.IItem'))(comp).initItems();\r\n\t\tif (uiView.compId && view && view._idMap){\r\n\t\t\tview._idMap[uiView.compId]=comp;\r\n\t\t}\r\n\t\treturn comp;\r\n\t}\r\n\r\n\tView.setCompValue=function(comp,prop,value,view,dataMap){\r\n\t\tif ((typeof value=='string')&& value.indexOf(\"${\")>-1){\r\n\t\t\tView._sheet || (View._sheet=ClassUtils.getClass(\"laya.data.Table\"));\r\n\t\t\tif (!View._sheet){\r\n\t\t\t\tconsole.warn(\"Can not find class Sheet\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (dataMap){\r\n\t\t\t\tdataMap.push(comp,prop,value);\r\n\t\t\t\t}else if (view){\r\n\t\t\t\tif (value.indexOf(\"].\")==-1){\r\n\t\t\t\t\tvalue=value.replace(\".\",\"[0].\");\r\n\t\t\t\t};\r\n\t\t\t\tvar watcher=new DataWatcher(comp,prop,value);\r\n\t\t\t\twatcher.exe(view);\r\n\t\t\t\tvar one,temp;\r\n\t\t\t\tvar str=value.replace(/\\[.*?\\]\\./g,\".\");\r\n\t\t\t\twhile ((one=View._parseWatchData.exec(str))!=null){\r\n\t\t\t\t\tvar key1=one[1];\r\n\t\t\t\t\twhile ((temp=View._parseKeyWord.exec(key1))!=null){\r\n\t\t\t\t\t\tvar key2=temp[0];\r\n\t\t\t\t\t\tvar arr=(view._watchMap[key2] || (view._watchMap[key2]=[]));\r\n\t\t\t\t\t\tarr.push(watcher);\r\n\t\t\t\t\t\tView._sheet.I.notifer.on(key2,view,view.changeData,[key2]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarr=(view._watchMap[key1] || (view._watchMap[key1]=[]));\r\n\t\t\t\t\tarr.push(watcher);\r\n\t\t\t\t\tView._sheet.I.notifer.on(key1,view,view.changeData,[key1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (prop===\"var\" && view){\r\n\t\t\tview[value]=comp;\r\n\t\t\t}else if (prop==\"onClick\"){\r\n\t\t\tvar fun=Browser.window.eval(\"(function(){\"+value+\"})\");\r\n\t\t\tcomp.on(/*laya.events.Event.CLICK*/\"click\",view,fun);\r\n\t\t\t}else {\r\n\t\t\tcomp[prop]=(value===\"true\" ? true :(value===\"false\" ? false :value));\r\n\t\t}\r\n\t}\r\n\r\n\tView.getCompInstance=function(json){\r\n\t\tvar runtime=json.props ? json.props.runtime :null;\r\n\t\tvar compClass;\r\n\t\tcompClass=runtime ? (View.viewClassMap[runtime] || View.uiClassMap[runtime]|| Laya[\"__classmap\"][runtime]):View.uiClassMap[json.type];\r\n\t\tif (json.props && json.props.hasOwnProperty(\"renderType\")&& json.props[\"renderType\"]==\"instance\")return compClass[\"instance\"];\r\n\t\treturn compClass ? new compClass():null;\r\n\t}\r\n\r\n\tView.regComponent=function(key,compClass){\r\n\t\tView.uiClassMap[key]=compClass;\r\n\t\tClassUtils.regClass(key,compClass);\r\n\t}\r\n\r\n\tView.regViewRuntime=function(key,compClass){\r\n\t\tView.viewClassMap[key]=compClass;\r\n\t}\r\n\r\n\tView.uiMap={};\r\n\tView.viewClassMap={};\r\n\tView._sheet=null;\r\n\t__static(View,\r\n\t['uiClassMap',function(){return this.uiClassMap={\"ViewStack\":ViewStack,\"LinkButton\":Button,\"TextArea\":TextArea,\"ColorPicker\":ColorPicker,\"Box\":Box,\"Button\":Button,\"CheckBox\":CheckBox,\"Clip\":Clip,\"ComboBox\":ComboBox,\"Component\":Component,\"HScrollBar\":HScrollBar,\"HSlider\":HSlider,\"Image\":Image,\"Label\":Label,\"List\":List,\"Panel\":Panel,\"ProgressBar\":ProgressBar,\"Radio\":Radio,\"RadioGroup\":RadioGroup,\"ScrollBar\":ScrollBar,\"Slider\":Slider,\"Tab\":Tab,\"TextInput\":TextInput,\"View\":View,\"VScrollBar\":VScrollBar,\"VSlider\":VSlider,\"Tree\":Tree,\"HBox\":HBox,\"VBox\":VBox,\"Sprite\":Sprite,\"Animation\":Animation,\"Text\":Text,\"FontClip\":FontClip};},'_parseWatchData',function(){return this._parseWatchData=/\\${(.*?)}/g;},'_parseKeyWord',function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g;}\r\n\t]);\r\n\tView.__init$=function(){\r\n\t\tView._regs()\r\n\t\t//class DataWatcher\r\n\t\tDataWatcher=(function(){\r\n\t\t\tfunction DataWatcher(comp,prop,value){\r\n\t\t\t\tthis.comp=null;\r\n\t\t\t\tthis.prop=null;\r\n\t\t\t\tthis.value=null;\r\n\t\t\t\tthis.comp=comp;\r\n\t\t\t\tthis.prop=prop;\r\n\t\t\t\tthis.value=value;\r\n\t\t\t}\r\n\t\t\t__class(DataWatcher,'');\r\n\t\t\tvar __proto=DataWatcher.prototype;\r\n\t\t\t__proto.exe=function(view){\r\n\t\t\t\tvar fun=UIUtils.getBindFun(this.value);\r\n\t\t\t\tthis.comp[this.prop]=fun.call(this,view);\r\n\t\t\t}\r\n\t\t\treturn DataWatcher;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn View;\r\n})(Box)\r\n\r\n\r\n/**\r\n*<code>CheckBox</code> 组件显示一个小方框，该方框内可以有选中标记。\r\n*<code>CheckBox</code> 组件还可以显示可选的文本标签，默认该标签位于 CheckBox 右侧。\r\n*<p><code>CheckBox</code> 使用 <code>dataSource</code>赋值时的的默认属性是：<code>selected</code>。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>CheckBox</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.CheckBox;\r\n\t*import laya.utils.Handler;\r\n\t*public class CheckBox_Example\r\n\t*{\r\n\t\t*public function CheckBox_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load(\"resource/ui/check.png\",Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*trace(\"资源加载完成！\");\r\n\t\t\t*var checkBox:CheckBox=new CheckBox(\"resource/ui/check.png\",\"这个是一个CheckBox组件。\");//创建一个 CheckBox 类的实例对象 checkBox ,传入它的皮肤skin和标签label。\r\n\t\t\t*checkBox.x=100;//设置 checkBox 对象的属性 x 的值，用于控制 checkBox 对象的显示位置。\r\n\t\t\t*checkBox.y=100;//设置 checkBox 对象的属性 y 的值，用于控制 checkBox 对象的显示位置。\r\n\t\t\t*checkBox.clickHandler=new Handler(this,onClick,[checkBox]);//设置 checkBox 的点击事件处理器。\r\n\t\t\t*Laya.stage.addChild(checkBox);//将此 checkBox 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onClick(checkBox:CheckBox):void\r\n\t\t*{\r\n\t\t\t*trace(\"输出选中状态: checkBox.selected = \"+checkBox.selected);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load(\"resource/ui/check.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*function loadComplete()\r\n*{\r\n\t*console.log(\"资源加载完成！\");\r\n\t*var checkBox:laya.ui.CheckBox=new laya.ui.CheckBox(\"resource/ui/check.png\",\"这个是一个CheckBox组件。\");//创建一个 CheckBox 类的类的实例对象 checkBox ,传入它的皮肤skin和标签label。\r\n\t*checkBox.x=100;//设置 checkBox 对象的属性 x 的值，用于控制 checkBox 对象的显示位置。\r\n\t*checkBox.y=100;//设置 checkBox 对象的属性 y 的值，用于控制 checkBox 对象的显示位置。\r\n\t*checkBox.clickHandler=new laya.utils.Handler(this,this.onClick,[checkBox],false);//设置 checkBox 的点击事件处理器。\r\n\t*Laya.stage.addChild(checkBox);//将此 checkBox 对象添加到显示列表。\r\n\t*}\r\n*function onClick(checkBox)\r\n*{\r\n\t*console.log(\"checkBox.selected = \",checkBox.selected);\r\n\t*}\r\n*@example\r\n*import CheckBox=laya.ui.CheckBox;\r\n*import Handler=laya.utils.Handler;\r\n*class CheckBox_Example{\r\n\t*constructor()\r\n\t*{\r\n\t\t*Laya.init(640,800);\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/check.png\",Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete()\r\n\t*{\r\n\t\t*var checkBox:CheckBox=new CheckBox(\"resource/ui/check.png\",\"这个是一个CheckBox组件。\");//创建一个 CheckBox 类的实例对象 checkBox ,传入它的皮肤skin和标签label。\r\n\t\t*checkBox.x=100;//设置 checkBox 对象的属性 x 的值，用于控制 checkBox 对象的显示位置。\r\n\t\t*checkBox.y=100;//设置 checkBox 对象的属性 y 的值，用于控制 checkBox 对象的显示位置。\r\n\t\t*checkBox.clickHandler=new Handler(this,this.onClick,[checkBox]);//设置 checkBox 的点击事件处理器。\r\n\t\t*Laya.stage.addChild(checkBox);//将此 checkBox 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onClick(checkBox:CheckBox):void\r\n\t*{\r\n\t\t*console.log(\"输出选中状态: checkBox.selected = \"+checkBox.selected);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.CheckBox extends laya.ui.Button\r\nvar CheckBox=(function(_super){\r\n\t/**\r\n\t*创建一个新的 <code>CheckBox</code> 组件实例。\r\n\t*@param skin 皮肤资源地址。\r\n\t*@param label 文本标签的内容。\r\n\t*/\r\n\tfunction CheckBox(skin,label){\r\n\t\t(label===void 0)&& (label=\"\");\r\n\t\tCheckBox.__super.call(this,skin,label);\r\n\t}\r\n\r\n\t__class(CheckBox,'laya.ui.CheckBox',_super);\r\n\tvar __proto=CheckBox.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.preinitialize=function(){\r\n\t\tlaya.ui.Component.prototype.preinitialize.call(this);\r\n\t\tthis.toggle=true;\r\n\t\tthis._autoSize=false;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\t_super.prototype.initialize.call(this);\r\n\t\tthis.createText();\r\n\t\tthis._text.align=\"left\";\r\n\t\tthis._text.valign=\"top\";\r\n\t\tthis._text.width=0;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif ((typeof value=='boolean'))this.selected=value;\r\n\t\telse if ((typeof value=='string'))this.selected=value===\"true\";\r\n\t\telse Laya.superSet(Button,this,'dataSource',value);\r\n\t});\r\n\r\n\treturn CheckBox;\r\n})(Button)\r\n\r\n\r\n/**\r\n*<code>LayoutBox</code> 是一个布局容器类。\r\n*/\r\n//class laya.ui.LayoutBox extends laya.ui.Box\r\nvar LayoutBox=(function(_super){\r\n\tfunction LayoutBox(){\r\n\t\t/**@private */\r\n\t\tthis._space=0;\r\n\t\t/**@private */\r\n\t\tthis._align=\"none\";\r\n\t\t/**@private */\r\n\t\tthis._itemChanged=false;\r\n\t\tLayoutBox.__super.call(this);\r\n\t}\r\n\r\n\t__class(LayoutBox,'laya.ui.LayoutBox',_super);\r\n\tvar __proto=LayoutBox.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.addChild=function(child){\r\n\t\tchild.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setItemChanged();\r\n\t\treturn laya.display.Node.prototype.addChild.call(this,child);\r\n\t}\r\n\r\n\t__proto.onResize=function(e){\r\n\t\tthis._setItemChanged();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.addChildAt=function(child,index){\r\n\t\tchild.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setItemChanged();\r\n\t\treturn laya.display.Node.prototype.addChildAt.call(this,child,index);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.removeChild=function(child){\r\n\t\tchild.off(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setItemChanged();\r\n\t\treturn laya.display.Node.prototype.removeChild.call(this,child);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.removeChildAt=function(index){\r\n\t\tthis.getChildAt(index).off(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setItemChanged();\r\n\t\treturn laya.display.Node.prototype.removeChildAt.call(this,index);\r\n\t}\r\n\r\n\t/**刷新。*/\r\n\t__proto.refresh=function(){\r\n\t\tthis._setItemChanged();\r\n\t}\r\n\r\n\t/**\r\n\t*改变子对象的布局。\r\n\t*/\r\n\t__proto.changeItems=function(){\r\n\t\tthis._itemChanged=false;\r\n\t}\r\n\r\n\t/**\r\n\t*排序项目列表。可通过重写改变默认排序规则。\r\n\t*@param items 项目列表。\r\n\t*/\r\n\t__proto.sortItem=function(items){\r\n\t\tif (items)items.sort(function(a,b){return a.y-b.y;});\r\n\t}\r\n\r\n\t__proto._setItemChanged=function(){\r\n\t\tif (!this._itemChanged){\r\n\t\t\tthis._itemChanged=true;\r\n\t\t\tthis.callLater(this.changeItems);\r\n\t\t}\r\n\t}\r\n\r\n\t/**子对象的间隔。*/\r\n\t__getset(0,__proto,'space',function(){\r\n\t\treturn this._space;\r\n\t\t},function(value){\r\n\t\tthis._space=value;\r\n\t\tthis._setItemChanged();\r\n\t});\r\n\r\n\t/**子对象对齐方式。*/\r\n\t__getset(0,__proto,'align',function(){\r\n\t\treturn this._align;\r\n\t\t},function(value){\r\n\t\tthis._align=value;\r\n\t\tthis._setItemChanged();\r\n\t});\r\n\r\n\treturn LayoutBox;\r\n})(Box)\r\n\r\n\r\n/**\r\n*字体切片，简化版的位图字体，只需设置一个切片图片和文字内容即可使用，效果同位图字体\r\n*使用方式：设置位图字体皮肤skin，设置皮肤对应的字体内容sheet（如果多行，可以使用空格换行），示例：\r\n*fontClip.skin=\"font1.png\";//设置皮肤\r\n*fontClip.sheet=\"abc123 456\";//设置皮肤对应的内容，空格换行。此皮肤为2行5列（显示时skin会被等分为2行5列），第一行对应的文字为\"abc123\"，第二行为\"456\"\r\n*fontClip.value=\"a1326\";//显示\"a1326\"文字\r\n*/\r\n//class laya.ui.FontClip extends laya.ui.Clip\r\nvar FontClip=(function(_super){\r\n\tfunction FontClip(skin,sheet){\r\n\t\t/**数值*/\r\n\t\tthis._valueArr=null;\r\n\t\t/**文字内容数组**/\r\n\t\tthis._indexMap=null;\r\n\t\t/**位图字体内容**/\r\n\t\tthis._sheet=null;\r\n\t\t/**@private */\r\n\t\tthis._direction=\"horizontal\";\r\n\t\t/**X方向间隙*/\r\n\t\tthis._spaceX=0;\r\n\t\t/**Y方向间隙*/\r\n\t\tthis._spaceY=0;\r\n\t\t/**@private 水平对齐方式*/\r\n\t\tthis._align=\"left\";\r\n\t\t/**@private 显示文字宽*/\r\n\t\tthis._wordsW=0;\r\n\t\t/**@private 显示文字高*/\r\n\t\tthis._wordsH=0;\r\n\t\tFontClip.__super.call(this);\r\n\t\tif (skin)this.skin=skin;\r\n\t\tif (sheet)this.sheet=sheet;\r\n\t}\r\n\r\n\t__class(FontClip,'laya.ui.FontClip',_super);\r\n\tvar __proto=FontClip.prototype;\r\n\t__proto.createChildren=function(){\r\n\t\tthis._bitmap=new AutoBitmap();\r\n\t\tthis.on(/*laya.events.Event.LOADED*/\"loaded\",this,this._onClipLoaded);\r\n\t}\r\n\r\n\t/**\r\n\t*资源加载完毕\r\n\t*/\r\n\t__proto._onClipLoaded=function(){\r\n\t\tthis.callLater(this.changeValue);\r\n\t}\r\n\r\n\t/**渲染数值*/\r\n\t__proto.changeValue=function(){\r\n\t\tif (!this._sources)return;\r\n\t\tif (!this._valueArr)return;\r\n\t\tthis.graphics.clear(true);\r\n\t\tvar texture;\r\n\t\ttexture=this._sources[0];\r\n\t\tif (!texture)return;\r\n\t\tvar isHorizontal=(this._direction===\"horizontal\");\r\n\t\tif (isHorizontal){\r\n\t\t\tthis._wordsW=this._valueArr.length *(texture.sourceWidth+this.spaceX);\r\n\t\t\tthis._wordsH=texture.sourceHeight;\r\n\t\t\t}else{\r\n\t\t\tthis._wordsW=texture.sourceWidth;\r\n\t\t\tthis._wordsH=(texture.sourceHeight+this.spaceY)*this._valueArr.length;\r\n\t\t};\r\n\t\tvar dX=0;\r\n\t\tif (this._width){\r\n\t\t\tswitch(this._align){\r\n\t\t\t\tcase \"center\":\r\n\t\t\t\t\tdX=0.5 *(this._width-this._wordsW);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"right\":\r\n\t\t\t\t\tdX=this._width-this._wordsW;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\tdX=0;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tfor (var i=0,sz=this._valueArr.length;i < sz;i++){\r\n\t\t\tvar index=this._indexMap[this._valueArr.charAt(i)];\r\n\t\t\tif (!this.sources[index])continue ;\r\n\t\t\ttexture=this.sources[index];\r\n\t\t\tif (isHorizontal)this.graphics.drawTexture(texture,dX+i *(texture.sourceWidth+this.spaceX),0,texture.sourceWidth,texture.sourceHeight);\r\n\t\t\telse this.graphics.drawTexture(texture,0+dX,i *(texture.sourceHeight+this.spaceY),texture.sourceWidth,texture.sourceHeight);\r\n\t\t}\r\n\t\tif (!this._width){\r\n\t\t\tthis.resetLayoutX();\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t}\r\n\t\tif (!this._height){\r\n\t\t\tthis.resetLayoutY();\r\n\t\t\tthis.callLater(this.changeSize);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis._valueArr=null;\r\n\t\tthis._indexMap=null;\r\n\t\tthis.graphics.clear(true);\r\n\t\tthis.removeSelf();\r\n\t\tthis.off(/*laya.events.Event.LOADED*/\"loaded\",this,this._onClipLoaded);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t}\r\n\r\n\t/**\r\n\t*设置位图字体内容，空格代表换行。比如\"abc123 456\"，代表第一行对应的文字为\"abc123\"，第二行为\"456\"\r\n\t*/\r\n\t__getset(0,__proto,'sheet',function(){\r\n\t\treturn this._sheet;\r\n\t\t},function(value){\r\n\t\tvalue+=\"\";\r\n\t\tthis._sheet=value;\r\n\t\tvar arr=value.split(\" \");\r\n\t\tthis._clipX=String(arr[0]).length;\r\n\t\tthis.clipY=arr.length;\r\n\t\tthis._indexMap={};\r\n\t\tfor (var i=0;i < this._clipY;i++){\r\n\t\t\tvar line=arr[i].split(\"\");\r\n\t\t\tfor (var j=0,n=line.length;j < n;j++){\r\n\t\t\t\tthis._indexMap[line[j]]=i *this._clipX+j;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Clip,this,'height',value);\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**\r\n\t*布局方向。\r\n\t*<p>默认值为\"horizontal\"。</p>\r\n\t*<p><b>取值：</b>\r\n\t*<li>\"horizontal\"：表示水平布局。</li>\r\n\t*<li>\"vertical\"：表示垂直布局。</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'direction',function(){\r\n\t\treturn this._direction;\r\n\t\t},function(value){\r\n\t\tthis._direction=value;\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**\r\n\t*设置位图字体的显示内容\r\n\t*/\r\n\t__getset(0,__proto,'value',function(){\r\n\t\tif (!this._valueArr)return \"\";\r\n\t\treturn this._valueArr;\r\n\t\t},function(value){\r\n\t\tvalue+=\"\";\r\n\t\tthis._valueArr=value;\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Clip,this,'width',value);\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**X方向文字间隙*/\r\n\t__getset(0,__proto,'spaceX',function(){\r\n\t\treturn this._spaceX;\r\n\t\t},function(value){\r\n\t\tthis._spaceX=value;\r\n\t\tif (this._direction===\"horizontal\")this.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**Y方向文字间隙*/\r\n\t__getset(0,__proto,'spaceY',function(){\r\n\t\treturn this._spaceY;\r\n\t\t},function(value){\r\n\t\tthis._spaceY=value;\r\n\t\tif (!(this._direction===\"horizontal\"))this.callLater(this.changeValue);\r\n\t});\r\n\r\n\t/**水平对齐方式*/\r\n\t__getset(0,__proto,'align',function(){\r\n\t\treturn this._align;\r\n\t\t},function(v){\r\n\t\tthis._align=v;\r\n\t\tthis.callLater(this.changeValue);\r\n\t});\r\n\r\n\t__getset(0,__proto,'measureWidth',function(){\r\n\t\treturn this._wordsW;\r\n\t});\r\n\r\n\t__getset(0,__proto,'measureHeight',function(){\r\n\t\treturn this._wordsH;\r\n\t});\r\n\r\n\treturn FontClip;\r\n})(Clip)\r\n\r\n\r\n/**\r\n*<code>List</code> 控件可显示项目列表。默认为垂直方向列表。可通过UI编辑器自定义列表。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>List</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.List;\r\n\t*import laya.utils.Handler;\r\n\t*public class List_Example\r\n\t*{\r\n\t\t*public function List_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800,\"false\");//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"],Handler.create(this,onLoadComplete));\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var arr:Array=[];//创建一个数组，用于存贮列表的数据信息。\r\n\t\t\t*for (var i:int=0;i &lt;20;i++)\r\n\t\t\t*{\r\n\t\t\t\t*arr.push({label:\"item\"+i});\r\n\t\t\t\t*}\r\n\t\t\t*var list:List=new List();//创建一个 List 类的实例对象 list 。\r\n\t\t\t*list.itemRender=Item;//设置 list 的单元格渲染器。\r\n\t\t\t*list.repeatX=1;//设置 list 的水平方向单元格数量。\r\n\t\t\t*list.repeatY=10;//设置 list 的垂直方向单元格数量。\r\n\t\t\t*list.vScrollBarSkin=\"resource/ui/vscroll.png\";//设置 list 的垂直方向滚动条皮肤。\r\n\t\t\t*list.array=arr;//设置 list 的列表数据源。\r\n\t\t\t*list.pos(100,100);//设置 list 的位置。\r\n\t\t\t*list.selectEnable=true;//设置 list 可选。\r\n\t\t\t*list.selectHandler=new Handler(this,onSelect);//设置 list 改变选择项执行的处理器。\r\n\t\t\t*Laya.stage.addChild(list);//将 list 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onSelect(index:int):void\r\n\t\t*{\r\n\t\t\t*trace(\"当前选择的项目索引： index= \",index);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*import laya.ui.Box;\r\n*import laya.ui.Label;\r\n*class Item extends Box\r\n*{\r\n\t*public function Item()\r\n\t*{\r\n\t\t*graphics.drawRect(0,0,100,20,null,\"#ff0000\");\r\n\t\t*var label:Label=new Label();\r\n\t\t*label.text=\"100000\";\r\n\t\t*label.name=\"label\";//设置 label 的name属性值。\r\n\t\t*label.size(100,20);\r\n\t\t*addChild(label);\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*(function (_super){\r\n\t*function Item(){\r\n\t\t*Item.__super.call(this);//初始化父类\r\n\t\t*this.graphics.drawRect(0,0,100,20,\"#ff0000\");\r\n\t\t*var label=new laya.ui.Label();//创建一个 Label 类的实例对象 label 。\r\n\t\t*label.text=\"100000\";//设置 label 的文本内容。\r\n\t\t*label.name=\"label\";//设置 label 的name属性值。\r\n\t\t*label.size(100,20);//设置 label 的宽度、高度。\r\n\t\t*this.addChild(label);//将 label 添加到显示列表。\r\n\t\t*};\r\n\t*Laya.class(Item,\"mypackage.listExample.Item\",_super);//注册类 Item 。\r\n\t*})(laya.ui.Box);\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n*var res=[\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"];\r\n*Laya.loader.load(res,new laya.utils.Handler(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*var arr=[];//创建一个数组，用于存贮列表的数据信息。\r\n\t*for (var i=0;i &lt;20;i++){\r\n\t\t*arr.push({label:\"item\"+i});\r\n\t\t*}\r\n\t*var list=new laya.ui.List();//创建一个 List 类的实例对象 list 。\r\n\t*list.itemRender=mypackage.listExample.Item;//设置 list 的单元格渲染器。\r\n\t*list.repeatX=1;//设置 list 的水平方向单元格数量。\r\n\t*list.repeatY=10;//设置 list 的垂直方向单元格数量。\r\n\t*list.vScrollBarSkin=\"resource/ui/vscroll.png\";//设置 list 的垂直方向滚动条皮肤。\r\n\t*list.array=arr;//设置 list 的列表数据源。\r\n\t*list.pos(100,100);//设置 list 的位置。\r\n\t*list.selectEnable=true;//设置 list 可选。\r\n\t*list.selectHandler=new laya.utils.Handler(this,onSelect);//设置 list 改变选择项执行的处理器。\r\n\t*Laya.stage.addChild(list);//将 list 添加到显示列表。\r\n\t*}\r\n*function onSelect(index)\r\n*{\r\n\t*console.log(\"当前选择的项目索引： index= \",index);\r\n\t*}\r\n*\r\n*@example\r\n*import List=laya.ui.List;\r\n*import Handler=laya.utils.Handler;\r\n*public class List_Example {\r\n\t*public List_Example(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"],Handler.create(this,this.onLoadComplete));\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var arr=[];//创建一个数组，用于存贮列表的数据信息。\r\n\t\t*for (var i:number=0;i &lt;20;i++)\r\n\t\t*{\r\n\t\t\t*arr.push({label:\"item\"+i });\r\n\t\t\t*}\r\n\t\t*var list:List=new List();//创建一个 List 类的实例对象 list 。\r\n\t\t*list.itemRender=Item;//设置 list 的单元格渲染器。\r\n\t\t*list.repeatX=1;//设置 list 的水平方向单元格数量。\r\n\t\t*list.repeatY=10;//设置 list 的垂直方向单元格数量。\r\n\t\t*list.vScrollBarSkin=\"resource/ui/vscroll.png\";//设置 list 的垂直方向滚动条皮肤。\r\n\t\t*list.array=arr;//设置 list 的列表数据源。\r\n\t\t*list.pos(100,100);//设置 list 的位置。\r\n\t\t*list.selectEnable=true;//设置 list 可选。\r\n\t\t*list.selectHandler=new Handler(this,this.onSelect);//设置 list 改变选择项执行的处理器。\r\n\t\t*Laya.stage.addChild(list);//将 list 添加到显示列表。\r\n\t\t*}\r\n\t*private onSelect(index:number):void {\r\n\t\t*console.log(\"当前选择的项目索引： index= \",index);\r\n\t\t*}\r\n\t*}\r\n*import Box=laya.ui.Box;\r\n*import Label=laya.ui.Label;\r\n*class Item extends Box {\r\n\t*constructor(){\r\n\t\t*this.graphics.drawRect(0,0,100,20,null,\"#ff0000\");\r\n\t\t*var label:Label=new Label();\r\n\t\t*label.text=\"100000\";\r\n\t\t*label.name=\"label\";//设置 label 的name属性值。\r\n\t\t*label.size(100,20);\r\n\t\t*this.addChild(label);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.List extends laya.ui.Box\r\nvar List=(function(_super){\r\n\tfunction List(){\r\n\t\t/**改变 <code>List</code> 的选择项时执行的处理器，(默认返回参数： 项索引（index:int）)。*/\r\n\t\tthis.selectHandler=null;\r\n\t\t/**单元格渲染处理器(默认返回参数cell:Box,index:int)。*/\r\n\t\tthis.renderHandler=null;\r\n\t\t/**单元格鼠标事件处理器(默认返回参数e:Event,index:int)。*/\r\n\t\tthis.mouseHandler=null;\r\n\t\t/**指定是否可以选择，若值为true则可以选择，否则不可以选择。 @default false*/\r\n\t\tthis.selectEnable=false;\r\n\t\t/**最大分页数。*/\r\n\t\tthis.totalPage=0;\r\n\t\t/**@private */\r\n\t\tthis._content=null;\r\n\t\t/**@private */\r\n\t\tthis._scrollBar=null;\r\n\t\t/**@private */\r\n\t\tthis._itemRender=null;\r\n\t\t/**@private */\r\n\t\tthis._repeatX=0;\r\n\t\t/**@private */\r\n\t\tthis._repeatY=0;\r\n\t\t/**@private */\r\n\t\tthis._repeatX2=0;\r\n\t\t/**@private */\r\n\t\tthis._repeatY2=0;\r\n\t\t/**@private */\r\n\t\tthis._spaceX=0;\r\n\t\t/**@private */\r\n\t\tthis._spaceY=0;\r\n\t\t/**@private */\r\n\t\tthis._array=null;\r\n\t\t/**@private */\r\n\t\tthis._startIndex=0;\r\n\t\t/**@private */\r\n\t\tthis._selectedIndex=-1;\r\n\t\t/**@private */\r\n\t\tthis._page=0;\r\n\t\t/**@private */\r\n\t\tthis._isVertical=true;\r\n\t\t/**@private */\r\n\t\tthis._cellSize=20;\r\n\t\t/**@private */\r\n\t\tthis._cellOffset=0;\r\n\t\t/**@private */\r\n\t\tthis._isMoved=false;\r\n\t\t/**是否缓存内容，如果数据源较少，并且list内无动画，设置此属性为true能大大提高性能 */\r\n\t\tthis.cacheContent=false;\r\n\t\t/**@private */\r\n\t\tthis._createdLine=0;\r\n\t\t/**@private */\r\n\t\tthis._cellChanged=false;\r\n\t\tList.__super.call(this);\r\n\t\tthis._cells=[];\r\n\t\tthis._offset=new Point();\r\n\t}\r\n\r\n\t__class(List,'laya.ui.List',_super);\r\n\tvar __proto=List.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IRender\":true,\"laya.ui.IItem\":true})\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis._content && this._content.destroy(destroyChild);\r\n\t\tthis._scrollBar && this._scrollBar.destroy(destroyChild);\r\n\t\tlaya.ui.Component.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._content=null;\r\n\t\tthis._scrollBar=null;\r\n\t\tthis._itemRender=null;\r\n\t\tthis._cells=null;\r\n\t\tthis._array=null;\r\n\t\tthis.selectHandler=this.renderHandler=this.mouseHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._content=new Box());\r\n\t}\r\n\r\n\t__proto.onScrollStart=function(){\r\n\t\tthis._$P.cacheAs || (this._$P.cacheAs=Laya.superGet(Box,this,'cacheAs'));\r\n\t\tLaya.superSet(Box,this,'cacheAs',\"none\");\r\n\t\tthis._scrollBar.once(/*laya.events.Event.END*/\"end\",this,this.onScrollEnd);\r\n\t}\r\n\r\n\t__proto.onScrollEnd=function(){\r\n\t\tLaya.superSet(Box,this,'cacheAs',this._$P.cacheAs);\r\n\t}\r\n\r\n\t__proto._removePreScrollBar=function(){\r\n\t\tvar preNode=this.removeChildByName(\"scrollBar\");\r\n\t\tif (preNode)preNode.destroy(true);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*更改单元格的信息。\r\n\t*@internal 在此销毁、创建单元格，并设置单元格的位置等属性。相当于此列表内容发送改变时调用此函数。\r\n\t*/\r\n\t__proto.changeCells=function(){\r\n\t\tthis._cellChanged=false;\r\n\t\tif (this._itemRender){\r\n\t\t\tthis.scrollBar=this.getChildByName(\"scrollBar\");\r\n\t\t\tvar cell=this._getOneCell();\r\n\t\t\tvar cellWidth=(cell.width+this._spaceX)|| 1;\r\n\t\t\tvar cellHeight=(cell.height+this._spaceY)|| 1;\r\n\t\t\tif (this._width > 0)this._repeatX2=this._isVertical ? Math.round(this._width / cellWidth):Math.ceil(this._width / cellWidth);\r\n\t\t\tif (this._height > 0)this._repeatY2=this._isVertical ? Math.ceil(this._height / cellHeight):Math.round(this._height / cellHeight);\r\n\t\t\tvar listWidth=this._width ? this._width :(cellWidth *this.repeatX-this._spaceX);\r\n\t\t\tvar listHeight=this._height ? this._height :(cellHeight *this.repeatY-this._spaceY);\r\n\t\t\tthis._cellSize=this._isVertical ? cellHeight :cellWidth;\r\n\t\t\tthis._cellOffset=this._isVertical ? (cellHeight *Math.max(this._repeatY2,this._repeatY)-listHeight-this._spaceY):(cellWidth *Math.max(this._repeatX2,this._repeatX)-listWidth-this._spaceX);\r\n\t\t\tif (this._isVertical && this._scrollBar)this._scrollBar.height=listHeight;\r\n\t\t\telse if (!this._isVertical && this._scrollBar)this._scrollBar.width=listWidth;\r\n\t\t\tthis.setContentSize(listWidth,listHeight);\r\n\t\t\tvar numX=this._isVertical ? this.repeatX :this.repeatY;\r\n\t\t\tvar numY=(this._isVertical ? this.repeatY :this.repeatX)+(this._scrollBar ? 1 :0);\r\n\t\t\tthis._createItems(0,numX,numY);\r\n\t\t\tthis._createdLine=numY;\r\n\t\t\tif (this._array){\r\n\t\t\t\tthis.array=this._array;\r\n\t\t\t\tthis.runCallLater(this.renderItems);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._getOneCell=function(){\r\n\t\tif (this._cells.length===0){\r\n\t\t\tvar item=this.createItem();\r\n\t\t\tthis._offset.setTo(item.x,item.y);\r\n\t\t\tif (this.cacheContent)return item;\r\n\t\t\tthis._cells.push(item);\r\n\t\t}\r\n\t\treturn this._cells[0];\r\n\t}\r\n\r\n\t__proto._createItems=function(startY,numX,numY){\r\n\t\tvar box=this._content;\r\n\t\tvar cell=this._getOneCell();\r\n\t\tvar cellWidth=cell.width+this._spaceX;\r\n\t\tvar cellHeight=cell.height+this._spaceY;\r\n\t\tif (this.cacheContent){\r\n\t\t\tvar cacheBox=new Box();\r\n\t\t\tcacheBox.cacheAsBitmap=true;\r\n\t\t\tcacheBox.pos((this._isVertical ? 0 :startY)*cellWidth,(this._isVertical ? startY :0)*cellHeight);\r\n\t\t\tthis._content.addChild(cacheBox);\r\n\t\t\tthis._content.optimizeScrollRect=true;\r\n\t\t\tbox=cacheBox;\r\n\t\t\t}else {\r\n\t\t\tvar arr=[];\r\n\t\t\tfor (var i=this._cells.length-1;i >-1;i--){\r\n\t\t\t\tvar item=this._cells[i];\r\n\t\t\t\titem.removeSelf();\r\n\t\t\t\tarr.push(item);\r\n\t\t\t}\r\n\t\t\tthis._cells.length=0;\r\n\t\t}\r\n\t\tfor (var k=startY;k < numY;k++){\r\n\t\t\tfor (var l=0;l < numX;l++){\r\n\t\t\t\tif (arr && arr.length){\r\n\t\t\t\t\tcell=arr.pop();\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tcell=this.createItem();\r\n\t\t\t\t}\r\n\t\t\t\tcell.x=(this._isVertical ? l :k)*cellWidth-box.x;\r\n\t\t\t\tcell.y=(this._isVertical ? k :l)*cellHeight-box.y;\r\n\t\t\t\tcell.name=\"item\"+(k *numX+l);\r\n\t\t\t\tbox.addChild(cell);\r\n\t\t\t\tthis.addCell(cell);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.createItem=function(){\r\n\t\tvar arr=[];\r\n\t\tif ((typeof this._itemRender=='function')){\r\n\t\t\tvar box=new this._itemRender();\r\n\t\t\t}else {\r\n\t\t\tbox=View.createComp(this._itemRender,null,null,arr)\r\n\t\t}\r\n\t\tif (arr.length==0 && box._watchMap){\r\n\t\t\tvar watchMap=box._watchMap;\r\n\t\t\tfor (var name in watchMap){\r\n\t\t\t\tvar a=watchMap[name];\r\n\t\t\t\tfor (var i=0;i < a.length;i++){\r\n\t\t\t\t\tvar watcher=a[i];\r\n\t\t\t\t\tarr.push(watcher.comp,watcher.prop,watcher.value)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (arr.length)box[\"_$bindData\"]=arr;\r\n\t\treturn box;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*添加单元格。\r\n\t*@param cell 需要添加的单元格对象。\r\n\t*/\r\n\t__proto.addCell=function(cell){\r\n\t\tcell.on(/*laya.events.Event.CLICK*/\"click\",this,this.onCellMouse);\r\n\t\tcell.on(/*laya.events.Event.RIGHT_CLICK*/\"rightclick\",this,this.onCellMouse);\r\n\t\tcell.on(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",this,this.onCellMouse);\r\n\t\tcell.on(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onCellMouse);\r\n\t\tcell.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this.onCellMouse);\r\n\t\tcell.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onCellMouse);\r\n\t\tthis._cells.push(cell);\r\n\t}\r\n\r\n\t/**\r\n\t*初始化单元格信息。\r\n\t*/\r\n\t__proto.initItems=function(){\r\n\t\tif (!this._itemRender && this.getChildByName(\"item0\")!=null){\r\n\t\t\tthis.repeatX=1;\r\n\t\t\tvar count=0;\r\n\t\t\tcount=0;\r\n\t\t\tfor (var i=0;i < 10000;i++){\r\n\t\t\t\tvar cell=this.getChildByName(\"item\"+i);\r\n\t\t\t\tif (cell){\r\n\t\t\t\t\tthis.addCell(cell);\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tthis.repeatY=count;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置可视区域大小。\r\n\t*<p>以（0，0，width参数，height参数）组成的矩形区域为可视区域。</p>\r\n\t*@param width 可视区域宽度。\r\n\t*@param height 可视区域高度。\r\n\t*/\r\n\t__proto.setContentSize=function(width,height){\r\n\t\tthis._content.width=width;\r\n\t\tthis._content.height=height;\r\n\t\tif (this._scrollBar || this._offset.x !=0 || this._offset.y !=0){\r\n\t\t\tthis._content.scrollRect || (this._content.scrollRect=new Rectangle());\r\n\t\t\tthis._content.scrollRect.setTo(-this._offset.x,-this._offset.y,width,height);\r\n\t\t\tthis._content.scrollRect=this._content.scrollRect;\r\n\t\t}\r\n\t\tthis.event(/*laya.events.Event.RESIZE*/\"resize\");\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*单元格的鼠标事件侦听处理函数。\r\n\t*/\r\n\t__proto.onCellMouse=function(e){\r\n\t\tif (e.type===/*laya.events.Event.MOUSE_DOWN*/\"mousedown\")this._isMoved=false;\r\n\t\tvar cell=e.currentTarget;\r\n\t\tvar index=this._startIndex+this._cells.indexOf(cell);\r\n\t\tif (index < 0)return;\r\n\t\tif (e.type===/*laya.events.Event.CLICK*/\"click\" || e.type===/*laya.events.Event.RIGHT_CLICK*/\"rightclick\"){\r\n\t\t\tif (this.selectEnable && !this._isMoved)this.selectedIndex=index;\r\n\t\t\telse this.changeCellState(cell,true,0);\r\n\t\t\t}else if ((e.type===/*laya.events.Event.MOUSE_OVER*/\"mouseover\" || e.type===/*laya.events.Event.MOUSE_OUT*/\"mouseout\")&& this._selectedIndex!==index){\r\n\t\t\tthis.changeCellState(cell,e.type===/*laya.events.Event.MOUSE_OVER*/\"mouseover\",0);\r\n\t\t}\r\n\t\tthis.mouseHandler && this.mouseHandler.runWith([e,index]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*改变单元格的可视状态。\r\n\t*@param cell 单元格对象。\r\n\t*@param visable 是否显示。\r\n\t*@param index 单元格的属性 <code>index</code> 值。\r\n\t*/\r\n\t__proto.changeCellState=function(cell,visable,index){\r\n\t\tvar selectBox=cell.getChildByName(\"selectBox\");\r\n\t\tif (selectBox){\r\n\t\t\tthis.selectEnable=true;\r\n\t\t\tselectBox.visible=visable;\r\n\t\t\tselectBox.index=index;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.changeSize=function(){\r\n\t\tlaya.ui.Component.prototype.changeSize.call(this);\r\n\t\tthis.setContentSize(this.width,this.height);\r\n\t\tif (this._scrollBar)this.callLater(this.onScrollBarChange);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滚动条的 <code>Event.CHANGE</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onScrollBarChange=function(e){\r\n\t\tthis.runCallLater(this.changeCells);\r\n\t\tvar scrollValue=this._scrollBar.value;\r\n\t\tvar lineX=(this._isVertical ? this.repeatX :this.repeatY);\r\n\t\tvar lineY=(this._isVertical ? this.repeatY :this.repeatX);\r\n\t\tvar scrollLine=Math.floor(scrollValue / this._cellSize);\r\n\t\tif (!this.cacheContent){\r\n\t\t\tvar index=scrollLine *lineX;\r\n\t\t\tvar num=0;\r\n\t\t\tif (index > this._startIndex){\r\n\t\t\t\tnum=index-this._startIndex;\r\n\t\t\t\tvar down=true;\r\n\t\t\t\tvar toIndex=this._startIndex+lineX *(lineY+1);\r\n\t\t\t\tthis._isMoved=true;\r\n\t\t\t\t}else if (index < this._startIndex){\r\n\t\t\t\tnum=this._startIndex-index;\r\n\t\t\t\tdown=false;\r\n\t\t\t\ttoIndex=this._startIndex-1;\r\n\t\t\t\tthis._isMoved=true;\r\n\t\t\t}\r\n\t\t\tfor (var i=0;i < num;i++){\r\n\t\t\t\tif (down){\r\n\t\t\t\t\tvar cell=this._cells.shift();\r\n\t\t\t\t\tthis._cells[this._cells.length]=cell;\r\n\t\t\t\t\tvar cellIndex=toIndex+i;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tcell=this._cells.pop();\r\n\t\t\t\t\tthis._cells.unshift(cell);\r\n\t\t\t\t\tcellIndex=toIndex-i;\r\n\t\t\t\t};\r\n\t\t\t\tvar pos=Math.floor(cellIndex / lineX)*this._cellSize;\r\n\t\t\t\tthis._isVertical ? cell.y=pos :cell.x=pos;\r\n\t\t\t\tthis.renderItem(cell,cellIndex);\r\n\t\t\t}\r\n\t\t\tthis._startIndex=index;\r\n\t\t\tthis.changeSelectStatus();\r\n\t\t\t}else {\r\n\t\t\tnum=(lineY+1);\r\n\t\t\tif (this._createdLine-scrollLine < num){\r\n\t\t\t\tthis._createItems(this._createdLine,lineX,this._createdLine+num);\r\n\t\t\t\tthis.renderItems(this._createdLine *lineX,0);\r\n\t\t\t\tthis._createdLine+=num;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar r=this._content.scrollRect;\r\n\t\tif (this._isVertical){\r\n\t\t\tr.y=scrollValue-this._offset.y;\r\n\t\t\tr.x=-this._offset.x;\r\n\t\t\t}else {\r\n\t\t\tr.y=-this._offset.y;\r\n\t\t\tr.x=scrollValue-this._offset.x;\r\n\t\t}\r\n\t\tthis._content.scrollRect=r;\r\n\t}\r\n\r\n\t__proto.posCell=function(cell,cellIndex){\r\n\t\tif (!this._scrollBar)return;\r\n\t\tvar lineX=(this._isVertical ? this.repeatX :this.repeatY);\r\n\t\tvar lineY=(this._isVertical ? this.repeatY :this.repeatX);\r\n\t\tvar pos=Math.floor(cellIndex / lineX)*this._cellSize;\r\n\t\tthis._isVertical ? cell.y=pos :cell.x=pos;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*改变单元格的选择状态。\r\n\t*/\r\n\t__proto.changeSelectStatus=function(){\r\n\t\tfor (var i=0,n=this._cells.length;i < n;i++){\r\n\t\t\tthis.changeCellState(this._cells[i],this._selectedIndex===this._startIndex+i,1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*渲染单元格列表。\r\n\t*/\r\n\t__proto.renderItems=function(from,to){\r\n\t\t(from===void 0)&& (from=0);\r\n\t\t(to===void 0)&& (to=0);\r\n\t\tfor (var i=from,n=to || this._cells.length;i < n;i++){\r\n\t\t\tthis.renderItem(this._cells[i],this._startIndex+i);\r\n\t\t}\r\n\t\tthis.changeSelectStatus();\r\n\t}\r\n\r\n\t/**\r\n\t*渲染一个单元格。\r\n\t*@param cell 需要渲染的单元格对象。\r\n\t*@param index 单元格索引。\r\n\t*/\r\n\t__proto.renderItem=function(cell,index){\r\n\t\tif (this._array && index >=0 && index < this._array.length){\r\n\t\t\tcell.visible=true;\r\n\t\t\tif (cell._$bindData){\r\n\t\t\t\tcell._dataSource=this._array[index];\r\n\t\t\t\tthis._bindData(cell,this._array[index]);\r\n\t\t\t}else cell.dataSource=this._array[index];\r\n\t\t\tif (!this.cacheContent){\r\n\t\t\t\tthis.posCell(cell,index);\r\n\t\t\t}\r\n\t\t\tif (this.hasListener(/*laya.events.Event.RENDER*/\"render\"))this.event(/*laya.events.Event.RENDER*/\"render\",[cell,index]);\r\n\t\t\tif (this.renderHandler)this.renderHandler.runWith([cell,index]);\r\n\t\t\t}else {\r\n\t\t\tcell.visible=false;\r\n\t\t\tcell.dataSource=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._bindData=function(cell,data){\r\n\t\tvar arr=cell._$bindData;\r\n\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\tvar ele=arr[i++];\r\n\t\t\tvar prop=arr[i++];\r\n\t\t\tvar value=arr[i];\r\n\t\t\tvar fun=UIUtils.getBindFun(value);\r\n\t\t\tele[prop]=fun.call(this,data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*刷新列表数据源。\r\n\t*/\r\n\t__proto.refresh=function(){\r\n\t\tthis.array=this._array;\r\n\t}\r\n\r\n\t/**\r\n\t*获取单元格数据源。\r\n\t*@param index 单元格索引。\r\n\t*/\r\n\t__proto.getItem=function(index){\r\n\t\tif (index >-1 && index < this._array.length){\r\n\t\t\treturn this._array[index];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*修改单元格数据源。\r\n\t*@param index 单元格索引。\r\n\t*@param source 单元格数据源。\r\n\t*/\r\n\t__proto.changeItem=function(index,source){\r\n\t\tif (index >-1 && index < this._array.length){\r\n\t\t\tthis._array[index]=source;\r\n\t\t\tif (index >=this._startIndex && index < this._startIndex+this._cells.length){\r\n\t\t\t\tthis.renderItem(this.getCell(index),index);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置单元格数据源。\r\n\t*@param index 单元格索引。\r\n\t*@param source 单元格数据源。\r\n\t*/\r\n\t__proto.setItem=function(index,source){\r\n\t\tthis.changeItem(index,source);\r\n\t}\r\n\r\n\t/**\r\n\t*添加单元格数据源。\r\n\t*@param souce 数据源。\r\n\t*/\r\n\t__proto.addItem=function(souce){\r\n\t\tthis._array.push(souce);\r\n\t\tthis.array=this._array;\r\n\t}\r\n\r\n\t/**\r\n\t*添加单元格数据源到对应的数据索引处。\r\n\t*@param souce 单元格数据源。\r\n\t*@param index 索引。\r\n\t*/\r\n\t__proto.addItemAt=function(souce,index){\r\n\t\tthis._array.splice(index,0,souce);\r\n\t\tthis.array=this._array;\r\n\t}\r\n\r\n\t/**\r\n\t*通过数据源索引删除单元格数据源。\r\n\t*@param index 需要删除的数据源索引值。\r\n\t*/\r\n\t__proto.deleteItem=function(index){\r\n\t\tthis._array.splice(index,1);\r\n\t\tthis.array=this._array;\r\n\t}\r\n\r\n\t/**\r\n\t*通过可视单元格索引，获取单元格。\r\n\t*@param index 可视单元格索引。\r\n\t*@return 单元格对象。\r\n\t*/\r\n\t__proto.getCell=function(index){\r\n\t\tthis.runCallLater(this.changeCells);\r\n\t\tif (index >-1 && this._cells){\r\n\t\t\treturn this._cells[(index-this._startIndex)% this._cells.length];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>滚动列表，以设定的数据索引对应的单元格为当前可视列表的第一项。</p>\r\n\t*@param index 单元格在数据列表中的索引。\r\n\t*/\r\n\t__proto.scrollTo=function(index){\r\n\t\tif (this._scrollBar){\r\n\t\t\tvar numX=this._isVertical ? this.repeatX :this.repeatY;\r\n\t\t\tthis._scrollBar.value=Math.floor(index / numX)*this._cellSize;\r\n\t\t\t}else {\r\n\t\t\tthis.startIndex=index;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>缓动滚动列表，以设定的数据索引对应的单元格为当前可视列表的第一项。</p>\r\n\t*@param index 单元格在数据列表中的索引。\r\n\t*@param time 缓动时间。\r\n\t*@param complete 缓动结束回掉\r\n\t*/\r\n\t__proto.tweenTo=function(index,time,complete){\r\n\t\t(time===void 0)&& (time=200);\r\n\t\tif (this._scrollBar){\r\n\t\t\tvar numX=this._isVertical ? this.repeatX :this.repeatY;\r\n\t\t\tTween.to(this._scrollBar,{value:Math.floor(index / numX)*this._cellSize},time,null,complete,0,true);\r\n\t\t\t}else {\r\n\t\t\tthis.startIndex=index;\r\n\t\t\tif (complete)complete.run();\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setCellChanged=function(){\r\n\t\tif (!this._cellChanged){\r\n\t\t\tthis._cellChanged=true;\r\n\t\t\tthis.callLater(this.changeCells);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.commitMeasure=function(){\r\n\t\tthis.runCallLater(this.changeCells);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'cacheAs',_super.prototype._$get_cacheAs,function(value){\r\n\t\tLaya.superSet(Box,this,'cacheAs',value);\r\n\t\tif (this._scrollBar){\r\n\t\t\tthis._$P.cacheAs=null;\r\n\t\t\tif (value!==\"none\")this._scrollBar.on(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t\telse this._scrollBar.off(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取对 <code>List</code> 组件所包含的内容容器 <code>Box</code> 组件的引用。\r\n\t*/\r\n\t__getset(0,__proto,'content',function(){\r\n\t\treturn this._content;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tif (value !=this._height){\r\n\t\t\tLaya.superSet(Box,this,'height',value);\r\n\t\t\tthis._setCellChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*单元格渲染器。\r\n\t*<p><b>取值：</b>\r\n\t*<ol>\r\n\t*<li>单元格类对象。</li>\r\n\t*<li> UI 的 JSON 描述。</li>\r\n\t*</ol></p>\r\n\t*/\r\n\t__getset(0,__proto,'itemRender',function(){\r\n\t\treturn this._itemRender;\r\n\t\t},function(value){\r\n\t\tif (this._itemRender !=value){\r\n\t\t\tthis._itemRender=value;\r\n\t\t\tfor (var i=this._cells.length-1;i >-1;i--){\r\n\t\t\t\tthis._cells[i].destroy();\r\n\t\t\t}\r\n\t\t\tthis._cells.length=0;\r\n\t\t\tthis._setCellChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*垂直方向滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'vScrollBarSkin',function(){\r\n\t\treturn this._scrollBar ? this._scrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tthis._removePreScrollBar();\r\n\t\tvar scrollBar=new VScrollBar();\r\n\t\tscrollBar.name=\"scrollBar\";\r\n\t\tscrollBar.right=0;\r\n\t\tif (value && value !=\" \")\r\n\t\t\tscrollBar.skin=value;\r\n\t\tthis.scrollBar=scrollBar;\r\n\t\tthis.addChild(scrollBar);\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*列表的当前页码。\r\n\t*/\r\n\t__getset(0,__proto,'page',function(){\r\n\t\treturn this._page;\r\n\t\t},function(value){\r\n\t\tthis._page=value\r\n\t\tif (this._array){\r\n\t\t\tthis._page=value > 0 ? value :0;\r\n\t\t\tthis._page=this._page < this.totalPage ? this._page :this.totalPage-1;\r\n\t\t\tthis.startIndex=this._page *this.repeatX *this.repeatY;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*水平方向滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'hScrollBarSkin',function(){\r\n\t\treturn this._scrollBar ? this._scrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tthis._removePreScrollBar();\r\n\t\tvar scrollBar=new HScrollBar();\r\n\t\tscrollBar.name=\"scrollBar\";\r\n\t\tscrollBar.bottom=0;\r\n\t\tif (value && value !=\" \")\r\n\t\t\tscrollBar.skin=value;\r\n\t\tthis.scrollBar=scrollBar;\r\n\t\tthis.addChild(scrollBar);\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*水平方向显示的单元格数量。\r\n\t*/\r\n\t__getset(0,__proto,'repeatX',function(){\r\n\t\treturn this._repeatX > 0 ? this._repeatX :this._repeatX2 > 0 ? this._repeatX2 :1;\r\n\t\t},function(value){\r\n\t\tthis._repeatX=value;\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*获取对 <code>List</code> 组件所包含的滚动条 <code>ScrollBar</code> 组件的引用。\r\n\t*/\r\n\t__getset(0,__proto,'scrollBar',function(){\r\n\t\treturn this._scrollBar;\r\n\t\t},function(value){\r\n\t\tif (this._scrollBar !=value){\r\n\t\t\tthis._scrollBar=value;\r\n\t\t\tif (value){\r\n\t\t\t\tthis._isVertical=this._scrollBar.isVertical;\r\n\t\t\t\tthis.addChild(this._scrollBar);\r\n\t\t\t\tthis._scrollBar.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onScrollBarChange);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tif (value !=this._width){\r\n\t\t\tLaya.superSet(Box,this,'width',value);\r\n\t\t\tthis._setCellChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*垂直方向显示的单元格数量。\r\n\t*/\r\n\t__getset(0,__proto,'repeatY',function(){\r\n\t\treturn this._repeatY > 0 ? this._repeatY :this._repeatY2 > 0 ? this._repeatY2 :1;\r\n\t\t},function(value){\r\n\t\tthis._repeatY=value;\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*水平方向显示的单元格之间的间距（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'spaceX',function(){\r\n\t\treturn this._spaceX;\r\n\t\t},function(value){\r\n\t\tthis._spaceX=value;\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*垂直方向显示的单元格之间的间距（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'spaceY',function(){\r\n\t\treturn this._spaceY;\r\n\t\t},function(value){\r\n\t\tthis._spaceY=value;\r\n\t\tthis._setCellChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*表示当前选择的项索引。selectedIndex值更改会引起list重新渲染\r\n\t*/\r\n\t__getset(0,__proto,'selectedIndex',function(){\r\n\t\treturn this._selectedIndex;\r\n\t\t},function(value){\r\n\t\tif (this._selectedIndex !=value){\r\n\t\t\tthis._selectedIndex=value;\r\n\t\t\tthis.changeSelectStatus();\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tthis.selectHandler && this.selectHandler.runWith(value);\r\n\t\t\tthis.startIndex=this._startIndex;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*当前选中的单元格数据源。\r\n\t*/\r\n\t__getset(0,__proto,'selectedItem',function(){\r\n\t\treturn this._selectedIndex !=-1 ? this._array[this._selectedIndex] :null;\r\n\t\t},function(value){\r\n\t\tthis.selectedIndex=this._array.indexOf(value);\r\n\t});\r\n\r\n\t/**\r\n\t*列表的数据总个数。\r\n\t*/\r\n\t__getset(0,__proto,'length',function(){\r\n\t\treturn this._array ? this._array.length :0;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置当前选择的单元格对象。\r\n\t*/\r\n\t__getset(0,__proto,'selection',function(){\r\n\t\treturn this.getCell(this._selectedIndex);\r\n\t\t},function(value){\r\n\t\tthis.selectedIndex=this._startIndex+this._cells.indexOf(value);\r\n\t});\r\n\r\n\t/**\r\n\t*当前显示的单元格列表的开始索引。\r\n\t*/\r\n\t__getset(0,__proto,'startIndex',function(){\r\n\t\treturn this._startIndex;\r\n\t\t},function(value){\r\n\t\tthis._startIndex=value > 0 ? value :0;\r\n\t\tthis.callLater(this.renderItems);\r\n\t});\r\n\r\n\t/**\r\n\t*列表数据源。\r\n\t*/\r\n\t__getset(0,__proto,'array',function(){\r\n\t\treturn this._array;\r\n\t\t},function(value){\r\n\t\tthis.runCallLater(this.changeCells);\r\n\t\tthis._array=value || [];\r\n\t\tvar length=this._array.length;\r\n\t\tthis.totalPage=Math.ceil(length / (this.repeatX *this.repeatY));\r\n\t\tthis._selectedIndex=this._selectedIndex < length ? this._selectedIndex :length-1;\r\n\t\tthis.startIndex=this._startIndex;\r\n\t\tif (this._scrollBar){\r\n\t\t\tthis._scrollBar.stopScroll();\r\n\t\t\tvar numX=this._isVertical ? this.repeatX :this.repeatY;\r\n\t\t\tvar numY=this._isVertical ? this.repeatY :this.repeatX;\r\n\t\t\tvar lineCount=Math.ceil(length / numX);\r\n\t\t\tvar total=this._cellOffset > 0 ? this.totalPage+1 :this.totalPage;\r\n\t\t\tif (total > 1){\r\n\t\t\t\tthis._scrollBar.scrollSize=this._cellSize;\r\n\t\t\t\tthis._scrollBar.thumbPercent=numY / lineCount;\r\n\t\t\t\tthis._scrollBar.setScroll(0,(lineCount-numY)*this._cellSize+this._cellOffset,this._scrollBar.value);\r\n\t\t\t\tthis._scrollBar.target=this._content;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._scrollBar.setScroll(0,0,0);\r\n\t\t\t\tthis._scrollBar.target=this._content;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif (((typeof value=='number')&& Math.floor(value)==value)|| (typeof value=='string'))this.selectedIndex=parseInt(value);\r\n\t\telse if ((value instanceof Array))this.array=value\r\n\t\telse Laya.superSet(Box,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*单元格集合。\r\n\t*/\r\n\t__getset(0,__proto,'cells',function(){\r\n\t\tthis.runCallLater(this.changeCells);\r\n\t\treturn this._cells;\r\n\t});\r\n\r\n\treturn List;\r\n})(Box)\r\n\r\n\r\n/**\r\n*使用 <code>HScrollBar</code> （水平 <code>ScrollBar</code> ）控件，可以在因数据太多而不能在显示区域完全显示时控制显示的数据部分。\r\n*@example <caption>以下示例代码，创建了一个 <code>HScrollBar</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.HScrollBar;\r\n\t*import laya.utils.Handler;\r\n\t*public class HScrollBar_Example\r\n\t*{\r\n\t\t*private var hScrollBar:HScrollBar;\r\n\t\t*public function HScrollBar_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/hscroll.png\",\"resource/ui/hscroll$bar.png\",\"resource/ui/hscroll$down.png\",\"resource/ui/hscroll$up.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*hScrollBar=new HScrollBar();//创建一个 HScrollBar 类的实例对象 hScrollBar 。\r\n\t\t\t*hScrollBar.skin=\"resource/ui/hscroll.png\";//设置 hScrollBar 的皮肤。\r\n\t\t\t*hScrollBar.x=100;//设置 hScrollBar 对象的属性 x 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t\t\t*hScrollBar.y=100;//设置 hScrollBar 对象的属性 y 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t\t\t*hScrollBar.changeHandler=new Handler(this,onChange);//设置 hScrollBar 的滚动变化处理器。\r\n\t\t\t*Laya.stage.addChild(hScrollBar);//将此 hScrollBar 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onChange(value:Number):void\r\n\t\t*{\r\n\t\t\t*trace(\"滚动条的位置： value=\"+value);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var hScrollBar;\r\n*var res=[\"resource/ui/hscroll.png\",\"resource/ui/hscroll$bar.png\",\"resource/ui/hscroll$down.png\",\"resource/ui/hscroll$up.png\"];\r\n*Laya.loader.load(res,laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*console.log(\"资源加载完成！\");\r\n\t*hScrollBar=new laya.ui.HScrollBar();//创建一个 HScrollBar 类的实例对象 hScrollBar 。\r\n\t*hScrollBar.skin=\"resource/ui/hscroll.png\";//设置 hScrollBar 的皮肤。\r\n\t*hScrollBar.x=100;//设置 hScrollBar 对象的属性 x 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t*hScrollBar.y=100;//设置 hScrollBar 对象的属性 y 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t*hScrollBar.changeHandler=new laya.utils.Handler(this,onChange);//设置 hScrollBar 的滚动变化处理器。\r\n\t*Laya.stage.addChild(hScrollBar);//将此 hScrollBar 对象添加到显示列表。\r\n\t*}\r\n*function onChange(value)\r\n*{\r\n\t*console.log(\"滚动条的位置： value=\"+value);\r\n\t*}\r\n*@example\r\n*import HScrollBar=laya.ui.HScrollBar;\r\n*import Handler=laya.utils.Handler;\r\n*class HScrollBar_Example {\r\n\t*private hScrollBar:HScrollBar;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/hscroll.png\",\"resource/ui/hscroll$bar.png\",\"resource/ui/hscroll$down.png\",\"resource/ui/hscroll$up.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.hScrollBar=new HScrollBar();//创建一个 HScrollBar 类的实例对象 hScrollBar 。\r\n\t\t*this.hScrollBar.skin=\"resource/ui/hscroll.png\";//设置 hScrollBar 的皮肤。\r\n\t\t*this.hScrollBar.x=100;//设置 hScrollBar 对象的属性 x 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t\t*this.hScrollBar.y=100;//设置 hScrollBar 对象的属性 y 的值，用于控制 hScrollBar 对象的显示位置。\r\n\t\t*this.hScrollBar.changeHandler=new Handler(this,this.onChange);//设置 hScrollBar 的滚动变化处理器。\r\n\t\t*Laya.stage.addChild(this.hScrollBar);//将此 hScrollBar 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onChange(value:number):void {\r\n\t\t*console.log(\"滚动条的位置： value=\"+value);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.HScrollBar extends laya.ui.ScrollBar\r\nvar HScrollBar=(function(_super){\r\n\tfunction HScrollBar(){\r\n\t\tHScrollBar.__super.call(this);;\r\n\t}\r\n\r\n\t__class(HScrollBar,'laya.ui.HScrollBar',_super);\r\n\tvar __proto=HScrollBar.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\t_super.prototype.initialize.call(this);\r\n\t\tthis.slider.isVertical=false;\r\n\t}\r\n\r\n\treturn HScrollBar;\r\n})(ScrollBar)\r\n\r\n\r\n/**\r\n*<code>Panel</code> 是一个面板容器类。\r\n*/\r\n//class laya.ui.Panel extends laya.ui.Box\r\nvar Panel=(function(_super){\r\n\tfunction Panel(){\r\n\t\t/**@private */\r\n\t\tthis._content=null;\r\n\t\t/**@private */\r\n\t\tthis._vScrollBar=null;\r\n\t\t/**@private */\r\n\t\tthis._hScrollBar=null;\r\n\t\t/**@private */\r\n\t\tthis._scrollChanged=false;\r\n\t\tPanel.__super.call(this);\r\n\t\tthis.width=this.height=100;\r\n\t}\r\n\r\n\t__class(Panel,'laya.ui.Panel',_super);\r\n\tvar __proto=Panel.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tlaya.ui.Component.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._content && this._content.destroy(destroyChild);\r\n\t\tthis._vScrollBar && this._vScrollBar.destroy(destroyChild);\r\n\t\tthis._hScrollBar && this._hScrollBar.destroy(destroyChild);\r\n\t\tthis._vScrollBar=null;\r\n\t\tthis._hScrollBar=null;\r\n\t\tthis._content=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.destroyChildren=function(){\r\n\t\tthis._content.destroyChildren();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tlaya.display.Node.prototype.addChild.call(this,this._content=new Box());\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.addChild=function(child){\r\n\t\tchild.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setScrollChanged();\r\n\t\treturn this._content.addChild(child);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*子对象的 <code>Event.RESIZE</code> 事件侦听处理函数。\r\n\t*/\r\n\t__proto.onResize=function(){\r\n\t\tthis._setScrollChanged();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.addChildAt=function(child,index){\r\n\t\tchild.on(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setScrollChanged();\r\n\t\treturn this._content.addChildAt(child,index);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.removeChild=function(child){\r\n\t\tchild.off(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setScrollChanged();\r\n\t\treturn this._content.removeChild(child);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.removeChildAt=function(index){\r\n\t\tthis.getChildAt(index).off(/*laya.events.Event.RESIZE*/\"resize\",this,this.onResize);\r\n\t\tthis._setScrollChanged();\r\n\t\treturn this._content.removeChildAt(index);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.removeChildren=function(beginIndex,endIndex){\r\n\t\t(beginIndex===void 0)&& (beginIndex=0);\r\n\t\t(endIndex===void 0)&& (endIndex=0x7fffffff);\r\n\t\tfor (var i=this._content.numChildren-1;i >-1;i--){\r\n\t\t\tthis._content.removeChildAt(i);\r\n\t\t}\r\n\t\tthis._setScrollChanged();\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.getChildAt=function(index){\r\n\t\treturn this._content.getChildAt(index);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.getChildByName=function(name){\r\n\t\treturn this._content.getChildByName(name);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.getChildIndex=function(child){\r\n\t\treturn this._content.getChildIndex(child);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.changeScroll=function(){\r\n\t\tthis._scrollChanged=false;\r\n\t\tvar contentW=this.contentWidth || 1;\r\n\t\tvar contentH=this.contentHeight || 1;\r\n\t\tvar vscroll=this._vScrollBar;\r\n\t\tvar hscroll=this._hScrollBar;\r\n\t\tvar vShow=vscroll && contentH > this._height;\r\n\t\tvar hShow=hscroll && contentW > this._width;\r\n\t\tvar showWidth=vShow ? this._width-vscroll.width :this._width;\r\n\t\tvar showHeight=hShow ? this._height-hscroll.height :this._height;\r\n\t\tif (vscroll){\r\n\t\t\tvscroll.x=this._width-vscroll.width;\r\n\t\t\tvscroll.y=0;\r\n\t\t\tvscroll.height=this._height-(hShow ? hscroll.height :0);\r\n\t\t\tvscroll.scrollSize=Math.max(this._height *0.033,1);\r\n\t\t\tvscroll.thumbPercent=showHeight / contentH;\r\n\t\t\tvscroll.setScroll(0,contentH-showHeight,vscroll.value);\r\n\t\t}\r\n\t\tif (hscroll){\r\n\t\t\thscroll.x=0;\r\n\t\t\thscroll.y=this._height-hscroll.height;\r\n\t\t\thscroll.width=this._width-(vShow ? vscroll.width :0);\r\n\t\t\thscroll.scrollSize=Math.max(this._width *0.033,1);\r\n\t\t\thscroll.thumbPercent=showWidth / contentW;\r\n\t\t\thscroll.setScroll(0,contentW-showWidth,hscroll.value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.changeSize=function(){\r\n\t\tlaya.ui.Component.prototype.changeSize.call(this);\r\n\t\tthis.setContentSize(this._width,this._height);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置内容的宽度、高度（以像素为单位）。\r\n\t*@param width 宽度。\r\n\t*@param height 高度。\r\n\t*/\r\n\t__proto.setContentSize=function(width,height){\r\n\t\tvar content=this._content;\r\n\t\tcontent.width=width;\r\n\t\tcontent.height=height;\r\n\t\tcontent.scrollRect || (content.scrollRect=new Rectangle());\r\n\t\tcontent.scrollRect.setTo(0,0,width,height);\r\n\t\tcontent.scrollRect=content.scrollRect;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*滚动条的<code><code>Event.MOUSE_DOWN</code>事件侦听处理函数。</code>事件侦听处理函数。\r\n\t*@param scrollBar 滚动条对象。\r\n\t*@param e Event 对象。\r\n\t*/\r\n\t__proto.onScrollBarChange=function(scrollBar){\r\n\t\tvar rect=this._content.scrollRect;\r\n\t\tif (rect){\r\n\t\t\tvar start=Math.round(scrollBar.value);\r\n\t\t\tscrollBar.isVertical ? rect.y=start :rect.x=start;\r\n\t\t\tthis._content.scrollRect=rect;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>滚动内容容器至设定的垂直、水平方向滚动条位置。</p>\r\n\t*@param x 水平方向滚动条属性value值。滚动条位置数字。\r\n\t*@param y 垂直方向滚动条属性value值。滚动条位置数字。\r\n\t*/\r\n\t__proto.scrollTo=function(x,y){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\tif (this.vScrollBar)this.vScrollBar.value=y;\r\n\t\tif (this.hScrollBar)this.hScrollBar.value=x;\r\n\t}\r\n\r\n\t/**\r\n\t*刷新滚动内容。\r\n\t*/\r\n\t__proto.refresh=function(){\r\n\t\tthis.changeScroll();\r\n\t}\r\n\r\n\t__proto.onScrollStart=function(){\r\n\t\tthis._$P.cacheAs || (this._$P.cacheAs=Laya.superGet(Box,this,'cacheAs'));\r\n\t\tLaya.superSet(Box,this,'cacheAs',\"none\");\r\n\t\tthis._hScrollBar && this._hScrollBar.once(/*laya.events.Event.END*/\"end\",this,this.onScrollEnd);\r\n\t\tthis._vScrollBar && this._vScrollBar.once(/*laya.events.Event.END*/\"end\",this,this.onScrollEnd);\r\n\t}\r\n\r\n\t__proto.onScrollEnd=function(){\r\n\t\tLaya.superSet(Box,this,'cacheAs',this._$P.cacheAs);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setScrollChanged=function(){\r\n\t\tif (!this._scrollChanged){\r\n\t\t\tthis._scrollChanged=true;\r\n\t\t\tthis.callLater(this.changeScroll);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'numChildren',function(){\r\n\t\treturn this._content.numChildren;\r\n\t});\r\n\r\n\t/**\r\n\t*水平方向滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'hScrollBarSkin',function(){\r\n\t\treturn this._hScrollBar ? this._hScrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tif (this._hScrollBar==null){\r\n\t\t\tlaya.display.Node.prototype.addChild.call(this,this._hScrollBar=new HScrollBar());\r\n\t\t\tthis._hScrollBar.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onScrollBarChange,[this._hScrollBar]);\r\n\t\t\tthis._hScrollBar.target=this._content;\r\n\t\t\tthis._setScrollChanged();\r\n\t\t}\r\n\t\tthis._hScrollBar.skin=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取内容宽度（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'contentWidth',function(){\r\n\t\tvar max=0;\r\n\t\tfor (var i=this._content.numChildren-1;i >-1;i--){\r\n\t\t\tvar comp=this._content.getChildAt(i);\r\n\t\t\tmax=Math.max(comp.x+comp.width *comp.scaleX,max);\r\n\t\t}\r\n\t\treturn max;\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取内容高度（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'contentHeight',function(){\r\n\t\tvar max=0;\r\n\t\tfor (var i=this._content.numChildren-1;i >-1;i--){\r\n\t\t\tvar comp=this._content.getChildAt(i);\r\n\t\t\tmax=Math.max(comp.y+comp.height *comp.scaleY,max);\r\n\t\t}\r\n\t\treturn max;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Box,this,'width',value);\r\n\t\tthis._setScrollChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*水平方向滚动条对象。\r\n\t*/\r\n\t__getset(0,__proto,'hScrollBar',function(){\r\n\t\treturn this._hScrollBar;\r\n\t});\r\n\r\n\t/**\r\n\t*获取内容容器对象。\r\n\t*/\r\n\t__getset(0,__proto,'content',function(){\r\n\t\treturn this._content;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Box,this,'height',value);\r\n\t\tthis._setScrollChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*垂直方向滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'vScrollBarSkin',function(){\r\n\t\treturn this._vScrollBar ? this._vScrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tif (this._vScrollBar==null){\r\n\t\t\tlaya.display.Node.prototype.addChild.call(this,this._vScrollBar=new VScrollBar());\r\n\t\t\tthis._vScrollBar.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onScrollBarChange,[this._vScrollBar]);\r\n\t\t\tthis._vScrollBar.target=this._content;\r\n\t\t\tthis._setScrollChanged();\r\n\t\t}\r\n\t\tthis._vScrollBar.skin=value;\r\n\t});\r\n\r\n\t/**\r\n\t*垂直方向滚动条对象。\r\n\t*/\r\n\t__getset(0,__proto,'vScrollBar',function(){\r\n\t\treturn this._vScrollBar;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'cacheAs',_super.prototype._$get_cacheAs,function(value){\r\n\t\tLaya.superSet(Box,this,'cacheAs',value);\r\n\t\tthis._$P.cacheAs=null;\r\n\t\tif (value!==\"none\"){\r\n\t\t\tthis._hScrollBar && this._hScrollBar.on(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t\tthis._vScrollBar && this._vScrollBar.on(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t\t}else {\r\n\t\t\tthis._hScrollBar && this._hScrollBar.off(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t\tthis._vScrollBar && this._vScrollBar.off(/*laya.events.Event.START*/\"start\",this,this.onScrollStart);\r\n\t\t}\r\n\t});\r\n\r\n\treturn Panel;\r\n})(Box)\r\n\r\n\r\n/**\r\n*使用 <code>HSlider</code> 控件，用户可以通过在滑块轨道的终点之间移动滑块来选择值。\r\n*<p> <code>HSlider</code> 控件采用水平方向。滑块轨道从左向右扩展，而标签位于轨道的顶部或底部。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>HSlider</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.HSlider;\r\n\t*import laya.utils.Handler;\r\n\t*public class HSlider_Example\r\n\t*{\r\n\t\t*private var hSlider:HSlider;\r\n\t\t*public function HSlider_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/hslider.png\",\"resource/ui/hslider$bar.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*hSlider=new HSlider();//创建一个 HSlider 类的实例对象 hSlider 。\r\n\t\t\t*hSlider.skin=\"resource/ui/hslider.png\";//设置 hSlider 的皮肤。\r\n\t\t\t*hSlider.min=0;//设置 hSlider 最低位置值。\r\n\t\t\t*hSlider.max=10;//设置 hSlider 最高位置值。\r\n\t\t\t*hSlider.value=2;//设置 hSlider 当前位置值。\r\n\t\t\t*hSlider.tick=1;//设置 hSlider 刻度值。\r\n\t\t\t*hSlider.x=100;//设置 hSlider 对象的属性 x 的值，用于控制 hSlider 对象的显示位置。\r\n\t\t\t*hSlider.y=100;//设置 hSlider 对象的属性 y 的值，用于控制 hSlider 对象的显示位置。\r\n\t\t\t*hSlider.changeHandler=new Handler(this,onChange);//设置 hSlider 位置变化处理器。\r\n\t\t\t*Laya.stage.addChild(hSlider);//把 hSlider 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onChange(value:Number):void\r\n\t\t*{\r\n\t\t\t*trace(\"滑块的位置： value=\"+value);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800,\"canvas\");//设置游戏画布宽高、渲染模式\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var hSlider;\r\n*var res=[\"resource/ui/hslider.png\",\"resource/ui/hslider$bar.png\"];\r\n*Laya.loader.load(res,laya.utils.Handler.create(this,onLoadComplete));\r\n*function onLoadComplete(){\r\n\t*console.log(\"资源加载完成！\");\r\n\t*hSlider=new laya.ui.HSlider();//创建一个 HSlider 类的实例对象 hSlider 。\r\n\t*hSlider.skin=\"resource/ui/hslider.png\";//设置 hSlider 的皮肤。\r\n\t*hSlider.min=0;//设置 hSlider 最低位置值。\r\n\t*hSlider.max=10;//设置 hSlider 最高位置值。\r\n\t*hSlider.value=2;//设置 hSlider 当前位置值。\r\n\t*hSlider.tick=1;//设置 hSlider 刻度值。\r\n\t*hSlider.x=100;//设置 hSlider 对象的属性 x 的值，用于控制 hSlider 对象的显示位置。\r\n\t*hSlider.y=100;//设置 hSlider 对象的属性 y 的值，用于控制 hSlider 对象的显示位置。\r\n\t*hSlider.changeHandler=new laya.utils.Handler(this,onChange);//设置 hSlider 位置变化处理器。\r\n\t*Laya.stage.addChild(hSlider);//把 hSlider 添加到显示列表。\r\n\t*}\r\n*function onChange(value)\r\n*{\r\n\t*console.log(\"滑块的位置： value=\"+value);\r\n\t*}\r\n*@example\r\n*import Handler=laya.utils.Handler;\r\n*import HSlider=laya.ui.HSlider;\r\n*class HSlider_Example {\r\n\t*private hSlider:HSlider;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/hslider.png\",\"resource/ui/hslider$bar.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.hSlider=new HSlider();//创建一个 HSlider 类的实例对象 hSlider 。\r\n\t\t*this.hSlider.skin=\"resource/ui/hslider.png\";//设置 hSlider 的皮肤。\r\n\t\t*this.hSlider.min=0;//设置 hSlider 最低位置值。\r\n\t\t*this.hSlider.max=10;//设置 hSlider 最高位置值。\r\n\t\t*this.hSlider.value=2;//设置 hSlider 当前位置值。\r\n\t\t*this.hSlider.tick=1;//设置 hSlider 刻度值。\r\n\t\t*this.hSlider.x=100;//设置 hSlider 对象的属性 x 的值，用于控制 hSlider 对象的显示位置。\r\n\t\t*this.hSlider.y=100;//设置 hSlider 对象的属性 y 的值，用于控制 hSlider 对象的显示位置。\r\n\t\t*this.hSlider.changeHandler=new Handler(this,this.onChange);//设置 hSlider 位置变化处理器。\r\n\t\t*Laya.stage.addChild(this.hSlider);//把 hSlider 添加到显示列表。\r\n\t\t*}\r\n\t*private onChange(value:number):void {\r\n\t\t*console.log(\"滑块的位置： value=\"+value);\r\n\t\t*}\r\n\t*}\r\n*\r\n*@see laya.ui.Slider\r\n*/\r\n//class laya.ui.HSlider extends laya.ui.Slider\r\nvar HSlider=(function(_super){\r\n\t/**\r\n\t*创建一个 <code>HSlider</code> 类实例。\r\n\t*@param skin 皮肤。\r\n\t*/\r\n\tfunction HSlider(skin){\r\n\t\tHSlider.__super.call(this,skin);\r\n\t\tthis.isVertical=false;\r\n\t}\r\n\r\n\t__class(HSlider,'laya.ui.HSlider',_super);\r\n\treturn HSlider;\r\n})(Slider)\r\n\r\n\r\n/**\r\n*<code>Group</code> 是一个可以自动布局的项集合控件。\r\n*<p> <code>Group</code> 的默认项对象为 <code>Button</code> 类实例。\r\n*<code>Group</code> 是 <code>Tab</code> 和 <code>RadioGroup</code> 的基类。</p>\r\n*/\r\n//class laya.ui.UIGroup extends laya.ui.Box\r\nvar UIGroup=(function(_super){\r\n\tfunction UIGroup(labels,skin){\r\n\t\t/**\r\n\t\t*改变 <code>Group</code> 的选择项时执行的处理器，(默认返回参数： 项索引（index:int）)。\r\n\t\t*/\r\n\t\tthis.selectHandler=null;\r\n\t\t/**@private */\r\n\t\tthis._items=null;\r\n\t\t/**@private */\r\n\t\tthis._selectedIndex=-1;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\t/**@private */\r\n\t\tthis._direction=\"horizontal\";\r\n\t\t/**@private */\r\n\t\tthis._space=0;\r\n\t\t/**@private */\r\n\t\tthis._labels=null;\r\n\t\t/**@private */\r\n\t\tthis._labelColors=null;\r\n\t\t/**@private */\r\n\t\tthis._labelFont=null;\r\n\t\t/**@private */\r\n\t\tthis._labelStrokeColor=null;\r\n\t\t/**@private */\r\n\t\tthis._strokeColors=null;\r\n\t\t/**@private */\r\n\t\tthis._labelStroke=NaN;\r\n\t\t/**@private */\r\n\t\tthis._labelSize=0;\r\n\t\t/**@private */\r\n\t\tthis._labelBold=false;\r\n\t\t/**@private */\r\n\t\tthis._labelPadding=null;\r\n\t\t/**@private */\r\n\t\tthis._labelAlign=null;\r\n\t\t/**@private */\r\n\t\tthis._stateNum=0;\r\n\t\t/**@private */\r\n\t\tthis._labelChanged=false;\r\n\t\tUIGroup.__super.call(this);\r\n\t\tthis.skin=skin;\r\n\t\tthis.labels=labels;\r\n\t}\r\n\r\n\t__class(UIGroup,'laya.ui.UIGroup',_super);\r\n\tvar __proto=UIGroup.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IItem\":true})\r\n\t/**@inheritDoc */\r\n\t__proto.preinitialize=function(){\r\n\t\tthis.mouseEnabled=true;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tlaya.ui.Component.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._items && (this._items.length=0);\r\n\t\tthis._items=null;\r\n\t\tthis.selectHandler=null;\r\n\t}\r\n\r\n\t/**\r\n\t*添加一个项对象，返回此项对象的索引id。\r\n\t*\r\n\t*@param item 需要添加的项对象。\r\n\t*@param autoLayOut 是否自动布局，如果为true，会根据 <code>direction</code> 和 <code>space</code> 属性计算item的位置。\r\n\t*@return\r\n\t*/\r\n\t__proto.addItem=function(item,autoLayOut){\r\n\t\t(autoLayOut===void 0)&& (autoLayOut=true);\r\n\t\tvar display=item;\r\n\t\tvar index=this._items.length;\r\n\t\tdisplay.name=\"item\"+index;\r\n\t\tthis.addChild(display);\r\n\t\tthis.initItems();\r\n\t\tif (autoLayOut && index > 0){\r\n\t\t\tvar preItem=this._items [index-1];\r\n\t\t\tif (this._direction==\"horizontal\"){\r\n\t\t\t\tdisplay.x=preItem.x+preItem.width+this._space;\r\n\t\t\t\t}else {\r\n\t\t\t\tdisplay.y=preItem.y+preItem.height+this._space;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (autoLayOut){\r\n\t\t\t\tdisplay.x=0;\r\n\t\t\t\tdisplay.y=0;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t*删除一个项对象。\r\n\t*@param item 需要删除的项对象。\r\n\t*@param autoLayOut 是否自动布局，如果为true，会根据 <code>direction</code> 和 <code>space</code> 属性计算item的位置。\r\n\t*/\r\n\t__proto.delItem=function(item,autoLayOut){\r\n\t\t(autoLayOut===void 0)&& (autoLayOut=true);\r\n\t\tvar index=this._items.indexOf(item);\r\n\t\tif (index !=-1){\r\n\t\t\tvar display=item;\r\n\t\t\tthis.removeChild(display);\r\n\t\t\tfor (var i=index+1,n=this._items.length;i < n;i++){\r\n\t\t\t\tvar child=this._items [i];\r\n\t\t\t\tchild.name=\"item\"+(i-1);\r\n\t\t\t\tif (autoLayOut){\r\n\t\t\t\t\tif (this._direction==\"horizontal\"){\r\n\t\t\t\t\t\tchild.x-=display.width+this._space;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tchild.y-=display.height+this._space;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.initItems();\r\n\t\t\tif (this._selectedIndex >-1){\r\n\t\t\t\tvar newIndex=0;\r\n\t\t\t\tnewIndex=this._selectedIndex < this._items.length ? this._selectedIndex :(this._selectedIndex-1);\r\n\t\t\t\tthis._selectedIndex=-1;\r\n\t\t\t\tthis.selectedIndex=newIndex;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*初始化项对象们。\r\n\t*/\r\n\t__proto.initItems=function(){\r\n\t\tthis._items || (this._items=[]);\r\n\t\tthis._items.length=0;\r\n\t\tfor (var i=0;i < 10000;i++){\r\n\t\t\tvar item=this.getChildByName(\"item\"+i);\r\n\t\t\tif (item==null)break ;\r\n\t\t\tthis._items.push(item);\r\n\t\t\titem.selected=(i===this._selectedIndex);\r\n\t\t\titem.clickHandler=Handler.create(this,this.itemClick,[i],false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*项对象的点击事件侦听处理函数。\r\n\t*@param index 项索引。\r\n\t*/\r\n\t__proto.itemClick=function(index){\r\n\t\tthis.selectedIndex=index;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*通过对象的索引设置项对象的 <code>selected</code> 属性值。\r\n\t*@param index 需要设置的项对象的索引。\r\n\t*@param selected 表示项对象的选中状态。\r\n\t*/\r\n\t__proto.setSelect=function(index,selected){\r\n\t\tif (this._items && index >-1 && index < this._items.length)this._items[index].selected=selected;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*创建一个项显示对象。\r\n\t*@param skin 项对象的皮肤。\r\n\t*@param label 项对象标签。\r\n\t*/\r\n\t__proto.createItem=function(skin,label){\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*更改项对象的属性值。\r\n\t*/\r\n\t__proto.changeLabels=function(){\r\n\t\tthis._labelChanged=false;\r\n\t\tif (this._items){\r\n\t\t\tvar left=0\r\n\t\t\tfor (var i=0,n=this._items.length;i < n;i++){\r\n\t\t\t\tvar btn=this._items [i];\r\n\t\t\t\tthis._skin && (btn.skin=this._skin);\r\n\t\t\t\tthis._labelColors && (btn.labelColors=this._labelColors);\r\n\t\t\t\tthis._labelSize && (btn.labelSize=this._labelSize);\r\n\t\t\t\tthis._labelStroke && (btn.labelStroke=this._labelStroke);\r\n\t\t\t\tthis._labelStrokeColor && (btn.labelStrokeColor=this._labelStrokeColor);\r\n\t\t\t\tthis._strokeColors && (btn.strokeColors=this._strokeColors);\r\n\t\t\t\tthis._labelBold && (btn.labelBold=this._labelBold);\r\n\t\t\t\tthis._labelPadding && (btn.labelPadding=this._labelPadding);\r\n\t\t\t\tthis._labelAlign && (btn.labelAlign=this._labelAlign);\r\n\t\t\t\tthis._stateNum && (btn.stateNum=this._stateNum);\r\n\t\t\t\tthis._labelFont && (btn.labelFont=this._labelFont);\r\n\t\t\t\tif (this._direction===\"horizontal\"){\r\n\t\t\t\t\tbtn.y=0;\r\n\t\t\t\t\tbtn.x=left;\r\n\t\t\t\t\tleft+=btn.width+this._space;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tbtn.x=0;\r\n\t\t\t\t\tbtn.y=left;\r\n\t\t\t\t\tleft+=btn.height+this._space;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changeSize();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.commitMeasure=function(){\r\n\t\tthis.runCallLater(this.changeLabels);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setLabelChanged=function(){\r\n\t\tif (!this._labelChanged){\r\n\t\t\tthis._labelChanged=true;\r\n\t\t\tthis.callLater(this.changeLabels);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>描边颜色，以字符串表示。</p>\r\n\t*默认值为 \"#000000\"（黑色）;\r\n\t*@see laya.display.Text.strokeColor()\r\n\t*/\r\n\t__getset(0,__proto,'labelStrokeColor',function(){\r\n\t\treturn this._labelStrokeColor;\r\n\t\t},function(value){\r\n\t\tif (this._labelStrokeColor !=value){\r\n\t\t\tthis._labelStrokeColor=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示当前选择的项索引。默认值为-1。\r\n\t*/\r\n\t__getset(0,__proto,'selectedIndex',function(){\r\n\t\treturn this._selectedIndex;\r\n\t\t},function(value){\r\n\t\tif (this._selectedIndex !=value){\r\n\t\t\tthis.setSelect(this._selectedIndex,false);\r\n\t\t\tthis._selectedIndex=value;\r\n\t\t\tthis.setSelect(value,true);\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\tthis.selectHandler && this.selectHandler.runWith(this._selectedIndex);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*标签集合字符串。以逗号做分割，如\"item0,item1,item2,item3,item4,item5\"。\r\n\t*/\r\n\t__getset(0,__proto,'labels',function(){\r\n\t\treturn this._labels;\r\n\t\t},function(value){\r\n\t\tif (this._labels !=value){\r\n\t\t\tthis._labels=value;\r\n\t\t\tthis.removeChildren();\r\n\t\t\tthis._setLabelChanged();\r\n\t\t\tif (this._labels){\r\n\t\t\t\tvar a=this._labels.split(\",\");\r\n\t\t\t\tfor (var i=0,n=a.length;i < n;i++){\r\n\t\t\t\t\tvar item=this.createItem(this._skin,a[i]);\r\n\t\t\t\t\titem.name=\"item\"+i;\r\n\t\t\t\t\tthis.addChild(item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.initItems();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示各个状态下的描边颜色。</p>\r\n\t*@see laya.display.Text.strokeColor()\r\n\t*/\r\n\t__getset(0,__proto,'strokeColors',function(){\r\n\t\treturn this._strokeColors;\r\n\t\t},function(value){\r\n\t\tif (this._strokeColors !=value){\r\n\t\t\tthis._strokeColors=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Button#labelColors()\r\n\t*/\r\n\t__getset(0,__proto,'labelColors',function(){\r\n\t\treturn this._labelColors;\r\n\t\t},function(value){\r\n\t\tif (this._labelColors !=value){\r\n\t\t\tthis._labelColors=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边宽度（以像素为单位）。</p>\r\n\t*默认值0，表示不描边。\r\n\t*@see laya.display.Text.stroke()\r\n\t*/\r\n\t__getset(0,__proto,'labelStroke',function(){\r\n\t\treturn this._labelStroke;\r\n\t\t},function(value){\r\n\t\tif (this._labelStroke !=value){\r\n\t\t\tthis._labelStroke=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的字体大小。\r\n\t*/\r\n\t__getset(0,__proto,'labelSize',function(){\r\n\t\treturn this._labelSize;\r\n\t\t},function(value){\r\n\t\tif (this._labelSize !=value){\r\n\t\t\tthis._labelSize=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮的状态值，以数字表示，默认为3态。\r\n\t*@see laya.ui.Button#stateNum\r\n\t*/\r\n\t__getset(0,__proto,'stateNum',function(){\r\n\t\treturn this._stateNum;\r\n\t\t},function(value){\r\n\t\tif (this._stateNum !=value){\r\n\t\t\tthis._stateNum=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签是否为粗体字。\r\n\t*/\r\n\t__getset(0,__proto,'labelBold',function(){\r\n\t\treturn this._labelBold;\r\n\t\t},function(value){\r\n\t\tif (this._labelBold !=value){\r\n\t\t\tthis._labelBold=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的字体名称，以字符串形式表示。\r\n\t*@see laya.display.Text.font()\r\n\t*/\r\n\t__getset(0,__proto,'labelFont',function(){\r\n\t\treturn this._labelFont;\r\n\t\t},function(value){\r\n\t\tif (this._labelFont !=value){\r\n\t\t\tthis._labelFont=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示按钮文本标签的边距。\r\n\t*<p><b>格式：</b>\"上边距,右边距,下边距,左边距\"。</p>\r\n\t*/\r\n\t__getset(0,__proto,'labelPadding',function(){\r\n\t\treturn this._labelPadding;\r\n\t\t},function(value){\r\n\t\tif (this._labelPadding !=value){\r\n\t\t\tthis._labelPadding=value;\r\n\t\t\tthis._setLabelChanged();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*布局方向。\r\n\t*<p>默认值为\"horizontal\"。</p>\r\n\t*<p><b>取值：</b>\r\n\t*<li>\"horizontal\"：表示水平布局。</li>\r\n\t*<li>\"vertical\"：表示垂直布局。</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'direction',function(){\r\n\t\treturn this._direction;\r\n\t\t},function(value){\r\n\t\tthis._direction=value;\r\n\t\tthis._setLabelChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*项对象们之间的间隔（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'space',function(){\r\n\t\treturn this._space;\r\n\t\t},function(value){\r\n\t\tthis._space=value;\r\n\t\tthis._setLabelChanged();\r\n\t});\r\n\r\n\t/**\r\n\t*项对象们的存放数组。\r\n\t*/\r\n\t__getset(0,__proto,'items',function(){\r\n\t\treturn this._items;\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置当前选择的项对象。\r\n\t*/\r\n\t__getset(0,__proto,'selection',function(){\r\n\t\treturn this._selectedIndex >-1 && this._selectedIndex < this._items.length ? this._items[this._selectedIndex] :null;\r\n\t\t},function(value){\r\n\t\tthis.selectedIndex=this._items.indexOf(value);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif (((typeof value=='number')&& Math.floor(value)==value)|| (typeof value=='string'))this.selectedIndex=parseInt(value);\r\n\t\telse if ((value instanceof Array))this.labels=(value).join(\",\");\r\n\t\telse Laya.superSet(Box,this,'dataSource',value);\r\n\t});\r\n\r\n\treturn UIGroup;\r\n})(Box)\r\n\r\n\r\n/**\r\n*<code>Radio</code> 控件使用户可在一组互相排斥的选择中做出一种选择。\r\n*用户一次只能选择 <code>Radio</code> 组中的一个成员。选择未选中的组成员将取消选择该组中当前所选的 <code>Radio</code> 控件。\r\n*@see laya.ui.RadioGroup\r\n*/\r\n//class laya.ui.Radio extends laya.ui.Button\r\nvar Radio=(function(_super){\r\n\tfunction Radio(skin,label){\r\n\t\t/**@private */\r\n\t\tthis._value=null;\r\n\t\t(label===void 0)&& (label=\"\");\r\n\t\tRadio.__super.call(this,skin,label);\r\n\t}\r\n\r\n\t__class(Radio,'laya.ui.Radio',_super);\r\n\tvar __proto=Radio.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._value=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.preinitialize=function(){\r\n\t\tlaya.ui.Component.prototype.preinitialize.call(this);\r\n\t\tthis.toggle=false;\r\n\t\tthis._autoSize=false;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\t_super.prototype.initialize.call(this);\r\n\t\tthis.createText();\r\n\t\tthis._text.align=\"left\";\r\n\t\tthis._text.valign=\"top\";\r\n\t\tthis._text.width=0;\r\n\t\tthis.on(/*laya.events.Event.CLICK*/\"click\",this,this.onClick);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*对象的<code>Event.CLICK</code>事件侦听处理函数。\r\n\t*/\r\n\t__proto.onClick=function(e){\r\n\t\tthis.selected=true;\r\n\t}\r\n\r\n\t/**\r\n\t*获取或设置 <code>Radio</code> 关联的可选用户定义值。\r\n\t*/\r\n\t__getset(0,__proto,'value',function(){\r\n\t\treturn this._value !=null ? this._value :this.label;\r\n\t\t},function(obj){\r\n\t\tthis._value=obj;\r\n\t});\r\n\r\n\treturn Radio;\r\n})(Button)\r\n\r\n\r\n/**\r\n*<code>Tree</code> 控件使用户可以查看排列为可扩展树的层次结构数据。\r\n*\r\n*@example\r\n*package\r\n*{\r\n\t*import laya.ui.Tree;\r\n\t*import laya.utils.Browser;\r\n\t*import laya.utils.Handler;\r\n\t*public class Tree_Example\r\n\t*{\r\n\t\t*public function Tree_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\",\"resource/ui/clip_selectBox.png\",\"resource/ui/clip_tree_folder.png\",\"resource/ui/clip_tree_arrow.png\"],Handler.create(this,onLoadComplete));\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var xmlString:String;//创建一个xml字符串，用于存储树结构数据。\r\n\t\t\t*xmlString=\"&lt;root&gt;&lt;item label='box1'&gt;&lt;abc label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;abc label='child5'/&gt;&lt;/item&gt;&lt;item label='box2'&gt;&lt;abc label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;/item&gt;&lt;/root&gt;\";\r\n\t\t\t*var domParser:*=new Browser.window.DOMParser();//创建一个DOMParser实例domParser。\r\n\t\t\t*var xml:*=domParser.parseFromString(xmlString,\"text/xml\");//解析xml字符。\r\n\t\t\t*var tree:Tree=new Tree();//创建一个 Tree 类的实例对象 tree 。\r\n\t\t\t*tree.scrollBarSkin=\"resource/ui/vscroll.png\";//设置 tree 的皮肤。\r\n\t\t\t*tree.itemRender=Item;//设置 tree 的项渲染器。\r\n\t\t\t*tree.xml=xml;//设置 tree 的树结构数据。\r\n\t\t\t*tree.x=100;//设置 tree 对象的属性 x 的值，用于控制 tree 对象的显示位置。\r\n\t\t\t*tree.y=100;//设置 tree 对象的属性 y 的值，用于控制 tree 对象的显示位置。\r\n\t\t\t*tree.width=200;//设置 tree 的宽度。\r\n\t\t\t*tree.height=100;//设置 tree 的高度。\r\n\t\t\t*Laya.stage.addChild(tree);//将 tree 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*import laya.ui.Box;\r\n*import laya.ui.Clip;\r\n*import laya.ui.Label;\r\n*class Item extends Box\r\n*{\r\n\t*public function Item()\r\n\t*{\r\n\t\t*this.name=\"render\";\r\n\t\t*this.right=0;\r\n\t\t*this.left=0;\r\n\t\t*var selectBox:Clip=new Clip(\"resource/ui/clip_selectBox.png\",1,2);\r\n\t\t*selectBox.name=\"selectBox\";\r\n\t\t*selectBox.height=24;\r\n\t\t*selectBox.x=13;\r\n\t\t*selectBox.y=0;\r\n\t\t*selectBox.left=12;\r\n\t\t*addChild(selectBox);\r\n\t\t*var folder:Clip=new Clip(\"resource/ui/clip_tree_folder.png\",1,3);\r\n\t\t*folder.name=\"folder\";\r\n\t\t*folder.x=14;\r\n\t\t*folder.y=4;\r\n\t\t*addChild(folder);\r\n\t\t*var label:Label=new Label(\"treeItem\");\r\n\t\t*label.name=\"label\";\r\n\t\t*label.color=\"#ffff00\";\r\n\t\t*label.width=150;\r\n\t\t*label.height=22;\r\n\t\t*label.x=33;\r\n\t\t*label.y=1;\r\n\t\t*label.left=33;\r\n\t\t*label.right=0;\r\n\t\t*addChild(label);\r\n\t\t*var arrow:Clip=new Clip(\"resource/ui/clip_tree_arrow.png\",1,2);\r\n\t\t*arrow.name=\"arrow\";\r\n\t\t*arrow.x=0;\r\n\t\t*arrow.y=5;\r\n\t\t*addChild(arrow);\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var res=[\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\",\"resource/ui/clip_selectBox.png\",\"resource/ui/clip_tree_folder.png\",\"resource/ui/clip_tree_arrow.png\"];\r\n*Laya.loader.load(res,new laya.utils.Handler(this,onLoadComplete));\r\n*function onLoadComplete(){\r\n\t*var xmlString;//创建一个xml字符串，用于存储树结构数据。\r\n\t*xmlString=\"&lt;root&gt;&lt;item label='box1'&gt;&lt;abc label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;abc label='child5'/&gt;&lt;/item&gt;&lt;item label='box2'&gt;&lt;abc label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;/item&gt;&lt;/root&gt;\";\r\n\t*var domParser=new laya.utils.Browser.window.DOMParser();//创建一个DOMParser实例domParser。\r\n\t*var xml=domParser.parseFromString(xmlString,\"text/xml\");//解析xml字符。\r\n\t*var tree=new laya.ui.Tree();//创建一个 Tree 类的实例对象 tree 。\r\n\t*tree.scrollBarSkin=\"resource/ui/vscroll.png\";//设置 tree 的皮肤。\r\n\t*tree.itemRender=mypackage.treeExample.Item;//设置 tree 的项渲染器。\r\n\t*tree.xml=xml;//设置 tree 的树结构数据。\r\n\t*tree.x=100;//设置 tree 对象的属性 x 的值，用于控制 tree 对象的显示位置。\r\n\t*tree.y=100;//设置 tree 对象的属性 y 的值，用于控制 tree 对象的显示位置。\r\n\t*tree.width=200;//设置 tree 的宽度。\r\n\t*tree.height=100;//设置 tree 的高度。\r\n\t*Laya.stage.addChild(tree);//将 tree 添加到显示列表。\r\n\t*}\r\n*(function (_super){\r\n\t*function Item(){\r\n\t\t*Item.__super.call(this);//初始化父类。\r\n\t\t*this.right=0;\r\n\t\t*this.left=0;\r\n\t\t*var selectBox=new laya.ui.Clip(\"resource/ui/clip_selectBox.png\",1,2);\r\n\t\t*selectBox.name=\"selectBox\";//设置 selectBox 的name 为“selectBox”时，将被识别为树结构的项的背景。2帧：悬停时背景、选中时背景。\r\n\t\t*selectBox.height=24;\r\n\t\t*selectBox.x=13;\r\n\t\t*selectBox.y=0;\r\n\t\t*selectBox.left=12;\r\n\t\t*this.addChild(selectBox);//需要使用this.访问父类的属性或方法。\r\n\t\t*var folder=new laya.ui.Clip(\"resource/ui/clip_tree_folder.png\",1,3);\r\n\t\t*folder.name=\"folder\";//设置 folder 的name 为“folder”时，将被识别为树结构的文件夹开启状态图表。2帧：折叠状态、打开状态。\r\n\t\t*folder.x=14;\r\n\t\t*folder.y=4;\r\n\t\t*this.addChild(folder);\r\n\t\t*var label=new laya.ui.Label(\"treeItem\");\r\n\t\t*label.name=\"label\";//设置 label 的name 为“label”时，此值将用于树结构数据赋值。\r\n\t\t*label.color=\"#ffff00\";\r\n\t\t*label.width=150;\r\n\t\t*label.height=22;\r\n\t\t*label.x=33;\r\n\t\t*label.y=1;\r\n\t\t*label.left=33;\r\n\t\t*label.right=0;\r\n\t\t*this.addChild(label);\r\n\t\t*var arrow=new laya.ui.Clip(\"resource/ui/clip_tree_arrow.png\",1,2);\r\n\t\t*arrow.name=\"arrow\";//设置 arrow 的name 为“arrow”时，将被识别为树结构的文件夹开启状态图表。2帧：折叠状态、打开状态。\r\n\t\t*arrow.x=0;\r\n\t\t*arrow.y=5;\r\n\t\t*this.addChild(arrow);\r\n\t\t*};\r\n\t*Laya.class(Item,\"mypackage.treeExample.Item\",_super);//注册类 Item 。\r\n\t*})(laya.ui.Box);\r\n*@example\r\n*import Tree=laya.ui.Tree;\r\n*import Browser=laya.utils.Browser;\r\n*import Handler=laya.utils.Handler;\r\n*class Tree_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\",\"resource/ui/vscroll$up.png\",\"resource/ui/clip_selectBox.png\",\"resource/ui/clip_tree_folder * . * png\",\"resource/ui/clip_tree_arrow.png\"],Handler.create(this,this.onLoadComplete));\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var xmlString:String;//创建一个xml字符串，用于存储树结构数据。\r\n\t\t*xmlString=\"&lt;root&gt;&lt;item label='box1'&gt;&lt;abc label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;abc label='child5'/&gt;&lt;/item&gt;&lt;item label='box2'&gt;&lt;abc  * label='child1'/&gt;&lt;abc label='child2'/&gt;&lt;abc label='child3'/&gt;&lt;abc label='child4'/&gt;&lt;/item&gt;&lt;/root&gt;\";\r\n\t\t*var domParser:any=new Browser.window.DOMParser();//创建一个DOMParser实例domParser。\r\n\t\t*var xml:any=domParser.parseFromString(xmlString,\"text/xml\");//解析xml字符。\r\n\t\t*var tree:Tree=new Tree();//创建一个 Tree 类的实例对象 tree 。\r\n\t\t*tree.scrollBarSkin=\"resource/ui/vscroll.png\";//设置 tree 的皮肤。\r\n\t\t*tree.itemRender=Item;//设置 tree 的项渲染器。\r\n\t\t*tree.xml=xml;//设置 tree 的树结构数据。\r\n\t\t*tree.x=100;//设置 tree 对象的属性 x 的值，用于控制 tree 对象的显示位置。\r\n\t\t*tree.y=100;//设置 tree 对象的属性 y 的值，用于控制 tree 对象的显示位置。\r\n\t\t*tree.width=200;//设置 tree 的宽度。\r\n\t\t*tree.height=100;//设置 tree 的高度。\r\n\t\t*Laya.stage.addChild(tree);//将 tree 添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*import Box=laya.ui.Box;\r\n*import Clip=laya.ui.Clip;\r\n*import Label=laya.ui.Label;\r\n*class Item extends Box {\r\n\t*constructor(){\r\n\t\t*super();\r\n\t\t*this.name=\"render\";\r\n\t\t*this.right=0;\r\n\t\t*this.left=0;\r\n\t\t*var selectBox:Clip=new Clip(\"resource/ui/clip_selectBox.png\",1,2);\r\n\t\t*selectBox.name=\"selectBox\";\r\n\t\t*selectBox.height=24;\r\n\t\t*selectBox.x=13;\r\n\t\t*selectBox.y=0;\r\n\t\t*selectBox.left=12;\r\n\t\t*this.addChild(selectBox);\r\n\t\t*var folder:Clip=new Clip(\"resource/ui/clip_tree_folder.png\",1,3);\r\n\t\t*folder.name=\"folder\";\r\n\t\t*folder.x=14;\r\n\t\t*folder.y=4;\r\n\t\t*this.addChild(folder);\r\n\t\t*var label:Label=new Label(\"treeItem\");\r\n\t\t*label.name=\"label\";\r\n\t\t*label.color=\"#ffff00\";\r\n\t\t*label.width=150;\r\n\t\t*label.height=22;\r\n\t\t*label.x=33;\r\n\t\t*label.y=1;\r\n\t\t*label.left=33;\r\n\t\t*label.right=0;\r\n\t\t*this.addChild(label);\r\n\t\t*var arrow:Clip=new Clip(\"resource/ui/clip_tree_arrow.png\",1,2);\r\n\t\t*arrow.name=\"arrow\";\r\n\t\t*arrow.x=0;\r\n\t\t*arrow.y=5;\r\n\t\t*this.addChild(arrow);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.Tree extends laya.ui.Box\r\nvar Tree=(function(_super){\r\n\tfunction Tree(){\r\n\t\t/**@private */\r\n\t\tthis._list=null;\r\n\t\t/**@private */\r\n\t\tthis._source=null;\r\n\t\t/**@private */\r\n\t\tthis._renderHandler=null;\r\n\t\t/**@private */\r\n\t\tthis._spaceLeft=10;\r\n\t\t/**@private */\r\n\t\tthis._spaceBottom=0;\r\n\t\t/**@private */\r\n\t\tthis._keepStatus=true;\r\n\t\tTree.__super.call(this);\r\n\t\tthis.width=this.height=200;\r\n\t}\r\n\r\n\t__class(Tree,'laya.ui.Tree',_super);\r\n\tvar __proto=Tree.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IRender\":true})\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tlaya.ui.Component.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._list && this._list.destroy(destroyChild);\r\n\t\tthis._list=null;\r\n\t\tthis._source=null;\r\n\t\tthis._renderHandler=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._list=new List());\r\n\t\tthis._list.renderHandler=Handler.create(this,this.renderItem,null,false);\r\n\t\tthis._list.repeatX=1;\r\n\t\tthis._list.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onListChange);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*此对象包含的<code>List</code>实例的<code>Event.CHANGE</code>事件侦听处理函数。\r\n\t*/\r\n\t__proto.onListChange=function(e){\r\n\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取数据源集合。\r\n\t*/\r\n\t__proto.getArray=function(){\r\n\t\tvar arr=[];\r\n\t\tvar item;\r\n\t\t/*for each*/for(var $each_item in this._source){\r\n\t\t\titem=this._source[$each_item];\r\n\t\t\tif (this.getParentOpenStatus(item)){\r\n\t\t\t\titem.x=this._spaceLeft *this.getDepth(item);\r\n\t\t\t\tarr.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取项对象的深度。\r\n\t*/\r\n\t__proto.getDepth=function(item,num){\r\n\t\t(num===void 0)&& (num=0);\r\n\t\tif (item.nodeParent==null)return num;\r\n\t\telse return this.getDepth(item.nodeParent,num+1);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取项对象的上一级的打开状态。\r\n\t*/\r\n\t__proto.getParentOpenStatus=function(item){\r\n\t\tvar parent=item.nodeParent;\r\n\t\tif (parent==null){\r\n\t\t\treturn true;\r\n\t\t\t}else {\r\n\t\t\tif (parent.isOpen){\r\n\t\t\t\tif (parent.nodeParent !=null)return this.getParentOpenStatus(parent);\r\n\t\t\t\telse return true;\r\n\t\t\t\t}else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*渲染一个项对象。\r\n\t*@param cell 一个项对象。\r\n\t*@param index 项的索引。\r\n\t*/\r\n\t__proto.renderItem=function(cell,index){\r\n\t\tvar item=cell.dataSource;\r\n\t\tif (item){\r\n\t\t\tcell.left=item.x;\r\n\t\t\tvar arrow=cell.getChildByName(\"arrow\");\r\n\t\t\tif (arrow){\r\n\t\t\t\tif (item.hasChild){\r\n\t\t\t\t\tarrow.visible=true;\r\n\t\t\t\t\tarrow.index=item.isOpen ? 1 :0;\r\n\t\t\t\t\tarrow.tag=index;\r\n\t\t\t\t\tarrow.off(/*laya.events.Event.CLICK*/\"click\",this,this.onArrowClick);\r\n\t\t\t\t\tarrow.on(/*laya.events.Event.CLICK*/\"click\",this,this.onArrowClick);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tarrow.visible=false;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar folder=cell.getChildByName(\"folder\");\r\n\t\t\tif (folder){\r\n\t\t\t\tif (folder.clipY==2){\r\n\t\t\t\t\tfolder.index=item.isDirectory ? 0 :1;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tfolder.index=item.isDirectory ? item.isOpen ? 1 :0 :2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._renderHandler && this._renderHandler.runWith([cell,index]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.onArrowClick=function(e){\r\n\t\tvar arrow=e.currentTarget;\r\n\t\tvar index=arrow.tag;\r\n\t\tthis._list.array[index].isOpen=!this._list.array[index].isOpen;\r\n\t\tthis.event(/*laya.events.Event.OPEN*/\"open\");\r\n\t\tthis._list.array=this.getArray();\r\n\t}\r\n\r\n\t/**\r\n\t*设置指定项索引的项对象的打开状态。\r\n\t*@param index 项索引。\r\n\t*@param isOpen 是否处于打开状态。\r\n\t*/\r\n\t__proto.setItemState=function(index,isOpen){\r\n\t\tif (!this._list.array[index])return;\r\n\t\tthis._list.array[index].isOpen=isOpen;\r\n\t\tthis._list.array=this.getArray();\r\n\t}\r\n\r\n\t/**\r\n\t*刷新项列表。\r\n\t*/\r\n\t__proto.fresh=function(){\r\n\t\tthis._list.array=this.getArray();\r\n\t\tthis.repaint();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*解析并处理XML类型的数据源。\r\n\t*/\r\n\t__proto.parseXml=function(xml,source,nodeParent,isRoot){\r\n\t\tvar obj;\r\n\t\tvar list=xml.childNodes;\r\n\t\tvar childCount=list.length;\r\n\t\tif (!isRoot){\r\n\t\t\tobj={};\r\n\t\t\tvar list2=xml.attributes;\r\n\t\t\tvar attrs;\r\n\t\t\t/*for each*/for(var $each_attrs in list2){\r\n\t\t\t\tattrs=list2[$each_attrs];\r\n\t\t\t\tvar prop=attrs.nodeName;\r\n\t\t\t\tvar value=attrs.nodeValue;\r\n\t\t\t\tobj[prop]=value==\"true\" ? true :value==\"false\" ? false :value;\r\n\t\t\t}\r\n\t\t\tobj.nodeParent=nodeParent;\r\n\t\t\tif (childCount > 0)obj.isDirectory=true;\r\n\t\t\tobj.hasChild=childCount > 0;\r\n\t\t\tsource.push(obj);\r\n\t\t}\r\n\t\tfor (var i=0;i < childCount;i++){\r\n\t\t\tvar node=list[i];\r\n\t\t\tthis.parseXml(node,source,obj,false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*处理数据项的打开状态。\r\n\t*/\r\n\t__proto.parseOpenStatus=function(oldSource,newSource){\r\n\t\tfor (var i=0,n=newSource.length;i < n;i++){\r\n\t\t\tvar newItem=newSource[i];\r\n\t\t\tif (newItem.isDirectory){\r\n\t\t\t\tfor (var j=0,m=oldSource.length;j < m;j++){\r\n\t\t\t\t\tvar oldItem=oldSource[j];\r\n\t\t\t\t\tif (oldItem.isDirectory && this.isSameParent(oldItem,newItem)&& newItem.label==oldItem.label){\r\n\t\t\t\t\t\tnewItem.isOpen=oldItem.isOpen;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*判断两个项对象在树结构中的父节点是否相同。\r\n\t*@param item1 项对象。\r\n\t*@param item2 项对象。\r\n\t*@return 如果父节点相同值为true，否则值为false。\r\n\t*/\r\n\t__proto.isSameParent=function(item1,item2){\r\n\t\tif (item1.nodeParent==null && item2.nodeParent==null)return true;\r\n\t\telse if (item1.nodeParent==null || item2.nodeParent==null)return false\r\n\t\telse {\r\n\t\t\tif (item1.nodeParent.label==item2.nodeParent.label)return this.isSameParent(item1.nodeParent,item2.nodeParent);\r\n\t\t\telse return false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*更新项列表，显示指定键名的数据项。\r\n\t*@param key 键名。\r\n\t*/\r\n\t__proto.filter=function(key){\r\n\t\tif (Boolean(key)){\r\n\t\t\tvar result=[];\r\n\t\t\tthis.getFilterSource(this._source,result,key);\r\n\t\t\tthis._list.array=result;\r\n\t\t\t}else {\r\n\t\t\tthis._list.array=this.getArray();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取数据源中指定键名的值。\r\n\t*/\r\n\t__proto.getFilterSource=function(array,result,key){\r\n\t\tkey=key.toLocaleLowerCase();\r\n\t\tvar item;\r\n\t\t/*for each*/for(var $each_item in array){\r\n\t\t\titem=array[$each_item];\r\n\t\t\tif (!item.isDirectory && String(item.label).toLowerCase().indexOf(key)>-1){\r\n\t\t\t\titem.x=0;\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t\tif (item.child && item.child.length > 0){\r\n\t\t\t\tthis.getFilterSource(item.child,result,key);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*每一项之间的间隔距离（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'spaceBottom',function(){\r\n\t\treturn this._list.spaceY;\r\n\t\t},function(value){\r\n\t\tthis._list.spaceY=value;\r\n\t});\r\n\r\n\t/**\r\n\t*数据源发生变化后，是否保持之前打开状态，默认为true。\r\n\t*<p><b>取值：</b>\r\n\t*<li>true：保持之前打开状态。</li>\r\n\t*<li>false：不保持之前打开状态。</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'keepStatus',function(){\r\n\t\treturn this._keepStatus;\r\n\t\t},function(value){\r\n\t\tthis._keepStatus=value;\r\n\t});\r\n\r\n\t/**\r\n\t*此对象包含的<code>List</code>实例的单元格渲染器。\r\n\t*<p><b>取值：</b>\r\n\t*<ol>\r\n\t*<li>单元格类对象。</li>\r\n\t*<li> UI 的 JSON 描述。</li>\r\n\t*</ol></p>\r\n\t*/\r\n\t__getset(0,__proto,'itemRender',function(){\r\n\t\treturn this._list.itemRender;\r\n\t\t},function(value){\r\n\t\tthis._list.itemRender=value;\r\n\t});\r\n\r\n\t/**\r\n\t*列表数据源，只包含当前可视节点数据。\r\n\t*/\r\n\t__getset(0,__proto,'array',function(){\r\n\t\treturn this._list.array;\r\n\t\t},function(value){\r\n\t\tif (this._keepStatus && this._list.array && value){\r\n\t\t\tthis.parseOpenStatus(this._list.array,value);\r\n\t\t}\r\n\t\tthis._source=value;\r\n\t\tthis._list.array=this.getArray();\r\n\t});\r\n\r\n\t/**\r\n\t*单元格鼠标事件处理器。\r\n\t*<p>默认返回参数（e:Event,index:int）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'mouseHandler',function(){\r\n\t\treturn this._list.mouseHandler;\r\n\t\t},function(value){\r\n\t\tthis._list.mouseHandler=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tLaya.superSet(Box,this,'dataSource',value);\r\n\t});\r\n\r\n\t/**\r\n\t*数据源，全部节点数据。\r\n\t*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\treturn this._source;\r\n\t});\r\n\r\n\t/**滚动条*/\r\n\t__getset(0,__proto,'scrollBar',function(){\r\n\t\treturn this._list.scrollBar;\r\n\t});\r\n\r\n\t/**\r\n\t*此对象包含的<code>List</code>实例对象。\r\n\t*/\r\n\t__getset(0,__proto,'list',function(){\r\n\t\treturn this._list;\r\n\t});\r\n\r\n\t/**\r\n\t*滚动条皮肤。\r\n\t*/\r\n\t__getset(0,__proto,'scrollBarSkin',function(){\r\n\t\treturn this._list.vScrollBarSkin;\r\n\t\t},function(value){\r\n\t\tthis._list.vScrollBarSkin=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<code>Tree</code> 实例的渲染处理器。\r\n\t*/\r\n\t__getset(0,__proto,'renderHandler',function(){\r\n\t\treturn this._renderHandler;\r\n\t\t},function(value){\r\n\t\tthis._renderHandler=value;\r\n\t});\r\n\r\n\t/**\r\n\t*表示当前选择的项索引。\r\n\t*/\r\n\t__getset(0,__proto,'selectedIndex',function(){\r\n\t\treturn this._list.selectedIndex;\r\n\t\t},function(value){\r\n\t\tthis._list.selectedIndex=value;\r\n\t});\r\n\r\n\t/**\r\n\t*左侧缩进距离（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'spaceLeft',function(){\r\n\t\treturn this._spaceLeft;\r\n\t\t},function(value){\r\n\t\tthis._spaceLeft=value;\r\n\t});\r\n\r\n\t/**\r\n\t*当前选中的项对象的数据源。\r\n\t*/\r\n\t__getset(0,__proto,'selectedItem',function(){\r\n\t\treturn this._list.selectedItem;\r\n\t\t},function(value){\r\n\t\tthis._list.selectedItem=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Box,this,'width',value);\r\n\t\tthis._list.width=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Box,this,'height',value);\r\n\t\tthis._list.height=value;\r\n\t});\r\n\r\n\t/**\r\n\t*xml结构的数据源。\r\n\t*/\r\n\t__getset(0,__proto,'xml',null,function(value){\r\n\t\tvar arr=[];\r\n\t\tthis.parseXml(value.childNodes[0],arr,null,true);\r\n\t\tthis.array=arr;\r\n\t});\r\n\r\n\t/**\r\n\t*表示选择的树节点项的<code>path</code>属性值。\r\n\t*/\r\n\t__getset(0,__proto,'selectedPath',function(){\r\n\t\tif (this._list.selectedItem){\r\n\t\t\treturn this._list.selectedItem.path;\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\treturn Tree;\r\n})(Box)\r\n\r\n\r\n/**\r\n*<code>ViewStack</code> 类用于视图堆栈类，用于视图的显示等设置处理。\r\n*/\r\n//class laya.ui.ViewStack extends laya.ui.Box\r\nvar ViewStack=(function(_super){\r\n\tfunction ViewStack(){\r\n\t\t/**@private */\r\n\t\tthis._items=null;\r\n\t\t/**@private */\r\n\t\tthis._selectedIndex=0;\r\n\t\tViewStack.__super.call(this);\r\n\t\tthis._setIndexHandler=Handler.create(this,this.setIndex,null,false);\r\n\t}\r\n\r\n\t__class(ViewStack,'laya.ui.ViewStack',_super);\r\n\tvar __proto=ViewStack.prototype;\r\n\tLaya.imps(__proto,{\"laya.ui.IItem\":true})\r\n\t/**\r\n\t*批量设置视图对象。\r\n\t*@param views 视图对象数组。\r\n\t*/\r\n\t__proto.setItems=function(views){\r\n\t\tthis.removeChildren();\r\n\t\tvar index=0;\r\n\t\tfor (var i=0,n=views.length;i < n;i++){\r\n\t\t\tvar item=views[i];\r\n\t\t\tif (item){\r\n\t\t\t\titem.name=\"item\"+index;\r\n\t\t\t\tthis.addChild(item);\r\n\t\t\t\tindex++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.initItems();\r\n\t}\r\n\r\n\t/**\r\n\t*添加视图。\r\n\t*@internal 添加视图对象，并设置此视图对象的<code>name</code> 属性。\r\n\t*@param view 需要添加的视图对象。\r\n\t*/\r\n\t__proto.addItem=function(view){\r\n\t\tview.name=\"item\"+this._items.length;\r\n\t\tthis.addChild(view);\r\n\t\tthis.initItems();\r\n\t}\r\n\r\n\t/**\r\n\t*初始化视图对象集合。\r\n\t*/\r\n\t__proto.initItems=function(){\r\n\t\tthis._items=[];\r\n\t\tfor (var i=0;i < 10000;i++){\r\n\t\t\tvar item=this.getChildByName(\"item\"+i);\r\n\t\t\tif (item==null){\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tthis._items.push(item);\r\n\t\t\titem.visible=(i==this._selectedIndex);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*通过对象的索引设置项对象的 <code>selected</code> 属性值。\r\n\t*@param index 需要设置的对象的索引。\r\n\t*@param selected 表示对象的选中状态。\r\n\t*/\r\n\t__proto.setSelect=function(index,selected){\r\n\t\tif (this._items && index >-1 && index < this._items.length){\r\n\t\t\tthis._items[index].visible=selected;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置属性<code>selectedIndex</code>的值。\r\n\t*@param index 选中项索引值。\r\n\t*/\r\n\t__proto.setIndex=function(index){\r\n\t\tthis.selectedIndex=index;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){\r\n\t\tthis._dataSource=value;\r\n\t\tif (((typeof value=='number')&& Math.floor(value)==value)|| (typeof value=='string')){\r\n\t\t\tthis.selectedIndex=parseInt(value);\r\n\t\t\t}else {\r\n\t\t\tfor (var prop in this._dataSource){\r\n\t\t\t\tif (this.hasOwnProperty(prop)){\r\n\t\t\t\t\tthis[prop]=this._dataSource[prop];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示当前视图索引。\r\n\t*/\r\n\t__getset(0,__proto,'selectedIndex',function(){\r\n\t\treturn this._selectedIndex;\r\n\t\t},function(value){\r\n\t\tif (this._selectedIndex !=value){\r\n\t\t\tthis.setSelect(this._selectedIndex,false);\r\n\t\t\tthis._selectedIndex=value;\r\n\t\t\tthis.setSelect(this._selectedIndex,true);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取或设置当前选择的项对象。\r\n\t*/\r\n\t__getset(0,__proto,'selection',function(){\r\n\t\treturn this._selectedIndex >-1 && this._selectedIndex < this._items.length ? this._items[this._selectedIndex] :null;\r\n\t\t},function(value){\r\n\t\tthis.selectedIndex=this._items.indexOf(value);\r\n\t});\r\n\r\n\t/**\r\n\t*视图集合数组。\r\n\t*/\r\n\t__getset(0,__proto,'items',function(){\r\n\t\treturn this._items;\r\n\t});\r\n\r\n\t/**\r\n\t*索引设置处理器。\r\n\t*<p>默认回调参数：index:int</p>\r\n\t*/\r\n\t__getset(0,__proto,'setIndexHandler',function(){\r\n\t\treturn this._setIndexHandler;\r\n\t\t},function(value){\r\n\t\tthis._setIndexHandler=value;\r\n\t});\r\n\r\n\treturn ViewStack;\r\n})(Box)\r\n\r\n\r\n/**\r\n*\r\n*使用 <code>VScrollBar</code> （垂直 <code>ScrollBar</code> ）控件，可以在因数据太多而不能在显示区域完全显示时控制显示的数据部分。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>VScrollBar</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.vScrollBar;\r\n\t*import laya.ui.VScrollBar;\r\n\t*import laya.utils.Handler;\r\n\t*public class VScrollBar_Example\r\n\t*{\r\n\t\t*private var vScrollBar:VScrollBar;\r\n\t\t*public function VScrollBar_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"],Handler.create(this,onLoadComplete));\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*vScrollBar=new VScrollBar();//创建一个 vScrollBar 类的实例对象 hScrollBar 。\r\n\t\t\t*vScrollBar.skin=\"resource/ui/vscroll.png\";//设置 vScrollBar 的皮肤。\r\n\t\t\t*vScrollBar.x=100;//设置 vScrollBar 对象的属性 x 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t\t\t*vScrollBar.y=100;//设置 vScrollBar 对象的属性 y 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t\t\t*vScrollBar.changeHandler=new Handler(this,onChange);//设置 vScrollBar 的滚动变化处理器。\r\n\t\t\t*Laya.stage.addChild(vScrollBar);//将此 vScrollBar 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onChange(value:Number):void\r\n\t\t*{\r\n\t\t\t*trace(\"滚动条的位置： value=\"+value);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var vScrollBar;\r\n*var res=[\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"];\r\n*Laya.loader.load(res,laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*vScrollBar=new laya.ui.VScrollBar();//创建一个 vScrollBar 类的实例对象 hScrollBar 。\r\n\t*vScrollBar.skin=\"resource/ui/vscroll.png\";//设置 vScrollBar 的皮肤。\r\n\t*vScrollBar.x=100;//设置 vScrollBar 对象的属性 x 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t*vScrollBar.y=100;//设置 vScrollBar 对象的属性 y 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t*vScrollBar.changeHandler=new laya.utils.Handler(this,onChange);//设置 vScrollBar 的滚动变化处理器。\r\n\t*Laya.stage.addChild(vScrollBar);//将此 vScrollBar 对象添加到显示列表。\r\n\t*}\r\n*function onChange(value){\r\n\t*console.log(\"滚动条的位置： value=\"+value);\r\n\t*}\r\n*@example\r\n*import VScrollBar=laya.ui.VScrollBar;\r\n*import Handler=laya.utils.Handler;\r\n*class VScrollBar_Example {\r\n\t*private vScrollBar:VScrollBar;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/vscroll.png\",\"resource/ui/vscroll$bar.png\",\"resource/ui/vscroll$down.png\",\"resource/ui/vscroll$up.png\"],Handler.create(this,this.onLoadComplete));\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.vScrollBar=new VScrollBar();//创建一个 vScrollBar 类的实例对象 hScrollBar 。\r\n\t\t*this.vScrollBar.skin=\"resource/ui/vscroll.png\";//设置 vScrollBar 的皮肤。\r\n\t\t*this.vScrollBar.x=100;//设置 vScrollBar 对象的属性 x 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t\t*this.vScrollBar.y=100;//设置 vScrollBar 对象的属性 y 的值，用于控制 vScrollBar 对象的显示位置。\r\n\t\t*this.vScrollBar.changeHandler=new Handler(this,this.onChange);//设置 vScrollBar 的滚动变化处理器。\r\n\t\t*Laya.stage.addChild(this.vScrollBar);//将此 vScrollBar 对象添加到显示列表。\r\n\t\t*}\r\n\t*private onChange(value:number):void {\r\n\t\t*console.log(\"滚动条的位置： value=\"+value);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.VScrollBar extends laya.ui.ScrollBar\r\nvar VScrollBar=(function(_super){\r\n\tfunction VScrollBar(){\r\n\t\tVScrollBar.__super.call(this);;\r\n\t}\r\n\r\n\t__class(VScrollBar,'laya.ui.VScrollBar',_super);\r\n\treturn VScrollBar;\r\n})(ScrollBar)\r\n\r\n\r\n/**\r\n*<code>TextInput</code> 类用于创建显示对象以显示和输入文本。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>TextInput</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.display.Stage;\r\n\t*import laya.ui.TextInput;\r\n\t*import laya.utils.Handler;\r\n\t*public class TextInput_Example\r\n\t*{\r\n\t\t*public function TextInput_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/input.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var textInput:TextInput=new TextInput(\"这是一个TextInput实例。\");//创建一个 TextInput 类的实例对象 textInput 。\r\n\t\t\t*textInput.skin=\"resource/ui/input.png\";//设置 textInput 的皮肤。\r\n\t\t\t*textInput.sizeGrid=\"4,4,4,4\";//设置 textInput 的网格信息。\r\n\t\t\t*textInput.color=\"#008fff\";//设置 textInput 的文本颜色。\r\n\t\t\t*textInput.font=\"Arial\";//设置 textInput 的文本字体。\r\n\t\t\t*textInput.bold=true;//设置 textInput 的文本显示为粗体。\r\n\t\t\t*textInput.fontSize=30;//设置 textInput 的字体大小。\r\n\t\t\t*textInput.wordWrap=true;//设置 textInput 的文本自动换行。\r\n\t\t\t*textInput.x=100;//设置 textInput 对象的属性 x 的值，用于控制 textInput 对象的显示位置。\r\n\t\t\t*textInput.y=100;//设置 textInput 对象的属性 y 的值，用于控制 textInput 对象的显示位置。\r\n\t\t\t*textInput.width=300;//设置 textInput 的宽度。\r\n\t\t\t*textInput.height=200;//设置 textInput 的高度。\r\n\t\t\t*Laya.stage.addChild(textInput);//将 textInput 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load([\"resource/ui/input.png\"],laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*var textInput=new laya.ui.TextInput(\"这是一个TextInput实例。\");//创建一个 TextInput 类的实例对象 textInput 。\r\n\t*textInput.skin=\"resource/ui/input.png\";//设置 textInput 的皮肤。\r\n\t*textInput.sizeGrid=\"4,4,4,4\";//设置 textInput 的网格信息。\r\n\t*textInput.color=\"#008fff\";//设置 textInput 的文本颜色。\r\n\t*textInput.font=\"Arial\";//设置 textInput 的文本字体。\r\n\t*textInput.bold=true;//设置 textInput 的文本显示为粗体。\r\n\t*textInput.fontSize=30;//设置 textInput 的字体大小。\r\n\t*textInput.wordWrap=true;//设置 textInput 的文本自动换行。\r\n\t*textInput.x=100;//设置 textInput 对象的属性 x 的值，用于控制 textInput 对象的显示位置。\r\n\t*textInput.y=100;//设置 textInput 对象的属性 y 的值，用于控制 textInput 对象的显示位置。\r\n\t*textInput.width=300;//设置 textInput 的宽度。\r\n\t*textInput.height=200;//设置 textInput 的高度。\r\n\t*Laya.stage.addChild(textInput);//将 textInput 添加到显示列表。\r\n\t*}\r\n*@example\r\n*import Stage=laya.display.Stage;\r\n*import TextInput=laya.ui.TextInput;\r\n*import Handler=laya.utils.Handler;\r\n*class TextInput_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/input.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var textInput:TextInput=new TextInput(\"这是一个TextInput实例。\");//创建一个 TextInput 类的实例对象 textInput 。\r\n\t\t*textInput.skin=\"resource/ui/input.png\";//设置 textInput 的皮肤。\r\n\t\t*textInput.sizeGrid=\"4,4,4,4\";//设置 textInput 的网格信息。\r\n\t\t*textInput.color=\"#008fff\";//设置 textInput 的文本颜色。\r\n\t\t*textInput.font=\"Arial\";//设置 textInput 的文本字体。\r\n\t\t*textInput.bold=true;//设置 textInput 的文本显示为粗体。\r\n\t\t*textInput.fontSize=30;//设置 textInput 的字体大小。\r\n\t\t*textInput.wordWrap=true;//设置 textInput 的文本自动换行。\r\n\t\t*textInput.x=100;//设置 textInput 对象的属性 x 的值，用于控制 textInput 对象的显示位置。\r\n\t\t*textInput.y=100;//设置 textInput 对象的属性 y 的值，用于控制 textInput 对象的显示位置。\r\n\t\t*textInput.width=300;//设置 textInput 的宽度。\r\n\t\t*textInput.height=200;//设置 textInput 的高度。\r\n\t\t*Laya.stage.addChild(textInput);//将 textInput 添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.TextInput extends laya.ui.Label\r\nvar TextInput=(function(_super){\r\n\tfunction TextInput(text){\r\n\t\t/**@private */\r\n\t\tthis._bg=null;\r\n\t\t/**@private */\r\n\t\tthis._skin=null;\r\n\t\tTextInput.__super.call(this);\r\n\t\t(text===void 0)&& (text=\"\");\r\n\t\tthis.text=text;\r\n\t\tthis.skin=this.skin;\r\n\t}\r\n\r\n\t__class(TextInput,'laya.ui.TextInput',_super);\r\n\tvar __proto=TextInput.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.preinitialize=function(){\r\n\t\tthis.mouseEnabled=true;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._bg && this._bg.destroy();\r\n\t\tthis._bg=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.createChildren=function(){\r\n\t\tthis.addChild(this._tf=new Input());\r\n\t\tthis._tf.padding=Styles.inputLabelPadding;\r\n\t\tthis._tf.on(/*laya.events.Event.INPUT*/\"input\",this,this._onInput);\r\n\t\tthis._tf.on(/*laya.events.Event.ENTER*/\"enter\",this,this._onEnter);\r\n\t\tthis._tf.on(/*laya.events.Event.BLUR*/\"blur\",this,this._onBlur);\r\n\t\tthis._tf.on(/*laya.events.Event.FOCUS*/\"focus\",this,this._onFocus);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onFocus=function(){\r\n\t\tthis.event(/*laya.events.Event.FOCUS*/\"focus\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onBlur=function(){\r\n\t\tthis.event(/*laya.events.Event.BLUR*/\"blur\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onInput=function(){\r\n\t\tthis.event(/*laya.events.Event.INPUT*/\"input\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._onEnter=function(){\r\n\t\tthis.event(/*laya.events.Event.ENTER*/\"enter\",this);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tthis.width=128;\r\n\t\tthis.height=22;\r\n\t}\r\n\r\n\t/**选中输入框内的文本。*/\r\n\t__proto.select=function(){\r\n\t\t(this._tf).select();\r\n\t}\r\n\r\n\t__proto.setSelection=function(startIndex,endIndex){\r\n\t\t(this._tf).setSelection(startIndex,endIndex);\r\n\t}\r\n\r\n\t/**\r\n\t*当前文本内容字符串。\r\n\t*@see laya.display.Text.text\r\n\t*/\r\n\t__getset(0,__proto,'text',_super.prototype._$get_text,function(value){\r\n\t\tif (this._tf.text !=value){\r\n\t\t\tvalue=value+\"\";\r\n\t\t\tthis._tf.text=value;\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示此对象包含的文本背景 <code>AutoBitmap</code> 组件实例。\r\n\t*/\r\n\t__getset(0,__proto,'bg',function(){\r\n\t\treturn this._bg;\r\n\t\t},function(value){\r\n\t\tthis.graphics=this._bg=value;\r\n\t});\r\n\r\n\t/**\r\n\t*设置原生input输入框的y坐标偏移。\r\n\t*/\r\n\t__getset(0,__proto,'inputElementYAdjuster',function(){\r\n\t\treturn (this._tf).inputElementYAdjuster;\r\n\t\t},function(value){\r\n\t\t(this._tf).inputElementYAdjuster=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指示当前是否是文本域。</p>\r\n\t*值为true表示当前是文本域，否则不是文本域。\r\n\t*/\r\n\t__getset(0,__proto,'multiline',function(){\r\n\t\treturn (this._tf).multiline;\r\n\t\t},function(value){\r\n\t\t(this._tf).multiline=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.ui.Image#skin\r\n\t*/\r\n\t__getset(0,__proto,'skin',function(){\r\n\t\treturn this._skin;\r\n\t\t},function(value){\r\n\t\tif (this._skin !=value){\r\n\t\t\tthis._skin=value;\r\n\t\t\tthis._bg || (this.graphics=this._bg=new AutoBitmap());\r\n\t\t\tthis._bg.source=Loader.getRes(this._skin);\r\n\t\t\tthis._width && (this._bg.width=this._width);\r\n\t\t\tthis._height && (this._bg.height=this._height);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>当前实例的背景图（ <code>AutoBitmap</code> ）实例的有效缩放网格数据。</p>\r\n\t*<p>数据格式：\"上边距,右边距,下边距,左边距,是否重复填充(值为0：不重复填充，1：重复填充)\"，以逗号分隔。\r\n\t*<ul><li>例如：\"4,4,4,4,1\"</li></ul></p>\r\n\t*@see laya.ui.AutoBitmap.sizeGrid\r\n\t*/\r\n\t__getset(0,__proto,'sizeGrid',function(){\r\n\t\treturn this._bg && this._bg.sizeGrid ? this._bg.sizeGrid.join(\",\"):null;\r\n\t\t},function(value){\r\n\t\tthis._bg || (this.graphics=this._bg=new AutoBitmap());\r\n\t\tthis._bg.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);\r\n\t});\r\n\r\n\t/**\r\n\t*设置原生input输入框的x坐标偏移。\r\n\t*/\r\n\t__getset(0,__proto,'inputElementXAdjuster',function(){\r\n\t\treturn (this._tf).inputElementXAdjuster;\r\n\t\t},function(value){\r\n\t\t(this._tf).inputElementXAdjuster=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(Label,this,'width',value);\r\n\t\tthis._bg && (this._bg.width=value);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(Label,this,'height',value);\r\n\t\tthis._bg && (this._bg.height=value);\r\n\t});\r\n\r\n\t/**\r\n\t*设置可编辑状态。\r\n\t*/\r\n\t__getset(0,__proto,'editable',function(){\r\n\t\treturn (this._tf).editable;\r\n\t\t},function(value){\r\n\t\t(this._tf).editable=value;\r\n\t});\r\n\r\n\t/**限制输入的字符。*/\r\n\t__getset(0,__proto,'restrict',function(){\r\n\t\treturn (this._tf).restrict;\r\n\t\t},function(pattern){\r\n\t\t(this._tf).restrict=pattern;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#prompt\r\n\t*/\r\n\t__getset(0,__proto,'prompt',function(){\r\n\t\treturn (this._tf).prompt;\r\n\t\t},function(value){\r\n\t\t(this._tf).prompt=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#promptColor\r\n\t*/\r\n\t__getset(0,__proto,'promptColor',function(){\r\n\t\treturn (this._tf).promptColor;\r\n\t\t},function(value){\r\n\t\t(this._tf).promptColor=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#maxChars\r\n\t*/\r\n\t__getset(0,__proto,'maxChars',function(){\r\n\t\treturn (this._tf).maxChars;\r\n\t\t},function(value){\r\n\t\t(this._tf).maxChars=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#focus\r\n\t*/\r\n\t__getset(0,__proto,'focus',function(){\r\n\t\treturn (this._tf).focus;\r\n\t\t},function(value){\r\n\t\t(this._tf).focus=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#type\r\n\t*/\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn (this._tf).type;\r\n\t\t},function(value){\r\n\t\t(this._tf).type=value;\r\n\t});\r\n\r\n\t/**\r\n\t*@copy laya.display.Input#asPassword\r\n\t*/\r\n\t__getset(0,__proto,'asPassword',function(){\r\n\t\treturn (this._tf).asPassword;\r\n\t\t},function(value){\r\n\t\t(this._tf).asPassword=value;\r\n\t});\r\n\r\n\treturn TextInput;\r\n})(Label)\r\n\r\n\r\n/**\r\n*使用 <code>VSlider</code> 控件，用户可以通过在滑块轨道的终点之间移动滑块来选择值。\r\n*<p> <code>VSlider</code> 控件采用垂直方向。滑块轨道从下往上扩展，而标签位于轨道的左右两侧。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>VSlider</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.HSlider;\r\n\t*import laya.ui.VSlider;\r\n\t*import laya.utils.Handler;\r\n\t*public class VSlider_Example\r\n\t*{\r\n\t\t*private var vSlider:VSlider;\r\n\t\t*public function VSlider_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/vslider.png\",\"resource/ui/vslider$bar.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*vSlider=new VSlider();//创建一个 VSlider 类的实例对象 vSlider 。\r\n\t\t\t*vSlider.skin=\"resource/ui/vslider.png\";//设置 vSlider 的皮肤。\r\n\t\t\t*vSlider.min=0;//设置 vSlider 最低位置值。\r\n\t\t\t*vSlider.max=10;//设置 vSlider 最高位置值。\r\n\t\t\t*vSlider.value=2;//设置 vSlider 当前位置值。\r\n\t\t\t*vSlider.tick=1;//设置 vSlider 刻度值。\r\n\t\t\t*vSlider.x=100;//设置 vSlider 对象的属性 x 的值，用于控制 vSlider 对象的显示位置。\r\n\t\t\t*vSlider.y=100;//设置 vSlider 对象的属性 y 的值，用于控制 vSlider 对象的显示位置。\r\n\t\t\t*vSlider.changeHandler=new Handler(this,onChange);//设置 vSlider 位置变化处理器。\r\n\t\t\t*Laya.stage.addChild(vSlider);//把 vSlider 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onChange(value:Number):void\r\n\t\t*{\r\n\t\t\t*trace(\"滑块的位置： value=\"+value);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var vSlider;\r\n*Laya.loader.load([\"resource/ui/vslider.png\",\"resource/ui/vslider$bar.png\"],laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*vSlider=new laya.ui.VSlider();//创建一个 VSlider 类的实例对象 vSlider 。\r\n\t*vSlider.skin=\"resource/ui/vslider.png\";//设置 vSlider 的皮肤。\r\n\t*vSlider.min=0;//设置 vSlider 最低位置值。\r\n\t*vSlider.max=10;//设置 vSlider 最高位置值。\r\n\t*vSlider.value=2;//设置 vSlider 当前位置值。\r\n\t*vSlider.tick=1;//设置 vSlider 刻度值。\r\n\t*vSlider.x=100;//设置 vSlider 对象的属性 x 的值，用于控制 vSlider 对象的显示位置。\r\n\t*vSlider.y=100;//设置 vSlider 对象的属性 y 的值，用于控制 vSlider 对象的显示位置。\r\n\t*vSlider.changeHandler=new laya.utils.Handler(this,onChange);//设置 vSlider 位置变化处理器。\r\n\t*Laya.stage.addChild(vSlider);//把 vSlider 添加到显示列表。\r\n\t*}\r\n*function onChange(value){\r\n\t*console.log(\"滑块的位置： value=\"+value);\r\n\t*}\r\n*@example\r\n*import HSlider=laya.ui.HSlider;\r\n*import VSlider=laya.ui.VSlider;\r\n*import Handler=laya.utils.Handler;\r\n*class VSlider_Example {\r\n\t*private vSlider:VSlider;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/vslider.png\",\"resource/ui/vslider$bar.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.vSlider=new VSlider();//创建一个 VSlider 类的实例对象 vSlider 。\r\n\t\t*this.vSlider.skin=\"resource/ui/vslider.png\";//设置 vSlider 的皮肤。\r\n\t\t*this.vSlider.min=0;//设置 vSlider 最低位置值。\r\n\t\t*this.vSlider.max=10;//设置 vSlider 最高位置值。\r\n\t\t*this.vSlider.value=2;//设置 vSlider 当前位置值。\r\n\t\t*this.vSlider.tick=1;//设置 vSlider 刻度值。\r\n\t\t*this.vSlider.x=100;//设置 vSlider 对象的属性 x 的值，用于控制 vSlider 对象的显示位置。\r\n\t\t*this.vSlider.y=100;//设置 vSlider 对象的属性 y 的值，用于控制 vSlider 对象的显示位置。\r\n\t\t*this.vSlider.changeHandler=new Handler(this,this.onChange);//设置 vSlider 位置变化处理器。\r\n\t\t*Laya.stage.addChild(this.vSlider);//把 vSlider 添加到显示列表。\r\n\t\t*}\r\n\t*private onChange(value:number):void {\r\n\t\t*console.log(\"滑块的位置： value=\"+value);\r\n\t\t*}\r\n\t*}\r\n*@see laya.ui.Slider\r\n*/\r\n//class laya.ui.VSlider extends laya.ui.Slider\r\nvar VSlider=(function(_super){\r\n\tfunction VSlider(){\r\n\t\tVSlider.__super.call(this);;\r\n\t}\r\n\r\n\t__class(VSlider,'laya.ui.VSlider',_super);\r\n\treturn VSlider;\r\n})(Slider)\r\n\r\n\r\n/**\r\n*<code>Dialog</code> 组件是一个弹出对话框，实现对话框弹出，拖动，模式窗口功能。\r\n*可以通过UIConfig设置弹出框背景透明度，模式窗口点击边缘是否关闭等\r\n*通过设置zOrder属性，可以更改弹出的层次\r\n*通过设置popupEffect和closeEffect可以设置弹出效果和关闭效果，如果不想有任何弹出关闭效果，可以设置前述属性为空\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>Dialog</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Dialog;\r\n\t*import laya.utils.Handler;\r\n\t*public class Dialog_Example\r\n\t*{\r\n\t\t*private var dialog:Dialog_Instance;\r\n\t\t*public function Dialog_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load(\"resource/ui/btn_close.png\",Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*dialog=new Dialog_Instance();//创建一个 Dialog_Instance 类的实例对象 dialog。\r\n\t\t\t*dialog.dragArea=\"0,0,150,50\";//设置 dialog 的拖拽区域。\r\n\t\t\t*dialog.show();//显示 dialog。\r\n\t\t\t*dialog.closeHandler=new Handler(this,onClose);//设置 dialog 的关闭函数处理器。\r\n\t\t\t*}\r\n\t\t*private function onClose(name:String):void\r\n\t\t*{\r\n\t\t\t*if (name==Dialog.CLOSE)\r\n\t\t\t*{\r\n\t\t\t\t*trace(\"通过点击 name 为\"+name+\"的组件，关闭了dialog。\");\r\n\t\t\t\t*}\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*import laya.ui.Button;\r\n*import laya.ui.Dialog;\r\n*import laya.ui.Image;\r\n*class Dialog_Instance extends Dialog\r\n*{\r\n\t*function Dialog_Instance():void\r\n\t*{\r\n\t\t*var bg:Image=new Image(\"resource/ui/bg.png\");\r\n\t\t*bg.sizeGrid=\"40,10,5,10\";\r\n\t\t*bg.width=150;\r\n\t\t*bg.height=250;\r\n\t\t*addChild(bg);\r\n\t\t*var image:Image=new Image(\"resource/ui/image.png\");\r\n\t\t*addChild(image);\r\n\t\t*var button:Button=new Button(\"resource/ui/btn_close.png\");\r\n\t\t*button.name=Dialog.CLOSE;//设置button的name属性值。\r\n\t\t*button.x=0;\r\n\t\t*button.y=0;\r\n\t\t*addChild(button);\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*var dialog;\r\n*Laya.loader.load(\"resource/ui/btn_close.png\",laya.utils.Handler.create(this,loadComplete));//加载资源\r\n*(function (_super){//新建一个类Dialog_Instance继承自laya.ui.Dialog。\r\n\t*function Dialog_Instance(){\r\n\t\t*Dialog_Instance.__super.call(this);//初始化父类\r\n\t\t*var bg=new laya.ui.Image(\"resource/ui/bg.png\");//新建一个 Image 类的实例 bg 。\r\n\t\t*bg.sizeGrid=\"10,40,10,5\";//设置 bg 的网格信息。\r\n\t\t*bg.width=150;//设置 bg 的宽度。\r\n\t\t*bg.height=250;//设置 bg 的高度。\r\n\t\t*this.addChild(bg);//将 bg 添加到显示列表。\r\n\t\t*var image=new laya.ui.Image(\"resource/ui/image.png\");//新建一个 Image 类的实例 image 。\r\n\t\t*this.addChild(image);//将 image 添加到显示列表。\r\n\t\t*var button=new laya.ui.Button(\"resource/ui/btn_close.png\");//新建一个 Button 类的实例 bg 。\r\n\t\t*button.name=laya.ui.Dialog.CLOSE;//设置 button 的 name 属性值。\r\n\t\t*button.x=0;//设置 button 对象的属性 x 的值，用于控制 button 对象的显示位置。\r\n\t\t*button.y=0;//设置 button 对象的属性 y 的值，用于控制 button 对象的显示位置。\r\n\t\t*this.addChild(button);//将 button 添加到显示列表。\r\n\t\t*};\r\n\t*Laya.class(Dialog_Instance,\"mypackage.dialogExample.Dialog_Instance\",_super);//注册类Dialog_Instance。\r\n\t*})(laya.ui.Dialog);\r\n*function loadComplete(){\r\n\t*console.log(\"资源加载完成！\");\r\n\t*dialog=new mypackage.dialogExample.Dialog_Instance();//创建一个 Dialog_Instance 类的实例对象 dialog。\r\n\t*dialog.dragArea=\"0,0,150,50\";//设置 dialog 的拖拽区域。\r\n\t*dialog.show();//显示 dialog。\r\n\t*dialog.closeHandler=new laya.utils.Handler(this,onClose);//设置 dialog 的关闭函数处理器。\r\n\t*}\r\n*function onClose(name){\r\n\t*if (name==laya.ui.Dialog.CLOSE){\r\n\t\t*console.log(\"通过点击 name 为\"+name+\"的组件，关闭了dialog。\");\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*import Dialog=laya.ui.Dialog;\r\n*import Handler=laya.utils.Handler;\r\n*class Dialog_Example {\r\n\t*private dialog:Dialog_Instance;\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load(\"resource/ui/btn_close.png\",Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*this.dialog=new Dialog_Instance();//创建一个 Dialog_Instance 类的实例对象 dialog。\r\n\t\t*this.dialog.dragArea=\"0,0,150,50\";//设置 dialog 的拖拽区域。\r\n\t\t*this.dialog.show();//显示 dialog。\r\n\t\t*this.dialog.closeHandler=new Handler(this,this.onClose);//设置 dialog 的关闭函数处理器。\r\n\t\t*}\r\n\t*private onClose(name:string):void {\r\n\t\t*if (name==Dialog.CLOSE){\r\n\t\t\t*console.log(\"通过点击 name 为\"+name+\"的组件，关闭了dialog。\");\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*import Button=laya.ui.Button;\r\n*class Dialog_Instance extends Dialog {\r\n\t*Dialog_Instance():void {\r\n\t\t*var bg:laya.ui.Image=new laya.ui.Image(\"resource/ui/bg.png\");\r\n\t\t*bg.sizeGrid=\"40,10,5,10\";\r\n\t\t*bg.width=150;\r\n\t\t*bg.height=250;\r\n\t\t*this.addChild(bg);\r\n\t\t*var image:laya.ui.Image=new laya.ui.Image(\"resource/ui/image.png\");\r\n\t\t*this.addChild(image);\r\n\t\t*var button:Button=new Button(\"resource/ui/btn_close.png\");\r\n\t\t*button.name=Dialog.CLOSE;//设置button的name属性值。\r\n\t\t*button.x=0;\r\n\t\t*button.y=0;\r\n\t\t*this.addChild(button);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.Dialog extends laya.ui.View\r\nvar Dialog=(function(_super){\r\n\tfunction Dialog(){\r\n\t\t/**\r\n\t\t*一个布尔值，指定对话框是否居中弹。\r\n\t\t*<p>如果值为true，则居中弹出，否则，则根据对象坐标显示，默认为true。</p>\r\n\t\t*/\r\n\t\tthis.popupCenter=true;\r\n\t\t/**\r\n\t\t*对话框被关闭时会触发的回调函数处理器。\r\n\t\t*<p>回调函数参数为用户点击的按钮名字name:String。</p>\r\n\t\t*/\r\n\t\tthis.closeHandler=null;\r\n\t\t/**\r\n\t\t*弹出对话框效果，可以设置一个效果代替默认的弹出效果，如果不想有任何效果，可以赋值为null\r\n\t\t*全局默认弹出效果可以通过manager.popupEffect修改\r\n\t\t*/\r\n\t\tthis.popupEffect=null;\r\n\t\t/**\r\n\t\t*关闭对话框效果，可以设置一个效果代替默认的关闭效果，如果不想有任何效果，可以赋值为null\r\n\t\t*全局默认关闭效果可以通过manager.closeEffect修改\r\n\t\t*/\r\n\t\tthis.closeEffect=null;\r\n\t\t/**组名称*/\r\n\t\tthis.group=null;\r\n\t\t/**是否是模式窗口*/\r\n\t\tthis.isModal=false;\r\n\t\t/**@private */\r\n\t\tthis._dragArea=null;\r\n\t\tDialog.__super.call(this);\r\n\t}\r\n\r\n\t__class(Dialog,'laya.ui.Dialog',_super);\r\n\tvar __proto=Dialog.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.initialize=function(){\r\n\t\tthis.popupEffect=Dialog.manager.popupEffectHandler;\r\n\t\tthis.closeEffect=Dialog.manager.closeEffectHandler;\r\n\t\tthis._dealDragArea();\r\n\t\tthis.on(/*laya.events.Event.CLICK*/\"click\",this,this._onClick);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._dealDragArea=function(){\r\n\t\tvar dragTarget=this.getChildByName(\"drag\");\r\n\t\tif (dragTarget){\r\n\t\t\tthis.dragArea=dragTarget.x+\",\"+dragTarget.y+\",\"+dragTarget.width+\",\"+dragTarget.height;\r\n\t\t\tdragTarget.removeSelf();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private (protected)\r\n\t*对象的 <code>Event.CLICK</code> 点击事件侦听处理函数。\r\n\t*/\r\n\t__proto._onClick=function(e){\r\n\t\tvar btn=e.target;\r\n\t\tif (btn){\r\n\t\t\tswitch (btn.name){\r\n\t\t\t\tcase \"close\":\r\n\t\t\t\tcase \"cancel\":\r\n\t\t\t\tcase \"sure\":\r\n\t\t\t\tcase \"no\":\r\n\t\t\t\tcase \"ok\":\r\n\t\t\t\tcase \"yes\":\r\n\t\t\t\t\tthis.close(btn.name);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*显示对话框（以非模式窗口方式显示）。\r\n\t*@param closeOther 是否关闭其它的对话框。若值为true则关闭其它对话框。\r\n\t*@param showEffect 是否显示弹出效果\r\n\t*/\r\n\t__proto.show=function(closeOther,showEffect){\r\n\t\t(closeOther===void 0)&& (closeOther=false);\r\n\t\t(showEffect===void 0)&& (showEffect=true);\r\n\t\tthis._open(false,closeOther,showEffect);\r\n\t}\r\n\r\n\t/**\r\n\t*显示对话框（以模式窗口方式显示）。\r\n\t*@param closeOther 是否关闭其它的对话框。若值为true则关闭其它对话框。\r\n\t*@param showEffect 是否显示弹出效果\r\n\t*/\r\n\t__proto.popup=function(closeOther,showEffect){\r\n\t\t(closeOther===void 0)&& (closeOther=false);\r\n\t\t(showEffect===void 0)&& (showEffect=true);\r\n\t\tthis._open(true,closeOther,showEffect);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._open=function(modal,closeOther,showEffect){\r\n\t\tDialog.manager.lock(false);\r\n\t\tthis.isModal=modal;\r\n\t\tDialog.manager.open(this,closeOther,showEffect);\r\n\t}\r\n\r\n\t/**打开完成后，调用此方法（如果有弹出动画，则在动画完成后执行）*/\r\n\t__proto.onOpened=function(){}\r\n\t/**\r\n\t*关闭对话框。\r\n\t*@param type 如果是点击默认关闭按钮触发，则传入关闭按钮的名字(name)，否则为null。\r\n\t*@param showEffect 是否显示关闭效果\r\n\t*/\r\n\t__proto.close=function(type,showEffect){\r\n\t\t(showEffect===void 0)&& (showEffect=true);\r\n\t\tDialog.manager.close(this,type,showEffect);\r\n\t}\r\n\r\n\t/**关闭完成后，调用此方法（如果有关闭动画，则在动画完成后执行）\r\n\t*@param type 如果是点击默认关闭按钮触发，则传入关闭按钮的名字(name)，否则为null。\r\n\t*/\r\n\t__proto.onClosed=function(type){}\r\n\t/**@private */\r\n\t__proto._onMouseDown=function(e){\r\n\t\tvar point=this.getMousePoint();\r\n\t\tif (this._dragArea.contains(point.x,point.y))this.startDrag();\r\n\t\telse this.stopDrag();\r\n\t}\r\n\r\n\t/**\r\n\t*用来指定对话框的拖拽区域。默认值为\"0,0,0,0\"。\r\n\t*<p><b>格式：</b>构成一个矩形所需的 x,y,width,heith 值，用逗号连接为字符串。\r\n\t*例如：\"0,0,100,200\"。\r\n\t*</p>\r\n\t*\r\n\t*@see #includeExamplesSummary 请参考示例\r\n\t*/\r\n\t__getset(0,__proto,'dragArea',function(){\r\n\t\tif (this._dragArea)return this._dragArea.toString();\r\n\t\treturn null;\r\n\t\t},function(value){\r\n\t\tif (value){\r\n\t\t\tvar a=UIUtils.fillArray([0,0,0,0],value,Number);\r\n\t\t\tthis._dragArea=new Rectangle(a[0],a[1],a[2],a[3]);\r\n\t\t\tthis.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onMouseDown);\r\n\t\t\t}else {\r\n\t\t\tthis._dragArea=null;\r\n\t\t\tthis.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onMouseDown);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*弹出框的显示状态；如果弹框处于显示中，则为true，否则为false;\r\n\t*/\r\n\t__getset(0,__proto,'isPopup',function(){\r\n\t\treturn this.parent !=null;\r\n\t});\r\n\r\n\t__getset(0,__proto,'zOrder',_super.prototype._$get_zOrder,function(value){\r\n\t\tLaya.superSet(View,this,'zOrder',value);\r\n\t\tDialog.manager._checkMask();\r\n\t});\r\n\r\n\t/**对话框管理容器，所有的对话框都在该容器内，并且受管理器管，可以自定义自己的管理器，来更改窗口管理的流程。\r\n\t*任意对话框打开和关闭，都会触发管理类的open和close事件*/\r\n\t__getset(1,Dialog,'manager',function(){\r\n\t\treturn Dialog._manager=Dialog._manager|| new DialogManager();\r\n\t\t},function(value){\r\n\t\tDialog._manager=value;\r\n\t});\r\n\r\n\tDialog.setLockView=function(view){\r\n\t\tDialog.manager.setLockView(view);\r\n\t}\r\n\r\n\tDialog.lock=function(value){\r\n\t\tDialog.manager.lock(value);\r\n\t}\r\n\r\n\tDialog.closeAll=function(){\r\n\t\tDialog.manager.closeAll();\r\n\t}\r\n\r\n\tDialog.getDialogsByGroup=function(group){\r\n\t\treturn Dialog.manager.getDialogsByGroup(group);\r\n\t}\r\n\r\n\tDialog.closeByGroup=function(group){\r\n\t\treturn Dialog.manager.closeByGroup(group);\r\n\t}\r\n\r\n\tDialog.CLOSE=\"close\";\r\n\tDialog.CANCEL=\"cancel\";\r\n\tDialog.SURE=\"sure\";\r\n\tDialog.NO=\"no\";\r\n\tDialog.OK=\"ok\";\r\n\tDialog.YES=\"yes\";\r\n\tDialog._manager=null;\r\n\treturn Dialog;\r\n})(View)\r\n\r\n\r\n/**\r\n*<code>HBox</code> 是一个水平布局容器类。\r\n*/\r\n//class laya.ui.HBox extends laya.ui.LayoutBox\r\nvar HBox=(function(_super){\r\n\tfunction HBox(){\r\n\t\tHBox.__super.call(this);;\r\n\t}\r\n\r\n\t__class(HBox,'laya.ui.HBox',_super);\r\n\tvar __proto=HBox.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.sortItem=function(items){\r\n\t\tif (items)items.sort(function(a,b){return a.x-b.x;});\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.changeItems=function(){\r\n\t\tthis._itemChanged=false;\r\n\t\tvar items=[];\r\n\t\tvar maxHeight=0;\r\n\t\tfor (var i=0,n=this.numChildren;i < n;i++){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item&&item.layoutEnabled){\r\n\t\t\t\titems.push(item);\r\n\t\t\t\tmaxHeight=this._height?this._height:Math.max(maxHeight,item.height *item.scaleY);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.sortItem(items);\r\n\t\tvar left=0;\r\n\t\tfor (i=0,n=items.length;i < n;i++){\r\n\t\t\titem=items[i];\r\n\t\t\titem.x=left;\r\n\t\t\tleft+=item.width *item.scaleX+this._space;\r\n\t\t\tif (this._align==\"top\"){\r\n\t\t\t\titem.y=0;\r\n\t\t\t\t}else if (this._align==\"middle\"){\r\n\t\t\t\titem.y=(maxHeight-item.height *item.scaleY)*0.5;\r\n\t\t\t\t}else if (this._align==\"bottom\"){\r\n\t\t\t\titem.y=maxHeight-item.height *item.scaleY;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changeSize();\r\n\t}\r\n\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tif (this._height !=value){\r\n\t\t\tLaya.superSet(LayoutBox,this,'height',value);\r\n\t\t\tthis.callLater(this.changeItems);\r\n\t\t}\r\n\t});\r\n\r\n\tHBox.NONE=\"none\";\r\n\tHBox.TOP=\"top\";\r\n\tHBox.MIDDLE=\"middle\";\r\n\tHBox.BOTTOM=\"bottom\";\r\n\treturn HBox;\r\n})(LayoutBox)\r\n\r\n\r\n/**\r\n*<code>VBox</code> 是一个垂直布局容器类。\r\n*/\r\n//class laya.ui.VBox extends laya.ui.LayoutBox\r\nvar VBox=(function(_super){\r\n\tfunction VBox(){\r\n\t\tVBox.__super.call(this);;\r\n\t}\r\n\r\n\t__class(VBox,'laya.ui.VBox',_super);\r\n\tvar __proto=VBox.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.changeItems=function(){\r\n\t\tthis._itemChanged=false;\r\n\t\tvar items=[];\r\n\t\tvar maxWidth=0;\r\n\t\tfor (var i=0,n=this.numChildren;i < n;i++){\r\n\t\t\tvar item=this.getChildAt(i);\r\n\t\t\tif (item&&item.layoutEnabled){\r\n\t\t\t\titems.push(item);\r\n\t\t\t\tmaxWidth=this._width?this._width:Math.max(maxWidth,item.width *item.scaleX);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.sortItem(items);\r\n\t\tvar top=0;\r\n\t\tfor (i=0,n=items.length;i < n;i++){\r\n\t\t\titem=items[i];\r\n\t\t\titem.y=top;\r\n\t\t\ttop+=item.height *item.scaleY+this._space;\r\n\t\t\tif (this._align==\"left\"){\r\n\t\t\t\titem.x=0;\r\n\t\t\t\t}else if (this._align==\"center\"){\r\n\t\t\t\titem.x=(maxWidth-item.width *item.scaleX)*0.5;\r\n\t\t\t\t}else if (this._align==\"right\"){\r\n\t\t\t\titem.x=maxWidth-item.width *item.scaleX;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changeSize();\r\n\t}\r\n\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tif (this._width !=value){\r\n\t\t\tLaya.superSet(LayoutBox,this,'width',value);\r\n\t\t\tthis.callLater(this.changeItems);\r\n\t\t}\r\n\t});\r\n\r\n\tVBox.NONE=\"none\";\r\n\tVBox.LEFT=\"left\";\r\n\tVBox.CENTER=\"center\";\r\n\tVBox.RIGHT=\"right\";\r\n\treturn VBox;\r\n})(LayoutBox)\r\n\r\n\r\n/**\r\n*<code>RadioGroup</code> 控件定义一组 <code>Radio</code> 控件，这些控件相互排斥；\r\n*因此，用户每次只能选择一个 <code>Radio</code> 控件。\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>RadioGroup</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Radio;\r\n\t*import laya.ui.RadioGroup;\r\n\t*import laya.utils.Handler;\r\n\t*public class RadioGroup_Example\r\n\t*{\r\n\t\t*public function RadioGroup_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/radio.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var radioGroup:RadioGroup=new RadioGroup();//创建一个 RadioGroup 类的实例对象 radioGroup 。\r\n\t\t\t*radioGroup.pos(100,100);//设置 radioGroup 的位置信息。\r\n\t\t\t*radioGroup.labels=\"item0,item1,item2\";//设置 radioGroup 的标签集。\r\n\t\t\t*radioGroup.skin=\"resource/ui/radio.png\";//设置 radioGroup 的皮肤。\r\n\t\t\t*radioGroup.space=10;//设置 radioGroup 的项间隔距离。\r\n\t\t\t*radioGroup.selectHandler=new Handler(this,onSelect);//设置 radioGroup 的选择项发生改变时执行的处理器。\r\n\t\t\t*Laya.stage.addChild(radioGroup);//将 radioGroup 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onSelect(index:int):void\r\n\t\t*{\r\n\t\t\t*trace(\"当前选择的单选按钮索引: index= \",index);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load([\"resource/ui/radio.png\"],laya.utils.Handler.create(this,onLoadComplete));\r\n*function onLoadComplete(){\r\n\t*var radioGroup=new laya.ui.RadioGroup();//创建一个 RadioGroup 类的实例对象 radioGroup 。\r\n\t*radioGroup.pos(100,100);//设置 radioGroup 的位置信息。\r\n\t*radioGroup.labels=\"item0,item1,item2\";//设置 radioGroup 的标签集。\r\n\t*radioGroup.skin=\"resource/ui/radio.png\";//设置 radioGroup 的皮肤。\r\n\t*radioGroup.space=10;//设置 radioGroup 的项间隔距离。\r\n\t*radioGroup.selectHandler=new laya.utils.Handler(this,onSelect);//设置 radioGroup 的选择项发生改变时执行的处理器。\r\n\t*Laya.stage.addChild(radioGroup);//将 radioGroup 添加到显示列表。\r\n\t*}\r\n*function onSelect(index){\r\n\t*console.log(\"当前选择的单选按钮索引: index= \",index);\r\n\t*}\r\n*@example\r\n*import Radio=laya.ui.Radio;\r\n*import RadioGroup=laya.ui.RadioGroup;\r\n*import Handler=laya.utils.Handler;\r\n*class RadioGroup_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/radio.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var radioGroup:RadioGroup=new RadioGroup();//创建一个 RadioGroup 类的实例对象 radioGroup 。\r\n\t\t*radioGroup.pos(100,100);//设置 radioGroup 的位置信息。\r\n\t\t*radioGroup.labels=\"item0,item1,item2\";//设置 radioGroup 的标签集。\r\n\t\t*radioGroup.skin=\"resource/ui/radio.png\";//设置 radioGroup 的皮肤。\r\n\t\t*radioGroup.space=10;//设置 radioGroup 的项间隔距离。\r\n\t\t*radioGroup.selectHandler=new Handler(this,this.onSelect);//设置 radioGroup 的选择项发生改变时执行的处理器。\r\n\t\t*Laya.stage.addChild(radioGroup);//将 radioGroup 添加到显示列表。\r\n\t\t*}\r\n\t*private onSelect(index:number):void {\r\n\t\t*console.log(\"当前选择的单选按钮索引: index= \",index);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.RadioGroup extends laya.ui.UIGroup\r\nvar RadioGroup=(function(_super){\r\n\tfunction RadioGroup(){\r\n\t\tRadioGroup.__super.call(this);;\r\n\t}\r\n\r\n\t__class(RadioGroup,'laya.ui.RadioGroup',_super);\r\n\tvar __proto=RadioGroup.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.createItem=function(skin,label){\r\n\t\treturn new Radio(skin,label);\r\n\t}\r\n\r\n\treturn RadioGroup;\r\n})(UIGroup)\r\n\r\n\r\n/**\r\n*<code>Tab</code> 组件用来定义选项卡按钮组。 *\r\n*@internal <p>属性：<code>selectedIndex</code> 的默认值为-1。</p>\r\n*\r\n*@example <caption>以下示例代码，创建了一个 <code>Tab</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.Tab;\r\n\t*import laya.utils.Handler;\r\n\t*public class Tab_Example\r\n\t*{\r\n\t\t*public function Tab_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/tab.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var tab:Tab=new Tab();//创建一个 Tab 类的实例对象 tab 。\r\n\t\t\t*tab.skin=\"resource/ui/tab.png\";//设置 tab 的皮肤。\r\n\t\t\t*tab.labels=\"item0,item1,item2\";//设置 tab 的标签集。\r\n\t\t\t*tab.x=100;//设置 tab 对象的属性 x 的值，用于控制 tab 对象的显示位置。\r\n\t\t\t*tab.y=100;//设置 tab 对象的属性 y 的值，用于控制 tab 对象的显示位置。\r\n\t\t\t*tab.selectHandler=new Handler(this,onSelect);//设置 tab 的选择项发生改变时执行的处理器。\r\n\t\t\t*Laya.stage.addChild(tab);//将 tab 添到显示列表。\r\n\t\t\t*}\r\n\t\t*private function onSelect(index:int):void\r\n\t\t*{\r\n\t\t\t*trace(\"当前选择的表情页索引: index= \",index);\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load([\"resource/ui/tab.png\"],laya.utils.Handler.create(this,onLoadComplete));\r\n*function onLoadComplete(){\r\n\t*var tab=new laya.ui.Tab();//创建一个 Tab 类的实例对象 tab 。\r\n\t*tab.skin=\"resource/ui/tab.png\";//设置 tab 的皮肤。\r\n\t*tab.labels=\"item0,item1,item2\";//设置 tab 的标签集。\r\n\t*tab.x=100;//设置 tab 对象的属性 x 的值，用于控制 tab 对象的显示位置。\r\n\t*tab.y=100;//设置 tab 对象的属性 y 的值，用于控制 tab 对象的显示位置。\r\n\t*tab.selectHandler=new laya.utils.Handler(this,onSelect);//设置 tab 的选择项发生改变时执行的处理器。\r\n\t*Laya.stage.addChild(tab);//将 tab 添到显示列表。\r\n\t*}\r\n*function onSelect(index){\r\n\t*console.log(\"当前选择的标签页索引: index= \",index);\r\n\t*}\r\n*@example\r\n*import Tab=laya.ui.Tab;\r\n*import Handler=laya.utils.Handler;\r\n*class Tab_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/tab.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var tab:Tab=new Tab();//创建一个 Tab 类的实例对象 tab 。\r\n\t\t*tab.skin=\"resource/ui/tab.png\";//设置 tab 的皮肤。\r\n\t\t*tab.labels=\"item0,item1,item2\";//设置 tab 的标签集。\r\n\t\t*tab.x=100;//设置 tab 对象的属性 x 的值，用于控制 tab 对象的显示位置。\r\n\t\t*tab.y=100;//设置 tab 对象的属性 y 的值，用于控制 tab 对象的显示位置。\r\n\t\t*tab.selectHandler=new Handler(this,this.onSelect);//设置 tab 的选择项发生改变时执行的处理器。\r\n\t\t*Laya.stage.addChild(tab);//将 tab 添到显示列表。\r\n\t\t*}\r\n\t*private onSelect(index:number):void {\r\n\t\t*console.log(\"当前选择的表情页索引: index= \",index);\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.Tab extends laya.ui.UIGroup\r\nvar Tab=(function(_super){\r\n\tfunction Tab(){\r\n\t\tTab.__super.call(this);;\r\n\t}\r\n\r\n\t__class(Tab,'laya.ui.Tab',_super);\r\n\tvar __proto=Tab.prototype;\r\n\t/**\r\n\t*@private\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.createItem=function(skin,label){\r\n\t\treturn new Button(skin,label);\r\n\t}\r\n\r\n\treturn Tab;\r\n})(UIGroup)\r\n\r\n\r\n/**\r\n*<code>TextArea</code> 类用于创建显示对象以显示和输入文本。\r\n*@example <caption>以下示例代码，创建了一个 <code>TextArea</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.ui.TextArea;\r\n\t*import laya.utils.Handler;\r\n\t*public class TextArea_Example\r\n\t*{\r\n\t\t*public function TextArea_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*Laya.loader.load([\"resource/ui/input.png\"],Handler.create(this,onLoadComplete));//加载资源。\r\n\t\t\t*}\r\n\t\t*private function onLoadComplete():void\r\n\t\t*{\r\n\t\t\t*var textArea:TextArea=new TextArea(\"这个一个TextArea实例。\");//创建一个 TextArea 类的实例对象 textArea 。\r\n\t\t\t*textArea.skin=\"resource/ui/input.png\";//设置 textArea 的皮肤。\r\n\t\t\t*textArea.sizeGrid=\"4,4,4,4\";//设置 textArea 的网格信息。\r\n\t\t\t*textArea.color=\"#008fff\";//设置 textArea 的文本颜色。\r\n\t\t\t*textArea.font=\"Arial\";//设置 textArea 的字体。\r\n\t\t\t*textArea.bold=true;//设置 textArea 的文本显示为粗体。\r\n\t\t\t*textArea.fontSize=20;//设置 textArea 的文本字体大小。\r\n\t\t\t*textArea.wordWrap=true;//设置 textArea 的文本自动换行。\r\n\t\t\t*textArea.x=100;//设置 textArea 对象的属性 x 的值，用于控制 textArea 对象的显示位置。\r\n\t\t\t*textArea.y=100;//设置 textArea 对象的属性 y 的值，用于控制 textArea 对象的显示位置。\r\n\t\t\t*textArea.width=300;//设置 textArea 的宽度。\r\n\t\t\t*textArea.height=200;//设置 textArea 的高度。\r\n\t\t\t*Laya.stage.addChild(textArea);//将 textArea 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Laya.init(640,800);//设置游戏画布宽高、渲染模式\r\n*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色\r\n*Laya.loader.load([\"resource/ui/input.png\"],laya.utils.Handler.create(this,onLoadComplete));//加载资源。\r\n*function onLoadComplete(){\r\n\t*var textArea=new laya.ui.TextArea(\"这个一个TextArea实例。\");//创建一个 TextArea 类的实例对象 textArea 。\r\n\t*textArea.skin=\"resource/ui/input.png\";//设置 textArea 的皮肤。\r\n\t*textArea.sizeGrid=\"4,4,4,4\";//设置 textArea 的网格信息。\r\n\t*textArea.color=\"#008fff\";//设置 textArea 的文本颜色。\r\n\t*textArea.font=\"Arial\";//设置 textArea 的字体。\r\n\t*textArea.bold=true;//设置 textArea 的文本显示为粗体。\r\n\t*textArea.fontSize=20;//设置 textArea 的文本字体大小。\r\n\t*textArea.wordWrap=true;//设置 textArea 的文本自动换行。\r\n\t*textArea.x=100;//设置 textArea 对象的属性 x 的值，用于控制 textArea 对象的显示位置。\r\n\t*textArea.y=100;//设置 textArea 对象的属性 y 的值，用于控制 textArea 对象的显示位置。\r\n\t*textArea.width=300;//设置 textArea 的宽度。\r\n\t*textArea.height=200;//设置 textArea 的高度。\r\n\t*Laya.stage.addChild(textArea);//将 textArea 添加到显示列表。\r\n\t*}\r\n*@example\r\n*import TextArea=laya.ui.TextArea;\r\n*import Handler=laya.utils.Handler;\r\n*class TextArea_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*Laya.loader.load([\"resource/ui/input.png\"],Handler.create(this,this.onLoadComplete));//加载资源。\r\n\t\t*}\r\n\t*private onLoadComplete():void {\r\n\t\t*var textArea:TextArea=new TextArea(\"这个一个TextArea实例。\");//创建一个 TextArea 类的实例对象 textArea 。\r\n\t\t*textArea.skin=\"resource/ui/input.png\";//设置 textArea 的皮肤。\r\n\t\t*textArea.sizeGrid=\"4,4,4,4\";//设置 textArea 的网格信息。\r\n\t\t*textArea.color=\"#008fff\";//设置 textArea 的文本颜色。\r\n\t\t*textArea.font=\"Arial\";//设置 textArea 的字体。\r\n\t\t*textArea.bold=true;//设置 textArea 的文本显示为粗体。\r\n\t\t*textArea.fontSize=20;//设置 textArea 的文本字体大小。\r\n\t\t*textArea.wordWrap=true;//设置 textArea 的文本自动换行。\r\n\t\t*textArea.x=100;//设置 textArea 对象的属性 x 的值，用于控制 textArea 对象的显示位置。\r\n\t\t*textArea.y=100;//设置 textArea 对象的属性 y 的值，用于控制 textArea 对象的显示位置。\r\n\t\t*textArea.width=300;//设置 textArea 的宽度。\r\n\t\t*textArea.height=200;//设置 textArea 的高度。\r\n\t\t*Laya.stage.addChild(textArea);//将 textArea 添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.ui.TextArea extends laya.ui.TextInput\r\nvar TextArea=(function(_super){\r\n\tfunction TextArea(text){\r\n\t\t/**@private */\r\n\t\tthis._vScrollBar=null;\r\n\t\t/**@private */\r\n\t\tthis._hScrollBar=null;\r\n\t\t(text===void 0)&& (text=\"\");\r\n\t\tTextArea.__super.call(this,text);\r\n\t}\r\n\r\n\t__class(TextArea,'laya.ui.TextArea',_super);\r\n\tvar __proto=TextArea.prototype;\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._vScrollBar && this._vScrollBar.destroy();\r\n\t\tthis._hScrollBar && this._hScrollBar.destroy();\r\n\t\tthis._vScrollBar=null;\r\n\t\tthis._hScrollBar=null;\r\n\t}\r\n\r\n\t__proto.initialize=function(){\r\n\t\tthis.width=180;\r\n\t\tthis.height=150;\r\n\t\tthis._tf.wordWrap=true;\r\n\t\tthis.multiline=true;\r\n\t}\r\n\r\n\t__proto.onVBarChanged=function(e){\r\n\t\tif (this._tf.scrollY !=this._vScrollBar.value){\r\n\t\t\tthis._tf.scrollY=this._vScrollBar.value;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onHBarChanged=function(e){\r\n\t\tif (this._tf.scrollX !=this._hScrollBar.value){\r\n\t\t\tthis._tf.scrollX=this._hScrollBar.value;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.changeScroll=function(){\r\n\t\tvar vShow=this._vScrollBar && this._tf.maxScrollY > 0;\r\n\t\tvar hShow=this._hScrollBar && this._tf.maxScrollX > 0;\r\n\t\tvar showWidth=vShow ? this._width-this._vScrollBar.width :this._width;\r\n\t\tvar showHeight=hShow ? this._height-this._hScrollBar.height :this._height;\r\n\t\tvar padding=this._tf.padding || Styles.labelPadding;\r\n\t\tthis._tf.width=showWidth;\r\n\t\tthis._tf.height=showHeight;\r\n\t\tif (this._vScrollBar){\r\n\t\t\tthis._vScrollBar.x=this._width-this._vScrollBar.width-padding[2];\r\n\t\t\tthis._vScrollBar.y=padding[1];\r\n\t\t\tthis._vScrollBar.height=this._height-(hShow ? this._hScrollBar.height :0)-padding[1]-padding[3];\r\n\t\t\tthis._vScrollBar.scrollSize=1;\r\n\t\t\tthis._vScrollBar.thumbPercent=showHeight / Math.max(this._tf.textHeight,showHeight);\r\n\t\t\tthis._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY);\r\n\t\t\tthis._vScrollBar.visible=vShow;\r\n\t\t}\r\n\t\tif (this._hScrollBar){\r\n\t\t\tthis._hScrollBar.x=padding[0];\r\n\t\t\tthis._hScrollBar.y=this._height-this._hScrollBar.height-padding[3];\r\n\t\t\tthis._hScrollBar.width=this._width-(vShow ? this._vScrollBar.width :0)-padding[0]-padding[2];\r\n\t\t\tthis._hScrollBar.scrollSize=Math.max(showWidth *0.033,1);\r\n\t\t\tthis._hScrollBar.thumbPercent=showWidth / Math.max(this._tf.textWidth,showWidth);\r\n\t\t\tthis._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX);\r\n\t\t\tthis._hScrollBar.visible=hShow;\r\n\t\t}\r\n\t}\r\n\r\n\t/**滚动到某个位置*/\r\n\t__proto.scrollTo=function(y){\r\n\t\tthis.commitMeasure();\r\n\t\tthis._tf.scrollY=y;\r\n\t}\r\n\r\n\t/**垂直滚动值*/\r\n\t__getset(0,__proto,'scrollY',function(){\r\n\t\treturn this._tf.scrollY;\r\n\t});\r\n\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tLaya.superSet(TextInput,this,'width',value);\r\n\t\tthis.callLater(this.changeScroll);\r\n\t});\r\n\r\n\t/**水平滚动条实体*/\r\n\t__getset(0,__proto,'hScrollBar',function(){\r\n\t\treturn this._hScrollBar;\r\n\t});\r\n\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tLaya.superSet(TextInput,this,'height',value);\r\n\t\tthis.callLater(this.changeScroll);\r\n\t});\r\n\r\n\t/**水平滚动最大值*/\r\n\t__getset(0,__proto,'maxScrollX',function(){\r\n\t\treturn this._tf.maxScrollX;\r\n\t});\r\n\r\n\t/**垂直滚动条皮肤*/\r\n\t__getset(0,__proto,'vScrollBarSkin',function(){\r\n\t\treturn this._vScrollBar ? this._vScrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tif (this._vScrollBar==null){\r\n\t\t\tthis.addChild(this._vScrollBar=new VScrollBar());\r\n\t\t\tthis._vScrollBar.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onVBarChanged);\r\n\t\t\tthis._vScrollBar.target=this._tf;\r\n\t\t\tthis.callLater(this.changeScroll);\r\n\t\t}\r\n\t\tthis._vScrollBar.skin=value;\r\n\t});\r\n\r\n\t/**水平滚动条皮肤*/\r\n\t__getset(0,__proto,'hScrollBarSkin',function(){\r\n\t\treturn this._hScrollBar ? this._hScrollBar.skin :null;\r\n\t\t},function(value){\r\n\t\tif (this._hScrollBar==null){\r\n\t\t\tthis.addChild(this._hScrollBar=new HScrollBar());\r\n\t\t\tthis._hScrollBar.on(/*laya.events.Event.CHANGE*/\"change\",this,this.onHBarChanged);\r\n\t\t\tthis._hScrollBar.mouseWheelEnable=false;\r\n\t\t\tthis._hScrollBar.target=this._tf;\r\n\t\t\tthis.callLater(this.changeScroll);\r\n\t\t}\r\n\t\tthis._hScrollBar.skin=value;\r\n\t});\r\n\r\n\t/**垂直滚动条实体*/\r\n\t__getset(0,__proto,'vScrollBar',function(){\r\n\t\treturn this._vScrollBar;\r\n\t});\r\n\r\n\t/**垂直滚动最大值*/\r\n\t__getset(0,__proto,'maxScrollY',function(){\r\n\t\treturn this._tf.maxScrollY;\r\n\t});\r\n\r\n\t/**水平滚动值*/\r\n\t__getset(0,__proto,'scrollX',function(){\r\n\t\treturn this._tf.scrollX;\r\n\t});\r\n\r\n\treturn TextArea;\r\n})(TextInput)\r\n\r\n\r\n/**\r\n*异步Dialog的生命周期:show或者popup > onCreate(如果没有创建过)> onOpen > onClose > onDestroy(如果销毁)\r\n*onCreate在页面未创建时执行一次，再次打开页面不会再执行，适合写一些只执行一次的逻辑，比如资源加载，节点事件监听\r\n*onOpen在页面每次打开都会执行，适合做一些每次都需要处理的事情，比如消息请求，根据数据初始化页面\r\n*onClose在每次关闭的时候调用，适合关闭时停止动画，网络消息监听等逻辑\r\n*onDestroy在页面被销毁的时候调用，适合置空引用对象\r\n*/\r\n//class laya.ui.AsynDialog extends laya.ui.Dialog\r\nvar AsynDialog=(function(_super){\r\n\tfunction AsynDialog(){\r\n\t\t/**@private */\r\n\t\tthis._uiView=null;\r\n\t\t/**打开时是否关闭其他页面*/\r\n\t\tthis.isCloseOther=false;\r\n\t\tAsynDialog.__super.call(this);\r\n\t}\r\n\r\n\t__class(AsynDialog,'laya.ui.AsynDialog',_super);\r\n\tvar __proto=AsynDialog.prototype;\r\n\t/**@private */\r\n\t__proto.createView=function(uiView){\r\n\t\tthis._uiView=uiView;\r\n\t}\r\n\r\n\t__proto._open=function(modal,closeOther,showEffect){\r\n\t\tthis.isModal=modal;\r\n\t\tthis.isCloseOther=closeOther;\r\n\t\tDialog.manager.lock(true);\r\n\t\tif (this._uiView)this.onCreated();\r\n\t\telse this.onOpen();\r\n\t}\r\n\r\n\t/**\r\n\t*在页面未创建时执行一次，再次打开页面不会再执行，适合写一些只执行一次的逻辑，比如资源加载，节点事件监听\r\n\t*/\r\n\t__proto.onCreated=function(){\r\n\t\tthis.createUI();\r\n\t\tthis.onOpen();\r\n\t}\r\n\r\n\t/**根据节点数据创建UI*/\r\n\t__proto.createUI=function(){\r\n\t\tlaya.ui.View.prototype.createView.call(this,this._uiView);\r\n\t\tthis._uiView=null;\r\n\t\tthis._dealDragArea();\r\n\t}\r\n\r\n\t/**\r\n\t*在页面每次打开都会执行，适合做一些每次都需要处理的事情，比如消息请求，根据数据初始化页面\r\n\t*/\r\n\t__proto.onOpen=function(){\r\n\t\tDialog.manager.open(this,this.isCloseOther);\r\n\t\tDialog.manager.lock(false);\r\n\t}\r\n\r\n\t__proto.close=function(type,showEffect){\r\n\t\t(showEffect===void 0)&& (showEffect=true);\r\n\t\tDialog.manager.close(this);\r\n\t\tthis.onClose();\r\n\t}\r\n\r\n\t/**\r\n\t*在每次关闭的时候调用，适合关闭时停止动画，网络消息监听等逻辑\r\n\t*/\r\n\t__proto.onClose=function(){}\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tlaya.ui.View.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._uiView=null;\r\n\t\tthis.onDestroy();\r\n\t}\r\n\r\n\t/**\r\n\t*在页面被销毁的时候调用，适合置空引用对象\r\n\t*/\r\n\t__proto.onDestroy=function(){}\r\n\treturn AsynDialog;\r\n})(Dialog)\r\n\r\n\r\n\tLaya.__init([View]);\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.ui.js?");

/***/ }),

/***/ "./bin/libs/laya.webgl.js":
/*!********************************!*\
  !*** ./bin/libs/laya.webgl.js ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Arith=laya.maths.Arith,Bezier=laya.maths.Bezier,Bitmap=laya.resource.Bitmap,Browser=laya.utils.Browser;\r\n\tvar Byte=laya.utils.Byte,Color=laya.utils.Color,ColorFilter=laya.filters.ColorFilter,Config=Laya.Config,Context=laya.resource.Context;\r\n\tvar Event=laya.events.Event,Filter=laya.filters.Filter,Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas;\r\n\tvar HTMLChar=laya.utils.HTMLChar,HTMLImage=laya.resource.HTMLImage,HTMLSubImage=laya.resource.HTMLSubImage;\r\n\tvar Handler=laya.utils.Handler,Loader=laya.net.Loader,Matrix=laya.maths.Matrix,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle;\r\n\tvar Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;\r\n\tvar Resource=laya.resource.Resource,ResourceManager=laya.resource.ResourceManager,RunDriver=laya.utils.RunDriver;\r\n\tvar Sprite=laya.display.Sprite,Stage=laya.display.Stage,Stat=laya.utils.Stat,StringKey=laya.utils.StringKey;\r\n\tvar Style=laya.display.css.Style,System=laya.system.System,Text=laya.display.Text,Texture=laya.resource.Texture;\r\n\tvar TransformInfo=laya.display.css.TransformInfo,URL=laya.net.URL,Utils=laya.utils.Utils,VectorGraphManager=laya.utils.VectorGraphManager;\r\n\tvar WordText=laya.utils.WordText;\r\nLaya.interface('laya.webgl.shapes.IShape');\r\nLaya.interface('laya.webgl.submit.ISubmit');\r\nLaya.interface('laya.webgl.text.ICharSegment');\r\nLaya.interface('laya.webgl.canvas.save.ISaveData');\r\nLaya.interface('laya.webgl.resource.IMergeAtlasBitmap');\r\nLaya.interface('laya.filters.IFilterActionGL','laya.filters.IFilterAction');\r\n//class laya.filters.webgl.FilterActionGL\r\nvar FilterActionGL=(function(){\r\n\tfunction FilterActionGL(){}\r\n\t__class(FilterActionGL,'laya.filters.webgl.FilterActionGL');\r\n\tvar __proto=FilterActionGL.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilterActionGL\":true})\r\n\t__proto.setValue=function(shader){}\r\n\t__proto.setValueMix=function(shader){}\r\n\t__proto.apply3d=function(scope,sprite,context,x,y){return null;}\r\n\t__proto.apply=function(srcCanvas){return null;}\r\n\t__getset(0,__proto,'typeMix',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\treturn FilterActionGL;\r\n})()\r\n\r\n\r\n//class laya.webgl.shader.ShaderValue\r\nvar ShaderValue=(function(){\r\n\tfunction ShaderValue(){}\r\n\t__class(ShaderValue,'laya.webgl.shader.ShaderValue');\r\n\treturn ShaderValue;\r\n})()\r\n\r\n\r\n//class laya.webgl.atlas.AtlasGrid\r\nvar AtlasGrid=(function(){\r\n\tvar TexRowInfo,TexMergeTexSize;\r\n\tfunction AtlasGrid(width,height,atlasID){\r\n\t\tthis._atlasID=0;\r\n\t\tthis._width=0;\r\n\t\tthis._height=0;\r\n\t\tthis._texCount=0;\r\n\t\tthis._rowInfo=null;\r\n\t\tthis._cells=null;\r\n\t\tthis._failSize=new TexMergeTexSize();\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\t(atlasID===void 0)&& (atlasID=0);\r\n\t\tthis._cells=null;\r\n\t\tthis._rowInfo=null;\r\n\t\tthis._init(width,height);\r\n\t\tthis._atlasID=atlasID;\r\n\t}\r\n\r\n\t__class(AtlasGrid,'laya.webgl.atlas.AtlasGrid');\r\n\tvar __proto=AtlasGrid.prototype;\r\n\t//------------------------------------------------------------------------------\r\n\t__proto.getAltasID=function(){\r\n\t\treturn this._atlasID;\r\n\t}\r\n\r\n\t//------------------------------------------------------------------------------\r\n\t__proto.setAltasID=function(atlasID){\r\n\t\tif (atlasID >=0){\r\n\t\t\tthis._atlasID=atlasID;\r\n\t\t}\r\n\t}\r\n\r\n\t//------------------------------------------------------------------\r\n\t__proto.addTex=function(type,width,height){\r\n\t\tvar result=this._get(width,height);\r\n\t\tif (result.ret==false){\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tthis._fill(result.x,result.y,width,height,type);\r\n\t\tthis._texCount++;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//------------------------------------------------------------------------------\r\n\t__proto._release=function(){\r\n\t\tif (this._cells !=null){\r\n\t\t\tthis._cells.length=0;\r\n\t\t\tthis._cells=null;\r\n\t\t}\r\n\t\tif (this._rowInfo){\r\n\t\t\tthis._rowInfo.length=0;\r\n\t\t\tthis._rowInfo=null;\r\n\t\t}\r\n\t}\r\n\r\n\t//------------------------------------------------------------------------------\r\n\t__proto._init=function(width,height){\r\n\t\tthis._width=width;\r\n\t\tthis._height=height;\r\n\t\tthis._release();\r\n\t\tif (this._width==0)return false;\r\n\t\tthis._cells=new Uint8Array(this._width *this._height*3);\r\n\t\tthis._rowInfo=__newvec(this._height);\r\n\t\tfor (var i=0;i < this._height;i++){\r\n\t\t\tthis._rowInfo[i]=new TexRowInfo();\r\n\t\t}\r\n\t\tthis._clear();\r\n\t\treturn true;\r\n\t}\r\n\r\n\t//------------------------------------------------------------------\r\n\t__proto._get=function(width,height){\r\n\t\tvar pFillInfo=new MergeFillInfo();\r\n\t\tif (width >=this._failSize.width && height >=this._failSize.height){\r\n\t\t\treturn pFillInfo;\r\n\t\t};\r\n\t\tvar rx=-1;\r\n\t\tvar ry=-1;\r\n\t\tvar nWidth=this._width;\r\n\t\tvar nHeight=this._height;\r\n\t\tvar pCellBox=this._cells;\r\n\t\tfor (var y=0;y < nHeight;y++){\r\n\t\t\tif (this._rowInfo[y].spaceCount < width)continue ;\r\n\t\t\tfor (var x=0;x < nWidth;){\r\n\t\t\t\tvar tm=(y *nWidth+x)*3;\r\n\t\t\t\tif (pCellBox[tm] !=0 || pCellBox[tm+1] < width || pCellBox[tm+2] < height){\r\n\t\t\t\t\tx+=pCellBox[tm+1];\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\trx=x;\r\n\t\t\t\try=y;\r\n\t\t\t\tfor (var xx=0;xx < width;xx++){\r\n\t\t\t\t\tif (pCellBox[3*xx+tm+2] < height){\r\n\t\t\t\t\t\trx=-1;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (rx < 0){\r\n\t\t\t\t\tx+=pCellBox[tm+1];\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\tpFillInfo.ret=true;\r\n\t\t\t\tpFillInfo.x=rx;\r\n\t\t\t\tpFillInfo.y=ry;\r\n\t\t\t\treturn pFillInfo;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pFillInfo;\r\n\t}\r\n\r\n\t//------------------------------------------------------------------\r\n\t__proto._fill=function(x,y,w,h,type){\r\n\t\tvar nWidth=this._width;\r\n\t\tvar nHeghit=this._height;\r\n\t\tthis._check((x+w)<=nWidth && (y+h)<=nHeghit);\r\n\t\tfor (var yy=y;yy < (h+y);++yy){\r\n\t\t\tthis._check(this._rowInfo[yy].spaceCount >=w);\r\n\t\t\tthis._rowInfo[yy].spaceCount-=w;\r\n\t\t\tfor (var xx=0;xx < w;xx++){\r\n\t\t\t\tvar tm=(x+yy *nWidth+xx)*3;\r\n\t\t\t\tthis._check(this._cells[tm]==0);\r\n\t\t\t\tthis._cells[tm]=type;\r\n\t\t\t\tthis._cells[tm+1]=w;\r\n\t\t\t\tthis._cells[tm+2]=h;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (x > 0){\r\n\t\t\tfor (yy=0;yy < h;++yy){\r\n\t\t\t\tvar s=0;\r\n\t\t\t\tfor (xx=x-1;xx >=0;--xx,++s){\r\n\t\t\t\t\tif (this._cells[((y+yy)*nWidth+xx)*3] !=0)break ;\r\n\t\t\t\t}\r\n\t\t\t\tfor (xx=s;xx > 0;--xx){\r\n\t\t\t\t\tthis._cells[((y+yy)*nWidth+x-xx)*3+1]=xx;\r\n\t\t\t\t\tthis._check(xx > 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (y > 0){\r\n\t\t\tfor (xx=x;xx < (x+w);++xx){\r\n\t\t\t\ts=0;\r\n\t\t\t\tfor (yy=y-1;yy >=0;--yy,s++){\r\n\t\t\t\t\tif (this._cells[(xx+yy *nWidth)*3] !=0)break ;\r\n\t\t\t\t}\r\n\t\t\t\tfor (yy=s;yy > 0;--yy){\r\n\t\t\t\t\tthis._cells[(xx+(y-yy)*nWidth)*3+2]=yy;\r\n\t\t\t\t\tthis._check(yy > 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._check=function(ret){\r\n\t\tif (ret==false){\r\n\t\t\tconsole.log(\"xtexMerger 错误啦\");\r\n\t\t}\r\n\t}\r\n\r\n\t//------------------------------------------------------------------\r\n\t__proto._clear=function(){\r\n\t\tthis._texCount=0;\r\n\t\tfor (var y=0;y < this._height;y++){\r\n\t\t\tthis._rowInfo[y].spaceCount=this._width;\r\n\t\t}\r\n\t\tfor (var i=0;i < this._height;i++){\r\n\t\t\tfor (var j=0;j < this._width;j++){\r\n\t\t\t\tvar tm=(i *this._width+j)*3;\r\n\t\t\t\tthis._cells[tm]=0;\r\n\t\t\t\tthis._cells[tm+1]=this._width-j;\r\n\t\t\t\tthis._cells[tm+2]=this._width-i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._failSize.width=this._width+1;\r\n\t\tthis._failSize.height=this._height+1;\r\n\t}\r\n\r\n\tAtlasGrid.__init$=function(){\r\n\t\t//------------------------------------------------------------------------------\r\n\t\t//class TexRowInfo\r\n\t\tTexRowInfo=(function(){\r\n\t\t\tfunction TexRowInfo(){\r\n\t\t\t\tthis.spaceCount=0;\r\n\t\t\t}\r\n\t\t\t__class(TexRowInfo,'');\r\n\t\t\treturn TexRowInfo;\r\n\t\t})()\r\n\t\t//------------------------------------------------------------------------------\r\n\t\t//class TexMergeTexSize\r\n\t\tTexMergeTexSize=(function(){\r\n\t\t\tfunction TexMergeTexSize(){\r\n\t\t\t\tthis.width=0;\r\n\t\t\t\tthis.height=0;\r\n\t\t\t}\r\n\t\t\t__class(TexMergeTexSize,'');\r\n\t\t\treturn TexMergeTexSize;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn AtlasGrid;\r\n})()\r\n\r\n\r\n//class laya.webgl.atlas.AtlasResourceManager\r\nvar AtlasResourceManager=(function(){\r\n\tfunction AtlasResourceManager(width,height,gridSize,maxTexNum){\r\n\t\tthis._currentAtlasCount=0;\r\n\t\tthis._maxAtlaserCount=0;\r\n\t\tthis._width=0;\r\n\t\tthis._height=0;\r\n\t\tthis._gridSize=0;\r\n\t\tthis._gridNumX=0;\r\n\t\tthis._gridNumY=0;\r\n\t\tthis._init=false;\r\n\t\tthis._curAtlasIndex=0;\r\n\t\tthis._setAtlasParam=false;\r\n\t\tthis._atlaserArray=null;\r\n\t\tthis._needGC=false;\r\n\t\tthis._setAtlasParam=true;\r\n\t\tthis._width=width;\r\n\t\tthis._height=height;\r\n\t\tthis._gridSize=gridSize;\r\n\t\tthis._maxAtlaserCount=maxTexNum;\r\n\t\tthis._gridNumX=width / gridSize;\r\n\t\tthis._gridNumY=height / gridSize;\r\n\t\tthis._curAtlasIndex=0;\r\n\t\tthis._atlaserArray=[];\r\n\t}\r\n\r\n\t__class(AtlasResourceManager,'laya.webgl.atlas.AtlasResourceManager');\r\n\tvar __proto=AtlasResourceManager.prototype;\r\n\t__proto.setAtlasParam=function(width,height,gridSize,maxTexNum){\r\n\t\tif (this._setAtlasParam==true){\r\n\t\t\tAtlasResourceManager._sid_=0;\r\n\t\t\tthis._width=width;\r\n\t\t\tthis._height=height;\r\n\t\t\tthis._gridSize=gridSize;\r\n\t\t\tthis._maxAtlaserCount=maxTexNum;\r\n\t\t\tthis._gridNumX=width / gridSize;\r\n\t\t\tthis._gridNumY=height / gridSize;\r\n\t\t\tthis._curAtlasIndex=0;\r\n\t\t\tthis.freeAll();\r\n\t\t\treturn true;\r\n\t\t\t}else {\r\n\t\t\tconsole.log(\"设置大图合集参数错误，只能在开始页面设置各种参数\");\r\n\t\t\tthrow-1;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//添加 图片到大图集\r\n\t__proto.pushData=function(texture){\r\n\t\tvar bitmap=texture.bitmap;\r\n\t\tvar nWebGLImageIndex=-1;\r\n\t\tvar curAtlas=null;\r\n\t\tvar i=0,n=0,altasIndex=0;\r\n\t\tfor (i=0,n=this._atlaserArray.length;i < n;i++){\r\n\t\t\taltasIndex=(this._curAtlasIndex+i)% n;\r\n\t\t\tcurAtlas=this._atlaserArray[altasIndex];\r\n\t\t\tnWebGLImageIndex=curAtlas.findBitmapIsExist(bitmap);\r\n\t\t\tif (nWebGLImageIndex !=-1){\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (nWebGLImageIndex !=-1){\r\n\t\t\tvar offset=curAtlas.InAtlasWebGLImagesOffsetValue[nWebGLImageIndex];\r\n\t\t\toffsetX=offset[0];\r\n\t\t\toffsetY=offset[1];\r\n\t\t\tcurAtlas.addToAtlas(texture,offsetX,offsetY);\r\n\t\t\treturn true;\r\n\t\t\t}else {\r\n\t\t\tvar tex=texture;\r\n\t\t\tthis._setAtlasParam=false;\r\n\t\t\tvar bFound=false;\r\n\t\t\tvar nImageGridX=(Math.ceil((texture.bitmap.width+2)/ this._gridSize));\r\n\t\t\tvar nImageGridY=(Math.ceil((texture.bitmap.height+2)/ this._gridSize));\r\n\t\t\tvar bSuccess=false;\r\n\t\t\tfor (var k=0;k < 2;k++){\r\n\t\t\t\tvar maxAtlaserCount=this._maxAtlaserCount;\r\n\t\t\t\tfor (i=0;i < maxAtlaserCount;i++){\r\n\t\t\t\t\taltasIndex=(this._curAtlasIndex+i)% maxAtlaserCount;\r\n\t\t\t\t\t(this._atlaserArray.length-1 >=altasIndex)|| (this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++)));\r\n\t\t\t\t\tvar atlas=this._atlaserArray[altasIndex];\r\n\t\t\t\t\tvar offsetX=0,offsetY=0;\r\n\t\t\t\t\tvar fillInfo=atlas.addTex(1,nImageGridX,nImageGridY);\r\n\t\t\t\t\tif (fillInfo.ret){\r\n\t\t\t\t\t\toffsetX=fillInfo.x *this._gridSize+1;\r\n\t\t\t\t\t\toffsetY=fillInfo.y *this._gridSize+1;\r\n\t\t\t\t\t\tbitmap.lock=true;\r\n\t\t\t\t\t\tatlas.addToAtlasTexture((bitmap),offsetX,offsetY);\r\n\t\t\t\t\t\tatlas.addToAtlas(texture,offsetX,offsetY);\r\n\t\t\t\t\t\tbSuccess=true;\r\n\t\t\t\t\t\tthis._curAtlasIndex=altasIndex;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (bSuccess)\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tthis._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++));\r\n\t\t\t\tthis._needGC=true;\r\n\t\t\t\tthis.garbageCollection();\r\n\t\t\t\tthis._curAtlasIndex=this._atlaserArray.length-1;\r\n\t\t\t}\r\n\t\t\tif (!bSuccess){\r\n\t\t\t\tconsole.log(\">>>AtlasManager pushData error\");\r\n\t\t\t}\r\n\t\t\treturn bSuccess;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.addToAtlas=function(tex){\r\n\t\tlaya.webgl.atlas.AtlasResourceManager.instance.pushData(tex);\r\n\t}\r\n\r\n\t/**\r\n\t*回收大图合集,不建议手动调用\r\n\t*@return\r\n\t*/\r\n\t__proto.garbageCollection=function(){\r\n\t\tif (this._needGC===true){\r\n\t\t\tvar n=this._atlaserArray.length-this._maxAtlaserCount;\r\n\t\t\tfor (var i=0;i < n;i++){\r\n\t\t\t\tthis._atlaserArray[i].dispose();\r\n\t\t\t\tconsole.log(\"AtlasResourceManager:Dispose the inner Atlas。\");\r\n\t\t\t}\r\n\t\t\tconsole.log(\">>>>altas garbageCollection =\"+n);\r\n\t\t\tthis._atlaserArray.splice(0,n);\r\n\t\t\tthis._needGC=false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto.freeAll=function(){\r\n\t\tfor (var i=0,n=this._atlaserArray.length;i < n;i++){\r\n\t\t\tthis._atlaserArray[i].dispose();\r\n\t\t}\r\n\t\tthis._atlaserArray.length=0;\r\n\t\tthis._curAtlasIndex=0;\r\n\t}\r\n\r\n\t__proto.getAtlaserCount=function(){\r\n\t\treturn this._atlaserArray.length;\r\n\t}\r\n\r\n\t__proto.getAtlaserByIndex=function(index){\r\n\t\treturn this._atlaserArray[index];\r\n\t}\r\n\r\n\t__getset(1,AtlasResourceManager,'instance',function(){\r\n\t\tif (!AtlasResourceManager._Instance){\r\n\t\t\tAtlasResourceManager._Instance=new AtlasResourceManager(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,/*CLASS CONST:laya.webgl.atlas.AtlasResourceManager.gridSize*/16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount);\r\n\t\t}\r\n\t\treturn AtlasResourceManager._Instance;\r\n\t});\r\n\r\n\t__getset(1,AtlasResourceManager,'enabled',function(){\r\n\t\treturn Config.atlasEnable;\r\n\t});\r\n\r\n\t__getset(1,AtlasResourceManager,'atlasLimitWidth',function(){\r\n\t\treturn AtlasResourceManager._atlasLimitWidth;\r\n\t\t},function(value){\r\n\t\tAtlasResourceManager._atlasLimitWidth=value;\r\n\t});\r\n\r\n\t__getset(1,AtlasResourceManager,'atlasLimitHeight',function(){\r\n\t\treturn AtlasResourceManager._atlasLimitHeight;\r\n\t\t},function(value){\r\n\t\tAtlasResourceManager._atlasLimitHeight=value;\r\n\t});\r\n\r\n\tAtlasResourceManager._enable=function(){\r\n\t\tConfig.atlasEnable=true;\r\n\t}\r\n\r\n\tAtlasResourceManager._disable=function(){\r\n\t\tConfig.atlasEnable=false;\r\n\t}\r\n\r\n\tAtlasResourceManager.__init__=function(){\r\n\t\tAtlasResourceManager.atlasTextureWidth=2048;\r\n\t\tAtlasResourceManager.atlasTextureHeight=2048;\r\n\t\tAtlasResourceManager.maxTextureCount=6;\r\n\t\tAtlasResourceManager.atlasLimitWidth=512;\r\n\t\tAtlasResourceManager.atlasLimitHeight=512;\r\n\t}\r\n\r\n\tAtlasResourceManager._atlasLimitWidth=0;\r\n\tAtlasResourceManager._atlasLimitHeight=0;\r\n\tAtlasResourceManager.gridSize=16;\r\n\tAtlasResourceManager.atlasTextureWidth=0;\r\n\tAtlasResourceManager.atlasTextureHeight=0;\r\n\tAtlasResourceManager.maxTextureCount=0;\r\n\tAtlasResourceManager._atlasRestore=0;\r\n\tAtlasResourceManager.BOARDER_TYPE_NO=0;\r\n\tAtlasResourceManager.BOARDER_TYPE_RIGHT=1;\r\n\tAtlasResourceManager.BOARDER_TYPE_LEFT=2;\r\n\tAtlasResourceManager.BOARDER_TYPE_BOTTOM=4;\r\n\tAtlasResourceManager.BOARDER_TYPE_TOP=8;\r\n\tAtlasResourceManager.BOARDER_TYPE_ALL=15;\r\n\tAtlasResourceManager._sid_=0;\r\n\tAtlasResourceManager._Instance=null;\r\n\treturn AtlasResourceManager;\r\n})()\r\n\r\n\r\n//class laya.webgl.atlas.MergeFillInfo\r\nvar MergeFillInfo=(function(){\r\n\tfunction MergeFillInfo(){\r\n\t\tthis.x=0;\r\n\t\tthis.y=0;\r\n\t\tthis.ret=false;\r\n\t\tthis.ret=false;\r\n\t\tthis.x=0;\r\n\t\tthis.y=0;\r\n\t}\r\n\r\n\t__class(MergeFillInfo,'laya.webgl.atlas.MergeFillInfo');\r\n\treturn MergeFillInfo;\r\n})()\r\n\r\n\r\n;\r\n//class laya.webgl.canvas.BlendMode\r\nvar BlendMode=(function(){\r\n\tfunction BlendMode(){}\r\n\t__class(BlendMode,'laya.webgl.canvas.BlendMode');\r\n\tBlendMode._init_=function(gl){\r\n\t\tBlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut];\r\n\t\tBlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut];\r\n\t}\r\n\r\n\tBlendMode.BlendNormal=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_ALPHA*/0x0303);\r\n\t}\r\n\r\n\tBlendMode.BlendAdd=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.DST_ALPHA*/0x0304);\r\n\t}\r\n\r\n\tBlendMode.BlendMultiply=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.DST_COLOR*/0x0306,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_ALPHA*/0x0303);\r\n\t}\r\n\r\n\tBlendMode.BlendScreen=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE*/1);\r\n\t}\r\n\r\n\tBlendMode.BlendOverlay=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_COLOR*/0x0301);\r\n\t}\r\n\r\n\tBlendMode.BlendLight=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE*/1);\r\n\t}\r\n\r\n\tBlendMode.BlendNormalTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_ALPHA*/0x0303);\r\n\t}\r\n\r\n\tBlendMode.BlendAddTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.DST_ALPHA*/0x0304);\r\n\t}\r\n\r\n\tBlendMode.BlendMultiplyTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.DST_COLOR*/0x0306,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_ALPHA*/0x0303);\r\n\t}\r\n\r\n\tBlendMode.BlendScreenTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE*/1);\r\n\t}\r\n\r\n\tBlendMode.BlendOverlayTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE_MINUS_SRC_COLOR*/0x0301);\r\n\t}\r\n\r\n\tBlendMode.BlendLightTarget=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ONE*/1,/*laya.webgl.WebGLContext.ONE*/1);\r\n\t}\r\n\r\n\tBlendMode.BlendMask=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ZERO*/0,/*laya.webgl.WebGLContext.SRC_ALPHA*/0x0302);\r\n\t}\r\n\r\n\tBlendMode.BlendDestinationOut=function(gl){\r\n\t\tgl.blendFunc(/*laya.webgl.WebGLContext.ZERO*/0,/*laya.webgl.WebGLContext.ZERO*/0);\r\n\t}\r\n\r\n\tBlendMode.activeBlendFunction=null;\r\n\tBlendMode.NORMAL=\"normal\";\r\n\tBlendMode.ADD=\"add\";\r\n\tBlendMode.MULTIPLY=\"multiply\";\r\n\tBlendMode.SCREEN=\"screen\";\r\n\tBlendMode.LIGHT=\"light\";\r\n\tBlendMode.OVERLAY=\"overlay\";\r\n\tBlendMode.DESTINATIONOUT=\"destination-out\";\r\n\tBlendMode.fns=[];\r\n\tBlendMode.targetFns=[];\r\n\t__static(BlendMode,\r\n\t['NAMES',function(){return this.NAMES=[\"normal\",\"add\",\"multiply\",\"screen\",\"overlay\",\"light\",\"mask\",\"destination-out\"];},'TOINT',function(){return this.TOINT={\"normal\":0,\"add\":1,\"multiply\":2,\"screen\":3 ,\"lighter\":1,\"overlay\":4,\"light\":5,\"mask\":6,\"destination-out\":7};}\r\n\t]);\r\n\treturn BlendMode;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.DrawStyle\r\nvar DrawStyle=(function(){\r\n\tfunction DrawStyle(value){\r\n\t\tthis._color=Color.create(\"black\");\r\n\t\tthis.setValue(value);\r\n\t}\r\n\r\n\t__class(DrawStyle,'laya.webgl.canvas.DrawStyle');\r\n\tvar __proto=DrawStyle.prototype;\r\n\t__proto.setValue=function(value){\r\n\t\tif (value){\r\n\t\t\tif ((typeof value=='string')){\r\n\t\t\t\tthis._color=Color.create(value);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ((value instanceof laya.utils.Color )){\r\n\t\t\t\tthis._color=value;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tthis._color=Color.create(\"black\");\r\n\t}\r\n\r\n\t__proto.equal=function(value){\r\n\t\tif ((typeof value=='string'))return this._color.strColor===value;\r\n\t\tif ((value instanceof laya.utils.Color ))return this._color.numColor===(value).numColor;\r\n\t\treturn false;\r\n\t}\r\n\r\n\t__proto.toColorStr=function(){\r\n\t\treturn this._color.strColor;\r\n\t}\r\n\r\n\tDrawStyle.create=function(value){\r\n\t\tif (value){\r\n\t\t\tvar color;\r\n\t\t\tif ((typeof value=='string'))color=Color.create(value);\r\n\t\t\telse if ((value instanceof laya.utils.Color ))color=value;\r\n\t\t\tif (color){\r\n\t\t\t\treturn color._drawStyle || (color._drawStyle=new DrawStyle(value));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn laya.webgl.canvas.DrawStyle.DEFAULT;\r\n\t}\r\n\r\n\t__static(DrawStyle,\r\n\t['DEFAULT',function(){return this.DEFAULT=new DrawStyle(\"#000000\");}\r\n\t]);\r\n\treturn DrawStyle;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.Path\r\nvar Path=(function(){\r\n\tfunction Path(){\r\n\t\tthis._x=0;\r\n\t\tthis._y=0;\r\n\t\t//this._rect=null;\r\n\t\t//this.ib=null;\r\n\t\t//this.vb=null;\r\n\t\tthis.dirty=false;\r\n\t\t//this.geomatrys=null;\r\n\t\t//this._curGeomatry=null;\r\n\t\tthis.offset=0;\r\n\t\tthis.count=0;\r\n\t\tthis.geoStart=0;\r\n\t\tthis.tempArray=[];\r\n\t\tthis.closePath=false;\r\n\t\tthis.geomatrys=[];\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis.ib=IndexBuffer2D.create(/*laya.webgl.WebGLContext.DYNAMIC_DRAW*/0x88E8);\r\n\t\tthis.vb=VertexBuffer2D.create(5);\r\n\t}\r\n\r\n\t__class(Path,'laya.webgl.canvas.Path');\r\n\tvar __proto=Path.prototype;\r\n\t__proto.addPoint=function(pointX,pointY){\r\n\t\tthis.tempArray.push(pointX,pointY);\r\n\t}\r\n\r\n\t__proto.getEndPointX=function(){\r\n\t\treturn this.tempArray[this.tempArray.length-2];\r\n\t}\r\n\r\n\t__proto.getEndPointY=function(){\r\n\t\treturn this.tempArray[this.tempArray.length-1];\r\n\t}\r\n\r\n\t__proto.polygon=function(x,y,points,color,borderWidth,borderColor){\r\n\t\tvar geo;\r\n\t\tthis.geomatrys.push(this._curGeomatry=geo=new Polygon(x,y,points,color,borderWidth,borderColor));\r\n\t\tif (!color)geo.fill=false;\r\n\t\tif (borderColor==undefined)geo.borderWidth=0;\r\n\t\treturn geo;\r\n\t}\r\n\r\n\t__proto.setGeomtry=function(shape){\r\n\t\tthis.geomatrys.push(this._curGeomatry=shape);\r\n\t}\r\n\r\n\t__proto.drawLine=function(x,y,points,width,color){\r\n\t\tvar geo;\r\n\t\tif (this.closePath){\r\n\t\t\tthis.geomatrys.push(this._curGeomatry=geo=new LoopLine(x,y,points,width,color));\r\n\t\t\t}else {\r\n\t\t\tthis.geomatrys.push(this._curGeomatry=geo=new Line(x,y,points,width,color));\r\n\t\t}\r\n\t\tgeo.fill=false;\r\n\t\treturn geo;\r\n\t}\r\n\r\n\t__proto.update=function(){\r\n\t\tvar si=this.ib._byteLength;\r\n\t\tvar len=this.geomatrys.length;\r\n\t\tthis.offset=si;\r\n\t\tfor (var i=this.geoStart;i < len;i++){\r\n\t\t\tthis.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength / 20);\r\n\t\t}\r\n\t\tthis.geoStart=len;\r\n\t\tthis.count=(this.ib._byteLength-si)/ CONST3D2D.BYTES_PIDX;\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tthis.vb.clear();\r\n\t\tthis.ib.clear();\r\n\t\tthis.offset=this.count=this.geoStart=0;\r\n\t\tthis.geomatrys.length=0;\r\n\t}\r\n\r\n\t__proto.recover=function(){\r\n\t\tthis._curGeomatry=null;\r\n\t\tthis.vb.destory();\r\n\t\tthis.vb=null;\r\n\t\tthis.ib.destory();\r\n\t\tthis.ib=null;\r\n\t}\r\n\r\n\treturn Path;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveBase\r\nvar SaveBase=(function(){\r\n\tfunction SaveBase(){\r\n\t\t//this._valueName=null;\r\n\t\t//this._value=null;\r\n\t\t//this._dataObj=null;\r\n\t\t//this._newSubmit=false;\r\n\t}\r\n\r\n\t__class(SaveBase,'laya.webgl.canvas.save.SaveBase');\r\n\tvar __proto=SaveBase.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){return false;}\r\n\t__proto.restore=function(context){\r\n\t\tthis._dataObj[this._valueName]=this._value;\r\n\t\tSaveBase._cache[SaveBase._cache._length++]=this;\r\n\t\tthis._newSubmit && (context._curSubmit=Submit.RENDERBASE,context._renderKey=0);\r\n\t}\r\n\r\n\tSaveBase._createArray=function(){\r\n\t\tvar value=[];\r\n\t\tvalue._length=0;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tSaveBase._init=function(){\r\n\t\tvar namemap=SaveBase._namemap={};\r\n\t\tnamemap[0x1]=\"ALPHA\";\r\n\t\tnamemap[0x2]=\"fillStyle\";\r\n\t\tnamemap[0x8]=\"font\";\r\n\t\tnamemap[0x100]=\"lineWidth\";\r\n\t\tnamemap[0x200]=\"strokeStyle\";\r\n\t\tnamemap[0x2000]=\"_mergeID\";\r\n\t\tnamemap[0x400]=namemap[0x800]=namemap[0x1000]=[];\r\n\t\tnamemap[0x4000]=\"textBaseline\";\r\n\t\tnamemap[0x8000]=\"textAlign\";\r\n\t\tnamemap[0x10000]=\"_nBlendType\";\r\n\t\tnamemap[0x100000]=\"shader\";\r\n\t\tnamemap[0x200000]=\"filters\";\r\n\t\treturn namemap;\r\n\t}\r\n\r\n\tSaveBase.save=function(context,type,dataObj,newSubmit){\r\n\t\tif ((context._saveMark._saveuse & type)!==type){\r\n\t\t\tcontext._saveMark._saveuse |=type;\r\n\t\t\tvar cache=SaveBase._cache;\r\n\t\t\tvar o=cache._length > 0 ? cache[--cache._length] :(new SaveBase());\r\n\t\t\to._value=dataObj[o._valueName=SaveBase._namemap[type]];\r\n\t\t\to._dataObj=dataObj;\r\n\t\t\to._newSubmit=newSubmit;\r\n\t\t\tvar _save=context._save;\r\n\t\t\t_save[_save._length++]=o;\r\n\t\t}\r\n\t}\r\n\r\n\t__static(SaveBase,\r\n\t['_cache',function(){return this._cache=laya.webgl.canvas.save.SaveBase._createArray();},'_namemap',function(){return this._namemap=SaveBase._init();}\r\n\t]);\r\n\treturn SaveBase;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveClipRect\r\nvar SaveClipRect=(function(){\r\n\tfunction SaveClipRect(){\r\n\t\t//this._clipSaveRect=null;\r\n\t\t//this._submitScissor=null;\r\n\t\tthis._clipRect=new Rectangle();\r\n\t}\r\n\r\n\t__class(SaveClipRect,'laya.webgl.canvas.save.SaveClipRect');\r\n\tvar __proto=SaveClipRect.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){return false;}\r\n\t__proto.restore=function(context){\r\n\t\tcontext._clipRect=this._clipSaveRect;\r\n\t\tSaveClipRect._cache[SaveClipRect._cache._length++]=this;\r\n\t\tthis._submitScissor.submitLength=context._submits._length-this._submitScissor.submitIndex;\r\n\t\tcontext._curSubmit=Submit.RENDERBASE;\r\n\t\tcontext._renderKey=0;\r\n\t}\r\n\r\n\tSaveClipRect.save=function(context,submitScissor){\r\n\t\tif ((context._saveMark._saveuse & /*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT*/0x20000)==/*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT*/0x20000)return;\r\n\t\tcontext._saveMark._saveuse |=/*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT*/0x20000;\r\n\t\tvar cache=SaveClipRect._cache;\r\n\t\tvar o=cache._length > 0 ? cache[--cache._length] :(new SaveClipRect());\r\n\t\to._clipSaveRect=context._clipRect;\r\n\t\tcontext._clipRect=o._clipRect.copyFrom(context._clipRect);\r\n\t\to._submitScissor=submitScissor;\r\n\t\tvar _save=context._save;\r\n\t\t_save[_save._length++]=o;\r\n\t}\r\n\r\n\t__static(SaveClipRect,\r\n\t['_cache',function(){return this._cache=SaveBase._createArray();}\r\n\t]);\r\n\treturn SaveClipRect;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveClipRectStencil\r\nvar SaveClipRectStencil=(function(){\r\n\tfunction SaveClipRectStencil(){\r\n\t\t//this._clipSaveRect=null;\r\n\t\t//this._saveMatrix=null;\r\n\t\tthis._contextX=0;\r\n\t\tthis._contextY=0;\r\n\t\t//this._submitStencil=null;\r\n\t\tthis._clipRect=new Rectangle();\r\n\t\tthis._rect=new Rectangle();\r\n\t\tthis._matrix=new Matrix();\r\n\t}\r\n\r\n\t__class(SaveClipRectStencil,'laya.webgl.canvas.save.SaveClipRectStencil');\r\n\tvar __proto=SaveClipRectStencil.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){return false;}\r\n\t__proto.restore=function(context){\r\n\t\tSubmitStencil.restore(context,this._rect,this._saveMatrix,this._contextX,this._contextY);\r\n\t\tcontext._clipRect=this._clipSaveRect;\r\n\t\tcontext._curMat=this._saveMatrix;\r\n\t\tcontext._x=this._contextX;\r\n\t\tcontext._y=this._contextY;\r\n\t\tSaveClipRectStencil._cache[SaveClipRectStencil._cache._length++]=this;\r\n\t\tcontext._curSubmit=Submit.RENDERBASE;\r\n\t}\r\n\r\n\tSaveClipRectStencil.save=function(context,submitStencil,x,y,width,height,clipX,clipY,clipWidth,clipHeight){\r\n\t\tif ((context._saveMark._saveuse & /*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT_STENCIL*/0x40000)==/*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT_STENCIL*/0x40000)return;\r\n\t\tcontext._saveMark._saveuse |=/*laya.webgl.canvas.save.SaveBase.TYPE_CLIPRECT_STENCIL*/0x40000;\r\n\t\tvar cache=SaveClipRectStencil._cache;\r\n\t\tvar o=cache._length > 0 ? cache[--cache._length] :(new SaveClipRectStencil());\r\n\t\to._clipSaveRect=context._clipRect;\r\n\t\to._clipRect.setTo(clipX,clipY,clipWidth,clipHeight);\r\n\t\tcontext._clipRect=o._clipRect;\r\n\t\to._rect.x=x;\r\n\t\to._rect.y=y;\r\n\t\to._rect.width=width;\r\n\t\to._rect.height=height;\r\n\t\to._contextX=context._x;\r\n\t\to._contextY=context._y;\r\n\t\to._saveMatrix=context._curMat;\r\n\t\tcontext._curMat.copyTo(o._matrix);\r\n\t\tcontext._curMat=o._matrix;\r\n\t\to._submitStencil=submitStencil;\r\n\t\tvar _save=context._save;\r\n\t\t_save[_save._length++]=o;\r\n\t}\r\n\r\n\t__static(SaveClipRectStencil,\r\n\t['_cache',function(){return this._cache=SaveBase._createArray();}\r\n\t]);\r\n\treturn SaveClipRectStencil;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveMark\r\nvar SaveMark=(function(){\r\n\tfunction SaveMark(){\r\n\t\tthis._saveuse=0;\r\n\t\t//this._preSaveMark=null;\r\n\t\t;\r\n\t}\r\n\r\n\t__class(SaveMark,'laya.webgl.canvas.save.SaveMark');\r\n\tvar __proto=SaveMark.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto.restore=function(context){\r\n\t\tcontext._saveMark=this._preSaveMark;\r\n\t\tSaveMark._no[SaveMark._no._length++]=this;\r\n\t}\r\n\r\n\tSaveMark.Create=function(context){\r\n\t\tvar no=SaveMark._no;\r\n\t\tvar o=no._length > 0 ? no[--no._length] :(new SaveMark());\r\n\t\to._saveuse=0;\r\n\t\to._preSaveMark=context._saveMark;\r\n\t\tcontext._saveMark=o;\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SaveMark,\r\n\t['_no',function(){return this._no=SaveBase._createArray();}\r\n\t]);\r\n\treturn SaveMark;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveTransform\r\nvar SaveTransform=(function(){\r\n\tfunction SaveTransform(){\r\n\t\t//this._savematrix=null;\r\n\t\tthis._matrix=new Matrix();\r\n\t}\r\n\r\n\t__class(SaveTransform,'laya.webgl.canvas.save.SaveTransform');\r\n\tvar __proto=SaveTransform.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){return false;}\r\n\t__proto.restore=function(context){\r\n\t\tcontext._curMat=this._savematrix;\r\n\t\tSaveTransform._no[SaveTransform._no._length++]=this;\r\n\t}\r\n\r\n\tSaveTransform.save=function(context){\r\n\t\tvar _saveMark=context._saveMark;\r\n\t\tif ((_saveMark._saveuse & /*laya.webgl.canvas.save.SaveBase.TYPE_TRANSFORM*/0x800)===/*laya.webgl.canvas.save.SaveBase.TYPE_TRANSFORM*/0x800)return;\r\n\t\t_saveMark._saveuse |=/*laya.webgl.canvas.save.SaveBase.TYPE_TRANSFORM*/0x800;\r\n\t\tvar no=SaveTransform._no;\r\n\t\tvar o=no._length > 0 ? no[--no._length] :(new SaveTransform());\r\n\t\to._savematrix=context._curMat;\r\n\t\tcontext._curMat=context._curMat.copyTo(o._matrix);\r\n\t\tvar _save=context._save;\r\n\t\t_save[_save._length++]=o;\r\n\t}\r\n\r\n\t__static(SaveTransform,\r\n\t['_no',function(){return this._no=SaveBase._createArray();}\r\n\t]);\r\n\treturn SaveTransform;\r\n})()\r\n\r\n\r\n//class laya.webgl.canvas.save.SaveTranslate\r\nvar SaveTranslate=(function(){\r\n\tfunction SaveTranslate(){\r\n\t\t//this._x=NaN;\r\n\t\t//this._y=NaN;\r\n\t}\r\n\r\n\t__class(SaveTranslate,'laya.webgl.canvas.save.SaveTranslate');\r\n\tvar __proto=SaveTranslate.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.canvas.save.ISaveData\":true})\r\n\t__proto.isSaveMark=function(){return false;}\r\n\t__proto.restore=function(context){\r\n\t\tvar mat=context._curMat;\r\n\t\tcontext._x=this._x;\r\n\t\tcontext._y=this._y;\r\n\t\tSaveTranslate._no[SaveTranslate._no._length++]=this;\r\n\t}\r\n\r\n\tSaveTranslate.save=function(context){\r\n\t\tvar no=SaveTranslate._no;\r\n\t\tvar o=no._length > 0 ? no[--no._length] :(new SaveTranslate());\r\n\t\to._x=context._x;\r\n\t\to._y=context._y;\r\n\t\tvar _save=context._save;\r\n\t\t_save[_save._length++]=o;\r\n\t}\r\n\r\n\t__static(SaveTranslate,\r\n\t['_no',function(){return this._no=SaveBase._createArray();}\r\n\t]);\r\n\treturn SaveTranslate;\r\n})()\r\n\r\n\r\n//class laya.webgl.resource.RenderTargetMAX\r\nvar RenderTargetMAX=(function(){\r\n\tfunction RenderTargetMAX(){\r\n\t\t//public var targets:Vector.<OneTarget>;//没用到\r\n\t\tthis.target=null;\r\n\t\tthis.repaint=false;\r\n\t\tthis._width=NaN;\r\n\t\tthis._height=NaN;\r\n\t\tthis._sp=null;\r\n\t\tthis._clipRect=new Rectangle();\r\n\t}\r\n\r\n\t__class(RenderTargetMAX,'laya.webgl.resource.RenderTargetMAX');\r\n\tvar __proto=RenderTargetMAX.prototype;\r\n\t__proto.setSP=function(sp){\r\n\t\tthis._sp=sp;\r\n\t}\r\n\r\n\t__proto.size=function(w,h){\r\n\t\tvar _$this=this;\r\n\t\tif (this._width===w && this._height===h){\r\n\t\t\tthis.target.size(w,h);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.repaint=true;\r\n\t\tthis._width=w;\r\n\t\tthis._height=h;\r\n\t\tif (!this.target)\r\n\t\t\tthis.target=RenderTarget2D.create(w,h);\r\n\t\telse\r\n\t\tthis.target.size(w,h);\r\n\t\tif (!this.target.hasListener(/*laya.events.Event.RECOVERED*/\"recovered\")){\r\n\t\t\tthis.target.on(/*laya.events.Event.RECOVERED*/\"recovered\",this,function(e){\r\n\t\t\t\tLaya.timer.callLater(_$this._sp,_$this._sp.repaint);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._flushToTarget=function(context,target){\r\n\t\tif (target._destroy)return;\r\n\t\tvar worldScissorTest=RenderState2D.worldScissorTest;\r\n\t\tvar preworldClipRect=RenderState2D.worldClipRect;\r\n\t\tRenderState2D.worldClipRect=this._clipRect;\r\n\t\tthis._clipRect.x=this._clipRect.y=0;\r\n\t\tthis._clipRect.width=this._width;\r\n\t\tthis._clipRect.height=this._height;\r\n\t\tRenderState2D.worldScissorTest=false;\r\n\t\tWebGL.mainContext.disable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\tvar preAlpha=RenderState2D.worldAlpha;\r\n\t\tvar preMatrix4=RenderState2D.worldMatrix4;\r\n\t\tvar preMatrix=RenderState2D.worldMatrix;\r\n\t\tvar preFilters=RenderState2D.worldFilters;\r\n\t\tvar preShaderDefines=RenderState2D.worldShaderDefines;\r\n\t\tRenderState2D.worldMatrix=Matrix.EMPTY;\r\n\t\tRenderState2D.restoreTempArray();\r\n\t\tRenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY;\r\n\t\tRenderState2D.worldAlpha=1;\r\n\t\tRenderState2D.worldFilters=null;\r\n\t\tRenderState2D.worldShaderDefines=null;\r\n\t\tBaseShader.activeShader=null;\r\n\t\ttarget.start();\r\n\t\tConfig.showCanvasMark ? target.clear(0,1,0,0.3):target.clear(0,0,0,0);\r\n\t\tcontext.flush();\r\n\t\ttarget.end();\r\n\t\tBaseShader.activeShader=null;\r\n\t\tRenderState2D.worldAlpha=preAlpha;\r\n\t\tRenderState2D.worldMatrix4=preMatrix4;\r\n\t\tRenderState2D.worldMatrix=preMatrix;\r\n\t\tRenderState2D.worldFilters=preFilters;\r\n\t\tRenderState2D.worldShaderDefines=preShaderDefines;\r\n\t\tRenderState2D.worldScissorTest=worldScissorTest\r\n\t\tif (worldScissorTest){\r\n\t\t\tvar y=RenderState2D.height-preworldClipRect.y-preworldClipRect.height;\r\n\t\t\tWebGL.mainContext.scissor(preworldClipRect.x,y,preworldClipRect.width,preworldClipRect.height);\r\n\t\t\tWebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t}\r\n\t\tRenderState2D.worldClipRect=preworldClipRect;\r\n\t}\r\n\r\n\t__proto.flush=function(context){\r\n\t\tif (this.repaint){\r\n\t\t\tthis._flushToTarget(context,this.target);\r\n\t\t\tthis.repaint=false;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.drawTo=function(context,x,y,width,height){\r\n\t\tcontext.drawTexture(this.target.getTexture(),x,y,width,height,0,0);\r\n\t}\r\n\r\n\t__proto.destroy=function(){\r\n\t\tif (this.target){\r\n\t\t\tthis.target.destroy();\r\n\t\t\tthis.target=null;\r\n\t\t\tthis._sp=null;\r\n\t\t}\r\n\t}\r\n\r\n\treturn RenderTargetMAX;\r\n})()\r\n\r\n\r\n//class laya.webgl.shader.d2.Shader2D\r\nvar Shader2D=(function(){\r\n\tfunction Shader2D(){\r\n\t\tthis.ALPHA=1;\r\n\t\t//this.glTexture=null;\r\n\t\t//this.shader=null;\r\n\t\t//this.filters=null;\r\n\t\tthis.shaderType=0;\r\n\t\t//this.colorAdd=null;\r\n\t\t//this.strokeStyle=null;\r\n\t\t//this.fillStyle=null;\r\n\t\tthis.defines=new ShaderDefines2D();\r\n\t}\r\n\r\n\t__class(Shader2D,'laya.webgl.shader.d2.Shader2D');\r\n\tvar __proto=Shader2D.prototype;\r\n\t__proto.destroy=function(){\r\n\t\tthis.defines=null;\r\n\t\tthis.filters=null;\r\n\t\tthis.glTexture=null;\r\n\t\tthis.strokeStyle=null;\r\n\t\tthis.fillStyle=null;\r\n\t}\r\n\r\n\tShader2D.__init__=function(){\r\n\t\tShader.addInclude(\"parts/ColorFilter_ps_uniform.glsl\",\"uniform vec4 colorAlpha;\\nuniform mat4 colorMat;\");\r\n\t\tShader.addInclude(\"parts/ColorFilter_ps_logic.glsl\",\"mat4 alphaMat =colorMat;\\n\\nalphaMat[0][3] *= gl_FragColor.a;\\nalphaMat[1][3] *= gl_FragColor.a;\\nalphaMat[2][3] *= gl_FragColor.a;\\n\\ngl_FragColor = gl_FragColor * alphaMat;\\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\\n\");\r\n\t\tShader.addInclude(\"parts/GlowFilter_ps_uniform.glsl\",\"uniform vec4 u_color;\\nuniform float u_strength;\\nuniform float u_blurX;\\nuniform float u_blurY;\\nuniform float u_offsetX;\\nuniform float u_offsetY;\\nuniform float u_textW;\\nuniform float u_textH;\");\r\n\t\tShader.addInclude(\"parts/GlowFilter_ps_logic.glsl\",\"const float c_IterationTime = 10.0;\\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\\nfloat maxNum = u_blurX * u_blurY;\\nvec2 vec2Off = vec2(0.0,0.0);\\nfloat floatOff = c_IterationTime/2.0;\\nfor(float i = 0.0;i<=c_IterationTime; ++i){\\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\\n\t}\\n}\\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\\ngl_FragColor.rgb *= gl_FragColor.a;\");\r\n\t\tShader.addInclude(\"parts/BlurFilter_ps_logic.glsl\",\"gl_FragColor =   blur();\\ngl_FragColor.w*=alpha;\");\r\n\t\tShader.addInclude(\"parts/BlurFilter_ps_uniform.glsl\",\"uniform vec4 strength_sig2_2sig2_gauss1;\\nuniform vec2 blurInfo;\\n\\n#define PI 3.141593\\n\\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\\n//float sig2 = sigma*sigma;\\n//float _2sig2 = 2.0*sig2;\\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\\n//float gauss1 = 1.0/(2.0*PI*sig2);\\n\\nfloat getGaussian(float x, float y){\\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\\n}\\n\\nvec4 blur(){\\n    const float blurw = 9.0;\\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \\n    vec2 startpos=v_texcoord-halfsz;\\n    vec2 ctexcoord = startpos;\\n    vec2 step = 1.0/blurInfo;  //每个像素      \\n    \\n    for(float y = 0.0;y<=blurw; ++y){\\n        ctexcoord.x=startpos.x;\\n        for(float x = 0.0;x<=blurw; ++x){\\n            //TODO 纹理坐标的固定偏移应该在vs中处理\\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\\n            ctexcoord.x+=step.x;\\n        }\\n        ctexcoord.y+=step.y;\\n    }\\n    return vec4Color;\\n}\");\r\n\t\tShader.addInclude(\"parts/ColorAdd_ps_uniform.glsl\",\"uniform vec4 colorAdd;\\n\");\r\n\t\tShader.addInclude(\"parts/ColorAdd_ps_logic.glsl\",\"gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\\ngl_FragColor.xyz *= colorAdd.a;\");\r\n\t\tvar vs,ps;\r\n\t\tvs=\"attribute vec4 position;\\nattribute vec2 texcoord;\\nuniform vec2 size;\\n\\n#ifdef WORLDMAT\\nuniform mat4 mmat;\\n#endif\\nvarying vec2 v_texcoord;\\nvoid main() {\\n  #ifdef WORLDMAT\\n  vec4 pos=mmat*position;\\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\\n  #else\\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\\n  #endif\\n  \\n  v_texcoord = texcoord;\\n}\";\r\n\t\tps=\"precision mediump float;\\n//precision highp float;\\nvarying vec2 v_texcoord;\\nuniform sampler2D texture;\\nuniform float alpha;\\n#include?BLUR_FILTER  \\\"parts/BlurFilter_ps_uniform.glsl\\\";\\n#include?COLOR_FILTER \\\"parts/ColorFilter_ps_uniform.glsl\\\";\\n#include?GLOW_FILTER \\\"parts/GlowFilter_ps_uniform.glsl\\\";\\n#include?COLOR_ADD \\\"parts/ColorAdd_ps_uniform.glsl\\\";\\n\\nvoid main() {\\n   vec4 color= texture2D(texture, v_texcoord);\\n   color.a*=alpha;\\n   color.rgb*=alpha;\\n   gl_FragColor=color;\\n   #include?COLOR_ADD \\\"parts/ColorAdd_ps_logic.glsl\\\";   \\n   #include?BLUR_FILTER  \\\"parts/BlurFilter_ps_logic.glsl\\\";\\n   #include?COLOR_FILTER \\\"parts/ColorFilter_ps_logic.glsl\\\";\\n   #include?GLOW_FILTER \\\"parts/GlowFilter_ps_logic.glsl\\\";\\n}\";\r\n\t\tShader.preCompile2D(0,/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,vs,ps,null);\r\n\t\tvs=\"attribute vec4 position;\\nuniform vec2 size;\\nuniform mat4 mmat;\\nvoid main() {\\n  vec4 pos=mmat*position;\\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\\n}\";\r\n\t\tps=\"precision mediump float;\\nuniform vec4 color;\\nuniform float alpha;\\n#include?COLOR_FILTER \\\"parts/ColorFilter_ps_uniform.glsl\\\";\\nvoid main() {\\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\\n\ta.w = alpha;\\n\ta.xyz *= alpha;\\n\tgl_FragColor = a;\\n\t#include?COLOR_FILTER \\\"parts/ColorFilter_ps_logic.glsl\\\";\\n}\";\r\n\t\tShader.preCompile2D(0,/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,vs,ps,null);\r\n\t\tvs=\"attribute vec4 position;\\nattribute vec3 a_color;\\nuniform mat4 mmat;\\nuniform mat4 u_mmat2;\\nuniform vec2 u_pos;\\nuniform vec2 size;\\nvarying vec3 color;\\nvoid main(){\\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\\n  vec4 pos=mmat*u_mmat2*tPos;\\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\\n  color=a_color;\\n}\";\r\n\t\tps=\"precision mediump float;\\n//precision mediump float;\\nvarying vec3 color;\\nuniform float alpha;\\nvoid main(){\\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\\n\t//a.a*=alpha;\\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\\n\tgl_FragColor.rgb*=alpha;\\n}\";\r\n\t\tShader.preCompile2D(0,/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,vs,ps,null);\r\n\t\tvs=\"attribute vec4 position;\\nattribute vec2 texcoord;\\nuniform vec2 size;\\n\\n#ifdef WORLDMAT\\nuniform mat4 mmat;\\n#endif\\nvarying vec2 v_texcoord;\\nvoid main() {\\n  #ifdef WORLDMAT\\n  vec4 pos=mmat*position;\\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\\n  #else\\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\\n  #endif\\n  \\n  v_texcoord = texcoord;\\n}\";\r\n\t\tps=\"#ifdef FSHIGHPRECISION\\nprecision highp float;\\n#else\\nprecision mediump float;\\n#endif\\n//precision highp float;\\nvarying vec2 v_texcoord;\\nuniform sampler2D texture;\\nuniform float alpha;\\nuniform vec4 u_TexRange;\\nuniform vec2 u_offset;\\n#include?BLUR_FILTER  \\\"parts/BlurFilter_ps_uniform.glsl\\\";\\n#include?COLOR_FILTER \\\"parts/ColorFilter_ps_uniform.glsl\\\";\\n#include?GLOW_FILTER \\\"parts/GlowFilter_ps_uniform.glsl\\\";\\n#include?COLOR_ADD \\\"parts/ColorAdd_ps_uniform.glsl\\\";\\n\\nvoid main() {\\n   vec2 newTexCoord;\\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\\n   vec4 color= texture2D(texture, newTexCoord);\\n   color.a*=alpha;\\n   gl_FragColor=color;\\n   #include?COLOR_ADD \\\"parts/ColorAdd_ps_logic.glsl\\\";   \\n   #include?BLUR_FILTER  \\\"parts/BlurFilter_ps_logic.glsl\\\";\\n   #include?COLOR_FILTER \\\"parts/ColorFilter_ps_logic.glsl\\\";\\n   #include?GLOW_FILTER \\\"parts/GlowFilter_ps_logic.glsl\\\";\\n}\";\r\n\t\tShader.preCompile2D(0,/*laya.webgl.shader.d2.ShaderDefines2D.FILLTEXTURE*/0x100,vs,ps,null);\r\n\t\tvs=\"attribute vec2 position;\\nattribute vec2 texcoord;\\nattribute vec4 color;\\nuniform vec2 size;\\nuniform float offsetX;\\nuniform float offsetY;\\nuniform mat4 mmat;\\nuniform mat4 u_mmat2;\\nvarying vec2 v_texcoord;\\nvarying vec4 v_color;\\nvoid main() {\\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\\n  v_color = color;\\n  v_color.rgb *= v_color.a;\\n  v_texcoord = texcoord;  \\n}\";\r\n\t\tps=\"precision mediump float;\\nvarying vec2 v_texcoord;\\nvarying vec4 v_color;\\nuniform sampler2D texture;\\nuniform float alpha;\\nvoid main() {\\n\tvec4 t_color = texture2D(texture, v_texcoord);\\n\tgl_FragColor = t_color.rgba * v_color;\\n\tgl_FragColor *= alpha;\\n}\";\r\n\t\tShader.preCompile2D(0,/*laya.webgl.shader.d2.ShaderDefines2D.SKINMESH*/0x200,vs,ps,null);\r\n\t}\r\n\r\n\treturn Shader2D;\r\n})()\r\n\r\n\r\n//class laya.webgl.shader.ShaderDefines\r\nvar ShaderDefines=(function(){\r\n\tfunction ShaderDefines(name2int,int2name,int2nameMap){\r\n\t\tthis._value=0;\r\n\t\t//this._name2int=null;\r\n\t\t//this._int2name=null;\r\n\t\t//this._int2nameMap=null;\r\n\t\tthis._name2int=name2int;\r\n\t\tthis._int2name=int2name;\r\n\t\tthis._int2nameMap=int2nameMap;\r\n\t}\r\n\r\n\t__class(ShaderDefines,'laya.webgl.shader.ShaderDefines');\r\n\tvar __proto=ShaderDefines.prototype;\r\n\t__proto.add=function(value){\r\n\t\tif ((typeof value=='string'))value=this._name2int[value];\r\n\t\tthis._value |=value;\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t__proto.addInt=function(value){\r\n\t\tthis._value |=value;\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t__proto.remove=function(value){\r\n\t\tif ((typeof value=='string'))value=this._name2int[value];\r\n\t\tthis._value &=(~value);\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t__proto.isDefine=function(def){\r\n\t\treturn (this._value & def)===def;\r\n\t}\r\n\r\n\t__proto.getValue=function(){\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t__proto.setValue=function(value){\r\n\t\tthis._value=value;\r\n\t}\r\n\r\n\t__proto.toNameDic=function(){\r\n\t\tvar r=this._int2nameMap[this._value];\r\n\t\treturn r ? r :ShaderDefines._toText(this._value,this._int2name,this._int2nameMap);\r\n\t}\r\n\r\n\tShaderDefines._reg=function(name,value,_name2int,_int2name){\r\n\t\t_name2int[name]=value;\r\n\t\t_int2name[value]=name;\r\n\t}\r\n\r\n\tShaderDefines._toText=function(value,_int2name,_int2nameMap){\r\n\t\tvar r=_int2nameMap[value];\r\n\t\tif (r)return r;\r\n\t\tvar o={};\r\n\t\tvar d=1;\r\n\t\tfor (var i=0;i < 32;i++){\r\n\t\t\td=1 << i;\r\n\t\t\tif (d > value)break ;\r\n\t\t\tif (value & d){\r\n\t\t\t\tvar name=_int2name[d];\r\n\t\t\t\tname && (o[name]=\"\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t_int2nameMap[value]=o;\r\n\t\treturn o;\r\n\t}\r\n\r\n\tShaderDefines._toInt=function(names,_name2int){\r\n\t\tvar words=names.split('.');\r\n\t\tvar num=0;\r\n\t\tfor (var i=0,n=words.length;i < n;i++){\r\n\t\t\tvar value=_name2int[words[i]];\r\n\t\t\tif (!value)throw new Error(\"Defines to int err:\"+names+\"/\"+words[i]);\r\n\t\t\tnum |=value;\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n\r\n\treturn ShaderDefines;\r\n})()\r\n\r\n\r\n/**\r\n*这里销毁的问题，后面待确认\r\n*/\r\n//class laya.webgl.shader.d2.skinAnishader.SkinMesh\r\nvar SkinMesh=(function(){\r\n\tfunction SkinMesh(){\r\n\t\tthis.mVBBuffer=null;\r\n\t\tthis.mIBBuffer=null;\r\n\t\tthis.mVBData=null;\r\n\t\tthis.mIBData=null;\r\n\t\tthis.mEleNum=0;\r\n\t\tthis.mTexture=null;\r\n\t\tthis.transform=null;\r\n\t\tthis._vs=null;\r\n\t\tthis._ps=null;\r\n\t\tthis._indexStart=-1;\r\n\t\tthis._verticles=null;\r\n\t\tthis._uvs=null;\r\n\t\tthis._tempMatrix=new Matrix();\r\n\t}\r\n\r\n\t__class(SkinMesh,'laya.webgl.shader.d2.skinAnishader.SkinMesh');\r\n\tvar __proto=SkinMesh.prototype;\r\n\t__proto.init=function(texture,vs,ps){\r\n\t\tif (vs){\r\n\t\t\tthis._vs=vs;\r\n\t\t\t}else {\r\n\t\t\tthis._vs=[];\r\n\t\t\tvar tWidth=texture.width;\r\n\t\t\tvar tHeight=texture.height;\r\n\t\t\tvar tRed=1;\r\n\t\t\tvar tGreed=1;\r\n\t\t\tvar tBlue=1;\r\n\t\t\tvar tAlpha=1;\r\n\t\t\tthis._vs.push(0,0,0,0,tRed,tGreed,tBlue,tAlpha);\r\n\t\t\tthis._vs.push(tWidth,0,1,0,tRed,tGreed,tBlue,tAlpha);\r\n\t\t\tthis._vs.push(tWidth,tHeight,1,1,tRed,tGreed,tBlue,tAlpha);\r\n\t\t\tthis._vs.push(0,tHeight,0,1,tRed,tGreed,tBlue,tAlpha);\r\n\t\t}\r\n\t\tif (ps){\r\n\t\t\tthis._ps=ps;\r\n\t\t\t}else {\r\n\t\t\tif (!SkinMesh._defaultPS){\r\n\t\t\t\tSkinMesh._defaultPS=[];\r\n\t\t\t\tSkinMesh._defaultPS.push(0,1,3,3,1,2);\r\n\t\t\t}\r\n\t\t\tthis._ps=SkinMesh._defaultPS;\r\n\t\t}\r\n\t\tthis.mVBData=new Float32Array(this._vs);\r\n\t\tthis.mIBData=new Uint16Array(this._ps.length);\r\n\t\tthis.mIBData[\"start\"]=-1;\r\n\t\tthis.mEleNum=this._ps.length;\r\n\t\tthis.mTexture=texture;\r\n\t}\r\n\r\n\t__proto.init2=function(texture,vs,ps,verticles,uvs){\r\n\t\tif (this.transform)this.transform=null;\r\n\t\tif (ps){\r\n\t\t\tthis._ps=ps;\r\n\t\t\t}else {\r\n\t\t\tthis._ps=[];\r\n\t\t\tthis._ps.push(0,1,3,3,1,2);\r\n\t\t}\r\n\t\tthis._verticles=verticles;\r\n\t\tthis._uvs=uvs;\r\n\t\tthis.mEleNum=this._ps.length;\r\n\t\tthis.mTexture=texture;\r\n\t\tif (Render.isConchNode || Render.isConchApp){\r\n\t\t\tthis._initMyData();\r\n\t\t\tthis.mVBData=new Float32Array(this._vs);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._initMyData=function(){\r\n\t\tvar vsI=0;\r\n\t\tvar vI=0;\r\n\t\tvar vLen=this._verticles.length;\r\n\t\tvar tempVLen=vLen *4;\r\n\t\tthis._vs=SkinMesh._tempVS;\r\n\t\tvar insertNew=false;\r\n\t\tif (Render.isConchNode || Render.isConchApp){\r\n\t\t\tthis._vs.length=tempVLen;\r\n\t\t\tinsertNew=true;\r\n\t\t\t}else{\r\n\t\t\tif (this._vs.length < tempVLen){\r\n\t\t\t\tthis._vs.length=tempVLen;\r\n\t\t\t\tinsertNew=true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tSkinMesh._tVSLen=tempVLen;\r\n\t\tif (insertNew){\r\n\t\t\twhile (vsI < tempVLen){\r\n\t\t\t\tthis._vs[vsI]=this._verticles[vI];\r\n\t\t\t\tthis._vs[vsI+1]=this._verticles[vI+1];\r\n\t\t\t\tthis._vs[vsI+2]=this._uvs[vI];\r\n\t\t\t\tthis._vs[vsI+3]=this._uvs[vI+1];\r\n\t\t\t\tthis._vs[vsI+4]=1;\r\n\t\t\t\tthis._vs[vsI+5]=1;\r\n\t\t\t\tthis._vs[vsI+6]=1;\r\n\t\t\t\tthis._vs[vsI+7]=1;\r\n\t\t\t\tvsI+=8;\r\n\t\t\t\tvI+=2;\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t\twhile (vsI < tempVLen){\r\n\t\t\t\tthis._vs[vsI]=this._verticles[vI];\r\n\t\t\t\tthis._vs[vsI+1]=this._verticles[vI+1];\r\n\t\t\t\tthis._vs[vsI+2]=this._uvs[vI];\r\n\t\t\t\tthis._vs[vsI+3]=this._uvs[vI+1];\r\n\t\t\t\tvsI+=8;\r\n\t\t\t\tvI+=2;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getData2=function(vb,ib,start){\r\n\t\tthis.mVBBuffer=vb;\r\n\t\tthis.mIBBuffer=ib;\r\n\t\tthis._initMyData();\r\n\t\tvb.appendEx2(this._vs,Float32Array,SkinMesh._tVSLen,4);\r\n\t\tthis._indexStart=ib._byteLength;\r\n\t\tvar tIB;\r\n\t\ttIB=SkinMesh._tempIB;\r\n\t\tif (tIB.length < this._ps.length){\r\n\t\t\ttIB.length=this._ps.length;\r\n\t\t}\r\n\t\tfor (var i=0,n=this._ps.length;i < n;i++){\r\n\t\t\ttIB[i]=this._ps[i]+start;\r\n\t\t}\r\n\t\tib.appendEx2(tIB,Uint16Array,this._ps.length,2);\r\n\t}\r\n\r\n\t__proto.getData=function(vb,ib,start){\r\n\t\tthis.mVBBuffer=vb;\r\n\t\tthis.mIBBuffer=ib;\r\n\t\tvb.append(this.mVBData);\r\n\t\tthis._indexStart=ib._byteLength;\r\n\t\tif (this.mIBData[\"start\"] !=start){\r\n\t\t\tfor (var i=0,n=this._ps.length;i < n;i++){\r\n\t\t\t\tthis.mIBData[i]=this._ps[i]+start;\r\n\t\t\t}\r\n\t\t\tthis.mIBData[\"start\"]=start;\r\n\t\t}\r\n\t\tib.append(this.mIBData);\r\n\t}\r\n\r\n\t__proto.render=function(context,x,y){\r\n\t\tif (Render.isWebGL && this.mTexture){\r\n\t\t\tcontext._renderKey=0;\r\n\t\t\tcontext._shader2D.glTexture=null;\r\n\t\t\tSkinMeshBuffer.getInstance().addSkinMesh(this);\r\n\t\t\tvar tempSubmit=Submit.createShape(context,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.SKINMESH*/0x200,0));\r\n\t\t\tthis.transform || (this.transform=Matrix.EMPTY);\r\n\t\t\tthis.transform.translate(x,y);\r\n\t\t\tMatrix.mul(this.transform,context._curMat,this._tempMatrix);\r\n\t\t\tthis.transform.translate(-x,-y);\r\n\t\t\tvar tShaderValue=tempSubmit.shaderValue;\r\n\t\t\tvar tArray=tShaderValue.u_mmat2||RenderState2D.getMatrArray();\r\n\t\t\tRenderState2D.mat2MatArray(this._tempMatrix,tArray);\r\n\t\t\ttShaderValue.textureHost=this.mTexture;\r\n\t\t\ttShaderValue.offsetX=0;\r\n\t\t\ttShaderValue.offsetY=0;\r\n\t\t\ttShaderValue.u_mmat2=tArray;\r\n\t\t\ttShaderValue.ALPHA=context._shader2D.ALPHA;\r\n\t\t\tcontext._submits[context._submits._length++]=tempSubmit;\r\n\t\t}\r\n\t\telse if (Render.isConchApp&&this.mTexture){\r\n\t\t\tthis.transform || (this.transform=Matrix.EMPTY);\r\n\t\t\tcontext.setSkinMesh&&context.setSkinMesh(x,y,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform);\r\n\t\t}\r\n\t}\r\n\r\n\tSkinMesh._tempVS=[];\r\n\tSkinMesh._tempIB=[];\r\n\tSkinMesh._defaultPS=null;\r\n\tSkinMesh._tVSLen=0;\r\n\treturn SkinMesh;\r\n})()\r\n\r\n\r\n//class laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer\r\nvar SkinMeshBuffer=(function(){\r\n\tfunction SkinMeshBuffer(){\r\n\t\tthis.ib=null;\r\n\t\tthis.vb=null;\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis.ib=IndexBuffer2D.create(/*laya.webgl.WebGLContext.DYNAMIC_DRAW*/0x88E8);\r\n\t\tthis.vb=VertexBuffer2D.create(8);\r\n\t}\r\n\r\n\t__class(SkinMeshBuffer,'laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer');\r\n\tvar __proto=SkinMeshBuffer.prototype;\r\n\t__proto.addSkinMesh=function(skinMesh){\r\n\t\tskinMesh.getData2(this.vb,this.ib,this.vb._byteLength / 32);\r\n\t}\r\n\r\n\t__proto.reset=function(){\r\n\t\tthis.vb.clear();\r\n\t\tthis.ib.clear();\r\n\t}\r\n\r\n\tSkinMeshBuffer.getInstance=function(){\r\n\t\treturn SkinMeshBuffer.instance=SkinMeshBuffer.instance|| new SkinMeshBuffer();\r\n\t}\r\n\r\n\tSkinMeshBuffer.instance=null;\r\n\treturn SkinMeshBuffer;\r\n})()\r\n\r\n\r\n//此类可以减少代码\r\n//class laya.webgl.shapes.BasePoly\r\nvar BasePoly=(function(){\r\n\tfunction BasePoly(x,y,width,height,edges,color,borderWidth,borderColor,round){\r\n\t\t//this.x=NaN;\r\n\t\t//this.y=NaN;\r\n\t\t//this.r=NaN;\r\n\t\t//this.width=NaN;\r\n\t\t//this.height=NaN;\r\n\t\t//this.edges=NaN;\r\n\t\tthis.r0=0\r\n\t\t//this.color=0;\r\n\t\t//this.borderColor=NaN;\r\n\t\t//this.borderWidth=NaN;\r\n\t\t//this.round=0;\r\n\t\tthis.fill=true;\r\n\t\t//this.mUint16Array=null;\r\n\t\t//this.mFloat32Array=null;\r\n\t\tthis.r1=Math.PI / 2;\r\n\t\t(round===void 0)&& (round=0);\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t\tthis.width=width;\r\n\t\tthis.height=height;\r\n\t\tthis.edges=edges;\r\n\t\tthis.color=color;\r\n\t\tthis.borderWidth=borderWidth;\r\n\t\tthis.borderColor=borderColor;\r\n\t}\r\n\r\n\t__class(BasePoly,'laya.webgl.shapes.BasePoly');\r\n\tvar __proto=BasePoly.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.shapes.IShape\":true})\r\n\t__proto.getData=function(ib,vb,start){}\r\n\t__proto.rebuild=function(points){}\r\n\t__proto.setMatrix=function(mat){}\r\n\t__proto.needUpdate=function(mat){\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto.sector=function(outVert,outIndex,start){\r\n\t\tvar x=this.x,y=this.y,edges=this.edges,seg=(this.r1-this.r0)/ edges;\r\n\t\tvar w=this.width,h=this.height,color=this.color;\r\n\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\toutVert.push(x,y,r,g,b);\r\n\t\tfor (var i=0;i < edges+1;i++){\r\n\t\t\toutVert.push(x+Math.sin(seg *i+this.r0)*w,y+Math.cos(seg *i+this.r0)*h);\r\n\t\t\toutVert.push(r,g,b);\r\n\t\t}\r\n\t\tfor (i=0;i < edges;i++){\r\n\t\t\toutIndex.push(start,start+i+1,start+i+2);\r\n\t\t}\r\n\t}\r\n\r\n\t//用于画线\r\n\t__proto.createLine2=function(p,indices,lineWidth,len,outVertex,indexCount){\r\n\t\tvar points=p.concat();\r\n\t\tvar result=outVertex;\r\n\t\tvar color=this.borderColor;\r\n\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\tvar length=points.length / 2;\r\n\t\tvar iStart=len,w=lineWidth / 2;\r\n\t\tvar px,py,p1x,p1y,p2x,p2y,p3x,p3y;\r\n\t\tvar perpx,perpy,perp2x,perp2y,perp3x,perp3y;\r\n\t\tvar a1,b1,c1,a2,b2,c2;\r\n\t\tvar denom,pdist,dist;\r\n\t\tp1x=points[0];\r\n\t\tp1y=points[1];\r\n\t\tp2x=points[2];\r\n\t\tp2y=points[3];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p1x-perpx+this.x,p1y-perpy+this.y,r,g,b,p1x+perpx+this.x,p1y+perpy+this.y,r,g,b);\r\n\t\tfor (var i=1;i < length-1;i++){\r\n\t\t\tp1x=points[(i-1)*2];\r\n\t\t\tp1y=points[(i-1)*2+1];\r\n\t\t\tp2x=points[(i)*2];\r\n\t\t\tp2y=points[(i)*2+1];\r\n\t\t\tp3x=points[(i+1)*2];\r\n\t\t\tp3y=points[(i+1)*2+1];\r\n\t\t\tperpx=-(p1y-p2y);\r\n\t\t\tperpy=p1x-p2x;\r\n\t\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\t\tperpx=perpx / dist *w;\r\n\t\t\tperpy=perpy / dist *w;\r\n\t\t\tperp2x=-(p2y-p3y);\r\n\t\t\tperp2y=p2x-p3x;\r\n\t\t\tdist=Math.sqrt(perp2x *perp2x+perp2y *perp2y);\r\n\t\t\tperp2x=perp2x / dist *w;\r\n\t\t\tperp2y=perp2y / dist *w;\r\n\t\t\ta1=(-perpy+p1y)-(-perpy+p2y);\r\n\t\t\tb1=(-perpx+p2x)-(-perpx+p1x);\r\n\t\t\tc1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);\r\n\t\t\ta2=(-perp2y+p3y)-(-perp2y+p2y);\r\n\t\t\tb2=(-perp2x+p2x)-(-perp2x+p3x);\r\n\t\t\tc2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);\r\n\t\t\tdenom=a1 *b2-a2 *b1;\r\n\t\t\tif (Math.abs(denom)< 0.1){\r\n\t\t\t\tdenom+=10.1;\r\n\t\t\t\tresult.push(p2x-perpx+this.x,p2y-perpy+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tpx=(b1 *c2-b2 *c1)/ denom;\r\n\t\t\tpy=(a2 *c1-a1 *c2)/ denom;\r\n\t\t\tpdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);\r\n\t\t\tresult.push(px+this.x,py+this.y,r,g,b,p2x-(px-p2x)+this.x,p2y-(py-p2y)+this.y,r,g,b);\r\n\t\t}\r\n\t\tp1x=points[points.length-4];\r\n\t\tp1y=points[points.length-3];\r\n\t\tp2x=points[points.length-2];\r\n\t\tp2y=points[points.length-1];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p2x-perpx+this.x,p2y-perpy+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b);\r\n\t\tvar groupLen=indexCount;\r\n\t\tfor (i=1;i < groupLen;i++){\r\n\t\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i *2+1,iStart+i *2+1,iStart+i *2,iStart+(i-1)*2);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// /*,outVertex:Array,outIndex:Array*/\r\n\t__proto.createLine=function(p,indices,lineWidth,len){\r\n\t\tvar points=p.concat();\r\n\t\tvar result=p;\r\n\t\tvar color=this.borderColor;\r\n\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\tpoints.splice(0,5);\r\n\t\tvar length=points.length / 5;\r\n\t\tvar iStart=len,w=lineWidth / 2;\r\n\t\tvar px,py,p1x,p1y,p2x,p2y,p3x,p3y;\r\n\t\tvar perpx,perpy,perp2x,perp2y,perp3x,perp3y;\r\n\t\tvar a1,b1,c1,a2,b2,c2;\r\n\t\tvar denom,pdist,dist;\r\n\t\tp1x=points[0];\r\n\t\tp1y=points[1];\r\n\t\tp2x=points[5];\r\n\t\tp2y=points[6];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);\r\n\t\tfor (var i=1;i < length-1;i++){\r\n\t\t\tp1x=points[(i-1)*5];\r\n\t\t\tp1y=points[(i-1)*5+1];\r\n\t\t\tp2x=points[(i)*5];\r\n\t\t\tp2y=points[(i)*5+1];\r\n\t\t\tp3x=points[(i+1)*5];\r\n\t\t\tp3y=points[(i+1)*5+1];\r\n\t\t\tperpx=-(p1y-p2y);\r\n\t\t\tperpy=p1x-p2x;\r\n\t\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\t\tperpx=perpx / dist *w;\r\n\t\t\tperpy=perpy / dist *w;\r\n\t\t\tperp2x=-(p2y-p3y);\r\n\t\t\tperp2y=p2x-p3x;\r\n\t\t\tdist=Math.sqrt(perp2x *perp2x+perp2y *perp2y);\r\n\t\t\tperp2x=perp2x / dist *w;\r\n\t\t\tperp2y=perp2y / dist *w;\r\n\t\t\ta1=(-perpy+p1y)-(-perpy+p2y);\r\n\t\t\tb1=(-perpx+p2x)-(-perpx+p1x);\r\n\t\t\tc1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);\r\n\t\t\ta2=(-perp2y+p3y)-(-perp2y+p2y);\r\n\t\t\tb2=(-perp2x+p2x)-(-perp2x+p3x);\r\n\t\t\tc2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);\r\n\t\t\tdenom=a1 *b2-a2 *b1;\r\n\t\t\tif (Math.abs(denom)< 0.1){\r\n\t\t\t\tdenom+=10.1;\r\n\t\t\t\tresult.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tpx=(b1 *c2-b2 *c1)/ denom;\r\n\t\t\tpy=(a2 *c1-a1 *c2)/ denom;\r\n\t\t\tpdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);\r\n\t\t\tresult.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);\r\n\t\t}\r\n\t\tp1x=points[points.length-10];\r\n\t\tp1y=points[points.length-9];\r\n\t\tp2x=points[points.length-5];\r\n\t\tp2y=points[points.length-4];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);\r\n\t\tvar groupLen=this.edges+1;\r\n\t\tfor (i=1;i < groupLen;i++){\r\n\t\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i *2+1,iStart+i *2+1,iStart+i *2,iStart+(i-1)*2);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//闭合路径\r\n\t__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){\r\n\t\tvar points=p.concat();\r\n\t\tvar result=outVertex ? outVertex :p;\r\n\t\tvar color=this.borderColor;\r\n\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\tpoints.splice(0,5);\r\n\t\tvar firstPoint=[points[0],points[1]];\r\n\t\tvar lastPoint=[points[points.length-5],points[points.length-4]];\r\n\t\tvar midPointX=lastPoint[0]+(firstPoint[0]-lastPoint[0])*0.5;\r\n\t\tvar midPointY=lastPoint[1]+(firstPoint[1]-lastPoint[1])*0.5;\r\n\t\tpoints.unshift(midPointX,midPointY,0,0,0);\r\n\t\tpoints.push(midPointX,midPointY,0,0,0);\r\n\t\tvar length=points.length / 5;\r\n\t\tvar iStart=len,w=lineWidth / 2;\r\n\t\tvar px,py,p1x,p1y,p2x,p2y,p3x,p3y;\r\n\t\tvar perpx,perpy,perp2x,perp2y,perp3x,perp3y;\r\n\t\tvar a1,b1,c1,a2,b2,c2;\r\n\t\tvar denom,pdist,dist;\r\n\t\tp1x=points[0];\r\n\t\tp1y=points[1];\r\n\t\tp2x=points[5];\r\n\t\tp2y=points[6];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);\r\n\t\tfor (var i=1;i < length-1;i++){\r\n\t\t\tp1x=points[(i-1)*5];\r\n\t\t\tp1y=points[(i-1)*5+1];\r\n\t\t\tp2x=points[(i)*5];\r\n\t\t\tp2y=points[(i)*5+1];\r\n\t\t\tp3x=points[(i+1)*5];\r\n\t\t\tp3y=points[(i+1)*5+1];\r\n\t\t\tperpx=-(p1y-p2y);\r\n\t\t\tperpy=p1x-p2x;\r\n\t\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\t\tperpx=perpx / dist *w;\r\n\t\t\tperpy=perpy / dist *w;\r\n\t\t\tperp2x=-(p2y-p3y);\r\n\t\t\tperp2y=p2x-p3x;\r\n\t\t\tdist=Math.sqrt(perp2x *perp2x+perp2y *perp2y);\r\n\t\t\tperp2x=perp2x / dist *w;\r\n\t\t\tperp2y=perp2y / dist *w;\r\n\t\t\ta1=(-perpy+p1y)-(-perpy+p2y);\r\n\t\t\tb1=(-perpx+p2x)-(-perpx+p1x);\r\n\t\t\tc1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);\r\n\t\t\ta2=(-perp2y+p3y)-(-perp2y+p2y);\r\n\t\t\tb2=(-perp2x+p2x)-(-perp2x+p3x);\r\n\t\t\tc2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);\r\n\t\t\tdenom=a1 *b2-a2 *b1;\r\n\t\t\tif (Math.abs(denom)< 0.1){\r\n\t\t\t\tdenom+=10.1;\r\n\t\t\t\tresult.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tpx=(b1 *c2-b2 *c1)/ denom;\r\n\t\t\tpy=(a2 *c1-a1 *c2)/ denom;\r\n\t\t\tpdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);\r\n\t\t\tresult.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);\r\n\t\t}\r\n\t\tif (outIndex){\r\n\t\t\tindices=outIndex;\r\n\t\t};\r\n\t\tvar groupLen=this.edges+1;\r\n\t\tfor (i=1;i < groupLen;i++){\r\n\t\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i *2+1,iStart+i *2+1,iStart+i *2,iStart+(i-1)*2);\r\n\t\t}\r\n\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+1,iStart+1,iStart,iStart+(i-1)*2);\r\n\t\treturn result;\r\n\t}\r\n\r\n\treturn BasePoly;\r\n})()\r\n\r\n\r\n//class laya.webgl.shapes.Earcut\r\nvar Earcut=(function(){\r\n\tfunction Earcut(){}\r\n\t__class(Earcut,'laya.webgl.shapes.Earcut');\r\n\tEarcut.earcut=function(data,holeIndices,dim){\r\n\t\tdim=dim || 2;\r\n\t\tvar hasHoles=holeIndices && holeIndices.length,\r\n\t\touterLen=hasHoles ? holeIndices[0] *dim :data.length,\r\n\t\touterNode=Earcut.linkedList(data,0,outerLen,dim,true),\r\n\t\ttriangles=[];\r\n\t\tif (!outerNode)return triangles;\r\n\t\tvar minX,minY,maxX,maxY,x,y,invSize;\r\n\t\tif (hasHoles)outerNode=Earcut.eliminateHoles(data,holeIndices,outerNode,dim);\r\n\t\tif (data.length > 80 *dim){\r\n\t\t\tminX=maxX=data[0];\r\n\t\t\tminY=maxY=data[1];\r\n\t\t\tfor (var i=dim;i < outerLen;i+=dim){\r\n\t\t\t\tx=data[i];\r\n\t\t\t\ty=data[i+1];\r\n\t\t\t\tif (x < minX)minX=x;\r\n\t\t\t\tif (y < minY)minY=y;\r\n\t\t\t\tif (x > maxX)maxX=x;\r\n\t\t\t\tif (y > maxY)maxY=y;\r\n\t\t\t}\r\n\t\t\tinvSize=Math.max(maxX-minX,maxY-minY);\r\n\t\t\tinvSize=invSize!==0 ? 1 / invSize :0;\r\n\t\t}\r\n\t\tEarcut.earcutLinked(outerNode,triangles,dim,minX,minY,invSize);\r\n\t\treturn triangles;\r\n\t}\r\n\r\n\tEarcut.linkedList=function(data,start,end,dim,clockwise){\r\n\t\tvar i,last;\r\n\t\tif (clockwise===(Earcut.signedArea(data,start,end,dim)> 0)){\r\n\t\t\tfor (i=start;i < end;i+=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);\r\n\t\t\t}else {\r\n\t\t\tfor (i=end-dim;i >=start;i-=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);\r\n\t\t}\r\n\t\tif (last && Earcut.equals(last,last.next)){\r\n\t\t\tEarcut.removeNode(last);\r\n\t\t\tlast=last.next;\r\n\t\t}\r\n\t\treturn last;\r\n\t}\r\n\r\n\tEarcut.filterPoints=function(start,end){\r\n\t\tif (!start)return start;\r\n\t\tif (!end)end=start;\r\n\t\tvar p=start,\r\n\t\tagain;\r\n\t\tdo {\r\n\t\t\tagain=false;\r\n\t\t\tif (!p.steiner && (Earcut.equals(p,p.next)|| Earcut.area(p.prev,p,p.next)===0)){\r\n\t\t\t\tEarcut.removeNode(p);\r\n\t\t\t\tp=end=p.prev;\r\n\t\t\t\tif (p===p.next)break ;\r\n\t\t\t\tagain=true;\r\n\t\t\t\t}else {\r\n\t\t\t\tp=p.next;\r\n\t\t\t}\r\n\t\t}while (again || p!==end);\r\n\t\treturn end;\r\n\t}\r\n\r\n\tEarcut.earcutLinked=function(ear,triangles,dim,minX,minY,invSize,pass){\r\n\t\tif (!ear)return;\r\n\t\tif (!pass && invSize)Earcut.indexCurve(ear,minX,minY,invSize);\r\n\t\tvar stop=ear,\r\n\t\tprev,next;\r\n\t\twhile (ear.prev!==ear.next){\r\n\t\t\tprev=ear.prev;\r\n\t\t\tnext=ear.next;\r\n\t\t\tif (invSize ? Earcut.isEarHashed(ear,minX,minY,invSize):Earcut.isEar(ear)){\r\n\t\t\t\ttriangles.push(prev.i / dim);\r\n\t\t\t\ttriangles.push(ear.i / dim);\r\n\t\t\t\ttriangles.push(next.i / dim);\r\n\t\t\t\tEarcut.removeNode(ear);\r\n\t\t\t\tear=next.next;\r\n\t\t\t\tstop=next.next;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tear=next;\r\n\t\t\tif (ear===stop){\r\n\t\t\t\tif (!pass){\r\n\t\t\t\t\tEarcut.earcutLinked(Earcut.filterPoints(ear,null),triangles,dim,minX,minY,invSize,1);\r\n\t\t\t\t\t}else if (pass===1){\r\n\t\t\t\t\tear=Earcut.cureLocalIntersections(ear,triangles,dim);\r\n\t\t\t\t\tEarcut.earcutLinked(ear,triangles,dim,minX,minY,invSize,2);\r\n\t\t\t\t\t}else if (pass===2){\r\n\t\t\t\t\tEarcut.splitEarcut(ear,triangles,dim,minX,minY,invSize);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tEarcut.isEar=function(ear){\r\n\t\tvar a=ear.prev,\r\n\t\tb=ear,\r\n\t\tc=ear.next;\r\n\t\tif (Earcut.area(a,b,c)>=0)return false;\r\n\t\tvar p=ear.next.next;\r\n\t\twhile (p!==ear.prev){\r\n\t\t\tif (Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\r\n\t\t\t\tEarcut.area(p.prev,p,p.next)>=0)return false;\r\n\t\t\tp=p.next;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tEarcut.isEarHashed=function(ear,minX,minY,invSize){\r\n\t\tvar a=ear.prev,\r\n\t\tb=ear,\r\n\t\tc=ear.next;\r\n\t\tif (Earcut.area(a,b,c)>=0)return false;\r\n\t\tvar minTX=a.x < b.x ? (a.x < c.x ? a.x :c.x):(b.x < c.x ? b.x :c.x),\r\n\t\tminTY=a.y < b.y ? (a.y < c.y ? a.y :c.y):(b.y < c.y ? b.y :c.y),\r\n\t\tmaxTX=a.x > b.x ? (a.x > c.x ? a.x :c.x):(b.x > c.x ? b.x :c.x),\r\n\t\tmaxTY=a.y > b.y ? (a.y > c.y ? a.y :c.y):(b.y > c.y ? b.y :c.y);\r\n\t\tvar minZ=Earcut.zOrder(minTX,minTY,minX,minY,invSize),\r\n\t\tmaxZ=Earcut.zOrder(maxTX,maxTY,minX,minY,invSize);\r\n\t\tvar p=ear.nextZ;\r\n\t\twhile (p && p.z <=maxZ){\r\n\t\t\tif (p!==ear.prev && p!==ear.next &&\r\n\t\t\t\tEarcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\r\n\t\t\tEarcut.area(p.prev,p,p.next)>=0)return false;\r\n\t\t\tp=p.nextZ;\r\n\t\t}\r\n\t\tp=ear.prevZ;\r\n\t\twhile (p && p.z >=minZ){\r\n\t\t\tif (p!==ear.prev && p!==ear.next &&\r\n\t\t\t\tEarcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&\r\n\t\t\tEarcut.area(p.prev,p,p.next)>=0)return false;\r\n\t\t\tp=p.prevZ;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tEarcut.cureLocalIntersections=function(start,triangles,dim){\r\n\t\tvar p=start;\r\n\t\tdo {\r\n\t\t\tvar a=p.prev,\r\n\t\t\tb=p.next.next;\r\n\t\t\tif (!Earcut.equals(a,b)&& Earcut.intersects(a,p,p.next,b)&& Earcut.locallyInside(a,b)&& Earcut.locallyInside(b,a)){\r\n\t\t\t\ttriangles.push(a.i / dim);\r\n\t\t\t\ttriangles.push(p.i / dim);\r\n\t\t\t\ttriangles.push(b.i / dim);\r\n\t\t\t\tEarcut.removeNode(p);\r\n\t\t\t\tEarcut.removeNode(p.next);\r\n\t\t\t\tp=start=b;\r\n\t\t\t}\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==start);\r\n\t\treturn p;\r\n\t}\r\n\r\n\tEarcut.splitEarcut=function(start,triangles,dim,minX,minY,invSize){\r\n\t\tvar a=start;\r\n\t\tdo {\r\n\t\t\tvar b=a.next.next;\r\n\t\t\twhile (b!==a.prev){\r\n\t\t\t\tif (a.i!==b.i && Earcut.isValidDiagonal(a,b)){\r\n\t\t\t\t\tvar c=Earcut.splitPolygon(a,b);\r\n\t\t\t\t\ta=Earcut.filterPoints(a,a.next);\r\n\t\t\t\t\tc=Earcut.filterPoints(c,c.next);\r\n\t\t\t\t\tEarcut.earcutLinked(a,triangles,dim,minX,minY,invSize);\r\n\t\t\t\t\tEarcut.earcutLinked(c,triangles,dim,minX,minY,invSize);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tb=b.next;\r\n\t\t\t}\r\n\t\t\ta=a.next;\r\n\t\t}while (a!==start);\r\n\t}\r\n\r\n\tEarcut.eliminateHoles=function(data,holeIndices,outerNode,dim){\r\n\t\tvar queue=[],\r\n\t\ti,len,start,end,list;\r\n\t\tfor (i=0,len=holeIndices.length;i < len;i++){\r\n\t\t\tstart=holeIndices[i] *dim;\r\n\t\t\tend=i < len-1 ? holeIndices[i+1] *dim :data.length;\r\n\t\t\tlist=Earcut.linkedList(data,start,end,dim,false);\r\n\t\t\tif (list===list.next)list.steiner=true;\r\n\t\t\tqueue.push(Earcut.getLeftmost(list));\r\n\t\t}\r\n\t\tqueue.sort(Earcut.compareX);\r\n\t\tfor (i=0;i < queue.length;i++){\r\n\t\t\tEarcut.eliminateHole(queue[i],outerNode);\r\n\t\t\touterNode=Earcut.filterPoints(outerNode,outerNode.next);\r\n\t\t}\r\n\t\treturn outerNode;\r\n\t}\r\n\r\n\tEarcut.compareX=function(a,b){\r\n\t\treturn a.x-b.x;\r\n\t}\r\n\r\n\tEarcut.eliminateHole=function(hole,outerNode){\r\n\t\touterNode=Earcut.findHoleBridge(hole,outerNode);\r\n\t\tif (outerNode){\r\n\t\t\tvar b=Earcut.splitPolygon(outerNode,hole);\r\n\t\t\tEarcut.filterPoints(b,b.next);\r\n\t\t}\r\n\t}\r\n\r\n\tEarcut.findHoleBridge=function(hole,outerNode){\r\n\t\tvar p=outerNode,\r\n\t\thx=hole.x,\r\n\t\thy=hole.y,\r\n\t\tqx=-Infinity,\r\n\t\tm;\r\n\t\tdo {\r\n\t\t\tif (hy <=p.y && hy >=p.next.y && p.next.y!==p.y){\r\n\t\t\t\tvar x=p.x+(hy-p.y)*(p.next.x-p.x)/ (p.next.y-p.y);\r\n\t\t\t\tif (x <=hx && x > qx){\r\n\t\t\t\t\tqx=x;\r\n\t\t\t\t\tif (x===hx){\r\n\t\t\t\t\t\tif (hy===p.y)return p;\r\n\t\t\t\t\t\tif (hy===p.next.y)return p.next;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tm=p.x < p.next.x ? p :p.next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==outerNode);\r\n\t\tif (!m)return null;\r\n\t\tif (hx===qx)return m.prev;\r\n\t\tvar stop=m,\r\n\t\tmx=m.x,\r\n\t\tmy=m.y,\r\n\t\ttanMin=Infinity,\r\n\t\ttan;\r\n\t\tp=m.next;\r\n\t\twhile (p!==stop){\r\n\t\t\tif (hx >=p.x && p.x >=mx && hx!==p.x &&\r\n\t\t\t\tEarcut.pointInTriangle(hy < my ? hx :qx,hy,mx,my,hy < my ? qx :hx,hy,p.x,p.y)){\r\n\t\t\t\ttan=Math.abs(hy-p.y)/ (hx-p.x);\r\n\t\t\t\tif ((tan < tanMin || (tan===tanMin && p.x > m.x))&& Earcut.locallyInside(p,hole)){\r\n\t\t\t\t\tm=p;\r\n\t\t\t\t\ttanMin=tan;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tp=p.next;\r\n\t\t}\r\n\t\treturn m;\r\n\t}\r\n\r\n\tEarcut.indexCurve=function(start,minX,minY,invSize){\r\n\t\tvar p=start;\r\n\t\tdo {\r\n\t\t\tif (p.z===null)p.z=Earcut.zOrder(p.x,p.y,minX,minY,invSize);\r\n\t\t\tp.prevZ=p.prev;\r\n\t\t\tp.nextZ=p.next;\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==start);\r\n\t\tp.prevZ.nextZ=null;\r\n\t\tp.prevZ=null;\r\n\t\tEarcut.sortLinked(p);\r\n\t}\r\n\r\n\tEarcut.sortLinked=function(list){\r\n\t\tvar i,p,q,e,tail,numMerges,pSize,qSize,\r\n\t\tinSize=1;\r\n\t\tdo {\r\n\t\t\tp=list;\r\n\t\t\tlist=null;\r\n\t\t\ttail=null;\r\n\t\t\tnumMerges=0;\r\n\t\t\twhile (p){\r\n\t\t\t\tnumMerges++;\r\n\t\t\t\tq=p;\r\n\t\t\t\tpSize=0;\r\n\t\t\t\tfor (i=0;i < inSize;i++){\r\n\t\t\t\t\tpSize++;\r\n\t\t\t\t\tq=q.nextZ;\r\n\t\t\t\t\tif (!q)break ;\r\n\t\t\t\t}\r\n\t\t\t\tqSize=inSize;\r\n\t\t\t\twhile (pSize > 0 || (qSize > 0 && q)){\r\n\t\t\t\t\tif (pSize!==0 && (qSize===0 || !q || p.z <=q.z)){\r\n\t\t\t\t\t\te=p;\r\n\t\t\t\t\t\tp=p.nextZ;\r\n\t\t\t\t\t\tpSize--;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\te=q;\r\n\t\t\t\t\t\tq=q.nextZ;\r\n\t\t\t\t\t\tqSize--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (tail)tail.nextZ=e;\r\n\t\t\t\t\telse list=e;\r\n\t\t\t\t\te.prevZ=tail;\r\n\t\t\t\t\ttail=e;\r\n\t\t\t\t}\r\n\t\t\t\tp=q;\r\n\t\t\t}\r\n\t\t\ttail.nextZ=null;\r\n\t\t\tinSize *=2;\r\n\t\t}while (numMerges > 1);\r\n\t\treturn list;\r\n\t}\r\n\r\n\tEarcut.zOrder=function(x,y,minX,minY,invSize){\r\n\t\tx=32767 *(x-minX)*invSize;\r\n\t\ty=32767 *(y-minY)*invSize;\r\n\t\tx=(x | (x << 8))& 0x00FF00FF;\r\n\t\tx=(x | (x << 4))& 0x0F0F0F0F;\r\n\t\tx=(x | (x << 2))& 0x33333333;\r\n\t\tx=(x | (x << 1))& 0x55555555;\r\n\t\ty=(y | (y << 8))& 0x00FF00FF;\r\n\t\ty=(y | (y << 4))& 0x0F0F0F0F;\r\n\t\ty=(y | (y << 2))& 0x33333333;\r\n\t\ty=(y | (y << 1))& 0x55555555;\r\n\t\treturn x | (y << 1);\r\n\t}\r\n\r\n\tEarcut.getLeftmost=function(start){\r\n\t\tvar p=start,\r\n\t\tleftmost=start;\r\n\t\tdo {\r\n\t\t\tif (p.x < leftmost.x)leftmost=p;\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==start);\r\n\t\treturn leftmost;\r\n\t}\r\n\r\n\tEarcut.pointInTriangle=function(ax,ay,bx,by,cx,cy,px,py){\r\n\t\treturn (cx-px)*(ay-py)-(ax-px)*(cy-py)>=0 &&\r\n\t\t(ax-px)*(by-py)-(bx-px)*(ay-py)>=0 &&\r\n\t\t(bx-px)*(cy-py)-(cx-px)*(by-py)>=0;\r\n\t}\r\n\r\n\tEarcut.isValidDiagonal=function(a,b){\r\n\t\treturn a.next.i!==b.i && a.prev.i!==b.i && !Earcut.intersectsPolygon(a,b)&&\r\n\t\tEarcut.locallyInside(a,b)&& Earcut.locallyInside(b,a)&& Earcut.middleInside(a,b);\r\n\t}\r\n\r\n\tEarcut.area=function(p,q,r){\r\n\t\treturn (q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);\r\n\t}\r\n\r\n\tEarcut.equals=function(p1,p2){\r\n\t\treturn p1.x===p2.x && p1.y===p2.y;\r\n\t}\r\n\r\n\tEarcut.intersects=function(p1,q1,p2,q2){\r\n\t\tif ((Earcut.equals(p1,q1)&& Earcut.equals(p2,q2))||\r\n\t\t\t(Earcut.equals(p1,q2)&& Earcut.equals(p2,q1)))return true;\r\n\t\treturn Earcut.area(p1,q1,p2)> 0!==Earcut.area(p1,q1,q2)> 0 &&\r\n\t\tEarcut.area(p2,q2,p1)> 0!==Earcut.area(p2,q2,q1)> 0;\r\n\t}\r\n\r\n\tEarcut.intersectsPolygon=function(a,b){\r\n\t\tvar p=a;\r\n\t\tdo {\r\n\t\t\tif (p.i!==a.i && p.next.i!==a.i && p.i!==b.i && p.next.i!==b.i &&\r\n\t\t\t\tEarcut.intersects(p,p.next,a,b))return true;\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==a);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tEarcut.locallyInside=function(a,b){\r\n\t\treturn Earcut.area(a.prev,a,a.next)< 0 ?\r\n\t\tEarcut.area(a,b,a.next)>=0 && Earcut.area(a,a.prev,b)>=0 :\r\n\t\tEarcut.area(a,b,a.prev)< 0 || Earcut.area(a,a.next,b)< 0;\r\n\t}\r\n\r\n\tEarcut.middleInside=function(a,b){\r\n\t\tvar p=a,\r\n\t\tinside=false,\r\n\t\tpx=(a.x+b.x)/ 2,\r\n\t\tpy=(a.y+b.y)/ 2;\r\n\t\tdo {\r\n\t\t\tif (((p.y > py)!==(p.next.y > py))&& p.next.y!==p.y &&\r\n\t\t\t\t(px < (p.next.x-p.x)*(py-p.y)/ (p.next.y-p.y)+p.x))\r\n\t\t\tinside=!inside;\r\n\t\t\tp=p.next;\r\n\t\t}while (p!==a);\r\n\t\treturn inside;\r\n\t}\r\n\r\n\tEarcut.splitPolygon=function(a,b){\r\n\t\tvar a2=new EarcutNode(a.i,a.x,a.y),\r\n\t\tb2=new EarcutNode(b.i,b.x,b.y),\r\n\t\tan=a.next,\r\n\t\tbp=b.prev;\r\n\t\ta.next=b;\r\n\t\tb.prev=a;\r\n\t\ta2.next=an;\r\n\t\tan.prev=a2;\r\n\t\tb2.next=a2;\r\n\t\ta2.prev=b2;\r\n\t\tbp.next=b2;\r\n\t\tb2.prev=bp;\r\n\t\treturn b2;\r\n\t}\r\n\r\n\tEarcut.insertNode=function(i,x,y,last){\r\n\t\tvar p=new EarcutNode(i,x,y);\r\n\t\tif (!last){\r\n\t\t\tp.prev=p;\r\n\t\t\tp.next=p;\r\n\t\t\t}else {\r\n\t\t\tp.next=last.next;\r\n\t\t\tp.prev=last;\r\n\t\t\tlast.next.prev=p;\r\n\t\t\tlast.next=p;\r\n\t\t}\r\n\t\treturn p;\r\n\t}\r\n\r\n\tEarcut.removeNode=function(p){\r\n\t\tp.next.prev=p.prev;\r\n\t\tp.prev.next=p.next;\r\n\t\tif (p.prevZ)p.prevZ.nextZ=p.nextZ;\r\n\t\tif (p.nextZ)p.nextZ.prevZ=p.prevZ;\r\n\t}\r\n\r\n\tEarcut.signedArea=function(data,start,end,dim){\r\n\t\tvar sum=0;\r\n\t\tfor (var i=start,j=end-dim;i < end;i+=dim){\r\n\t\t\tsum+=(data[j]-data[i])*(data[i+1]+data[j+1]);\r\n\t\t\tj=i;\r\n\t\t}\r\n\t\treturn sum;\r\n\t}\r\n\r\n\treturn Earcut;\r\n})()\r\n\r\n\r\n//class laya.webgl.shapes.EarcutNode\r\nvar EarcutNode=(function(){\r\n\tfunction EarcutNode(i,x,y){\r\n\t\tthis.i=null;\r\n\t\tthis.x=null;\r\n\t\tthis.y=null;\r\n\t\tthis.prev=null;\r\n\t\tthis.next=null;\r\n\t\tthis.z=null;\r\n\t\tthis.prevZ=null;\r\n\t\tthis.nextZ=null;\r\n\t\tthis.steiner=null;\r\n\t\tthis.i=i;\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t\tthis.prev=null;\r\n\t\tthis.next=null;\r\n\t\tthis.z=null;\r\n\t\tthis.prevZ=null;\r\n\t\tthis.nextZ=null;\r\n\t\tthis.steiner=false;\r\n\t}\r\n\r\n\t__class(EarcutNode,'laya.webgl.shapes.EarcutNode');\r\n\treturn EarcutNode;\r\n})()\r\n\r\n\r\n//class laya.webgl.shapes.GeometryData\r\nvar GeometryData=(function(){\r\n\tfunction GeometryData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){\r\n\t\t//this.lineWidth=NaN;\r\n\t\t//this.lineColor=NaN;\r\n\t\t//this.lineAlpha=NaN;\r\n\t\t//this.fillColor=NaN;\r\n\t\t//this.fillAlpha=NaN;\r\n\t\t//this.shape=null;\r\n\t\t//this.fill=false;\r\n\t\tthis.lineWidth=lineWidth;\r\n\t\tthis.lineColor=lineColor;\r\n\t\tthis.lineAlpha=lineAlpha;\r\n\t\tthis.fillColor=fillColor;\r\n\t\tthis.fillAlpha=fillAlpha;\r\n\t\tthis.shape=shape;\r\n\t\tthis.fill=fill;\r\n\t}\r\n\r\n\t__class(GeometryData,'laya.webgl.shapes.GeometryData');\r\n\tvar __proto=GeometryData.prototype;\r\n\t__proto.clone=function(){\r\n\t\treturn new GeometryData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape);\r\n\t}\r\n\r\n\t__proto.getIndexData=function(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.getVertexData=function(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.destroy=function(){\r\n\t\tthis.shape=null;\r\n\t}\r\n\r\n\treturn GeometryData;\r\n})()\r\n\r\n\r\n//class laya.webgl.shapes.Vertex\r\nvar Vertex=(function(){\r\n\tfunction Vertex(p){\r\n\t\t//this.points=null;\r\n\t\tif((p instanceof Float32Array))\r\n\t\t\tthis.points=p;\r\n\t\telse if((p instanceof Array)){\r\n\t\t\tvar len=p.length;\r\n\t\t\tthis.points=new Float32Array(p);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(Vertex,'laya.webgl.shapes.Vertex');\r\n\tvar __proto=Vertex.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.shapes.IShape\":true})\r\n\t__proto.getData=function(ib,vb,start){}\r\n\t__proto.needUpdate=function(mat){\r\n\t\treturn false;\r\n\t}\r\n\r\n\t__proto.rebuild=function(points){}\r\n\t// TODO Auto Generated method stub\r\n\t__proto.setMatrix=function(mat){}\r\n\treturn Vertex;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.Submit\r\nvar Submit=(function(){\r\n\tfunction Submit(renderType){\r\n\t\t//this._selfVb=null;\r\n\t\t//this._ib=null;\r\n\t\t//this._blendFn=null;\r\n\t\t//this._renderType=0;\r\n\t\t//this._vb=null;\r\n\t\t// 从VB中什么地方开始画，画到哪\r\n\t\t//this._startIdx=0;\r\n\t\t//this._numEle=0;\r\n\t\t//this.shaderValue=null;\r\n\t\t(renderType===void 0)&& (renderType=10000);\r\n\t\tthis._renderType=renderType;\r\n\t}\r\n\r\n\t__class(Submit,'laya.webgl.submit.Submit');\r\n\tvar __proto=Submit.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=Submit._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t\tthis.shaderValue.release();\r\n\t\tthis._vb=null;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn this._renderType;\r\n\t}\r\n\r\n\t__proto.renderSubmit=function(){\r\n\t\tif (this._numEle===0)return 1;\r\n\t\tvar _tex=this.shaderValue.textureHost;\r\n\t\tif (_tex){\r\n\t\t\tvar source=_tex.source;\r\n\t\t\tif (!_tex.bitmap || !source)\r\n\t\t\t\treturn 1;\r\n\t\t\tthis.shaderValue.texture=source;\r\n\t\t}\r\n\t\tthis._vb.bind_upload(this._ib);\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis.shaderValue.upload();\r\n\t\tif (BlendMode.activeBlendFunction!==this._blendFn){\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.BLEND*/0x0BE2);\r\n\t\t\tthis._blendFn(gl);\r\n\t\t\tBlendMode.activeBlendFunction=this._blendFn;\r\n\t\t}\r\n\t\tStat.drawCall++;\r\n\t\tStat.trianglesFaces+=this._numEle / 3;\r\n\t\tgl.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,this._numEle,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._startIdx);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tSubmit.__init__=function(){\r\n\t\tvar s=Submit.RENDERBASE=new Submit(-1);\r\n\t\ts.shaderValue=new Value2D(0,0);\r\n\t\ts.shaderValue.ALPHA=-1234;\r\n\t}\r\n\r\n\tSubmit.createSubmit=function(context,ib,vb,pos,sv){\r\n\t\tvar o=Submit._cache._length ? Submit._cache[--Submit._cache._length] :new Submit();\r\n\t\tif (vb==null){\r\n\t\t\tvb=o._selfVb || (o._selfVb=VertexBuffer2D.create(-1));\r\n\t\t\tvb.clear();\r\n\t\t\tpos=0;\r\n\t\t}\r\n\t\to._ib=ib;\r\n\t\to._vb=vb;\r\n\t\to._startIdx=pos *CONST3D2D.BYTES_PIDX;\r\n\t\to._numEle=0;\r\n\t\tvar blendType=context._nBlendType;\r\n\t\to._blendFn=context._targets ? BlendMode.targetFns[blendType] :BlendMode.fns[blendType];\r\n\t\to.shaderValue=sv;\r\n\t\to.shaderValue.setValue(context._shader2D);\r\n\t\tvar filters=context._shader2D.filters;\r\n\t\tfilters && o.shaderValue.setFilters(filters);\r\n\t\treturn o;\r\n\t}\r\n\r\n\tSubmit.createShape=function(ctx,ib,vb,numEle,offset,sv){\r\n\t\tvar o=(!Submit._cache._length)? (new Submit()):Submit._cache[--Submit._cache._length];\r\n\t\to._ib=ib;\r\n\t\to._vb=vb;\r\n\t\to._numEle=numEle;\r\n\t\to._startIdx=offset;\r\n\t\to.shaderValue=sv;\r\n\t\to.shaderValue.setValue(ctx._shader2D);\r\n\t\tvar blendType=ctx._nBlendType;\r\n\t\to._blendFn=ctx._targets ? BlendMode.targetFns[blendType] :BlendMode.fns[blendType];\r\n\t\treturn o;\r\n\t}\r\n\r\n\tSubmit.TYPE_2D=10000;\r\n\tSubmit.TYPE_CANVAS=10003;\r\n\tSubmit.TYPE_CMDSETRT=10004;\r\n\tSubmit.TYPE_CUSTOM=10005;\r\n\tSubmit.TYPE_BLURRT=10006;\r\n\tSubmit.TYPE_CMDDESTORYPRERT=10007;\r\n\tSubmit.TYPE_DISABLESTENCIL=10008;\r\n\tSubmit.TYPE_OTHERIBVB=10009;\r\n\tSubmit.TYPE_PRIMITIVE=10010;\r\n\tSubmit.TYPE_RT=10011;\r\n\tSubmit.TYPE_BLUR_RT=10012;\r\n\tSubmit.TYPE_TARGET=10013;\r\n\tSubmit.TYPE_CHANGE_VALUE=10014;\r\n\tSubmit.TYPE_SHAPE=10015;\r\n\tSubmit.TYPE_TEXTURE=10016;\r\n\tSubmit.TYPE_FILLTEXTURE=10017;\r\n\tSubmit.RENDERBASE=null;\r\n\t__static(Submit,\r\n\t['_cache',function(){return this._cache=(Submit._cache=[],Submit._cache._length=0,Submit._cache);}\r\n\t]);\r\n\treturn Submit;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitCMD\r\nvar SubmitCMD=(function(){\r\n\tfunction SubmitCMD(){\r\n\t\tthis.fun=null;\r\n\t\tthis.args=null;\r\n\t}\r\n\r\n\t__class(SubmitCMD,'laya.webgl.submit.SubmitCMD');\r\n\tvar __proto=SubmitCMD.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.renderSubmit=function(){\r\n\t\tthis.fun.apply(null,this.args);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitCMD._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t}\r\n\r\n\tSubmitCMD.create=function(args,fun){\r\n\t\tvar o=SubmitCMD._cache._length?SubmitCMD._cache[--SubmitCMD._cache._length]:new SubmitCMD();\r\n\t\to.fun=fun;\r\n\t\to.args=args;\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SubmitCMD,\r\n\t['_cache',function(){return this._cache=(SubmitCMD._cache=[],SubmitCMD._cache._length=0,SubmitCMD._cache);}\r\n\t]);\r\n\treturn SubmitCMD;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitCMDScope\r\nvar SubmitCMDScope=(function(){\r\n\tfunction SubmitCMDScope(){\r\n\t\tthis.variables={};\r\n\t}\r\n\r\n\t__class(SubmitCMDScope,'laya.webgl.submit.SubmitCMDScope');\r\n\tvar __proto=SubmitCMDScope.prototype;\r\n\t__proto.getValue=function(name){\r\n\t\treturn this.variables[name];\r\n\t}\r\n\r\n\t__proto.addValue=function(name,value){\r\n\t\treturn this.variables[name]=value;\r\n\t}\r\n\r\n\t__proto.setValue=function(name,value){\r\n\t\tif(this.variables.hasOwnProperty(name)){\r\n\t\t\treturn this.variables[name]=value;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tfor(var key in this.variables){\r\n\t\t\tdelete this.variables[key];\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.recycle=function(){\r\n\t\tthis.clear();\r\n\t\tSubmitCMDScope.POOL.push(this);\r\n\t}\r\n\r\n\tSubmitCMDScope.create=function(){\r\n\t\tvar scope=SubmitCMDScope.POOL.pop();\r\n\t\tscope||(scope=new SubmitCMDScope());\r\n\t\treturn scope;\r\n\t}\r\n\r\n\tSubmitCMDScope.POOL=[];\r\n\treturn SubmitCMDScope;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitOtherIBVB\r\nvar SubmitOtherIBVB=(function(){\r\n\tfunction SubmitOtherIBVB(){\r\n\t\tthis.offset=0;\r\n\t\t//this._vb=null;\r\n\t\t//this._ib=null;\r\n\t\t//this._blendFn=null;\r\n\t\t//this._mat=null;\r\n\t\t//this._shader=null;\r\n\t\t//this._shaderValue=null;\r\n\t\t//this._numEle=0;\r\n\t\tthis.startIndex=0;\r\n\t\t;\r\n\t\tthis._mat=Matrix.create();\r\n\t}\r\n\r\n\t__class(SubmitOtherIBVB,'laya.webgl.submit.SubmitOtherIBVB');\r\n\tvar __proto=SubmitOtherIBVB.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitOtherIBVB._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn /*laya.webgl.submit.Submit.TYPE_OTHERIBVB*/10009;\r\n\t}\r\n\r\n\t__proto.renderSubmit=function(){\r\n\t\tvar _tex=this._shaderValue.textureHost;\r\n\t\tif (_tex){\r\n\t\t\tvar source=_tex.source;\r\n\t\t\tif (!_tex.bitmap || !source)\r\n\t\t\t\treturn 1;\r\n\t\t\tthis._shaderValue.texture=source;\r\n\t\t}\r\n\t\tthis._vb.bind_upload(this._ib);\r\n\t\tvar w=RenderState2D.worldMatrix4;\r\n\t\tvar wmat=Matrix.TEMP;\r\n\t\tMatrix.mulPre(this._mat,w[0],w[1],w[4],w[5],w[12],w[13],wmat);\r\n\t\tvar tmp=RenderState2D.worldMatrix4=SubmitOtherIBVB.tempMatrix4;\r\n\t\ttmp[0]=wmat.a;\r\n\t\ttmp[1]=wmat.b;\r\n\t\ttmp[4]=wmat.c;\r\n\t\ttmp[5]=wmat.d;\r\n\t\ttmp[12]=wmat.tx;\r\n\t\ttmp[13]=wmat.ty;\r\n\t\tthis._shader._offset=this.offset;\r\n\t\tthis._shaderValue.refresh();\r\n\t\tthis._shader.upload(this._shaderValue);\r\n\t\tthis._shader._offset=0;\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tif (BlendMode.activeBlendFunction!==this._blendFn){\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.BLEND*/0x0BE2);\r\n\t\t\tthis._blendFn(gl);\r\n\t\t\tBlendMode.activeBlendFunction=this._blendFn;\r\n\t\t}\r\n\t\tStat.drawCall++;\r\n\t\tStat.trianglesFaces+=this._numEle / 3;\r\n\t\tgl.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,this._numEle,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this.startIndex);\r\n\t\tRenderState2D.worldMatrix4=w;\r\n\t\tBaseShader.activeShader=null;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tSubmitOtherIBVB.create=function(context,vb,ib,numElement,shader,shaderValue,startIndex,offset,type){\r\n\t\t(type===void 0)&& (type=0);\r\n\t\tvar o=(!SubmitOtherIBVB._cache._length)? (new SubmitOtherIBVB()):SubmitOtherIBVB._cache[--SubmitOtherIBVB._cache._length];\r\n\t\to._ib=ib;\r\n\t\to._vb=vb;\r\n\t\to._numEle=numElement;\r\n\t\to._shader=shader;\r\n\t\to._shaderValue=shaderValue;\r\n\t\tvar blendType=context._nBlendType;\r\n\t\to._blendFn=context._targets ? BlendMode.targetFns[blendType] :BlendMode.fns[blendType];\r\n\t\tswitch(type){\r\n\t\t\tcase 0:\r\n\t\t\t\to.offset=0;\r\n\t\t\t\to.startIndex=offset / (CONST3D2D.BYTES_PE *vb.vertexStride)*1.5;\r\n\t\t\t\to.startIndex *=CONST3D2D.BYTES_PIDX;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 1:\r\n\t\t\t\to.startIndex=startIndex;\r\n\t\t\t\to.offset=offset;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SubmitOtherIBVB,\r\n\t['_cache',function(){return this._cache=(SubmitOtherIBVB._cache=[],SubmitOtherIBVB._cache._length=0,SubmitOtherIBVB._cache);},'tempMatrix4',function(){return this.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,];}\r\n\t]);\r\n\treturn SubmitOtherIBVB;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitScissor\r\nvar SubmitScissor=(function(){\r\n\tfunction SubmitScissor(){\r\n\t\tthis.submitIndex=0;\r\n\t\tthis.submitLength=0;\r\n\t\tthis.context=null;\r\n\t\tthis.clipRect=new Rectangle();\r\n\t\tthis.screenRect=new Rectangle();\r\n\t}\r\n\r\n\t__class(SubmitScissor,'laya.webgl.submit.SubmitScissor');\r\n\tvar __proto=SubmitScissor.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto._scissor=function(x,y,w,h){\r\n\t\tvar m=RenderState2D.worldMatrix4;\r\n\t\tvar a=m[0],d=m[5],tx=m[12],ty=m[13];\r\n\t\tx=x *a+tx;\r\n\t\ty=y *d+ty;\r\n\t\tw *=a;\r\n\t\th *=d;\r\n\t\tif (w < 1 || h < 1){\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tvar r=x+w;\r\n\t\tvar b=y+h;\r\n\t\tx < 0 && (x=0,w=r-x);\r\n\t\ty < 0 && (y=0,h=b-y);\r\n\t\tvar screen=RenderState2D.worldClipRect;\r\n\t\tx=Math.max(x,screen.x);\r\n\t\ty=Math.max(y,screen.y);\r\n\t\tw=Math.min(r,screen.right)-x;\r\n\t\th=Math.min(b,screen.bottom)-y;\r\n\t\tif (w < 1 || h < 1){\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tvar worldScissorTest=RenderState2D.worldScissorTest;\r\n\t\tthis.screenRect.copyFrom(screen);\r\n\t\tscreen.x=x;\r\n\t\tscreen.y=y;\r\n\t\tscreen.width=w;\r\n\t\tscreen.height=h;\r\n\t\tRenderState2D.worldScissorTest=true;\r\n\t\ty=RenderState2D.height-y-h;\r\n\t\tWebGL.mainContext.scissor(x,y,w,h);\r\n\t\tWebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\tthis.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);\r\n\t\tif (worldScissorTest){\r\n\t\t\ty=RenderState2D.height-this.screenRect.y-this.screenRect.height;\r\n\t\t\tWebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height);\r\n\t\t\tWebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tWebGL.mainContext.disable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t\tRenderState2D.worldScissorTest=false;\r\n\t\t}\r\n\t\tscreen.copyFrom(this.screenRect);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto._scissorWithTagart=function(x,y,w,h){\r\n\t\tif (w < 1 || h < 1){\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tvar r=x+w;\r\n\t\tvar b=y+h;\r\n\t\tx < 0 && (x=0,w=r-x);\r\n\t\ty < 0 && (y=0,h=b-y);\r\n\t\tvar screen=RenderState2D.worldClipRect;\r\n\t\tx=Math.max(x,screen.x);\r\n\t\ty=Math.max(y,screen.y);\r\n\t\tw=Math.min(r,screen.right)-x;\r\n\t\th=Math.min(b,screen.bottom)-y;\r\n\t\tif (w < 1 || h < 1){\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tvar worldScissorTest=RenderState2D.worldScissorTest;\r\n\t\tthis.screenRect.copyFrom(screen);\r\n\t\tRenderState2D.worldScissorTest=true;\r\n\t\tscreen.x=x;\r\n\t\tscreen.y=y;\r\n\t\tscreen.width=w;\r\n\t\tscreen.height=h;\r\n\t\ty=RenderState2D.height-y-h;\r\n\t\tWebGL.mainContext.scissor(x,y,w,h);\r\n\t\tWebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\tthis.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);\r\n\t\tif (worldScissorTest){\r\n\t\t\ty=RenderState2D.height-this.screenRect.y-this.screenRect.height;\r\n\t\t\tWebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height);\r\n\t\t\tWebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tWebGL.mainContext.disable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t\tRenderState2D.worldScissorTest=false;\r\n\t\t}\r\n\t\tscreen.copyFrom(this.screenRect);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto.renderSubmit=function(){\r\n\t\tthis.submitLength=Math.min(this.context._submits._length-1,this.submitLength);\r\n\t\tif (this.submitLength < 1 || this.clipRect.width < 1 || this.clipRect.height < 1)\r\n\t\t\treturn this.submitLength+1;\r\n\t\tif (this.context._targets)\r\n\t\t\tthis._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height);\r\n\t\telse this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height);\r\n\t\treturn this.submitLength+1;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitScissor._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t\tthis.context=null;\r\n\t}\r\n\r\n\tSubmitScissor.create=function(context){\r\n\t\tvar o=SubmitScissor._cache._length?SubmitScissor._cache[--SubmitScissor._cache._length]:new SubmitScissor();\r\n\t\to.context=context;\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SubmitScissor,\r\n\t['_cache',function(){return this._cache=(SubmitScissor._cache=[],SubmitScissor._cache._length=0,SubmitScissor._cache);}\r\n\t]);\r\n\treturn SubmitScissor;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitStencil\r\nvar SubmitStencil=(function(){\r\n\tfunction SubmitStencil(){\r\n\t\tthis.step=0;\r\n\t\tthis.blendMode=null;\r\n\t\tthis.level=0;\r\n\t}\r\n\r\n\t__class(SubmitStencil,'laya.webgl.submit.SubmitStencil');\r\n\tvar __proto=SubmitStencil.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.renderSubmit=function(){\r\n\t\tswitch(this.step){\r\n\t\t\tcase 1:\r\n\t\t\t\tthis.do1();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 2:\r\n\t\t\t\tthis.do2();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis.do3();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 4:\r\n\t\t\t\tthis.do4();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 5:\r\n\t\t\t\tthis.do5();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 6:\r\n\t\t\t\tthis.do6();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 7:\r\n\t\t\t\tthis.do7();\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 8:\r\n\t\t\t\tthis.do8();\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitStencil._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t}\r\n\r\n\t__proto.do1=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.enable(/*laya.webgl.WebGLContext.STENCIL_TEST*/0x0B90);\r\n\t\tgl.clear(/*laya.webgl.WebGLContext.STENCIL_BUFFER_BIT*/0x00000400);\r\n\t\tgl.colorMask(false,false,false,false);\r\n\t\tgl.stencilFunc(/*laya.webgl.WebGLContext.EQUAL*/0x0202,this.level,0xFF);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.INCR*/0x1E02);\r\n\t}\r\n\r\n\t//gl.stencilOp(WebGLContext.KEEP,WebGLContext.KEEP,WebGLContext.INVERT);//测试通过给模版缓冲 写入值 一开始是0 现在是 0xFF (模版缓冲中不知道是多少位的数据)\r\n\t__proto.do2=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.stencilFunc(/*laya.webgl.WebGLContext.EQUAL*/0x0202,this.level+1,0xFF);\r\n\t\tgl.colorMask(true,true,true,true);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00);\r\n\t}\r\n\r\n\t__proto.do3=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.colorMask(true,true,true,true);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00);\r\n\t\tgl.clear(/*laya.webgl.WebGLContext.STENCIL_BUFFER_BIT*/0x00000400);\r\n\t\tgl.disable(/*laya.webgl.WebGLContext.STENCIL_TEST*/0x0B90);\r\n\t}\r\n\r\n\t__proto.do4=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tif (this.level==0){\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.STENCIL_TEST*/0x0B90);\r\n\t\t\tgl.clear(/*laya.webgl.WebGLContext.STENCIL_BUFFER_BIT*/0x00000400);\r\n\t\t}\r\n\t\tgl.colorMask(false,false,false,false);\r\n\t\tgl.stencilFunc(/*laya.webgl.WebGLContext.ALWAYS*/0x0207,0,0xFF);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.INCR*/0x1E02);\r\n\t}\r\n\r\n\t__proto.do5=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.stencilFunc(/*laya.webgl.WebGLContext.EQUAL*/0x0202,this.level,0xFF);\r\n\t\tgl.colorMask(true,true,true,true);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00);\r\n\t}\r\n\r\n\t__proto.do6=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tBlendMode.targetFns[BlendMode.TOINT[this.blendMode]](gl);\r\n\t}\r\n\r\n\t__proto.do7=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.colorMask(false,false,false,false);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.DECR*/0x1E03);\r\n\t}\r\n\r\n\t__proto.do8=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.colorMask(true,true,true,true);\r\n\t\tgl.stencilFunc(/*laya.webgl.WebGLContext.EQUAL*/0x0202,this.level,0xFF);\r\n\t\tgl.stencilOp(/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00,/*laya.webgl.WebGLContext.KEEP*/0x1E00);\r\n\t}\r\n\r\n\tSubmitStencil.restore=function(context,clip,m,_x,_y){\r\n\t\tvar submitStencil;\r\n\t\tcontext._renderKey=0;\r\n\t\tif (SubmitStencil._mask > 0){\r\n\t\t\tSubmitStencil._mask--;\r\n\t\t}\r\n\t\tif (SubmitStencil._mask==0){\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(3);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\tcontext._curSubmit=Submit.RENDERBASE;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(7);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\tvar vb=context._vb;\r\n\t\t\tvar nPos=(vb._byteLength >> 2);\r\n\t\t\tif (GlUtils.fillRectImgVb(vb,null,clip.x,clip.y,clip.width,clip.height,Texture.DEF_UV,m,_x,_y,0,0)){\r\n\t\t\t\tvar shader=context._shader2D;\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tvar submit=context._curSubmit=Submit.createSubmit(context,context._ib,vb,((vb._byteLength-/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0));\r\n\t\t\t\tsubmit.shaderValue.ALPHA=1.0;\r\n\t\t\t\tcontext._submits[context._submits._length++]=submit;\r\n\t\t\t\tcontext._curSubmit._numEle+=6;\r\n\t\t\t\tcontext._curSubmit=Submit.RENDERBASE;\r\n\t\t\t\t}else {\r\n\t\t\t\talert(\"clipRect calc stencil rect error\");\r\n\t\t\t}\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(8);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t}\r\n\t}\r\n\r\n\tSubmitStencil.restore2=function(context,submit){\r\n\t\tvar submitStencil;\r\n\t\tcontext._renderKey=0;\r\n\t\tif (SubmitStencil._mask > 0){\r\n\t\t\tSubmitStencil._mask--;\r\n\t\t}\r\n\t\tif (SubmitStencil._mask==0){\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(3);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\tcontext._curSubmit=Submit.RENDERBASE;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(7);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\tcontext._submits[context._submits._length++]=submit;\r\n\t\t\tsubmitStencil=laya.webgl.submit.SubmitStencil.create(8);\r\n\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t}\r\n\t}\r\n\r\n\tSubmitStencil.create=function(step){\r\n\t\tvar o=SubmitStencil._cache._length?SubmitStencil._cache[--SubmitStencil._cache._length]:new SubmitStencil();\r\n\t\to.step=step;\r\n\t\tif (step==5)\r\n\t\t\t++SubmitStencil._mask;\r\n\t\to.level=SubmitStencil._mask;\r\n\t\treturn o;\r\n\t}\r\n\r\n\tSubmitStencil._mask=0;\r\n\t__static(SubmitStencil,\r\n\t['_cache',function(){return this._cache=(SubmitStencil._cache=[],SubmitStencil._cache._length=0,SubmitStencil._cache);}\r\n\t]);\r\n\treturn SubmitStencil;\r\n})()\r\n\r\n\r\n//class laya.webgl.submit.SubmitTarget\r\nvar SubmitTarget=(function(){\r\n\tfunction SubmitTarget(){\r\n\t\tthis._renderType=0;\r\n\t\tthis._vb=null;\r\n\t\tthis._ib=null;\r\n\t\tthis._startIdx=0;\r\n\t\tthis._numEle=0;\r\n\t\tthis.shaderValue=null;\r\n\t\tthis.blendType=0;\r\n\t\tthis.proName=null;\r\n\t\tthis.scope=null;\r\n\t}\r\n\r\n\t__class(SubmitTarget,'laya.webgl.submit.SubmitTarget');\r\n\tvar __proto=SubmitTarget.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.submit.ISubmit\":true})\r\n\t__proto.renderSubmit=function(){\r\n\t\tthis._vb.bind_upload(this._ib);\r\n\t\tvar target=this.scope.getValue(this.proName);\r\n\t\tif (target){\r\n\t\t\tthis.shaderValue.texture=target.source;\r\n\t\t\tif (this.shaderValue[\"strength\"] && !this.shaderValue[\"blurInfo\"]){\r\n\t\t\t\tthis.shaderValue[\"blurInfo\"]=[target.width,target.height];\r\n\t\t\t}\r\n\t\t\tthis.shaderValue.upload();\r\n\t\t\tthis.blend();\r\n\t\t\tStat.drawCall++;\r\n\t\t\tStat.trianglesFaces+=this._numEle/3;\r\n\t\t\tWebGL.mainContext.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,this._numEle,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._startIdx);\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto.blend=function(){\r\n\t\tif (BlendMode.activeBlendFunction!==BlendMode.fns[this.blendType]){\r\n\t\t\tvar gl=WebGL.mainContext;\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.BLEND*/0x0BE2);\r\n\t\t\tBlendMode.fns[this.blendType](gl);\r\n\t\t\tBlendMode.activeBlendFunction=BlendMode.fns[this.blendType];\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitTarget._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t}\r\n\r\n\tSubmitTarget.create=function(context,ib,vb,pos,sv,proName){\r\n\t\tvar o=SubmitTarget._cache._length?SubmitTarget._cache[--SubmitTarget._cache._length]:new SubmitTarget();\r\n\t\to._ib=ib;\r\n\t\to._vb=vb;\r\n\t\to.proName=proName;\r\n\t\to._startIdx=pos *CONST3D2D.BYTES_PIDX;\r\n\t\to._numEle=0;\r\n\t\to.blendType=context._nBlendType;\r\n\t\to.shaderValue=sv;\r\n\t\to.shaderValue.setValue(context._shader2D);\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SubmitTarget,\r\n\t['_cache',function(){return this._cache=(SubmitTarget._cache=[],SubmitTarget._cache._length=0,SubmitTarget._cache);}\r\n\t]);\r\n\treturn SubmitTarget;\r\n})()\r\n\r\n\r\n/**\r\n*...特殊的字符，如泰文，必须重新实现这个类\r\n*/\r\n//class laya.webgl.text.CharSegment\r\nvar CharSegment=(function(){\r\n\tfunction CharSegment(){\r\n\t\tthis._sourceStr=null;\r\n\t}\r\n\r\n\t__class(CharSegment,'laya.webgl.text.CharSegment');\r\n\tvar __proto=CharSegment.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.text.ICharSegment\":true})\r\n\t__proto.textToSpit=function(str){\r\n\t\tthis._sourceStr=str;\r\n\t}\r\n\r\n\t__proto.getChar=function(i){\r\n\t\treturn this._sourceStr.charAt(i);\r\n\t}\r\n\r\n\t__proto.getCharCode=function(i){\r\n\t\treturn this._sourceStr.charCodeAt(i);\r\n\t}\r\n\r\n\t__proto.length=function(){\r\n\t\treturn this._sourceStr.length;\r\n\t}\r\n\r\n\treturn CharSegment;\r\n})()\r\n\r\n\r\n//class laya.webgl.text.DrawText\r\nvar DrawText=(function(){\r\n\tvar CharValue;\r\n\tfunction DrawText(){}\r\n\t__class(DrawText,'laya.webgl.text.DrawText');\r\n\tDrawText.__init__=function(){\r\n\t\tDrawText._charsTemp=new Array;\r\n\t\tDrawText._drawValue=new CharValue();\r\n\t\tDrawText._charSeg=new CharSegment();\r\n\t}\r\n\r\n\tDrawText.customCharSeg=function(charseg){\r\n\t\tDrawText._charSeg=charseg;\r\n\t}\r\n\r\n\tDrawText.getChar=function(char,id,drawValue){\r\n\t\tvar result=WebGLCharImage.createOneChar(char,drawValue);\r\n\t\tif(id!=-1)\r\n\t\t\tDrawText._charsCache[id]=result;\r\n\t\treturn result;\r\n\t}\r\n\r\n\tDrawText._drawSlow=function(save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine){\r\n\t\tvar drawValue=DrawText._drawValue.value(font,fillColor,borderColor,lineWidth,sx,sy,underLine);\r\n\t\tvar i=0,n=0;\r\n\t\tvar chars=DrawText._charsTemp;\r\n\t\tvar width=0,oneChar,htmlWord,id=NaN;\r\n\t\tif (words){\r\n\t\t\tchars.length=words.length;\r\n\t\t\tfor (i=0,n=words.length;i < n;i++){\r\n\t\t\t\thtmlWord=words[i];\r\n\t\t\t\tid=htmlWord.charNum+drawValue.txtID;\r\n\t\t\t\tchars[i]=oneChar=DrawText._charsCache[id] || DrawText.getChar(htmlWord.char,id,drawValue);\r\n\t\t\t\toneChar.active();\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tvar text=((txt instanceof laya.utils.WordText ))? txt.toString():txt;\r\n\t\t\tif (Text.CharacterCache){\r\n\t\t\t\tDrawText._charSeg.textToSpit(text);\r\n\t\t\t\tvar len=/*if err,please use iflash.method.xmlLength()*/DrawText._charSeg.length();\r\n\t\t\t\tchars.length=len;\r\n\t\t\t\tfor (i=0,n=len;i < n;i++){\r\n\t\t\t\t\tid=DrawText._charSeg.getCharCode(i)+drawValue.txtID;\r\n\t\t\t\t\tchars[i]=oneChar=DrawText._charsCache[id] || DrawText.getChar(DrawText._charSeg.getChar(i),id,drawValue);\r\n\t\t\t\t\toneChar.active();\r\n\t\t\t\t\twidth+=oneChar.cw;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tchars.length=0;\r\n\t\t\t\toneChar=DrawText.getChar(text,-1,drawValue);\r\n\t\t\t\toneChar.active();\r\n\t\t\t\twidth+=oneChar.cw;\r\n\t\t\t\tchars[0]=oneChar;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar dx=0;\r\n\t\tif (textAlign!==null && textAlign!==\"left\")\r\n\t\t\tdx=-(textAlign==\"center\" ? (width / 2):width);\r\n\t\tvar uv,bdSz=NaN,texture,value,saveLength=0;\r\n\t\tif (words){\r\n\t\t\tfor (i=0,n=chars.length;i < n;i++){\r\n\t\t\t\toneChar=chars[i];\r\n\t\t\t\tif (!oneChar.isSpace){\r\n\t\t\t\t\thtmlWord=words[i];\r\n\t\t\t\t\tbdSz=oneChar.borderSize;\r\n\t\t\t\t\ttexture=oneChar.texture;\r\n\t\t\t\t\tctx._drawText(texture,x+dx+htmlWord.x *sx-bdSz,y+htmlWord.y *sy-bdSz,texture.width,texture.height,curMat,0,0,0,0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (i=0,n=chars.length;i < n;i++){\r\n\t\t\t\toneChar=chars[i];\r\n\t\t\t\tif (!oneChar.isSpace){\r\n\t\t\t\t\tbdSz=oneChar.borderSize;\r\n\t\t\t\t\ttexture=oneChar.texture;\r\n\t\t\t\t\tctx._drawText(texture,x+dx-bdSz,y-bdSz,texture.width,texture.height,curMat,0,0,0,0);\r\n\t\t\t\t\tsave && (value=save[saveLength++],value || (value=save[saveLength-1]=[]),value[0]=texture,value[1]=dx-bdSz,value[2]=-bdSz);\r\n\t\t\t\t}\r\n\t\t\t\tdx+=oneChar.cw;\r\n\t\t\t}\r\n\t\t\tsave && (save.length=saveLength);\r\n\t\t}\r\n\t}\r\n\r\n\tDrawText._drawFast=function(save,ctx,curMat,x,y){\r\n\t\tvar texture,value;\r\n\t\tfor (var i=0,n=save.length;i < n;i++){\r\n\t\t\tvalue=save[i];\r\n\t\t\ttexture=value[0];\r\n\t\t\ttexture.active();\r\n\t\t\tctx._drawText(texture,x+value[1],y+value[2],texture.width,texture.height,curMat,0,0,0,0);\r\n\t\t}\r\n\t}\r\n\r\n\tDrawText.drawText=function(ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,underLine){\r\n\t\t(underLine===void 0)&& (underLine=0);\r\n\t\tif ((txt && txt.length===0)|| (words && words.length===0))\r\n\t\t\treturn;\r\n\t\tvar sx=curMat.a,sy=curMat.d;\r\n\t\t(curMat.b!==0 || curMat.c!==0)&& (sx=sy=1);\r\n\t\tvar scale=sx!==1 || sy!==1;\r\n\t\tif (scale && Laya.stage.transform){\r\n\t\t\tvar t=Laya.stage.transform;\r\n\t\t\tscale=t.a===sx && t.d===sy;\r\n\t\t}else scale=false;\r\n\t\tif (scale){\r\n\t\t\tcurMat=curMat.copyTo(WebGLContext2D._tmpMatrix);\r\n\t\t\tvar tempTx=curMat.tx;\r\n\t\t\tvar tempTy=curMat.ty;\r\n\t\t\tcurMat.scale(1 / sx,1 / sy);\r\n\t\t\tcurMat._checkTransform();\r\n\t\t\tx *=sx;\r\n\t\t\ty *=sy;\r\n\t\t\tx+=tempTx-curMat.tx;\r\n\t\t\ty+=tempTy-curMat.ty;\r\n\t\t}else sx=sy=1;\r\n\t\tif (words){\r\n\t\t\tDrawText._drawSlow(null,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);\r\n\t\t\t}else {\r\n\t\t\tif (txt.toUpperCase===null){\r\n\t\t\t\tvar idNum=sx+sy *100000;\r\n\t\t\t\tvar myCache=txt;\r\n\t\t\t\tif (!myCache.changed && myCache.id===idNum){\r\n\t\t\t\t\tDrawText._drawFast(myCache.save,ctx,curMat,x,y);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tmyCache.id=idNum;\r\n\t\t\t\t\tmyCache.changed=false;\r\n\t\t\t\t\tDrawText._drawSlow(myCache.save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t\tvar id=txt+font.toString()+fillColor+borderColor+lineWidth+sx+sy+textAlign;\r\n\t\t\tvar cache=DrawText._textsCache[id];\r\n\t\t\tif (Text.CharacterCache){\r\n\t\t\t\tif (cache){\r\n\t\t\t\t\tDrawText._drawFast(cache,ctx,curMat,x,y);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tDrawText._textsCache.__length || (DrawText._textsCache.__length=0);\r\n\t\t\t\t\tif (DrawText._textsCache.__length > Config.WebGLTextCacheCount){\r\n\t\t\t\t\t\tDrawText._textsCache={};\r\n\t\t\t\t\t\tDrawText._textsCache.__length=0;\r\n\t\t\t\t\t\tDrawText._curPoolIndex=0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tDrawText._textCachesPool[DrawText._curPoolIndex] ? (cache=DrawText._textsCache[id]=DrawText._textCachesPool[DrawText._curPoolIndex],cache.length=0):(DrawText._textCachesPool[DrawText._curPoolIndex]=cache=DrawText._textsCache[id]=[]);\r\n\t\t\t\t\tDrawText._textsCache.__length++\r\n\t\t\t\t\tDrawText._curPoolIndex++;\r\n\t\t\t\t\tDrawText._drawSlow(cache,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tDrawText._drawSlow(cache,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tDrawText._charsTemp=null;\r\n\tDrawText._textCachesPool=[];\r\n\tDrawText._curPoolIndex=0;\r\n\tDrawText._charsCache={};\r\n\tDrawText._textsCache={};\r\n\tDrawText._drawValue=null;\r\n\tDrawText.d=[];\r\n\tDrawText._charSeg=null;\r\n\tDrawText.__init$=function(){\r\n\t\t//class CharValue\r\n\t\tCharValue=(function(){\r\n\t\t\tfunction CharValue(){\r\n\t\t\t\t//this.txtID=NaN;\r\n\t\t\t\t//this.font=null;\r\n\t\t\t\t//this.fillColor=null;\r\n\t\t\t\t//this.borderColor=null;\r\n\t\t\t\t//this.lineWidth=0;\r\n\t\t\t\t//this.scaleX=NaN;\r\n\t\t\t\t//this.scaleY=NaN;\r\n\t\t\t\t//this.underLine=0;\r\n\t\t\t}\r\n\t\t\t__class(CharValue,'');\r\n\t\t\tvar __proto=CharValue.prototype;\r\n\t\t\t__proto.value=function(font,fillColor,borderColor,lineWidth,scaleX,scaleY,underLine){\r\n\t\t\t\tthis.font=font;\r\n\t\t\t\tthis.fillColor=fillColor;\r\n\t\t\t\tthis.borderColor=borderColor;\r\n\t\t\t\tthis.lineWidth=lineWidth;\r\n\t\t\t\tthis.scaleX=scaleX;\r\n\t\t\t\tthis.scaleY=scaleY;\r\n\t\t\t\tthis.underLine=underLine;\r\n\t\t\t\tvar key=font.toString()+scaleX+scaleY+lineWidth+fillColor+borderColor+underLine;\r\n\t\t\t\tthis.txtID=CharValue._keymap[key];\r\n\t\t\t\tif (!this.txtID){\r\n\t\t\t\t\tthis.txtID=(++CharValue._keymapCount)*0.0000001;\r\n\t\t\t\t\tCharValue._keymap[key]=this.txtID;\r\n\t\t\t\t}\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\t\t\tCharValue.clear=function(){\r\n\t\t\t\tCharValue._keymap={};\r\n\t\t\t\tCharValue._keymapCount=1;\r\n\t\t\t}\r\n\t\t\tCharValue._keymap={};\r\n\t\t\tCharValue._keymapCount=1;\r\n\t\t\treturn CharValue;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn DrawText;\r\n})()\r\n\r\n\r\n//class laya.webgl.text.FontInContext\r\nvar FontInContext=(function(){\r\n\tfunction FontInContext(font){\r\n\t\t//this._text=null;\r\n\t\t//this._words=null;\r\n\t\tthis._index=0;\r\n\t\tthis._size=14;\r\n\t\tthis._italic=-2;\r\n\t\tFontInContext._cache2=FontInContext._cache2|| [];\r\n\t\tthis.setFont(font || \"14px Arial\");\r\n\t}\r\n\r\n\t__class(FontInContext,'laya.webgl.text.FontInContext');\r\n\tvar __proto=FontInContext.prototype;\r\n\t__proto.setFont=function(value){\r\n\t\tvar arr=FontInContext._cache2[value];\r\n\t\tif (!arr){\r\n\t\t\tthis._words=value.split(' ');\r\n\t\t\tfor (var i=0,n=this._words.length;i < n;i++){\r\n\t\t\t\tif (this._words[i].indexOf('px')> 0){\r\n\t\t\t\t\tthis._index=i;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._size=parseInt(this._words[this._index]);\r\n\t\t\tFontInContext._cache2[value]=[this._words,this._size];\r\n\t\t\t}else {\r\n\t\t\tthis._words=arr[0];\r\n\t\t\tthis._size=arr[1];\r\n\t\t}\r\n\t\tthis._text=null;\r\n\t\tthis._italic=-2;\r\n\t}\r\n\r\n\t__proto.getItalic=function(){\r\n\t\tthis._italic===-2 && (this._italic=this.hasType(\"italic\"));\r\n\t\treturn this._italic;\r\n\t}\r\n\r\n\t__proto.hasType=function(name){\r\n\t\tfor (var i=0,n=this._words.length;i < n;i++)\r\n\t\tif (this._words[i]===name)return i;\r\n\t\treturn-1;\r\n\t}\r\n\r\n\t__proto.removeType=function(name){\r\n\t\tfor (var i=0,n=this._words.length;i < n;i++)\r\n\t\tif (this._words[i]===name){\r\n\t\t\tthis._words.splice(i,1);\r\n\t\t\tif (this._index > i)this._index--;\r\n\t\t\tbreak ;\r\n\t\t}\r\n\t\tthis._text=null;\r\n\t\tthis._italic=-2;\r\n\t}\r\n\r\n\t__proto.copyTo=function(dec){\r\n\t\tdec._text=this._text;\r\n\t\tdec._size=this._size;\r\n\t\tdec._index=this._index;\r\n\t\tdec._words=this._words.slice();\r\n\t\tdec._italic=-2;\r\n\t\treturn dec;\r\n\t}\r\n\r\n\t__proto.toString=function(){\r\n\t\treturn this._text ? this._text :(this._text=this._words.join(' '));\r\n\t}\r\n\r\n\t__getset(0,__proto,'size',function(){\r\n\t\treturn this._size;\r\n\t\t},function(value){\r\n\t\tthis._size=value;\r\n\t\tthis._words[this._index]=value+\"px\";\r\n\t\tthis._text=null;\r\n\t});\r\n\r\n\tFontInContext.create=function(font){\r\n\t\tvar r=FontInContext._cache[font];\r\n\t\tif (r)return r;\r\n\t\tr=FontInContext._cache[font]=new FontInContext(font);\r\n\t\treturn r;\r\n\t}\r\n\r\n\tFontInContext._cache={};\r\n\tFontInContext._cache2=null;\r\n\t__static(FontInContext,\r\n\t['EMPTY',function(){return this.EMPTY=new FontInContext();}\r\n\t]);\r\n\treturn FontInContext;\r\n})()\r\n\r\n\r\n//class laya.webgl.utils.CONST3D2D\r\nvar CONST3D2D=(function(){\r\n\tfunction CONST3D2D(){}\r\n\t__class(CONST3D2D,'laya.webgl.utils.CONST3D2D');\r\n\tCONST3D2D._TMPARRAY=[];\r\n\tCONST3D2D._OFFSETX=0;\r\n\tCONST3D2D._OFFSETY=0;\r\n\t__static(CONST3D2D,\r\n\t['BYTES_PE',function(){return this.BYTES_PE=/*__JS__ */Float32Array.BYTES_PER_ELEMENT;},'BYTES_PIDX',function(){return this.BYTES_PIDX=/*__JS__ */Uint16Array.BYTES_PER_ELEMENT;},'defaultMatrix4',function(){return this.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];},'defaultMinusYMatrix4',function(){return this.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];},'uniformMatrix3',function(){return this.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];}\r\n\t]);\r\n\treturn CONST3D2D;\r\n})()\r\n\r\n\r\n//class laya.webgl.utils.GlUtils\r\nvar GlUtils=(function(){\r\n\tfunction GlUtils(){}\r\n\t__class(GlUtils,'laya.webgl.utils.GlUtils');\r\n\tGlUtils.make2DProjection=function(width,height,depth){\r\n\t\treturn [2.0 / width,0,0,0,0,-2.0 / height,0,0,0,0,2.0 / depth,0,-1,1,0,1,];\r\n\t}\r\n\r\n\tGlUtils.fillIBQuadrangle=function(buffer,count){\r\n\t\tif (count > 65535 / 4){\r\n\t\t\tthrow Error(\"IBQuadrangle count:\"+count+\" must<:\"+Math.floor(65535 / 4));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tcount=Math.floor(count);\r\n\t\tbuffer._resizeBuffer((count+1)*6 */*laya.webgl.utils.Buffer2D.SHORT*/2,false);\r\n\t\tbuffer.byteLength=buffer.bufferLength;\r\n\t\tvar bufferData=buffer.getUint16Array();\r\n\t\tvar idx=0;\r\n\t\tfor (var i=0;i < count;i++){\r\n\t\t\tbufferData[idx++]=i *4;\r\n\t\t\tbufferData[idx++]=i *4+2;\r\n\t\t\tbufferData[idx++]=i *4+1;\r\n\t\t\tbufferData[idx++]=i *4;\r\n\t\t\tbufferData[idx++]=i *4+3;\r\n\t\t\tbufferData[idx++]=i *4+2;\r\n\t\t}\r\n\t\tbuffer.setNeedUpload();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tGlUtils.expandIBQuadrangle=function(buffer,count){\r\n\t\tbuffer.bufferLength >=(count *6 */*laya.webgl.utils.Buffer2D.SHORT*/2)|| GlUtils.fillIBQuadrangle(buffer,count);\r\n\t}\r\n\r\n\tGlUtils.mathCeilPowerOfTwo=function(value){\r\n\t\tvalue--;\r\n\t\tvalue |=value >> 1;\r\n\t\tvalue |=value >> 2;\r\n\t\tvalue |=value >> 4;\r\n\t\tvalue |=value >> 8;\r\n\t\tvalue |=value >> 16;\r\n\t\tvalue++;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tGlUtils.fillQuadrangleImgVb=function(vb,x,y,point4,uv,m,_x,_y){\r\n\t\t'use strict';\r\n\t\tvar vpos=(vb._byteLength >> 2)+/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16;\r\n\t\tvb.byteLength=(vpos << 2);\r\n\t\tvar vbdata=vb.getFloat32Array();\r\n\t\tvpos-=/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16;\r\n\t\tvbdata[vpos+2]=uv[0];\r\n\t\tvbdata[vpos+3]=uv[1];\r\n\t\tvbdata[vpos+6]=uv[2];\r\n\t\tvbdata[vpos+7]=uv[3];\r\n\t\tvbdata[vpos+10]=uv[4];\r\n\t\tvbdata[vpos+11]=uv[5];\r\n\t\tvbdata[vpos+14]=uv[6];\r\n\t\tvbdata[vpos+15]=uv[7];\r\n\t\tvar a=m.a,b=m.b,c=m.c,d=m.d;\r\n\t\tif (a!==1 || b!==0 || c!==0 || d!==1){\r\n\t\t\tm.bTransform=true;\r\n\t\t\tvar tx=m.tx+_x,ty=m.ty+_y;\r\n\t\t\tvbdata[vpos]=(point4[0]+x)*a+(point4[1]+y)*c+tx;\r\n\t\t\tvbdata[vpos+1]=(point4[0]+x)*b+(point4[1]+y)*d+ty;\r\n\t\t\tvbdata[vpos+4]=(point4[2]+x)*a+(point4[3]+y)*c+tx;\r\n\t\t\tvbdata[vpos+5]=(point4[2]+x)*b+(point4[3]+y)*d+ty;\r\n\t\t\tvbdata[vpos+8]=(point4[4]+x)*a+(point4[5]+y)*c+tx;\r\n\t\t\tvbdata[vpos+9]=(point4[4]+x)*b+(point4[5]+y)*d+ty;\r\n\t\t\tvbdata[vpos+12]=(point4[6]+x)*a+(point4[7]+y)*c+tx;\r\n\t\t\tvbdata[vpos+13]=(point4[6]+x)*b+(point4[7]+y)*d+ty;\r\n\t\t\t}else {\r\n\t\t\tm.bTransform=false;\r\n\t\t\tx+=m.tx+_x;\r\n\t\t\ty+=m.ty+_y;\r\n\t\t\tvbdata[vpos]=x+point4[0];\r\n\t\t\tvbdata[vpos+1]=y+point4[1];\r\n\t\t\tvbdata[vpos+4]=x+point4[2];\r\n\t\t\tvbdata[vpos+5]=y+point4[3];\r\n\t\t\tvbdata[vpos+8]=x+point4[4];\r\n\t\t\tvbdata[vpos+9]=y+point4[5];\r\n\t\t\tvbdata[vpos+12]=x+point4[6];\r\n\t\t\tvbdata[vpos+13]=y+point4[7];\r\n\t\t}\r\n\t\tvb._upload=true;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tGlUtils.fillTranglesVB=function(vb,x,y,points,m,_x,_y){\r\n\t\tvar vpos=(vb._byteLength >> 2)+points.length;\r\n\t\tvb.byteLength=(vpos << 2);\r\n\t\tvar vbdata=vb.getFloat32Array();\r\n\t\tvpos-=points.length;\r\n\t\tvar len=points.length;\r\n\t\tvar a=m.a,b=m.b,c=m.c,d=m.d;\r\n\t\tfor (var i=0;i < len;i+=4){\r\n\t\t\tvbdata[vpos+i+2]=points[i+2];\r\n\t\t\tvbdata[vpos+i+3]=points[i+3];\r\n\t\t\tif (a!==1 || b!==0 || c!==0 || d!==1){\r\n\t\t\t\tm.bTransform=true;\r\n\t\t\t\tvar tx=m.tx+_x,ty=m.ty+_y;\r\n\t\t\t\tvbdata[vpos+i]=(points[i]+x)*a+(points[i+1]+y)*c+tx;\r\n\t\t\t\tvbdata[vpos+i+1]=(points[i]+x)*b+(points[i+1]+y)*d+ty;\r\n\t\t\t\t}else {\r\n\t\t\t\tm.bTransform=false;\r\n\t\t\t\tx+=m.tx+_x;\r\n\t\t\t\ty+=m.ty+_y;\r\n\t\t\t\tvbdata[vpos+i]=x+points[i];\r\n\t\t\t\tvbdata[vpos+i+1]=y+points[i+1];\r\n\t\t\t}\r\n\t\t}\r\n\t\tvb._upload=true;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tGlUtils.copyPreImgVb=function(vb,dx,dy){\r\n\t\tvar vpos=(vb._byteLength >> 2);\r\n\t\tvb.byteLength=((vpos+/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16)<< 2);\r\n\t\tvar vbdata=vb.getFloat32Array();\r\n\t\tfor (var i=0,ci=vpos-16;i < 4;i++){\r\n\t\t\tvbdata[vpos]=vbdata[ci]+dx;\r\n\t\t\t++vpos;\r\n\t\t\t++ci;\r\n\t\t\tvbdata[vpos]=vbdata[ci]+dy;\r\n\t\t\t++vpos;\r\n\t\t\t++ci;\r\n\t\t\tvbdata[vpos]=vbdata[ci];\r\n\t\t\t++vpos;\r\n\t\t\t++ci;\r\n\t\t\tvbdata[vpos]=vbdata[ci];\r\n\t\t\t++vpos;\r\n\t\t\t++ci;\r\n\t\t}\r\n\t\tvb._upload=true;\r\n\t}\r\n\r\n\tGlUtils.fillRectImgVb=function(vb,clip,x,y,width,height,uv,m,_x,_y,dx,dy,round){\r\n\t\t(round===void 0)&& (round=false);\r\n\t\tvar mType=1;\r\n\t\tvar toBx,toBy,toEx,toEy;\r\n\t\tvar cBx,cBy,cEx,cEy;\r\n\t\tvar w0,h0,tx,ty;\r\n\t\tvar finalX,finalY,offsetX,offsetY;\r\n\t\tvar a=m.a,b=m.b,c=m.c,d=m.d;\r\n\t\tvar useClip=clip && clip.width < /*laya.webgl.canvas.WebGLContext2D._MAXSIZE*/99999999;\r\n\t\tif (a!==1 || b!==0 || c!==0 || d!==1){\r\n\t\t\tm.bTransform=true;\r\n\t\t\tif (b===0 && c===0){\r\n\t\t\t\tmType=23;\r\n\t\t\t\tw0=width+x,h0=height+y;\r\n\t\t\t\ttx=m.tx+_x,ty=m.ty+_y;\r\n\t\t\t\ttoBx=a *x+tx;\r\n\t\t\t\ttoEx=a *w0+tx;\r\n\t\t\t\ttoBy=d *y+ty;\r\n\t\t\t\ttoEy=d *h0+ty;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tmType=23;\r\n\t\t\tm.bTransform=false;\r\n\t\t\ttoBx=x+m.tx+_x;\r\n\t\t\ttoEx=toBx+width;\r\n\t\t\ttoBy=y+m.ty+_y;\r\n\t\t\ttoEy=toBy+height;\r\n\t\t}\r\n\t\tif (useClip){\r\n\t\t\tcBx=clip.x,cBy=clip.y,cEx=clip.width+cBx,cEy=clip.height+cBy;\r\n\t\t}\r\n\t\tif (mType!==1){\r\n\t\t\tif (Math.min(toBx,toEx)>=cEx)return false;\r\n\t\t\tif (Math.min(toBy,toEy)>=cEy)return false;\r\n\t\t\tif (Math.max(toEx,toBx)<=cBx)return false;\r\n\t\t\tif (Math.max(toEy,toBy)<=cBy)return false;\r\n\t\t};\r\n\t\tvar vpos=(vb._byteLength >> 2);\r\n\t\tvb.byteLength=((vpos+/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16)<< 2);\r\n\t\tvar vbdata=vb.getFloat32Array();\r\n\t\tvbdata[vpos+2]=uv[0];\r\n\t\tvbdata[vpos+3]=uv[1];\r\n\t\tvbdata[vpos+6]=uv[2];\r\n\t\tvbdata[vpos+7]=uv[3];\r\n\t\tvbdata[vpos+10]=uv[4];\r\n\t\tvbdata[vpos+11]=uv[5];\r\n\t\tvbdata[vpos+14]=uv[6];\r\n\t\tvbdata[vpos+15]=uv[7];\r\n\t\tswitch (mType){\r\n\t\t\tcase 1:\r\n\t\t\t\ttx=m.tx+_x,ty=m.ty+_y;\r\n\t\t\t\tw0=width+x,h0=height+y;\r\n\t\t\t\tvar w1=x,h1=y;\r\n\t\t\t\tvar aw1=a *w1,ch1=c *h1,dh1=d *h1,bw1=b *w1;\r\n\t\t\t\tvar aw0=a *w0,ch0=c *h0,dh0=d *h0,bw0=b *w0;\r\n\t\t\t\tif (round){\r\n\t\t\t\t\tfinalX=aw1+ch1+tx;\r\n\t\t\t\t\toffsetX=Math.round(finalX)-finalX;\r\n\t\t\t\t\tfinalY=dh1+bw1+ty;\r\n\t\t\t\t\toffsetY=Math.round(finalY)-finalY;\r\n\t\t\t\t\tvbdata[vpos]=finalX+offsetX;\r\n\t\t\t\t\tvbdata[vpos+1]=finalY+offsetY;\r\n\t\t\t\t\tvbdata[vpos+4]=aw0+ch1+tx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+5]=dh1+bw0+ty+offsetY;\r\n\t\t\t\t\tvbdata[vpos+8]=aw0+ch0+tx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+9]=dh0+bw0+ty+offsetY;\r\n\t\t\t\t\tvbdata[vpos+12]=aw1+ch0+tx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+13]=dh0+bw1+ty+offsetY;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tvbdata[vpos]=aw1+ch1+tx;\r\n\t\t\t\t\tvbdata[vpos+1]=dh1+bw1+ty;\r\n\t\t\t\t\tvbdata[vpos+4]=aw0+ch1+tx;\r\n\t\t\t\t\tvbdata[vpos+5]=dh1+bw0+ty;\r\n\t\t\t\t\tvbdata[vpos+8]=aw0+ch0+tx;\r\n\t\t\t\t\tvbdata[vpos+9]=dh0+bw0+ty;\r\n\t\t\t\t\tvbdata[vpos+12]=aw1+ch0+tx;\r\n\t\t\t\t\tvbdata[vpos+13]=dh0+bw1+ty;\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 23:\r\n\t\t\t\tif (round){\r\n\t\t\t\t\tfinalX=toBx+dx;\r\n\t\t\t\t\toffsetX=Math.round(finalX)-finalX;\r\n\t\t\t\t\tfinalY=toBy;\r\n\t\t\t\t\toffsetY=Math.round(finalY)-finalY;\r\n\t\t\t\t\tvbdata[vpos]=finalX+offsetX;\r\n\t\t\t\t\tvbdata[vpos+1]=finalY+offsetY;\r\n\t\t\t\t\tvbdata[vpos+4]=toEx+dx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+5]=toBy+offsetY;\r\n\t\t\t\t\tvbdata[vpos+8]=toEx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+9]=toEy+offsetY;\r\n\t\t\t\t\tvbdata[vpos+12]=toBx+offsetX;\r\n\t\t\t\t\tvbdata[vpos+13]=toEy+offsetY;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tvbdata[vpos]=toBx+dx;\r\n\t\t\t\t\tvbdata[vpos+1]=toBy;\r\n\t\t\t\t\tvbdata[vpos+4]=toEx+dx;\r\n\t\t\t\t\tvbdata[vpos+5]=toBy;\r\n\t\t\t\t\tvbdata[vpos+8]=toEx;\r\n\t\t\t\t\tvbdata[vpos+9]=toEy;\r\n\t\t\t\t\tvbdata[vpos+12]=toBx;\r\n\t\t\t\t\tvbdata[vpos+13]=toEy;\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tvb._upload=true;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tGlUtils.fillLineVb=function(vb,clip,fx,fy,tx,ty,width,mat){\r\n\t\t'use strict';\r\n\t\tvar linew=width *.5;\r\n\t\tvar data=GlUtils._fillLineArray;\r\n\t\tvar perpx=-(fy-ty),perpy=fx-tx;\r\n\t\tvar dist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx /=dist,perpy /=dist,perpx *=linew,perpy *=linew;\r\n\t\tdata[0]=fx-perpx,data[1]=fy-perpy,data[4]=fx+perpx,data[5]=fy+perpy,data[8]=tx+perpx,data[9]=ty+perpy,data[12]=tx-perpx,data[13]=ty-perpy;\r\n\t\tmat && mat.transformPointArray(data,data);\r\n\t\tvar vpos=(vb._byteLength >> 2)+/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16;\r\n\t\tvb.byteLength=(vpos << 2);\r\n\t\tvb.insertData(data,vpos-/*laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__static(GlUtils,\r\n\t['_fillLineArray',function(){return this._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];}\r\n\t]);\r\n\treturn GlUtils;\r\n})()\r\n\r\n\r\n//class laya.webgl.utils.MatirxArray\r\nvar MatirxArray=(function(){\r\n\tfunction MatirxArray(){}\r\n\t__class(MatirxArray,'laya.webgl.utils.MatirxArray');\r\n\tMatirxArray.ArrayMul=function(a,b,o){\r\n\t\tif (!a){\r\n\t\t\tMatirxArray.copyArray(b,o);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!b){\r\n\t\t\tMatirxArray.copyArray(a,o);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar ai0=NaN,ai1=NaN,ai2=NaN,ai3=NaN;\r\n\t\tfor (var i=0;i < 4;i++){\r\n\t\t\tai0=a[i];\r\n\t\t\tai1=a[i+4];\r\n\t\t\tai2=a[i+8];\r\n\t\t\tai3=a[i+12];\r\n\t\t\to[i]=ai0 *b[0]+ai1 *b[1]+ai2 *b[2]+ai3 *b[3];\r\n\t\t\to[i+4]=ai0 *b[4]+ai1 *b[5]+ai2 *b[6]+ai3 *b[7];\r\n\t\t\to[i+8]=ai0 *b[8]+ai1 *b[9]+ai2 *b[10]+ai3 *b[11];\r\n\t\t\to[i+12]=ai0 *b[12]+ai1 *b[13]+ai2 *b[14]+ai3 *b[15];\r\n\t\t}\r\n\t}\r\n\r\n\tMatirxArray.copyArray=function(f,t){\r\n\t\tif (!f)return;\r\n\t\tif (!t)return;\r\n\t\tfor (var i=0;i < f.length;i++){\r\n\t\t\tt[i]=f[i];\r\n\t\t}\r\n\t}\r\n\r\n\treturn MatirxArray;\r\n})()\r\n\r\n\r\n//class laya.webgl.utils.RenderState2D\r\nvar RenderState2D=(function(){\r\n\tfunction RenderState2D(){}\r\n\t__class(RenderState2D,'laya.webgl.utils.RenderState2D');\r\n\tRenderState2D.getMatrArray=function(){\r\n\t\treturn [1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];\r\n\t}\r\n\r\n\tRenderState2D.mat2MatArray=function(mat,matArray){\r\n\t\tvar m=mat;\r\n\t\tvar m4=matArray;\r\n\t\tm4[0]=m.a;\r\n\t\tm4[1]=m.b;\r\n\t\tm4[2]=RenderState2D.EMPTYMAT4_ARRAY[2];\r\n\t\tm4[3]=RenderState2D.EMPTYMAT4_ARRAY[3];\r\n\t\tm4[4]=m.c;\r\n\t\tm4[5]=m.d;\r\n\t\tm4[6]=RenderState2D.EMPTYMAT4_ARRAY[6];\r\n\t\tm4[7]=RenderState2D.EMPTYMAT4_ARRAY[7];\r\n\t\tm4[8]=RenderState2D.EMPTYMAT4_ARRAY[8];\r\n\t\tm4[9]=RenderState2D.EMPTYMAT4_ARRAY[9];\r\n\t\tm4[10]=RenderState2D.EMPTYMAT4_ARRAY[10];\r\n\t\tm4[11]=RenderState2D.EMPTYMAT4_ARRAY[11];\r\n\t\tm4[12]=m.tx;\r\n\t\tm4[13]=m.ty;\r\n\t\tm4[14]=RenderState2D.EMPTYMAT4_ARRAY[14];\r\n\t\tm4[15]=RenderState2D.EMPTYMAT4_ARRAY[15];\r\n\t\treturn matArray;\r\n\t}\r\n\r\n\tRenderState2D.restoreTempArray=function(){\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[0]=1;\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[1]=0;\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[4]=0;\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[5]=1;\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[12]=0;\r\n\t\tRenderState2D.TEMPMAT4_ARRAY[13]=0;\r\n\t}\r\n\r\n\tRenderState2D.clear=function(){\r\n\t\tRenderState2D.worldScissorTest=false;\r\n\t\tRenderState2D.worldShaderDefines=null;\r\n\t\tRenderState2D.worldFilters=null;\r\n\t\tRenderState2D.worldAlpha=1;\r\n\t\tRenderState2D.worldClipRect.x=RenderState2D.worldClipRect.y=0;\r\n\t\tRenderState2D.worldClipRect.width=RenderState2D.width;\r\n\t\tRenderState2D.worldClipRect.height=RenderState2D.height;\r\n\t\tRenderState2D.curRenderTarget=null;\r\n\t}\r\n\r\n\tRenderState2D._MAXSIZE=99999999;\r\n\tRenderState2D.worldAlpha=1.0;\r\n\tRenderState2D.worldScissorTest=false;\r\n\tRenderState2D.worldFilters=null;\r\n\tRenderState2D.worldShaderDefines=null;\r\n\tRenderState2D.curRenderTarget=null;\r\n\tRenderState2D.width=0;\r\n\tRenderState2D.height=0;\r\n\t__static(RenderState2D,\r\n\t['EMPTYMAT4_ARRAY',function(){return this.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];},'TEMPMAT4_ARRAY',function(){return this.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];},'worldMatrix4',function(){return this.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY;},'worldMatrix',function(){return this.worldMatrix=new Matrix();},'worldClipRect',function(){return this.worldClipRect=new Rectangle(0,0,99999999,99999999);}\r\n\t]);\r\n\treturn RenderState2D;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>ShaderCompile</code> 类用于实现Shader编译。\r\n*/\r\n//class laya.webgl.utils.ShaderCompile\r\nvar ShaderCompile=(function(){\r\n\tvar ShaderNode,InlcudeFile;\r\n\tfunction ShaderCompile(name,vs,ps,nameMap,defs){\r\n\t\t//this._nameMap=null;\r\n\t\t//this._VS=null;\r\n\t\t//this._PS=null;\r\n\t\tvar _$this=this;\r\n\t\tfunction _compile (script){\r\n\t\t\tvar includefiles=[];\r\n\t\t\tvar top=new ShaderNode(includefiles);\r\n\t\t\t_$this._compileToTree(top,script.split('\\n'),0,includefiles,defs);\r\n\t\t\treturn top;\r\n\t\t};\r\n\t\tvar startTime=Browser.now();\r\n\t\tthis._VS=_compile(vs);\r\n\t\tthis._PS=_compile(ps);\r\n\t\tthis._nameMap=nameMap;\r\n\t\tif ((Browser.now()-startTime)> 2)\r\n\t\t\tconsole.log(\"ShaderCompile use time:\"+(Browser.now()-startTime)+\"  size:\"+vs.length+\"/\"+ps.length);\r\n\t}\r\n\r\n\t__class(ShaderCompile,'laya.webgl.utils.ShaderCompile');\r\n\tvar __proto=ShaderCompile.prototype;\r\n\t__proto._compileToTree=function(parent,lines,start,includefiles,defs){\r\n\t\tvar node,preNode;\r\n\t\tvar text,name,fname;\r\n\t\tvar ofs=0,words,noUseNode;\r\n\t\tvar i=0,n=0,j=0;\r\n\t\tfor (i=start;i < lines.length;i++){\r\n\t\t\ttext=lines[i];\r\n\t\t\tif (text.length < 1)continue ;\r\n\t\t\tofs=text.indexOf(\"//\");\r\n\t\t\tif (ofs===0)continue ;\r\n\t\t\tif (ofs >=0)text=text.substr(0,ofs);\r\n\t\t\tnode=noUseNode || new ShaderNode(includefiles);\r\n\t\t\tnoUseNode=null;\r\n\t\t\tnode.text=text;\r\n\t\t\tnode.noCompile=true;\r\n\t\t\tif ((ofs=text.indexOf(\"#\"))>=0){\r\n\t\t\t\tname=\"#\";\r\n\t\t\t\tfor (j=ofs+1,n=text.length;j < n;j++){\r\n\t\t\t\t\tvar c=text.charAt(j);\r\n\t\t\t\t\tif (c===' ' || c==='\\t' || c==='?')break ;\r\n\t\t\t\t\tname+=c;\r\n\t\t\t\t}\r\n\t\t\t\tnode.name=name;\r\n\t\t\t\tswitch (name){\r\n\t\t\t\t\tcase \"#ifdef\":\r\n\t\t\t\t\tcase \"#ifndef\":\r\n\t\t\t\t\t\tnode.src=text;\r\n\t\t\t\t\t\tnode.noCompile=text.match(/[!&|()=<>]/)!=null;\r\n\t\t\t\t\t\tif (!node.noCompile){\r\n\t\t\t\t\t\t\twords=text.replace(/^\\s*/,'').split(/\\s+/);\r\n\t\t\t\t\t\t\tnode.setCondition(words[1],name===\"#ifdef\" ? 1 :2);\r\n\t\t\t\t\t\t\tnode.text=\"//\"+node.text;\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\tconsole.log(\"function():Boolean{return \"+text.substr(ofs+node.name.length)+\"}\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode.setParent(parent);\r\n\t\t\t\t\t\tparent=node;\r\n\t\t\t\t\t\tif (defs){\r\n\t\t\t\t\t\t\twords=text.substr(j).split(ShaderCompile._splitToWordExps3);\r\n\t\t\t\t\t\t\tfor (j=0;j < words.length;j++){\r\n\t\t\t\t\t\t\t\ttext=words[j];\r\n\t\t\t\t\t\t\t\ttext.length && (defs[ text]=true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\tcase \"#if\":\r\n\t\t\t\t\t\tnode.src=text;\r\n\t\t\t\t\t\tnode.noCompile=true;\r\n\t\t\t\t\t\tnode.setParent(parent);\r\n\t\t\t\t\t\tparent=node;\r\n\t\t\t\t\t\tif (defs){\r\n\t\t\t\t\t\t\twords=text.substr(j).split(ShaderCompile._splitToWordExps3);\r\n\t\t\t\t\t\t\tfor (j=0;j < words.length;j++){\r\n\t\t\t\t\t\t\t\ttext=words[j];\r\n\t\t\t\t\t\t\t\ttext.length && text!=\"defined\" && (defs[ text]=true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\tcase \"#else\":\r\n\t\t\t\t\t\tnode.src=text;\r\n\t\t\t\t\t\tparent=parent.parent;\r\n\t\t\t\t\t\tpreNode=parent.childs[parent.childs.length-1];\r\n\t\t\t\t\t\tnode.noCompile=preNode.noCompile\r\n\t\t\t\t\t\tif (!(node.noCompile)){\r\n\t\t\t\t\t\t\tnode.condition=preNode.condition;\r\n\t\t\t\t\t\t\tnode.conditionType=preNode.conditionType==1 ? 2 :1;\r\n\t\t\t\t\t\t\tnode.text=\"//\"+node.text+\" \"+preNode.text+\" \"+node.conditionType;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode.setParent(parent);\r\n\t\t\t\t\t\tparent=node;\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\tcase \"#endif\":\r\n\t\t\t\t\t\tparent=parent.parent;\r\n\t\t\t\t\t\tpreNode=parent.childs[parent.childs.length-1];\r\n\t\t\t\t\t\tnode.noCompile=preNode.noCompile;\r\n\t\t\t\t\t\tif (!(node.noCompile)){\r\n\t\t\t\t\t\t\tnode.text=\"//\"+node.text;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode.setParent(parent);\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\tcase \"#include\":\r\n\t\t\t\t\t\twords=ShaderCompile.splitToWords(text,null);\r\n\t\t\t\t\t\tvar inlcudeFile=ShaderCompile.includes[words[1]];\r\n\t\t\t\t\t\tif (!inlcudeFile){\r\n\t\t\t\t\t\t\tthrow \"ShaderCompile error no this include file:\"+words[1];\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((ofs=words[0].indexOf(\"?\"))< 0){\r\n\t\t\t\t\t\t\tnode.setParent(parent);\r\n\t\t\t\t\t\t\ttext=inlcudeFile.getWith(words[2]=='with' ? words[3] :null);\r\n\t\t\t\t\t\t\tthis._compileToTree(node,text.split('\\n'),0,includefiles,defs);\r\n\t\t\t\t\t\t\tnode.text=\"\";\r\n\t\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnode.setCondition(words[0].substr(ofs+1),1);\r\n\t\t\t\t\t\tnode.text=inlcudeFile.getWith(words[2]=='with' ? words[3] :null);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"#import\":\r\n\t\t\t\t\t\twords=ShaderCompile.splitToWords(text,null);\r\n\t\t\t\t\t\tfname=words[1];\r\n\t\t\t\t\t\tincludefiles.push({node:node,file:ShaderCompile.includes[fname],ofs:node.text.length});\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tpreNode=parent.childs[parent.childs.length-1];\r\n\t\t\t\tif (preNode && !preNode.name){\r\n\t\t\t\t\tincludefiles.length > 0 && ShaderCompile.splitToWords(text,preNode);\r\n\t\t\t\t\tnoUseNode=node;\r\n\t\t\t\t\tpreNode.text+=\"\\n\"+text;\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\tincludefiles.length > 0 && ShaderCompile.splitToWords(text,node);\r\n\t\t\t}\r\n\t\t\tnode.setParent(parent);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.createShader=function(define,shaderName,createShader){\r\n\t\tvar defMap={};\r\n\t\tvar defineStr=\"\";\r\n\t\tif (define){\r\n\t\t\tfor (var i in define){\r\n\t\t\t\tdefineStr+=\"#define \"+i+\"\\n\";\r\n\t\t\t\tdefMap[i]=true;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar vs=this._VS.toscript(defMap,[]);\r\n\t\tvar ps=this._PS.toscript(defMap,[]);\r\n\t\treturn (createShader || Shader.create)(defineStr+vs.join('\\n'),defineStr+ps.join('\\n'),shaderName,this._nameMap);\r\n\t}\r\n\r\n\tShaderCompile._parseOne=function(attributes,uniforms,words,i,word,b){\r\n\t\tvar one={type:ShaderCompile.shaderParamsMap[words[i+1]],name:words[i+2],size:isNaN(parseInt(words[i+3]))? 1 :parseInt(words[i+3])};\r\n\t\tif (b){\r\n\t\t\tif (word==\"attribute\"){\r\n\t\t\t\tattributes.push(one);\r\n\t\t\t\t}else {\r\n\t\t\t\tuniforms.push(one);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (words[i+3]==':'){\r\n\t\t\tone.type=words[i+4];\r\n\t\t\ti+=2;\r\n\t\t}\r\n\t\ti+=2;\r\n\t\treturn i;\r\n\t}\r\n\r\n\tShaderCompile.addInclude=function(fileName,txt){\r\n\t\tif (!txt || txt.length===0)\r\n\t\t\tthrow new Error(\"add shader include file err:\"+fileName);\r\n\t\tif (ShaderCompile.includes[fileName])\r\n\t\t\tthrow new Error(\"add shader include file err, has add:\"+fileName);\r\n\t\tShaderCompile.includes[fileName]=new InlcudeFile(txt);\r\n\t}\r\n\r\n\tShaderCompile.preGetParams=function(vs,ps){\r\n\t\tvar text=[vs,ps];\r\n\t\tvar result={};\r\n\t\tvar attributes=[];\r\n\t\tvar uniforms=[];\r\n\t\tvar definesInfo={};\r\n\t\tvar definesName=[];\r\n\t\tresult.attributes=attributes;\r\n\t\tresult.uniforms=uniforms;\r\n\t\tresult.defines=definesInfo;\r\n\t\tvar i=0,n=0,one;\r\n\t\tfor (var s=0;s < 2;s++){\r\n\t\t\ttext[s]=text[s].replace(ShaderCompile._removeAnnotation,\"\");\r\n\t\t\tvar words=text[s].match(ShaderCompile._reg);\r\n\t\t\tvar tempelse;\r\n\t\t\tfor (i=0,n=words.length;i < n;i++){\r\n\t\t\t\tvar word=words[i];\r\n\t\t\t\tif (word !=\"attribute\" && word !=\"uniform\"){\r\n\t\t\t\t\tif (word==\"#define\"){\r\n\t\t\t\t\t\tword=words[++i];\r\n\t\t\t\t\t\tdefinesName[word]=1;\r\n\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t\t}else if (word==\"#ifdef\"){\r\n\t\t\t\t\t\ttempelse=words[++i];\r\n\t\t\t\t\t\tvar def=definesInfo[tempelse]=definesInfo[tempelse] || [];\r\n\t\t\t\t\t\tfor (i++;i < n;i++){\r\n\t\t\t\t\t\t\tword=words[i];\r\n\t\t\t\t\t\t\tif (word !=\"attribute\" && word !=\"uniform\"){\r\n\t\t\t\t\t\t\t\tif (word==\"#else\"){\r\n\t\t\t\t\t\t\t\t\tfor (i++;i < n;i++){\r\n\t\t\t\t\t\t\t\t\t\tword=words[i];\r\n\t\t\t\t\t\t\t\t\t\tif (word !=\"attribute\" && word !=\"uniform\"){\r\n\t\t\t\t\t\t\t\t\t\t\tif (word==\"#endif\"){\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\ti=ShaderCompile._parseOne(attributes,uniforms,words,i,word,!definesName[tempelse]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti=ShaderCompile._parseOne(attributes,uniforms,words,i,word,definesName[tempelse]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\ti=ShaderCompile._parseOne(attributes,uniforms,words,i,word,true);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tShaderCompile.splitToWords=function(str,block){\r\n\t\tvar out=[];\r\n\t\tvar c;\r\n\t\tvar ofs=-1;\r\n\t\tvar word;\r\n\t\tfor (var i=0,n=str.length;i < n;i++){\r\n\t\t\tc=str.charAt(i);\r\n\t\t\tif (\" \\t=+-*/&%!<>()'\\\",;\".indexOf(c)>=0){\r\n\t\t\t\tif (ofs >=0 && (i-ofs)> 1){\r\n\t\t\t\t\tword=str.substr(ofs,i-ofs);\r\n\t\t\t\t\tout.push(word);\r\n\t\t\t\t}\r\n\t\t\t\tif (c=='\"' || c==\"'\"){\r\n\t\t\t\t\tvar ofs2=str.indexOf(c,i+1);\r\n\t\t\t\t\tif (ofs2 < 0){\r\n\t\t\t\t\t\tthrow \"Sharder err:\"+str;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tout.push(str.substr(i+1,ofs2-i-1));\r\n\t\t\t\t\ti=ofs2;\r\n\t\t\t\t\tofs=-1;\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\tif (c=='(' && block && out.length > 0){\r\n\t\t\t\t\tword=out[out.length-1]+\";\";\r\n\t\t\t\t\tif (\"vec4;main;\".indexOf(word)< 0)\r\n\t\t\t\t\t\tblock.useFuns+=word;\r\n\t\t\t\t}\r\n\t\t\t\tofs=-1;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tif (ofs < 0)ofs=i;\r\n\t\t}\r\n\t\tif (ofs < n && (n-ofs)> 1){\r\n\t\t\tword=str.substr(ofs,n-ofs);\r\n\t\t\tout.push(word);\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tShaderCompile.IFDEF_NO=0;\r\n\tShaderCompile.IFDEF_YES=1;\r\n\tShaderCompile.IFDEF_ELSE=2;\r\n\tShaderCompile.IFDEF_PARENT=3;\r\n\tShaderCompile.includes={};\r\n\t__static(ShaderCompile,\r\n\t['_removeAnnotation',function(){return this._removeAnnotation=new RegExp(\"(/\\\\*([^*]|[\\\\r\\\\\\n]|(\\\\*+([^*/]|[\\\\r\\\\n])))*\\\\*+/)|(//.*)\",\"g\");},'_reg',function(){return this._reg=new RegExp(\"(\\\".*\\\")|('.*')|([#\\\\w\\\\*-\\\\.+/()=<>{}\\\\\\\\]+)|([,;:\\\\\\\\])\",\"g\");},'_splitToWordExps',function(){return this._splitToWordExps=new RegExp(\"[(\\\".*\\\")]+|[('.*')]+|([ \\\\t=\\\\+\\\\-*/&%!<>!%\\(\\),;])\",\"g\");},'shaderParamsMap',function(){return this.shaderParamsMap={\"float\":/*laya.webgl.WebGLContext.FLOAT*/0x1406,\"int\":/*laya.webgl.WebGLContext.INT*/0x1404,\"bool\":/*laya.webgl.WebGLContext.BOOL*/0x8B56,\"vec2\":/*laya.webgl.WebGLContext.FLOAT_VEC2*/0x8B50,\"vec3\":/*laya.webgl.WebGLContext.FLOAT_VEC3*/0x8B51,\"vec4\":/*laya.webgl.WebGLContext.FLOAT_VEC4*/0x8B52,\"ivec2\":/*laya.webgl.WebGLContext.INT_VEC2*/0x8B53,\"ivec3\":/*laya.webgl.WebGLContext.INT_VEC3*/0x8B54,\"ivec4\":/*laya.webgl.WebGLContext.INT_VEC4*/0x8B55,\"bvec2\":/*laya.webgl.WebGLContext.BOOL_VEC2*/0x8B57,\"bvec3\":/*laya.webgl.WebGLContext.BOOL_VEC3*/0x8B58,\"bvec4\":/*laya.webgl.WebGLContext.BOOL_VEC4*/0x8B59,\"mat2\":/*laya.webgl.WebGLContext.FLOAT_MAT2*/0x8B5A,\"mat3\":/*laya.webgl.WebGLContext.FLOAT_MAT3*/0x8B5B,\"mat4\":/*laya.webgl.WebGLContext.FLOAT_MAT4*/0x8B5C,\"sampler2D\":/*laya.webgl.WebGLContext.SAMPLER_2D*/0x8B5E,\"samplerCube\":/*laya.webgl.WebGLContext.SAMPLER_CUBE*/0x8B60};},'_splitToWordExps3',function(){return this._splitToWordExps3=new RegExp(\"[ \\\\t=\\\\+\\\\-*/&%!<>!%\\(\\),;\\\\|]\",\"g\");}\r\n\t]);\r\n\tShaderCompile.__init$=function(){\r\n\t\t//class ShaderNode\r\n\t\tShaderNode=(function(){\r\n\t\t\tfunction ShaderNode(includefiles){\r\n\t\t\t\tthis.childs=[];\r\n\t\t\t\tthis.text=\"\";\r\n\t\t\t\tthis.parent=null;\r\n\t\t\t\tthis.name=null;\r\n\t\t\t\tthis.noCompile=false;\r\n\t\t\t\tthis.includefiles=null;\r\n\t\t\t\tthis.condition=null;\r\n\t\t\t\tthis.conditionType=0;\r\n\t\t\t\tthis.useFuns=\"\";\r\n\t\t\t\tthis.z=0;\r\n\t\t\t\tthis.src=null;\r\n\t\t\t\tthis.includefiles=includefiles;\r\n\t\t\t}\r\n\t\t\t__class(ShaderNode,'');\r\n\t\t\tvar __proto=ShaderNode.prototype;\r\n\t\t\t__proto.setParent=function(parent){\r\n\t\t\t\tparent.childs.push(this);\r\n\t\t\t\tthis.z=parent.z+1;\r\n\t\t\t\tthis.parent=parent;\r\n\t\t\t}\r\n\t\t\t__proto.setCondition=function(condition,type){\r\n\t\t\t\tif (condition){\r\n\t\t\t\t\tthis.conditionType=type;\r\n\t\t\t\t\tcondition=condition.replace(/(\\s*$)/g,\"\");\r\n\t\t\t\t\tthis.condition=function (){\r\n\t\t\t\t\t\treturn this[condition];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.condition.__condition=condition;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t__proto.toscript=function(def,out){\r\n\t\t\t\treturn this._toscript(def,out,++ShaderNode.__id);\r\n\t\t\t}\r\n\t\t\t__proto._toscript=function(def,out,id){\r\n\t\t\t\tif (this.childs.length < 1 && !this.text)return out;\r\n\t\t\t\tvar outIndex=out.length;\r\n\t\t\t\tif (this.condition){\r\n\t\t\t\t\tvar ifdef=!!this.condition.call(def);\r\n\t\t\t\t\tthis.conditionType===/*laya.webgl.utils.ShaderCompile.IFDEF_ELSE*/2 && (ifdef=!ifdef);\r\n\t\t\t\t\tif (!ifdef)return out;\r\n\t\t\t\t}\r\n\t\t\t\tthis.text && out.push(this.text);\r\n\t\t\t\tthis.childs.length > 0 && this.childs.forEach(function(o,index,arr){\r\n\t\t\t\t\to._toscript(def,out,id);\r\n\t\t\t\t});\r\n\t\t\t\tif (this.includefiles.length > 0 && this.useFuns.length > 0){\r\n\t\t\t\t\tvar funsCode;\r\n\t\t\t\t\tfor (var i=0,n=this.includefiles.length;i < n;i++){\r\n\t\t\t\t\t\tif (this.includefiles[i].curUseID==id){\r\n\t\t\t\t\t\t\tcontinue ;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfunsCode=this.includefiles[i].file.getFunsScript(this.useFuns);\r\n\t\t\t\t\t\tif (funsCode.length > 0){\r\n\t\t\t\t\t\t\tthis.includefiles[i].curUseID=id;\r\n\t\t\t\t\t\t\tout[0]=funsCode+out[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn out;\r\n\t\t\t}\r\n\t\t\tShaderNode.__id=1;\r\n\t\t\treturn ShaderNode;\r\n\t\t})()\r\n\t\t//class InlcudeFile\r\n\t\tInlcudeFile=(function(){\r\n\t\t\tfunction InlcudeFile(txt){\r\n\t\t\t\tthis.script=null;\r\n\t\t\t\tthis.codes={};\r\n\t\t\t\tthis.funs={};\r\n\t\t\t\tthis.curUseID=-1;\r\n\t\t\t\tthis.funnames=\"\";\r\n\t\t\t\tthis.script=txt;\r\n\t\t\t\tvar begin=0,ofs=0,end=0;\r\n\t\t\t\twhile (true){\r\n\t\t\t\t\tbegin=txt.indexOf(\"#begin\",begin);\r\n\t\t\t\t\tif (begin < 0)break ;\r\n\t\t\t\t\tend=begin+5;\r\n\t\t\t\t\twhile (true){\r\n\t\t\t\t\t\tend=txt.indexOf(\"#end\",end);\r\n\t\t\t\t\t\tif (end < 0)break ;\r\n\t\t\t\t\t\tif (txt.charAt(end+4)==='i')\r\n\t\t\t\t\t\t\tend+=5;\r\n\t\t\t\t\t\telse break ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (end < 0){\r\n\t\t\t\t\t\tthrow \"add include err,no #end:\"+txt;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tofs=txt.indexOf('\\n',begin);\r\n\t\t\t\t\tvar words=ShaderCompile.splitToWords(txt.substr(begin,ofs-begin),null);\r\n\t\t\t\t\tif (words[1]=='code'){\r\n\t\t\t\t\t\tthis.codes[words[2]]=txt.substr(ofs+1,end-ofs-1);\r\n\t\t\t\t\t\t}else if (words[1]=='function'){\r\n\t\t\t\t\t\tofs=txt.indexOf(\"function\",begin);\r\n\t\t\t\t\t\tofs+=\"function\".length;\r\n\t\t\t\t\t\tthis.funs[words[3]]=txt.substr(ofs+1,end-ofs-1);\r\n\t\t\t\t\t\tthis.funnames+=words[3]+\";\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbegin=end+1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t__class(InlcudeFile,'');\r\n\t\t\tvar __proto=InlcudeFile.prototype;\r\n\t\t\t__proto.getWith=function(name){\r\n\t\t\t\tvar r=name ? this.codes[name] :this.script;\r\n\t\t\t\tif (!r){\r\n\t\t\t\t\tthrow \"get with error:\"+name;\r\n\t\t\t\t}\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\t\t\t__proto.getFunsScript=function(funsdef){\r\n\t\t\t\tvar r=\"\";\r\n\t\t\t\tfor (var i in this.funs){\r\n\t\t\t\t\tif (funsdef.indexOf(i+\";\")>=0){\r\n\t\t\t\t\t\tr+=this.funs[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn r;\r\n\t\t\t}\r\n\t\t\treturn InlcudeFile;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn ShaderCompile;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.webgl.WebGL\r\nvar WebGL=(function(){\r\n\tfunction WebGL(){}\r\n\t__class(WebGL,'laya.webgl.WebGL');\r\n\tWebGL._uint8ArraySlice=function(){\r\n\t\tvar _this=/*__JS__ */this;\r\n\t\tvar sz=_this.length;\r\n\t\tvar dec=new Uint8Array(_this.length);\r\n\t\tfor (var i=0;i < sz;i++)dec[i]=_this[i];\r\n\t\treturn dec;\r\n\t}\r\n\r\n\tWebGL._float32ArraySlice=function(){\r\n\t\tvar _this=/*__JS__ */this;\r\n\t\tvar sz=_this.length;\r\n\t\tvar dec=new Float32Array(_this.length);\r\n\t\tfor (var i=0;i < sz;i++)dec[i]=_this[i];\r\n\t\treturn dec;\r\n\t}\r\n\r\n\tWebGL._uint16ArraySlice=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\tvar _this=/*__JS__ */this;\r\n\t\tvar sz=0;\r\n\t\tvar dec;\r\n\t\tvar i=0;\r\n\t\tif (arg.length===0){\r\n\t\t\tsz=_this.length;\r\n\t\t\tdec=new Uint16Array(sz);\r\n\t\t\tfor (i=0;i < sz;i++)\r\n\t\t\tdec[i]=_this[i];\r\n\t\t\t}else if (arg.length===2){\r\n\t\t\tvar start=arg[0];\r\n\t\t\tvar end=arg[1];\r\n\t\t\tif (end > start){\r\n\t\t\t\tsz=end-start;\r\n\t\t\t\tdec=new Uint16Array(sz);\r\n\t\t\t\tfor (i=start;i < end;i++)\r\n\t\t\t\tdec[i-start]=_this[i];\r\n\t\t\t\t}else {\r\n\t\t\t\tdec=new Uint16Array(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn dec;\r\n\t}\r\n\r\n\tWebGL.expandContext=function(){\r\n\t\tvar from=Context.prototype;\r\n\t\tvar to=/*__JS__ */CanvasRenderingContext2D.prototype;\r\n\t\tto.fillTrangles=from.fillTrangles;\r\n\t\tBuffer2D.__int__(null);\r\n\t\tto.setIBVB=function (x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset){\r\n\t\t\t(startIndex===void 0)&& (startIndex=0);\r\n\t\t\t(offset===void 0)&& (offset=0);\r\n\t\t\tif (ib===null){\r\n\t\t\t\tthis._ib=this._ib || IndexBuffer2D.QuadrangleIB;\r\n\t\t\t\tib=this._ib;\r\n\t\t\t\tGlUtils.expandIBQuadrangle(ib,(vb._byteLength / (4 *16)+8));\r\n\t\t\t}\r\n\t\t\tthis._setIBVB(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset);\r\n\t\t};\r\n\t\tto.fillTrangles=function (tex,x,y,points,m){\r\n\t\t\tthis._curMat=this._curMat || Matrix.create();\r\n\t\t\tthis._vb=this._vb || VertexBuffer2D.create();\r\n\t\t\tif (!this._ib){\r\n\t\t\t\tthis._ib=IndexBuffer2D.create();\r\n\t\t\t\tGlUtils.fillIBQuadrangle(this._ib,length / 4);\r\n\t\t\t};\r\n\t\t\tvar vb=this._vb;\r\n\t\t\tvar length=points.length >> 4;\r\n\t\t\tGlUtils.fillTranglesVB(vb,x,y,points,m || this._curMat,0,0);\r\n\t\t\tGlUtils.expandIBQuadrangle(this._ib,(vb._byteLength / (4 *16)+8));\r\n\t\t\tvar shaderValues=new Value2D(0x01,0);\r\n\t\t\tshaderValues.textureHost=tex;\r\n\t\t\tvar sd=new Shader2X(\"attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }\",\"precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}\");\r\n\t\t\t/*__JS__ */vb._vertType=3;\r\n\t\t\tthis._setIBVB(x,y,this._ib,vb,length *6,m,sd,shaderValues,0,0);\r\n\t\t}\r\n\t}\r\n\r\n\tWebGL.enable=function(){\r\n\t\tBrowser.__init__();\r\n\t\tif (Render.isConchApp){\r\n\t\t\tif (!Render.isConchWebGL){\r\n\t\t\t\tRunDriver.skinAniSprite=function (){\r\n\t\t\t\t\tvar tSkinSprite=new SkinMesh()\r\n\t\t\t\t\treturn tSkinSprite;\r\n\t\t\t\t}\r\n\t\t\t\tWebGL.expandContext();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tRunDriver.getWebGLContext=function getWebGLContext (canvas){\r\n\t\t\tvar gl;\r\n\t\t\tvar names=[\"webgl\",\"experimental-webgl\",\"webkit-3d\",\"moz-webgl\"];\r\n\t\t\tfor (var i=0;i < names.length;i++){\r\n\t\t\t\ttry {\r\n\t\t\t\t\tgl=canvas.getContext(names[i],{stencil:Config.isStencil,alpha:Config.isAlpha,antialias:Config.isAntialias,premultipliedAlpha:Config.premultipliedAlpha,preserveDrawingBuffer:Config.preserveDrawingBuffer});\r\n\t\t\t\t}catch (e){}\r\n\t\t\t\tif (gl)\r\n\t\t\t\t\treturn gl;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tWebGL.mainContext=RunDriver.getWebGLContext(Render._mainCanvas);\r\n\t\tif (WebGL.mainContext==null)\r\n\t\t\treturn false;\r\n\t\tif (Render.isWebGL)return true;\r\n\t\tHTMLImage.create=function (src,def){\r\n\t\t\treturn new WebGLImage(src,def);\r\n\t\t}\r\n\t\tHTMLSubImage.create=function (canvas,offsetX,offsetY,width,height,atlasImage,src){\r\n\t\t\treturn new WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src);\r\n\t\t}\r\n\t\tRender.WebGL=WebGL;\r\n\t\tRender.isWebGL=true;\r\n\t\tDrawText.__init__();\r\n\t\tRunDriver.createRenderSprite=function (type,next){\r\n\t\t\treturn new RenderSprite3D(type,next);\r\n\t\t}\r\n\t\tRunDriver.createWebGLContext2D=function (c){\r\n\t\t\treturn new WebGLContext2D(c);\r\n\t\t}\r\n\t\tRunDriver.changeWebGLSize=function (width,height){\r\n\t\t\tlaya.webgl.WebGL.onStageResize(width,height);\r\n\t\t}\r\n\t\tRunDriver.createGraphics=function (){\r\n\t\t\treturn new GraphicsGL();\r\n\t\t};\r\n\t\tvar action=RunDriver.createFilterAction;\r\n\t\tRunDriver.createFilterAction=action ? action :function (type){\r\n\t\t\treturn new ColorFilterActionGL()\r\n\t\t}\r\n\t\tRunDriver.clear=function (color){\r\n\t\t\tRenderState2D.worldScissorTest && laya.webgl.WebGL.mainContext.disable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t\tvar ctx=Render.context.ctx;\r\n\t\t\tvar c=(ctx._submits._length==0 || Config.preserveDrawingBuffer)? Color.create(color)._color :Stage._wgColor;\r\n\t\t\tif (c)ctx.clearBG(c[0],c[1],c[2],c[3]);\r\n\t\t\tRenderState2D.clear();\r\n\t\t}\r\n\t\tRunDriver.addToAtlas=function (texture,force){\r\n\t\t\t(force===void 0)&& (force=false);\r\n\t\t\tvar bitmap=texture.bitmap;\r\n\t\t\tif (!Render.optimizeTextureMemory(texture.url,texture)){\r\n\t\t\t\t(bitmap).enableMerageInAtlas=false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif ((Laya.__typeof(bitmap,'laya.webgl.resource.IMergeAtlasBitmap'))&& ((bitmap).allowMerageInAtlas)){\r\n\t\t\t\tbitmap.on(/*laya.events.Event.RECOVERED*/\"recovered\",texture,texture.addTextureToAtlas);\r\n\t\t\t}\r\n\t\t}\r\n\t\tRunDriver.isAtlas=function (bitmap){\r\n\t\t\treturn (bitmap instanceof laya.webgl.atlas.AtlasWebGLCanvas );\r\n\t\t}\r\n\t\tAtlasResourceManager._enable();\r\n\t\tRunDriver.beginFlush=function (){\r\n\t\t\tvar atlasResourceManager=AtlasResourceManager.instance;\r\n\t\t\tvar count=atlasResourceManager.getAtlaserCount();\r\n\t\t\tfor (var i=0;i < count;i++){\r\n\t\t\t\tvar atlerCanvas=atlasResourceManager.getAtlaserByIndex(i).texture;\r\n\t\t\t\t(atlerCanvas._flashCacheImageNeedFlush)&& (RunDriver.flashFlushImage(atlerCanvas));\r\n\t\t\t}\r\n\t\t}\r\n\t\tRunDriver.drawToCanvas=function (sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){\r\n\t\t\tif (canvasWidth <=0 || canvasHeight <=0){\r\n\t\t\t\tconsole.log(\"[error] canvasWidth and canvasHeight should greater than zero\");\r\n\t\t\t}\r\n\t\t\toffsetX-=sprite.x;\r\n\t\t\toffsetY-=sprite.y;\r\n\t\t\tvar renderTarget=RenderTarget2D.create(canvasWidth,canvasHeight,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,0,false);\r\n\t\t\trenderTarget.start();\r\n\t\t\trenderTarget.clear(0,0,0,0);\r\n\t\t\tRender.context.clear();\r\n\t\t\tRenderSprite.renders[_renderType]._fun(sprite,Render.context,offsetX,RenderState2D.height-canvasHeight+offsetY);\r\n\t\t\tRender.context.flush();\r\n\t\t\trenderTarget.end();\r\n\t\t\tvar pixels=renderTarget.getData(0,0,renderTarget.width,renderTarget.height);\r\n\t\t\trenderTarget.recycle();\r\n\t\t\tvar htmlCanvas=new WebGLCanvas();\r\n\t\t\thtmlCanvas._canvas=Browser.createElement(\"canvas\");\r\n\t\t\thtmlCanvas.size(canvasWidth,canvasHeight);\r\n\t\t\tvar context=htmlCanvas._canvas.getContext('2d');\r\n\t\t\tBrowser.canvas.size(canvasWidth,canvasHeight);\r\n\t\t\tvar tempContext=Browser.context;\r\n\t\t\tvar imgData=tempContext.createImageData(canvasWidth,canvasHeight);\r\n\t\t\timgData.data.set(/*__JS__ */new Uint8ClampedArray(pixels.buffer));\r\n\t\t\thtmlCanvas._imgData=imgData;\r\n\t\t\ttempContext.putImageData(imgData,0,0);\r\n\t\t\tcontext.save();\r\n\t\t\tcontext.translate(0,canvasHeight);\r\n\t\t\tcontext.scale(1,-1);\r\n\t\t\tcontext.drawImage(Browser.canvas.source,0,0);\r\n\t\t\tcontext.restore();\r\n\t\t\treturn htmlCanvas;\r\n\t\t}\r\n\t\tRunDriver.createFilterAction=function (type){\r\n\t\t\tvar action;\r\n\t\t\tswitch (type){\r\n\t\t\t\tcase /*laya.filters.Filter.COLOR*/0x20:\r\n\t\t\t\t\taction=new ColorFilterActionGL();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\treturn action;\r\n\t\t}\r\n\t\tRunDriver.addTextureToAtlas=function (texture){\r\n\t\t\ttexture._uvID++;\r\n\t\t\tAtlasResourceManager._atlasRestore++;\r\n\t\t\t((texture.bitmap).enableMerageInAtlas)&& (AtlasResourceManager.instance.addToAtlas(texture));\r\n\t\t}\r\n\t\tRunDriver.getTexturePixels=function (value,x,y,width,height){\r\n\t\t\t(Render.context.ctx).clear();\r\n\t\t\tvar tSprite=new Sprite();\r\n\t\t\ttSprite.graphics.drawTexture(value,-x,-y);\r\n\t\t\tvar tRenderTarget=RenderTarget2D.create(width,height);\r\n\t\t\ttRenderTarget.start();\r\n\t\t\ttRenderTarget.clear(0,0,0,0);\r\n\t\t\ttSprite.render(Render.context,0,0);\r\n\t\t\t(Render.context.ctx).flush();\r\n\t\t\ttRenderTarget.end();\r\n\t\t\tvar tUint8Array=tRenderTarget.getData(0,0,width,height);\r\n\t\t\tvar tArray=[];\r\n\t\t\tvar tIndex=0;\r\n\t\t\tfor (var i=height-1;i >=0;i--){\r\n\t\t\t\tfor (var j=0;j < width;j++){\r\n\t\t\t\t\ttIndex=(i *width+j)*4;\r\n\t\t\t\t\ttArray.push(tUint8Array[tIndex]);\r\n\t\t\t\t\ttArray.push(tUint8Array[tIndex+1]);\r\n\t\t\t\t\ttArray.push(tUint8Array[tIndex+2]);\r\n\t\t\t\t\ttArray.push(tUint8Array[tIndex+3]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn tArray;\r\n\t\t}\r\n\t\tRunDriver.skinAniSprite=function (){\r\n\t\t\tvar tSkinSprite=new SkinMesh()\r\n\t\t\treturn tSkinSprite;\r\n\t\t}\r\n\t\tHTMLCanvas.create=function (type,canvas){\r\n\t\t\tvar ret=new WebGLCanvas();\r\n\t\t\tret._imgData=canvas;\r\n\t\t\tret.flipY=false;\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tFilter._filterStart=function (scope,sprite,context,x,y){\r\n\t\t\tvar b=scope.getValue(\"bounds\");\r\n\t\t\tvar source=RenderTarget2D.create(b.width,b.height);\r\n\t\t\tsource.start();\r\n\t\t\tsource.clear(0,0,0,0);\r\n\t\t\tscope.addValue(\"src\",source);\r\n\t\t\tscope.addValue(\"ScissorTest\",RenderState2D.worldScissorTest);\r\n\t\t\tif (RenderState2D.worldScissorTest){\r\n\t\t\t\tvar tClilpRect=new Rectangle();\r\n\t\t\t\ttClilpRect.copyFrom((context.ctx)._clipRect)\r\n\t\t\t\tscope.addValue(\"clipRect\",tClilpRect);\r\n\t\t\t\tRenderState2D.worldScissorTest=false;\r\n\t\t\t\tlaya.webgl.WebGL.mainContext.disable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t\t}\r\n\t\t}\r\n\t\tFilter._filterEnd=function (scope,sprite,context,x,y){\r\n\t\t\tvar b=scope.getValue(\"bounds\");\r\n\t\t\tvar source=scope.getValue(\"src\");\r\n\t\t\tsource.end();\r\n\t\t\tvar out=RenderTarget2D.create(b.width,b.height);\r\n\t\t\tout.start();\r\n\t\t\tout.clear(0,0,0,0);\r\n\t\t\tscope.addValue(\"out\",out);\r\n\t\t\tsprite._set$P('_filterCache',out);\r\n\t\t\tsprite._set$P('_isHaveGlowFilter',scope.getValue(\"_isHaveGlowFilter\"));\r\n\t\t}\r\n\t\tFilter._EndTarget=function (scope,context){\r\n\t\t\tvar source=scope.getValue(\"src\");\r\n\t\t\tsource.recycle();\r\n\t\t\tvar out=scope.getValue(\"out\");\r\n\t\t\tout.end();\r\n\t\t\tvar b=scope.getValue(\"ScissorTest\");\r\n\t\t\tif (b){\r\n\t\t\t\tRenderState2D.worldScissorTest=true;\r\n\t\t\t\tlaya.webgl.WebGL.mainContext.enable(/*laya.webgl.WebGLContext.SCISSOR_TEST*/0x0C11);\r\n\t\t\t\tcontext.ctx.save();\r\n\t\t\t\tvar tClipRect=scope.getValue(\"clipRect\");\r\n\t\t\t\t(context.ctx).clipRect(tClipRect.x,tClipRect.y,tClipRect.width,tClipRect.height);\r\n\t\t\t}\r\n\t\t}\r\n\t\tFilter._useSrc=function (scope){\r\n\t\t\tvar source=scope.getValue(\"out\");\r\n\t\t\tsource.end();\r\n\t\t\tsource=scope.getValue(\"src\");\r\n\t\t\tsource.start();\r\n\t\t\tsource.clear(0,0,0,0);\r\n\t\t}\r\n\t\tFilter._endSrc=function (scope){\r\n\t\t\tvar source=scope.getValue(\"src\");\r\n\t\t\tsource.end();\r\n\t\t}\r\n\t\tFilter._useOut=function (scope){\r\n\t\t\tvar source=scope.getValue(\"src\");\r\n\t\t\tsource.end();\r\n\t\t\tsource=scope.getValue(\"out\");\r\n\t\t\tsource.start();\r\n\t\t\tsource.clear(0,0,0,0);\r\n\t\t}\r\n\t\tFilter._endOut=function (scope){\r\n\t\t\tvar source=scope.getValue(\"out\");\r\n\t\t\tsource.end();\r\n\t\t}\r\n\t\tFilter._recycleScope=function (scope){\r\n\t\t\tscope.recycle();\r\n\t\t}\r\n\t\tFilter._filter=function (sprite,context,x,y){\r\n\t\t\tvar next=this._next;\r\n\t\t\tif (next){\r\n\t\t\t\tvar filters=sprite.filters,len=filters.length;\r\n\t\t\t\tif (len==1 && (filters[0].type==/*laya.filters.Filter.COLOR*/0x20)){\r\n\t\t\t\t\tcontext.ctx.save();\r\n\t\t\t\t\tcontext.ctx.setFilters([filters[0]]);\r\n\t\t\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t\t\t\tcontext.ctx.restore();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t};\r\n\t\t\t\tvar shaderValue;\r\n\t\t\t\tvar b;\r\n\t\t\t\tvar scope=SubmitCMDScope.create();\r\n\t\t\t\tvar p=Point.TEMP;\r\n\t\t\t\tvar tMatrix=context.ctx._getTransformMatrix();\r\n\t\t\t\tvar mat=Matrix.create();\r\n\t\t\t\ttMatrix.copyTo(mat);\r\n\t\t\t\tvar tPadding=0;\r\n\t\t\t\tvar tHalfPadding=0;\r\n\t\t\t\tvar tIsHaveGlowFilter=false;\r\n\t\t\t\tvar out=sprite._$P._filterCache ? sprite._$P._filterCache :null;\r\n\t\t\t\tif (!out || sprite._repaint){\r\n\t\t\t\t\ttIsHaveGlowFilter=sprite._isHaveGlowFilter();\r\n\t\t\t\t\tscope.addValue(\"_isHaveGlowFilter\",tIsHaveGlowFilter);\r\n\t\t\t\t\tif (tIsHaveGlowFilter){\r\n\t\t\t\t\t\ttPadding=50;\r\n\t\t\t\t\t\ttHalfPadding=25;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tb=new Rectangle();\r\n\t\t\t\t\tb.copyFrom((sprite).getSelfBounds());\r\n\t\t\t\t\tb.x+=(sprite).x;\r\n\t\t\t\t\tb.y+=(sprite).y;\r\n\t\t\t\t\tb.x-=(sprite).pivotX+4;\r\n\t\t\t\t\tb.y-=(sprite).pivotY+4;\r\n\t\t\t\t\tvar tSX=b.x;\r\n\t\t\t\t\tvar tSY=b.y;\r\n\t\t\t\t\tb.width+=(tPadding+8);\r\n\t\t\t\t\tb.height+=(tPadding+8);\r\n\t\t\t\t\tp.x=b.x *mat.a+b.y *mat.c;\r\n\t\t\t\t\tp.y=b.y *mat.d+b.x *mat.b;\r\n\t\t\t\t\tb.x=p.x;\r\n\t\t\t\t\tb.y=p.y;\r\n\t\t\t\t\tp.x=b.width *mat.a+b.height *mat.c;\r\n\t\t\t\t\tp.y=b.height *mat.d+b.width *mat.b;\r\n\t\t\t\t\tb.width=p.x;\r\n\t\t\t\t\tb.height=p.y;\r\n\t\t\t\t\tif (b.width <=0 || b.height <=0){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tout && out.recycle();\r\n\t\t\t\t\tscope.addValue(\"bounds\",b);\r\n\t\t\t\t\tvar submit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterStart);\r\n\t\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\t\t(context.ctx)._renderKey=0;\r\n\t\t\t\t\t(context.ctx)._shader2D.glTexture=null;\r\n\t\t\t\t\tvar tX=sprite.x-tSX+tHalfPadding;\r\n\t\t\t\t\tvar tY=sprite.y-tSY+tHalfPadding;\r\n\t\t\t\t\tnext._fun.call(next,sprite,context,tX,tY);\r\n\t\t\t\t\tsubmit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterEnd);\r\n\t\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\t\tfor (var i=0;i < len;i++){\r\n\t\t\t\t\t\tif (i !=0){\r\n\t\t\t\t\t\t\tsubmit=SubmitCMD.create([scope],Filter._useSrc);\r\n\t\t\t\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\t\t\t\tshaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\t\t\t\t\t\tMatrix.TEMP.identity();\r\n\t\t\t\t\t\t\tcontext.ctx.drawTarget(scope,0,0,b.width,b.height,Matrix.TEMP,\"out\",shaderValue,null,BlendMode.TOINT.overlay);\r\n\t\t\t\t\t\t\tsubmit=SubmitCMD.create([scope],Filter._useOut);\r\n\t\t\t\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tvar fil=filters[i];\r\n\t\t\t\t\t\tfil.action.apply3d(scope,sprite,context,0,0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsubmit=SubmitCMD.create([scope,context],Filter._EndTarget);\r\n\t\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\ttIsHaveGlowFilter=sprite._$P._isHaveGlowFilter ? sprite._$P._isHaveGlowFilter :false;\r\n\t\t\t\t\tif (tIsHaveGlowFilter){\r\n\t\t\t\t\t\ttPadding=50;\r\n\t\t\t\t\t\ttHalfPadding=25;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tb=sprite.getBounds();\r\n\t\t\t\t\tif (b.width <=0 || b.height <=0){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tb.width+=tPadding;\r\n\t\t\t\t\tb.height+=tPadding;\r\n\t\t\t\t\tp.x=b.x *mat.a+b.y *mat.c;\r\n\t\t\t\t\tp.y=b.y *mat.d+b.x *mat.b;\r\n\t\t\t\t\tb.x=p.x;\r\n\t\t\t\t\tb.y=p.y;\r\n\t\t\t\t\tp.x=b.width *mat.a+b.height *mat.c;\r\n\t\t\t\t\tp.y=b.height *mat.d+b.width *mat.b;\r\n\t\t\t\t\tb.width=p.x;\r\n\t\t\t\t\tb.height=p.y;\r\n\t\t\t\t\tscope.addValue(\"out\",out);\r\n\t\t\t\t}\r\n\t\t\t\tx=x-tHalfPadding-sprite.x;\r\n\t\t\t\ty=y-tHalfPadding-sprite.y;\r\n\t\t\t\tp.setTo(x,y);\r\n\t\t\t\tmat.transformPoint(p);\r\n\t\t\t\tx=p.x+b.x;\r\n\t\t\t\ty=p.y+b.y;\r\n\t\t\t\tshaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\t\t\tMatrix.TEMP.identity();\r\n\t\t\t\t(context.ctx).drawTarget(scope,x,y,b.width,b.height,Matrix.TEMP,\"out\",shaderValue,null,BlendMode.TOINT.overlay);\r\n\t\t\t\tsubmit=SubmitCMD.create([scope],Filter._recycleScope);\r\n\t\t\t\tcontext.addRenderObject(submit);\r\n\t\t\t\tmat.destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tFloat32Array.prototype.slice || (Float32Array.prototype.slice=WebGL._float32ArraySlice);\r\n\t\tUint16Array.prototype.slice || (Uint16Array.prototype.slice=WebGL._uint16ArraySlice);\r\n\t\tUint8Array.prototype.slice || (Uint8Array.prototype.slice=WebGL._uint8ArraySlice);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tWebGL.onStageResize=function(width,height){\r\n\t\tif (WebGL.mainContext==null)return;\r\n\t\tWebGL.mainContext.viewport(0,0,width,height);\r\n\t\tRenderState2D.width=width;\r\n\t\tRenderState2D.height=height;\r\n\t}\r\n\r\n\tWebGL.onInvalidGLRes=function(){\r\n\t\tAtlasResourceManager.instance.freeAll();\r\n\t\tResourceManager.releaseContentManagers(true);\r\n\t\tWebGL.doNodeRepaint(Laya.stage);\r\n\t\tWebGL.mainContext.viewport(0,0,RenderState2D.width,RenderState2D.height);\r\n\t\tLaya.stage.event(/*laya.events.Event.DEVICE_LOST*/\"devicelost\");\r\n\t}\r\n\r\n\tWebGL.doNodeRepaint=function(sprite){\r\n\t\t(sprite.numChildren==0)&& (sprite.repaint());\r\n\t\tfor (var i=0;i < sprite.numChildren;i++)\r\n\t\tWebGL.doNodeRepaint(sprite.getChildAt(i));\r\n\t}\r\n\r\n\tWebGL.init=function(canvas,width,height){\r\n\t\tWebGL.mainCanvas=canvas;\r\n\t\tHTMLCanvas._createContext=function (canvas){\r\n\t\t\treturn new WebGLContext2D(canvas);\r\n\t\t}\r\n\t\tWebGLCanvas._createContext=function (canvas){\r\n\t\t\treturn new WebGLContext2D(canvas);\r\n\t\t};\r\n\t\tvar gl=laya.webgl.WebGL.mainContext;\r\n\t\tif (gl.getShaderPrecisionFormat !=null){\r\n\t\t\tvar vertexPrecisionFormat=gl.getShaderPrecisionFormat(/*laya.webgl.WebGLContext.VERTEX_SHADER*/0x8B31,/*laya.webgl.WebGLContext.HIGH_FLOAT*/0x8DF2);\r\n\t\t\tvar framePrecisionFormat=gl.getShaderPrecisionFormat(/*laya.webgl.WebGLContext.FRAGMENT_SHADER*/0x8B30,/*laya.webgl.WebGLContext.HIGH_FLOAT*/0x8DF2);\r\n\t\t\tWebGL.shaderHighPrecision=(vertexPrecisionFormat.precision&&framePrecisionFormat.precision)? true :false;\r\n\t\t\t}else {\r\n\t\t\tWebGL.shaderHighPrecision=false;\r\n\t\t}\r\n\t\tWebGL.compressAstc=gl.getExtension(\"WEBGL_compressed_texture_astc\");\r\n\t\tWebGL.compressAtc=gl.getExtension(\"WEBGL_compressed_texture_atc\");\r\n\t\tWebGL.compressEtc=gl.getExtension(\"WEBGL_compressed_texture_etc\");\r\n\t\tWebGL.compressEtc1=gl.getExtension(\"WEBGL_compressed_texture_etc1\");\r\n\t\tWebGL.compressPvrtc=gl.getExtension(\"WEBGL_compressed_texture_pvrtc\");\r\n\t\tWebGL.compressS3tc=gl.getExtension(\"WEBGL_compressed_texture_s3tc\");\r\n\t\tWebGL.compressS3tc_srgb=gl.getExtension(\"WEBGL_compressed_texture_s3tc_srgb\");\r\n\t\tgl.deleteTexture1=gl.deleteTexture;\r\n\t\tgl.deleteTexture=function (t){\r\n\t\t\tif (t==WebGLContext.curBindTexValue){\r\n\t\t\t\tWebGLContext.curBindTexValue=null;\r\n\t\t\t}\r\n\t\t\tgl.deleteTexture1(t);\r\n\t\t}\r\n\t\tWebGL.onStageResize(width,height);\r\n\t\tif (WebGL.mainContext==null)\r\n\t\t\tthrow new Error(\"webGL getContext err!\");\r\n\t\tSystem.__init__();\r\n\t\tAtlasResourceManager.__init__();\r\n\t\tShaderDefines2D.__init__();\r\n\t\tSubmit.__init__();\r\n\t\tWebGLContext2D.__init__();\r\n\t\tValue2D.__init__();\r\n\t\tShader2D.__init__();\r\n\t\tBuffer2D.__int__(gl);\r\n\t\tBlendMode._init_(gl);\r\n\t\tif (Render.isConchApp){\r\n\t\t\t/*__JS__ */conch.setOnInvalidGLRes(WebGL.onInvalidGLRes);\r\n\t\t}\r\n\t}\r\n\r\n\tWebGL.compressAstc=null;\r\n\tWebGL.compressAtc=null;\r\n\tWebGL.compressEtc=null;\r\n\tWebGL.compressEtc1=null;\r\n\tWebGL.compressPvrtc=null;\r\n\tWebGL.compressS3tc=null;\r\n\tWebGL.compressS3tc_srgb=null;\r\n\tWebGL.mainCanvas=null;\r\n\tWebGL.mainContext=null;\r\n\tWebGL.antialias=true;\r\n\tWebGL.shaderHighPrecision=false;\r\n\t__static(WebGL,\r\n\t['_bg_null',function(){return this._bg_null=[0,0,0,0];}\r\n\t]);\r\n\treturn WebGL;\r\n})()\r\n\r\n\r\n//class laya.webgl.WebGLContext\r\nvar WebGLContext=(function(){\r\n\tfunction WebGLContext(){}\r\n\t__class(WebGLContext,'laya.webgl.WebGLContext');\r\n\tWebGLContext.UseProgram=function(program){\r\n\t\tif (WebGLContext._useProgram===program)return false;\r\n\t\tWebGL.mainContext.useProgram(program);\r\n\t\tWebGLContext._useProgram=program;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tWebGLContext.setDepthTest=function(gl,value){\r\n\t\tvalue!==WebGLContext._depthTest && (WebGLContext._depthTest=value,value?gl.enable(/*CLASS CONST:laya.webgl.WebGLContext.DEPTH_TEST*/0x0B71):gl.disable(/*CLASS CONST:laya.webgl.WebGLContext.DEPTH_TEST*/0x0B71));\r\n\t}\r\n\r\n\tWebGLContext.setDepthMask=function(gl,value){\r\n\t\tvalue!==WebGLContext._depthMask && (WebGLContext._depthMask=value,gl.depthMask(value));\r\n\t}\r\n\r\n\tWebGLContext.setDepthFunc=function(gl,value){\r\n\t\tvalue!==WebGLContext._depthFunc && (WebGLContext._depthFunc=value,gl.depthFunc(value));\r\n\t}\r\n\r\n\tWebGLContext.setBlend=function(gl,value){\r\n\t\tvalue!==WebGLContext._blend && (WebGLContext._blend=value,value?gl.enable(/*CLASS CONST:laya.webgl.WebGLContext.BLEND*/0x0BE2):gl.disable(/*CLASS CONST:laya.webgl.WebGLContext.BLEND*/0x0BE2));\r\n\t}\r\n\r\n\tWebGLContext.setBlendFunc=function(gl,sFactor,dFactor){\r\n\t\t(sFactor!==WebGLContext._sFactor||dFactor!==WebGLContext._dFactor)&& (WebGLContext._sFactor=sFactor,WebGLContext._dFactor=dFactor,gl.blendFunc(sFactor,dFactor));\r\n\t}\r\n\r\n\tWebGLContext.setCullFace=function(gl,value){\r\n\t\tvalue!==WebGLContext._cullFace && (WebGLContext._cullFace=value,value?gl.enable(/*CLASS CONST:laya.webgl.WebGLContext.CULL_FACE*/0x0B44):gl.disable(/*CLASS CONST:laya.webgl.WebGLContext.CULL_FACE*/0x0B44));\r\n\t}\r\n\r\n\tWebGLContext.setFrontFace=function(gl,value){\r\n\t\tvalue!==WebGLContext._frontFace && (WebGLContext._frontFace=value,gl.frontFace(value));\r\n\t}\r\n\r\n\tWebGLContext.bindTexture=function(gl,target,texture){\r\n\t\tgl.bindTexture(target,texture);\r\n\t\tWebGLContext.curBindTexTarget=target;\r\n\t\tWebGLContext.curBindTexValue=texture;\r\n\t}\r\n\r\n\tWebGLContext.DEPTH_BUFFER_BIT=0x00000100;\r\n\tWebGLContext.STENCIL_BUFFER_BIT=0x00000400;\r\n\tWebGLContext.COLOR_BUFFER_BIT=0x00004000;\r\n\tWebGLContext.POINTS=0x0000;\r\n\tWebGLContext.LINES=0x0001;\r\n\tWebGLContext.LINE_LOOP=0x0002;\r\n\tWebGLContext.LINE_STRIP=0x0003;\r\n\tWebGLContext.TRIANGLES=0x0004;\r\n\tWebGLContext.TRIANGLE_STRIP=0x0005;\r\n\tWebGLContext.TRIANGLE_FAN=0x0006;\r\n\tWebGLContext.ZERO=0;\r\n\tWebGLContext.ONE=1;\r\n\tWebGLContext.SRC_COLOR=0x0300;\r\n\tWebGLContext.ONE_MINUS_SRC_COLOR=0x0301;\r\n\tWebGLContext.SRC_ALPHA=0x0302;\r\n\tWebGLContext.ONE_MINUS_SRC_ALPHA=0x0303;\r\n\tWebGLContext.DST_ALPHA=0x0304;\r\n\tWebGLContext.ONE_MINUS_DST_ALPHA=0x0305;\r\n\tWebGLContext.DST_COLOR=0x0306;\r\n\tWebGLContext.ONE_MINUS_DST_COLOR=0x0307;\r\n\tWebGLContext.SRC_ALPHA_SATURATE=0x0308;\r\n\tWebGLContext.FUNC_ADD=0x8006;\r\n\tWebGLContext.BLEND_EQUATION=0x8009;\r\n\tWebGLContext.BLEND_EQUATION_RGB=0x8009;\r\n\tWebGLContext.BLEND_EQUATION_ALPHA=0x883D;\r\n\tWebGLContext.FUNC_SUBTRACT=0x800A;\r\n\tWebGLContext.FUNC_REVERSE_SUBTRACT=0x800B;\r\n\tWebGLContext.BLEND_DST_RGB=0x80C8;\r\n\tWebGLContext.BLEND_SRC_RGB=0x80C9;\r\n\tWebGLContext.BLEND_DST_ALPHA=0x80CA;\r\n\tWebGLContext.BLEND_SRC_ALPHA=0x80CB;\r\n\tWebGLContext.CONSTANT_COLOR=0x8001;\r\n\tWebGLContext.ONE_MINUS_CONSTANT_COLOR=0x8002;\r\n\tWebGLContext.CONSTANT_ALPHA=0x8003;\r\n\tWebGLContext.ONE_MINUS_CONSTANT_ALPHA=0x8004;\r\n\tWebGLContext.BLEND_COLOR=0x8005;\r\n\tWebGLContext.ARRAY_BUFFER=0x8892;\r\n\tWebGLContext.ELEMENT_ARRAY_BUFFER=0x8893;\r\n\tWebGLContext.ARRAY_BUFFER_BINDING=0x8894;\r\n\tWebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=0x8895;\r\n\tWebGLContext.STREAM_DRAW=0x88E0;\r\n\tWebGLContext.STATIC_DRAW=0x88E4;\r\n\tWebGLContext.DYNAMIC_DRAW=0x88E8;\r\n\tWebGLContext.BUFFER_SIZE=0x8764;\r\n\tWebGLContext.BUFFER_USAGE=0x8765;\r\n\tWebGLContext.CURRENT_VERTEX_ATTRIB=0x8626;\r\n\tWebGLContext.FRONT=0x0404;\r\n\tWebGLContext.BACK=0x0405;\r\n\tWebGLContext.CULL_FACE=0x0B44;\r\n\tWebGLContext.FRONT_AND_BACK=0x0408;\r\n\tWebGLContext.BLEND=0x0BE2;\r\n\tWebGLContext.DITHER=0x0BD0;\r\n\tWebGLContext.STENCIL_TEST=0x0B90;\r\n\tWebGLContext.DEPTH_TEST=0x0B71;\r\n\tWebGLContext.SCISSOR_TEST=0x0C11;\r\n\tWebGLContext.POLYGON_OFFSET_FILL=0x8037;\r\n\tWebGLContext.SAMPLE_ALPHA_TO_COVERAGE=0x809E;\r\n\tWebGLContext.SAMPLE_COVERAGE=0x80A0;\r\n\tWebGLContext.NO_ERROR=0;\r\n\tWebGLContext.INVALID_ENUM=0x0500;\r\n\tWebGLContext.INVALID_VALUE=0x0501;\r\n\tWebGLContext.INVALID_OPERATION=0x0502;\r\n\tWebGLContext.OUT_OF_MEMORY=0x0505;\r\n\tWebGLContext.CW=0x0900;\r\n\tWebGLContext.CCW=0x0901;\r\n\tWebGLContext.LINE_WIDTH=0x0B21;\r\n\tWebGLContext.ALIASED_POINT_SIZE_RANGE=0x846D;\r\n\tWebGLContext.ALIASED_LINE_WIDTH_RANGE=0x846E;\r\n\tWebGLContext.CULL_FACE_MODE=0x0B45;\r\n\tWebGLContext.FRONT_FACE=0x0B46;\r\n\tWebGLContext.DEPTH_RANGE=0x0B70;\r\n\tWebGLContext.DEPTH_WRITEMASK=0x0B72;\r\n\tWebGLContext.DEPTH_CLEAR_VALUE=0x0B73;\r\n\tWebGLContext.DEPTH_FUNC=0x0B74;\r\n\tWebGLContext.STENCIL_CLEAR_VALUE=0x0B91;\r\n\tWebGLContext.STENCIL_FUNC=0x0B92;\r\n\tWebGLContext.STENCIL_FAIL=0x0B94;\r\n\tWebGLContext.STENCIL_PASS_DEPTH_FAIL=0x0B95;\r\n\tWebGLContext.STENCIL_PASS_DEPTH_PASS=0x0B96;\r\n\tWebGLContext.STENCIL_REF=0x0B97;\r\n\tWebGLContext.STENCIL_VALUE_MASK=0x0B93;\r\n\tWebGLContext.STENCIL_WRITEMASK=0x0B98;\r\n\tWebGLContext.STENCIL_BACK_FUNC=0x8800;\r\n\tWebGLContext.STENCIL_BACK_FAIL=0x8801;\r\n\tWebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=0x8802;\r\n\tWebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=0x8803;\r\n\tWebGLContext.STENCIL_BACK_REF=0x8CA3;\r\n\tWebGLContext.STENCIL_BACK_VALUE_MASK=0x8CA4;\r\n\tWebGLContext.STENCIL_BACK_WRITEMASK=0x8CA5;\r\n\tWebGLContext.VIEWPORT=0x0BA2;\r\n\tWebGLContext.SCISSOR_BOX=0x0C10;\r\n\tWebGLContext.COLOR_CLEAR_VALUE=0x0C22;\r\n\tWebGLContext.COLOR_WRITEMASK=0x0C23;\r\n\tWebGLContext.UNPACK_ALIGNMENT=0x0CF5;\r\n\tWebGLContext.PACK_ALIGNMENT=0x0D05;\r\n\tWebGLContext.MAX_TEXTURE_SIZE=0x0D33;\r\n\tWebGLContext.MAX_VIEWPORT_DIMS=0x0D3A;\r\n\tWebGLContext.SUBPIXEL_BITS=0x0D50;\r\n\tWebGLContext.RED_BITS=0x0D52;\r\n\tWebGLContext.GREEN_BITS=0x0D53;\r\n\tWebGLContext.BLUE_BITS=0x0D54;\r\n\tWebGLContext.ALPHA_BITS=0x0D55;\r\n\tWebGLContext.DEPTH_BITS=0x0D56;\r\n\tWebGLContext.STENCIL_BITS=0x0D57;\r\n\tWebGLContext.POLYGON_OFFSET_UNITS=0x2A00;\r\n\tWebGLContext.POLYGON_OFFSET_FACTOR=0x8038;\r\n\tWebGLContext.TEXTURE_BINDING_2D=0x8069;\r\n\tWebGLContext.SAMPLE_BUFFERS=0x80A8;\r\n\tWebGLContext.SAMPLES=0x80A9;\r\n\tWebGLContext.SAMPLE_COVERAGE_VALUE=0x80AA;\r\n\tWebGLContext.SAMPLE_COVERAGE_INVERT=0x80AB;\r\n\tWebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=0x86A2;\r\n\tWebGLContext.COMPRESSED_TEXTURE_FORMATS=0x86A3;\r\n\tWebGLContext.DONT_CARE=0x1100;\r\n\tWebGLContext.FASTEST=0x1101;\r\n\tWebGLContext.NICEST=0x1102;\r\n\tWebGLContext.GENERATE_MIPMAP_HINT=0x8192;\r\n\tWebGLContext.BYTE=0x1400;\r\n\tWebGLContext.UNSIGNED_BYTE=0x1401;\r\n\tWebGLContext.SHORT=0x1402;\r\n\tWebGLContext.UNSIGNED_SHORT=0x1403;\r\n\tWebGLContext.INT=0x1404;\r\n\tWebGLContext.UNSIGNED_INT=0x1405;\r\n\tWebGLContext.FLOAT=0x1406;\r\n\tWebGLContext.DEPTH_COMPONENT=0x1902;\r\n\tWebGLContext.ALPHA=0x1906;\r\n\tWebGLContext.RGB=0x1907;\r\n\tWebGLContext.RGBA=0x1908;\r\n\tWebGLContext.LUMINANCE=0x1909;\r\n\tWebGLContext.LUMINANCE_ALPHA=0x190A;\r\n\tWebGLContext.UNSIGNED_SHORT_4_4_4_4=0x8033;\r\n\tWebGLContext.UNSIGNED_SHORT_5_5_5_1=0x8034;\r\n\tWebGLContext.UNSIGNED_SHORT_5_6_5=0x8363;\r\n\tWebGLContext.FRAGMENT_SHADER=0x8B30;\r\n\tWebGLContext.VERTEX_SHADER=0x8B31;\r\n\tWebGLContext.MAX_VERTEX_ATTRIBS=0x8869;\r\n\tWebGLContext.MAX_VERTEX_UNIFORM_VECTORS=0x8DFB;\r\n\tWebGLContext.MAX_VARYING_VECTORS=0x8DFC;\r\n\tWebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=0x8B4D;\r\n\tWebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0x8B4C;\r\n\tWebGLContext.MAX_TEXTURE_IMAGE_UNITS=0x8872;\r\n\tWebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=0x8DFD;\r\n\tWebGLContext.SHADER_TYPE=0x8B4F;\r\n\tWebGLContext.DELETE_STATUS=0x8B80;\r\n\tWebGLContext.LINK_STATUS=0x8B82;\r\n\tWebGLContext.VALIDATE_STATUS=0x8B83;\r\n\tWebGLContext.ATTACHED_SHADERS=0x8B85;\r\n\tWebGLContext.ACTIVE_UNIFORMS=0x8B86;\r\n\tWebGLContext.ACTIVE_ATTRIBUTES=0x8B89;\r\n\tWebGLContext.SHADING_LANGUAGE_VERSION=0x8B8C;\r\n\tWebGLContext.CURRENT_PROGRAM=0x8B8D;\r\n\tWebGLContext.NEVER=0x0200;\r\n\tWebGLContext.LESS=0x0201;\r\n\tWebGLContext.EQUAL=0x0202;\r\n\tWebGLContext.LEQUAL=0x0203;\r\n\tWebGLContext.GREATER=0x0204;\r\n\tWebGLContext.NOTEQUAL=0x0205;\r\n\tWebGLContext.GEQUAL=0x0206;\r\n\tWebGLContext.ALWAYS=0x0207;\r\n\tWebGLContext.KEEP=0x1E00;\r\n\tWebGLContext.REPLACE=0x1E01;\r\n\tWebGLContext.INCR=0x1E02;\r\n\tWebGLContext.DECR=0x1E03;\r\n\tWebGLContext.INVERT=0x150A;\r\n\tWebGLContext.INCR_WRAP=0x8507;\r\n\tWebGLContext.DECR_WRAP=0x8508;\r\n\tWebGLContext.VENDOR=0x1F00;\r\n\tWebGLContext.RENDERER=0x1F01;\r\n\tWebGLContext.VERSION=0x1F02;\r\n\tWebGLContext.NEAREST=0x2600;\r\n\tWebGLContext.LINEAR=0x2601;\r\n\tWebGLContext.NEAREST_MIPMAP_NEAREST=0x2700;\r\n\tWebGLContext.LINEAR_MIPMAP_NEAREST=0x2701;\r\n\tWebGLContext.NEAREST_MIPMAP_LINEAR=0x2702;\r\n\tWebGLContext.LINEAR_MIPMAP_LINEAR=0x2703;\r\n\tWebGLContext.TEXTURE_MAG_FILTER=0x2800;\r\n\tWebGLContext.TEXTURE_MIN_FILTER=0x2801;\r\n\tWebGLContext.TEXTURE_WRAP_S=0x2802;\r\n\tWebGLContext.TEXTURE_WRAP_T=0x2803;\r\n\tWebGLContext.TEXTURE_2D=0x0DE1;\r\n\tWebGLContext.TEXTURE=0x1702;\r\n\tWebGLContext.TEXTURE_CUBE_MAP=0x8513;\r\n\tWebGLContext.TEXTURE_BINDING_CUBE_MAP=0x8514;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=0x8515;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=0x8516;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=0x8517;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=0x8518;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=0x8519;\r\n\tWebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=0x851A;\r\n\tWebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=0x851C;\r\n\tWebGLContext.TEXTURE0=0x84C0;\r\n\tWebGLContext.TEXTURE1=0x84C1;\r\n\tWebGLContext.TEXTURE2=0x84C2;\r\n\tWebGLContext.TEXTURE3=0x84C3;\r\n\tWebGLContext.TEXTURE4=0x84C4;\r\n\tWebGLContext.TEXTURE5=0x84C5;\r\n\tWebGLContext.TEXTURE6=0x84C6;\r\n\tWebGLContext.TEXTURE7=0x84C7;\r\n\tWebGLContext.TEXTURE8=0x84C8;\r\n\tWebGLContext.TEXTURE9=0x84C9;\r\n\tWebGLContext.TEXTURE10=0x84CA;\r\n\tWebGLContext.TEXTURE11=0x84CB;\r\n\tWebGLContext.TEXTURE12=0x84CC;\r\n\tWebGLContext.TEXTURE13=0x84CD;\r\n\tWebGLContext.TEXTURE14=0x84CE;\r\n\tWebGLContext.TEXTURE15=0x84CF;\r\n\tWebGLContext.TEXTURE16=0x84D0;\r\n\tWebGLContext.TEXTURE17=0x84D1;\r\n\tWebGLContext.TEXTURE18=0x84D2;\r\n\tWebGLContext.TEXTURE19=0x84D3;\r\n\tWebGLContext.TEXTURE20=0x84D4;\r\n\tWebGLContext.TEXTURE21=0x84D5;\r\n\tWebGLContext.TEXTURE22=0x84D6;\r\n\tWebGLContext.TEXTURE23=0x84D7;\r\n\tWebGLContext.TEXTURE24=0x84D8;\r\n\tWebGLContext.TEXTURE25=0x84D9;\r\n\tWebGLContext.TEXTURE26=0x84DA;\r\n\tWebGLContext.TEXTURE27=0x84DB;\r\n\tWebGLContext.TEXTURE28=0x84DC;\r\n\tWebGLContext.TEXTURE29=0x84DD;\r\n\tWebGLContext.TEXTURE30=0x84DE;\r\n\tWebGLContext.TEXTURE31=0x84DF;\r\n\tWebGLContext.ACTIVE_TEXTURE=0x84E0;\r\n\tWebGLContext.REPEAT=0x2901;\r\n\tWebGLContext.CLAMP_TO_EDGE=0x812F;\r\n\tWebGLContext.MIRRORED_REPEAT=0x8370;\r\n\tWebGLContext.FLOAT_VEC2=0x8B50;\r\n\tWebGLContext.FLOAT_VEC3=0x8B51;\r\n\tWebGLContext.FLOAT_VEC4=0x8B52;\r\n\tWebGLContext.INT_VEC2=0x8B53;\r\n\tWebGLContext.INT_VEC3=0x8B54;\r\n\tWebGLContext.INT_VEC4=0x8B55;\r\n\tWebGLContext.BOOL=0x8B56;\r\n\tWebGLContext.BOOL_VEC2=0x8B57;\r\n\tWebGLContext.BOOL_VEC3=0x8B58;\r\n\tWebGLContext.BOOL_VEC4=0x8B59;\r\n\tWebGLContext.FLOAT_MAT2=0x8B5A;\r\n\tWebGLContext.FLOAT_MAT3=0x8B5B;\r\n\tWebGLContext.FLOAT_MAT4=0x8B5C;\r\n\tWebGLContext.SAMPLER_2D=0x8B5E;\r\n\tWebGLContext.SAMPLER_CUBE=0x8B60;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=0x8622;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=0x8623;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=0x8624;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=0x8625;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=0x886A;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=0x8645;\r\n\tWebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=0x889F;\r\n\tWebGLContext.COMPILE_STATUS=0x8B81;\r\n\tWebGLContext.LOW_FLOAT=0x8DF0;\r\n\tWebGLContext.MEDIUM_FLOAT=0x8DF1;\r\n\tWebGLContext.HIGH_FLOAT=0x8DF2;\r\n\tWebGLContext.LOW_INT=0x8DF3;\r\n\tWebGLContext.MEDIUM_INT=0x8DF4;\r\n\tWebGLContext.HIGH_INT=0x8DF5;\r\n\tWebGLContext.FRAMEBUFFER=0x8D40;\r\n\tWebGLContext.RENDERBUFFER=0x8D41;\r\n\tWebGLContext.RGBA4=0x8056;\r\n\tWebGLContext.RGB5_A1=0x8057;\r\n\tWebGLContext.RGB565=0x8D62;\r\n\tWebGLContext.DEPTH_COMPONENT16=0x81A5;\r\n\tWebGLContext.STENCIL_INDEX=0x1901;\r\n\tWebGLContext.STENCIL_INDEX8=0x8D48;\r\n\tWebGLContext.DEPTH_STENCIL=0x84F9;\r\n\tWebGLContext.RENDERBUFFER_WIDTH=0x8D42;\r\n\tWebGLContext.RENDERBUFFER_HEIGHT=0x8D43;\r\n\tWebGLContext.RENDERBUFFER_INTERNAL_FORMAT=0x8D44;\r\n\tWebGLContext.RENDERBUFFER_RED_SIZE=0x8D50;\r\n\tWebGLContext.RENDERBUFFER_GREEN_SIZE=0x8D51;\r\n\tWebGLContext.RENDERBUFFER_BLUE_SIZE=0x8D52;\r\n\tWebGLContext.RENDERBUFFER_ALPHA_SIZE=0x8D53;\r\n\tWebGLContext.RENDERBUFFER_DEPTH_SIZE=0x8D54;\r\n\tWebGLContext.RENDERBUFFER_STENCIL_SIZE=0x8D55;\r\n\tWebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=0x8CD0;\r\n\tWebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=0x8CD1;\r\n\tWebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=0x8CD2;\r\n\tWebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=0x8CD3;\r\n\tWebGLContext.COLOR_ATTACHMENT0=0x8CE0;\r\n\tWebGLContext.DEPTH_ATTACHMENT=0x8D00;\r\n\tWebGLContext.STENCIL_ATTACHMENT=0x8D20;\r\n\tWebGLContext.DEPTH_STENCIL_ATTACHMENT=0x821A;\r\n\tWebGLContext.NONE=0;\r\n\tWebGLContext.FRAMEBUFFER_COMPLETE=0x8CD5;\r\n\tWebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=0x8CD6;\r\n\tWebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=0x8CD7;\r\n\tWebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=0x8CD9;\r\n\tWebGLContext.FRAMEBUFFER_UNSUPPORTED=0x8CDD;\r\n\tWebGLContext.FRAMEBUFFER_BINDING=0x8CA6;\r\n\tWebGLContext.RENDERBUFFER_BINDING=0x8CA7;\r\n\tWebGLContext.MAX_RENDERBUFFER_SIZE=0x84E8;\r\n\tWebGLContext.INVALID_FRAMEBUFFER_OPERATION=0x0506;\r\n\tWebGLContext.UNPACK_FLIP_Y_WEBGL=0x9240;\r\n\tWebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=0x9241;\r\n\tWebGLContext.CONTEXT_LOST_WEBGL=0x9242;\r\n\tWebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=0x9243;\r\n\tWebGLContext.BROWSER_DEFAULT_WEBGL=0x9244;\r\n\tWebGLContext._useProgram=null;\r\n\tWebGLContext._depthTest=true;\r\n\tWebGLContext._depthMask=true;\r\n\tWebGLContext._blend=false;\r\n\tWebGLContext._cullFace=false;\r\n\tWebGLContext.curBindTexTarget=null;\r\n\tWebGLContext.curBindTexValue=null;\r\n\t__static(WebGLContext,\r\n\t['_depthFunc',function(){return this._depthFunc=/*CLASS CONST:laya.webgl.WebGLContext.LESS*/0x0201;},'_sFactor',function(){return this._sFactor=/*CLASS CONST:laya.webgl.WebGLContext.ONE*/1;},'_dFactor',function(){return this._dFactor=/*CLASS CONST:laya.webgl.WebGLContext.ZERO*/0;},'_frontFace',function(){return this._frontFace=/*CLASS CONST:laya.webgl.WebGLContext.CCW*/0x0901;}\r\n\t]);\r\n\treturn WebGLContext;\r\n})()\r\n\r\n\r\n//class laya.webgl.display.GraphicsGL extends laya.display.Graphics\r\nvar GraphicsGL=(function(_super){\r\n\tfunction GraphicsGL(){\r\n\t\tGraphicsGL.__super.call(this);\r\n\t}\r\n\r\n\t__class(GraphicsGL,'laya.webgl.display.GraphicsGL',_super);\r\n\tvar __proto=GraphicsGL.prototype;\r\n\t__proto.setShader=function(shader){\r\n\t\tthis._saveToCmd(Render.context._setShader,[shader]);\r\n\t}\r\n\r\n\t__proto.setIBVB=function(x,y,ib,vb,numElement,shader){\r\n\t\tthis._saveToCmd(Render.context._setIBVB,[x,y,ib,vb,numElement,shader]);\r\n\t}\r\n\r\n\t__proto.drawParticle=function(x,y,ps){\r\n\t\tvar pt=RunDriver.createParticleTemplate2D(ps);\r\n\t\tpt.x=x;\r\n\t\tpt.y=y;\r\n\t\tthis._saveToCmd(Render.context._drawParticle,[pt]);\r\n\t}\r\n\r\n\treturn GraphicsGL;\r\n})(Graphics)\r\n\r\n\r\n//class laya.webgl.canvas.WebGLContext2D extends laya.resource.Context\r\nvar WebGLContext2D=(function(_super){\r\n\tvar ContextParams;\r\n\tfunction WebGLContext2D(c){\r\n\t\tthis._x=0;\r\n\t\tthis._y=0;\r\n\t\tthis._id=++WebGLContext2D._COUNT;\r\n\t\t//this._other=null;\r\n\t\tthis._path=null;\r\n\t\t//this._primitiveValue2D=null;\r\n\t\tthis._drawCount=1;\r\n\t\tthis._maxNumEle=0;\r\n\t\tthis._clear=false;\r\n\t\tthis._isMain=false;\r\n\t\tthis._atlasResourceChange=0;\r\n\t\tthis._submits=null;\r\n\t\tthis._curSubmit=null;\r\n\t\tthis._ib=null;\r\n\t\tthis._vb=null;\r\n\t\t//this._curMat=null;\r\n\t\tthis._nBlendType=0;\r\n\t\t//this._save=null;\r\n\t\t//this._targets=null;\r\n\t\t//this._renderKey=NaN;\r\n\t\tthis._saveMark=null;\r\n\t\tthis._shader2D=null;\r\n\t\t/**所cacheAs精灵*/\r\n\t\t//this.sprite=null;\r\n\t\t/*******************************************start矢量绘制***************************************************/\r\n\t\tthis.mId=-1;\r\n\t\tthis.mHaveKey=false;\r\n\t\tthis.mHaveLineKey=false;\r\n\t\tthis.mX=0;\r\n\t\tthis.mY=0;\r\n\t\tWebGLContext2D.__super.call(this);\r\n\t\tthis._width=99999999;\r\n\t\tthis._height=99999999;\r\n\t\tthis._clipRect=WebGLContext2D.MAXCLIPRECT;\r\n\t\tthis.mOutPoint\r\n\t\tthis._canvas=c;\r\n\t\tWebGLContext2D._contextcount++;\r\n\t\tif (Render.isFlash){\r\n\t\t\tthis._ib=IndexBuffer2D.create(/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4);\r\n\t\t\tGlUtils.fillIBQuadrangle(this._ib,16);\r\n\t\t}else\r\n\t\tthis._ib=IndexBuffer2D.QuadrangleIB;\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t__class(WebGLContext2D,'laya.webgl.canvas.WebGLContext2D',_super);\r\n\tvar __proto=WebGLContext2D.prototype;\r\n\t__proto.setIsMainContext=function(){\r\n\t\tthis._isMain=true;\r\n\t}\r\n\r\n\t__proto.clearBG=function(r,g,b,a){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.clearColor(r,g,b,a);\r\n\t\tgl.clear(/*laya.webgl.WebGLContext.COLOR_BUFFER_BIT*/0x00004000);\r\n\t}\r\n\r\n\t__proto._getSubmits=function(){\r\n\t\treturn this._submits;\r\n\t}\r\n\r\n\t__proto._releaseMem=function(){\r\n\t\tif (!this._submits)\r\n\t\t\treturn;\r\n\t\tthis._curMat.destroy();\r\n\t\tthis._curMat=null;\r\n\t\tthis._shader2D.destroy();\r\n\t\tthis._shader2D=null;\r\n\t\tfor (var i=0,n=this._submits._length;i < n;i++)\r\n\t\tthis._submits[i].releaseRender();\r\n\t\tthis._submits.length=0;\r\n\t\tthis._submits._length=0;\r\n\t\tthis._submits=null;\r\n\t\tthis._curSubmit=null;\r\n\t\tthis._path && this._path.recover();\r\n\t\tthis._path=null;\r\n\t\tthis._other && (this._other.font=null);\r\n\t\tthis._save=null;\r\n\t\tif (this._vb){\r\n\t\t\tthis._vb.releaseResource();\r\n\t\t\tthis._vb.destroy();\r\n\t\t\tthis._vb.destory();\r\n\t\t\tthis._vb=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.destroy=function(){\r\n\t\t--WebGLContext2D._contextcount;\r\n\t\tthis.sprite=null;\r\n\t\tthis._releaseMem();\r\n\t\tthis._targets && this._targets.destroy();\r\n\t\tthis._targets=null;\r\n\t\tthis._canvas=null;\r\n\t\tthis._ib && (this._ib !=IndexBuffer2D.QuadrangleIB)&& this._ib.releaseResource();\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tif (!this._submits){\r\n\t\t\tthis._other=ContextParams.DEFAULT;\r\n\t\t\tthis._curMat=Matrix.create();\r\n\t\t\tthis._vb=VertexBuffer2D.create(-1);\r\n\t\t\tthis._submits=[];\r\n\t\t\tthis._save=[SaveMark.Create(this)];\r\n\t\t\tthis._save.length=10;\r\n\t\t\tthis._shader2D=new Shader2D();\r\n\t\t}\r\n\t\tthis._vb.clear();\r\n\t\tthis._targets && (this._targets.repaint=true);\r\n\t\tthis._other=ContextParams.DEFAULT;\r\n\t\tthis._clear=true;\r\n\t\tthis._repaint=false;\r\n\t\tthis._drawCount=1;\r\n\t\tthis._renderKey=0;\r\n\t\tthis._other.lineWidth=this._shader2D.ALPHA=1.0;\r\n\t\tthis._nBlendType=0;\r\n\t\tthis._clipRect=WebGLContext2D.MAXCLIPRECT;\r\n\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\tthis._shader2D.glTexture=null;\r\n\t\tthis._shader2D.fillStyle=this._shader2D.strokeStyle=DrawStyle.DEFAULT;\r\n\t\tfor (var i=0,n=this._submits._length;i < n;i++)\r\n\t\tthis._submits[i].releaseRender();\r\n\t\tthis._submits._length=0;\r\n\t\tthis._curMat.identity();\r\n\t\tthis._other.clear();\r\n\t\tthis._saveMark=this._save[0];\r\n\t\tthis._save._length=1;\r\n\t}\r\n\r\n\t__proto.size=function(w,h){\r\n\t\tif (this._width !=w || this._height !=h){\r\n\t\t\tif (w==0 || h==0){\r\n\t\t\t\tif (this._vb._byteLength !=0){\r\n\t\t\t\t\tthis._width=w;\r\n\t\t\t\t\tthis._height=h;\r\n\t\t\t\t\tthis._vb.clear();\r\n\t\t\t\t\tthis._vb.upload();\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i=0,n=this._submits._length;i < n;i++)\r\n\t\t\t\tthis._submits[i].releaseRender();\r\n\t\t\t\tthis._submits.length=0;\r\n\t\t\t\tthis._submits._length=0;\r\n\t\t\t\tthis._curSubmit=null;\r\n\t\t\t\tthis._path && this._path.recover();\r\n\t\t\t\tthis._path=null;\r\n\t\t\t\tthis.sprite=null;\r\n\t\t\t\tthis._targets && (this._targets.destroy());\r\n\t\t\t\tthis._targets=null;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._width=w;\r\n\t\t\t\tthis._height=h;\r\n\t\t\t\tthis._targets && (this._targets.size(w,h));\r\n\t\t\t\tthis._canvas.memorySize-=this._canvas.memorySize;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (w===0 && h===0)this._releaseMem();\r\n\t}\r\n\r\n\t__proto._getTransformMatrix=function(){\r\n\t\treturn this._curMat;\r\n\t}\r\n\r\n\t__proto.translate=function(x,y){\r\n\t\tif (x!==0 || y!==0){\r\n\t\t\tSaveTranslate.save(this);\r\n\t\t\tif (this._curMat.bTransform){\r\n\t\t\t\tSaveTransform.save(this);\r\n\t\t\t\tthis._curMat.transformPointN(Point.TEMP.setTo(x,y));\r\n\t\t\t\tx=Point.TEMP.x;\r\n\t\t\t\ty=Point.TEMP.y;\r\n\t\t\t}\r\n\t\t\tthis._x+=x;\r\n\t\t\tthis._y+=y;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.save=function(){\r\n\t\tthis._save[this._save._length++]=SaveMark.Create(this);\r\n\t}\r\n\r\n\t__proto.restore=function(){\r\n\t\tvar sz=this._save._length;\r\n\t\tif (sz < 1)\r\n\t\t\treturn;\r\n\t\tfor (var i=sz-1;i >=0;i--){\r\n\t\t\tvar o=this._save[i];\r\n\t\t\to.restore(this);\r\n\t\t\tif (o.isSaveMark()){\r\n\t\t\t\tthis._save._length=i;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._fillText=function(txt,words,x,y,fontStr,color,strokeColor,lineWidth,textAlign,underLine){\r\n\t\t(underLine===void 0)&& (underLine=0);\r\n\t\tvar shader=this._shader2D;\r\n\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\tvar font=fontStr ? FontInContext.create(fontStr):this._other.font;\r\n\t\tif (AtlasResourceManager.enabled){\r\n\t\t\tif (shader.ALPHA!==curShader.ALPHA)\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\tDrawText.drawText(this,txt,words,this._curMat,font,textAlign || this._other.textAlign,color,strokeColor,lineWidth,x,y,underLine);\r\n\t\t\t}else {\r\n\t\t\tvar preDef=this._shader2D.defines.getValue();\r\n\t\t\tvar colorAdd=color ? Color.create(color)._color :shader.colorAdd;\r\n\t\t\tif (shader.ALPHA!==curShader.ALPHA || colorAdd!==shader.colorAdd || curShader.colorAdd!==shader.colorAdd){\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tshader.colorAdd=colorAdd;\r\n\t\t\t}\r\n\t\t\tDrawText.drawText(this,txt,words,this._curMat,font,textAlign || this._other.textAlign,color,strokeColor,lineWidth,x,y,underLine);\r\n\t\t}\r\n\t}\r\n\r\n\t//TODO:实现下划线\r\n\t__proto.fillWords=function(words,x,y,fontStr,color,underLine){\r\n\t\tthis._fillText(null,words,x,y,fontStr,color,null,-1,null,underLine);\r\n\t}\r\n\r\n\t__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){\r\n\t\tthis._fillBorderText(null,words,x,y,font,color,borderColor,lineWidth,null);\r\n\t}\r\n\r\n\t__proto.fillText=function(txt,x,y,fontStr,color,textAlign){\r\n\t\tthis._fillText(txt,null,x,y,fontStr,color,null,-1,textAlign);\r\n\t}\r\n\r\n\t__proto.strokeText=function(txt,x,y,fontStr,color,lineWidth,textAlign){\r\n\t\tthis._fillText(txt,null,x,y,fontStr,null,color,lineWidth || 1,textAlign);\r\n\t}\r\n\r\n\t__proto.fillBorderText=function(txt,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){\r\n\t\tthis._fillBorderText(txt,null,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign);\r\n\t}\r\n\r\n\t__proto._fillBorderText=function(txt,words,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){\r\n\t\tif (!AtlasResourceManager.enabled){\r\n\t\t\tthis._fillText(txt,words,x,y,fontStr,null,borderColor,lineWidth || 1,textAlign);\r\n\t\t\tthis._fillText(txt,words,x,y,fontStr,fillColor,null,-1,textAlign);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar shader=this._shader2D;\r\n\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\tif (shader.ALPHA!==curShader.ALPHA)\r\n\t\t\tshader.glTexture=null;\r\n\t\tvar font=fontStr ? (WebGLContext2D._fontTemp.setFont(fontStr),WebGLContext2D._fontTemp):this._other.font;\r\n\t\tDrawText.drawText(this,txt,words,this._curMat,font,textAlign || this._other.textAlign,fillColor,borderColor,lineWidth || 1,x,y,0);\r\n\t}\r\n\r\n\t__proto.fillRect=function(x,y,width,height,fillStyle){\r\n\t\tvar vb=this._vb;\r\n\t\tif (GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar pre=this._shader2D.fillStyle;\r\n\t\t\tfillStyle && (this._shader2D.fillStyle=DrawStyle.create(fillStyle));\r\n\t\t\tvar shader=this._shader2D;\r\n\t\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\t\tif (shader.fillStyle!==curShader.fillStyle || shader.ALPHA!==curShader.ALPHA){\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tvar submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0));\r\n\t\t\t\tsubmit.shaderValue.color=shader.fillStyle._color._color;\r\n\t\t\t\tsubmit.shaderValue.ALPHA=shader.ALPHA;\r\n\t\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\t}\r\n\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t\tthis._shader2D.fillStyle=pre;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){\r\n\t\tif (!(texture.loaded && texture.bitmap && texture.source)){\r\n\t\t\tif (this.sprite){\r\n\t\t\t\tLaya.timer.callLater(this,this._repaintSprite);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar vb=this._vb;\r\n\t\tvar w=texture.bitmap.width,h=texture.bitmap.height,uv=texture.uv;\r\n\t\tvar ox=offset.x % texture.width,oy=offset.y % texture.height;\r\n\t\tif (w !=other.w || h !=other.h){\r\n\t\t\tif (!other.w && !other.h){\r\n\t\t\t\tother.oy=other.ox=0;\r\n\t\t\t\tswitch (type){\r\n\t\t\t\t\tcase \"repeat\":\r\n\t\t\t\t\t\tother.width=width;\r\n\t\t\t\t\t\tother.height=height;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"repeat-x\":\r\n\t\t\t\t\t\tother.width=width;\r\n\t\t\t\t\t\tif (oy < 0){\r\n\t\t\t\t\t\t\tif (texture.height+oy > height){\r\n\t\t\t\t\t\t\t\tother.height=height;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tother.height=texture.height+oy;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\tother.oy=oy;\r\n\t\t\t\t\t\t\tif (texture.height+oy > height){\r\n\t\t\t\t\t\t\t\tother.height=height-oy;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tother.height=texture.height;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"repeat-y\":\r\n\t\t\t\t\t\tif (ox < 0){\r\n\t\t\t\t\t\t\tif (texture.width+ox > width){\r\n\t\t\t\t\t\t\t\tother.width=width;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tother.width=texture.width+ox;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\tother.ox=ox;\r\n\t\t\t\t\t\t\tif (texture.width+ox > width){\r\n\t\t\t\t\t\t\t\tother.width=width-ox;\r\n\t\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\t\tother.width=texture.width;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tother.height=height;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tdefault :\r\n\t\t\t\t\t\tother.width=width;\r\n\t\t\t\t\t\tother.height=height;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tother.w=w;\r\n\t\t\tother.h=h;\r\n\t\t\tother.uv=[0,0,other.width / w,0,other.width / w,other.height / h,0,other.height / h];\r\n\t\t}\r\n\t\tx+=other.ox;\r\n\t\ty+=other.oy;\r\n\t\tox-=other.ox;\r\n\t\toy-=other.oy;\r\n\t\tif (GlUtils.fillRectImgVb(vb,this._clipRect,x,y,other.width,other.height,other.uv,this._curMat,this._x,this._y,0,0)){\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar submit=SubmitTexture.create(this,this._ib,vb,((vb._byteLength-16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.FILLTEXTURE*/0x100,0));\r\n\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\tvar shaderValue=submit.shaderValue;\r\n\t\t\tshaderValue.textureHost=texture;\r\n\t\t\tvar tTextureX=uv[0] *w;\r\n\t\t\tvar tTextureY=uv[1] *h;\r\n\t\t\tvar tTextureW=(uv[2]-uv[0])*w;\r\n\t\t\tvar tTextureH=(uv[5]-uv[3])*h;\r\n\t\t\tvar tx=-ox / w;\r\n\t\t\tvar ty=-oy / h;\r\n\t\t\tshaderValue.u_TexRange[0]=tTextureX / w;\r\n\t\t\tshaderValue.u_TexRange[1]=tTextureW / w;\r\n\t\t\tshaderValue.u_TexRange[2]=tTextureY / h;\r\n\t\t\tshaderValue.u_TexRange[3]=tTextureH / h;\r\n\t\t\tshaderValue.u_offset[0]=tx;\r\n\t\t\tshaderValue.u_offset[1]=ty;\r\n\t\t\tif (AtlasResourceManager.enabled && !this._isMain)\r\n\t\t\t\tsubmit.addTexture(texture,(vb._byteLength >> 2)-/*CLASS CONST:laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16);\r\n\t\t\tthis._curSubmit=submit;\r\n\t\t\tsubmit._renderType=/*laya.webgl.submit.Submit.TYPE_FILLTEXTURE*/10017;\r\n\t\t\tsubmit._numEle+=6;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setShader=function(shader){\r\n\t\tSaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_SHADER*/0x100000,this._shader2D,true);\r\n\t\tthis._shader2D.shader=shader;\r\n\t}\r\n\r\n\t__proto.setFilters=function(value){\r\n\t\tSaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_FILTERS*/0x200000,this._shader2D,true);\r\n\t\tthis._shader2D.filters=value;\r\n\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\tthis._renderKey=0;\r\n\t\tthis._drawCount++;\r\n\t}\r\n\r\n\t__proto.drawTexture=function(tex,x,y,width,height,tx,ty){\r\n\t\tthis._drawTextureM(tex,x,y,width,height,tx,ty,null,1);\r\n\t}\r\n\r\n\t__proto.addTextureVb=function(invb,x,y){\r\n\t\tvar finalVB=this._curSubmit._vb || this._vb;\r\n\t\tvar vpos=(finalVB._byteLength >> 2);\r\n\t\tfinalVB.byteLength=((vpos+/*CLASS CONST:laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16)<< 2);\r\n\t\tvar vbdata=finalVB.getFloat32Array();\r\n\t\tfor (var i=0,ci=0;i < 16;i+=4){\r\n\t\t\tvbdata[vpos++]=invb[i]+x;\r\n\t\t\tvbdata[vpos++]=invb[i+1]+y;\r\n\t\t\tvbdata[vpos++]=invb[i+2];\r\n\t\t\tvbdata[vpos++]=invb[i+3];\r\n\t\t}\r\n\t\tthis._curSubmit._numEle+=6;\r\n\t\tthis._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);\r\n\t\tfinalVB._upload=true;\r\n\t}\r\n\r\n\t__proto.willDrawTexture=function(tex,alpha){\r\n\t\tif (!(tex.loaded && tex.bitmap && tex.source)){\r\n\t\t\tif (this.sprite){\r\n\t\t\t\tLaya.timer.callLater(this,this._repaintSprite);\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t};\r\n\t\tvar webGLImg=tex.bitmap;\r\n\t\tvar rid=webGLImg.id+this._shader2D.ALPHA *alpha+/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\tif (rid==this._renderKey)return rid;\r\n\t\tvar shader=this._shader2D;\r\n\t\tvar preAlpha=shader.ALPHA;\r\n\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\tshader.ALPHA *=alpha;\r\n\t\tthis._renderKey=rid;\r\n\t\tthis._drawCount++;\r\n\t\tshader.glTexture=webGLImg;\r\n\t\tvar vb=this._vb;\r\n\t\tvar submit=null;\r\n\t\tvar vbSize=(vb._byteLength / 32)*3;\r\n\t\tsubmit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0));\r\n\t\tthis._submits[this._submits._length++]=submit;\r\n\t\tsubmit.shaderValue.textureHost=tex;\r\n\t\tsubmit._renderType=/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\tsubmit._preIsSameTextureShader=this._curSubmit._renderType===/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016 && shader.ALPHA===curShader.ALPHA;\r\n\t\tthis._curSubmit=submit;\r\n\t\tshader.ALPHA=preAlpha;\r\n\t\treturn rid;\r\n\t}\r\n\r\n\t__proto.drawTextures=function(tex,pos,tx,ty){\r\n\t\tif (!(tex.loaded && tex.bitmap && tex.source)){\r\n\t\t\tthis.sprite && Laya.timer.callLater(this,this._repaintSprite);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar pre=this._clipRect;\r\n\t\tthis._clipRect=WebGLContext2D.MAXCLIPRECT;\r\n\t\tif (!this._drawTextureM(tex,pos[0],pos[1],tex.width,tex.height,tx,ty,null,1)){\r\n\t\t\talert(\"drawTextures err\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._clipRect=pre;\r\n\t\tStat.drawCall++;\r\n\t\tif (pos.length < 4)\r\n\t\t\treturn;\r\n\t\tvar finalVB=this._curSubmit._vb || this._vb;\r\n\t\tvar sx=this._curMat.a,sy=this._curMat.d;\r\n\t\tfor (var i=2,sz=pos.length;i < sz;i+=2){\r\n\t\t\tGlUtils.copyPreImgVb(finalVB,(pos[i]-pos[i-2])*sx,(pos[i+1]-pos[i-1])*sy);\r\n\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t}\r\n\t\tthis._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);\r\n\t}\r\n\r\n\t__proto._drawTextureM=function(tex,x,y,width,height,tx,ty,m,alpha){\r\n\t\tif (!(tex.loaded && tex.source)){\r\n\t\t\tif (this.sprite){\r\n\t\t\t\tLaya.timer.callLater(this,this._repaintSprite);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tvar finalVB=this._curSubmit._vb || this._vb;\r\n\t\tvar webGLImg=tex.bitmap;\r\n\t\tx+=tx;\r\n\t\ty+=ty;\r\n\t\tthis._drawCount++;\r\n\t\tvar rid=webGLImg.id+this._shader2D.ALPHA *alpha+/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\tif (rid !=this._renderKey){\r\n\t\t\tthis._renderKey=rid;\r\n\t\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\t\tvar shader=this._shader2D;\r\n\t\t\tvar alphaBack=shader.ALPHA;\r\n\t\t\tshader.ALPHA *=alpha;\r\n\t\t\tshader.glTexture=webGLImg;\r\n\t\t\tvar vb=this._vb;\r\n\t\t\tvar submit=null;\r\n\t\t\tvar vbSize=(vb._byteLength / 32)*3;\r\n\t\t\tsubmit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0));\r\n\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\tsubmit.shaderValue.textureHost=tex;\r\n\t\t\tsubmit._renderType=/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\t\tsubmit._preIsSameTextureShader=this._curSubmit._renderType===/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016 && shader.ALPHA===curShader.ALPHA;\r\n\t\t\tthis._curSubmit=submit;\r\n\t\t\tfinalVB=this._curSubmit._vb || this._vb;\r\n\t\t\tshader.ALPHA=alphaBack;\r\n\t\t}\r\n\t\tif (GlUtils.fillRectImgVb(finalVB,this._clipRect,x,y,width || tex.width,height || tex.height,tex.uv,m || this._curMat,this._x,this._y,0,0)){\r\n\t\t\tif (AtlasResourceManager.enabled && !this._isMain)\r\n\t\t\t\t(this._curSubmit).addTexture(tex,(finalVB._byteLength >> 2)-/*CLASS CONST:laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16);\r\n\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t\tthis._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t__proto._repaintSprite=function(){\r\n\t\tif(this.sprite)\r\n\t\t\tthis.sprite.repaint();\r\n\t}\r\n\r\n\t//}\r\n\t__proto._drawText=function(tex,x,y,width,height,m,tx,ty,dx,dy){\r\n\t\tvar webGLImg=tex.bitmap;\r\n\t\tthis._drawCount++;\r\n\t\tvar rid=webGLImg.id+this._shader2D.ALPHA+/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\tif (rid !=this._renderKey){\r\n\t\t\tthis._renderKey=rid;\r\n\t\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\t\tvar shader=this._shader2D;\r\n\t\t\tshader.glTexture=webGLImg;\r\n\t\t\tvar vb=this._vb;\r\n\t\t\tvar submit=null;\r\n\t\t\tvar submitID=NaN;\r\n\t\t\tvar vbSize=(vb._byteLength / 32)*3;\r\n\t\t\tif (AtlasResourceManager.enabled){\r\n\t\t\t\tsubmit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0));\r\n\t\t\t\t}else {\r\n\t\t\t\tsubmit=SubmitTexture.create(this,this._ib,vb,vbSize,TextSV.create());\r\n\t\t\t}\r\n\t\t\tsubmit._preIsSameTextureShader=this._curSubmit._renderType===/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016 && shader.ALPHA===curShader.ALPHA;\r\n\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\tsubmit.shaderValue.textureHost=tex;\r\n\t\t\tsubmit._renderType=/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016;\r\n\t\t\tthis._curSubmit=submit;\r\n\t\t}\r\n\t\ttex.active();\r\n\t\tvar finalVB=this._curSubmit._vb || this._vb;\r\n\t\tif (GlUtils.fillRectImgVb(finalVB,this._clipRect,x+tx,y+ty,width || tex.width,height || tex.height,tex.uv,m || this._curMat,this._x,this._y,dx,dy,true)){\r\n\t\t\tif (AtlasResourceManager.enabled && !this._isMain){\r\n\t\t\t\t(this._curSubmit).addTexture(tex,(finalVB._byteLength >> 2)-/*CLASS CONST:laya.webgl.canvas.WebGLContext2D._RECTVBSIZE*/16);\r\n\t\t\t}\r\n\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t\tthis._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.drawTextureWithTransform=function(tex,x,y,width,height,transform,tx,ty,alpha){\r\n\t\tif (!transform){\r\n\t\t\tthis._drawTextureM(tex,x,y,width,height,tx,ty,null,alpha);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar curMat=this._curMat;\r\n\t\tvar prex=this._x;\r\n\t\tvar prey=this._y;\r\n\t\t(tx!==0 || ty!==0)&& (this._x=tx *curMat.a+ty *curMat.c,this._y=ty *curMat.d+tx *curMat.b);\r\n\t\tif (transform && curMat.bTransform){\r\n\t\t\tMatrix.mul(transform,curMat,WebGLContext2D._tmpMatrix);\r\n\t\t\ttransform=WebGLContext2D._tmpMatrix;\r\n\t\t\ttransform._checkTransform();\r\n\t\t\t}else {\r\n\t\t\tthis._x+=curMat.tx;\r\n\t\t\tthis._y+=curMat.ty;\r\n\t\t}\r\n\t\tthis._drawTextureM(tex,x,y,width,height,0,0,transform,alpha);\r\n\t\tthis._x=prex;\r\n\t\tthis._y=prey;\r\n\t}\r\n\r\n\t__proto.fillQuadrangle=function(tex,x,y,point4,m){\r\n\t\tvar submit=this._curSubmit;\r\n\t\tvar vb=this._vb;\r\n\t\tvar shader=this._shader2D;\r\n\t\tvar curShader=submit.shaderValue;\r\n\t\tthis._renderKey=0;\r\n\t\tif (tex.bitmap){\r\n\t\t\tvar t_tex=tex.bitmap;\r\n\t\t\tif (shader.glTexture !=t_tex || shader.ALPHA!==curShader.ALPHA){\r\n\t\t\t\tshader.glTexture=t_tex;\r\n\t\t\t\tsubmit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0));\r\n\t\t\t\tsubmit.shaderValue.glTexture=t_tex;\r\n\t\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\t}\r\n\t\t\tGlUtils.fillQuadrangleImgVb(vb,x,y,point4,tex.uv,m || this._curMat,this._x,this._y);\r\n\t\t\t}else {\r\n\t\t\tif (!submit.shaderValue.fillStyle || !submit.shaderValue.fillStyle.equal(tex)|| shader.ALPHA!==curShader.ALPHA){\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tsubmit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0));\r\n\t\t\t\tsubmit.shaderValue.defines.add(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02);\r\n\t\t\t\tsubmit.shaderValue.fillStyle=DrawStyle.create(tex);\r\n\t\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\t}\r\n\t\t\tGlUtils.fillQuadrangleImgVb(vb,x,y,point4,Texture.DEF_UV,m || this._curMat,this._x,this._y);\r\n\t\t}\r\n\t\tsubmit._numEle+=6;\r\n\t}\r\n\r\n\t__proto.drawTexture2=function(x,y,pivotX,pivotY,transform,alpha,blendMode,args){\r\n\t\tif (alpha==0)return;\r\n\t\tvar curMat=this._curMat;\r\n\t\tthis._x=x *curMat.a+y *curMat.c;\r\n\t\tthis._y=y *curMat.d+x *curMat.b;\r\n\t\tif (transform){\r\n\t\t\tif (curMat.bTransform || transform.bTransform){\r\n\t\t\t\tMatrix.mul(transform,curMat,WebGLContext2D._tmpMatrix);\r\n\t\t\t\ttransform=WebGLContext2D._tmpMatrix;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._x+=transform.tx+curMat.tx;\r\n\t\t\t\tthis._y+=transform.ty+curMat.ty;\r\n\t\t\t\ttransform=Matrix.EMPTY;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (alpha===1 && !blendMode)\r\n\t\t\tthis._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1);\r\n\t\telse {\r\n\t\t\tvar preAlpha=this._shader2D.ALPHA;\r\n\t\t\tvar preblendType=this._nBlendType;\r\n\t\t\tthis._shader2D.ALPHA=alpha;\r\n\t\t\tblendMode && (this._nBlendType=BlendMode.TOINT(blendMode));\r\n\t\t\tthis._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1);\r\n\t\t\tthis._shader2D.ALPHA=preAlpha;\r\n\t\t\tthis._nBlendType=preblendType;\r\n\t\t}\r\n\t\tthis._x=this._y=0;\r\n\t}\r\n\r\n\t__proto.drawCanvas=function(canvas,x,y,width,height){\r\n\t\tvar src=canvas.context;\r\n\t\tthis._renderKey=0;\r\n\t\tif (src._targets){\r\n\t\t\tthis._submits[this._submits._length++]=SubmitCanvas.create(src,0,null);\r\n\t\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\t\tsrc._targets.drawTo(this,x,y,width,height);\r\n\t\t\t}else {\r\n\t\t\tvar submit=this._submits[this._submits._length++]=SubmitCanvas.create(src,this._shader2D.ALPHA,this._shader2D.filters);\r\n\t\t\tvar sx=width / canvas.width;\r\n\t\t\tvar sy=height / canvas.height;\r\n\t\t\tvar mat=submit._matrix;\r\n\t\t\tthis._curMat.copyTo(mat);\r\n\t\t\tsx !=1 && sy !=1 && mat.scale(sx,sy);\r\n\t\t\tvar tx=mat.tx,ty=mat.ty;\r\n\t\t\tmat.tx=mat.ty=0;\r\n\t\t\tmat.transformPoint(Point.TEMP.setTo(x,y));\r\n\t\t\tmat.translate(Point.TEMP.x+tx,Point.TEMP.y+ty);\r\n\t\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\t}\r\n\t\tif (Config.showCanvasMark){\r\n\t\t\tthis.save();\r\n\t\t\tthis.lineWidth=4;\r\n\t\t\tthis.strokeStyle=src._targets ? \"yellow\" :\"green\";\r\n\t\t\tthis.strokeRect(x-1,y-1,width+2,height+2,1);\r\n\t\t\tthis.strokeRect(x,y,width,height,1);\r\n\t\t\tthis.restore();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.drawTarget=function(scope,x,y,width,height,m,proName,shaderValue,uv,blend){\r\n\t\t(blend===void 0)&& (blend=-1);\r\n\t\tvar vb=this._vb;\r\n\t\tif (GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,uv || Texture.DEF_UV,m || this._curMat,this._x,this._y,0,0)){\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar shader=this._shader2D;\r\n\t\t\tshader.glTexture=null;\r\n\t\t\tvar curShader=this._curSubmit.shaderValue;\r\n\t\t\tvar submit=this._curSubmit=SubmitTarget.create(this,this._ib,vb,((vb._byteLength-16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,shaderValue,proName);\r\n\t\t\tif (blend==-1){\r\n\t\t\t\tsubmit.blendType=this._nBlendType;\r\n\t\t\t\t}else {\r\n\t\t\t\tsubmit.blendType=blend;\r\n\t\t\t}\r\n\t\t\tsubmit.scope=scope;\r\n\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.transform=function(a,b,c,d,tx,ty){\r\n\t\tSaveTransform.save(this);\r\n\t\tMatrix.mul(Matrix.TEMP.setTo(a,b,c,d,tx,ty),this._curMat,this._curMat);\r\n\t\tthis._curMat._checkTransform();\r\n\t}\r\n\r\n\t__proto.setTransformByMatrix=function(value){\r\n\t\tvalue.copyTo(this._curMat);\r\n\t}\r\n\r\n\t__proto.transformByMatrix=function(value){\r\n\t\tSaveTransform.save(this);\r\n\t\tMatrix.mul(value,this._curMat,this._curMat);\r\n\t\tthis._curMat._checkTransform();\r\n\t}\r\n\r\n\t__proto.rotate=function(angle){\r\n\t\tSaveTransform.save(this);\r\n\t\tthis._curMat.rotateEx(angle);\r\n\t}\r\n\r\n\t__proto.scale=function(scaleX,scaleY){\r\n\t\tSaveTransform.save(this);\r\n\t\tthis._curMat.scaleEx(scaleX,scaleY);\r\n\t}\r\n\r\n\t__proto.clipRect=function(x,y,width,height){\r\n\t\tif (this._curMat.b !=0 || this._curMat.c !=0){\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar submitStencil0=SubmitStencil.create(4);\r\n\t\t\tthis.addRenderObject(submitStencil0);\r\n\t\t\tvar vb=this._vb;\r\n\t\t\tvar nPos=(vb._byteLength >> 2);\r\n\t\t\tif (GlUtils.fillRectImgVb(vb,null,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){\r\n\t\t\t\tvar shader=this._shader2D;\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tvar submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0));\r\n\t\t\t\tsubmit.shaderValue.ALPHA=1.0;\r\n\t\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\t\tthis._curSubmit._numEle+=6;\r\n\t\t\t\t}else {\r\n\t\t\t\talert(\"clipRect calc stencil rect error\");\r\n\t\t\t};\r\n\t\t\tvar submitStencil1=SubmitStencil.create(5);\r\n\t\t\tthis.addRenderObject(submitStencil1);\r\n\t\t\tvar vbdata=vb.getFloat32Array();\r\n\t\t\tvar minx=Math.min(Math.min(Math.min(vbdata[nPos+0],vbdata[nPos+4]),vbdata[nPos+8]),vbdata[nPos+12]);\r\n\t\t\tvar maxx=Math.max(Math.max(Math.max(vbdata[nPos+0],vbdata[nPos+4]),vbdata[nPos+8]),vbdata[nPos+12]);\r\n\t\t\tvar miny=Math.min(Math.min(Math.min(vbdata[nPos+1],vbdata[nPos+5]),vbdata[nPos+9]),vbdata[nPos+13]);\r\n\t\t\tvar maxy=Math.max(Math.max(Math.max(vbdata[nPos+1],vbdata[nPos+5]),vbdata[nPos+9]),vbdata[nPos+13]);\r\n\t\t\tSaveClipRectStencil.save(this,submitStencil1,x,y,width,height,minx,miny,maxx-minx,maxy-miny);\r\n\t\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\t\t}else {\r\n\t\t\twidth *=this._curMat.a;\r\n\t\t\theight *=this._curMat.d;\r\n\t\t\tvar p=Point.TEMP;\r\n\t\t\tthis._curMat.transformPoint(p.setTo(x,y));\r\n\t\t\tif (width < 0){\r\n\t\t\t\tp.x=p.x+width;\r\n\t\t\t\twidth=-width;\r\n\t\t\t}\r\n\t\t\tif (height < 0){\r\n\t\t\t\tp.y=p.y+height;\r\n\t\t\t\theight=-height;\r\n\t\t\t}\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar submitSc=this._curSubmit=SubmitScissor.create(this);\r\n\t\t\tthis._submits[this._submits._length++]=submitSc;\r\n\t\t\tsubmitSc.submitIndex=this._submits._length;\r\n\t\t\tsubmitSc.submitLength=9999999;\r\n\t\t\tSaveClipRect.save(this,submitSc);\r\n\t\t\tvar clip=this._clipRect;\r\n\t\t\tvar x1=clip.x,y1=clip.y;\r\n\t\t\tvar r=p.x+width,b=p.y+height;\r\n\t\t\tx1 < p.x && (clip.x=p.x);\r\n\t\t\ty1 < p.y && (clip.y=p.y);\r\n\t\t\tclip.width=Math.min(r,x1+clip.width)-clip.x;\r\n\t\t\tclip.height=Math.min(b,y1+clip.height)-clip.y;\r\n\t\t\tthis._shader2D.glTexture=null;\r\n\t\t\tsubmitSc.clipRect.copyFrom(clip);\r\n\t\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setIBVB=function(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset,type){\r\n\t\t(startIndex===void 0)&& (startIndex=0);\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\t(type===void 0)&& (type=0);\r\n\t\tif (ib===null){\r\n\t\t\tif (!Render.isFlash){\r\n\t\t\t\tib=this._ib;\r\n\t\t\t\t}else {\r\n\t\t\t\tvar falshVB=vb;\r\n\t\t\t\t(falshVB._selfIB)|| (falshVB._selfIB=IndexBuffer2D.create(/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4));\r\n\t\t\t\tfalshVB._selfIB.clear();\r\n\t\t\t\tib=falshVB._selfIB;\r\n\t\t\t}\r\n\t\t\tGlUtils.expandIBQuadrangle(ib,(vb._byteLength / (/*laya.webgl.utils.Buffer2D.FLOAT32*/4 *vb.vertexStride *4)));\r\n\t\t}\r\n\t\tif (!shaderValues || !shader)\r\n\t\t\tthrow Error(\"setIBVB must input:shader shaderValues\");\r\n\t\tvar submit=SubmitOtherIBVB.create(this,vb,ib,numElement,shader,shaderValues,startIndex,offset,type);\r\n\t\tmat || (mat=Matrix.EMPTY);\r\n\t\tmat.translate(x,y);\r\n\t\tMatrix.mul(mat,this._curMat,submit._mat);\r\n\t\tmat.translate(-x,-y);\r\n\t\tthis._submits[this._submits._length++]=submit;\r\n\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\tthis._renderKey=0;\r\n\t}\r\n\r\n\t__proto.addRenderObject=function(o){\r\n\t\tthis._submits[this._submits._length++]=o;\r\n\t}\r\n\r\n\t__proto.fillTrangles=function(tex,x,y,points,m){\r\n\t\tvar submit=this._curSubmit;\r\n\t\tvar vb=this._vb;\r\n\t\tvar shader=this._shader2D;\r\n\t\tvar curShader=submit.shaderValue;\r\n\t\tvar length=points.length >> 4;\r\n\t\tvar t_tex=tex.bitmap;\r\n\t\tthis._renderKey=0;\r\n\t\tif (shader.glTexture !=t_tex || shader.ALPHA!==curShader.ALPHA){\r\n\t\t\tsubmit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0));\r\n\t\t\tsubmit.shaderValue.textureHost=tex;\r\n\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t}\r\n\t\tGlUtils.fillTranglesVB(vb,x,y,points,m || this._curMat,this._x,this._y);\r\n\t\tsubmit._numEle+=length *6;\r\n\t}\r\n\r\n\t__proto.submitElement=function(start,end){\r\n\t\tvar renderList=this._submits;\r\n\t\tend < 0 && (end=renderList._length);\r\n\t\twhile (start < end){\r\n\t\t\tstart+=renderList[start].renderSubmit();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.finish=function(){\r\n\t\tWebGL.mainContext.finish();\r\n\t}\r\n\r\n\t__proto.flush=function(){\r\n\t\tvar maxNum=Math.max(this._vb._byteLength / (/*laya.webgl.utils.Buffer2D.FLOAT32*/4 *16),this._maxNumEle / 6)+8;\r\n\t\tif (maxNum > (this._ib.bufferLength / (6 */*laya.webgl.utils.Buffer2D.SHORT*/2))){\r\n\t\t\tGlUtils.expandIBQuadrangle(this._ib,maxNum);\r\n\t\t}\r\n\t\tif (!this._isMain && AtlasResourceManager.enabled && AtlasResourceManager._atlasRestore > this._atlasResourceChange){\r\n\t\t\tthis._atlasResourceChange=AtlasResourceManager._atlasRestore;\r\n\t\t\tvar renderList=this._submits;\r\n\t\t\tfor (var i=0,s=renderList._length;i < s;i++){\r\n\t\t\t\tvar submit=renderList [i];\r\n\t\t\t\tif (submit.getRenderType()===/*laya.webgl.submit.Submit.TYPE_TEXTURE*/10016)\r\n\t\t\t\t\t(submit).checkTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.submitElement(0,this._submits._length);\r\n\t\tthis._path && this._path.reset();\r\n\t\tSkinMeshBuffer.instance && SkinMeshBuffer.getInstance().reset();\r\n\t\tthis._curSubmit=Submit.RENDERBASE;\r\n\t\tthis._renderKey=0;\r\n\t\treturn this._submits._length;\r\n\t}\r\n\r\n\t__proto.setPathId=function(id){\r\n\t\tthis.mId=id;\r\n\t\tif (this.mId !=-1){\r\n\t\t\tthis.mHaveKey=false;\r\n\t\t\tvar tVGM=VectorGraphManager.getInstance();\r\n\t\t\tif (tVGM.shapeDic[this.mId]){\r\n\t\t\t\tthis.mHaveKey=true;\r\n\t\t\t}\r\n\t\t\tthis.mHaveLineKey=false;\r\n\t\t\tif (tVGM.shapeLineDic[this.mId]){\r\n\t\t\t\tthis.mHaveLineKey=true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.movePath=function(x,y){\r\n\t\tvar _x1=x,_y1=y;\r\n\t\tx=this._curMat.a *_x1+this._curMat.c *_y1+this._curMat.tx;\r\n\t\ty=this._curMat.b *_x1+this._curMat.d *_y1+this._curMat.ty;\r\n\t\tthis.mX+=x;\r\n\t\tthis.mY+=y;\r\n\t}\r\n\r\n\t__proto.beginPath=function(){\r\n\t\tvar tPath=this._getPath();\r\n\t\ttPath.tempArray.length=0;\r\n\t\ttPath.closePath=false;\r\n\t\tthis.mX=0;\r\n\t\tthis.mY=0;\r\n\t}\r\n\r\n\t__proto.closePath=function(){\r\n\t\tthis._path.closePath=true;\r\n\t}\r\n\r\n\t__proto.fill=function(isConvexPolygon){\r\n\t\t(isConvexPolygon===void 0)&& (isConvexPolygon=false);\r\n\t\tvar tPath=this._getPath();\r\n\t\tthis.drawPoly(0,0,tPath.tempArray,this.fillStyle._color.numColor,0,0,isConvexPolygon);\r\n\t}\r\n\r\n\t__proto.stroke=function(){\r\n\t\tvar tPath=this._getPath();\r\n\t\tif (this.lineWidth > 0){\r\n\t\t\tif (this.mId==-1){\r\n\t\t\t\ttPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor);\r\n\t\t\t\t}else {\r\n\t\t\t\tif (this.mHaveLineKey){\r\n\t\t\t\t\tvar tShapeLine=VectorGraphManager.getInstance().shapeLineDic[this.mId];\r\n\t\t\t\t\ttShapeLine.rebuild(tPath.tempArray);\r\n\t\t\t\t\ttPath.setGeomtry(tShapeLine);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tVectorGraphManager.getInstance().addLine(this.mId,tPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttPath.update();\r\n\t\t\tvar tPosArray=[this.mX,this.mY];\r\n\t\t\tvar tempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,0));\r\n\t\t\ttempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;\r\n\t\t\t(tempSubmit.shaderValue).u_pos=tPosArray;\r\n\t\t\ttempSubmit.shaderValue.u_mmat2=RenderState2D.TEMPMAT4_ARRAY;\r\n\t\t\tthis._submits[this._submits._length++]=tempSubmit;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.line=function(fromX,fromY,toX,toY,lineWidth,mat){\r\n\t\tvar submit=this._curSubmit;\r\n\t\tvar vb=this._vb;\r\n\t\tif (GlUtils.fillLineVb(vb,this._clipRect,fromX,fromY,toX,toY,lineWidth,mat)){\r\n\t\t\tthis._renderKey=0;\r\n\t\t\tvar shader=this._shader2D;\r\n\t\t\tvar curShader=submit.shaderValue;\r\n\t\t\tif (shader.strokeStyle!==curShader.strokeStyle || shader.ALPHA!==curShader.ALPHA){\r\n\t\t\t\tshader.glTexture=null;\r\n\t\t\t\tsubmit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16 */*laya.webgl.utils.Buffer2D.FLOAT32*/4)/ 32)*3,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0));\r\n\t\t\t\tsubmit.shaderValue.strokeStyle=shader.strokeStyle;\r\n\t\t\t\tsubmit.shaderValue.mainID=/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02;\r\n\t\t\t\tsubmit.shaderValue.ALPHA=shader.ALPHA;\r\n\t\t\t\tthis._submits[this._submits._length++]=submit;\r\n\t\t\t}\r\n\t\t\tsubmit._numEle+=6;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.moveTo=function(x,y,b){\r\n\t\t(b===void 0)&& (b=true);\r\n\t\tvar tPath=this._getPath();\r\n\t\tif (b){\r\n\t\t\tvar _x1=x,_y1=y;\r\n\t\t\tx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\t\ty=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\t}\r\n\t\ttPath.addPoint(x,y);\r\n\t}\r\n\r\n\t__proto.lineTo=function(x,y,b){\r\n\t\t(b===void 0)&& (b=true);\r\n\t\tvar tPath=this._getPath();\r\n\t\tif (b){\r\n\t\t\tvar _x1=x,_y1=y;\r\n\t\t\tx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\t\ty=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\t}\r\n\t\ttPath.addPoint(x,y);\r\n\t}\r\n\r\n\t__proto.drawCurves=function(x,y,args){\r\n\t\tthis.setPathId(-1);\r\n\t\tthis.beginPath();\r\n\t\tthis.strokeStyle=args[3];\r\n\t\tthis.lineWidth=args[4];\r\n\t\tvar points=args[2];\r\n\t\tx+=args[0],y+=args[1];\r\n\t\tthis.movePath(x,y);\r\n\t\tthis.moveTo(points[0],points[1]);\r\n\t\tvar i=2,n=points.length;\r\n\t\twhile (i < n){\r\n\t\t\tthis.quadraticCurveTo(points[i++],points[i++],points[i++],points[i++]);\r\n\t\t}\r\n\t\tthis.stroke();\r\n\t}\r\n\r\n\t__proto.arcTo=function(x1,y1,x2,y2,r){\r\n\t\tif (this.mId !=-1){\r\n\t\t\tif (this.mHaveKey){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar i=0;\r\n\t\tvar x=0,y=0;\r\n\t\tvar tPath=this._getPath();\r\n\t\tthis._curMat.copyTo(WebGLContext2D._tmpMatrix);\r\n\t\tWebGLContext2D._tmpMatrix.tx=WebGLContext2D._tmpMatrix.ty=0;\r\n\t\tWebGLContext2D._tempPoint.setTo(tPath.getEndPointX(),tPath.getEndPointY());\r\n\t\tWebGLContext2D._tmpMatrix.invertTransformPoint(WebGLContext2D._tempPoint);\r\n\t\tvar dx=WebGLContext2D._tempPoint.x-x1;\r\n\t\tvar dy=WebGLContext2D._tempPoint.y-y1;\r\n\t\tvar len1=Math.sqrt(dx*dx+dy*dy);\r\n\t\tif (len1 <=0.000001){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar ndx=dx / len1;\r\n\t\tvar ndy=dy / len1;\r\n\t\tvar dx2=x2-x1;\r\n\t\tvar dy2=y2-y1;\r\n\t\tvar len22=dx2*dx2+dy2*dy2;\r\n\t\tvar len2=Math.sqrt(len22);\r\n\t\tif (len2 <=0.000001){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar ndx2=dx2 / len2;\r\n\t\tvar ndy2=dy2 / len2;\r\n\t\tvar odx=ndx+ndx2;\r\n\t\tvar ody=ndy+ndy2;\r\n\t\tvar olen=Math.sqrt(odx*odx+ody*ody);\r\n\t\tif (olen <=0.000001){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar nOdx=odx / olen;\r\n\t\tvar nOdy=ody / olen;\r\n\t\tvar alpha=Math.acos(nOdx*ndx+nOdy*ndy);\r\n\t\tvar halfAng=Math.PI / 2-alpha;\r\n\t\tlen1=r / Math.tan(halfAng);\r\n\t\tvar ptx1=len1*ndx+x1;\r\n\t\tvar pty1=len1*ndy+y1;\r\n\t\tvar orilen=Math.sqrt(len1*len1+r*r);\r\n\t\tvar orix=x1+nOdx*orilen;\r\n\t\tvar oriy=y1+nOdy*orilen;\r\n\t\tvar ptx2=len1*ndx2+x1;\r\n\t\tvar pty2=len1*ndy2+y1;\r\n\t\tvar dir=ndx *ndy2-ndy *ndx2;\r\n\t\tvar fChgAng=0;\r\n\t\tvar sinx=0.0;\r\n\t\tvar cosx=0.0;\r\n\t\tif (dir >=0){\r\n\t\t\tfChgAng=halfAng *2;\r\n\t\t\tvar fda=fChgAng / WebGLContext2D.SEGNUM;\r\n\t\t\tsinx=Math.sin(fda);\r\n\t\t\tcosx=Math.cos(fda);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfChgAng=-halfAng *2;\r\n\t\t\tfda=fChgAng / WebGLContext2D.SEGNUM;\r\n\t\t\tsinx=Math.sin(fda);\r\n\t\t\tcosx=Math.cos(fda);\r\n\t\t}\r\n\t\tx=this._curMat.a *ptx1+this._curMat.c *pty1;\r\n\t\ty=this._curMat.b *ptx1+this._curMat.d *pty1;\r\n\t\tif (x !=this._path.getEndPointX()|| y !=this._path.getEndPointY()){\r\n\t\t\ttPath.addPoint(x,y);\r\n\t\t};\r\n\t\tvar cvx=ptx1-orix;\r\n\t\tvar cvy=pty1-oriy;\r\n\t\tvar tx=0.0;\r\n\t\tvar ty=0.0;\r\n\t\tfor (i=0;i < WebGLContext2D.SEGNUM;i++){\r\n\t\t\tvar cx=cvx*cosx+cvy*sinx;\r\n\t\t\tvar cy=-cvx*sinx+cvy*cosx;\r\n\t\t\tx=cx+orix;\r\n\t\t\ty=cy+oriy;\r\n\t\t\tx1=this._curMat.a *x+this._curMat.c *y;\r\n\t\t\ty1=this._curMat.b *x+this._curMat.d *y;\r\n\t\t\tx=x1;\r\n\t\t\ty=y1;\r\n\t\t\tif (x !=this._path.getEndPointX()|| y !=this._path.getEndPointY()){\r\n\t\t\t\ttPath.addPoint(x,y);\r\n\t\t\t}\r\n\t\t\tcvx=cx;\r\n\t\t\tcvy=cy;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.arc=function(cx,cy,r,startAngle,endAngle,counterclockwise,b){\r\n\t\t(counterclockwise===void 0)&& (counterclockwise=false);\r\n\t\t(b===void 0)&& (b=true);\r\n\t\tif (this.mId !=-1){\r\n\t\t\tvar tShape=VectorGraphManager.getInstance().shapeDic[this.mId];\r\n\t\t\tif (tShape){\r\n\t\t\t\tif (this.mHaveKey && !tShape.needUpdate(this._curMat))\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcx=0;\r\n\t\t\tcy=0;\r\n\t\t};\r\n\t\tvar a=0,da=0,hda=0,kappa=0;\r\n\t\tvar dx=0,dy=0,x=0,y=0,tanx=0,tany=0;\r\n\t\tvar px=0,py=0,ptanx=0,ptany=0;\r\n\t\tvar i=0,ndivs=0,nvals=0;\r\n\t\tda=endAngle-startAngle;\r\n\t\tif (!counterclockwise){\r\n\t\t\tif (Math.abs(da)>=Math.PI *2){\r\n\t\t\t\tda=Math.PI *2;\r\n\t\t\t\t}else {\r\n\t\t\t\twhile (da < 0.0){\r\n\t\t\t\t\tda+=Math.PI *2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (Math.abs(da)>=Math.PI *2){\r\n\t\t\t\tda=-Math.PI *2;\r\n\t\t\t\t}else {\r\n\t\t\t\twhile (da > 0.0){\r\n\t\t\t\t\tda-=Math.PI *2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (r < 101){\r\n\t\t\tndivs=Math.max(10,da *r / 5);\r\n\t\t\t}else if (r < 201){\r\n\t\t\tndivs=Math.max(10,da *r / 20);\r\n\t\t\t}else {\r\n\t\t\tndivs=Math.max(10,da *r / 40);\r\n\t\t}\r\n\t\thda=(da / ndivs)/ 2.0;\r\n\t\tkappa=Math.abs(4 / 3 *(1-Math.cos(hda))/ Math.sin(hda));\r\n\t\tif (counterclockwise)\r\n\t\t\tkappa=-kappa;\r\n\t\tnvals=0;\r\n\t\tvar tPath=this._getPath();\r\n\t\tvar _x1=NaN,_y1=NaN;\r\n\t\tfor (i=0;i <=ndivs;i++){\r\n\t\t\ta=startAngle+da *(i / ndivs);\r\n\t\t\tdx=Math.cos(a);\r\n\t\t\tdy=Math.sin(a);\r\n\t\t\tx=cx+dx *r;\r\n\t\t\ty=cy+dy *r;\r\n\t\t\tif (b){\r\n\t\t\t\t_x1=x,_y1=y;\r\n\t\t\t\tx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\t\t\ty=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\t\t}\r\n\t\t\tif (x !=this._path.getEndPointX()|| y !=this._path.getEndPointY()){\r\n\t\t\t\ttPath.addPoint(x,y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdx=Math.cos(endAngle);\r\n\t\tdy=Math.sin(endAngle);\r\n\t\tx=cx+dx *r;\r\n\t\ty=cy+dy *r;\r\n\t\tif (b){\r\n\t\t\t_x1=x,_y1=y;\r\n\t\t\tx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\t\ty=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\t}\r\n\t\tif (x !=this._path.getEndPointX()|| y !=this._path.getEndPointY()){\r\n\t\t\ttPath.addPoint(x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.quadraticCurveTo=function(cpx,cpy,x,y){\r\n\t\tvar tBezier=Bezier.I;\r\n\t\tvar tResultArray=[];\r\n\t\tvar _x1=x,_y1=y;\r\n\t\tx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\ty=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\t_x1=cpx,_y1=cpy;\r\n\t\tcpx=this._curMat.a *_x1+this._curMat.c *_y1;\r\n\t\tcpy=this._curMat.b *_x1+this._curMat.d *_y1;\r\n\t\tvar tArray=tBezier.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),cpx,cpy,x,y],30,2);\r\n\t\tfor (var i=0,n=tArray.length / 2;i < n;i++){\r\n\t\t\tthis.lineTo(tArray[i *2],tArray[i *2+1],false);\r\n\t\t}\r\n\t\tthis.lineTo(x,y,false);\r\n\t}\r\n\r\n\t__proto.rect=function(x,y,width,height){\r\n\t\tthis._other=this._other.make();\r\n\t\tthis._other.path || (this._other.path=new Path());\r\n\t\tthis._other.path.rect(x,y,width,height);\r\n\t}\r\n\r\n\t__proto.strokeRect=function(x,y,width,height,parameterLineWidth){\r\n\t\tvar tW=parameterLineWidth *0.5;\r\n\t\tthis.line(x-tW,y,x+width+tW,y,parameterLineWidth,this._curMat);\r\n\t\tthis.line(x+width,y,x+width,y+height,parameterLineWidth,this._curMat);\r\n\t\tthis.line(x,y,x,y+height,parameterLineWidth,this._curMat);\r\n\t\tthis.line(x-tW,y+height,x+width+tW,y+height,parameterLineWidth,this._curMat);\r\n\t}\r\n\r\n\t__proto.clip=function(){}\r\n\t/**\r\n\t*画多边形(用)\r\n\t*@param x\r\n\t*@param y\r\n\t*@param points\r\n\t*/\r\n\t__proto.drawPoly=function(x,y,points,color,lineWidth,boderColor,isConvexPolygon){\r\n\t\t(isConvexPolygon===void 0)&& (isConvexPolygon=false);\r\n\t\tthis._renderKey=0;\r\n\t\tthis._shader2D.glTexture=null;\r\n\t\tvar tPath=this._getPath();\r\n\t\tif (this.mId==-1){\r\n\t\t\ttPath.polygon(x,y,points,color,lineWidth ? lineWidth :1,boderColor)\r\n\t\t\t}else {\r\n\t\t\tif (this.mHaveKey){\r\n\t\t\t\tvar tShape=VectorGraphManager.getInstance().shapeDic[this.mId];\r\n\t\t\t\ttShape.setMatrix(this._curMat);\r\n\t\t\t\ttShape.rebuild(tPath.tempArray);\r\n\t\t\t\ttPath.setGeomtry(tShape);\r\n\t\t\t\t}else {\r\n\t\t\t\tvar t=tPath.polygon(x,y,points,color,lineWidth ? lineWidth :1,boderColor);\r\n\t\t\t\tVectorGraphManager.getInstance().addShape(this.mId,t);\r\n\t\t\t\tt.setMatrix(this._curMat);\r\n\t\t\t}\r\n\t\t}\r\n\t\ttPath.update();\r\n\t\tvar tPosArray=[this.mX,this.mY];\r\n\t\tvar tempSubmit;\r\n\t\ttempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,0));\r\n\t\ttempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;\r\n\t\t(tempSubmit.shaderValue).u_pos=tPosArray;\r\n\t\ttempSubmit.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY;\r\n\t\tthis._submits[this._submits._length++]=tempSubmit;\r\n\t\tif (lineWidth > 0){\r\n\t\t\tif (this.mHaveLineKey){\r\n\t\t\t\tvar tShapeLine=VectorGraphManager.getInstance().shapeLineDic[this.mId];\r\n\t\t\t\ttShapeLine.rebuild(tPath.tempArray);\r\n\t\t\t\ttPath.setGeomtry(tShapeLine);\r\n\t\t\t\t}else {\r\n\t\t\t\tVectorGraphManager.getInstance().addShape(this.mId,tPath.drawLine(x,y,points,lineWidth,boderColor));\r\n\t\t\t}\r\n\t\t\ttPath.update();\r\n\t\t\ttempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,0));\r\n\t\t\ttempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;\r\n\t\t\ttempSubmit.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY;\r\n\t\t\tthis._submits[this._submits._length++]=tempSubmit;\r\n\t\t}\r\n\t}\r\n\r\n\t/*******************************************end矢量绘制***************************************************/\r\n\t__proto.drawParticle=function(x,y,pt){\r\n\t\tpt.x=x;\r\n\t\tpt.y=y;\r\n\t\tthis._submits[this._submits._length++]=pt;\r\n\t}\r\n\r\n\t__proto._getPath=function(){\r\n\t\treturn this._path || (this._path=new Path());\r\n\t}\r\n\r\n\t/*,_shader2D.ALPHA=1*/\r\n\t__getset(0,__proto,'globalCompositeOperation',function(){\r\n\t\treturn BlendMode.NAMES[this._nBlendType];\r\n\t\t},function(value){\r\n\t\tvar n=BlendMode.TOINT[value];\r\n\t\tn==null || (this._nBlendType===n)|| (SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_GLOBALCOMPOSITEOPERATION*/0x10000,this,true),this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._nBlendType=n);\r\n\t});\r\n\r\n\t__getset(0,__proto,'strokeStyle',function(){\r\n\t\treturn this._shader2D.strokeStyle;\r\n\t\t},function(value){\r\n\t\tthis._shader2D.strokeStyle.equal(value)|| (SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_STROKESTYLE*/0x200,this._shader2D,false),this._shader2D.strokeStyle=DrawStyle.create(value));\r\n\t});\r\n\r\n\t__getset(0,__proto,'globalAlpha',function(){\r\n\t\treturn this._shader2D.ALPHA;\r\n\t\t},function(value){\r\n\t\tvalue=Math.floor(value *1000)/ 1000;\r\n\t\tif (value !=this._shader2D.ALPHA){\r\n\t\t\tSaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_ALPHA*/0x1,this._shader2D,true);\r\n\t\t\tthis._shader2D.ALPHA=value;\r\n\t\t}\r\n\t});\r\n\r\n\t__getset(0,__proto,'asBitmap',null,function(value){\r\n\t\tif (value){\r\n\t\t\tthis._targets || (this._targets=new RenderTargetMAX());\r\n\t\t\tthis._targets.repaint=true;\r\n\t\t\tif (!this._width || !this._height)\r\n\t\t\t\tthrow Error(\"asBitmap no size!\");\r\n\t\t\tthis._targets.setSP(this.sprite);\r\n\t\t\tthis._targets.size(this._width,this._height);\r\n\t\t}else\r\n\t\tthis._targets=null;\r\n\t});\r\n\r\n\t__getset(0,__proto,'fillStyle',function(){\r\n\t\treturn this._shader2D.fillStyle;\r\n\t\t},function(value){\r\n\t\tthis._shader2D.fillStyle.equal(value)|| (SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_FILESTYLE*/0x2,this._shader2D,false),this._shader2D.fillStyle=DrawStyle.create(value));\r\n\t});\r\n\r\n\t__getset(0,__proto,'textAlign',function(){\r\n\t\treturn this._other.textAlign;\r\n\t\t},function(value){\r\n\t\t(this._other.textAlign===value)|| (this._other=this._other.make(),SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_TEXTALIGN*/0x8000,this._other,false),this._other.textAlign=value);\r\n\t});\r\n\r\n\t__getset(0,__proto,'lineWidth',function(){\r\n\t\treturn this._other.lineWidth;\r\n\t\t},function(value){\r\n\t\t(this._other.lineWidth===value)|| (this._other=this._other.make(),SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_LINEWIDTH*/0x100,this._other,false),this._other.lineWidth=value);\r\n\t});\r\n\r\n\t__getset(0,__proto,'textBaseline',function(){\r\n\t\treturn this._other.textBaseline;\r\n\t\t},function(value){\r\n\t\t(this._other.textBaseline===value)|| (this._other=this._other.make(),SaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_TEXTBASELINE*/0x4000,this._other,false),this._other.textBaseline=value);\r\n\t});\r\n\r\n\t__getset(0,__proto,'font',null,function(str){\r\n\t\tif (str==this._other.font.toString())\r\n\t\t\treturn;\r\n\t\tthis._other=this._other.make();\r\n\t\tSaveBase.save(this,/*laya.webgl.canvas.save.SaveBase.TYPE_FONT*/0x8,this._other,false);\r\n\t\tthis._other.font===FontInContext.EMPTY ? (this._other.font=new FontInContext(str)):(this._other.font.setFont(str));\r\n\t});\r\n\r\n\tWebGLContext2D.__init__=function(){\r\n\t\tContextParams.DEFAULT=new ContextParams();\r\n\t}\r\n\r\n\tWebGLContext2D._SUBMITVBSIZE=32000;\r\n\tWebGLContext2D._MAXSIZE=99999999;\r\n\tWebGLContext2D._RECTVBSIZE=16;\r\n\tWebGLContext2D._COUNT=0;\r\n\tWebGLContext2D.SEGNUM=32;\r\n\tWebGLContext2D._contextcount=0;\r\n\t__static(WebGLContext2D,\r\n\t['_tempPoint',function(){return this._tempPoint=new Point();},'MAXCLIPRECT',function(){return this.MAXCLIPRECT=new Rectangle(0,0,99999999,99999999);},'_tmpMatrix',function(){return this._tmpMatrix=new Matrix();},'_fontTemp',function(){return this._fontTemp=new FontInContext();},'_drawStyleTemp',function(){return this._drawStyleTemp=new DrawStyle(null);}\r\n\t]);\r\n\tWebGLContext2D.__init$=function(){\r\n\t\t//class ContextParams\r\n\t\tContextParams=(function(){\r\n\t\t\tfunction ContextParams(){\r\n\t\t\t\tthis.lineWidth=1;\r\n\t\t\t\tthis.path=null;\r\n\t\t\t\tthis.textAlign=null;\r\n\t\t\t\tthis.textBaseline=null;\r\n\t\t\t\tthis.font=FontInContext.EMPTY;\r\n\t\t\t}\r\n\t\t\t__class(ContextParams,'');\r\n\t\t\tvar __proto=ContextParams.prototype;\r\n\t\t\t__proto.clear=function(){\r\n\t\t\t\tthis.lineWidth=1;\r\n\t\t\t\tthis.path && this.path.clear();\r\n\t\t\t\tthis.textAlign=this.textBaseline=null;\r\n\t\t\t\tthis.font=FontInContext.EMPTY;\r\n\t\t\t}\r\n\t\t\t__proto.make=function(){\r\n\t\t\t\treturn this===ContextParams.DEFAULT ? new ContextParams():this;\r\n\t\t\t}\r\n\t\t\tContextParams.DEFAULT=null;\r\n\t\t\treturn ContextParams;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn WebGLContext2D;\r\n})(Context)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.Value2D extends laya.webgl.shader.ShaderValue\r\nvar Value2D=(function(_super){\r\n\tfunction Value2D(mainID,subID){\r\n\t\tthis.size=[0,0];\r\n\t\tthis.alpha=1.0;\r\n\t\t//this.mmat=null;\r\n\t\tthis.ALPHA=1.0;\r\n\t\t//this.shader=null;\r\n\t\t//this.mainID=0;\r\n\t\tthis.subID=0;\r\n\t\t//this.filters=null;\r\n\t\t//this.textureHost=null;\r\n\t\t//this.texture=null;\r\n\t\t//this.fillStyle=null;\r\n\t\t//this.color=null;\r\n\t\t//this.strokeStyle=null;\r\n\t\t//this.colorAdd=null;\r\n\t\t//this.glTexture=null;\r\n\t\t//this.u_mmat2=null;\r\n\t\t//this._inClassCache=null;\r\n\t\tthis._cacheID=0;\r\n\t\tValue2D.__super.call(this);\r\n\t\tthis.defines=new ShaderDefines2D();\r\n\t\tthis.position=Value2D._POSITION;\r\n\t\tthis.mainID=mainID;\r\n\t\tthis.subID=subID;\r\n\t\tthis.textureHost=null;\r\n\t\tthis.texture=null;\r\n\t\tthis.fillStyle=null;\r\n\t\tthis.color=null;\r\n\t\tthis.strokeStyle=null;\r\n\t\tthis.colorAdd=null;\r\n\t\tthis.glTexture=null;\r\n\t\tthis.u_mmat2=null;\r\n\t\tthis._cacheID=mainID|subID;\r\n\t\tthis._inClassCache=Value2D._cache[this._cacheID];\r\n\t\tif (mainID>0 && !this._inClassCache){\r\n\t\t\tthis._inClassCache=Value2D._cache[this._cacheID]=[];\r\n\t\t\tthis._inClassCache._length=0;\r\n\t\t}\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t__class(Value2D,'laya.webgl.shader.d2.value.Value2D',_super);\r\n\tvar __proto=Value2D.prototype;\r\n\t__proto.setValue=function(value){}\r\n\t//throw new Error(\"todo in subclass\");\r\n\t__proto.refresh=function(){\r\n\t\tvar size=this.size;\r\n\t\tsize[0]=RenderState2D.width;\r\n\t\tsize[1]=RenderState2D.height;\r\n\t\tthis.alpha=this.ALPHA *RenderState2D.worldAlpha;\r\n\t\tthis.mmat=RenderState2D.worldMatrix4;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto._ShaderWithCompile=function(){\r\n\t\treturn Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID | this.defines._value,Shader2X.create);\r\n\t}\r\n\r\n\t__proto._withWorldShaderDefines=function(){\r\n\t\tvar defs=RenderState2D.worldShaderDefines;\r\n\t\tvar sd=Shader.sharders [this.mainID | this.defines._value | defs.getValue()];\r\n\t\tif (!sd){\r\n\t\t\tvar def={};\r\n\t\t\tvar dic;\r\n\t\t\tvar name;\r\n\t\t\tdic=this.defines.toNameDic();for (name in dic)def[name]=\"\";\r\n\t\t\tdic=defs.toNameDic();for (name in dic)def[name]=\"\";\r\n\t\t\tsd=Shader.withCompile2D(0,this.mainID,def,this.mainID | this.defines._value| defs.getValue(),Shader2X.create);\r\n\t\t};\r\n\t\tvar worldFilters=RenderState2D.worldFilters;\r\n\t\tif (!worldFilters)return sd;\r\n\t\tvar n=worldFilters.length,f;\r\n\t\tfor (var i=0;i < n;i++){\r\n\t\t\t((f=worldFilters[i]))&& f.action.setValue(this);\r\n\t\t}\r\n\t\treturn sd;\r\n\t}\r\n\r\n\t__proto.upload=function(){\r\n\t\tvar renderstate2d=RenderState2D;\r\n\t\tthis.alpha=this.ALPHA *renderstate2d.worldAlpha;\r\n\t\tif (RenderState2D.worldMatrix4!==RenderState2D.TEMPMAT4_ARRAY)this.defines.add(/*laya.webgl.shader.d2.ShaderDefines2D.WORLDMAT*/0x80);\r\n\t\t(WebGL.shaderHighPrecision)&& (this.defines.add(/*laya.webgl.shader.d2.ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION*/0x400));\r\n\t\tvar sd=renderstate2d.worldShaderDefines?this._withWorldShaderDefines():(Shader.sharders [this.mainID | this.defines._value] || this._ShaderWithCompile());\r\n\t\tvar params;\r\n\t\tthis.size[0]=renderstate2d.width,this.size[1]=renderstate2d.height;\r\n\t\tthis.mmat=renderstate2d.worldMatrix4;\r\n\t\tif (BaseShader.activeShader!==sd){\r\n\t\t\tif (sd._shaderValueWidth!==renderstate2d.width || sd._shaderValueHeight!==renderstate2d.height){\r\n\t\t\t\tsd._shaderValueWidth=renderstate2d.width;\r\n\t\t\t\tsd._shaderValueHeight=renderstate2d.height;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tparams=sd._params2dQuick2 || sd._make2dQuick2();\r\n\t\t\t}\r\n\t\t\tsd.upload(this,params);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tif (sd._shaderValueWidth!==renderstate2d.width || sd._shaderValueHeight!==renderstate2d.height){\r\n\t\t\t\tsd._shaderValueWidth=renderstate2d.width;\r\n\t\t\t\tsd._shaderValueHeight=renderstate2d.height;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tparams=(sd._params2dQuick1)|| sd._make2dQuick1();\r\n\t\t\t}\r\n\t\t\tsd.upload(this,params);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setFilters=function(value){\r\n\t\tthis.filters=value;\r\n\t\tif (!value)\r\n\t\t\treturn;\r\n\t\tvar n=value.length,f;\r\n\t\tfor (var i=0;i < n;i++){\r\n\t\t\tf=value[i];\r\n\t\t\tif (f){\r\n\t\t\t\tthis.defines.add(f.type);\r\n\t\t\t\tf.action.setValue(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis.defines.setValue(this.subID);\r\n\t}\r\n\r\n\t__proto.release=function(){\r\n\t\tthis._inClassCache[this._inClassCache._length++]=this;\r\n\t\tthis.fillStyle=null;\r\n\t\tthis.strokeStyle=null;\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\tValue2D._initone=function(type,classT){\r\n\t\tValue2D._typeClass[type]=classT;\r\n\t\tValue2D._cache[type]=[];\r\n\t\tValue2D._cache[type]._length=0;\r\n\t}\r\n\r\n\tValue2D.__init__=function(){\r\n\t\tValue2D._POSITION=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,4 *CONST3D2D.BYTES_PE,0];\r\n\t\tValue2D._TEXCOORD=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,4 *CONST3D2D.BYTES_PE,2 *CONST3D2D.BYTES_PE];\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,Color2dSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,PrimitiveSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.FILLTEXTURE*/0x100,FillTextureSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.SKINMESH*/0x200,SkinSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,TextureSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01 | /*laya.webgl.shader.d2.ShaderDefines2D.COLORADD*/0x40,TextSV);\r\n\t\tValue2D._initone(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01 | /*laya.webgl.shader.d2.ShaderDefines2D.FILTERGLOW*/0x08,TextureSV);\r\n\t}\r\n\r\n\tValue2D.create=function(mainType,subType){\r\n\t\tvar types=Value2D._cache[mainType|subType];\r\n\t\tif (types._length)\r\n\t\t\treturn types[--types._length];\r\n\t\telse\r\n\t\treturn new Value2D._typeClass[mainType|subType](subType);\r\n\t}\r\n\r\n\tValue2D._POSITION=null;\r\n\tValue2D._TEXCOORD=null;\r\n\tValue2D._cache=[];\r\n\tValue2D._typeClass=[];\r\n\t__static(Value2D,\r\n\t['TEMPMAT4_ARRAY',function(){return this.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];}\r\n\t]);\r\n\treturn Value2D;\r\n})(ShaderValue)\r\n\r\n\r\n//class laya.webgl.utils.RenderSprite3D extends laya.renders.RenderSprite\r\nvar RenderSprite3D=(function(_super){\r\n\tfunction RenderSprite3D(type,next){\r\n\t\tRenderSprite3D.__super.call(this,type,next);\r\n\t}\r\n\r\n\t__class(RenderSprite3D,'laya.webgl.utils.RenderSprite3D',_super);\r\n\tvar __proto=RenderSprite3D.prototype;\r\n\t__proto.onCreate=function(type){\r\n\t\tswitch (type){\r\n\t\t\tcase 0x08:\r\n\t\t\t\tthis._fun=this._blend;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x04:\r\n\t\t\t\tthis._fun=this._transform;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t}\r\n\r\n\t__proto._mask=function(sprite,context,x,y){\r\n\t\tvar next=this._next;\r\n\t\tvar mask=sprite.mask;\r\n\t\tvar submitCMD;\r\n\t\tvar submitStencil;\r\n\t\tif (mask){\r\n\t\t\tcontext.ctx.save();\r\n\t\t\tvar preBlendMode=(context.ctx).globalCompositeOperation;\r\n\t\t\tvar tRect=new Rectangle();\r\n\t\t\ttRect.copyFrom(mask.getBounds());\r\n\t\t\ttRect.width=Math.round(tRect.width);\r\n\t\t\ttRect.height=Math.round(tRect.height);\r\n\t\t\ttRect.x=Math.round(tRect.x);\r\n\t\t\ttRect.y=Math.round(tRect.y);\r\n\t\t\tif (tRect.width > 0 && tRect.height > 0){\r\n\t\t\t\tvar tf=sprite._style._tf;\r\n\t\t\t\tvar scope=SubmitCMDScope.create();\r\n\t\t\t\tscope.addValue(\"bounds\",tRect);\r\n\t\t\t\tsubmitCMD=SubmitCMD.create([scope,context],laya.webgl.utils.RenderSprite3D.tmpTarget);\r\n\t\t\t\tcontext.addRenderObject(submitCMD);\r\n\t\t\t\tmask.render(context,-tRect.x,-tRect.y);\r\n\t\t\t\tsubmitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.endTmpTarget);\r\n\t\t\t\tcontext.addRenderObject(submitCMD);\r\n\t\t\t\tcontext.ctx.save();\r\n\t\t\t\tcontext.clipRect(x-tf.translateX+tRect.x,y-tf.translateY+tRect.y,tRect.width,tRect.height);\r\n\t\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t\t\tcontext.ctx.restore();\r\n\t\t\t\tsubmitStencil=SubmitStencil.create(6);\r\n\t\t\t\tpreBlendMode=(context.ctx).globalCompositeOperation;\r\n\t\t\t\tsubmitStencil.blendMode=\"mask\";\r\n\t\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\t\tMatrix.TEMP.identity();\r\n\t\t\t\tvar shaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\t\t\tvar uv=Texture.INV_UV;\r\n\t\t\t\tvar w=tRect.width;\r\n\t\t\t\tvar h=tRect.height;\r\n\t\t\t\tvar tempLimit=32;\r\n\t\t\t\tif (tRect.width < tempLimit || tRect.height < tempLimit){\r\n\t\t\t\t\tuv=RenderSprite3D.tempUV;\r\n\t\t\t\t\tuv[0]=0;\r\n\t\t\t\t\tuv[1]=0;\r\n\t\t\t\t\tuv[2]=(tRect.width >=32)? 1 :tRect.width/tempLimit;\r\n\t\t\t\t\tuv[3]=0\r\n\t\t\t\t\tuv[4]=(tRect.width >=32)? 1 :tRect.width/tempLimit;\r\n\t\t\t\t\tuv[5]=(tRect.height >=32)? 1 :tRect.height/tempLimit;\r\n\t\t\t\t\tuv[6]=0;\r\n\t\t\t\t\tuv[7]=(tRect.height >=32)? 1 :tRect.height/tempLimit;\r\n\t\t\t\t\ttRect.width=(tRect.width >=32)? tRect.width :tempLimit;\r\n\t\t\t\t\ttRect.height=(tRect.height >=32)? tRect.height :tempLimit;\r\n\t\t\t\t\tuv[1] *=-1;uv[3] *=-1;uv[5] *=-1;uv[7] *=-1;\r\n\t\t\t\t\tuv[1]+=1;uv[3]+=1;uv[5]+=1;uv[7]+=1;\r\n\t\t\t\t}\r\n\t\t\t\t(context.ctx).drawTarget(scope,x+tRect.x-tf.translateX,y+tRect.y-tf.translateY,w,h,Matrix.TEMP,\"tmpTarget\",shaderValue,uv,6);\r\n\t\t\t\tsubmitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.recycleTarget);\r\n\t\t\t\tcontext.addRenderObject(submitCMD);\r\n\t\t\t\tsubmitStencil=SubmitStencil.create(6);\r\n\t\t\t\tsubmitStencil.blendMode=preBlendMode;\r\n\t\t\t\tcontext.addRenderObject(submitStencil);\r\n\t\t\t}\r\n\t\t\tcontext.ctx.restore();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._blend=function(sprite,context,x,y){\r\n\t\tvar style=sprite._style;\r\n\t\tvar next=this._next;\r\n\t\tif (style.blendMode){\r\n\t\t\tcontext.ctx.save();\r\n\t\t\tcontext.ctx.globalCompositeOperation=style.blendMode;\r\n\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t\tcontext.ctx.restore();\r\n\t\t}\r\n\t\telse{\r\n\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._transform=function(sprite,context,x,y){\r\n\t\t'use strict';\r\n\t\tvar transform=sprite.transform,_next=this._next;\r\n\t\tif (transform && _next !=RenderSprite.NORENDER){\r\n\t\t\tvar ctx=context.ctx;\r\n\t\t\tvar style=sprite._style;\r\n\t\t\ttransform.tx=x;\r\n\t\t\ttransform.ty=y;\r\n\t\t\tvar m2=ctx._getTransformMatrix();\r\n\t\t\tvar m1=m2.clone();\r\n\t\t\tMatrix.mul(transform,m2,m2);\r\n\t\t\tm2._checkTransform();\r\n\t\t\ttransform.tx=transform.ty=0;\r\n\t\t\t_next._fun.call(_next,sprite,context,0,0);\r\n\t\t\tm1.copyTo(m2);\r\n\t\t\tm1.destroy();\r\n\t\t\t}else {\r\n\t\t\t_next._fun.call(_next,sprite,context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\tRenderSprite3D.tmpTarget=function(scope,context){\r\n\t\tvar b=scope.getValue(\"bounds\");\r\n\t\tvar tmpTarget=RenderTarget2D.create(b.width,b.height);\r\n\t\ttmpTarget.start();\r\n\t\ttmpTarget.clear(0,0,0,0);\r\n\t\tscope.addValue(\"tmpTarget\",tmpTarget);\r\n\t}\r\n\r\n\tRenderSprite3D.endTmpTarget=function(scope){\r\n\t\tvar tmpTarget=scope.getValue(\"tmpTarget\");\r\n\t\ttmpTarget.end();\r\n\t}\r\n\r\n\tRenderSprite3D.recycleTarget=function(scope){\r\n\t\tvar tmpTarget=scope.getValue(\"tmpTarget\");\r\n\t\ttmpTarget.recycle();\r\n\t\tscope.recycle();\r\n\t}\r\n\r\n\t__static(RenderSprite3D,\r\n\t['tempUV',function(){return this.tempUV=new Array(8);}\r\n\t]);\r\n\treturn RenderSprite3D;\r\n})(RenderSprite)\r\n\r\n\r\n//class laya.filters.webgl.ColorFilterActionGL extends laya.filters.webgl.FilterActionGL\r\nvar ColorFilterActionGL=(function(_super){\r\n\tfunction ColorFilterActionGL(){\r\n\t\tthis.data=null;\r\n\t\tColorFilterActionGL.__super.call(this);\r\n\t}\r\n\r\n\t__class(ColorFilterActionGL,'laya.filters.webgl.ColorFilterActionGL',_super);\r\n\tvar __proto=ColorFilterActionGL.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilterActionGL\":true})\r\n\t__proto.setValue=function(shader){\r\n\t\tshader.colorMat=this.data._mat;\r\n\t\tshader.colorAlpha=this.data._alpha;\r\n\t}\r\n\r\n\t__proto.apply3d=function(scope,sprite,context,x,y){\r\n\t\tvar b=scope.getValue(\"bounds\");\r\n\t\tvar shaderValue=Value2D.create(/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,0);\r\n\t\tshaderValue.setFilters([this.data]);\r\n\t\tvar tMatrix=Matrix.TEMP;\r\n\t\ttMatrix.identity();\r\n\t\tcontext.ctx.drawTarget(scope,0,0,b.width,b.height,tMatrix,\"src\",shaderValue);\r\n\t}\r\n\r\n\treturn ColorFilterActionGL;\r\n})(FilterActionGL)\r\n\r\n\r\n//class laya.webgl.atlas.Atlaser extends laya.webgl.atlas.AtlasGrid\r\nvar Atlaser=(function(_super){\r\n\tfunction Atlaser(gridNumX,gridNumY,width,height,atlasID){\r\n\t\tthis._atlasCanvas=null;\r\n\t\tthis._inAtlasTextureKey=null;\r\n\t\tthis._inAtlasTextureBitmapValue=null;\r\n\t\tthis._inAtlasTextureOriUVValue=null;\r\n\t\tthis._InAtlasWebGLImagesKey=null;\r\n\t\tthis._InAtlasWebGLImagesOffsetValue=null;\r\n\t\tAtlaser.__super.call(this,gridNumX,gridNumY,atlasID);\r\n\t\tthis._inAtlasTextureKey=[];\r\n\t\tthis._inAtlasTextureBitmapValue=[];\r\n\t\tthis._inAtlasTextureOriUVValue=[];\r\n\t\tthis._InAtlasWebGLImagesKey={};\r\n\t\tthis._InAtlasWebGLImagesOffsetValue=[];\r\n\t\tthis._atlasCanvas=new AtlasWebGLCanvas();\r\n\t\tthis._atlasCanvas._atlaser=this;\r\n\t\tthis._atlasCanvas.width=width;\r\n\t\tthis._atlasCanvas.height=height;\r\n\t\tthis._atlasCanvas.activeResource();\r\n\t\tthis._atlasCanvas.lock=true;\r\n\t}\r\n\r\n\t__class(Atlaser,'laya.webgl.atlas.Atlaser',_super);\r\n\tvar __proto=Atlaser.prototype;\r\n\t__proto.computeUVinAtlasTexture=function(texture,oriUV,offsetX,offsetY){\r\n\t\tvar tex=texture;\r\n\t\tvar _width=AtlasResourceManager.atlasTextureWidth;\r\n\t\tvar _height=AtlasResourceManager.atlasTextureHeight;\r\n\t\tvar u1=offsetX / _width,v1=offsetY / _height,u2=(offsetX+texture.bitmap.width)/ _width,v2=(offsetY+texture.bitmap.height)/ _height;\r\n\t\tvar inAltasUVWidth=texture.bitmap.width / _width,inAltasUVHeight=texture.bitmap.height / _height;\r\n\t\ttexture.uv=[u1+oriUV[0] *inAltasUVWidth,v1+oriUV[1] *inAltasUVHeight,u2-(1-oriUV[2])*inAltasUVWidth,v1+oriUV[3] *inAltasUVHeight,u2-(1-oriUV[4])*inAltasUVWidth,v2-(1-oriUV[5])*inAltasUVHeight,u1+oriUV[6] *inAltasUVWidth,v2-(1-oriUV[7])*inAltasUVHeight];\r\n\t}\r\n\r\n\t__proto.findBitmapIsExist=function(bitmap){\r\n\t\tif ((bitmap instanceof laya.webgl.resource.WebGLImage )){\r\n\t\t\tvar webImage=bitmap;\r\n\t\t\tvar sUrl=webImage.url;\r\n\t\t\tvar object=this._InAtlasWebGLImagesKey[sUrl?sUrl:webImage.id]\r\n\t\t\tif (object){\r\n\t\t\t\treturn object.offsetInfoID;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn-1;\r\n\t}\r\n\r\n\t/**\r\n\t*\r\n\t*@param inAtlasRes\r\n\t*@return 是否已经存在队列中\r\n\t*/\r\n\t__proto.addToAtlasTexture=function(mergeAtlasBitmap,offsetX,offsetY){\r\n\t\tif ((mergeAtlasBitmap instanceof laya.webgl.resource.WebGLImage )){\r\n\t\t\tvar webImage=mergeAtlasBitmap;\r\n\t\t\tvar sUrl=webImage.url;\r\n\t\t\tthis._InAtlasWebGLImagesKey[sUrl?sUrl:webImage.id]={bitmap:mergeAtlasBitmap,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length};\r\n\t\t\tthis._InAtlasWebGLImagesOffsetValue.push([offsetX,offsetY]);\r\n\t\t}\r\n\t\tthis._atlasCanvas.texSubImage2D(offsetX,offsetY,mergeAtlasBitmap.atlasSource);\r\n\t\tmergeAtlasBitmap.clearAtlasSource();\r\n\t}\r\n\r\n\t__proto.addToAtlas=function(texture,offsetX,offsetY){\r\n\t\ttexture._atlasID=this._inAtlasTextureKey.length;\r\n\t\tvar oriUV=texture.uv.slice();\r\n\t\tvar oriBitmap=texture.bitmap;\r\n\t\tthis._inAtlasTextureKey.push(texture);\r\n\t\tthis._inAtlasTextureOriUVValue.push(oriUV);\r\n\t\tthis._inAtlasTextureBitmapValue.push(oriBitmap);\r\n\t\tthis.computeUVinAtlasTexture(texture,oriUV,offsetX,offsetY);\r\n\t\ttexture.bitmap=this._atlasCanvas;\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tfor (var i=0,n=this._inAtlasTextureKey.length;i < n;i++){\r\n\t\t\tthis._inAtlasTextureKey[i].bitmap=this._inAtlasTextureBitmapValue[i];\r\n\t\t\tthis._inAtlasTextureKey[i].uv=this._inAtlasTextureOriUVValue[i];\r\n\t\t\tthis._inAtlasTextureKey[i]._atlasID=-1;\r\n\t\t\tthis._inAtlasTextureKey[i].bitmap.lock=false;\r\n\t\t\tthis._inAtlasTextureKey[i].bitmap.releaseResource();\r\n\t\t}\r\n\t\tthis._inAtlasTextureKey.length=0;\r\n\t\tthis._inAtlasTextureBitmapValue.length=0;\r\n\t\tthis._inAtlasTextureOriUVValue.length=0;\r\n\t\tthis._InAtlasWebGLImagesKey=null;\r\n\t\tthis._InAtlasWebGLImagesOffsetValue.length=0;\r\n\t}\r\n\r\n\t__proto.dispose=function(){\r\n\t\tthis.clear();\r\n\t\tthis._atlasCanvas.destroy();\r\n\t}\r\n\r\n\t__getset(0,__proto,'InAtlasWebGLImagesOffsetValue',function(){\r\n\t\treturn this._InAtlasWebGLImagesOffsetValue;\r\n\t});\r\n\r\n\t__getset(0,__proto,'texture',function(){\r\n\t\treturn this._atlasCanvas;\r\n\t});\r\n\r\n\t__getset(0,__proto,'inAtlasWebGLImagesKey',function(){\r\n\t\treturn this._InAtlasWebGLImagesKey;\r\n\t});\r\n\r\n\treturn Atlaser;\r\n})(AtlasGrid)\r\n\r\n\r\n//class laya.webgl.shader.d2.ShaderDefines2D extends laya.webgl.shader.ShaderDefines\r\nvar ShaderDefines2D=(function(_super){\r\n\tfunction ShaderDefines2D(){\r\n\t\tShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap);\r\n\t}\r\n\r\n\t__class(ShaderDefines2D,'laya.webgl.shader.d2.ShaderDefines2D',_super);\r\n\tShaderDefines2D.__init__=function(){\r\n\t\tShaderDefines2D.reg(\"TEXTURE2D\",0x01);\r\n\t\tShaderDefines2D.reg(\"COLOR2D\",0x02);\r\n\t\tShaderDefines2D.reg(\"PRIMITIVE\",0x04);\r\n\t\tShaderDefines2D.reg(\"GLOW_FILTER\",0x08);\r\n\t\tShaderDefines2D.reg(\"BLUR_FILTER\",0x10);\r\n\t\tShaderDefines2D.reg(\"COLOR_FILTER\",0x20);\r\n\t\tShaderDefines2D.reg(\"COLOR_ADD\",0x40);\r\n\t\tShaderDefines2D.reg(\"WORLDMAT\",0x80);\r\n\t\tShaderDefines2D.reg(\"FILLTEXTURE\",0x100);\r\n\t\tShaderDefines2D.reg(\"FSHIGHPRECISION\",0x400);\r\n\t}\r\n\r\n\tShaderDefines2D.reg=function(name,value){\r\n\t\tShaderDefines._reg(name,value,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name);\r\n\t}\r\n\r\n\tShaderDefines2D.toText=function(value,int2name,int2nameMap){\r\n\t\treturn ShaderDefines._toText(value,int2name,int2nameMap);\r\n\t}\r\n\r\n\tShaderDefines2D.toInt=function(names){\r\n\t\treturn ShaderDefines._toInt(names,ShaderDefines2D.__name2int);\r\n\t}\r\n\r\n\tShaderDefines2D.TEXTURE2D=0x01;\r\n\tShaderDefines2D.COLOR2D=0x02;\r\n\tShaderDefines2D.PRIMITIVE=0x04;\r\n\tShaderDefines2D.FILTERGLOW=0x08;\r\n\tShaderDefines2D.FILTERBLUR=0x10;\r\n\tShaderDefines2D.FILTERCOLOR=0x20;\r\n\tShaderDefines2D.COLORADD=0x40;\r\n\tShaderDefines2D.WORLDMAT=0x80;\r\n\tShaderDefines2D.FILLTEXTURE=0x100;\r\n\tShaderDefines2D.SKINMESH=0x200;\r\n\tShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=0x400;\r\n\tShaderDefines2D.__name2int={};\r\n\tShaderDefines2D.__int2name=[];\r\n\tShaderDefines2D.__int2nameMap=[];\r\n\treturn ShaderDefines2D;\r\n})(ShaderDefines)\r\n\r\n\r\n//class laya.webgl.shapes.Ellipse extends laya.webgl.shapes.BasePoly\r\nvar Ellipse=(function(_super){\r\n\tfunction Ellipse(x,y,width,height,color,borderWidth,borderColor){\r\n\t\tEllipse.__super.call(this,x,y,width,height,40,color,borderWidth,borderColor);\r\n\t}\r\n\r\n\t__class(Ellipse,'laya.webgl.shapes.Ellipse',_super);\r\n\treturn Ellipse;\r\n})(BasePoly)\r\n\r\n\r\n//class laya.webgl.shapes.Line extends laya.webgl.shapes.BasePoly\r\nvar Line=(function(_super){\r\n\tfunction Line(x,y,points,borderWidth,color){\r\n\t\tthis._points=[];\r\n\t\tthis.rebuild(points);\r\n\t\tLine.__super.call(this,x,y,0,0,0,color,borderWidth,color,0);\r\n\t}\r\n\r\n\t__class(Line,'laya.webgl.shapes.Line',_super);\r\n\tvar __proto=Line.prototype;\r\n\t__proto.rebuild=function(points){\r\n\t\tvar len=points.length;\r\n\t\tvar preLen=this._points.length;\r\n\t\tif (len !=preLen){\r\n\t\t\tthis.mUint16Array=new Uint16Array((len/2-1)*6);\r\n\t\t\tthis.mFloat32Array=new Float32Array(len*5);\r\n\t\t}\r\n\t\tthis._points.length=0;\r\n\t\tvar tCurrX=NaN;\r\n\t\tvar tCurrY=NaN;\r\n\t\tvar tLastX=-1;\r\n\t\tvar tLastY=-1;\r\n\t\tvar tLen=points.length / 2;\r\n\t\tfor (var i=0;i < tLen;i++){\r\n\t\t\ttCurrX=points[i *2];\r\n\t\t\ttCurrY=points[i *2+1];\r\n\t\t\tif (Math.abs(tLastX-tCurrX)> 0.01 || Math.abs(tLastY-tCurrY)>0.01){\r\n\t\t\t\tthis._points.push(tCurrX,tCurrY);\r\n\t\t\t}\r\n\t\t\ttLastX=tCurrX;\r\n\t\t\ttLastY=tCurrY;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getData=function(ib,vb,start){\r\n\t\tvar indices=[];\r\n\t\tvar verts=[];\r\n\t\t(this.borderWidth > 0)&& this.createLine2(this._points,indices,this.borderWidth,start,verts,this._points.length / 2);\r\n\t\tthis.mUint16Array.set(indices,0);\r\n\t\tthis.mFloat32Array.set(verts,0);\r\n\t\tib.append(this.mUint16Array);\r\n\t\tvb.append(this.mFloat32Array);\r\n\t}\r\n\r\n\treturn Line;\r\n})(BasePoly)\r\n\r\n\r\n//class laya.webgl.shapes.LoopLine extends laya.webgl.shapes.BasePoly\r\nvar LoopLine=(function(_super){\r\n\tfunction LoopLine(x,y,points,width,color){\r\n\t\tthis._points=[];\r\n\t\tvar tCurrX=NaN;\r\n\t\tvar tCurrY=NaN;\r\n\t\tvar tLastX=-1;\r\n\t\tvar tLastY=-1;\r\n\t\tvar tLen=points.length / 2-1;\r\n\t\tfor (var i=0;i < tLen;i++){\r\n\t\t\ttCurrX=points[i *2];\r\n\t\t\ttCurrY=points[i *2+1];\r\n\t\t\tif (Math.abs(tLastX-tCurrX)> 0.01 || Math.abs(tLastY-tCurrY)> 0.01){\r\n\t\t\t\tthis._points.push(tCurrX,tCurrY);\r\n\t\t\t}\r\n\t\t\ttLastX=tCurrX;\r\n\t\t\ttLastY=tCurrY;\r\n\t\t}\r\n\t\ttCurrX=points[tLen *2];\r\n\t\ttCurrY=points[tLen *2+1];\r\n\t\ttLastX=this._points[0];\r\n\t\ttLastY=this._points[1];\r\n\t\tif (Math.abs(tLastX-tCurrX)> 0.01 || Math.abs(tLastY-tCurrY)> 0.01){\r\n\t\t\tthis._points.push(tCurrX,tCurrY);\r\n\t\t}\r\n\t\tLoopLine.__super.call(this,x,y,0,0,this._points.length / 2,0,width,color);\r\n\t}\r\n\r\n\t__class(LoopLine,'laya.webgl.shapes.LoopLine',_super);\r\n\tvar __proto=LoopLine.prototype;\r\n\t__proto.getData=function(ib,vb,start){\r\n\t\tif (this.borderWidth > 0){\r\n\t\t\tvar color=this.color;\r\n\t\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\t\tvar verts=[];\r\n\t\t\tvar tLastX=-1,tLastY=-1;\r\n\t\t\tvar tCurrX=0,tCurrY=0;\r\n\t\t\tvar indices=[];\r\n\t\t\tvar tLen=Math.floor(this._points.length / 2);\r\n\t\t\tfor (var i=0;i < tLen;i++){\r\n\t\t\t\ttCurrX=this._points[i *2];\r\n\t\t\t\ttCurrY=this._points[i *2+1];\r\n\t\t\t\tverts.push(this.x+tCurrX,this.y+tCurrY,r,g,b);\r\n\t\t\t}\r\n\t\t\tthis.createLoopLine(verts,indices,this.borderWidth,start+verts.length / 5);\r\n\t\t\tib.append(new Uint16Array(indices));\r\n\t\t\tvb.append(new Float32Array(verts));\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){\r\n\t\tvar tLen=p.length / 5;\r\n\t\tvar points=p.concat();\r\n\t\tvar result=outVertex ? outVertex :p;\r\n\t\tvar color=this.borderColor;\r\n\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\tvar firstPoint=[points[0],points[1]];\r\n\t\tvar lastPoint=[points[points.length-5],points[points.length-4]];\r\n\t\tvar midPointX=lastPoint[0]+(firstPoint[0]-lastPoint[0])*0.5;\r\n\t\tvar midPointY=lastPoint[1]+(firstPoint[1]-lastPoint[1])*0.5;\r\n\t\tpoints.unshift(midPointX,midPointY,0,0,0);\r\n\t\tpoints.push(midPointX,midPointY,0,0,0);\r\n\t\tvar length=points.length / 5;\r\n\t\tvar iStart=len,w=lineWidth / 2;\r\n\t\tvar px,py,p1x,p1y,p2x,p2y,p3x,p3y;\r\n\t\tvar perpx,perpy,perp2x,perp2y,perp3x,perp3y;\r\n\t\tvar a1,b1,c1,a2,b2,c2;\r\n\t\tvar denom,pdist,dist;\r\n\t\tp1x=points[0];\r\n\t\tp1y=points[1];\r\n\t\tp2x=points[5];\r\n\t\tp2y=points[6];\r\n\t\tperpx=-(p1y-p2y);\r\n\t\tperpy=p1x-p2x;\r\n\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\tperpx=perpx / dist *w;\r\n\t\tperpy=perpy / dist *w;\r\n\t\tresult.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);\r\n\t\tfor (var i=1;i < length-1;i++){\r\n\t\t\tp1x=points[(i-1)*5];\r\n\t\t\tp1y=points[(i-1)*5+1];\r\n\t\t\tp2x=points[(i)*5];\r\n\t\t\tp2y=points[(i)*5+1];\r\n\t\t\tp3x=points[(i+1)*5];\r\n\t\t\tp3y=points[(i+1)*5+1];\r\n\t\t\tperpx=-(p1y-p2y);\r\n\t\t\tperpy=p1x-p2x;\r\n\t\t\tdist=Math.sqrt(perpx *perpx+perpy *perpy);\r\n\t\t\tperpx=perpx / dist *w;\r\n\t\t\tperpy=perpy / dist *w;\r\n\t\t\tperp2x=-(p2y-p3y);\r\n\t\t\tperp2y=p2x-p3x;\r\n\t\t\tdist=Math.sqrt(perp2x *perp2x+perp2y *perp2y);\r\n\t\t\tperp2x=perp2x / dist *w;\r\n\t\t\tperp2y=perp2y / dist *w;\r\n\t\t\ta1=(-perpy+p1y)-(-perpy+p2y);\r\n\t\t\tb1=(-perpx+p2x)-(-perpx+p1x);\r\n\t\t\tc1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);\r\n\t\t\ta2=(-perp2y+p3y)-(-perp2y+p2y);\r\n\t\t\tb2=(-perp2x+p2x)-(-perp2x+p3x);\r\n\t\t\tc2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);\r\n\t\t\tdenom=a1 *b2-a2 *b1;\r\n\t\t\tif (Math.abs(denom)< 0.1){\r\n\t\t\t\tdenom+=10.1;\r\n\t\t\t\tresult.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tpx=(b1 *c2-b2 *c1)/ denom;\r\n\t\t\tpy=(a2 *c1-a1 *c2)/ denom;\r\n\t\t\tpdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);\r\n\t\t\tresult.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);\r\n\t\t}\r\n\t\tif (outIndex){\r\n\t\t\tindices=outIndex;\r\n\t\t};\r\n\t\tvar groupLen=this.edges+1;\r\n\t\tfor (i=1;i < groupLen;i++){\r\n\t\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i *2+1,iStart+i *2+1,iStart+i *2,iStart+(i-1)*2);\r\n\t\t}\r\n\t\tindices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+1,iStart+1,iStart,iStart+(i-1)*2);\r\n\t\treturn result;\r\n\t}\r\n\r\n\treturn LoopLine;\r\n})(BasePoly)\r\n\r\n\r\n//class laya.webgl.shapes.Polygon extends laya.webgl.shapes.BasePoly\r\nvar Polygon=(function(_super){\r\n\tfunction Polygon(x,y,points,color,borderWidth,borderColor){\r\n\t\tthis._points=null;\r\n\t\tthis._start=-1;\r\n\t\tthis._repaint=false;\r\n\t\tthis.earcutTriangles=null;\r\n\t\tthis._mat=Matrix.create();\r\n\t\tthis._points=points.slice(0,points.length);\r\n\t\tPolygon.__super.call(this,x,y,0,0,this._points.length / 2,color,borderWidth,borderColor);\r\n\t}\r\n\r\n\t__class(Polygon,'laya.webgl.shapes.Polygon',_super);\r\n\tvar __proto=Polygon.prototype;\r\n\t__proto.rebuild=function(point){\r\n\t\tif (!this._repaint){\r\n\t\t\tthis._points.length=0;\r\n\t\t\tthis._points=this._points.concat(point);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.setMatrix=function(mat){\r\n\t\tmat.copyTo(this._mat);\r\n\t}\r\n\r\n\t__proto.needUpdate=function(mat){\r\n\t\tthis._repaint=(this._mat.a==mat.a && this._mat.b==mat.b && this._mat.c==mat.c && this._mat.d==mat.d && this._mat.tx==mat.tx && this._mat.ty==mat.ty);\r\n\t\treturn !this._repaint;\r\n\t}\r\n\r\n\t__proto.getData=function(ib,vb,start){\r\n\t\tvar indices,i=0;\r\n\t\tvar tArray=this._points;\r\n\t\tvar tLen=0;\r\n\t\tif (this.mUint16Array && this.mFloat32Array&&this._repaint){\r\n\t\t\tif (this._start !=start){\r\n\t\t\t\tthis._start=start;\r\n\t\t\t\tindices=[];\r\n\t\t\t\ttLen=this.earcutTriangles.length;\r\n\t\t\t\tfor (i=0;i < tLen;i++){\r\n\t\t\t\t\tindices.push(this.earcutTriangles[i]+start);\r\n\t\t\t\t}\r\n\t\t\t\tthis.mUint16Array=new Uint16Array(indices);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._start=start;\r\n\t\t\tindices=[];\r\n\t\t\tvar verts=[];\r\n\t\t\tvar vertsEarcut=[];\r\n\t\t\tvar color=this.color;\r\n\t\t\tvar r=((color >> 16)& 0x0000ff)/ 255,g=((color >> 8)& 0xff)/ 255,b=(color & 0x0000ff)/ 255;\r\n\t\t\ttLen=Math.floor(tArray.length / 2);\r\n\t\t\tfor (i=0;i < tLen;i++){\r\n\t\t\t\tverts.push(this.x+tArray[i *2],this.y+tArray[i *2+1],r,g,b);\r\n\t\t\t\tvertsEarcut.push(this.x+tArray[i *2],this.y+tArray[i *2+1]);\r\n\t\t\t}\r\n\t\t\tthis.earcutTriangles=Earcut.earcut(vertsEarcut,null,2);\r\n\t\t\ttLen=this.earcutTriangles.length;\r\n\t\t\tfor (i=0;i < tLen;i++){\r\n\t\t\t\tindices.push(this.earcutTriangles[i]+start);\r\n\t\t\t}\r\n\t\t\tthis.mUint16Array=new Uint16Array(indices);\r\n\t\t\tthis.mFloat32Array=new Float32Array(verts);\r\n\t\t}\r\n\t\tib.append(this.mUint16Array);\r\n\t\tvb.append(this.mFloat32Array);\r\n\t}\r\n\r\n\treturn Polygon;\r\n})(BasePoly)\r\n\r\n\r\n//class laya.webgl.submit.SubmitCanvas extends laya.webgl.submit.Submit\r\nvar SubmitCanvas=(function(_super){\r\n\tfunction SubmitCanvas(){\r\n\t\t//this._ctx_src=null;\r\n\t\tthis._matrix=new Matrix();\r\n\t\tthis._matrix4=CONST3D2D.defaultMatrix4.concat();\r\n\t\tSubmitCanvas.__super.call(this,/*laya.webgl.submit.Submit.TYPE_2D*/10000);\r\n\t\tthis.shaderValue=new Value2D(0,0);\r\n\t}\r\n\r\n\t__class(SubmitCanvas,'laya.webgl.submit.SubmitCanvas',_super);\r\n\tvar __proto=SubmitCanvas.prototype;\r\n\t__proto.renderSubmit=function(){\r\n\t\tif (this._ctx_src._targets){\r\n\t\t\tthis._ctx_src._targets.flush(this._ctx_src);\r\n\t\t\treturn 1;\r\n\t\t};\r\n\t\tvar preAlpha=RenderState2D.worldAlpha;\r\n\t\tvar preMatrix4=RenderState2D.worldMatrix4;\r\n\t\tvar preMatrix=RenderState2D.worldMatrix;\r\n\t\tvar preFilters=RenderState2D.worldFilters;\r\n\t\tvar preWorldShaderDefines=RenderState2D.worldShaderDefines;\r\n\t\tvar v=this.shaderValue;\r\n\t\tvar m=this._matrix;\r\n\t\tvar m4=this._matrix4;\r\n\t\tvar mout=Matrix.TEMP;\r\n\t\tMatrix.mul(m,preMatrix,mout);\r\n\t\tm4[0]=mout.a;\r\n\t\tm4[1]=mout.b;\r\n\t\tm4[4]=mout.c;\r\n\t\tm4[5]=mout.d;\r\n\t\tm4[12]=mout.tx;\r\n\t\tm4[13]=mout.ty;\r\n\t\tRenderState2D.worldMatrix=mout.clone();\r\n\t\tRenderState2D.worldMatrix4=m4;\r\n\t\tRenderState2D.worldAlpha=RenderState2D.worldAlpha *v.alpha;\r\n\t\tif (v.filters && v.filters.length){\r\n\t\t\tRenderState2D.worldFilters=v.filters;\r\n\t\t\tRenderState2D.worldShaderDefines=v.defines;\r\n\t\t}\r\n\t\tthis._ctx_src.flush();\r\n\t\tRenderState2D.worldAlpha=preAlpha;\r\n\t\tRenderState2D.worldMatrix4=preMatrix4;\r\n\t\tRenderState2D.worldMatrix.destroy();\r\n\t\tRenderState2D.worldMatrix=preMatrix;\r\n\t\tRenderState2D.worldFilters=preFilters;\r\n\t\tRenderState2D.worldShaderDefines=preWorldShaderDefines;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitCanvas._cache;\r\n\t\tthis._ctx_src=null;\r\n\t\tcache[cache._length++]=this;\r\n\t}\r\n\r\n\t__proto.getRenderType=function(){\r\n\t\treturn /*laya.webgl.submit.Submit.TYPE_CANVAS*/10003;\r\n\t}\r\n\r\n\tSubmitCanvas.create=function(ctx_src,alpha,filters){\r\n\t\tvar o=(!SubmitCanvas._cache._length)? (new SubmitCanvas()):SubmitCanvas._cache[--SubmitCanvas._cache._length];\r\n\t\to._ctx_src=ctx_src;\r\n\t\tvar v=o.shaderValue;\r\n\t\tv.alpha=alpha;\r\n\t\tv.defines.setValue(0);\r\n\t\tfilters && filters.length && v.setFilters(filters);\r\n\t\treturn o;\r\n\t}\r\n\r\n\t__static(SubmitCanvas,\r\n\t['_cache',function(){return this._cache=(SubmitCanvas._cache=[],SubmitCanvas._cache._length=0,SubmitCanvas._cache);}\r\n\t]);\r\n\treturn SubmitCanvas;\r\n})(Submit)\r\n\r\n\r\n//class laya.webgl.submit.SubmitTexture extends laya.webgl.submit.Submit\r\nvar SubmitTexture=(function(_super){\r\n\tfunction SubmitTexture(renderType){\r\n\t\tthis._preIsSameTextureShader=false;\r\n\t\tthis._isSameTexture=true;\r\n\t\tthis._texs=new Array;\r\n\t\tthis._texsID=new Array;\r\n\t\tthis._vbPos=new Array;\r\n\t\t(renderType===void 0)&& (renderType=10000);\r\n\t\tSubmitTexture.__super.call(this,renderType);\r\n\t}\r\n\r\n\t__class(SubmitTexture,'laya.webgl.submit.SubmitTexture',_super);\r\n\tvar __proto=SubmitTexture.prototype;\r\n\t__proto.releaseRender=function(){\r\n\t\tvar cache=SubmitTexture._cache;\r\n\t\tcache[cache._length++]=this;\r\n\t\tthis.shaderValue.release();\r\n\t\tthis._preIsSameTextureShader=false;\r\n\t\tthis._vb=null;\r\n\t\tthis._texs.length=0;\r\n\t\tthis._vbPos.length=0;\r\n\t\tthis._isSameTexture=true;\r\n\t}\r\n\r\n\t__proto.addTexture=function(tex,vbpos){\r\n\t\tthis._texsID[this._texs.length]=tex._uvID;\r\n\t\tthis._texs.push(tex);\r\n\t\tthis._vbPos.push(vbpos);\r\n\t}\r\n\r\n\t//检查材质是否修改，修改UV，设置是否是同一材质\r\n\t__proto.checkTexture=function(){\r\n\t\tif (this._texs.length < 1){\r\n\t\t\tthis._isSameTexture=true;\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar _tex=this.shaderValue.textureHost;\r\n\t\tvar webGLImg=_tex.bitmap;\r\n\t\tif (webGLImg===null)return;\r\n\t\tvar vbdata=this._vb.getFloat32Array();\r\n\t\tfor (var i=0,s=this._texs.length;i < s;i++){\r\n\t\t\tvar tex=this._texs[i];\r\n\t\t\ttex.active();\r\n\t\t\tvar newUV=tex.uv;\r\n\t\t\tif (this._texsID[i]!==tex._uvID){\r\n\t\t\t\tthis._texsID[i]=tex._uvID;\r\n\t\t\t\tvar vbPos=this._vbPos[i];\r\n\t\t\t\tvbdata[vbPos+2]=newUV[0];\r\n\t\t\t\tvbdata[vbPos+3]=newUV[1];\r\n\t\t\t\tvbdata[vbPos+6]=newUV[2];\r\n\t\t\t\tvbdata[vbPos+7]=newUV[3];\r\n\t\t\t\tvbdata[vbPos+10]=newUV[4];\r\n\t\t\t\tvbdata[vbPos+11]=newUV[5];\r\n\t\t\t\tvbdata[vbPos+14]=newUV[6];\r\n\t\t\t\tvbdata[vbPos+15]=newUV[7];\r\n\t\t\t\tthis._vb.setNeedUpload();\r\n\t\t\t}\r\n\t\t\tif (tex.bitmap!==webGLImg){\r\n\t\t\t\tthis._isSameTexture=false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.renderSubmit=function(){\r\n\t\tif (this._numEle===0){\r\n\t\t\tSubmitTexture._shaderSet=false;\r\n\t\t\treturn 1;\r\n\t\t};\r\n\t\tvar _tex=this.shaderValue.textureHost;\r\n\t\tif (_tex){\r\n\t\t\tvar source=_tex.source;\r\n\t\t\tif (!_tex.bitmap || !source){\r\n\t\t\t\tSubmitTexture._shaderSet=false;\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\tthis.shaderValue.texture=source;\r\n\t\t}\r\n\t\tthis._vb.bind_upload(this._ib);\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tif (BlendMode.activeBlendFunction!==this._blendFn){\r\n\t\t\tgl.enable(/*laya.webgl.WebGLContext.BLEND*/0x0BE2);\r\n\t\t\tthis._blendFn(gl);\r\n\t\t\tBlendMode.activeBlendFunction=this._blendFn;\r\n\t\t}\r\n\t\tStat.drawCall++;\r\n\t\tStat.trianglesFaces+=this._numEle / 3;\r\n\t\tif (this._preIsSameTextureShader && BaseShader.activeShader && SubmitTexture._shaderSet)\r\n\t\t\t(BaseShader.activeShader).uploadTexture2D(this.shaderValue.texture);\r\n\t\telse this.shaderValue.upload();\r\n\t\tSubmitTexture._shaderSet=true;\r\n\t\tif (this._texs.length > 1 && !this._isSameTexture){\r\n\t\t\tvar webGLImg=_tex.bitmap;\r\n\t\t\tvar index=0;\r\n\t\t\tvar shader=BaseShader.activeShader;\r\n\t\t\tfor (var i=0,s=this._texs.length;i < s;i++){\r\n\t\t\t\tvar tex2=this._texs[i];\r\n\t\t\t\tif (tex2.bitmap!==webGLImg || (i+1)===s){\r\n\t\t\t\t\tshader.uploadTexture2D(tex2.source);\r\n\t\t\t\t\tgl.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,(i-index+1)*6,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._startIdx+index *6 *CONST3D2D.BYTES_PIDX);\r\n\t\t\t\t\twebGLImg=tex2.bitmap;\r\n\t\t\t\t\tindex=i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tgl.drawElements(/*laya.webgl.WebGLContext.TRIANGLES*/0x0004,this._numEle,/*laya.webgl.WebGLContext.UNSIGNED_SHORT*/0x1403,this._startIdx);\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tSubmitTexture.create=function(context,ib,vb,pos,sv){\r\n\t\tvar o=SubmitTexture._cache._length ? SubmitTexture._cache[--SubmitTexture._cache._length] :new SubmitTexture();\r\n\t\tif (vb==null){\r\n\t\t\tvb=o._selfVb || (o._selfVb=VertexBuffer2D.create(-1));\r\n\t\t\tvb.clear();\r\n\t\t\tpos=0;\r\n\t\t}\r\n\t\to._ib=ib;\r\n\t\to._vb=vb;\r\n\t\to._startIdx=pos *CONST3D2D.BYTES_PIDX;\r\n\t\to._numEle=0;\r\n\t\tvar blendType=context._nBlendType;\r\n\t\to._blendFn=context._targets ? BlendMode.targetFns[blendType] :BlendMode.fns[blendType];\r\n\t\to.shaderValue=sv;\r\n\t\to.shaderValue.setValue(context._shader2D);\r\n\t\tvar filters=context._shader2D.filters;\r\n\t\tfilters && o.shaderValue.setFilters(filters);\r\n\t\treturn o;\r\n\t}\r\n\r\n\tSubmitTexture._shaderSet=true;\r\n\t__static(SubmitTexture,\r\n\t['_cache',function(){return this._cache=(SubmitTexture._cache=[],SubmitTexture._cache._length=0,SubmitTexture._cache);}\r\n\t]);\r\n\treturn SubmitTexture;\r\n})(Submit)\r\n\r\n\r\n/**\r\n*...\r\n*@author ...\r\n*/\r\n//class laya.webgl.shader.BaseShader extends laya.resource.Resource\r\nvar BaseShader=(function(_super){\r\n\tfunction BaseShader(){\r\n\t\tBaseShader.__super.call(this);\r\n\t\tthis.lock=true;\r\n\t}\r\n\r\n\t__class(BaseShader,'laya.webgl.shader.BaseShader',_super);\r\n\tBaseShader.activeShader=null;\r\n\tBaseShader.bindShader=null;\r\n\treturn BaseShader;\r\n})(Resource)\r\n\r\n\r\n//class laya.webgl.resource.RenderTarget2D extends laya.resource.Texture\r\nvar RenderTarget2D=(function(_super){\r\n\tfunction RenderTarget2D(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){\r\n\t\tthis._type=0;\r\n\t\tthis._svWidth=NaN;\r\n\t\tthis._svHeight=NaN;\r\n\t\tthis._preRenderTarget=null;\r\n\t\t//TODO:.........................................................\r\n\t\tthis._alreadyResolved=false;\r\n\t\tthis._looked=false;\r\n\t\tthis._surfaceFormat=0;\r\n\t\tthis._surfaceType=0;\r\n\t\tthis._depthStencilFormat=0;\r\n\t\tthis._mipMap=false;\r\n\t\tthis._repeat=false;\r\n\t\tthis._minFifter=0;\r\n\t\tthis._magFifter=0;\r\n\t\tthis._destroy=false;\r\n\t\t(surfaceFormat===void 0)&& (surfaceFormat=/*laya.webgl.WebGLContext.RGBA*/0x1908);\r\n\t\t(surfaceType===void 0)&& (surfaceType=/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401);\r\n\t\t(depthStencilFormat===void 0)&& (depthStencilFormat=/*laya.webgl.WebGLContext.DEPTH_STENCIL*/0x84F9);\r\n\t\t(mipMap===void 0)&& (mipMap=false);\r\n\t\t(repeat===void 0)&& (repeat=false);\r\n\t\t(minFifter===void 0)&& (minFifter=-1);\r\n\t\t(magFifter===void 0)&& (magFifter=-1);\r\n\t\tthis._type=1;\r\n\t\tthis._w=width;\r\n\t\tthis._h=height;\r\n\t\tthis._surfaceFormat=surfaceFormat;\r\n\t\tthis._surfaceType=surfaceType;\r\n\t\tthis._depthStencilFormat=depthStencilFormat;\r\n\t\tthis._mipMap=mipMap;\r\n\t\tthis._repeat=repeat;\r\n\t\tthis._minFifter=minFifter;\r\n\t\tthis._magFifter=magFifter;\r\n\t\tthis._createWebGLRenderTarget();\r\n\t\tthis.bitmap.lock=true;\r\n\t\tRenderTarget2D.__super.call(this,this.bitmap,Texture.INV_UV);\r\n\t}\r\n\r\n\t__class(RenderTarget2D,'laya.webgl.resource.RenderTarget2D',_super);\r\n\tvar __proto=RenderTarget2D.prototype;\r\n\tLaya.imps(__proto,{\"laya.resource.IDispose\":true})\r\n\t//TODO:临时......................................................\r\n\t__proto.getType=function(){\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\t//*/\r\n\t__proto.getTexture=function(){\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto.size=function(w,h){\r\n\t\tif (this._w==w && this._h==h)return;\r\n\t\tthis._w=w;\r\n\t\tthis._h=h;\r\n\t\tthis.release();\r\n\t\tif (this._w !=0 && this._h !=0)this._createWebGLRenderTarget();\r\n\t}\r\n\r\n\t__proto.release=function(){\r\n\t\tthis.destroy();\r\n\t}\r\n\r\n\t__proto.recycle=function(){\r\n\t\tRenderTarget2D.POOL.push(this);\r\n\t}\r\n\r\n\t__proto.start=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis._preRenderTarget=RenderState2D.curRenderTarget;\r\n\t\tRenderState2D.curRenderTarget=this;\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,this.bitmap.frameBuffer);\r\n\t\tthis._alreadyResolved=false;\r\n\t\tif (this._type==1){\r\n\t\t\tgl.viewport(0,0,this._w,this._h);\r\n\t\t\tthis._svWidth=RenderState2D.width;\r\n\t\t\tthis._svHeight=RenderState2D.height;\r\n\t\t\tRenderState2D.width=this._w;\r\n\t\t\tRenderState2D.height=this._h;\r\n\t\t\tBaseShader.activeShader=null;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto.clear=function(r,g,b,a){\r\n\t\t(r===void 0)&& (r=0.0);\r\n\t\t(g===void 0)&& (g=0.0);\r\n\t\t(b===void 0)&& (b=0.0);\r\n\t\t(a===void 0)&& (a=1.0);\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.clearColor(r,g,b,a);\r\n\t\tvar clearFlag=/*laya.webgl.WebGLContext.COLOR_BUFFER_BIT*/0x00004000;\r\n\t\tswitch (this._depthStencilFormat){\r\n\t\t\tcase /*laya.webgl.WebGLContext.DEPTH_COMPONENT16*/0x81A5:\r\n\t\t\t\tclearFlag |=/*laya.webgl.WebGLContext.DEPTH_BUFFER_BIT*/0x00000100;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase /*laya.webgl.WebGLContext.STENCIL_INDEX8*/0x8D48:\r\n\t\t\t\tclearFlag |=/*laya.webgl.WebGLContext.STENCIL_BUFFER_BIT*/0x00000400;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase /*laya.webgl.WebGLContext.DEPTH_STENCIL*/0x84F9:\r\n\t\t\t\tclearFlag |=/*laya.webgl.WebGLContext.DEPTH_BUFFER_BIT*/0x00000100;\r\n\t\t\t\tclearFlag |=/*laya.webgl.WebGLContext.STENCIL_BUFFER_BIT*/0x00000400\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tgl.clear(clearFlag);\r\n\t}\r\n\r\n\t__proto.end=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,this._preRenderTarget ? this._preRenderTarget.bitmap.frameBuffer :null);\r\n\t\tthis._alreadyResolved=true;\r\n\t\tRenderState2D.curRenderTarget=this._preRenderTarget;\r\n\t\tif (this._type==1){\r\n\t\t\tgl.viewport(0,0,this._svWidth,this._svHeight);\r\n\t\t\tRenderState2D.width=this._svWidth;\r\n\t\t\tRenderState2D.height=this._svHeight;\r\n\t\t\tBaseShader.activeShader=null;\r\n\t\t}else gl.viewport(0,0,Laya.stage.width,Laya.stage.height);\r\n\t}\r\n\r\n\t__proto.getData=function(x,y,width,height){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,(this.bitmap).frameBuffer);\r\n\t\tvar canRead=(gl.checkFramebufferStatus(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40)===/*laya.webgl.WebGLContext.FRAMEBUFFER_COMPLETE*/0x8CD5);\r\n\t\tif (!canRead){\r\n\t\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,null);\r\n\t\t\treturn null;\r\n\t\t};\r\n\t\tvar pixels=new Uint8Array(this._w *this._h *4);\r\n\t\tgl.readPixels(x,y,width,height,this._surfaceFormat,this._surfaceType,pixels);\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,null);\r\n\t\treturn pixels;\r\n\t}\r\n\r\n\t/**彻底清理资源,注意会强制解锁清理*/\r\n\t__proto.destroy=function(foreDiposeTexture){\r\n\t\t(foreDiposeTexture===void 0)&& (foreDiposeTexture=false);\r\n\t\tif (!this._destroy){\r\n\t\t\tthis._loaded=false;\r\n\t\t\tthis.bitmap.offAll();\r\n\t\t\tthis.bitmap.disposeResource();\r\n\t\t\tthis.bitmap.dispose();\r\n\t\t\tthis.offAll();\r\n\t\t\tthis.bitmap=null;\r\n\t\t\tthis._alreadyResolved=false;\r\n\t\t\tthis._destroy=true;\r\n\t\t\t_super.prototype.destroy.call(this);\r\n\t\t}\r\n\t}\r\n\r\n\t//待测试\r\n\t__proto.dispose=function(){}\r\n\t__proto._createWebGLRenderTarget=function(){\r\n\t\tthis.bitmap=new WebGLRenderTarget(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter);\r\n\t\tthis.bitmap.activeResource();\r\n\t\tthis._alreadyResolved=true;\r\n\t\tthis._destroy=false;\r\n\t\tthis._loaded=true;\r\n\t\tthis.bitmap.on(/*laya.events.Event.RECOVERED*/\"recovered\",this,function(e){\r\n\t\t\tthis.event(/*laya.events.Event.RECOVERED*/\"recovered\");\r\n\t\t})\r\n\t}\r\n\r\n\t__getset(0,__proto,'surfaceFormat',function(){\r\n\t\treturn this._surfaceFormat;\r\n\t});\r\n\r\n\t__getset(0,__proto,'magFifter',function(){\r\n\t\treturn this._magFifter;\r\n\t});\r\n\r\n\t__getset(0,__proto,'surfaceType',function(){\r\n\t\treturn this._surfaceType;\r\n\t});\r\n\r\n\t__getset(0,__proto,'mipMap',function(){\r\n\t\treturn this._mipMap;\r\n\t});\r\n\r\n\t__getset(0,__proto,'depthStencilFormat',function(){\r\n\t\treturn this._depthStencilFormat;\r\n\t});\r\n\r\n\t//}\r\n\t__getset(0,__proto,'minFifter',function(){\r\n\t\treturn this._minFifter;\r\n\t});\r\n\r\n\t/**返回RenderTarget的Texture*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\tif (this._alreadyResolved)\r\n\t\t\treturn Laya.superGet(Texture,this,'source');\r\n\t\treturn null;\r\n\t});\r\n\r\n\tRenderTarget2D.create=function(w,h,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){\r\n\t\t(surfaceFormat===void 0)&& (surfaceFormat=/*laya.webgl.WebGLContext.RGBA*/0x1908);\r\n\t\t(surfaceType===void 0)&& (surfaceType=/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401);\r\n\t\t(depthStencilFormat===void 0)&& (depthStencilFormat=/*laya.webgl.WebGLContext.DEPTH_STENCIL*/0x84F9);\r\n\t\t(mipMap===void 0)&& (mipMap=false);\r\n\t\t(repeat===void 0)&& (repeat=false);\r\n\t\t(minFifter===void 0)&& (minFifter=-1);\r\n\t\t(magFifter===void 0)&& (magFifter=-1);\r\n\t\tvar t=RenderTarget2D.POOL.pop();\r\n\t\tt || (t=new RenderTarget2D(w,h));\r\n\t\tif (!t.bitmap || t._w !=w || t._h !=h || t._surfaceFormat !=surfaceFormat || t._surfaceType !=surfaceType || t._depthStencilFormat !=depthStencilFormat || t._mipMap !=mipMap || t._repeat !=repeat || t._minFifter !=minFifter || t._magFifter !=magFifter){\r\n\t\t\tt._w=w;\r\n\t\t\tt._h=h;\r\n\t\t\tt._surfaceFormat=surfaceFormat;\r\n\t\t\tt._surfaceType=surfaceType;\r\n\t\t\tt._depthStencilFormat=depthStencilFormat;\r\n\t\t\tt._mipMap=mipMap;\r\n\t\t\tt._repeat=repeat;\r\n\t\t\tt._minFifter=minFifter;\r\n\t\t\tt._magFifter=magFifter;\r\n\t\t\tt.release();\r\n\t\t\tt._createWebGLRenderTarget();\r\n\t\t}\r\n\t\treturn t;\r\n\t}\r\n\r\n\tRenderTarget2D.TYPE2D=1;\r\n\tRenderTarget2D.TYPE3D=2;\r\n\tRenderTarget2D.POOL=[];\r\n\treturn RenderTarget2D;\r\n})(Texture)\r\n\r\n\r\n//class laya.webgl.utils.Buffer extends laya.resource.Resource\r\nvar Buffer=(function(_super){\r\n\tfunction Buffer(){\r\n\t\tthis._glBuffer=null;\r\n\t\tthis._buffer=null;\r\n\t\t//可能为Float32Array、Uint16Array、Uint8Array、ArrayBuffer等。\r\n\t\tthis._bufferType=0;\r\n\t\tthis._bufferUsage=0;\r\n\t\tthis._byteLength=0;\r\n\t\tBuffer.__super.call(this);\r\n\t\tBuffer._gl=WebGL.mainContext;\r\n\t}\r\n\r\n\t__class(Buffer,'laya.webgl.utils.Buffer',_super);\r\n\tvar __proto=Buffer.prototype;\r\n\t__proto._bind=function(){\r\n\t\tthis.activeResource();\r\n\t\tif (Buffer._bindActive[this._bufferType]!==this._glBuffer){\r\n\t\t\t(this._bufferType===/*laya.webgl.WebGLContext.ARRAY_BUFFER*/0x8892)&& (Buffer._bindVertexBuffer=this._glBuffer);\r\n\t\t\tBuffer._gl.bindBuffer(this._bufferType,Buffer._bindActive[this._bufferType]=this._glBuffer);\r\n\t\t\tBaseShader.activeShader=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.recreateResource=function(){\r\n\t\tthis._glBuffer || (this._glBuffer=Buffer._gl.createBuffer());\r\n\t\tthis.completeCreate();\r\n\t}\r\n\r\n\t__proto.disposeResource=function(){\r\n\t\tif (this._glBuffer){\r\n\t\t\tWebGL.mainContext.deleteBuffer(this._glBuffer);\r\n\t\t\tthis._glBuffer=null;\r\n\t\t}\r\n\t\tthis.memorySize=0;\r\n\t}\r\n\r\n\t__getset(0,__proto,'bufferUsage',function(){\r\n\t\treturn this._bufferUsage;\r\n\t});\r\n\r\n\tBuffer._gl=null;\r\n\tBuffer._bindActive={};\r\n\tBuffer._bindVertexBuffer=null;\r\n\tBuffer._enableAtributes=[];\r\n\treturn Buffer;\r\n})(Resource)\r\n\r\n\r\n//class laya.webgl.shader.d2.skinAnishader.SkinSV extends laya.webgl.shader.d2.value.Value2D\r\nvar SkinSV=(function(_super){\r\n\tfunction SkinSV(type){\r\n\t\tthis.texcoord=null;\r\n\t\tthis.offsetX=300;\r\n\t\tthis.offsetY=0;\r\n\t\tSkinSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.SKINMESH*/0x200,0);\r\n\t\tvar _vlen=8 *CONST3D2D.BYTES_PE;\r\n\t\tthis.position=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,_vlen,0];\r\n\t\tthis.texcoord=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,_vlen,2 *CONST3D2D.BYTES_PE];\r\n\t\tthis.color=[4,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,_vlen,4 *CONST3D2D.BYTES_PE];\r\n\t}\r\n\r\n\t__class(SkinSV,'laya.webgl.shader.d2.skinAnishader.SkinSV',_super);\r\n\treturn SkinSV;\r\n})(Value2D)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.Color2dSV extends laya.webgl.shader.d2.value.Value2D\r\nvar Color2dSV=(function(_super){\r\n\tfunction Color2dSV(args){\r\n\t\tColor2dSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.COLOR2D*/0x02,0);\r\n\t\tthis.color=[];\r\n\t}\r\n\r\n\t__class(Color2dSV,'laya.webgl.shader.d2.value.Color2dSV',_super);\r\n\tvar __proto=Color2dSV.prototype;\r\n\t__proto.setValue=function(value){\r\n\t\tvalue.fillStyle&&(this.color=value.fillStyle._color._color);\r\n\t\tvalue.strokeStyle&&(this.color=value.strokeStyle._color._color);\r\n\t}\r\n\r\n\treturn Color2dSV;\r\n})(Value2D)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.FillTextureSV extends laya.webgl.shader.d2.value.Value2D\r\nvar FillTextureSV=(function(_super){\r\n\tfunction FillTextureSV(type){\r\n\t\tthis.u_colorMatrix=null;\r\n\t\tthis.strength=0;\r\n\t\tthis.colorMat=null;\r\n\t\tthis.colorAlpha=null;\r\n\t\tthis.u_TexRange=[0,1,0,1];\r\n\t\tthis.u_offset=[0,0];\r\n\t\tthis.texcoord=Value2D._TEXCOORD;\r\n\t\tFillTextureSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.FILLTEXTURE*/0x100,0);\r\n\t}\r\n\r\n\t__class(FillTextureSV,'laya.webgl.shader.d2.value.FillTextureSV',_super);\r\n\tvar __proto=FillTextureSV.prototype;\r\n\t//this.color=[4,WebGLContext.FLOAT,false,_vlen,4 *CONST3D2D.BYTES_PE];\r\n\t__proto.setValue=function(vo){\r\n\t\tthis.ALPHA=vo.ALPHA;\r\n\t\tvo.filters && this.setFilters(vo.filters);\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis.texture=null;\r\n\t\tthis.shader=null;\r\n\t\tthis.defines.setValue(0);\r\n\t}\r\n\r\n\treturn FillTextureSV;\r\n})(Value2D)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.TextureSV extends laya.webgl.shader.d2.value.Value2D\r\nvar TextureSV=(function(_super){\r\n\tfunction TextureSV(subID){\r\n\t\tthis.u_colorMatrix=null;\r\n\t\tthis.strength=0;\r\n\t\tthis.blurInfo=null;\r\n\t\tthis.colorMat=null;\r\n\t\tthis.colorAlpha=null;\r\n\t\tthis.texcoord=Value2D._TEXCOORD;\r\n\t\t(subID===void 0)&& (subID=0);\r\n\t\tTextureSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01,subID);\r\n\t}\r\n\r\n\t__class(TextureSV,'laya.webgl.shader.d2.value.TextureSV',_super);\r\n\tvar __proto=TextureSV.prototype;\r\n\t__proto.setValue=function(vo){\r\n\t\tthis.ALPHA=vo.ALPHA;\r\n\t\tvo.filters && this.setFilters(vo.filters);\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis.texture=null;\r\n\t\tthis.shader=null;\r\n\t\tthis.defines.setValue(0);\r\n\t}\r\n\r\n\treturn TextureSV;\r\n})(Value2D)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.PrimitiveSV extends laya.webgl.shader.d2.value.Value2D\r\nvar PrimitiveSV=(function(_super){\r\n\tfunction PrimitiveSV(args){\r\n\t\tthis.a_color=null;\r\n\t\tthis.u_pos=[0,0];\r\n\t\tPrimitiveSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.PRIMITIVE*/0x04,0);\r\n\t\tthis.position=[2,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,5 *CONST3D2D.BYTES_PE,0];\r\n\t\tthis.a_color=[3,/*laya.webgl.WebGLContext.FLOAT*/0x1406,false,5 *CONST3D2D.BYTES_PE,2 *CONST3D2D.BYTES_PE];\r\n\t}\r\n\r\n\t__class(PrimitiveSV,'laya.webgl.shader.d2.value.PrimitiveSV',_super);\r\n\treturn PrimitiveSV;\r\n})(Value2D)\r\n\r\n\r\n//class laya.webgl.atlas.AtlasWebGLCanvas extends laya.resource.Bitmap\r\nvar AtlasWebGLCanvas=(function(_super){\r\n\tfunction AtlasWebGLCanvas(){\r\n\t\tthis._atlaser=null;\r\n\t\t/**兼容Stage3D使用*/\r\n\t\tthis._flashCacheImage=null;\r\n\t\tthis._flashCacheImageNeedFlush=false;\r\n\t\tAtlasWebGLCanvas.__super.call(this);\r\n\t}\r\n\r\n\t__class(AtlasWebGLCanvas,'laya.webgl.atlas.AtlasWebGLCanvas',_super);\r\n\tvar __proto=AtlasWebGLCanvas.prototype;\r\n\t/***重新创建资源*/\r\n\t__proto.recreateResource=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar glTex=this._source=gl.createTexture();\r\n\t\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\t\tvar preTexture=WebGLContext.curBindTexValue;\r\n\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,glTex);\r\n\t\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,this._w,this._h,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,null);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\t\tthis.memorySize=this._w *this._h *4;\r\n\t\tthis.completeCreate();\r\n\t}\r\n\r\n\t/***销毁资源*/\r\n\t__proto.disposeResource=function(){\r\n\t\tif (this._source){\r\n\t\t\tWebGL.mainContext.deleteTexture(this._source);\r\n\t\t\tthis._source=null;\r\n\t\t\tthis.memorySize=0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**采样image到WebGLTexture的一部分*/\r\n\t__proto.texSubImage2D=function(xoffset,yoffset,bitmap){\r\n\t\tif (!Render.isFlash){\r\n\t\t\tvar gl=WebGL.mainContext;\r\n\t\t\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\t\t\tvar preTexture=WebGLContext.curBindTexValue;\r\n\t\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source);\r\n\t\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\t\t\t(xoffset-1 >=0)&& (gl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset-1,yoffset,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,bitmap));\r\n\t\t\t(xoffset+1 <=this._w)&& (gl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset+1,yoffset,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,bitmap));\r\n\t\t\t(yoffset-1 >=0)&& (gl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset,yoffset-1,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,bitmap));\r\n\t\t\t(yoffset+1 <=this._h)&& (gl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset,yoffset+1,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,bitmap));\r\n\t\t\tgl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset,yoffset,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,bitmap);\r\n\t\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\t\t\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\t\t\t}else {\r\n\t\t\tif (!this._flashCacheImage){\r\n\t\t\t\tthis._flashCacheImage=HTMLImage.create(\"\");\r\n\t\t\t\tthis._flashCacheImage._image.createCanvas(this._w,this._h);\r\n\t\t\t};\r\n\t\t\tvar bmData=bitmap.bitmapdata;\r\n\t\t\tthis._flashCacheImage._image.copyPixels(bmData,0,0,bmData.width,bmData.height,xoffset,yoffset);\r\n\t\t\t(this._flashCacheImageNeedFlush)|| (this._flashCacheImageNeedFlush=true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**采样image到WebGLTexture的一部分*/\r\n\t__proto.texSubImage2DPixel=function(xoffset,yoffset,width,height,pixel){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\t\tvar preTexture=WebGLContext.curBindTexValue;\r\n\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source);\r\n\t\tvar pixels=new Uint8Array(pixel.data);\r\n\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\t\tgl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset,yoffset,width,height,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,pixels);\r\n\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\t\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\t}\r\n\r\n\t/***\r\n\t*设置图片宽度\r\n\t*@param value 图片宽度\r\n\t*/\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tthis._w=value;\r\n\t});\r\n\r\n\t/***\r\n\t*设置图片高度\r\n\t*@param value 图片高度\r\n\t*/\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tthis._h=value;\r\n\t});\r\n\r\n\treturn AtlasWebGLCanvas;\r\n})(Bitmap)\r\n\r\n\r\n/**@private */\r\n//class laya.webgl.resource.WebGLCanvas extends laya.resource.Bitmap\r\nvar WebGLCanvas=(function(_super){\r\n\tfunction WebGLCanvas(){\r\n\t\tthis.flipY=true;\r\n\t\t//上传的时候是否上下颠倒\r\n\t\tthis.premulAlpha=false;\r\n\t\t//上传的时候是否预乘alpha\r\n\t\t//this._ctx=null;\r\n\t\t/**HTML Canvas*/\r\n\t\t//this._canvas=null;\r\n\t\t//this._imgData=null;\r\n\t\t//}\r\n\t\t//this.iscpuSource=false;\r\n\t\tthis.alwaysChange=false;\r\n\t\tWebGLCanvas.__super.call(this);\r\n\t}\r\n\r\n\t__class(WebGLCanvas,'laya.webgl.resource.WebGLCanvas',_super);\r\n\tvar __proto=WebGLCanvas.prototype;\r\n\t//}\r\n\t__proto.getCanvas=function(){\r\n\t\treturn this._canvas;\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis._ctx && this._ctx.clear();\r\n\t}\r\n\r\n\t__proto.destroy=function(){\r\n\t\tthis._ctx && this._ctx.destroy();\r\n\t\tthis._ctx=null;\r\n\t}\r\n\r\n\t__proto._setContext=function(context){\r\n\t\tthis._ctx=context;\r\n\t}\r\n\r\n\t__proto.getContext=function(contextID,other){\r\n\t\treturn this._ctx ? this._ctx :(this._ctx=WebGLCanvas._createContext(this));\r\n\t}\r\n\r\n\t/*override public function copyTo(dec:Bitmap):void {\r\n\tsuper.copyTo(dec);\r\n\t(dec as WebGLCanvas)._ctx=_ctx;\r\n}*/\r\n\r\n\r\n__proto.size=function(w,h){\r\n\tif (this._w !=w || this._h !=h){\r\n\t\tthis._w=w;\r\n\t\tthis._h=h;\r\n\t\tthis._ctx && this._ctx.size(w,h);\r\n\t\tthis._canvas && (this._canvas.height=h,this._canvas.width=w);\r\n\t}\r\n\r\n}\r\n\r\n\r\n__proto.activeResource=function(force){\r\n\t(force===void 0)&& (force=false);\r\n\tif (!this._source){\r\n\t\tthis.recreateResource();\r\n\t}\r\n\r\n}\r\n\r\n\r\n__proto.recreateResource=function(){\r\n\tthis.createWebGlTexture();\r\n\tthis.completeCreate();\r\n}\r\n\r\n\r\n__proto.disposeResource=function(){\r\n\tif (this._source && !this.iscpuSource){\r\n\t\tWebGL.mainContext.deleteTexture(this._source);\r\n\t\tthis._source=null;\r\n\t\tthis.memorySize=0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n__proto.createWebGlTexture=function(){\r\n\tvar gl=WebGL.mainContext;\r\n\tif (!this._canvas){\r\n\t};\r\n\r\n\tvar glTex=this._source=gl.createTexture();\r\n\tthis.iscpuSource=false;\r\n\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\tvar preTexture=WebGLContext.curBindTexValue;\r\n\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,glTex);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_FLIP_Y_WEBGL*/0x9240,this.flipY?1:0);\r\n\tthis.premulAlpha&&gl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,this._imgData);\r\n\tthis.premulAlpha && gl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_FLIP_Y_WEBGL*/0x9240,0);\r\n\tthis.memorySize=this._w *this._h *4;\r\n\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n}\r\n\r\n\r\n//_canvas=null;\r\n__proto.reloadCanvasData=function(){\r\n\tvar gl=WebGL.mainContext;\r\n\tif (!this._source){\r\n\t\tthrow \"reloadCanvasData error, gl texture not created!\";\r\n\t};\r\n\r\n\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\tvar preTexture=WebGLContext.curBindTexValue;\r\n\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source);\r\n\tthis.premulAlpha&&gl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,this._imgData);\r\n\tthis.premulAlpha && gl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_FLIP_Y_WEBGL*/0x9240,0);\r\n\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n}\r\n\r\n\r\n//_canvas=null;\r\n__proto.texSubImage2D=function(webglCanvas,xoffset,yoffset){\r\n\tvar gl=WebGL.mainContext;\r\n\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\tvar preTexture=WebGLContext.curBindTexValue;\r\n\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\tgl.texSubImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,xoffset,yoffset,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,webglCanvas._source);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n}\r\n\r\n\r\n__proto.toBase64=function(type,encoderOptions,callBack){\r\n\tvar base64Data=null;\r\n\tif (this._canvas){\r\n\t\tbase64Data=this._canvas.toDataURL(type,encoderOptions);\r\n\t}\r\n\r\n\tcallBack.call(this,base64Data);\r\n}\r\n\r\n\r\n__getset(0,__proto,'context',function(){\r\n\treturn this._ctx;\r\n});\r\n\r\n\r\n__getset(0,__proto,'source',function(){\r\n\tif (this.alwaysChange)this.reloadCanvasData();\r\n\treturn this._source;\r\n});\r\n\r\n\r\n__getset(0,__proto,'asBitmap',null,function(value){\r\n\tthis._ctx && (this._ctx.asBitmap=value);\r\n});\r\n\r\n\r\nWebGLCanvas._createContext=null;\r\nreturn WebGLCanvas;\r\n})(Bitmap)\r\n\r\n\r\n//class laya.webgl.resource.WebGLCharImage extends laya.resource.Bitmap\r\nvar WebGLCharImage=(function(_super){\r\n\tfunction WebGLCharImage(content,drawValue){\r\n\t\tthis.CborderSize=12;\r\n\t\t//this._ctx=null;\r\n\t\t/***是否创建私有Source*/\r\n\t\t//this._allowMerageInAtlas=false;\r\n\t\t/**是否允许加入大图合集*/\r\n\t\t//this._enableMerageInAtlas=false;\r\n\t\t/**HTML Canvas，绘制字符载体,非私有数据载体*/\r\n\t\t//this.canvas=null;\r\n\t\t/**********************************************************************************/\r\n\t\t//this.cw=NaN;\r\n\t\t//this.ch=NaN;\r\n\t\t//this.xs=NaN;\r\n\t\t//this.ys=NaN;\r\n\t\t//this.char=null;\r\n\t\t//this.fillColor=null;\r\n\t\t//this.borderColor=null;\r\n\t\t//this.borderSize=0;\r\n\t\t//this.font=null;\r\n\t\t//this.fontSize=0;\r\n\t\t//this.texture=null;\r\n\t\t//this.lineWidth=0;\r\n\t\t//this.UV=null;\r\n\t\t//this.isSpace=false;\r\n\t\t//this.underLine=0;\r\n\t\tWebGLCharImage.__super.call(this);\r\n\t\tthis.char=content;\r\n\t\tthis.isSpace=content===' ';\r\n\t\tthis.xs=drawValue.scaleX;\r\n\t\tthis.ys=drawValue.scaleY;\r\n\t\tthis.font=drawValue.font.toString();\r\n\t\tthis.fontSize=drawValue.font.size;\r\n\t\tthis.fillColor=drawValue.fillColor;\r\n\t\tthis.borderColor=drawValue.borderColor;\r\n\t\tthis.lineWidth=drawValue.lineWidth;\r\n\t\tthis.underLine=drawValue.underLine;\r\n\t\tvar bIsConchApp=Render.isConchApp;\r\n\t\tvar pCanvas;\r\n\t\tif (bIsConchApp){\r\n\t\t\t/*__JS__ */pCanvas=ConchTextCanvas;\r\n\t\t\t/*__JS__ */pCanvas._source=ConchTextCanvas;\r\n\t\t\t/*__JS__ */pCanvas._source.canvas=ConchTextCanvas;\r\n\t\t\t}else {\r\n\t\t\tpCanvas=Browser.canvas.source;\r\n\t\t}\r\n\t\tthis.canvas=pCanvas;\r\n\t\tthis._enableMerageInAtlas=true;\r\n\t\tif (bIsConchApp){\r\n\t\t\t/*__JS__ */this._ctx=pCanvas;\r\n\t\t\t}else {\r\n\t\t\tthis._ctx=this.canvas.getContext('2d',undefined);\r\n\t\t};\r\n\t\tvar t=Utils.measureText(this.char,this.font);\r\n\t\tthis.cw=t.width *this.xs;\r\n\t\tthis.ch=(t.height || this.fontSize)*this.ys;\r\n\t\tthis.onresize(this.cw+this.CborderSize *2,this.ch+this.CborderSize *2);\r\n\t\tthis.texture=new Texture(this);\r\n\t}\r\n\r\n\t__class(WebGLCharImage,'laya.webgl.resource.WebGLCharImage',_super);\r\n\tvar __proto=WebGLCharImage.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.resource.IMergeAtlasBitmap\":true})\r\n\t__proto.active=function(){\r\n\t\tthis.texture.active();\r\n\t}\r\n\r\n\t__proto.recreateResource=function(){\r\n\t\tvar bIsConchApp=Render.isConchApp;\r\n\t\tthis.onresize(this.cw+this.CborderSize *2,this.ch+this.CborderSize *2);\r\n\t\tthis.canvas && (this.canvas.height=this._h,this.canvas.width=this._w);\r\n\t\tif (bIsConchApp){\r\n\t\t\tvar nFontSize=this.fontSize;\r\n\t\t\tif (this.xs !=1 || this.ys !=1){\r\n\t\t\t\tnFontSize=parseInt(nFontSize *((this.xs > this.ys)? this.xs :this.ys)+\"\");\r\n\t\t\t};\r\n\t\t\tvar sFont=\"normal 100 \"+nFontSize+\"px Arial\";\r\n\t\t\tif (this.borderColor){\r\n\t\t\t\tsFont+=\" 1 \"+this.borderColor;\r\n\t\t\t}\r\n\t\t\tthis._ctx.font=sFont;\r\n\t\t\tthis._ctx.textBaseline=\"top\";\r\n\t\t\tthis._ctx.fillStyle=this.fillColor;\r\n\t\t\tthis._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null);\r\n\t\t\t}else {\r\n\t\t\tthis._ctx.save();\r\n\t\t\t(this._ctx).clearRect(0,0,this.cw+this.CborderSize *2,this.ch+this.CborderSize *2);\r\n\t\t\tthis._ctx.font=this.font;\r\n\t\t\tif (Text.RightToLeft){\r\n\t\t\t\tthis._ctx.textAlign=\"end\";\r\n\t\t\t}\r\n\t\t\tthis._ctx.textBaseline=\"top\";\r\n\t\t\tthis._ctx.translate(this.CborderSize,this.CborderSize);\r\n\t\t\tif (this.xs !=1 || this.ys !=1){\r\n\t\t\t\tthis._ctx.scale(this.xs,this.ys);\r\n\t\t\t}\r\n\t\t\tif (this.fillColor && this.borderColor){\r\n\t\t\t\tthis._ctx.strokeStyle=this.borderColor;\r\n\t\t\t\tthis._ctx.lineWidth=this.lineWidth;\r\n\t\t\t\tthis._ctx.strokeText(this.char,0,0,null,null,0,null);\r\n\t\t\t\tthis._ctx.fillStyle=this.fillColor;\r\n\t\t\t\tthis._ctx.fillText(this.char,0,0,null,null,null);\r\n\t\t\t\t}else {\r\n\t\t\t\tif (this.lineWidth===-1){\r\n\t\t\t\t\tthis._ctx.fillStyle=this.fillColor ? this.fillColor :\"white\";\r\n\t\t\t\t\tthis._ctx.fillText(this.char,0,0,null,null,null);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis._ctx.strokeStyle=this.borderColor?this.borderColor:'white';\r\n\t\t\t\t\tthis._ctx.lineWidth=this.lineWidth;\r\n\t\t\t\t\tthis._ctx.strokeText(this.char,0,0,null,null,0,null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.underLine){\r\n\t\t\t\tthis._ctx.lineWidth=1;\r\n\t\t\t\tthis._ctx.strokeStyle=this.fillColor;\r\n\t\t\t\tthis._ctx.beginPath();\r\n\t\t\t\tthis._ctx.moveTo(0,this.fontSize+1);\r\n\t\t\t\tvar nW=this._ctx.measureText(this.char).width+1;\r\n\t\t\t\tthis._ctx.lineTo(nW,this.fontSize+1);\r\n\t\t\t\tthis._ctx.stroke();\r\n\t\t\t}\r\n\t\t\tthis._ctx.restore();\r\n\t\t}\r\n\t\tthis.borderSize=this.CborderSize;\r\n\t\tthis.completeCreate();\r\n\t}\r\n\r\n\t__proto.onresize=function(w,h){\r\n\t\tthis._w=w;\r\n\t\tthis._h=h;\r\n\t\tthis._allowMerageInAtlas=true;\r\n\t}\r\n\r\n\t__proto.clearAtlasSource=function(){}\r\n\t/**\r\n\t*是否创建私有Source\r\n\t*@return 是否创建\r\n\t*/\r\n\t__getset(0,__proto,'allowMerageInAtlas',function(){\r\n\t\treturn this._allowMerageInAtlas;\r\n\t});\r\n\r\n\t__getset(0,__proto,'atlasSource',function(){\r\n\t\treturn this.canvas;\r\n\t});\r\n\r\n\t/**\r\n\t*是否创建私有Source,通常禁止修改\r\n\t*@param value 是否创建\r\n\t*/\r\n\t/**\r\n\t*是否创建私有Source\r\n\t*@return 是否创建\r\n\t*/\r\n\t__getset(0,__proto,'enableMerageInAtlas',function(){\r\n\t\treturn this._enableMerageInAtlas;\r\n\t\t},function(value){\r\n\t\tthis._enableMerageInAtlas=value;\r\n\t});\r\n\r\n\tWebGLCharImage.createOneChar=function(content,drawValue){\r\n\t\tvar char=new WebGLCharImage(content,drawValue);\r\n\t\treturn char;\r\n\t}\r\n\r\n\treturn WebGLCharImage;\r\n})(Bitmap)\r\n\r\n\r\n//class laya.webgl.resource.WebGLRenderTarget extends laya.resource.Bitmap\r\nvar WebGLRenderTarget=(function(_super){\r\n\tfunction WebGLRenderTarget(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){\r\n\t\t//this._frameBuffer=null;\r\n\t\t//this._depthStencilBuffer=null;\r\n\t\t//this._surfaceFormat=0;\r\n\t\t//this._surfaceType=0;\r\n\t\t//this._depthStencilFormat=0;\r\n\t\t//this._mipMap=false;\r\n\t\t//this._repeat=false;\r\n\t\t//this._minFifter=0;\r\n\t\t//this._magFifter=0;\r\n\t\t(surfaceFormat===void 0)&& (surfaceFormat=/*laya.webgl.WebGLContext.RGBA*/0x1908);\r\n\t\t(surfaceType===void 0)&& (surfaceType=/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401);\r\n\t\t(depthStencilFormat===void 0)&& (depthStencilFormat=/*laya.webgl.WebGLContext.DEPTH_STENCIL*/0x84F9);\r\n\t\t(mipMap===void 0)&& (mipMap=false);\r\n\t\t(repeat===void 0)&& (repeat=false);\r\n\t\t(minFifter===void 0)&& (minFifter=-1);\r\n\t\t(magFifter===void 0)&& (magFifter=1);\r\n\t\tWebGLRenderTarget.__super.call(this);\r\n\t\tthis._w=width;\r\n\t\tthis._h=height;\r\n\t\tthis._surfaceFormat=surfaceFormat;\r\n\t\tthis._surfaceType=surfaceType;\r\n\t\tthis._depthStencilFormat=depthStencilFormat;\r\n\t\tthis._mipMap=mipMap;\r\n\t\tthis._repeat=repeat;\r\n\t\tthis._minFifter=minFifter;\r\n\t\tthis._magFifter=magFifter;\r\n\t}\r\n\r\n\t__class(WebGLRenderTarget,'laya.webgl.resource.WebGLRenderTarget',_super);\r\n\tvar __proto=WebGLRenderTarget.prototype;\r\n\t__proto.recreateResource=function(){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis._frameBuffer || (this._frameBuffer=gl.createFramebuffer());\r\n\t\tthis._source || (this._source=gl.createTexture());\r\n\t\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\t\tvar preTexture=WebGLContext.curBindTexValue;\r\n\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source);\r\n\t\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);\r\n\t\tvar minFifter=this._minFifter;\r\n\t\tvar magFifter=this._magFifter;\r\n\t\tvar repeat=this._repeat ? /*laya.webgl.WebGLContext.REPEAT*/0x2901 :/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F;\r\n\t\tvar isPot=Arith.isPOT(this._w,this._h);\r\n\t\tif (isPot){\r\n\t\t\tif (this._mipMap)\r\n\t\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR_MIPMAP_LINEAR*/0x2703);\r\n\t\t\telse\r\n\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,repeat);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,repeat);\r\n\t\t\tthis._mipMap && gl.generateMipmap(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1);\r\n\t\t\t}else {\r\n\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\t}\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,this._frameBuffer);\r\n\t\tgl.framebufferTexture2D(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,/*laya.webgl.WebGLContext.COLOR_ATTACHMENT0*/0x8CE0,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,this._source,0);\r\n\t\tif (this._depthStencilFormat){\r\n\t\t\tthis._depthStencilBuffer || (this._depthStencilBuffer=gl.createRenderbuffer());\r\n\t\t\tgl.bindRenderbuffer(/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,this._depthStencilBuffer);\r\n\t\t\tgl.renderbufferStorage(/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,this._depthStencilFormat,this._w,this._h);\r\n\t\t\tswitch (this._depthStencilFormat){\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.DEPTH_COMPONENT16*/0x81A5:\r\n\t\t\t\t\tgl.framebufferRenderbuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,/*laya.webgl.WebGLContext.DEPTH_ATTACHMENT*/0x8D00,/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,this._depthStencilBuffer);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.STENCIL_INDEX8*/0x8D48:\r\n\t\t\t\t\tgl.framebufferRenderbuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,/*laya.webgl.WebGLContext.STENCIL_ATTACHMENT*/0x8D20,/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,this._depthStencilBuffer);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.DEPTH_STENCIL*/0x84F9:\r\n\t\t\t\t\tgl.framebufferRenderbuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,/*laya.webgl.WebGLContext.DEPTH_STENCIL_ATTACHMENT*/0x821A,/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,this._depthStencilBuffer);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tgl.bindFramebuffer(/*laya.webgl.WebGLContext.FRAMEBUFFER*/0x8D40,null);\r\n\t\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\t\tgl.bindRenderbuffer(/*laya.webgl.WebGLContext.RENDERBUFFER*/0x8D41,null);\r\n\t\tif (isPot && this._mipMap)\r\n\t\t\tthis.memorySize=this._w *this._h *4 *(1+1 / 3);\r\n\t\telse\r\n\t\tthis.memorySize=this._w *this._h *4;\r\n\t\tthis.completeCreate();\r\n\t}\r\n\r\n\t__proto.disposeResource=function(){\r\n\t\tif (this._frameBuffer){\r\n\t\t\tWebGL.mainContext.deleteTexture(this._source);\r\n\t\t\tWebGL.mainContext.deleteFramebuffer(this._frameBuffer);\r\n\t\t\tWebGL.mainContext.deleteRenderbuffer(this._depthStencilBuffer);\r\n\t\t\tthis._source=null;\r\n\t\t\tthis._frameBuffer=null;\r\n\t\t\tthis._depthStencilBuffer=null;\r\n\t\t\tthis.memorySize=0;\r\n\t\t}\r\n\t}\r\n\r\n\t__getset(0,__proto,'depthStencilBuffer',function(){\r\n\t\treturn this._depthStencilBuffer;\r\n\t});\r\n\r\n\t__getset(0,__proto,'frameBuffer',function(){\r\n\t\treturn this._frameBuffer;\r\n\t});\r\n\r\n\treturn WebGLRenderTarget;\r\n})(Bitmap)\r\n\r\n\r\n//class laya.webgl.resource.WebGLSubImage extends laya.resource.Bitmap\r\nvar WebGLSubImage=(function(_super){\r\n\tfunction WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src){\r\n\t\t/**HTML Context*/\r\n\t\t//this._ctx=null;\r\n\t\t/***是否创建私有Source,值为false时不根据src创建私有WebGLTexture,同时销毁时也只清空source=null,不调用WebGL.mainContext.deleteTexture类似函数，调用资源激活前有效*/\r\n\t\t//this._allowMerageInAtlas=false;\r\n\t\t/**是否允许加入大图合集*/\r\n\t\t//this._enableMerageInAtlas=false;\r\n\t\t/**HTML Canvas，绘制子图载体,非私有数据载体*/\r\n\t\t//this.canvas=null;\r\n\t\t/**是否使用重复模式纹理寻址*/\r\n\t\t//this.repeat=false;\r\n\t\t/**是否使用mipLevel*/\r\n\t\t//this.mipmap=false;\r\n\t\t/**缩小过滤器*/\r\n\t\t//this.minFifter=0;\r\n\t\t/**放大过滤器*/\r\n\t\t//this.magFifter=0;\r\n\t\t//动态默认值，判断是否可生成miplevel\r\n\t\t//this.atlasImage=null;\r\n\t\tthis.offsetX=0;\r\n\t\tthis.offsetY=0;\r\n\t\t//this.src=null;\r\n\t\tWebGLSubImage.__super.call(this);\r\n\t\tthis.repeat=true;\r\n\t\tthis.mipmap=false;\r\n\t\tthis.minFifter=-1;\r\n\t\tthis.magFifter=-1;\r\n\t\tthis.atlasImage=atlasImage;\r\n\t\tthis.canvas=canvas;\r\n\t\tthis._ctx=canvas.getContext('2d',undefined);\r\n\t\tthis._w=width;\r\n\t\tthis._h=height;\r\n\t\tthis.offsetX=offsetX;\r\n\t\tthis.offsetY=offsetY;\r\n\t\tthis.src=src;\r\n\t\tthis._enableMerageInAtlas=true;\r\n\t\t(AtlasResourceManager.enabled)&& (this._w < AtlasResourceManager.atlasLimitWidth && this._h < AtlasResourceManager.atlasLimitHeight)? this._allowMerageInAtlas=true :this._allowMerageInAtlas=false;\r\n\t}\r\n\r\n\t__class(WebGLSubImage,'laya.webgl.resource.WebGLSubImage',_super);\r\n\tvar __proto=WebGLSubImage.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.resource.IMergeAtlasBitmap\":true})\r\n\t/*override public function copyTo(dec:Bitmap):void {\r\n\tvar d:WebGLSubImage=dec as WebGLSubImage;\r\n\tsuper.copyTo(dec);\r\n\td._ctx=_ctx;\r\n}*/\r\n\r\n\r\n__proto.size=function(w,h){\r\n\tthis._w=w;\r\n\tthis._h=h;\r\n\tthis._ctx && this._ctx.size(w,h);\r\n\tthis.canvas && (this.canvas.height=h,this.canvas.width=w);\r\n}\r\n\r\n\r\n__proto.recreateResource=function(){\r\n\tthis.size(this._w,this._h);\r\n\tthis._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h);\r\n\t(!(this._allowMerageInAtlas && this._enableMerageInAtlas))? (this.createWebGlTexture()):(this.memorySize=0);\r\n\tthis.completeCreate();\r\n}\r\n\r\n\r\n__proto.createWebGlTexture=function(){\r\n\tvar gl=WebGL.mainContext;\r\n\tif (!this.canvas){\r\n\t\tthrow \"create GLTextur err:no data:\"+this.canvas;\r\n\t};\r\n\r\n\tvar glTex=this._source=gl.createTexture();\r\n\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\tvar preTexture=WebGLContext.curBindTexValue;\r\n\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,glTex);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,this.canvas);\r\n\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\tvar minFifter=this.minFifter;\r\n\tvar magFifter=this.magFifter;\r\n\tvar repeat=this.repeat ? /*laya.webgl.WebGLContext.REPEAT*/0x2901 :/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F;\r\n\tvar isPOT=Arith.isPOT(this.width,this.height);\r\n\tif (isPOT){\r\n\t\tif (this.mipmap)\r\n\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR_MIPMAP_LINEAR*/0x2703);\r\n\t\telse\r\n\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,repeat);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,repeat);\r\n\t\tthis.mipmap && gl.generateMipmap(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1);\r\n\t\t}else {\r\n\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t}\r\n\r\n\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\tthis.canvas=null;\r\n\tif (isPOT && this.mipmap)\r\n\t\tthis.memorySize=this._w *this._h *4 *(1+1 / 3);\r\n\telse\r\n\tthis.memorySize=this._w *this._h *4;\r\n}\r\n\r\n\r\n__proto.disposeResource=function(){\r\n\tif (!(AtlasResourceManager.enabled && this._allowMerageInAtlas)&& this._source){\r\n\t\tWebGL.mainContext.deleteTexture(this._source);\r\n\t\tthis._source=null;\r\n\t\tthis.memorySize=0;\r\n\t}\r\n\r\n}\r\n\r\n\r\n//}\r\n__proto.clearAtlasSource=function(){}\r\n/**\r\n*是否创建私有Source\r\n*@return 是否创建\r\n*/\r\n__getset(0,__proto,'allowMerageInAtlas',function(){\r\n\treturn this._allowMerageInAtlas;\r\n});\r\n\r\n\r\n//public var createFromPixel:Boolean=true;\r\n__getset(0,__proto,'atlasSource',function(){\r\n\treturn this.canvas;\r\n});\r\n\r\n\r\n/**\r\n*是否创建私有Source,通常禁止修改\r\n*@param value 是否创建\r\n*/\r\n/**\r\n*是否创建私有Source\r\n*@return 是否创建\r\n*/\r\n__getset(0,__proto,'enableMerageInAtlas',function(){\r\n\treturn this._allowMerageInAtlas;\r\n\t},function(value){\r\n\r\n\tthis._allowMerageInAtlas=value;\r\n});\r\n\r\n\r\nreturn WebGLSubImage;\r\n})(Bitmap)\r\n\r\n\r\n//class laya.webgl.shader.Shader extends laya.webgl.shader.BaseShader\r\nvar Shader=(function(_super){\r\n\tfunction Shader(vs,ps,saveName,nameMap){\r\n\t\tthis.customCompile=false;\r\n\t\t//this._nameMap=null;\r\n\t\t//shader参数别名，语义\r\n\t\t//this._vs=null;\r\n\t\t//this._ps=null;\r\n\t\tthis._curActTexIndex=0;\r\n\t\t//this._reCompile=false;\r\n\t\t//存储一些私有变量\r\n\t\tthis.tag={};\r\n\t\t//this._vshader=null;\r\n\t\t//this._pshader=null;\r\n\t\tthis._program=null;\r\n\t\tthis._params=null;\r\n\t\tthis._paramsMap={};\r\n\t\tthis._offset=0;\r\n\t\t//this._id=0;\r\n\t\tShader.__super.call(this);\r\n\t\tif ((!vs)|| (!ps))throw \"Shader Error\";\r\n\t\tif (Render.isConchApp || Render.isFlash){\r\n\t\t\tthis.customCompile=true;\r\n\t\t}\r\n\t\tthis._id=++Shader._count;\r\n\t\tthis._vs=vs;\r\n\t\tthis._ps=ps;\r\n\t\tthis._nameMap=nameMap ? nameMap :{};\r\n\t\tsaveName !=null && (Shader.sharders[saveName]=this);\r\n\t}\r\n\r\n\t__class(Shader,'laya.webgl.shader.Shader',_super);\r\n\tvar __proto=Shader.prototype;\r\n\t__proto.recreateResource=function(){\r\n\t\tthis._compile();\r\n\t\tthis.completeCreate();\r\n\t\tthis.memorySize=0;\r\n\t}\r\n\r\n\t//忽略尺寸尺寸\r\n\t__proto.disposeResource=function(){\r\n\t\tWebGL.mainContext.deleteShader(this._vshader);\r\n\t\tWebGL.mainContext.deleteShader(this._pshader);\r\n\t\tWebGL.mainContext.deleteProgram(this._program);\r\n\t\tthis._vshader=this._pshader=this._program=null;\r\n\t\tthis._params=null;\r\n\t\tthis._paramsMap={};\r\n\t\tthis.memorySize=0;\r\n\t\tthis._curActTexIndex=0;\r\n\t}\r\n\r\n\t__proto._compile=function(){\r\n\t\tif (!this._vs || !this._ps || this._params)\r\n\t\t\treturn;\r\n\t\tthis._reCompile=true;\r\n\t\tthis._params=[];\r\n\t\tvar text=[this._vs,this._ps];\r\n\t\tvar result;\r\n\t\tif (this.customCompile)\r\n\t\t\tresult=ShaderCompile.preGetParams(this._vs,this._ps);\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tthis._program=gl.createProgram();\r\n\t\tthis._vshader=Shader._createShader(gl,text[0],/*laya.webgl.WebGLContext.VERTEX_SHADER*/0x8B31);\r\n\t\tthis._pshader=Shader._createShader(gl,text[1],/*laya.webgl.WebGLContext.FRAGMENT_SHADER*/0x8B30);\r\n\t\tgl.attachShader(this._program,this._vshader);\r\n\t\tgl.attachShader(this._program,this._pshader);\r\n\t\tgl.linkProgram(this._program);\r\n\t\tif (!this.customCompile && !gl.getProgramParameter(this._program,/*laya.webgl.WebGLContext.LINK_STATUS*/0x8B82)){\r\n\t\t\tthrow gl.getProgramInfoLog(this._program);\r\n\t\t};\r\n\t\tvar one,i=0,j=0,n=0,location;\r\n\t\tvar attribNum=this.customCompile ? result.attributes.length :gl.getProgramParameter(this._program,/*laya.webgl.WebGLContext.ACTIVE_ATTRIBUTES*/0x8B89);\r\n\t\tfor (i=0;i < attribNum;i++){\r\n\t\t\tvar attrib=this.customCompile ? result.attributes[i] :gl.getActiveAttrib(this._program,i);\r\n\t\t\tlocation=gl.getAttribLocation(this._program,attrib.name);\r\n\t\t\tone={vartype:\"attribute\",glfun:null,ivartype:0,attrib:attrib,location:location,name:attrib.name,type:attrib.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};\r\n\t\t\tthis._params.push(one);\r\n\t\t};\r\n\t\tvar nUniformNum=this.customCompile ? result.uniforms.length :gl.getProgramParameter(this._program,/*laya.webgl.WebGLContext.ACTIVE_UNIFORMS*/0x8B86);\r\n\t\tfor (i=0;i < nUniformNum;i++){\r\n\t\t\tvar uniform=this.customCompile ? result.uniforms[i] :gl.getActiveUniform(this._program,i);\r\n\t\t\tlocation=gl.getUniformLocation(this._program,uniform.name);\r\n\t\t\tone={vartype:\"uniform\",glfun:null,ivartype:1,attrib:attrib,location:location,name:uniform.name,type:uniform.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};\r\n\t\t\tif (one.name.indexOf('[0]')> 0){\r\n\t\t\t\tone.name=one.name.substr(0,one.name.length-3);\r\n\t\t\t\tone.isArray=true;\r\n\t\t\t\tone.location=gl.getUniformLocation(this._program,one.name);\r\n\t\t\t}\r\n\t\t\tthis._params.push(one);\r\n\t\t}\r\n\t\tfor (i=0,n=this._params.length;i < n;i++){\r\n\t\t\tone=this._params[i];\r\n\t\t\tone.indexOfParams=i;\r\n\t\t\tone.index=1;\r\n\t\t\tone.value=[one.location,null];\r\n\t\t\tone.codename=one.name;\r\n\t\t\tone.name=this._nameMap[one.codename] ? this._nameMap[one.codename] :one.codename;\r\n\t\t\tthis._paramsMap[one.name]=one;\r\n\t\t\tone._this=this;\r\n\t\t\tone.uploadedValue=[];\r\n\t\t\tif (one.vartype===\"attribute\"){\r\n\t\t\t\tone.fun=this._attribute;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t\tswitch (one.type){\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.INT*/0x1404:\r\n\t\t\t\t\tone.fun=one.isArray ? this._uniform1iv :this._uniform1i;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT*/0x1406:\r\n\t\t\t\t\tone.fun=one.isArray ? this._uniform1fv :this._uniform1f;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_VEC2*/0x8B50:\r\n\t\t\t\t\tone.fun=one.isArray ? this._uniform_vec2v:this._uniform_vec2;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_VEC3*/0x8B51:\r\n\t\t\t\t\tone.fun=one.isArray ? this._uniform_vec3v:this._uniform_vec3;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_VEC4*/0x8B52:\r\n\t\t\t\t\tone.fun=one.isArray ? this._uniform_vec4v:this._uniform_vec4;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.SAMPLER_2D*/0x8B5E:\r\n\t\t\t\t\tone.fun=this._uniform_sampler2D;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.SAMPLER_CUBE*/0x8B60:\r\n\t\t\t\t\tone.fun=this._uniform_samplerCube;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_MAT4*/0x8B5C:\r\n\t\t\t\t\tone.glfun=gl.uniformMatrix4fv;\r\n\t\t\t\t\tone.fun=this._uniformMatrix4fv;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.BOOL*/0x8B56:\r\n\t\t\t\t\tone.fun=this._uniform1i;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_MAT2*/0x8B5A:\r\n\t\t\t\tcase /*laya.webgl.WebGLContext.FLOAT_MAT3*/0x8B5B:\r\n\t\t\t\t\tthrow new Error(\"compile shader err!\");\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\tthrow new Error(\"compile shader err!\");\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*根据变量名字获得\r\n\t*@param name\r\n\t*@return\r\n\t*/\r\n\t__proto.getUniform=function(name){\r\n\t\treturn this._paramsMap[name];\r\n\t}\r\n\r\n\t__proto._attribute=function(one,value){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar enableAtributes=Buffer._enableAtributes;\r\n\t\tvar location=one.location;\r\n\t\t(enableAtributes[location])||(gl.enableVertexAttribArray(location));\r\n\t\tgl.vertexAttribPointer(location,value[0],value[1],value[2],value[3],value[4]+this._offset);\r\n\t\tenableAtributes[location]=Buffer._bindVertexBuffer;\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform1f=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value){\r\n\t\t\tWebGL.mainContext.uniform1f(one.location,uploadedValue[0]=value);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform1fv=function(one,value){\r\n\t\tif (value.length < 4){\r\n\t\t\tvar uploadedValue=one.uploadedValue;\r\n\t\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2] || uploadedValue[3]!==value[3]){\r\n\t\t\t\tWebGL.mainContext.uniform1fv(one.location,value);\r\n\t\t\t\tuploadedValue[0]=value[0];\r\n\t\t\t\tuploadedValue[1]=value[1];\r\n\t\t\t\tuploadedValue[2]=value[2];\r\n\t\t\t\tuploadedValue[3]=value[3];\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t\t}else {\r\n\t\t\tWebGL.mainContext.uniform1fv(one.location,value);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._uniform_vec2=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1]){\r\n\t\t\tWebGL.mainContext.uniform2f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_vec2v=function(one,value){\r\n\t\tif (value.length < 2){\r\n\t\t\tvar uploadedValue=one.uploadedValue;\r\n\t\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2] || uploadedValue[3]!==value[3]){\r\n\t\t\t\tWebGL.mainContext.uniform2fv(one.location,value);\r\n\t\t\t\tuploadedValue[0]=value[0];\r\n\t\t\t\tuploadedValue[1]=value[1];\r\n\t\t\t\tuploadedValue[2]=value[2];\r\n\t\t\t\tuploadedValue[3]=value[3];\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t\t}else {\r\n\t\t\tWebGL.mainContext.uniform2fv(one.location,value);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._uniform_vec3=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2]){\r\n\t\t\tWebGL.mainContext.uniform3f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_vec3v=function(one,value){\r\n\t\tWebGL.mainContext.uniform3fv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform_vec4=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2] || uploadedValue[3]!==value[3]){\r\n\t\t\tWebGL.mainContext.uniform4f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_vec4v=function(one,value){\r\n\t\tWebGL.mainContext.uniform4fv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniformMatrix2fv=function(one,value){\r\n\t\tWebGL.mainContext.uniformMatrix2fv(one.location,false,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniformMatrix3fv=function(one,value){\r\n\t\tWebGL.mainContext.uniformMatrix3fv(one.location,false,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniformMatrix4fv=function(one,value){\r\n\t\tWebGL.mainContext.uniformMatrix4fv(one.location,false,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform1i=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value){\r\n\t\t\tWebGL.mainContext.uniform1i(one.location,uploadedValue[0]=value);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform1iv=function(one,value){\r\n\t\tWebGL.mainContext.uniform1iv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform_ivec2=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1]){\r\n\t\t\tWebGL.mainContext.uniform2i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_ivec2v=function(one,value){\r\n\t\tWebGL.mainContext.uniform2iv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform_vec3i=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2]){\r\n\t\t\tWebGL.mainContext.uniform3i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_vec3vi=function(one,value){\r\n\t\tWebGL.mainContext.uniform3iv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform_vec4i=function(one,value){\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]!==value[0] || uploadedValue[1]!==value[1] || uploadedValue[2]!==value[2] || uploadedValue[3]!==value[3]){\r\n\t\t\tWebGL.mainContext.uniform4i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t__proto._uniform_vec4vi=function(one,value){\r\n\t\tWebGL.mainContext.uniform4iv(one.location,value);\r\n\t\treturn 1;\r\n\t}\r\n\r\n\t__proto._uniform_sampler2D=function(one,value){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]==null){\r\n\t\t\tuploadedValue[0]=this._curActTexIndex;\r\n\t\t\tgl.uniform1i(one.location,this._curActTexIndex);\r\n\t\t\tgl.activeTexture(Shader._TEXTURES[this._curActTexIndex]);\r\n\t\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,value);\r\n\t\t\tthis._curActTexIndex++;\r\n\t\t\treturn 1;\r\n\t\t\t}else {\r\n\t\t\tgl.activeTexture(Shader._TEXTURES[uploadedValue[0]]);\r\n\t\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,value);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._uniform_samplerCube=function(one,value){\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar uploadedValue=one.uploadedValue;\r\n\t\tif (uploadedValue[0]==null){\r\n\t\t\tuploadedValue[0]=this._curActTexIndex;\r\n\t\t\tgl.uniform1i(one.location,this._curActTexIndex);\r\n\t\t\tgl.activeTexture(Shader._TEXTURES[this._curActTexIndex]);\r\n\t\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_CUBE_MAP*/0x8513,value);\r\n\t\t\tthis._curActTexIndex++;\r\n\t\t\treturn 1;\r\n\t\t\t}else {\r\n\t\t\tgl.activeTexture(Shader._TEXTURES[uploadedValue[0]]);\r\n\t\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_CUBE_MAP*/0x8513,value);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._noSetValue=function(one){\r\n\t\tconsole.log(\"no....:\"+one.name);\r\n\t}\r\n\r\n\t//throw new Error(\"upload shader err,must set value:\"+one.name);\r\n\t__proto.uploadOne=function(name,value){\r\n\t\tthis.activeResource();\r\n\t\tWebGLContext.UseProgram(this._program);\r\n\t\tvar one=this._paramsMap[name];\r\n\t\tone.fun.call(this,one,value);\r\n\t}\r\n\r\n\t__proto.uploadTexture2D=function(value){\r\n\t\tStat.shaderCall++;\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tgl.activeTexture(/*laya.webgl.WebGLContext.TEXTURE0*/0x84C0);\r\n\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,value);\r\n\t}\r\n\r\n\t/**\r\n\t*提交shader到GPU\r\n\t*@param shaderValue\r\n\t*/\r\n\t__proto.upload=function(shaderValue,params){\r\n\t\tBaseShader.activeShader=BaseShader.bindShader=this;\r\n\t\tthis._lastUseFrameCount===Stat.loopCount || this.activeResource();\r\n\t\tWebGLContext.UseProgram(this._program);\r\n\t\tif (this._reCompile){\r\n\t\t\tparams=this._params;\r\n\t\t\tthis._reCompile=false;\r\n\t\t\t}else {\r\n\t\t\tparams=params || this._params;\r\n\t\t};\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar one,value,n=params.length,shaderCall=0;\r\n\t\tfor (var i=0;i < n;i++){\r\n\t\t\tone=params[i];\r\n\t\t\tif ((value=shaderValue[one.name])!==null)\r\n\t\t\t\tshaderCall+=one.fun.call(this,one,value);\r\n\t\t}\r\n\t\tStat.shaderCall+=shaderCall;\r\n\t}\r\n\r\n\t/**\r\n\t*按数组的定义提交\r\n\t*@param shaderValue 数组格式[name,value,...]\r\n\t*/\r\n\t__proto.uploadArray=function(shaderValue,length,_bufferUsage){\r\n\t\tBaseShader.activeShader=this;\r\n\t\tBaseShader.bindShader=this;\r\n\t\tthis.activeResource();\r\n\t\tWebGLContext.UseProgram(this._program);\r\n\t\tvar params=this._params,value;\r\n\t\tvar one,shaderCall=0;\r\n\t\tfor (var i=length-2;i >=0;i-=2){\r\n\t\t\tone=this._paramsMap[shaderValue[i]];\r\n\t\t\tif (!one)\r\n\t\t\t\tcontinue ;\r\n\t\t\tvalue=shaderValue[i+1];\r\n\t\t\tif (value !=null){\r\n\t\t\t\t_bufferUsage && _bufferUsage[one.name] && _bufferUsage[one.name].bind();\r\n\t\t\t\tshaderCall+=one.fun.call(this,one,value);\r\n\t\t\t}\r\n\t\t}\r\n\t\tStat.shaderCall+=shaderCall;\r\n\t}\r\n\r\n\t/**\r\n\t*得到编译后的变量及相关预定义\r\n\t*@return\r\n\t*/\r\n\t__proto.getParams=function(){\r\n\t\treturn this._params;\r\n\t}\r\n\r\n\tShader.getShader=function(name){\r\n\t\treturn Shader.sharders[name];\r\n\t}\r\n\r\n\tShader.create=function(vs,ps,saveName,nameMap){\r\n\t\treturn new Shader(vs,ps,saveName,nameMap);\r\n\t}\r\n\r\n\tShader.withCompile=function(nameID,define,shaderName,createShader){\r\n\t\tif (shaderName && Shader.sharders[shaderName])\r\n\t\t\treturn Shader.sharders[shaderName];\r\n\t\tvar pre=Shader._preCompileShader[0.0002 *nameID];\r\n\t\tif (!pre)\r\n\t\t\tthrow new Error(\"withCompile shader err!\"+nameID);\r\n\t\treturn pre.createShader(define,shaderName,createShader);\r\n\t}\r\n\r\n\tShader.withCompile2D=function(nameID,mainID,define,shaderName,createShader){\r\n\t\tif (shaderName && Shader.sharders[shaderName])\r\n\t\t\treturn Shader.sharders[shaderName];\r\n\t\tvar pre=Shader._preCompileShader[0.0002 *nameID+mainID];\r\n\t\tif (!pre)\r\n\t\t\tthrow new Error(\"withCompile shader err!\"+nameID+\" \"+mainID);\r\n\t\treturn pre.createShader(define,shaderName,createShader);\r\n\t}\r\n\r\n\tShader.addInclude=function(fileName,txt){\r\n\t\tShaderCompile.addInclude(fileName,txt);\r\n\t}\r\n\r\n\tShader.preCompile=function(nameID,vs,ps,nameMap){\r\n\t\tvar id=0.0002 *nameID;\r\n\t\tShader._preCompileShader[id]=new ShaderCompile(id,vs,ps,nameMap);\r\n\t}\r\n\r\n\tShader.preCompile2D=function(nameID,mainID,vs,ps,nameMap){\r\n\t\tvar id=0.0002 *nameID+mainID;\r\n\t\tShader._preCompileShader[id]=new ShaderCompile(id,vs,ps,nameMap);\r\n\t}\r\n\r\n\tShader._createShader=function(gl,str,type){\r\n\t\tvar shader=gl.createShader(type);\r\n\t\tgl.shaderSource(shader,str);\r\n\t\tgl.compileShader(shader);\r\n\t\treturn shader;\r\n\t}\r\n\r\n\tShader._count=0;\r\n\tShader._preCompileShader={};\r\n\tShader.SHADERNAME2ID=0.0002;\r\n\t__static(Shader,\r\n\t['_TEXTURES',function(){return this._TEXTURES=[ /*laya.webgl.WebGLContext.TEXTURE0*/0x84C0,/*laya.webgl.WebGLContext.TEXTURE1*/0x84C1,/*laya.webgl.WebGLContext.TEXTURE2*/0x84C2,/*laya.webgl.WebGLContext.TEXTURE3*/0x84C3,/*laya.webgl.WebGLContext.TEXTURE4*/0x84C4,/*laya.webgl.WebGLContext.TEXTURE5*/0x84C5,/*laya.webgl.WebGLContext.TEXTURE6*/0x84C6,,/*laya.webgl.WebGLContext.TEXTURE7*/0x84C7,/*laya.webgl.WebGLContext.TEXTURE8*/0x84C8];},'nameKey',function(){return this.nameKey=new StringKey();},'sharders',function(){return this.sharders=(Shader.sharders=[],Shader.sharders.length=0x20,Shader.sharders);}\r\n\t]);\r\n\treturn Shader;\r\n})(BaseShader)\r\n\r\n\r\n//class laya.webgl.utils.Buffer2D extends laya.webgl.utils.Buffer\r\nvar Buffer2D=(function(_super){\r\n\tfunction Buffer2D(){\r\n\t\tthis._maxsize=0;\r\n\t\tthis._upload=true;\r\n\t\tthis._uploadSize=0;\r\n\t\tBuffer2D.__super.call(this);\r\n\t\tthis.lock=true;\r\n\t}\r\n\r\n\t__class(Buffer2D,'laya.webgl.utils.Buffer2D',_super);\r\n\tvar __proto=Buffer2D.prototype;\r\n\t__proto._bufferData=function(){\r\n\t\tthis._maxsize=Math.max(this._maxsize,this._byteLength);\r\n\t\tif (Stat.loopCount % 30==0){\r\n\t\t\tif (this._buffer.byteLength > (this._maxsize+64)){\r\n\t\t\t\tthis.memorySize=this._buffer.byteLength;\r\n\t\t\t\tthis._buffer=this._buffer.slice(0,this._maxsize+64);\r\n\t\t\t\tthis._checkArrayUse();\r\n\t\t\t}\r\n\t\t\tthis._maxsize=this._byteLength;\r\n\t\t}\r\n\t\tif (this._uploadSize < this._buffer.byteLength){\r\n\t\t\tthis._uploadSize=this._buffer.byteLength;\r\n\t\t\tBuffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage);\r\n\t\t\tthis.memorySize=this._uploadSize;\r\n\t\t}\r\n\t\tBuffer._gl.bufferSubData(this._bufferType,0,this._buffer);\r\n\t}\r\n\r\n\t__proto._bufferSubData=function(offset,dataStart,dataLength){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\t(dataStart===void 0)&& (dataStart=0);\r\n\t\t(dataLength===void 0)&& (dataLength=0);\r\n\t\tthis._maxsize=Math.max(this._maxsize,this._byteLength);\r\n\t\tif (Stat.loopCount % 30==0){\r\n\t\t\tif (this._buffer.byteLength > (this._maxsize+64)){\r\n\t\t\t\tthis.memorySize=this._buffer.byteLength;\r\n\t\t\t\tthis._buffer=this._buffer.slice(0,this._maxsize+64);\r\n\t\t\t\tthis._checkArrayUse();\r\n\t\t\t}\r\n\t\t\tthis._maxsize=this._byteLength;\r\n\t\t}\r\n\t\tif (this._uploadSize < this._buffer.byteLength){\r\n\t\t\tthis._uploadSize=this._buffer.byteLength;\r\n\t\t\tBuffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage);\r\n\t\t\tthis.memorySize=this._uploadSize;\r\n\t\t}\r\n\t\tif (dataStart || dataLength){\r\n\t\t\tvar subBuffer=this._buffer.slice(dataStart,dataLength);\r\n\t\t\tBuffer._gl.bufferSubData(this._bufferType,offset,subBuffer);\r\n\t\t\t}else {\r\n\t\t\tBuffer._gl.bufferSubData(this._bufferType,offset,this._buffer);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._checkArrayUse=function(){}\r\n\t__proto._bind_upload=function(){\r\n\t\tif (!this._upload)\r\n\t\t\treturn false;\r\n\t\tthis._upload=false;\r\n\t\tthis._bind();\r\n\t\tthis._bufferData();\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto._bind_subUpload=function(offset,dataStart,dataLength){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\t(dataStart===void 0)&& (dataStart=0);\r\n\t\t(dataLength===void 0)&& (dataLength=0);\r\n\t\tif (!this._upload)\r\n\t\t\treturn false;\r\n\t\tthis._upload=false;\r\n\t\tthis._bind();\r\n\t\tthis._bufferSubData(offset,dataStart,dataLength);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t__proto._resizeBuffer=function(nsz,copy){\r\n\t\tif (nsz < this._buffer.byteLength)\r\n\t\t\treturn this;\r\n\t\tthis.memorySize=nsz;\r\n\t\tif (copy && this._buffer && this._buffer.byteLength > 0){\r\n\t\t\tvar newbuffer=new ArrayBuffer(nsz);\r\n\t\t\tvar n=new Uint8Array(newbuffer);\r\n\t\t\tn.set(new Uint8Array(this._buffer),0);\r\n\t\t\tthis._buffer=newbuffer;\r\n\t\t}else\r\n\t\tthis._buffer=new ArrayBuffer(nsz);\r\n\t\tthis._checkArrayUse();\r\n\t\tthis._upload=true;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto.append=function(data){\r\n\t\tthis._upload=true;\r\n\t\tvar byteLen=0,n;\r\n\t\tbyteLen=data.byteLength;\r\n\t\tif ((data instanceof Uint8Array)){\r\n\t\t\tthis._resizeBuffer(this._byteLength+byteLen,true);\r\n\t\t\tn=new Uint8Array(this._buffer,this._byteLength);\r\n\t\t\t}else if ((data instanceof Uint16Array)){\r\n\t\t\tthis._resizeBuffer(this._byteLength+byteLen,true);\r\n\t\t\tn=new Uint16Array(this._buffer,this._byteLength);\r\n\t\t\t}else if ((data instanceof Float32Array)){\r\n\t\t\tthis._resizeBuffer(this._byteLength+byteLen,true);\r\n\t\t\tn=new Float32Array(this._buffer,this._byteLength);\r\n\t\t}\r\n\t\tn.set(data,0);\r\n\t\tthis._byteLength+=byteLen;\r\n\t\tthis._checkArrayUse();\r\n\t}\r\n\r\n\t__proto.appendEx=function(data,type){\r\n\t\tthis._upload=true;\r\n\t\tvar byteLen=0,n;\r\n\t\tbyteLen=data.byteLength;\r\n\t\tthis._resizeBuffer(this._byteLength+byteLen,true);\r\n\t\tn=new type(this._buffer,this._byteLength);\r\n\t\tn.set(data,0);\r\n\t\tthis._byteLength+=byteLen;\r\n\t\tthis._checkArrayUse();\r\n\t}\r\n\r\n\t__proto.appendEx2=function(data,type,dataLen,perDataLen){\r\n\t\t(perDataLen===void 0)&& (perDataLen=1);\r\n\t\tthis._upload=true;\r\n\t\tvar byteLen=0,n;\r\n\t\tbyteLen=dataLen*perDataLen;\r\n\t\tthis._resizeBuffer(this._byteLength+byteLen,true);\r\n\t\tn=new type(this._buffer,this._byteLength);\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < dataLen;i++){\r\n\t\t\tn[i]=data[i];\r\n\t\t}\r\n\t\tthis._byteLength+=byteLen;\r\n\t\tthis._checkArrayUse();\r\n\t}\r\n\r\n\t__proto.getBuffer=function(){\r\n\t\treturn this._buffer;\r\n\t}\r\n\r\n\t__proto.setNeedUpload=function(){\r\n\t\tthis._upload=true;\r\n\t}\r\n\r\n\t__proto.getNeedUpload=function(){\r\n\t\treturn this._upload;\r\n\t}\r\n\r\n\t__proto.upload=function(){\r\n\t\tvar scuess=this._bind_upload();\r\n\t\tBuffer._gl.bindBuffer(this._bufferType,null);\r\n\t\tBuffer._bindActive[this._bufferType]=null;\r\n\t\tBaseShader.activeShader=null\r\n\t\treturn scuess;\r\n\t}\r\n\r\n\t__proto.subUpload=function(offset,dataStart,dataLength){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\t(dataStart===void 0)&& (dataStart=0);\r\n\t\t(dataLength===void 0)&& (dataLength=0);\r\n\t\tvar scuess=this._bind_subUpload();\r\n\t\tBuffer._gl.bindBuffer(this._bufferType,null);\r\n\t\tBuffer._bindActive[this._bufferType]=null;\r\n\t\tBaseShader.activeShader=null\r\n\t\treturn scuess;\r\n\t}\r\n\r\n\t__proto.disposeResource=function(){\r\n\t\t_super.prototype.disposeResource.call(this);\r\n\t\tthis._upload=true;\r\n\t\tthis._uploadSize=0;\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis._byteLength=0;\r\n\t\tthis._upload=true;\r\n\t}\r\n\r\n\t__getset(0,__proto,'bufferLength',function(){\r\n\t\treturn this._buffer.byteLength;\r\n\t});\r\n\r\n\t__getset(0,__proto,'byteLength',null,function(value){\r\n\t\tif (this._byteLength===value)\r\n\t\t\treturn;\r\n\t\tvalue <=this._buffer.byteLength || (this._resizeBuffer(value *2+256,true));\r\n\t\tthis._byteLength=value;\r\n\t});\r\n\r\n\tBuffer2D.__int__=function(gl){\r\n\t\tIndexBuffer2D.QuadrangleIB=IndexBuffer2D.create(/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4);\r\n\t\tGlUtils.fillIBQuadrangle(IndexBuffer2D.QuadrangleIB,16);\r\n\t}\r\n\r\n\tBuffer2D.FLOAT32=4;\r\n\tBuffer2D.SHORT=2;\r\n\treturn Buffer2D;\r\n})(Buffer)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.GlowSV extends laya.webgl.shader.d2.value.TextureSV\r\nvar GlowSV=(function(_super){\r\n\tfunction GlowSV(args){\r\n\t\tthis.u_blurX=false;\r\n\t\tthis.u_color=null;\r\n\t\tthis.u_offset=null;\r\n\t\tthis.u_strength=NaN;\r\n\t\tthis.u_texW=0;\r\n\t\tthis.u_texH=0;\r\n\t\tGlowSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.FILTERGLOW*/0x08| /*laya.webgl.shader.d2.ShaderDefines2D.TEXTURE2D*/0x01);\r\n\t}\r\n\r\n\t__class(GlowSV,'laya.webgl.shader.d2.value.GlowSV',_super);\r\n\tvar __proto=GlowSV.prototype;\r\n\t__proto.setValue=function(vo){\r\n\t\t_super.prototype.setValue.call(this,vo);\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\t_super.prototype.clear.call(this);\r\n\t}\r\n\r\n\treturn GlowSV;\r\n})(TextureSV)\r\n\r\n\r\n//class laya.webgl.shader.d2.value.TextSV extends laya.webgl.shader.d2.value.TextureSV\r\nvar TextSV=(function(_super){\r\n\tfunction TextSV(args){\r\n\t\tTextSV.__super.call(this,/*laya.webgl.shader.d2.ShaderDefines2D.COLORADD*/0x40);\r\n\t\tthis.defines.add(/*laya.webgl.shader.d2.ShaderDefines2D.COLORADD*/0x40);\r\n\t}\r\n\r\n\t__class(TextSV,'laya.webgl.shader.d2.value.TextSV',_super);\r\n\tvar __proto=TextSV.prototype;\r\n\t__proto.release=function(){\r\n\t\tTextSV.pool[TextSV._length++]=this;\r\n\t\tthis.clear();\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\t_super.prototype.clear.call(this);\r\n\t}\r\n\r\n\tTextSV.create=function(){\r\n\t\tif (TextSV._length)return TextSV.pool[--TextSV._length];\r\n\t\telse return new TextSV(null);\r\n\t}\r\n\r\n\tTextSV.pool=[];\r\n\tTextSV._length=0;\r\n\treturn TextSV;\r\n})(TextureSV)\r\n\r\n\r\n//class laya.webgl.shader.d2.Shader2X extends laya.webgl.shader.Shader\r\nvar Shader2X=(function(_super){\r\n\tfunction Shader2X(vs,ps,saveName,nameMap){\r\n\t\tthis._params2dQuick1=null;\r\n\t\tthis._params2dQuick2=null;\r\n\t\tthis._shaderValueWidth=NaN;\r\n\t\tthis._shaderValueHeight=NaN;\r\n\t\tShader2X.__super.call(this,vs,ps,saveName,nameMap);\r\n\t}\r\n\r\n\t__class(Shader2X,'laya.webgl.shader.d2.Shader2X',_super);\r\n\tvar __proto=Shader2X.prototype;\r\n\t__proto.upload2dQuick1=function(shaderValue){\r\n\t\tthis.upload(shaderValue,this._params2dQuick1 || this._make2dQuick1());\r\n\t}\r\n\r\n\t__proto._make2dQuick1=function(){\r\n\t\tif (!this._params2dQuick1){\r\n\t\t\tthis.activeResource();\r\n\t\t\tthis._params2dQuick1=[];\r\n\t\t\tvar params=this._params,one;\r\n\t\t\tfor (var i=0,n=params.length;i < n;i++){\r\n\t\t\t\tone=params[i];\r\n\t\t\t\tif (!Render.isFlash && (one.name===\"size\" || one.name===\"position\" || one.name===\"texcoord\"))continue ;\r\n\t\t\t\tthis._params2dQuick1.push(one);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._params2dQuick1;\r\n\t}\r\n\r\n\t__proto.disposeResource=function(){\r\n\t\t_super.prototype.disposeResource.call(this);\r\n\t\tthis._params2dQuick1=null;\r\n\t\tthis._params2dQuick2=null;\r\n\t}\r\n\r\n\t__proto.upload2dQuick2=function(shaderValue){\r\n\t\tthis.upload(shaderValue,this._params2dQuick2 || this._make2dQuick2());\r\n\t}\r\n\r\n\t__proto._make2dQuick2=function(){\r\n\t\tif (!this._params2dQuick2){\r\n\t\t\tthis.activeResource();\r\n\t\t\tthis._params2dQuick2=[];\r\n\t\t\tvar params=this._params,one;\r\n\t\t\tfor (var i=0,n=params.length;i < n;i++){\r\n\t\t\t\tone=params[i];\r\n\t\t\t\tif (!Render.isFlash && (one.name===\"size\"))continue ;\r\n\t\t\t\tthis._params2dQuick2.push(one);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._params2dQuick2;\r\n\t}\r\n\r\n\tShader2X.create=function(vs,ps,saveName,nameMap){\r\n\t\treturn new Shader2X(vs,ps,saveName,nameMap);\r\n\t}\r\n\r\n\treturn Shader2X;\r\n})(Shader)\r\n\r\n\r\n//class laya.webgl.utils.IndexBuffer2D extends laya.webgl.utils.Buffer2D\r\nvar IndexBuffer2D=(function(_super){\r\n\tfunction IndexBuffer2D(bufferUsage){\r\n\t\tthis._uint8Array=null;\r\n\t\tthis._uint16Array=null;\r\n\t\t(bufferUsage===void 0)&& (bufferUsage=/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4);\r\n\t\tIndexBuffer2D.__super.call(this);\r\n\t\tthis._bufferUsage=bufferUsage;\r\n\t\tthis._bufferType=/*laya.webgl.WebGLContext.ELEMENT_ARRAY_BUFFER*/0x8893;\r\n\t\tRender.isFlash || (this._buffer=new ArrayBuffer(8));\r\n\t}\r\n\r\n\t__class(IndexBuffer2D,'laya.webgl.utils.IndexBuffer2D',_super);\r\n\tvar __proto=IndexBuffer2D.prototype;\r\n\t__proto._checkArrayUse=function(){\r\n\t\tthis._uint8Array && (this._uint8Array=new Uint8Array(this._buffer));\r\n\t\tthis._uint16Array && (this._uint16Array=new Uint16Array(this._buffer));\r\n\t}\r\n\r\n\t__proto.getUint8Array=function(){\r\n\t\treturn this._uint8Array || (this._uint8Array=new Uint8Array(this._buffer));\r\n\t}\r\n\r\n\t__proto.getUint16Array=function(){\r\n\t\treturn this._uint16Array || (this._uint16Array=new Uint16Array(this._buffer));\r\n\t}\r\n\r\n\t__proto.destory=function(){\r\n\t\tthis._uint16Array=null;\r\n\t\tthis._uint8Array=null;\r\n\t\tthis._buffer=null;\r\n\t}\r\n\r\n\tIndexBuffer2D.QuadrangleIB=null;\r\n\tIndexBuffer2D.create=function(bufferUsage){\r\n\t\t(bufferUsage===void 0)&& (bufferUsage=/*laya.webgl.WebGLContext.STATIC_DRAW*/0x88E4);\r\n\t\treturn new IndexBuffer2D(bufferUsage);\r\n\t}\r\n\r\n\treturn IndexBuffer2D;\r\n})(Buffer2D)\r\n\r\n\r\n//class laya.webgl.utils.VertexBuffer2D extends laya.webgl.utils.Buffer2D\r\nvar VertexBuffer2D=(function(_super){\r\n\tfunction VertexBuffer2D(vertexStride,bufferUsage){\r\n\t\tthis._floatArray32=null;\r\n\t\tthis._vertexStride=0;\r\n\t\tVertexBuffer2D.__super.call(this);\r\n\t\tthis._vertexStride=vertexStride;\r\n\t\tthis._bufferUsage=bufferUsage;\r\n\t\tthis._bufferType=/*laya.webgl.WebGLContext.ARRAY_BUFFER*/0x8892;\r\n\t\tRender.isFlash || (this._buffer=new ArrayBuffer(8));\r\n\t\tthis.getFloat32Array();\r\n\t}\r\n\r\n\t__class(VertexBuffer2D,'laya.webgl.utils.VertexBuffer2D',_super);\r\n\tvar __proto=VertexBuffer2D.prototype;\r\n\t__proto.getFloat32Array=function(){\r\n\t\treturn this._floatArray32 || (this._floatArray32=new Float32Array(this._buffer));\r\n\t}\r\n\r\n\t__proto.bind=function(ibBuffer){\r\n\t\t(ibBuffer)&& (ibBuffer._bind());\r\n\t\tthis._bind();\r\n\t}\r\n\r\n\t__proto.insertData=function(data,pos){\r\n\t\tvar vbdata=this.getFloat32Array();\r\n\t\tvbdata.set(data,pos);\r\n\t\tthis._upload=true;\r\n\t}\r\n\r\n\t__proto.bind_upload=function(ibBuffer){\r\n\t\t(ibBuffer._bind_upload())|| (ibBuffer._bind());\r\n\t\t(this._bind_upload())|| (this._bind());\r\n\t}\r\n\r\n\t__proto._checkArrayUse=function(){\r\n\t\tthis._floatArray32 && (this._floatArray32=new Float32Array(this._buffer));\r\n\t}\r\n\r\n\t__proto.disposeResource=function(){\r\n\t\t_super.prototype.disposeResource.call(this);\r\n\t\tvar enableAtributes=Buffer._enableAtributes;\r\n\t\tfor (var i=0;i < 10;i++){\r\n\t\t\tWebGL.mainContext.disableVertexAttribArray(i);\r\n\t\t\tenableAtributes[i]=null;\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto.destory=function(){\r\n\t\tthis._byteLength=0;\r\n\t\tthis._upload=true;\r\n\t\tthis._buffer=null;\r\n\t\tthis._floatArray32=null;\r\n\t}\r\n\r\n\t__getset(0,__proto,'vertexStride',function(){\r\n\t\treturn this._vertexStride;\r\n\t});\r\n\r\n\tVertexBuffer2D.create=function(vertexStride,bufferUsage){\r\n\t\t(bufferUsage===void 0)&& (bufferUsage=/*laya.webgl.WebGLContext.DYNAMIC_DRAW*/0x88E8);\r\n\t\treturn new VertexBuffer2D(vertexStride,bufferUsage);\r\n\t}\r\n\r\n\treturn VertexBuffer2D;\r\n})(Buffer2D)\r\n\r\n\r\n//class laya.webgl.resource.WebGLImage extends laya.resource.HTMLImage\r\nvar WebGLImage=(function(_super){\r\n\tfunction WebGLImage(data,def,format,mipmap){\r\n\t\t/**@private */\r\n\t\tthis._format=0;\r\n\t\t/**@private */\r\n\t\tthis._mipmap=false;\r\n\t\t/***是否创建私有Source,值为false时不根据src创建私有WebGLTexture,同时销毁时也只清空source=null,不调用WebGL.mainContext.deleteTexture类似函数，调用资源激活前有效*/\r\n\t\tthis._allowMerageInAtlas=false;\r\n\t\t/**是否允许加入大图合集*/\r\n\t\tthis._enableMerageInAtlas=false;\r\n\t\t/**是否使用重复模式纹理寻址*/\r\n\t\tthis.repeat=false;\r\n\t\t/**@private */\r\n\t\tthis._image=null;\r\n\t\t/**缩小过滤器*/\r\n\t\tthis.minFifter=0;\r\n\t\t/**放大过滤器*/\r\n\t\tthis.magFifter=0;\r\n\t\t(format===void 0)&& (format=/*laya.webgl.WebGLContext.RGBA*/0x1908);\r\n\t\t(mipmap===void 0)&& (mipmap=true);\r\n\t\tWebGLImage.__super.call(this,data,def);\r\n\t\tthis._format=format;\r\n\t\tthis._mipmap=mipmap;\r\n\t\tthis.repeat=false;\r\n\t\tthis.minFifter=-1;\r\n\t\tthis.magFifter=-1;\r\n\t\tif ((typeof data=='string')){\r\n\t\t\tthis._url=data;\r\n\t\t\tthis._src=data;\r\n\t\t\tthis._image=new Browser.window.Image();\r\n\t\t\tif (def){\r\n\t\t\t\tdef.onload && (this.onload=def.onload);\r\n\t\t\t\tdef.onerror && (this.onerror=def.onerror);\r\n\t\t\t\tdef.onCreate && def.onCreate(this);\r\n\t\t\t}\r\n\t\t\tthis._image.crossOrigin=(data && (data.indexOf(\"data:\")==0))? null :\"\";\r\n\t\t\t(data)&& (this._image.src=data);\r\n\t\t\t}else if ((data instanceof ArrayBuffer)){\r\n\t\t\tthis._src=def;\r\n\t\t\tthis._url=this._src;\r\n\t\t\tvar readData=new Byte(data);\r\n\t\t\tvar magicNumber=readData.readUTFBytes(4);\r\n\t\t\tvar version=readData.readUTFBytes(2);\r\n\t\t\tvar dataType=readData.getInt16();\r\n\t\t\treadData.endian=/*laya.utils.Byte.BIG_ENDIAN*/\"bigEndian\";\r\n\t\t\tthis._w=readData.getInt16();\r\n\t\t\tthis._h=readData.getInt16();\r\n\t\t\tvar originalWidth=readData.getInt16();\r\n\t\t\tvar originalHeight=readData.getInt16();\r\n\t\t\tthis._image=new Uint8Array(data,readData.pos);\r\n\t\t\tthis._format=WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL;\r\n\t\t\t(AtlasResourceManager.enabled)&& (this._w < AtlasResourceManager.atlasLimitWidth && this._h < AtlasResourceManager.atlasLimitHeight)? this._allowMerageInAtlas=true :this._allowMerageInAtlas=false;\r\n\t\t\t}else {\r\n\t\t\tthis._src=def;\r\n\t\t\tthis._url=this._src;\r\n\t\t\tthis._image=data[\"source\"] || data;\r\n\t\t\tthis.onresize();\r\n\t\t}\r\n\t\tthis._$5__enableMerageInAtlas=true;\r\n\t}\r\n\r\n\t__class(WebGLImage,'laya.webgl.resource.WebGLImage',_super);\r\n\tvar __proto=WebGLImage.prototype;\r\n\tLaya.imps(__proto,{\"laya.webgl.resource.IMergeAtlasBitmap\":true})\r\n\t__proto._init_=function(src,def){}\r\n\t__proto._createWebGlTexture=function(){\r\n\t\tif (!this._image){\r\n\t\t\tthrow \"create GLTextur err:no data:\"+this._image;\r\n\t\t};\r\n\t\tvar gl=WebGL.mainContext;\r\n\t\tvar glTex=this._source=gl.createTexture();\r\n\t\tvar preTarget=WebGLContext.curBindTexTarget;\r\n\t\tvar preTexture=WebGLContext.curBindTexValue;\r\n\t\tWebGLContext.bindTexture(gl,/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,glTex);\r\n\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,true);\r\n\t\tswitch (this._format){\r\n\t\t\tcase /*laya.webgl.WebGLContext.RGBA*/0x1908:\r\n\t\t\t\tgl.texImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,this._format,/*laya.webgl.WebGLContext.RGBA*/0x1908,/*laya.webgl.WebGLContext.UNSIGNED_BYTE*/0x1401,this._image);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:\r\n\t\t\t\tgl.compressedTexImage2D(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,0,this._format,this._w,this._h,0,this._image);\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tgl.pixelStorei(/*laya.webgl.WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL*/0x9241,false);\r\n\t\tvar minFifter=this.minFifter;\r\n\t\tvar magFifter=this.magFifter;\r\n\t\tvar repeat=this.repeat ? /*laya.webgl.WebGLContext.REPEAT*/0x2901 :/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F;\r\n\t\tvar isPot=Arith.isPOT(this._w,this._h);\r\n\t\tif (isPot){\r\n\t\t\tif (this.mipmap)\r\n\t\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR_MIPMAP_LINEAR*/0x2703);\r\n\t\t\telse\r\n\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,repeat);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,repeat);\r\n\t\t\tthis.mipmap && gl.generateMipmap(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1);\r\n\t\t\t}else {\r\n\t\t\t(minFifter!==-1)|| (minFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\t(magFifter!==-1)|| (magFifter=/*laya.webgl.WebGLContext.LINEAR*/0x2601);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MIN_FILTER*/0x2801,minFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_MAG_FILTER*/0x2800,magFifter);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_S*/0x2802,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\t\tgl.texParameteri(/*laya.webgl.WebGLContext.TEXTURE_2D*/0x0DE1,/*laya.webgl.WebGLContext.TEXTURE_WRAP_T*/0x2803,/*laya.webgl.WebGLContext.CLAMP_TO_EDGE*/0x812F);\r\n\t\t}\r\n\t\t(preTarget && preTexture)&& (WebGLContext.bindTexture(gl,preTarget,preTexture));\r\n\t\tthis._image.onload=null;\r\n\t\tthis._image=null;\r\n\t\tif (isPot && this.mipmap)\r\n\t\t\tthis.memorySize=this._w *this._h *4 *(1+1 / 3);\r\n\t\telse\r\n\t\tthis.memorySize=this._w *this._h *4;\r\n\t\tthis._recreateLock=false;\r\n\t}\r\n\r\n\t/***重新创建资源，如果异步创建中被强制释放再创建，则需等待释放完成后再重新加载创建。*/\r\n\t__proto.recreateResource=function(){\r\n\t\tvar _$this=this;\r\n\t\tif (this._src==null || this._src===\"\")\r\n\t\t\treturn;\r\n\t\tthis._needReleaseAgain=false;\r\n\t\tif (!this._image){\r\n\t\t\tthis._recreateLock=true;\r\n\t\t\tvar _this=this;\r\n\t\t\tthis._image=new Browser.window.Image();\r\n\t\t\tthis._image.crossOrigin=this._src.indexOf(\"data:\")==0 ? null :\"\";\r\n\t\t\tthis._image.onload=function (){\r\n\t\t\t\tif (_this._needReleaseAgain){\r\n\t\t\t\t\t_this._needReleaseAgain=false;\r\n\t\t\t\t\t_this._image.onload=null;\r\n\t\t\t\t\t_this._image=null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t(!(_this._allowMerageInAtlas && _this._enableMerageInAtlas))? (_this._createWebGlTexture()):(_$this.memorySize=0,_$this._recreateLock=false);\r\n\t\t\t\t_this.completeCreate();\r\n\t\t\t};\r\n\t\t\tthis._image.src=this._src;\r\n\t\t\t}else {\r\n\t\t\tif (this._recreateLock){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t(!(this._allowMerageInAtlas && this._$5__enableMerageInAtlas))? (this._createWebGlTexture()):(this.memorySize=0,this._recreateLock=false);\r\n\t\t\tthis.completeCreate();\r\n\t\t}\r\n\t}\r\n\r\n\t/***销毁资源*/\r\n\t__proto.disposeResource=function(){\r\n\t\tif (this._recreateLock){\r\n\t\t\tthis._needReleaseAgain=true;\r\n\t\t}\r\n\t\tif (this._source){\r\n\t\t\tWebGL.mainContext.deleteTexture(this._source);\r\n\t\t\tthis._source=null;\r\n\t\t\tthis._image=null;\r\n\t\t\tthis.memorySize=0;\r\n\t\t}\r\n\t}\r\n\r\n\t/***调整尺寸*/\r\n\t__proto.onresize=function(){\r\n\t\tthis._w=this._image.width;\r\n\t\tthis._h=this._image.height;\r\n\t\t(AtlasResourceManager.enabled)&& (this._w < AtlasResourceManager.atlasLimitWidth && this._h < AtlasResourceManager.atlasLimitHeight)? this._allowMerageInAtlas=true :this._allowMerageInAtlas=false;\r\n\t}\r\n\r\n\t__proto.clearAtlasSource=function(){\r\n\t\tthis._image=null;\r\n\t}\r\n\r\n\t/**\r\n\t*获取纹理格式。\r\n\t*/\r\n\t__getset(0,__proto,'format',function(){\r\n\t\treturn this._format;\r\n\t});\r\n\r\n\t/**\r\n\t*是否创建私有Source,通常禁止修改\r\n\t*@param value 是否创建\r\n\t*/\r\n\t/**\r\n\t*是否创建私有Source\r\n\t*@return 是否创建\r\n\t*/\r\n\t__getset(0,__proto,'enableMerageInAtlas',function(){\r\n\t\treturn this._$5__enableMerageInAtlas;\r\n\t\t},function(value){\r\n\t\tthis._$5__enableMerageInAtlas=value;\r\n\t});\r\n\r\n\t/**\r\n\t*获取是否具有mipmap。\r\n\t*/\r\n\t__getset(0,__proto,'mipmap',function(){\r\n\t\treturn this._mipmap;\r\n\t});\r\n\r\n\t/**\r\n\t*是否创建私有Source\r\n\t*@return 是否创建\r\n\t*/\r\n\t__getset(0,__proto,'allowMerageInAtlas',function(){\r\n\t\treturn this._allowMerageInAtlas;\r\n\t});\r\n\r\n\t__getset(0,__proto,'atlasSource',function(){\r\n\t\treturn this._image;\r\n\t});\r\n\r\n\t/***\r\n\t*设置onload函数\r\n\t*@param value onload函数\r\n\t*/\r\n\t__getset(0,__proto,'onload',null,function(value){\r\n\t\tvar _$this=this;\r\n\t\tthis._onload=value;\r\n\t\tthis._image && (this._image.onload=this._onload !=null ? (function(){\r\n\t\t\t_$this.onresize();\r\n\t\t\t_$this._onload();\r\n\t\t}):null);\r\n\t});\r\n\r\n\t/***\r\n\t*设置onerror函数\r\n\t*@param value onerror函数\r\n\t*/\r\n\t__getset(0,__proto,'onerror',null,function(value){\r\n\t\tvar _$this=this;\r\n\t\tthis._onerror=value;\r\n\t\tthis._image && (this._image.onerror=this._onerror !=null ? (function(){\r\n\t\t\t_$this._onerror()\r\n\t\t}):null);\r\n\t});\r\n\r\n\treturn WebGLImage;\r\n})(HTMLImage)\r\n\r\n\r\n\tLaya.__init([DrawText,AtlasGrid,WebGLContext2D,ShaderCompile]);\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.webgl.js?");

/***/ }),

/***/ "./bin/libs/laya.wxmini.js":
/*!*********************************!*\
  !*** ./bin/libs/laya.wxmini.js ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n\tvar Browser=laya.utils.Browser,Event=laya.events.Event,EventDispatcher=laya.events.EventDispatcher;\r\n\tvar HTMLImage=laya.resource.HTMLImage,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader;\r\n\tvar Matrix=laya.maths.Matrix,Render=laya.renders.Render,RunDriver=laya.utils.RunDriver,SoundChannel=laya.media.SoundChannel;\r\n\tvar SoundManager=laya.media.SoundManager,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils;\r\n//class laya.wx.mini.MiniAdpter\r\nvar MiniAdpter=(function(){\r\n\tfunction MiniAdpter(){}\r\n\t__class(MiniAdpter,'laya.wx.mini.MiniAdpter');\r\n\tMiniAdpter.getJson=function(data){\r\n\t\treturn JSON.parse(data);\r\n\t}\r\n\r\n\tMiniAdpter.init=function(isPosMsg,isSon){\r\n\t\t(isPosMsg===void 0)&& (isPosMsg=false);\r\n\t\t(isSon===void 0)&& (isSon=false);\r\n\t\tif (MiniAdpter._inited)return;\r\n\t\tMiniAdpter._inited=true;\r\n\t\tMiniAdpter.window=/*__JS__ */window;\r\n\t\tif(MiniAdpter.window.navigator.userAgent.indexOf('MiniGame')<0)return;\r\n\t\tMiniAdpter.isZiYu=isSon;\r\n\t\tMiniAdpter.isPosMsgYu=isPosMsg;\r\n\t\tMiniAdpter.EnvConfig={};\r\n\t\tif(!MiniAdpter.isZiYu){\r\n\t\t\tMiniFileMgr.setNativeFileDir(\"/layaairGame\");\r\n\t\t\tMiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(MiniAdpter,MiniAdpter.onMkdirCallBack));\r\n\t\t}\r\n\t\tMiniAdpter.systemInfo=/*__JS__ */wx.getSystemInfoSync();\r\n\t\tMiniAdpter.window.focus=function (){\r\n\t\t};\r\n\t\tLaya['getUrlPath']=function (){\r\n\t\t};\r\n\t\tMiniAdpter.window.logtime=function (str){\r\n\t\t};\r\n\t\tMiniAdpter.window.alertTimeLog=function (str){\r\n\t\t};\r\n\t\tMiniAdpter.window.resetShareInfo=function (){\r\n\t\t};\r\n\t\tMiniAdpter.window.CanvasRenderingContext2D=function (){\r\n\t\t};\r\n\t\tMiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext('2d').__proto__;\r\n\t\tMiniAdpter.window.document.body.appendChild=function (){\r\n\t\t};\r\n\t\tMiniAdpter.EnvConfig.pixelRatioInt=0;\r\n\t\tRunDriver.getPixelRatio=MiniAdpter.pixelRatio;\r\n\t\tMiniAdpter._preCreateElement=Browser.createElement;\r\n\t\tBrowser[\"createElement\"]=MiniAdpter.createElement;\r\n\t\tRunDriver.createShaderCondition=MiniAdpter.createShaderCondition;\r\n\t\tUtils.parseXMLFromString=MiniAdpter.parseXMLFromString;\r\n\t\tInput['_createInputElement']=MiniInput['_createInputElement'];\r\n\t\tMiniAdpter.EnvConfig.load=Loader.prototype.load;\r\n\t\tLoader.prototype.load=MiniLoader.prototype.load;\r\n\t\tLoader['clearRes']=MiniAdpter.clearRes;\r\n\t\tLoader.prototype._loadImage=MiniImage.prototype._loadImage;\r\n\t\tif(MiniAdpter.isZiYu && isPosMsg){\r\n\t\t\t/*__JS__ */wx.onMessage(function(message){\r\n\t\t\t\tif(message['isLoad']){\r\n\t\t\t\t\tMiniFileMgr.ziyuFileData[message.url]=message.data;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tMiniAdpter.clearRes=function(url,forceDispose){\r\n\t\t(forceDispose===void 0)&& (forceDispose=false);\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar arr=Loader.getAtlas(url);\r\n\t\tif (arr){\r\n\t\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\t\tvar resUrl=arr[i];\r\n\t\t\t\tvar tex=Loader.getRes(resUrl);\r\n\t\t\t\tdelete Loader.loadedMap[resUrl];\r\n\t\t\t\tif (tex)tex.destroy(forceDispose);\r\n\t\t\t}\r\n\t\t\tarr.length=0;\r\n\t\t\tdelete Loader['atlasMap'][url];\r\n\t\t\tdelete Loader.loadedMap[url];\r\n\t\t\tMiniFileMgr.remove(\"\",url);\r\n\t\t\t}else {\r\n\t\t\tvar res=Loader.loadedMap[url];\r\n\t\t\tif (res){\r\n\t\t\t\tdelete Loader.loadedMap[url];\r\n\t\t\t\tif ((res instanceof laya.resource.Texture )&& res.bitmap)(res).destroy(forceDispose);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMiniAdpter.onMkdirCallBack=function(errorCode,data){\r\n\t\tif (!errorCode)\r\n\t\t\tMiniFileMgr.filesListObj=JSON.parse(data.data);\r\n\t}\r\n\r\n\tMiniAdpter.pixelRatio=function(){\r\n\t\tif (!MiniAdpter.EnvConfig.pixelRatioInt){\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log(MiniAdpter.systemInfo);\r\n\t\t\t\tMiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio;\r\n\t\t\t\treturn MiniAdpter.systemInfo.pixelRatio;\r\n\t\t\t}catch (error){}\r\n\t\t}\r\n\t\treturn MiniAdpter.EnvConfig.pixelRatioInt;\r\n\t}\r\n\r\n\tMiniAdpter.createElement=function(type){\r\n\t\tif (type==\"canvas\"){\r\n\t\t\tvar _source;\r\n\t\t\tif (MiniAdpter.idx==1){\r\n\t\t\t\tif(MiniAdpter.isZiYu){\r\n\t\t\t\t\t_source=/*__JS__ */sharedCanvas;\r\n\t\t\t\t\t_source.style={};\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t_source=/*__JS__ */window.canvas;\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\t_source=/*__JS__ */window.wx.createCanvas();\r\n\t\t\t}\r\n\t\t\tMiniAdpter.idx++;\r\n\t\t\treturn _source;\r\n\t\t\t}else if (type==\"textarea\" || type==\"input\"){\r\n\t\t\treturn MiniAdpter.onCreateInput(type);\r\n\t\t\t}else if (type==\"div\"){\r\n\t\t\tvar node=MiniAdpter._preCreateElement(type);\r\n\t\t\tnode.contains=function (value){\r\n\t\t\t\treturn null\r\n\t\t\t};\r\n\t\t\tnode.removeChild=function (value){\r\n\t\t\t};\r\n\t\t\treturn node;\r\n\t\t\t}else {\r\n\t\t\treturn MiniAdpter._preCreateElement(type);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniAdpter.onCreateInput=function(type){\r\n\t\tvar node=MiniAdpter._preCreateElement(type);\r\n\t\tnode.focus=MiniInput.wxinputFocus;\r\n\t\tnode.blur=MiniInput.wxinputblur;\r\n\t\tnode.style={};\r\n\t\tnode.value=0;\r\n\t\tnode.parentElement={};\r\n\t\tnode.placeholder={};\r\n\t\tnode.type={};\r\n\t\tnode.setColor=function (value){\r\n\t\t};\r\n\t\tnode.setType=function (value){\r\n\t\t};\r\n\t\tnode.setFontFace=function (value){\r\n\t\t};\r\n\t\tnode.addEventListener=function (value){\r\n\t\t};\r\n\t\tnode.contains=function (value){\r\n\t\t\treturn null\r\n\t\t};\r\n\t\tnode.removeChild=function (value){\r\n\t\t};\r\n\t\treturn node;\r\n\t}\r\n\r\n\tMiniAdpter.createShaderCondition=function(conditionScript){\r\n\t\tvar _$this=this;\r\n\t\tvar func=function (){\r\n\t\t\tvar abc=conditionScript;\r\n\t\t\treturn _$this[conditionScript.replace(\"this.\",\"\")];\r\n\t\t}\r\n\t\treturn func;\r\n\t}\r\n\r\n\tMiniAdpter.EnvConfig=null;\r\n\tMiniAdpter.window=null;\r\n\tMiniAdpter._preCreateElement=null;\r\n\tMiniAdpter._inited=false;\r\n\tMiniAdpter.wxRequest=null;\r\n\tMiniAdpter.systemInfo=null;\r\n\tMiniAdpter.version=\"0.0.1\";\r\n\tMiniAdpter.isZiYu=false;\r\n\tMiniAdpter.isPosMsgYu=false;\r\n\tMiniAdpter.parseXMLFromString=function(value){\r\n\t\tvar rst;\r\n\t\tvar Parser;\r\n\t\tvalue=value.replace(/>\\s+</g,'><');\r\n\t\ttry {\r\n\t\t\t/*__JS__ */rst=(new window.Parser.DOMParser()).parseFromString(value,'text/xml');\r\n\t\t\t}catch (error){\r\n\t\t\tthrow \"需要引入xml解析库文件\";\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMiniAdpter.idx=1;\r\n\treturn MiniAdpter;\r\n})()\r\n\r\n\r\n//class laya.wx.mini.MiniImage\r\nvar MiniImage=(function(){\r\n\tfunction MiniImage(){}\r\n\t__class(MiniImage,'laya.wx.mini.MiniImage');\r\n\tvar __proto=MiniImage.prototype;\r\n\t__proto._loadImage=function(url){\r\n\t\tvar thisLoader=this;\r\n\t\tvar isTransformUrl=false;\r\n\t\tif (url.indexOf(\"layaNativeDir/\")==-1){\r\n\t\t\tisTransformUrl=true;\r\n\t\t\turl=URL.formatURL(url);\r\n\t\t}\r\n\t\tif (!MiniFileMgr.getFileInfo(url)){\r\n\t\t\tif (url.indexOf(\"http://\")!=-1 || url.indexOf(\"https://\")!=-1)\r\n\t\t\t\tMiniFileMgr.downImg(url,new Handler(MiniImage,MiniImage.onDownImgCallBack,[url,thisLoader]),url);\r\n\t\t\telse\r\n\t\t\tMiniImage.onCreateImage(url,thisLoader,true);\r\n\t\t\t}else {\r\n\t\t\tMiniImage.onCreateImage(url,thisLoader,!isTransformUrl);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniImage.onDownImgCallBack=function(sourceUrl,thisLoader,errorCode){\r\n\t\tif (!errorCode)\r\n\t\t\tMiniImage.onCreateImage(sourceUrl,thisLoader);\r\n\t\telse {\r\n\t\t\tthisLoader.onError(null);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniImage.onCreateImage=function(sourceUrl,thisLoader,isLocal){\r\n\t\t(isLocal===void 0)&& (isLocal=false);\r\n\t\tvar fileNativeUrl;\r\n\t\tif (!isLocal){\r\n\t\t\tvar fileObj=MiniFileMgr.getFileInfo(sourceUrl);\r\n\t\t\tvar fileMd5Name=fileObj.md5;\r\n\t\t\tfileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);\r\n\t\t\t}else {\r\n\t\t\tfileNativeUrl=sourceUrl;\r\n\t\t}\r\n\t\tif (thisLoader.imgCache==null)\r\n\t\t\tthisLoader.imgCache={};\r\n\t\tvar image;\r\n\t\tfunction clear (){\r\n\t\t\timage.onload=null;\r\n\t\t\timage.onerror=null;\r\n\t\t\tdelete thisLoader.imgCache[sourceUrl]\r\n\t\t};\r\n\t\tvar onload=function (){\r\n\t\t\tclear();\r\n\t\t\tthisLoader.onLoaded(image);\r\n\t\t};\r\n\t\tvar onerror=function (){\r\n\t\t\tclear();\r\n\t\t\tthisLoader.event(/*laya.events.Event.ERROR*/\"error\",\"Load image failed\");\r\n\t\t}\r\n\t\tif (thisLoader._type==\"nativeimage\"){\r\n\t\t\timage=new Browser.window.Image();\r\n\t\t\timage.crossOrigin=\"\";\r\n\t\t\timage.onload=onload;\r\n\t\t\timage.onerror=onerror;\r\n\t\t\timage.src=fileNativeUrl;\r\n\t\t\tthisLoader.imgCache[sourceUrl]=image;\r\n\t\t\t}else {\r\n\t\t\tnew HTMLImage.create(fileNativeUrl,{onload:onload,onerror:onerror,onCreate:function (img){\r\n\t\t\t\t\timage=img;\r\n\t\t\t\t\tthisLoader.imgCache[sourceUrl]=img;\r\n\t\t\t}});\r\n\t\t}\r\n\t}\r\n\r\n\treturn MiniImage;\r\n})()\r\n\r\n\r\n//class laya.wx.mini.MiniInput\r\nvar MiniInput=(function(){\r\n\tfunction MiniInput(){}\r\n\t__class(MiniInput,'laya.wx.mini.MiniInput');\r\n\tMiniInput._createInputElement=function(){\r\n\t\tInput['_initInput'](Input['area']=Browser.createElement(\"textarea\"));\r\n\t\tInput['_initInput'](Input['input']=Browser.createElement(\"input\"));\r\n\t\tInput['inputContainer']=Browser.createElement(\"div\");\r\n\t\tInput['inputContainer'].style.position=\"absolute\";\r\n\t\tInput['inputContainer'].style.zIndex=1E5;\r\n\t\tBrowser.container.appendChild(Input['inputContainer']);\r\n\t\tInput['inputContainer'].setPos=function (x,y){Input['inputContainer'].style.left=x+'px';Input['inputContainer'].style.top=y+'px';};\r\n\t\tLaya.stage.on(\"resize\",null,MiniInput._onStageResize);\r\n\t\t/*__JS__ */wx.onWindowResize && /*__JS__ */wx.onWindowResize(function(res){\r\n\t\t\t/*__JS__ */window.dispatchEvent && /*__JS__ */window.dispatchEvent(\"resize\");\r\n\t\t});\r\n\t\tSoundManager._soundClass=MiniSound;\r\n\t\tSoundManager._musicClass=MiniSound;\r\n\t\tvar model=MiniAdpter.systemInfo.model;\r\n\t\tvar system=MiniAdpter.systemInfo.system;\r\n\t\tif(model.indexOf(\"iPhone\")!=-1){\r\n\t\t\tBrowser.onIPhone=true;\r\n\t\t}\r\n\t\tif(system.indexOf(\"Android\")!=-1 || system.indexOf(\"Adr\")!=-1){\r\n\t\t\tBrowser.onAndriod=true;\r\n\t\t}\r\n\t}\r\n\r\n\tMiniInput._onStageResize=function(){\r\n\t\tvar ts=Laya.stage._canvasTransform.identity();\r\n\t\tts.scale((Browser.width / Render.canvas.width / RunDriver.getPixelRatio()),Browser.height / Render.canvas.height / RunDriver.getPixelRatio());\r\n\t}\r\n\r\n\tMiniInput.wxinputFocus=function(e){\r\n\t\tvar _inputTarget=Input['inputElement'].target;\r\n\t\tif (_inputTarget && !_inputTarget.editable){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tMiniAdpter.window.wx.offKeyboardConfirm();\r\n\t\tMiniAdpter.window.wx.offKeyboardInput();\r\n\t\tMiniAdpter.window.wx.showKeyboard({defaultValue:_inputTarget.text,maxLength:_inputTarget.maxChars,multiple:_inputTarget.multiline,confirmHold:true,confirmType:'done',success:function (res){\r\n\t\t\t\t},fail:function (res){\r\n\t\t}});\r\n\t\tMiniAdpter.window.wx.onKeyboardConfirm(function(res){\r\n\t\t\tvar str=res ? res.value :\"\";\r\n\t\t\t_inputTarget.text=str;\r\n\t\t\t_inputTarget.event(/*laya.events.Event.INPUT*/\"input\");\r\n\t\t\tlaya.wx.mini.MiniInput.inputEnter();\r\n\t\t})\r\n\t\tMiniAdpter.window.wx.onKeyboardInput(function(res){\r\n\t\t\tvar str=res ? res.value :\"\";\r\n\t\t\tif (!_inputTarget.multiline){\r\n\t\t\t\tif (str.indexOf(\"\\n\")!=-1){\r\n\t\t\t\t\tlaya.wx.mini.MiniInput.inputEnter();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t_inputTarget.text=str;\r\n\t\t\t_inputTarget.event(/*laya.events.Event.INPUT*/\"input\");\r\n\t\t});\r\n\t}\r\n\r\n\tMiniInput.inputEnter=function(){\r\n\t\tInput['inputElement'].target.focus=false;\r\n\t}\r\n\r\n\tMiniInput.wxinputblur=function(){\r\n\t\tMiniInput.hideKeyboard();\r\n\t}\r\n\r\n\tMiniInput.hideKeyboard=function(){\r\n\t\tMiniAdpter.window.wx.offKeyboardConfirm();\r\n\t\tMiniAdpter.window.wx.offKeyboardInput();\r\n\t\tMiniAdpter.window.wx.hideKeyboard({success:function (res){\r\n\t\t\t\tconsole.log('隐藏键盘')\r\n\t\t\t\t},fail:function (res){\r\n\t\t\t\tconsole.log(\"隐藏键盘出错:\"+(res ? res.errMsg :\"\"));\r\n\t\t}});\r\n\t}\r\n\r\n\treturn MiniInput;\r\n})()\r\n\r\n\r\n//class laya.wx.mini.MiniLoader\r\nvar MiniLoader=(function(){\r\n\tfunction MiniLoader(){}\r\n\t__class(MiniLoader,'laya.wx.mini.MiniLoader');\r\n\tvar __proto=MiniLoader.prototype;\r\n\t/**\r\n\t*\r\n\t*@param url\r\n\t*@param type\r\n\t*@param cache\r\n\t*@param group\r\n\t*@param ignoreCache\r\n\t*/\r\n\t__proto.load=function(url,type,cache,group,ignoreCache){\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\tvar thisLoader=this;\r\n\t\tthisLoader._url=url;\r\n\t\tif (url.indexOf(\"data:image\")===0)thisLoader._type=type=/*laya.net.Loader.IMAGE*/\"image\";\r\n\t\telse {\r\n\t\t\tthisLoader._type=type || (type=thisLoader.getTypeFromUrl(url));\r\n\t\t}\r\n\t\tthisLoader._cache=cache;\r\n\t\tthisLoader._data=null;\r\n\t\tvar encoding=\"ascii\";\r\n\t\tif (url.indexOf(\".fnt\")!=-1){\r\n\t\t\tencoding=\"utf8\";\r\n\t\t\t}else if (type==\"arraybuffer\"){\r\n\t\t\tencoding=\"\";\r\n\t\t};\r\n\t\tvar urlType=Utils.getFileExtension(url);\r\n\t\tif ((MiniLoader._fileTypeArr.indexOf(urlType)!=-1)){\r\n\t\t\tMiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache);\r\n\t\t\t}else {\r\n\t\t\tif (!MiniFileMgr.getFileInfo(url)){\r\n\t\t\t\tif (url.indexOf(\"layaNativeDir/\")!=-1){\r\n\t\t\t\t\tif(MiniAdpter.isZiYu){\r\n\t\t\t\t\t\tvar fileData=MiniFileMgr.ziyuFileData[url];\r\n\t\t\t\t\t\tthisLoader.onLoaded(fileData);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\tMiniFileMgr.read(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,thisLoader]));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\turl=URL.formatURL(url);\r\n\t\t\t\tif (url.indexOf(\"http://\")!=-1 || url.indexOf(\"https://\")!=-1){\r\n\t\t\t\t\tMiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tMiniFileMgr.readFile(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,thisLoader]),url);\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tMiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMiniLoader.onReadNativeCallBack=function(encoding,url,type,cache,group,ignoreCache,thisLoader,errorCode,data){\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\t(errorCode===void 0)&& (errorCode=0);\r\n\t\tif (!errorCode){\r\n\t\t\tvar tempData;\r\n\t\t\tif (type==/*laya.net.Loader.JSON*/\"json\" || type==/*laya.net.Loader.ATLAS*/\"atlas\"){\r\n\t\t\t\ttempData=MiniAdpter.getJson(data.data);\r\n\t\t\t\t}else if (type==/*laya.net.Loader.XML*/\"xml\"){\r\n\t\t\t\ttempData=Utils.parseXMLFromString(data.data);\r\n\t\t\t\t}else {\r\n\t\t\t\ttempData=data.data;\r\n\t\t\t}\r\n\t\t\tthisLoader.onLoaded(tempData);\r\n\t\t\tif(!MiniAdpter.isZiYu &&MiniAdpter.isPosMsgYu && type !=/*laya.net.Loader.BUFFER*/\"arraybuffer\"){\r\n\t\t\t\t/*__JS__ */wx.postMessage({url:url,data:tempData,isLoad:true});\r\n\t\t\t}\r\n\t\t\t}else if (errorCode==1){\r\n\t\t\tMiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache);\r\n\t\t}\r\n\t}\r\n\r\n\t__static(MiniLoader,\r\n\t['_fileTypeArr',function(){return this._fileTypeArr=['png','jpg','bmp','jpeg','gif'];}\r\n\t]);\r\n\treturn MiniLoader;\r\n})()\r\n\r\n\r\n/**\r\n*...\r\n*@author ww\r\n*/\r\n//class laya.wx.mini.MiniLocation\r\nvar MiniLocation=(function(){\r\n\tfunction MiniLocation(){}\r\n\t__class(MiniLocation,'laya.wx.mini.MiniLocation');\r\n\tMiniLocation.__init__=function(){\r\n\t\tMiniAdpter.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition;\r\n\t\tMiniAdpter.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition;\r\n\t\tMiniAdpter.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch;\r\n\t}\r\n\r\n\tMiniLocation.getCurrentPosition=function(success,error,options){\r\n\t\tMiniAdpter.window.wx.getLocation(getSuccess=function(res){\r\n\t\t\tvar rst={};\r\n\t\t\trst.coords=res;\r\n\t\t\trst.timestamp=Browser.now();\r\n\t\t\tif (success !=null){\r\n\t\t\t\tsuccess(rst);\r\n\t\t\t}\r\n\t\t},error);\r\n\t}\r\n\r\n\tMiniLocation.watchPosition=function(success,error,options){\r\n\t\tMiniLocation._curID++;\r\n\t\tvar curWatchO;\r\n\t\tcurWatchO={};\r\n\t\tcurWatchO.success=success;\r\n\t\tcurWatchO.error=error;\r\n\t\tMiniLocation._watchDic[MiniLocation._curID]=curWatchO;\r\n\t\tLaya.timer.loop(1000,null,MiniLocation._myLoop);\r\n\t\treturn MiniLocation._curID;\r\n\t}\r\n\r\n\tMiniLocation.clearWatch=function(id){\r\n\t\tdelete MiniLocation._watchDic[id];\r\n\t\tif (!MiniLocation._hasWatch()){\r\n\t\t\tLaya.timer.clear(null,MiniLocation._myLoop);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniLocation._hasWatch=function(){\r\n\t\tvar key;\r\n\t\tfor (key in MiniLocation._watchDic){\r\n\t\t\tif (MiniLocation._watchDic[key])return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tMiniLocation._myLoop=function(){\r\n\t\tMiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError);\r\n\t}\r\n\r\n\tMiniLocation._mySuccess=function(res){\r\n\t\tvar rst={};\r\n\t\trst.coords=res;\r\n\t\trst.timestamp=Browser.now();\r\n\t\tvar key;\r\n\t\tfor (key in MiniLocation._watchDic){\r\n\t\t\tif (MiniLocation._watchDic[key].success){\r\n\t\t\t\tMiniLocation._watchDic[key].success(rst);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMiniLocation._myError=function(res){\r\n\t\tvar key;\r\n\t\tfor (key in MiniLocation._watchDic){\r\n\t\t\tif (MiniLocation._watchDic[key].error){\r\n\t\t\t\tMiniLocation._watchDic[key].error(res);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMiniLocation._watchDic={};\r\n\tMiniLocation._curID=0;\r\n\treturn MiniLocation;\r\n})()\r\n\r\n\r\n//class laya.wx.mini.MiniFileMgr extends laya.events.EventDispatcher\r\nvar MiniFileMgr=(function(_super){\r\n\tfunction MiniFileMgr(){\r\n\t\tMiniFileMgr.__super.call(this);;\r\n\t}\r\n\r\n\t__class(MiniFileMgr,'laya.wx.mini.MiniFileMgr',_super);\r\n\tMiniFileMgr.isLoadFile=function(type){\r\n\t\treturn MiniFileMgr._fileTypeArr.indexOf(type)!=-1 ? true :false;\r\n\t}\r\n\r\n\tMiniFileMgr.getFileInfo=function(fileUrl){\r\n\t\tvar fileNativePath=fileUrl.split(\"?\")[0];\r\n\t\tvar fileObj=MiniFileMgr.filesListObj[fileNativePath];\r\n\t\tif (fileObj==null)\r\n\t\t\treturn null;\r\n\t\telse\r\n\t\treturn fileObj;\r\n\t\treturn null;\r\n\t}\r\n\r\n\tMiniFileMgr.onFileUpdate=function(tempFilePath,readyUrl){\r\n\t\tvar temp=tempFilePath.split(\"/\");\r\n\t\tvar tempFileName=temp[temp.length-1];\r\n\t\tvar fileObj=MiniFileMgr.getFileInfo(readyUrl);\r\n\t\tif (fileObj==null)\r\n\t\t\tMiniFileMgr.onSaveFile(readyUrl,tempFileName);\r\n\t\telse {\r\n\t\t\tif (fileObj.readyUrl !=readyUrl)\r\n\t\t\t\tMiniFileMgr.remove(tempFileName,readyUrl);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniFileMgr.exits=function(fileName,callBack){\r\n\t\tvar nativeFileName=MiniFileMgr.getFileNativePath(fileName);\r\n\t\tMiniFileMgr.fs.getFileInfo({filePath:nativeFileName,success:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([0,data]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.read=function(filePath,encoding,callBack,readyUrl){\r\n\t\t(encoding===void 0)&& (encoding=\"ascill\");\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tvar fileUrl;\r\n\t\tif(readyUrl!=\"\"){\r\n\t\t\tfileUrl=MiniFileMgr.getFileNativePath(filePath)\r\n\t\t\t}else{\r\n\t\t\tfileUrl=filePath;\r\n\t\t}\r\n\t\tMiniFileMgr.fs.readFile({filePath:fileUrl,encoding:encoding,success:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([0,data]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tif (data && readyUrl !=\"\")\r\n\t\t\t\t\tMiniFileMgr.down(readyUrl,encoding,callBack,readyUrl);\r\n\t\t\t\telse\r\n\t\t\t\tcallBack !=null && callBack.runWith([1]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.readNativeFile=function(filePath,callBack){\r\n\t\tMiniFileMgr.fs.readFile({filePath:filePath,encoding:\"\",success:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([0]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([1]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.down=function(fileUrl,encoding,callBack,readyUrl){\r\n\t\t(encoding===void 0)&& (encoding=\"ascill\");\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tvar savePath=MiniFileMgr.getFileNativePath(readyUrl);\r\n\t\tvar downloadTask=MiniFileMgr.wxdown({url:fileUrl,filePath:savePath,success:function (data){\r\n\t\t\t\tif (data.statusCode===200)\r\n\t\t\t\t\tMiniFileMgr.readFile(data.filePath,encoding,callBack,readyUrl);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t\tdownloadTask.onProgressUpdate(function(data){\r\n\t\t\tcallBack !=null && callBack.runWith([2,data.progress]);\r\n\t\t});\r\n\t}\r\n\r\n\tMiniFileMgr.readFile=function(filePath,encoding,callBack,readyUrl){\r\n\t\t(encoding===void 0)&& (encoding=\"ascill\");\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tMiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function (data){\r\n\t\t\t\tif (filePath.indexOf(\"http://\")!=-1 || filePath.indexOf(\"https://\")!=-1)\r\n\t\t\t\t\tMiniFileMgr.onFileUpdate(filePath,readyUrl);\r\n\t\t\t\tcallBack !=null && callBack.runWith([0,data]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tif (data)\r\n\t\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.downImg=function(fileUrl,callBack,readyUrl){\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tvar downloadTask=MiniFileMgr.wxdown({url:fileUrl,success:function (data){\r\n\t\t\t\tif (data.statusCode===200){\r\n\t\t\t\t\tMiniFileMgr.copyFile(data.tempFilePath,readyUrl,callBack);\r\n\t\t\t\t}\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.copyFile=function(tempFilePath,readyUrl,callBack){\r\n\t\tvar temp=tempFilePath.split(\"/\");\r\n\t\tvar tempFileName=temp[temp.length-1];\r\n\t\tvar fileurlkey=readyUrl.split(\"?\")[0];\r\n\t\tvar fileObj=MiniFileMgr.getFileInfo(readyUrl);\r\n\t\tvar saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);\r\n\t\tvar totalSize=50 *1024 *1024;\r\n\t\tvar chaSize=5 *1024 *1024;\r\n\t\tvar fileUseSize=MiniFileMgr.getCacheUseSize();\r\n\t\tif((fileUseSize+chaSize)>=totalSize)\r\n\t\t\tMiniFileMgr.onClearCacheRes(5 *1024 *1024);\r\n\t\tMiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function (data){\r\n\t\t\t\tif (!fileObj){\r\n\t\t\t\t\tMiniFileMgr.onSaveFile(readyUrl,tempFileName);\r\n\t\t\t\t\tcallBack !=null && callBack.runWith([0]);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tif (fileObj.readyUrl !=readyUrl)\r\n\t\t\t\t\t\tMiniFileMgr.remove(tempFileName,readyUrl,callBack);\r\n\t\t\t\t\telse\r\n\t\t\t\t\tcallBack !=null && callBack.runWith([0]);\r\n\t\t\t\t}\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.onClearCacheRes=function(memSize){\r\n\t\tvar clearFileSize=0;\r\n\t\tfor(var key in MiniFileMgr.filesListObj){\r\n\t\t\tvar fileObj=MiniFileMgr.filesListObj[key];\r\n\t\t\tif(key !=\"fileUsedSize\"){\r\n\t\t\t\tif(clearFileSize >=memSize)\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tvar texture=Loader.getRes(fileObj.readyUrl);\r\n\t\t\t\tif(texture && texture.bitmap.useNum==0){\r\n\t\t\t\t\tclearFileSize+=fileObj.size;\r\n\t\t\t\t\tMiniFileMgr.remove(\"\",fileObj.readyUrl);\r\n\t\t\t\t\t}else if(texture==null){\r\n\t\t\t\t\tclearFileSize+=fileObj.size;\r\n\t\t\t\t\tMiniFileMgr.remove(\"\",fileObj.readyUrl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMiniFileMgr.getFileNativePath=function(fileName){\r\n\t\treturn laya.wx.mini.MiniFileMgr.fileNativeDir+\"/\"+fileName;\r\n\t}\r\n\r\n\tMiniFileMgr.remove=function(tempFileName,readyUrl,callBack){\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tvar fileObj=MiniFileMgr.getFileInfo(readyUrl);\r\n\t\tvar deleteFileUrl=MiniFileMgr.getFileNativePath(fileObj.md5);\r\n\t\tMiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function (data){\r\n\t\t\t\tvar isAdd=tempFileName !=\"\" ? true :false;\r\n\t\t\t\tMiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd);\r\n\t\t\t\tcallBack !=null && callBack.runWith([0]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.onSaveFile=function(readyUrl,md5Name,isAdd){\r\n\t\t(isAdd===void 0)&& (isAdd=true);\r\n\t\tvar fileurlkey=readyUrl.split(\"?\")[0];\r\n\t\tif(MiniFileMgr.filesListObj['fileUsedSize']==null)\r\n\t\t\tMiniFileMgr.filesListObj['fileUsedSize']=0;\r\n\t\tif(isAdd){\r\n\t\t\tMiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl};\r\n\t\t\tvar fileNativeName=MiniFileMgr.getFileNativePath(md5Name);\r\n\t\t\tMiniFileMgr.fs.getFileInfo({\r\n\t\t\t\tfilePath:fileNativeName,\r\n\t\t\t\tsuccess:function (data){\r\n\t\t\t\t\tMiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:data.size};\r\n\t\t\t\t\tMiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])+data.size;\r\n\t\t\t\t\tMiniFileMgr.fs.writeFile({filePath:MiniFileMgr.fileNativeDir+\"/\"+MiniFileMgr.fileListName,encoding:'utf8',data:JSON.stringify(MiniFileMgr.filesListObj),success:function (data){\r\n\t\t\t\t\t\t\t},fail:function (data){\r\n\t\t\t\t\t}});\r\n\t\t\t\t},\r\n\t\t\t\tfail:function (data){\r\n\t\t\t\t\tconsole.log(\"fail\");\r\n\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t},\r\n\t\t\t\tcomplete:function (data){}\r\n\t\t\t});\r\n\t\t\t}else{\r\n\t\t\tvar fileSize=parseInt(MiniFileMgr.filesListObj[fileurlkey].size);\r\n\t\t\tMiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])-fileSize;\r\n\t\t\tdelete MiniFileMgr.filesListObj[fileurlkey];\r\n\t\t\tMiniFileMgr.fs.writeFile({filePath:MiniFileMgr.fileNativeDir+\"/\"+MiniFileMgr.fileListName,encoding:'utf8',data:JSON.stringify(MiniFileMgr.filesListObj),success:function (data){\r\n\t\t\t\t\t},fail:function (data){\r\n\t\t\t}});\r\n\t\t}\r\n\t}\r\n\r\n\tMiniFileMgr.getCacheUseSize=function(){\r\n\t\tif(MiniFileMgr.filesListObj && MiniFileMgr.filesListObj['fileUsedSize'])\r\n\t\t\treturn MiniFileMgr.filesListObj['fileUsedSize'];\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tMiniFileMgr.existDir=function(dirPath,callBack){\r\n\t\tMiniFileMgr.fs.mkdir({dirPath:dirPath,success:function (data){\r\n\t\t\t\tcallBack !=null && callBack.runWith([0,{data:JSON.stringify({})}]);\r\n\t\t\t\t},fail:function (data){\r\n\t\t\t\tif (data.errMsg.indexOf(\"file already exists\")!=-1)\r\n\t\t\t\t\tMiniFileMgr.readSync(MiniFileMgr.fileListName,\"utf8\",callBack);\r\n\t\t\t\telse\r\n\t\t\t\tcallBack !=null && callBack.runWith([1,data]);\r\n\t\t}});\r\n\t}\r\n\r\n\tMiniFileMgr.readSync=function(filePath,encoding,callBack,readyUrl){\r\n\t\t(encoding===void 0)&& (encoding=\"ascill\");\r\n\t\t(readyUrl===void 0)&& (readyUrl=\"\");\r\n\t\tvar fileUrl=MiniFileMgr.getFileNativePath(filePath);\r\n\t\tvar filesListStr\r\n\t\ttry{\r\n\t\t\tfilesListStr=MiniFileMgr.fs.readFileSync(fileUrl,encoding);\r\n\t\t\tcallBack !=null && callBack.runWith([0,{data:filesListStr}]);\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tcallBack !=null && callBack.runWith([1]);\r\n\t\t}\r\n\t}\r\n\r\n\tMiniFileMgr.setNativeFileDir=function(value){\r\n\t\tMiniFileMgr.fileNativeDir=/*__JS__ */wx.env.USER_DATA_PATH+value;\r\n\t}\r\n\r\n\tMiniFileMgr.filesListObj={};\r\n\tMiniFileMgr.fileNativeDir=null;\r\n\tMiniFileMgr.fileListName=\"layaairfiles.txt\";\r\n\tMiniFileMgr.ziyuFileData={};\r\n\t__static(MiniFileMgr,\r\n\t['_fileTypeArr',function(){return this._fileTypeArr=['json','ani','xml','sk','txt','atlas','swf','part','fnt','proto','lh','lav','lani','lmat','lm','ltc'];},'fs',function(){return this.fs=/*__JS__ */wx.getFileSystemManager();},'wxdown',function(){return this.wxdown=/*__JS__ */wx.downloadFile;}\r\n\t]);\r\n\treturn MiniFileMgr;\r\n})(EventDispatcher)\r\n\r\n\r\n//class laya.wx.mini.MiniSound extends laya.events.EventDispatcher\r\nvar MiniSound=(function(_super){\r\n\tfunction MiniSound(){\r\n\t\tthis._sound=null;\r\n\t\t/**\r\n\t\t*声音URL\r\n\t\t*/\r\n\t\tthis.url=null;\r\n\t\t/**\r\n\t\t*是否已加载完成\r\n\t\t*/\r\n\t\tthis.loaded=false;\r\n\t\tMiniSound.__super.call(this);\r\n\t\tthis._sound=MiniSound._createSound();\r\n\t}\r\n\r\n\t__class(MiniSound,'laya.wx.mini.MiniSound',_super);\r\n\tvar __proto=MiniSound.prototype;\r\n\t/**\r\n\t*加载声音。\r\n\t*@param url 地址。\r\n\t*\r\n\t*/\r\n\t__proto.load=function(url){\r\n\t\tvar _$this=this;\r\n\t\turl=URL.formatURL(url);\r\n\t\tthis.url=url;\r\n\t\tif (MiniSound._audioCache[url]){\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._sound.src=url;\r\n\t\tthis._sound.onCanplay(onCanPlay);\r\n\t\tvar me=this;\r\n\t\tfunction onCanPlay (){\r\n\t\t\t_clearSound();\r\n\t\t\tme.loaded=true;\r\n\t\t\tme.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\tMiniSound._audioCache[me.url]=me;\r\n\t\t}\r\n\t\tthis._sound.onError(onError);\r\n\t\tfunction onError (){\r\n\t\t\t_clearSound();\r\n\t\t\tme.event(/*laya.events.Event.ERROR*/\"error\");\r\n\t\t}\r\n\t\tfunction _clearSound (){\r\n\t\t\t_$this._sound.onCanplay(MiniSound.bindToThis(_$this.onCanPlayCallBack,_$this));\r\n\t\t\t_$this._sound.onError(MiniSound.bindToThis(_$this.onCanPlayCallBack,_$this));\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.onCanPlayCallBack=function(){}\r\n\t/**\r\n\t*播放声音。\r\n\t*@param startTime 开始时间,单位秒\r\n\t*@param loops 循环次数,0表示一直循环\r\n\t*@return 声道 SoundChannel 对象。\r\n\t*\r\n\t*/\r\n\t__proto.play=function(startTime,loops){\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\t(loops===void 0)&& (loops=0);\r\n\t\tvar tSound;\r\n\t\tif (this.url==SoundManager._tMusic){\r\n\t\t\tif (!MiniSound._musicAudio)MiniSound._musicAudio=MiniSound._createSound();\r\n\t\t\ttSound=MiniSound._musicAudio;\r\n\t\t\t}else {\r\n\t\t\ttSound=MiniSound._createSound();\r\n\t\t}\r\n\t\ttSound.src=this.url;\r\n\t\tvar channel=new MiniSoundChannel(tSound);\r\n\t\tchannel.url=this.url;\r\n\t\tchannel.loops=loops;\r\n\t\tchannel.startTime=startTime;\r\n\t\tchannel.play();\r\n\t\tSoundManager.addChannel(channel);\r\n\t\treturn channel;\r\n\t}\r\n\r\n\t/**\r\n\t*释放声音资源。\r\n\t*\r\n\t*/\r\n\t__proto.dispose=function(){\r\n\t\tvar ad=MiniSound._audioCache[this.url];\r\n\t\tif (ad){\r\n\t\t\tad.src=\"\";\r\n\t\t\tdelete MiniSound._audioCache[this.url];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\treturn this._sound.duration;\r\n\t});\r\n\r\n\tMiniSound._createSound=function(){\r\n\t\tMiniSound._id++;\r\n\t\treturn MiniAdpter.window.wx.createInnerAudioContext();\r\n\t}\r\n\r\n\tMiniSound.bindToThis=function(fun,scope){\r\n\t\tvar rst=fun;\r\n\t\t/*__JS__ */rst=fun.bind(scope);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tMiniSound._musicAudio=null;\r\n\tMiniSound._id=0;\r\n\tMiniSound._audioCache={};\r\n\treturn MiniSound;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*wxaudio 方式播放声音的音轨控制\r\n*/\r\n//class laya.wx.mini.MiniSoundChannel extends laya.media.SoundChannel\r\nvar MiniSoundChannel=(function(_super){\r\n\tfunction MiniSoundChannel(audio){\r\n\t\tthis._audio=null;\r\n\t\tthis._onEnd=null;\r\n\t\tMiniSoundChannel.__super.call(this);\r\n\t\tthis._audio=audio;\r\n\t\tthis._onEnd=MiniSoundChannel.bindToThis(this.__onEnd,this);\r\n\t\taudio.onEnded(this._onEnd);\r\n\t}\r\n\r\n\t__class(MiniSoundChannel,'laya.wx.mini.MiniSoundChannel',_super);\r\n\tvar __proto=MiniSoundChannel.prototype;\r\n\t__proto.__onEnd=function(){\r\n\t\tif (this.loops==1){\r\n\t\t\tif (this.completeHandler){\r\n\t\t\t\tLaya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);\r\n\t\t\t\tthis.completeHandler=null;\r\n\t\t\t}\r\n\t\t\tthis.stop();\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.loops > 0){\r\n\t\t\tthis.loops--;\r\n\t\t}\r\n\t\tthis.startTime=0;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\t/**\r\n\t*播放\r\n\t*/\r\n\t__proto.play=function(){\r\n\t\tthis.isStopped=false;\r\n\t\tSoundManager.addChannel(this);\r\n\t\tthis._audio.play();\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放\r\n\t*\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis.isStopped=true;\r\n\t\tSoundManager.removeChannel(this);\r\n\t\tthis.completeHandler=null;\r\n\t\tif (!this._audio)\r\n\t\t\treturn;\r\n\t\tthis._audio.pause();\r\n\t\tthis._audio.onStop(MiniSoundChannel.bindToThis(this.onStopEndEd,this));\r\n\t\tthis._audio.onEnded(MiniSoundChannel.bindToThis(this.onStopEndEd,this));\r\n\t\tthis._audio=null;\r\n\t}\r\n\r\n\t//xiaosong\r\n\t__proto.onStopEndEd=function(){}\r\n\t__proto.pause=function(){\r\n\t\tthis.isStopped=true;\r\n\t\tthis._audio.pause();\r\n\t}\r\n\r\n\t__proto.resume=function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn;\r\n\t\tthis.isStopped=false;\r\n\t\tSoundManager.addChannel(this);\r\n\t\tthis._audio.play();\r\n\t}\r\n\r\n\t/**\r\n\t*当前播放到的位置\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'position',function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn 0;\r\n\t\treturn this._audio.currentTime;\r\n\t});\r\n\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn 0;\r\n\t\treturn this._audio.duration;\r\n\t});\r\n\r\n\t/**\r\n\t*设置音量\r\n\t*@param v\r\n\t*\r\n\t*/\r\n\t/**\r\n\t*获取音量\r\n\t*@return\r\n\t*/\r\n\t__getset(0,__proto,'volume',function(){\r\n\t\treturn 1;\r\n\t\t},function(v){\r\n\t});\r\n\r\n\tMiniSoundChannel.bindToThis=function(fun,scope){\r\n\t\tvar rst=fun;\r\n\t\t/*__JS__ */rst=fun.bind(scope);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn MiniSoundChannel;\r\n})(SoundChannel)\r\n\r\n\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n//# sourceURL=webpack:///./bin/libs/laya.wxmini.js?");

/***/ }),

/***/ "./node_modules/exports-loader/index.js?Laya!./bin/libs/laya.core.js":
/*!******************************************************************!*\
  !*** ./node_modules/exports-loader?Laya!./bin/libs/laya.core.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;\r\n/***********************************/\r\n/*http://www.layabox.com  2017/3/23*/\r\n/***********************************/\r\nvar Laya=window.Laya=(function(window,document){\r\n\tvar Laya={\r\n\t\t__internals:[],\r\n\t\t__packages:{},\r\n\t\t__classmap:{'Object':Object,'Function':Function,'Array':Array,'String':String},\r\n\t\t__sysClass:{'object':'Object','array':'Array','string':'String','dictionary':'Dictionary'},\r\n\t\t__propun:{writable: true,enumerable: false,configurable: true},\r\n\t\t__presubstr:String.prototype.substr,\r\n\t\t__substr:function(ofs,sz){return arguments.length==1?Laya.__presubstr.call(this,ofs):Laya.__presubstr.call(this,ofs,sz>0?sz:(this.length+sz));},\r\n\t\t__init:function(_classs){_classs.forEach(function(o){o.__init$ && o.__init$();});},\r\n\t\t__isClass:function(o){return o && (o.__isclass || o==Object || o==String || o==Array);},\r\n\t\t__newvec:function(sz,value){\r\n\t\t\tvar d=[];\r\n\t\t\td.length=sz;\r\n\t\t\tfor(var i=0;i<sz;i++) d[i]=value;\r\n\t\t\treturn d;\r\n\t\t},\r\n\t\t__extend:function(d,b){\r\n\t\t\tfor (var p in b){\r\n\t\t\t\tif (!b.hasOwnProperty(p)) continue;\r\n\t\t\t\tvar gs=Object.getOwnPropertyDescriptor(b, p);\r\n\t\t\t\tvar g = gs.get, s = gs.set; \r\n\t\t\t\tif ( g || s ) {\r\n\t\t\t\t\tif ( g && s)\r\n\t\t\t\t\t\tObject.defineProperty(d,p,gs);\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tg && Object.defineProperty(d, p, g);\r\n\t\t\t\t\t\ts && Object.defineProperty(d, p, s);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse d[p] = b[p];\r\n\t\t\t}\r\n\t\t\tfunction __() { Laya.un(this,'constructor',d); }__.prototype=b.prototype;d.prototype=new __();Laya.un(d.prototype,'__imps',Laya.__copy({},b.prototype.__imps));\r\n\t\t},\r\n\t\t__copy:function(dec,src){\r\n\t\t\tif(!src) return null;\r\n\t\t\tdec=dec||{};\r\n\t\t\tfor(var i in src) dec[i]=src[i];\r\n\t\t\treturn dec;\r\n\t\t},\r\n\t\t__package:function(name,o){\r\n\t\t\tif(Laya.__packages[name]) return;\r\n\t\t\tLaya.__packages[name]=true;\r\n\t\t\tvar p=window,strs=name.split('.');\r\n\t\t\tif(strs.length>1){\r\n\t\t\t\tfor(var i=0,sz=strs.length-1;i<sz;i++){\r\n\t\t\t\t\tvar c=p[strs[i]];\r\n\t\t\t\t\tp=c?c:(p[strs[i]]={});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tp[strs[strs.length-1]] || (p[strs[strs.length-1]]=o||{});\r\n\t\t},\r\n\t\t__hasOwnProperty:function(name,o){\r\n\t\t\to=o ||this;\r\n\t\t    function classHas(name,o){\r\n\t\t\t\tif(Object.hasOwnProperty.call(o.prototype,name)) return true;\r\n\t\t\t\tvar s=o.prototype.__super;\r\n\t\t\t\treturn s==null?null:classHas(name,s);\r\n\t\t\t}\r\n\t\t\treturn (Object.hasOwnProperty.call(o,name)) || classHas(name,o.__class);\r\n\t\t},\r\n\t\t__typeof:function(o,value){\r\n\t\t\tif(!o || !value) return false;\r\n\t\t\tif(value===String) return (typeof o==='string');\r\n\t\t\tif(value===Number) return (typeof o==='number');\r\n\t\t\tif(value.__interface__) value=value.__interface__;\r\n\t\t\telse if(typeof value!='string')  return (o instanceof value);\r\n\t\t\treturn (o.__imps && o.__imps[value]) || (o.__class==value);\r\n\t\t},\r\n\t\t__as:function(value,type){\r\n\t\t\treturn (this.__typeof(value,type))?value:null;\r\n\t\t},\t\t\r\n\t\tinterface:function(name,_super){\r\n\t\t\tLaya.__package(name,{});\r\n\t\t\tvar ins=Laya.__internals;\r\n\t\t\tvar a=ins[name]=ins[name] || {self:name};\r\n\t\t\tif(_super)\r\n\t\t\t{\r\n\t\t\t\tvar supers=_super.split(',');\r\n\t\t\t\ta.extend=[];\r\n\t\t\t\tfor(var i=0;i<supers.length;i++){\r\n\t\t\t\t\tvar nm=supers[i];\r\n\t\t\t\t\tins[nm]=ins[nm] || {self:nm};\r\n\t\t\t\t\ta.extend.push(ins[nm]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar o=window,words=name.split('.');\r\n\t\t\tfor(var i=0;i<words.length-1;i++) o=o[words[i]];\r\n\t\t\to[words[words.length-1]]={__interface__:name};\r\n\t\t},\r\n\t\tclass:function(o,fullName,_super,miniName){\r\n\t\t\t_super && Laya.__extend(o,_super);\r\n\t\t\tif(fullName){\r\n\t\t\t\tLaya.__package(fullName,o);\r\n\t\t\t\tLaya.__classmap[fullName]=o;\r\n\t\t\t\tif(fullName.indexOf('.')>0){\r\n\t\t\t\t\tif(fullName.indexOf('laya.')==0){\r\n\t\t\t\t\t\tvar paths=fullName.split('.');\r\n\t\t\t\t\t\tminiName=miniName || paths[paths.length-1];\r\n\t\t\t\t\t\tif(Laya[miniName]) console.log(\"Warning!,this class[\"+miniName+\"] already exist:\",Laya[miniName]);\r\n\t\t\t\t\t\tLaya[miniName]=o;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif(fullName==\"Main\")\r\n\t\t\t\t\t\twindow.Main=o;\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tif(Laya[fullName]){\r\n\t\t\t\t\t\t\tconsole.log(\"Error!,this class[\"+fullName+\"] already exist:\",Laya[fullName]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tLaya[fullName]=o;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar un=Laya.un,p=o.prototype;\r\n\t\t\tun(p,'hasOwnProperty',Laya.__hasOwnProperty);\r\n\t\t\tun(p,'__class',o);\r\n\t\t\tun(p,'__super',_super);\r\n\t\t\tun(p,'__className',fullName);\r\n\t\t\tun(o,'__super',_super);\r\n\t\t\tun(o,'__className',fullName);\r\n\t\t\tun(o,'__isclass',true);\r\n\t\t\tun(o,'super',function(o){this.__super.call(o);});\r\n\t\t},\r\n\t\timps:function(dec,src){\r\n\t\t\tif(!src) return null;\r\n\t\t\tvar d=dec.__imps|| Laya.un(dec,'__imps',{});\r\n\t\t\tfunction __(name){\r\n\t\t\t\tvar c,exs;\r\n\t\t\t\tif(! (c=Laya.__internals[name]) ) return;\r\n\t\t\t\td[name]=true;\r\n\t\t\t\tif(!(exs=c.extend)) return;\r\n\t\t\t\tfor(var i=0;i<exs.length;i++){\r\n\t\t\t\t\t__(exs[i].self);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor(var i in src) __(i);\r\n\t\t},\r\n        superSet:function(clas,o,prop,value){\r\n            var fun = clas.prototype[\"_$set_\"+prop];\r\n            fun && fun.call(o,value);\r\n        },\r\n        superGet:function(clas,o,prop){\r\n            var fun = clas.prototype[\"_$get_\"+prop];\r\n           \treturn fun?fun.call(o):null;\r\n        },\r\n\t\tgetset:function(isStatic,o,name,getfn,setfn){\r\n\t\t\tif(!isStatic){\r\n\t\t\t\tgetfn && Laya.un(o,'_$get_'+name,getfn);\r\n\t\t\t\tsetfn && Laya.un(o,'_$set_'+name,setfn);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tgetfn && (o['_$GET_'+name]=getfn);\r\n\t\t\t\tsetfn && (o['_$SET_'+name]=setfn);\r\n\t\t\t}\r\n\t\t\tif(getfn && setfn) \r\n\t\t\t\tObject.defineProperty(o,name,{get:getfn,set:setfn,enumerable:false});\r\n\t\t\telse{\r\n\t\t\t\tgetfn && Object.defineProperty(o,name,{get:getfn,enumerable:false});\r\n\t\t\t\tsetfn && Object.defineProperty(o,name,{set:setfn,enumerable:false});\r\n\t\t\t}\r\n\t\t},\r\n\t\tstatic:function(_class,def){\r\n\t\t\t\tfor(var i=0,sz=def.length;i<sz;i+=2){\r\n\t\t\t\t\tif(def[i]=='length') \r\n\t\t\t\t\t\t_class.length=def[i+1].call(_class);\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tfunction tmp(){\r\n\t\t\t\t\t\t\tvar name=def[i];\r\n\t\t\t\t\t\t\tvar getfn=def[i+1];\r\n\t\t\t\t\t\t\tObject.defineProperty(_class,name,{\r\n\t\t\t\t\t\t\t\tget:function(){delete this[name];return this[name]=getfn.call(this);},\r\n\t\t\t\t\t\t\t\tset:function(v){delete this[name];this[name]=v;},enumerable: true,configurable: true});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttmp();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t},\t\t\r\n\t\tun:function(obj,name,value){\r\n\t\t\tvalue || (value=obj[name]);\r\n\t\t\tLaya.__propun.value=value;\r\n\t\t\tObject.defineProperty(obj, name, Laya.__propun);\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tuns:function(obj,names){\r\n\t\t\tnames.forEach(function(o){Laya.un(obj,o)});\r\n\t\t}\r\n\t};\r\n\r\n    window.console=window.console || ({log:function(){}});\r\n\twindow.trace=window.console.log;\r\n\tError.prototype.throwError=function(){throw arguments;};\r\n\t//String.prototype.substr=Laya.__substr;\r\n\tObject.defineProperty(Array.prototype,'fixed',{enumerable: false});\r\n\r\n\treturn Laya;\r\n})(window,document);\r\n\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n\r\n})(window,document,Laya);\r\n\r\n\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\nLaya.interface('laya.runtime.IMarket');\r\nLaya.interface('laya.filters.IFilter');\r\nLaya.interface('laya.display.ILayout');\r\nLaya.interface('laya.resource.IDispose');\r\nLaya.interface('laya.runtime.IPlatform');\r\nLaya.interface('laya.resource.IDestroy');\r\nLaya.interface('laya.runtime.IConchNode');\r\nLaya.interface('laya.filters.IFilterAction');\r\nLaya.interface('laya.runtime.ICPlatformClass');\r\nLaya.interface('laya.resource.ICreateResource');\r\nLaya.interface('laya.runtime.IConchRenderObject');\r\nLaya.interface('laya.runtime.IPlatformClass','laya.runtime.IPlatform');\r\n/**\r\n*@private\r\n*/\r\n//class laya.utils.RunDriver\r\nvar RunDriver=(function(){\r\n\tfunction RunDriver(){}\r\n\t__class(RunDriver,'laya.utils.RunDriver');\r\n\tRunDriver.FILTER_ACTIONS=[];\r\n\tRunDriver.pixelRatio=-1;\r\n\tRunDriver._charSizeTestDiv=null;\r\n\tRunDriver.now=function(){\r\n\t\treturn /*__JS__ */Date.now();\r\n\t}\r\n\r\n\tRunDriver.getWindow=function(){\r\n\t\treturn /*__JS__ */window;\r\n\t}\r\n\r\n\tRunDriver.getPixelRatio=function(){\r\n\t\tif (RunDriver.pixelRatio < 0){\r\n\t\t\tvar ctx=Browser.context;\r\n\t\t\tvar backingStore=ctx.backingStorePixelRatio || ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || ctx.backingStorePixelRatio || 1;\r\n\t\t\tRunDriver.pixelRatio=(Browser.window.devicePixelRatio || 1)/ backingStore;\r\n\t\t\tif (RunDriver.pixelRatio < 1)RunDriver.pixelRatio=1;\r\n\t\t}\r\n\t\treturn RunDriver.pixelRatio;\r\n\t}\r\n\r\n\tRunDriver.getIncludeStr=function(name){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tRunDriver.createShaderCondition=function(conditionScript){\r\n\t\tvar fn=\"(function() {return \"+conditionScript+\";})\";\r\n\t\treturn Browser.window.eval(fn);\r\n\t}\r\n\r\n\tRunDriver.fontMap=[];\r\n\tRunDriver.measureText=function(txt,font){\r\n\t\tvar isChinese=RunDriver.hanzi.test(txt);\r\n\t\tif (isChinese && RunDriver.fontMap[font]){\r\n\t\t\treturn RunDriver.fontMap[font];\r\n\t\t};\r\n\t\tvar ctx=Browser.context;\r\n\t\tctx.font=font;\r\n\t\tvar r=ctx.measureText(txt);\r\n\t\tif (isChinese)RunDriver.fontMap[font]=r;\r\n\t\treturn r;\r\n\t}\r\n\r\n\tRunDriver.getWebGLContext=function(canvas){\r\n\t};\r\n\r\n\tRunDriver.beginFlush=function(){\r\n\t};\r\n\r\n\tRunDriver.endFinish=function(){\r\n\t};\r\n\r\n\tRunDriver.addToAtlas=null;\r\n\tRunDriver.flashFlushImage=function(atlasWebGLCanvas){\r\n\t};\r\n\r\n\tRunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){\r\n\t\tvar canvas=HTMLCanvas.create(\"2D\");\r\n\t\tvar context=new RenderContext(canvasWidth,canvasHeight,canvas);\r\n\t\tRenderSprite.renders[_renderType]._fun(sprite,context,offsetX,offsetY);\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\tRunDriver.createParticleTemplate2D=null;\r\n\tRunDriver.createGLTextur=null;\r\n\tRunDriver.createWebGLContext2D=null;\r\n\tRunDriver.changeWebGLSize=function(w,h){\r\n\t};\r\n\r\n\tRunDriver.createRenderSprite=function(type,next){\r\n\t\treturn new RenderSprite(type,next);\r\n\t}\r\n\r\n\tRunDriver.createFilterAction=function(type){\r\n\t\treturn new ColorFilterAction();\r\n\t}\r\n\r\n\tRunDriver.createGraphics=function(){\r\n\t\treturn new Graphics();\r\n\t}\r\n\r\n\tRunDriver.clear=function(value){\r\n\t\tRender._context.ctx.clear();\r\n\t}\r\n\r\n\tRunDriver.clearAtlas=function(value){\r\n\t};\r\n\r\n\tRunDriver.isAtlas=function(bitmap){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tRunDriver.addTextureToAtlas=function(value){\r\n\t};\r\n\r\n\tRunDriver.getTexturePixels=function(value,x,y,width,height){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tRunDriver.skinAniSprite=function(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\tRunDriver.update3DLoop=function(){\r\n\t};\r\n\r\n\t__static(RunDriver,\r\n\t['hanzi',function(){return this.hanzi=new RegExp(\"^[\\u4E00-\\u9FA5]$\");}\r\n\t]);\r\n\treturn RunDriver;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Laya</code> 是全局对象的引用入口集。\r\n*Laya类引用了一些常用的全局对象，比如Laya.stage：舞台，Laya.timer：时间管理器，Laya.loader：加载管理器，使用时注意大小写。\r\n*/\r\n//class Laya\r\nvar ___Laya=(function(){\r\n\t//function Laya(){}\r\n\t/**\r\n\t*表示是否捕获全局错误并弹出提示。默认为false。\r\n\t*适用于移动设备等不方便调试的时候，设置为true后，如有未知错误，可以弹窗抛出详细错误堆栈。\r\n\t*/\r\n\t__getset(1,Laya,'alertGlobalError',null,function(value){\r\n\t\tvar erralert=0;\r\n\t\tif (value){\r\n\t\t\tBrowser.window.onerror=function (msg,url,line,column,detail){\r\n\t\t\t\tif (erralert++< 5 && detail)\r\n\t\t\t\t\talert(\"出错啦，请把此信息截图给研发商\\n\"+msg+\"\\n\"+detail.stack||detail);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tBrowser.window.onerror=null;\r\n\t\t}\r\n\t});\r\n\r\n\tLaya.init=function(width,height,__plugins){\r\n\t\tvar plugins=[];for(var i=2,sz=arguments.length;i<sz;i++)plugins.push(arguments[i]);\r\n\t\tif (Laya._isinit)return;\r\n\t\tArrayBuffer.prototype.slice || (ArrayBuffer.prototype.slice=Laya._arrayBufferSlice);\r\n\t\tLaya._isinit=true;\r\n\t\tBrowser.__init__();\r\n\t\tContext.__init__();\r\n\t\tGraphics.__init__();\r\n\t\tLaya.timer=new Timer();\r\n\t\tLaya.scaleTimer=new Timer();\r\n\t\tLaya.loader=new LoaderManager();\r\n\t\tWeakObject.__init__();\r\n\t\tfor (var i=0,n=plugins.length;i < n;i++){\r\n\t\t\tif (plugins[i].enable)plugins[i].enable();\r\n\t\t}\r\n\t\tFont.__init__();\r\n\t\tStyle.__init__();\r\n\t\tResourceManager.__init__();\r\n\t\tCacheManager.beginCheck();\r\n\t\tLaya._currentStage=Laya.stage=new Stage();\r\n\t\tLaya.stage.conchModel && Laya.stage.conchModel.setRootNode();\r\n\t\tLaya.getUrlPath();\r\n\t\tLaya.render=new Render(0,0);\r\n\t\tLaya.stage.size(width,height);\r\n\t\tRenderSprite.__init__();\r\n\t\tKeyBoardManager.__init__();\r\n\t\tMouseManager.instance.__init__(Laya.stage,Render.canvas);\r\n\t\tInput.__init__();\r\n\t\tSoundManager.autoStopMusic=true;\r\n\t\tLocalStorage.__init__();\r\n\t\treturn Render.canvas;\r\n\t}\r\n\r\n\tLaya.getUrlPath=function(){\r\n\t\tvar location=Browser.window.location;\r\n\t\tvar pathName=location.pathname;\r\n\t\tpathName=pathName.charAt(2)==':' ? pathName.substring(1):pathName;\r\n\t\tURL.rootPath=URL.basePath=URL.getPath(location.protocol==\"file:\" ? pathName :location.protocol+\"//\"+location.host+location.pathname);\r\n\t}\r\n\r\n\tLaya._arrayBufferSlice=function(start,end){\r\n\t\tvar arr=/*__JS__ */this;\r\n\t\tvar arrU8List=new Uint8Array(arr,start,end-start);\r\n\t\tvar newU8List=new Uint8Array(arrU8List.length);\r\n\t\tnewU8List.set(arrU8List);\r\n\t\treturn newU8List.buffer;\r\n\t}\r\n\r\n\tLaya.stage=null;\r\n\tLaya.timer=null;\r\n\tLaya.scaleTimer=null;\r\n\tLaya.loader=null;\r\n\tLaya.version=\"1.7.16\";\r\n\tLaya.render=null;\r\n\tLaya._currentStage=null;\r\n\tLaya._isinit=false;\r\n\t__static(Laya,\r\n\t['conchMarket',function(){return this.conchMarket=/*__JS__ */window.conch?conchMarket:null;},'PlatformClass',function(){return this.PlatformClass=/*__JS__ */window.PlatformClass;},'MiniAdpter',function(){return this.MiniAdpter=/*__JS__ */{init:function(){if (window.navigator && window.navigator.userAgent && window.navigator.userAgent.indexOf(\"MiniGame\")>-1)console.error(\"请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0\")}};}\r\n\t]);\r\n\treturn Laya;\r\n})()\r\n\r\n\r\n/**\r\n*Config 用于配置一些全局参数。如需更改，请在初始化引擎之前设置。\r\n*/\r\n//class Config\r\nvar Config=(function(){\r\n\tfunction Config(){}\r\n\t__class(Config,'Config');\r\n\tConfig.WebGLTextCacheCount=500;\r\n\tConfig.atlasEnable=false;\r\n\tConfig.showCanvasMark=false;\r\n\tConfig.animationInterval=50;\r\n\tConfig.isAntialias=false;\r\n\tConfig.isAlpha=false;\r\n\tConfig.premultipliedAlpha=true;\r\n\tConfig.isStencil=true;\r\n\tConfig.preserveDrawingBuffer=false;\r\n\treturn Config;\r\n})()\r\n\r\n\r\n/**\r\n*<code>EventDispatcher</code> 类是可调度事件的所有类的基类。\r\n*/\r\n//class laya.events.EventDispatcher\r\nvar EventDispatcher=(function(){\r\n\tvar EventHandler;\r\n\tfunction EventDispatcher(){\r\n\t\t/**@private */\r\n\t\tthis._events=null;\r\n\t}\r\n\r\n\t__class(EventDispatcher,'laya.events.EventDispatcher');\r\n\tvar __proto=EventDispatcher.prototype;\r\n\t/**\r\n\t*检查 EventDispatcher 对象是否为特定事件类型注册了任何侦听器。\r\n\t*@param type 事件的类型。\r\n\t*@return 如果指定类型的侦听器已注册，则值为 true；否则，值为 false。\r\n\t*/\r\n\t__proto.hasListener=function(type){\r\n\t\tvar listener=this._events && this._events[type];\r\n\t\treturn !!listener;\r\n\t}\r\n\r\n\t/**\r\n\t*派发事件。\r\n\t*@param type 事件类型。\r\n\t*@param data （可选）回调数据。<b>注意：</b>如果是需要传递多个参数 p1,p2,p3,...可以使用数组结构如：[p1,p2,p3,...] ；如果需要回调单个参数 p ，且 p 是一个数组，则需要使用结构如：[p]，其他的单个参数 p ，可以直接传入参数 p。\r\n\t*@return 此事件类型是否有侦听者，如果有侦听者则值为 true，否则值为 false。\r\n\t*/\r\n\t__proto.event=function(type,data){\r\n\t\tif (!this._events || !this._events[type])return false;\r\n\t\tvar listeners=this._events[type];\r\n\t\tif (listeners.run){\r\n\t\t\tif (listeners.once)delete this._events[type];\r\n\t\t\tdata !=null ? listeners.runWith(data):listeners.run();\r\n\t\t\t}else {\r\n\t\t\tfor (var i=0,n=listeners.length;i < n;i++){\r\n\t\t\t\tvar listener=listeners[i];\r\n\t\t\t\tif (listener){\r\n\t\t\t\t\t(data !=null)? listener.runWith(data):listener.run();\r\n\t\t\t\t}\r\n\t\t\t\tif (!listener || listener.once){\r\n\t\t\t\t\tlisteners.splice(i,1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t\tn--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (listeners.length===0 && this._events)delete this._events[type];\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t*使用 EventDispatcher 对象注册指定类型的事件侦听器对象，以使侦听器能够接收事件通知。\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.on=function(type,caller,listener,args){\r\n\t\treturn this._createListener(type,caller,listener,args,false);\r\n\t}\r\n\r\n\t/**\r\n\t*使用 EventDispatcher 对象注册指定类型的事件侦听器对象，以使侦听器能够接收事件通知，此侦听事件响应一次后自动移除。\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.once=function(type,caller,listener,args){\r\n\t\treturn this._createListener(type,caller,listener,args,true);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._createListener=function(type,caller,listener,args,once,offBefore){\r\n\t\t(offBefore===void 0)&& (offBefore=true);\r\n\t\toffBefore && this.off(type,caller,listener,once);\r\n\t\tvar handler=EventHandler.create(caller || this,listener,args,once);\r\n\t\tthis._events || (this._events={});\r\n\t\tvar events=this._events;\r\n\t\tif (!events[type])events[type]=handler;\r\n\t\telse {\r\n\t\t\tif (!events[type].run)events[type].push(handler);\r\n\t\t\telse events[type]=[events[type],handler];\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*从 EventDispatcher 对象中删除侦听器。\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param onceOnly （可选）如果值为 true ,则只移除通过 once 方法添加的侦听器。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.off=function(type,caller,listener,onceOnly){\r\n\t\t(onceOnly===void 0)&& (onceOnly=false);\r\n\t\tif (!this._events || !this._events[type])return this;\r\n\t\tvar listeners=this._events[type];\r\n\t\tif (listener !=null){\r\n\t\t\tif (listeners.run){\r\n\t\t\t\tif ((!caller || listeners.caller===caller)&& listeners.method===listener && (!onceOnly || listeners.once)){\r\n\t\t\t\t\tdelete this._events[type];\r\n\t\t\t\t\tlisteners.recover();\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tvar count=0;\r\n\t\t\t\tfor (var i=0,n=listeners.length;i < n;i++){\r\n\t\t\t\t\tvar item=listeners[i];\r\n\t\t\t\t\tif (item && (!caller || item.caller===caller)&& item.method===listener && (!onceOnly || item.once)){\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\tlisteners[i]=null;\r\n\t\t\t\t\t\titem.recover();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (count===n)delete this._events[type];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*从 EventDispatcher 对象中删除指定事件类型的所有侦听器。\r\n\t*@param type （可选）事件类型，如果值为 null，则移除本对象所有类型的侦听器。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.offAll=function(type){\r\n\t\tvar events=this._events;\r\n\t\tif (!events)return this;\r\n\t\tif (type){\r\n\t\t\tthis._recoverHandlers(events[type]);\r\n\t\t\tdelete events[type];\r\n\t\t\t}else {\r\n\t\t\tfor (var name in events){\r\n\t\t\t\tthis._recoverHandlers(events[name]);\r\n\t\t\t}\r\n\t\t\tthis._events=null;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto._recoverHandlers=function(arr){\r\n\t\tif (!arr)return;\r\n\t\tif (arr.run){\r\n\t\t\tarr.recover();\r\n\t\t\t}else {\r\n\t\t\tfor (var i=arr.length-1;i >-1;i--){\r\n\t\t\t\tif (arr[i]){\r\n\t\t\t\t\tarr[i].recover();\r\n\t\t\t\t\tarr[i]=null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*检测指定事件类型是否是鼠标事件。\r\n\t*@param type 事件的类型。\r\n\t*@return 如果是鼠标事件，则值为 true;否则，值为 false。\r\n\t*/\r\n\t__proto.isMouseEvent=function(type){\r\n\t\treturn EventDispatcher.MOUSE_EVENTS[type];\r\n\t}\r\n\r\n\t__static(EventDispatcher,\r\n\t['MOUSE_EVENTS',function(){return this.MOUSE_EVENTS={\"rightmousedown\":true,\"rightmouseup\":true,\"rightclick\":true,\"mousedown\":true,\"mouseup\":true,\"mousemove\":true,\"mouseover\":true,\"mouseout\":true,\"click\":true,\"doubleclick\":true};}\r\n\t]);\r\n\tEventDispatcher.__init$=function(){\r\n\t\tObject.defineProperty(laya.events.EventDispatcher.prototype,\"_events\",{enumerable:false,writable:true});\r\n\t\t/**@private */\r\n\t\t//class EventHandler extends laya.utils.Handler\r\n\t\tEventHandler=(function(_super){\r\n\t\t\tfunction EventHandler(caller,method,args,once){\r\n\t\t\t\tEventHandler.__super.call(this,caller,method,args,once);\r\n\t\t\t}\r\n\t\t\t__class(EventHandler,'',_super);\r\n\t\t\tvar __proto=EventHandler.prototype;\r\n\t\t\t__proto.recover=function(){\r\n\t\t\t\tif (this._id > 0){\r\n\t\t\t\t\tthis._id=0;\r\n\t\t\t\t\tEventHandler._pool.push(this.clear());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tEventHandler.create=function(caller,method,args,once){\r\n\t\t\t\t(once===void 0)&& (once=true);\r\n\t\t\t\tif (EventHandler._pool.length)return EventHandler._pool.pop().setTo(caller,method,args,once);\r\n\t\t\t\treturn new EventHandler(caller,method,args,once);\r\n\t\t\t}\r\n\t\t\tEventHandler._pool=[];\r\n\t\t\treturn EventHandler;\r\n\t\t})(Handler)\r\n\t}\r\n\r\n\treturn EventDispatcher;\r\n})()\r\n\r\n\r\n/**\r\n*<p><code>Handler</code> 是事件处理器类。</p>\r\n*<p>推荐使用 Handler.create()方法从对象池创建，减少对象创建消耗。创建的 Handler 对象不再使用后，可以使用 Handler.recover()将其回收到对象池，回收后不要再使用此对象，否则会导致不可预料的错误。</p>\r\n*<p><b>注意：</b>由于鼠标事件也用本对象池，不正确的回收及调用，可能会影响鼠标事件的执行。</p>\r\n*/\r\n//class laya.utils.Handler\r\nvar Handler=(function(){\r\n\tfunction Handler(caller,method,args,once){\r\n\t\t/**执行域(this)。*/\r\n\t\t//this.caller=null;\r\n\t\t/**处理方法。*/\r\n\t\t//this.method=null;\r\n\t\t/**参数。*/\r\n\t\t//this.args=null;\r\n\t\t/**表示是否只执行一次。如果为true，回调后执行recover()进行回收，回收后会被再利用，默认为false 。*/\r\n\t\tthis.once=false;\r\n\t\t/**@private */\r\n\t\tthis._id=0;\r\n\t\t(once===void 0)&& (once=false);\r\n\t\tthis.setTo(caller,method,args,once);\r\n\t}\r\n\r\n\t__class(Handler,'laya.utils.Handler');\r\n\tvar __proto=Handler.prototype;\r\n\t/**\r\n\t*设置此对象的指定属性值。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 回调方法。\r\n\t*@param args 携带的参数。\r\n\t*@param once 是否只执行一次，如果为true，执行后执行recover()进行回收。\r\n\t*@return 返回 handler 本身。\r\n\t*/\r\n\t__proto.setTo=function(caller,method,args,once){\r\n\t\tthis._id=Handler._gid++;\r\n\t\tthis.caller=caller;\r\n\t\tthis.method=method;\r\n\t\tthis.args=args;\r\n\t\tthis.once=once;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*执行处理器。\r\n\t*/\r\n\t__proto.run=function(){\r\n\t\tif (this.method==null)return null;\r\n\t\tvar id=this._id;\r\n\t\tvar result=this.method.apply(this.caller,this.args);\r\n\t\tthis._id===id && this.once && this.recover();\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t*执行处理器，携带额外数据。\r\n\t*@param data 附加的回调数据，可以是单数据或者Array(作为多参)。\r\n\t*/\r\n\t__proto.runWith=function(data){\r\n\t\tif (this.method==null)return null;\r\n\t\tvar id=this._id;\r\n\t\tif (data==null)\r\n\t\t\tvar result=this.method.apply(this.caller,this.args);\r\n\t\telse if (!this.args && !data.unshift)result=this.method.call(this.caller,data);\r\n\t\telse if (this.args)result=this.method.apply(this.caller,this.args.concat(data));\r\n\t\telse result=this.method.apply(this.caller,data);\r\n\t\tthis._id===id && this.once && this.recover();\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t*清理对象引用。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis.caller=null;\r\n\t\tthis.method=null;\r\n\t\tthis.args=null;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*清理并回收到 Handler 对象池内。\r\n\t*/\r\n\t__proto.recover=function(){\r\n\t\tif (this._id > 0){\r\n\t\t\tthis._id=0;\r\n\t\t\tHandler._pool.push(this.clear());\r\n\t\t}\r\n\t}\r\n\r\n\tHandler.create=function(caller,method,args,once){\r\n\t\t(once===void 0)&& (once=true);\r\n\t\tif (Handler._pool.length)return Handler._pool.pop().setTo(caller,method,args,once);\r\n\t\treturn new Handler(caller,method,args,once);\r\n\t}\r\n\r\n\tHandler._pool=[];\r\n\tHandler._gid=1;\r\n\treturn Handler;\r\n})()\r\n\r\n\r\n/**\r\n*<code>BitmapFont</code> 是位图字体类，用于定义位图字体信息。\r\n*/\r\n//class laya.display.BitmapFont\r\nvar BitmapFont=(function(){\r\n\tfunction BitmapFont(){\r\n\t\tthis._texture=null;\r\n\t\tthis._fontCharDic={};\r\n\t\tthis._fontWidthMap={};\r\n\t\tthis._complete=null;\r\n\t\tthis._path=null;\r\n\t\tthis._maxWidth=0;\r\n\t\tthis._spaceWidth=10;\r\n\t\tthis._padding=null;\r\n\t\t/**当前位图字体字号。*/\r\n\t\tthis.fontSize=12;\r\n\t\t/**表示是否根据实际使用的字体大小缩放位图字体大小。*/\r\n\t\tthis.autoScaleSize=false;\r\n\t\t/**字符间距（以像素为单位）。*/\r\n\t\tthis.letterSpacing=0;\r\n\t}\r\n\r\n\t__class(BitmapFont,'laya.display.BitmapFont');\r\n\tvar __proto=BitmapFont.prototype;\r\n\t/**\r\n\t*通过指定位图字体文件路径，加载位图字体文件，加载完成后会自动解析。\r\n\t*@param path 位图字体文件的路径。\r\n\t*@param complete 加载并解析完成的回调。如果成功返回this,如果失败返回null\r\n\t*/\r\n\t__proto.loadFont=function(path,complete){\r\n\t\tthis._path=path;\r\n\t\tthis._complete=complete;\r\n\t\tLaya.loader.load([{url:this._path,type:/*laya.net.Loader.XML*/\"xml\"},{url:this._path.replace(\".fnt\",\".png\"),type:/*laya.net.Loader.IMAGE*/\"image\"}],Handler.create(this,this.onLoaded));\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.onLoaded=function(){\r\n\t\tthis.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(\".fnt\",\".png\")));\r\n\t\tthis._complete && this._complete.runWith(this._texture?this:null);\r\n\t}\r\n\r\n\t/**\r\n\t*解析字体文件。\r\n\t*@param xml 字体文件XML。\r\n\t*@param texture 字体的纹理。\r\n\t*/\r\n\t__proto.parseFont=function(xml,texture){\r\n\t\tif (xml==null || texture==null)return;\r\n\t\tthis._texture=texture;\r\n\t\tvar tX=0;\r\n\t\tvar tScale=1;\r\n\t\tvar tInfo=xml.getElementsByTagName(\"info\");\r\n\t\tif (!tInfo[0].getAttributeNode){\r\n\t\t\treturn this.parseFont2(xml,texture);\r\n\t\t}\r\n\t\tthis.fontSize=parseInt(tInfo[0].getAttributeNode(\"size\").nodeValue);\r\n\t\tvar tPadding=tInfo[0].getAttributeNode(\"padding\").nodeValue;\r\n\t\tvar tPaddingArray=tPadding.split(\",\");\r\n\t\tthis._padding=[parseInt(tPaddingArray[0]),parseInt(tPaddingArray[1]),parseInt(tPaddingArray[2]),parseInt(tPaddingArray[3])];\r\n\t\tvar chars;\r\n\t\tchars=xml.getElementsByTagName(\"char\");\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < chars.length;i++){\r\n\t\t\tvar tAttribute=chars[i];\r\n\t\t\tvar tId=parseInt(tAttribute.getAttributeNode(\"id\").nodeValue);\r\n\t\t\tvar xOffset=parseInt(tAttribute.getAttributeNode(\"xoffset\").nodeValue)/ tScale;\r\n\t\t\tvar yOffset=parseInt(tAttribute.getAttributeNode(\"yoffset\").nodeValue)/ tScale;\r\n\t\t\tvar xAdvance=parseInt(tAttribute.getAttributeNode(\"xadvance\").nodeValue)/ tScale;\r\n\t\t\tvar region=new Rectangle();\r\n\t\t\tregion.x=parseInt(tAttribute.getAttributeNode(\"x\").nodeValue);\r\n\t\t\tregion.y=parseInt(tAttribute.getAttributeNode(\"y\").nodeValue);\r\n\t\t\tregion.width=parseInt(tAttribute.getAttributeNode(\"width\").nodeValue);\r\n\t\t\tregion.height=parseInt(tAttribute.getAttributeNode(\"height\").nodeValue);\r\n\t\t\tvar tTexture=Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset);\r\n\t\t\tthis._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing);\r\n\t\t\tthis._fontCharDic[tId]=tTexture;\r\n\t\t\tthis._fontWidthMap[tId]=xAdvance;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*解析字体文件。\r\n\t*@param xml 字体文件XML。\r\n\t*@param texture 字体的纹理。\r\n\t*/\r\n\t__proto.parseFont2=function(xml,texture){\r\n\t\tif (xml==null || texture==null)return;\r\n\t\tthis._texture=texture;\r\n\t\tvar tX=0;\r\n\t\tvar tScale=1;\r\n\t\tvar tInfo=xml.getElementsByTagName(\"info\");\r\n\t\tthis.fontSize=parseInt(tInfo[0].attributes[\"size\"].nodeValue);\r\n\t\tvar tPadding=tInfo[0].attributes[\"padding\"].nodeValue;\r\n\t\tvar tPaddingArray=tPadding.split(\",\");\r\n\t\tthis._padding=[parseInt(tPaddingArray[0]),parseInt(tPaddingArray[1]),parseInt(tPaddingArray[2]),parseInt(tPaddingArray[3])];\r\n\t\tvar chars=xml.getElementsByTagName(\"char\");\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < chars.length;i++){\r\n\t\t\tvar tAttribute=chars[i].attributes;\r\n\t\t\tvar tId=parseInt(tAttribute[\"id\"].nodeValue);\r\n\t\t\tvar xOffset=parseInt(tAttribute[\"xoffset\"].nodeValue)/ tScale;\r\n\t\t\tvar yOffset=parseInt(tAttribute[\"yoffset\"].nodeValue)/ tScale;\r\n\t\t\tvar xAdvance=parseInt(tAttribute[\"xadvance\"].nodeValue)/ tScale;\r\n\t\t\tvar region=new Rectangle();\r\n\t\t\tregion.x=parseInt(tAttribute[\"x\"].nodeValue);\r\n\t\t\tregion.y=parseInt(tAttribute[\"y\"].nodeValue);\r\n\t\t\tregion.width=parseInt(tAttribute[\"width\"].nodeValue);\r\n\t\t\tregion.height=parseInt(tAttribute[\"height\"].nodeValue);\r\n\t\t\tvar tTexture=Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset);\r\n\t\t\tthis._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing);\r\n\t\t\tthis._fontCharDic[tId]=tTexture;\r\n\t\t\tthis._fontWidthMap[tId]=xAdvance;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定字符的字体纹理对象。\r\n\t*@param char 字符。\r\n\t*@return 指定的字体纹理对象。\r\n\t*/\r\n\t__proto.getCharTexture=function(char){\r\n\t\treturn this._fontCharDic[char.charCodeAt(0)];\r\n\t}\r\n\r\n\t/**\r\n\t*销毁位图字体，调用Text.unregisterBitmapFont 时，默认会销毁。\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tif (this._texture){\r\n\t\t\tfor (var p in this._fontCharDic){\r\n\t\t\t\tvar tTexture=this._fontCharDic[p];\r\n\t\t\t\tif (tTexture)tTexture.destroy();\r\n\t\t\t}\r\n\t\t\tthis._texture.destroy();\r\n\t\t\tthis._fontCharDic=null;\r\n\t\t\tthis._fontWidthMap=null;\r\n\t\t\tthis._texture=null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置空格的宽（如果字体库有空格，这里就可以不用设置了）。\r\n\t*@param spaceWidth 宽度，单位为像素。\r\n\t*/\r\n\t__proto.setSpaceWidth=function(spaceWidth){\r\n\t\tthis._spaceWidth=spaceWidth;\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定字符的宽度。\r\n\t*@param char 字符。\r\n\t*@return 宽度。\r\n\t*/\r\n\t__proto.getCharWidth=function(char){\r\n\t\tvar code=char.charCodeAt(0);\r\n\t\tif (this._fontWidthMap[code])return this._fontWidthMap[code]+this.letterSpacing;\r\n\t\tif (char==\" \")return this._spaceWidth+this.letterSpacing;\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定文本内容的宽度。\r\n\t*@param text 文本内容。\r\n\t*@return 宽度。\r\n\t*/\r\n\t__proto.getTextWidth=function(text){\r\n\t\tvar tWidth=0;\r\n\t\tfor (var i=0,n=text.length;i < n;i++){\r\n\t\t\ttWidth+=this.getCharWidth(text.charAt(i));\r\n\t\t}\r\n\t\treturn tWidth;\r\n\t}\r\n\r\n\t/**\r\n\t*获取最大字符宽度。\r\n\t*/\r\n\t__proto.getMaxWidth=function(){\r\n\t\treturn this._maxWidth;\r\n\t}\r\n\r\n\t/**\r\n\t*获取最大字符高度。\r\n\t*/\r\n\t__proto.getMaxHeight=function(){\r\n\t\treturn this.fontSize;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*将指定的文本绘制到指定的显示对象上。\r\n\t*/\r\n\t__proto.drawText=function(text,sprite,drawX,drawY,align,width){\r\n\t\tvar tWidth=this.getTextWidth(text);\r\n\t\tvar tTexture;\r\n\t\tvar dx=0;\r\n\t\talign===\"center\" && (dx=(width-tWidth)/ 2);\r\n\t\talign===\"right\" && (dx=(width-tWidth));\r\n\t\tvar tX=0;\r\n\t\tfor (var i=0,n=text.length;i < n;i++){\r\n\t\t\ttTexture=this.getCharTexture(text.charAt(i));\r\n\t\t\tif (tTexture){\r\n\t\t\t\tsprite.graphics.drawTexture(tTexture,drawX+tX+dx,drawY);\r\n\t\t\t\ttX+=this.getCharWidth(text.charAt(i));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn BitmapFont;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Style</code> 类是元素样式定义类。\r\n*/\r\n//class laya.display.css.Style\r\nvar Style=(function(){\r\n\tfunction Style(){\r\n\t\t/**透明度。*/\r\n\t\tthis.alpha=1;\r\n\t\t/**表示是否显示。*/\r\n\t\tthis.visible=true;\r\n\t\t/**表示滚动区域。*/\r\n\t\tthis.scrollRect=null;\r\n\t\t/**混合模式。*/\r\n\t\tthis.blendMode=null;\r\n\t\t/**@private */\r\n\t\tthis._type=0;\r\n\t\tthis._tf=Style._TF_EMPTY;\r\n\t}\r\n\r\n\t__class(Style,'laya.display.css.Style');\r\n\tvar __proto=Style.prototype;\r\n\t__proto.getTransform=function(){\r\n\t\treturn this._tf;\r\n\t}\r\n\r\n\t__proto.setTransform=function(value){\r\n\t\tthis._tf=value==='none' || !value ? Style._TF_EMPTY :value;\r\n\t}\r\n\r\n\t__proto.setTranslateX=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.translateX=value;\r\n\t}\r\n\r\n\t__proto.setTranslateY=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.translateY=value;\r\n\t}\r\n\r\n\t__proto.setScaleX=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.scaleX=value;\r\n\t}\r\n\r\n\t__proto.setScale=function(x,y){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.scaleX=x;\r\n\t\tthis._tf.scaleY=y;\r\n\t}\r\n\r\n\t__proto.setScaleY=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.scaleY=value;\r\n\t}\r\n\r\n\t__proto.setRotate=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.rotate=value;\r\n\t}\r\n\r\n\t__proto.setSkewX=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.skewX=value;\r\n\t}\r\n\r\n\t__proto.setSkewY=function(value){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.skewY=value;\r\n\t}\r\n\r\n\t/**销毁此对象。*/\r\n\t__proto.destroy=function(){\r\n\t\tthis.scrollRect=null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.render=function(sprite,context,x,y){}\r\n\t/**@private */\r\n\t__proto.getCSSStyle=function(){\r\n\t\treturn CSSStyle.EMPTY;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._enableLayout=function(){\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**X 轴缩放值。*/\r\n\t__getset(0,__proto,'scaleX',function(){\r\n\t\treturn this._tf.scaleX;\r\n\t\t},function(value){\r\n\t\tthis.setScaleX(value);\r\n\t});\r\n\r\n\t/**元素应用的 2D 或 3D 转换的值。该属性允许我们对元素进行旋转、缩放、移动或倾斜。*/\r\n\t__getset(0,__proto,'transform',function(){\r\n\t\treturn this.getTransform();\r\n\t\t},function(value){\r\n\t\tthis.setTransform(value);\r\n\t});\r\n\r\n\t/**定义转换，只是用 X 轴的值。*/\r\n\t__getset(0,__proto,'translateX',function(){\r\n\t\treturn this._tf.translateX;\r\n\t\t},function(value){\r\n\t\tthis.setTranslateX(value);\r\n\t});\r\n\r\n\t/**定义转换，只是用 Y 轴的值。*/\r\n\t__getset(0,__proto,'translateY',function(){\r\n\t\treturn this._tf.translateY;\r\n\t\t},function(value){\r\n\t\tthis.setTranslateY(value);\r\n\t});\r\n\r\n\t/**Y 轴缩放值。*/\r\n\t__getset(0,__proto,'scaleY',function(){\r\n\t\treturn this._tf.scaleY;\r\n\t\t},function(value){\r\n\t\tthis.setScaleY(value);\r\n\t});\r\n\r\n\t/**表示元素是否显示为块级元素。*/\r\n\t__getset(0,__proto,'block',function(){\r\n\t\treturn (this._type & 0x1)!=0;\r\n\t});\r\n\r\n\t/**定义沿着 Y 轴的 2D 倾斜转换。*/\r\n\t__getset(0,__proto,'skewY',function(){\r\n\t\treturn this._tf.skewY;\r\n\t\t},function(value){\r\n\t\tthis.setSkewY(value);\r\n\t});\r\n\r\n\t/**定义旋转角度。*/\r\n\t__getset(0,__proto,'rotate',function(){\r\n\t\treturn this._tf.rotate;\r\n\t\t},function(value){\r\n\t\tthis.setRotate(value);\r\n\t});\r\n\r\n\t/**定义沿着 X 轴的 2D 倾斜转换。*/\r\n\t__getset(0,__proto,'skewX',function(){\r\n\t\treturn this._tf.skewX;\r\n\t\t},function(value){\r\n\t\tthis.setSkewX(value);\r\n\t});\r\n\r\n\t/**表示元素的左内边距。*/\r\n\t__getset(0,__proto,'paddingLeft',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\t/**表示元素的上内边距。*/\r\n\t__getset(0,__proto,'paddingTop',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\t/**是否为绝对定位。*/\r\n\t__getset(0,__proto,'absolute',function(){\r\n\t\treturn true;\r\n\t});\r\n\r\n\tStyle.__init__=function(){\r\n\t\tStyle._TF_EMPTY=new TransformInfo();\r\n\t\tStyle.EMPTY=new Style();\r\n\t}\r\n\r\n\tStyle.EMPTY=null;\r\n\tStyle._TF_EMPTY=null;\r\n\treturn Style;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Font</code> 类是字体显示定义类。\r\n*/\r\n//class laya.display.css.Font\r\nvar Font=(function(){\r\n\tfunction Font(src){\r\n\t\tthis._type=0;\r\n\t\tthis._weight=0;\r\n\t\tthis._decoration=null;\r\n\t\tthis._text=null;\r\n\t\t/**\r\n\t\t*首行缩进 （以像素为单位）。\r\n\t\t*/\r\n\t\tthis.indent=0;\r\n\t\tthis._color=Color.create(Font.defaultColor);\r\n\t\tthis.family=Font.defaultFamily;\r\n\t\tthis.stroke=Font._STROKE;\r\n\t\tthis.size=Font.defaultSize;\r\n\t\tsrc && src!==Font.EMPTY && src.copyTo(this);\r\n\t}\r\n\r\n\t__class(Font,'laya.display.css.Font');\r\n\tvar __proto=Font.prototype;\r\n\t/**\r\n\t*字体样式字符串。\r\n\t*/\r\n\t__proto.set=function(value){\r\n\t\tthis._text=null;\r\n\t\tvar strs=value.split(' ');\r\n\t\tfor (var i=0,n=strs.length;i < n;i++){\r\n\t\t\tvar str=strs[i];\r\n\t\t\tswitch (str){\r\n\t\t\t\tcase 'italic':\r\n\t\t\t\t\tthis.italic=true;\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\tcase 'bold':\r\n\t\t\t\t\tthis.bold=true;\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\tif (str.indexOf('px')> 0){\r\n\t\t\t\tthis.size=parseInt(str);\r\n\t\t\t\tthis.family=strs[i+1];\r\n\t\t\t\ti++;\r\n\t\t\t\tcontinue ;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*返回字体样式字符串。\r\n\t*@return 字体样式字符串。\r\n\t*/\r\n\t__proto.toString=function(){\r\n\t\tthis._text=\"\"\r\n\t\tthis.italic && (this._text+=\"italic \");\r\n\t\tthis.bold && (this._text+=\"bold \");\r\n\t\treturn this._text+=this.size+\"px \"+this.family;\r\n\t}\r\n\r\n\t/**\r\n\t*将当前的属性值复制到传入的 <code>Font</code> 对象。\r\n\t*@param dec 一个 Font 对象。\r\n\t*/\r\n\t__proto.copyTo=function(dec){\r\n\t\tdec._type=this._type;\r\n\t\tdec._text=this._text;\r\n\t\tdec._weight=this._weight;\r\n\t\tdec._color=this._color;\r\n\t\tdec.family=this.family;\r\n\t\tdec.stroke=this.stroke !=Font._STROKE ? this.stroke.slice():Font._STROKE;\r\n\t\tdec.indent=this.indent;\r\n\t\tdec.size=this.size;\r\n\t}\r\n\r\n\t/**\r\n\t*表示是否为密码格式。\r\n\t*/\r\n\t__getset(0,__proto,'password',function(){\r\n\t\treturn (this._type & 0x400)!==0;\r\n\t\t},function(value){\r\n\t\tvalue ? (this._type |=0x400):(this._type &=~0x400);\r\n\t});\r\n\r\n\t/**\r\n\t*表示颜色字符串。\r\n\t*/\r\n\t__getset(0,__proto,'color',function(){\r\n\t\treturn this._color.strColor;\r\n\t\t},function(value){\r\n\t\tthis._color=Color.create(value);\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否为斜体。\r\n\t*/\r\n\t__getset(0,__proto,'italic',function(){\r\n\t\treturn (this._type & 0x200)!==0;\r\n\t\t},function(value){\r\n\t\tvalue ? (this._type |=0x200):(this._type &=~0x200);\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否为粗体。\r\n\t*/\r\n\t__getset(0,__proto,'bold',function(){\r\n\t\treturn (this._type & 0x800)!==0;\r\n\t\t},function(value){\r\n\t\tvalue ? (this._type |=0x800):(this._type &=~0x800);\r\n\t});\r\n\r\n\t/**\r\n\t*文本的粗细。\r\n\t*/\r\n\t__getset(0,__proto,'weight',function(){\r\n\t\treturn \"\"+this._weight;\r\n\t\t},function(value){\r\n\t\tvar weight=0;\r\n\t\tswitch (value){\r\n\t\t\tcase 'normal':\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'bold':\r\n\t\t\t\tthis.bold=true;\r\n\t\t\t\tweight=700;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'bolder':\r\n\t\t\t\tweight=800;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'lighter':\r\n\t\t\t\tweight=100;\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tweight=parseInt(value);\r\n\t\t\t}\r\n\t\tthis._weight=weight;\r\n\t\tthis._text=null;\r\n\t});\r\n\r\n\t/**\r\n\t*规定添加到文本的修饰。\r\n\t*/\r\n\t__getset(0,__proto,'decoration',function(){\r\n\t\treturn this._decoration ? this._decoration.value :\"none\";\r\n\t\t},function(value){\r\n\t\tvar strs=value.split(' ');\r\n\t\tthis._decoration || (this._decoration={});\r\n\t\tswitch (strs[0]){\r\n\t\t\tcase '_':\r\n\t\t\t\tthis._decoration.type='underline'\r\n\t\t\t\tbreak ;\r\n\t\t\tcase '-':\r\n\t\t\t\tthis._decoration.type='line-through'\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'overline':\r\n\t\t\t\tthis._decoration.type='overline'\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tthis._decoration.type=strs[0];\r\n\t\t\t}\r\n\t\tstrs[1] && (this._decoration.color=Color.create(strs));\r\n\t\tthis._decoration.value=value;\r\n\t});\r\n\r\n\tFont.__init__=function(){\r\n\t\tFont.EMPTY=new Font(null);\r\n\t}\r\n\r\n\tFont.EMPTY=null;\r\n\tFont.defaultColor=\"#000000\";\r\n\tFont.defaultSize=12;\r\n\tFont.defaultFamily=\"Arial\";\r\n\tFont.defaultFont=\"12px Arial\";\r\n\tFont._ITALIC=0x200;\r\n\tFont._PASSWORD=0x400;\r\n\tFont._BOLD=0x800;\r\n\t__static(Font,\r\n\t['_STROKE',function(){return this._STROKE=[0,\"#000000\"];}\r\n\t]);\r\n\treturn Font;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.display.css.TransformInfo\r\nvar TransformInfo=(function(){\r\n\tfunction TransformInfo(){\r\n\t\tthis.translateX=0;\r\n\t\tthis.translateY=0;\r\n\t\tthis.scaleX=1;\r\n\t\tthis.scaleY=1;\r\n\t\tthis.rotate=0;\r\n\t\tthis.skewX=0;\r\n\t\tthis.skewY=0;\r\n\t}\r\n\r\n\t__class(TransformInfo,'laya.display.css.TransformInfo');\r\n\treturn TransformInfo;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Graphics</code> 类用于创建绘图显示对象。Graphics可以同时绘制多个位图或者矢量图，还可以结合save，restore，transform，scale，rotate，translate，alpha等指令对绘图效果进行变化。\r\n*Graphics以命令流方式存储，可以通过cmds属性访问所有命令流。Graphics是比Sprite更轻量级的对象，合理使用能提高应用性能(比如把大量的节点绘图改为一个节点的Graphics命令集合，能减少大量节点创建消耗)。\r\n*@see laya.display.Sprite#graphics\r\n*/\r\n//class laya.display.Graphics\r\nvar Graphics=(function(){\r\n\tfunction Graphics(){\r\n\t\t/**@private */\r\n\t\t//this._sp=null;\r\n\t\t/**@private */\r\n\t\tthis._one=null;\r\n\t\t/**@private */\r\n\t\tthis._cmds=null;\r\n\t\t/**@private */\r\n\t\t//this._vectorgraphArray=null;\r\n\t\t/**@private */\r\n\t\t//this._graphicBounds=null;\r\n\t\tthis._render=this._renderEmpty;\r\n\t\tif (Render.isConchNode){\r\n\t\t\tvar _this_=this;\r\n\t\t\t_this_._nativeObj=new (window)._conchGraphics();\r\n\t\t\t_this_.id=_this_._nativeObj.conchID;\r\n\t\t}\r\n\t}\r\n\r\n\t__class(Graphics,'laya.display.Graphics');\r\n\tvar __proto=Graphics.prototype;\r\n\t/**\r\n\t*<p>销毁此对象。</p>\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis.clear();\r\n\t\tif (this._graphicBounds)this._graphicBounds.destroy();\r\n\t\tthis._graphicBounds=null;\r\n\t\tthis._vectorgraphArray=null;\r\n\t\tthis._sp && (this._sp._renderType=0);\r\n\t\tthis._sp=null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>清空绘制命令。</p>\r\n\t*@param recoverCmds 是否回收绘图指令\r\n\t*/\r\n\t__proto.clear=function(recoverCmds){\r\n\t\t(recoverCmds===void 0)&& (recoverCmds=false);\r\n\t\tvar i=0,len=0;\r\n\t\tif (recoverCmds){\r\n\t\t\tvar tCmd=this._one;\r\n\t\t\tif (this._cmds){\r\n\t\t\t\tlen=this._cmds.length;\r\n\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\ttCmd=this._cmds[i];\r\n\t\t\t\t\tif (tCmd && (tCmd.callee===Render._context._drawTexture || tCmd.callee===Render._context._drawTextureWithTransform)){\r\n\t\t\t\t\t\ttCmd[0]=null;\r\n\t\t\t\t\t\tGraphics._cache.push(tCmd);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._cmds.length=0;\r\n\t\t\t\t}else if (tCmd){\r\n\t\t\t\tif (tCmd && (tCmd.callee===Render._context._drawTexture || tCmd.callee===Render._context._drawTextureWithTransform)){\r\n\t\t\t\t\ttCmd[0]=null;\r\n\t\t\t\t\tGraphics._cache.push(tCmd);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis._cmds=null;\r\n\t\t}\r\n\t\tthis._one=null;\r\n\t\tthis._render=this._renderEmpty;\r\n\t\tthis._sp && (this._sp._renderType &=~ /*laya.renders.RenderSprite.IMAGE*/0x01 & ~ /*laya.renders.RenderSprite.GRAPHICS*/0x200);\r\n\t\tthis._repaint();\r\n\t\tif (this._vectorgraphArray){\r\n\t\t\tfor (i=0,len=this._vectorgraphArray.length;i < len;i++){\r\n\t\t\t\tVectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[i]);\r\n\t\t\t}\r\n\t\t\tthis._vectorgraphArray.length=0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._clearBoundsCache=function(){\r\n\t\tif (this._graphicBounds)this._graphicBounds.reset();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._initGraphicBounds=function(){\r\n\t\tif (!this._graphicBounds){\r\n\t\t\tthis._graphicBounds=new GraphicsBounds();\r\n\t\t\tthis._graphicBounds._graphics=this;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*重绘此对象。\r\n\t*/\r\n\t__proto._repaint=function(){\r\n\t\tthis._clearBoundsCache();\r\n\t\tthis._sp && this._sp.repaint();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._isOnlyOne=function(){\r\n\t\treturn !this._cmds || this._cmds.length===0;\r\n\t}\r\n\r\n\t/**\r\n\t*获取位置及宽高信息矩阵(比较耗CPU，频繁使用会造成卡顿，尽量少用)。\r\n\t*@param realSize （可选）使用图片的真实大小，默认为false\r\n\t*@return 位置与宽高组成的 一个 Rectangle 对象。\r\n\t*/\r\n\t__proto.getBounds=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tthis._initGraphicBounds();\r\n\t\treturn this._graphicBounds.getBounds(realSize);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@param realSize （可选）使用图片的真实大小，默认为false\r\n\t*获取端点列表。\r\n\t*/\r\n\t__proto.getBoundPoints=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tthis._initGraphicBounds();\r\n\t\treturn this._graphicBounds.getBoundPoints(realSize);\r\n\t}\r\n\r\n\t__proto._addCmd=function(a){\r\n\t\tthis._cmds=this._cmds || [];\r\n\t\ta.callee=a.shift();\r\n\t\tthis._cmds.push(a);\r\n\t}\r\n\r\n\t__proto.setFilters=function(fs){\r\n\t\tthis._saveToCmd(Render._context._setFilters,fs);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制纹理。\r\n\t*@param tex 纹理。\r\n\t*@param x （可选）X轴偏移量。\r\n\t*@param y （可选）Y轴偏移量。\r\n\t*@param width （可选）宽度。\r\n\t*@param height （可选）高度。\r\n\t*@param m （可选）矩阵信息。\r\n\t*@param alpha （可选）透明度。\r\n\t*/\r\n\t__proto.drawTexture=function(tex,x,y,width,height,m,alpha){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\t(alpha===void 0)&& (alpha=1);\r\n\t\tif (!tex || alpha < 0.01)return null;\r\n\t\tif (!width)width=tex.sourceWidth;\r\n\t\tif (!height)height=tex.sourceHeight;\r\n\t\talpha=alpha < 0 ? 0 :(alpha > 1 ? 1 :alpha);\r\n\t\tvar offset=(!Render.isWebGL && Browser.onFirefox || Browser.onEdge)? 0.5 :0;\r\n\t\tvar wRate=width / tex.sourceWidth;\r\n\t\tvar hRate=height / tex.sourceHeight;\r\n\t\twidth=tex.width *wRate;\r\n\t\theight=tex.height *hRate;\r\n\t\tif (tex.loaded && (width <=0 || height <=0))return null;\r\n\t\tx+=tex.offsetX *wRate;\r\n\t\ty+=tex.offsetY *hRate;\r\n\t\tthis._sp && (this._sp._renderType |=/*laya.renders.RenderSprite.GRAPHICS*/0x200);\r\n\t\tvar args;\r\n\t\tx-=offset;\r\n\t\ty-=offset;\r\n\t\twidth+=2 *offset;\r\n\t\theight+=2 *offset;\r\n\t\tif (Graphics._cache.length){\r\n\t\t\targs=Graphics._cache.pop();\r\n\t\t\targs[0]=tex;\r\n\t\t\targs[1]=x;\r\n\t\t\targs[2]=y;\r\n\t\t\targs[3]=width;\r\n\t\t\targs[4]=height;\r\n\t\t\targs[5]=m;\r\n\t\t\targs[6]=alpha;\r\n\t\t\t}else {\r\n\t\t\targs=[tex,x,y,width,height,m,alpha];\r\n\t\t}\r\n\t\targs.callee=(m || alpha !=1)? Render._context._drawTextureWithTransform :Render._context._drawTexture;\r\n\t\tif (this._one==null && !m && alpha==1){\r\n\t\t\tthis._one=args;\r\n\t\t\tthis._render=this._renderOneImg;\r\n\t\t\t}else {\r\n\t\t\tthis._saveToCmd(args.callee,args);\r\n\t\t}\r\n\t\tif (!tex.loaded){\r\n\t\t\ttex.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._textureLoaded,[tex,args]);\r\n\t\t}\r\n\t\tthis._repaint();\r\n\t\treturn args;\r\n\t}\r\n\r\n\t/**\r\n\t*@private 清理贴图并替换为最新的\r\n\t*@param tex\r\n\t*/\r\n\t__proto.cleanByTexture=function(tex,x,y,width,height){\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tif (!tex)return this.clear();\r\n\t\tif (this._one && this._render===this._renderOneImg){\r\n\t\t\tif (!width)width=tex.sourceWidth;\r\n\t\t\tif (!height)height=tex.sourceHeight;\r\n\t\t\tvar wRate=width / tex.sourceWidth;\r\n\t\t\tvar hRate=height / tex.sourceHeight;\r\n\t\t\twidth=tex.width *wRate;\r\n\t\t\theight=tex.height *hRate;\r\n\t\t\tx+=tex.offsetX *wRate;\r\n\t\t\ty+=tex.offsetY *hRate;\r\n\t\t\tthis._one[0]=tex;\r\n\t\t\tthis._one[1]=x;\r\n\t\t\tthis._one[2]=y;\r\n\t\t\tthis._one[3]=width;\r\n\t\t\tthis._one[4]=height;\r\n\t\t\t}else {\r\n\t\t\tthis.clear();\r\n\t\t\ttex && this.drawTexture(tex,x,y,width,height);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*批量绘制同样纹理。\r\n\t*@param tex 纹理。\r\n\t*@param pos 绘制坐标。\r\n\t*/\r\n\t__proto.drawTextures=function(tex,pos){\r\n\t\tif (!tex)return;\r\n\t\tthis._saveToCmd(Render._context._drawTextures,[tex,pos]);\r\n\t}\r\n\r\n\t/**\r\n\t*用texture填充。\r\n\t*@param tex 纹理。\r\n\t*@param x X轴偏移量。\r\n\t*@param y Y轴偏移量。\r\n\t*@param width （可选）宽度。\r\n\t*@param height （可选）高度。\r\n\t*@param type （可选）填充类型 repeat|repeat-x|repeat-y|no-repeat\r\n\t*@param offset （可选）贴图纹理偏移\r\n\t*/\r\n\t__proto.fillTexture=function(tex,x,y,width,height,type,offset){\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\t(type===void 0)&& (type=\"repeat\");\r\n\t\tif (!tex)return;\r\n\t\tvar args=[tex,x,y,width,height,type,offset || Point.EMPTY,{}];\r\n\t\tif (!tex.loaded){\r\n\t\t\ttex.once(/*laya.events.Event.LOADED*/\"loaded\",this,this._textureLoaded,[tex,args]);\r\n\t\t}\r\n\t\tthis._saveToCmd(Render._context._fillTexture,args);\r\n\t}\r\n\r\n\t__proto._textureLoaded=function(tex,param){\r\n\t\tparam[3]=param[3] || tex.width;\r\n\t\tparam[4]=param[4] || tex.height;\r\n\t\tthis._repaint();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*保存到命令流。\r\n\t*/\r\n\t__proto._saveToCmd=function(fun,args){\r\n\t\tthis._sp && (this._sp._renderType |=/*laya.renders.RenderSprite.GRAPHICS*/0x200);\r\n\t\tif (this._one==null){\r\n\t\t\tthis._one=args;\r\n\t\t\tthis._render=this._renderOne;\r\n\t\t\t}else {\r\n\t\t\tthis._sp && (this._sp._renderType &=~ /*laya.renders.RenderSprite.IMAGE*/0x01);\r\n\t\t\tthis._render=this._renderAll;\r\n\t\t\t(this._cmds || (this._cmds=[])).length===0 && this._cmds.push(this._one);\r\n\t\t\tthis._cmds.push(args);\r\n\t\t}\r\n\t\targs.callee=fun;\r\n\t\tthis._repaint();\r\n\t\treturn args;\r\n\t}\r\n\r\n\t/**\r\n\t*设置剪裁区域，超出剪裁区域的坐标不显示。\r\n\t*@param x X 轴偏移量。\r\n\t*@param y Y 轴偏移量。\r\n\t*@param width 宽度。\r\n\t*@param height 高度。\r\n\t*/\r\n\t__proto.clipRect=function(x,y,width,height){\r\n\t\tthis._saveToCmd(Render._context._clipRect,[x,y,width,height]);\r\n\t}\r\n\r\n\t/**\r\n\t*在画布上绘制文本。\r\n\t*@param text 在画布上输出的文本。\r\n\t*@param x 开始绘制文本的 x 坐标位置（相对于画布）。\r\n\t*@param y 开始绘制文本的 y 坐标位置（相对于画布）。\r\n\t*@param font 定义字号和字体，比如\"20px Arial\"。\r\n\t*@param color 定义文本颜色，比如\"#ff0000\"。\r\n\t*@param textAlign 文本对齐方式，可选值：\"left\"，\"center\"，\"right\"。\r\n\t*/\r\n\t__proto.fillText=function(text,x,y,font,color,textAlign,underLine){\r\n\t\t(underLine===void 0)&& (underLine=0);\r\n\t\tthis._saveToCmd(Render._context._fillText,[text,x,y,font || Font.defaultFont,color,textAlign]);\r\n\t}\r\n\r\n\t/**\r\n\t*在画布上绘制“被填充且镶边的”文本。\r\n\t*@param text 在画布上输出的文本。\r\n\t*@param x 开始绘制文本的 x 坐标位置（相对于画布）。\r\n\t*@param y 开始绘制文本的 y 坐标位置（相对于画布）。\r\n\t*@param font 定义字体和字号，比如\"20px Arial\"。\r\n\t*@param fillColor 定义文本颜色，比如\"#ff0000\"。\r\n\t*@param borderColor 定义镶边文本颜色。\r\n\t*@param lineWidth 镶边线条宽度。\r\n\t*@param textAlign 文本对齐方式，可选值：\"left\"，\"center\"，\"right\"。\r\n\t*/\r\n\t__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){\r\n\t\tthis._saveToCmd(Render._context._fillBorderText,[text,x,y,font || Font.defaultFont,fillColor,borderColor,lineWidth,textAlign]);\r\n\t}\r\n\r\n\t/**\r\n\t*在画布上绘制文本（没有填色）。文本的默认颜色是黑色。\r\n\t*@param text 在画布上输出的文本。\r\n\t*@param x 开始绘制文本的 x 坐标位置（相对于画布）。\r\n\t*@param y 开始绘制文本的 y 坐标位置（相对于画布）。\r\n\t*@param font 定义字体和字号，比如\"20px Arial\"。\r\n\t*@param color 定义文本颜色，比如\"#ff0000\"。\r\n\t*@param lineWidth 线条宽度。\r\n\t*@param textAlign 文本对齐方式，可选值：\"left\"，\"center\"，\"right\"。\r\n\t*/\r\n\t__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){\r\n\t\tthis._saveToCmd(Render._context._strokeText,[text,x,y,font || Font.defaultFont,color,lineWidth,textAlign]);\r\n\t}\r\n\r\n\t/**\r\n\t*设置透明度。\r\n\t*@param value 透明度。\r\n\t*/\r\n\t__proto.alpha=function(value){\r\n\t\tvalue=value < 0 ? 0 :(value > 1 ? 1 :value);\r\n\t\tthis._saveToCmd(Render._context._alpha,[value]);\r\n\t}\r\n\r\n\t/**\r\n\t*设置当前透明度。\r\n\t*@param value 透明度。\r\n\t*/\r\n\t__proto.setAlpha=function(value){\r\n\t\tvalue=value < 0 ? 0 :(value > 1 ? 1 :value);\r\n\t\tthis._saveToCmd(Render._context._setAlpha,[value]);\r\n\t}\r\n\r\n\t/**\r\n\t*替换绘图的当前转换矩阵。\r\n\t*@param mat 矩阵。\r\n\t*@param pivotX （可选）水平方向轴心点坐标。\r\n\t*@param pivotY （可选）垂直方向轴心点坐标。\r\n\t*/\r\n\t__proto.transform=function(matrix,pivotX,pivotY){\r\n\t\t(pivotX===void 0)&& (pivotX=0);\r\n\t\t(pivotY===void 0)&& (pivotY=0);\r\n\t\tthis._saveToCmd(Render._context._transform,[matrix,pivotX,pivotY]);\r\n\t}\r\n\r\n\t/**\r\n\t*旋转当前绘图。(推荐使用transform，性能更高)\r\n\t*@param angle 旋转角度，以弧度计。\r\n\t*@param pivotX （可选）水平方向轴心点坐标。\r\n\t*@param pivotY （可选）垂直方向轴心点坐标。\r\n\t*/\r\n\t__proto.rotate=function(angle,pivotX,pivotY){\r\n\t\t(pivotX===void 0)&& (pivotX=0);\r\n\t\t(pivotY===void 0)&& (pivotY=0);\r\n\t\tthis._saveToCmd(Render._context._rotate,[angle,pivotX,pivotY]);\r\n\t}\r\n\r\n\t/**\r\n\t*缩放当前绘图至更大或更小。(推荐使用transform，性能更高)\r\n\t*@param scaleX 水平方向缩放值。\r\n\t*@param scaleY 垂直方向缩放值。\r\n\t*@param pivotX （可选）水平方向轴心点坐标。\r\n\t*@param pivotY （可选）垂直方向轴心点坐标。\r\n\t*/\r\n\t__proto.scale=function(scaleX,scaleY,pivotX,pivotY){\r\n\t\t(pivotX===void 0)&& (pivotX=0);\r\n\t\t(pivotY===void 0)&& (pivotY=0);\r\n\t\tthis._saveToCmd(Render._context._scale,[scaleX,scaleY,pivotX,pivotY]);\r\n\t}\r\n\r\n\t/**\r\n\t*重新映射画布上的 (0,0)位置。\r\n\t*@param x 添加到水平坐标（x）上的值。\r\n\t*@param y 添加到垂直坐标（y）上的值。\r\n\t*/\r\n\t__proto.translate=function(x,y){\r\n\t\tthis._saveToCmd(Render._context._translate,[x,y]);\r\n\t}\r\n\r\n\t/**\r\n\t*保存当前环境的状态。\r\n\t*/\r\n\t__proto.save=function(){\r\n\t\tthis._saveToCmd(Render._context._save,[]);\r\n\t}\r\n\r\n\t/**\r\n\t*返回之前保存过的路径状态和属性。\r\n\t*/\r\n\t__proto.restore=function(){\r\n\t\tthis._saveToCmd(Render._context._restore,[]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*替换文本内容。\r\n\t*@param text 文本内容。\r\n\t*@return 替换成功则值为true，否则值为flase。\r\n\t*/\r\n\t__proto.replaceText=function(text){\r\n\t\tthis._repaint();\r\n\t\tvar cmds=this._cmds;\r\n\t\tif (!cmds){\r\n\t\t\tif (this._one && this._isTextCmd(this._one.callee)){\r\n\t\t\t\tif (this._one[0].toUpperCase)this._one[0]=text;\r\n\t\t\t\telse this._one[0].setText(text);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (var i=cmds.length-1;i >-1;i--){\r\n\t\t\t\tif (this._isTextCmd(cmds[i].callee)){\r\n\t\t\t\t\tif (cmds[i][0].toUpperCase)cmds[i][0]=text;\r\n\t\t\t\t\telse cmds[i][0].setText(text);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._isTextCmd=function(fun){\r\n\t\treturn fun===Render._context._fillText || fun===Render._context._fillBorderText || fun===Render._context._strokeText;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*替换文本颜色。\r\n\t*@param color 颜色。\r\n\t*/\r\n\t__proto.replaceTextColor=function(color){\r\n\t\tthis._repaint();\r\n\t\tvar cmds=this._cmds;\r\n\t\tif (!cmds){\r\n\t\t\tif (this._one && this._isTextCmd(this._one.callee)){\r\n\t\t\t\tthis._one[4]=color;\r\n\t\t\t\tif (!this._one[0].toUpperCase)this._one[0].changed=true;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (var i=cmds.length-1;i >-1;i--){\r\n\t\t\t\tif (this._isTextCmd(cmds[i].callee)){\r\n\t\t\t\t\tcmds[i][4]=color;\r\n\t\t\t\t\tif (!cmds[i][0].toUpperCase)cmds[i][0].changed=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*加载并显示一个图片。\r\n\t*@param url 图片地址。\r\n\t*@param x （可选）显示图片的x位置。\r\n\t*@param y （可选）显示图片的y位置。\r\n\t*@param width （可选）显示图片的宽度，设置为0表示使用图片默认宽度。\r\n\t*@param height （可选）显示图片的高度，设置为0表示使用图片默认高度。\r\n\t*@param complete （可选）加载完成回调。\r\n\t*/\r\n\t__proto.loadImage=function(url,x,y,width,height,complete){\r\n\t\tvar _$this=this;\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tvar tex=Loader.getRes(url);\r\n\t\tif (tex)onloaded(tex);\r\n\t\telse Laya.loader.load(url,Handler.create(null,onloaded),null,/*laya.net.Loader.IMAGE*/\"image\");\r\n\t\tfunction onloaded (tex){\r\n\t\t\tif (tex){\r\n\t\t\t\t_$this.drawTexture(tex,x,y,width,height);\r\n\t\t\t\tif (complete !=null)complete.call(_$this._sp,tex);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._renderEmpty=function(sprite,context,x,y){}\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._renderAll=function(sprite,context,x,y){\r\n\t\tvar cmds=this._cmds,cmd;\r\n\t\tfor (var i=0,n=cmds.length;i < n;i++){\r\n\t\t\t(cmd=cmds[i]).callee.call(context,x,y,cmd);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._renderOne=function(sprite,context,x,y){\r\n\t\tthis._one.callee.call(context,x,y,this._one);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._renderOneImg=function(sprite,context,x,y){\r\n\t\tthis._one.callee.call(context,x,y,this._one);\r\n\t\tif (sprite._renderType!==2305){\r\n\t\t\tsprite._renderType |=/*laya.renders.RenderSprite.IMAGE*/0x01;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*绘制一条线。\r\n\t*@param fromX X轴开始位置。\r\n\t*@param fromY Y轴开始位置。\r\n\t*@param toX X轴结束位置。\r\n\t*@param toY Y轴结束位置。\r\n\t*@param lineColor 颜色。\r\n\t*@param lineWidth （可选）线条宽度。\r\n\t*/\r\n\t__proto.drawLine=function(fromX,fromY,toX,toY,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar tId=0;\r\n\t\tif (Render.isWebGL){\r\n\t\t\ttId=VectorGraphManager.getInstance().getId();\r\n\t\t\tif (this._vectorgraphArray==null)this._vectorgraphArray=[];\r\n\t\t\tthis._vectorgraphArray.push(tId);\r\n\t\t};\r\n\t\tvar offset=lineWidth % 2===0 ? 0 :0.5;\r\n\t\tvar arr=[fromX+offset,fromY+offset,toX+offset,toY+offset,lineColor,lineWidth,tId];\r\n\t\tthis._saveToCmd(Render._context._drawLine,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制一系列线段。\r\n\t*@param x 开始绘制的X轴位置。\r\n\t*@param y 开始绘制的Y轴位置。\r\n\t*@param points 线段的点集合。格式:[x1,y1,x2,y2,x3,y3...]。\r\n\t*@param lineColor 线段颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）线段宽度。\r\n\t*/\r\n\t__proto.drawLines=function(x,y,points,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar tId=0;\r\n\t\tif (!points || points.length < 4)return;\r\n\t\tif (Render.isWebGL){\r\n\t\t\ttId=VectorGraphManager.getInstance().getId();\r\n\t\t\tif (this._vectorgraphArray==null)this._vectorgraphArray=[];\r\n\t\t\tthis._vectorgraphArray.push(tId);\r\n\t\t};\r\n\t\tvar offset=lineWidth % 2===0 ? 0 :0.5;\r\n\t\tvar arr=[x+offset,y+offset,points,lineColor,lineWidth,tId];\r\n\t\tthis._saveToCmd(Render._context._drawLines,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制一系列曲线。\r\n\t*@param x 开始绘制的 X 轴位置。\r\n\t*@param y 开始绘制的 Y 轴位置。\r\n\t*@param points 线段的点集合，格式[startx,starty,ctrx,ctry,startx,starty...]。\r\n\t*@param lineColor 线段颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）线段宽度。\r\n\t*/\r\n\t__proto.drawCurves=function(x,y,points,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar arr=[x,y,points,lineColor,lineWidth];\r\n\t\tthis._saveToCmd(Render._context._drawCurves,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制矩形。\r\n\t*@param x 开始绘制的 X 轴位置。\r\n\t*@param y 开始绘制的 Y 轴位置。\r\n\t*@param width 矩形宽度。\r\n\t*@param height 矩形高度。\r\n\t*@param fillColor 填充颜色，或者填充绘图的渐变对象。\r\n\t*@param lineColor （可选）边框颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）边框宽度。\r\n\t*/\r\n\t__proto.drawRect=function(x,y,width,height,fillColor,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar offset=lineColor ? lineWidth / 2 :0;\r\n\t\tvar lineOffset=lineColor ? lineWidth :0;\r\n\t\tvar arr=[x+offset,y+offset,width-lineOffset,height-lineOffset,fillColor,lineColor,lineWidth];\r\n\t\tthis._saveToCmd(Render._context._drawRect,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制圆形。\r\n\t*@param x 圆点X 轴位置。\r\n\t*@param y 圆点Y 轴位置。\r\n\t*@param radius 半径。\r\n\t*@param fillColor 填充颜色，或者填充绘图的渐变对象。\r\n\t*@param lineColor （可选）边框颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）边框宽度。\r\n\t*/\r\n\t__proto.drawCircle=function(x,y,radius,fillColor,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar offset=lineColor ? lineWidth / 2 :0;\r\n\t\tvar tId=0;\r\n\t\tif (Render.isWebGL){\r\n\t\t\ttId=VectorGraphManager.getInstance().getId();\r\n\t\t\tif (this._vectorgraphArray==null)this._vectorgraphArray=[];\r\n\t\t\tthis._vectorgraphArray.push(tId);\r\n\t\t};\r\n\t\tvar arr=[x,y,radius-offset,fillColor,lineColor,lineWidth,tId];\r\n\t\tthis._saveToCmd(Render._context._drawCircle,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制扇形。\r\n\t*@param x 开始绘制的 X 轴位置。\r\n\t*@param y 开始绘制的 Y 轴位置。\r\n\t*@param radius 扇形半径。\r\n\t*@param startAngle 开始角度。\r\n\t*@param endAngle 结束角度。\r\n\t*@param fillColor 填充颜色，或者填充绘图的渐变对象。\r\n\t*@param lineColor （可选）边框颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）边框宽度。\r\n\t*/\r\n\t__proto.drawPie=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar offset=lineColor ? lineWidth / 2 :0;\r\n\t\tvar lineOffset=lineColor ? lineWidth :0;\r\n\t\tvar tId=0;\r\n\t\tif (Render.isWebGL){\r\n\t\t\ttId=VectorGraphManager.getInstance().getId();\r\n\t\t\tif (this._vectorgraphArray==null)this._vectorgraphArray=[];\r\n\t\t\tthis._vectorgraphArray.push(tId);\r\n\t\t};\r\n\t\tvar arr=[x+offset,y+offset,radius-lineOffset,startAngle,endAngle,fillColor,lineColor,lineWidth,tId];\r\n\t\tarr[3]=Utils.toRadian(startAngle);\r\n\t\tarr[4]=Utils.toRadian(endAngle);\r\n\t\tthis._saveToCmd(Render._context._drawPie,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制多边形。\r\n\t*@param x 开始绘制的 X 轴位置。\r\n\t*@param y 开始绘制的 Y 轴位置。\r\n\t*@param points 多边形的点集合。\r\n\t*@param fillColor 填充颜色，或者填充绘图的渐变对象。\r\n\t*@param lineColor （可选）边框颜色，或者填充绘图的渐变对象。\r\n\t*@param lineWidth （可选）边框宽度。\r\n\t*/\r\n\t__proto.drawPoly=function(x,y,points,fillColor,lineColor,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar tId=0;\r\n\t\tvar tIsConvexPolygon=false;\r\n\t\tif (Render.isWebGL){\r\n\t\t\ttId=VectorGraphManager.getInstance().getId();\r\n\t\t\tif (this._vectorgraphArray==null)this._vectorgraphArray=[];\r\n\t\t\tthis._vectorgraphArray.push(tId);\r\n\t\t\tif (points.length > 6){\r\n\t\t\t\ttIsConvexPolygon=false;\r\n\t\t\t\t}else {\r\n\t\t\t\ttIsConvexPolygon=true;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar offset=lineColor ? (lineWidth % 2===0 ? 0 :0.5):0;\r\n\t\tvar arr=[x+offset,y+offset,points,fillColor,lineColor,lineWidth,tId,tIsConvexPolygon];\r\n\t\tthis._saveToCmd(Render._context._drawPoly,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*绘制路径。\r\n\t*@param x 开始绘制的 X 轴位置。\r\n\t*@param y 开始绘制的 Y 轴位置。\r\n\t*@param paths 路径集合，路径支持以下格式：[[\"moveTo\",x,y],[\"lineTo\",x,y,x,y,x,y],[\"arcTo\",x1,y1,x2,y2,r],[\"closePath\"]]。\r\n\t*@param brush （可选）刷子定义，支持以下设置{fillStyle}。\r\n\t*@param pen （可选）画笔定义，支持以下设置{strokeStyle,lineWidth,lineJoin,lineCap,miterLimit}。\r\n\t*/\r\n\t__proto.drawPath=function(x,y,paths,brush,pen){\r\n\t\tvar arr=[x,y,paths,brush,pen];\r\n\t\tthis._saveToCmd(Render._context._drawPath,arr);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*命令流。存储了所有绘制命令。\r\n\t*/\r\n\t__getset(0,__proto,'cmds',function(){\r\n\t\treturn this._cmds;\r\n\t\t},function(value){\r\n\t\tthis._sp && (this._sp._renderType |=/*laya.renders.RenderSprite.GRAPHICS*/0x200);\r\n\t\tthis._cmds=value;\r\n\t\tthis._render=this._renderAll;\r\n\t\tthis._repaint();\r\n\t});\r\n\r\n\tGraphics.__init__=function(){\r\n\t\tif (Render.isConchNode){\r\n\t\t\tvar from=laya.display.Graphics.prototype;\r\n\t\t\tvar to=Browser.window.ConchGraphics.prototype;\r\n\t\t\tvar list=[\"clear\",\"destroy\",\"alpha\",\"rotate\",\"transform\",\"scale\",\"translate\",\"save\",\"restore\",\"clipRect\",\"blendMode\",\"fillText\",\"fillBorderText\",\"_fands\",\"drawRect\",\"drawCircle\",\"drawPie\",\"drawPoly\",\"drawPath\",\"drawImageM\",\"drawLine\",\"drawLines\",\"_drawPs\",\"drawCurves\",\"replaceText\",\"replaceTextColor\",\"_fillImage\",\"fillTexture\",\"setSkinMesh\",\"drawParticle\",\"drawImageS\"];\r\n\t\t\tfor (var i=0,len=list.length;i <=len;i++){\r\n\t\t\t\tvar temp=list[i];\r\n\t\t\t\tfrom[temp]=to[temp];\r\n\t\t\t}\r\n\t\t\tfrom._saveToCmd=null;\r\n\t\t\tif (to.drawImageS){\r\n\t\t\t\tfrom.drawTextures=function (tex,pos){\r\n\t\t\t\t\tif (!tex)return;\r\n\t\t\t\t\tif (!(tex.loaded && tex.bitmap && tex.source)){\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;\r\n\t\t\t\t\tthis.drawImageS(tex.bitmap.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,tex.offsetX,tex.offsetY,tex.width,tex.height,pos);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfrom.drawTexture=function (tex,x,y,width,height,m,alpha){\r\n\t\t\t\t(x===void 0)&& (x=0);\r\n\t\t\t\t(y===void 0)&& (y=0);\r\n\t\t\t\t(width===void 0)&& (width=0);\r\n\t\t\t\t(height===void 0)&& (height=0);\r\n\t\t\t\t(alpha===void 0)&& (alpha=1);\r\n\t\t\t\tif (!tex)return;\r\n\t\t\t\tif (!tex.loaded){\r\n\t\t\t\t\ttex.once(/*laya.events.Event.LOADED*/\"loaded\",this,function(){\r\n\t\t\t\t\t\tthis.drawTexture(tex,x,y,width,height,m);\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!(tex.loaded && tex.bitmap && tex.source)){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!width)width=tex.sourceWidth;\r\n\t\t\t\tif (!height)height=tex.sourceHeight;\r\n\t\t\t\talpha=alpha < 0 ? 0 :(alpha > 1 ? 1 :alpha);\r\n\t\t\t\twidth=width-tex.sourceWidth+tex.width;\r\n\t\t\t\theight=height-tex.sourceHeight+tex.height;\r\n\t\t\t\tif (width <=0 || height <=0)return;\r\n\t\t\t\tx+=tex.offsetX;\r\n\t\t\t\ty+=tex.offsetY;\r\n\t\t\t\tvar uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;\r\n\t\t\t\tthis.drawImageM(tex.bitmap.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height,m,alpha);\r\n\t\t\t\tthis._repaint();\r\n\t\t\t}\r\n\t\t\tfrom.fillTexture=function (tex,x,y,width,height,type,offset){\r\n\t\t\t\t(width===void 0)&& (width=0);\r\n\t\t\t\t(height===void 0)&& (height=0);\r\n\t\t\t\t(type===void 0)&& (type=\"repeat\");\r\n\t\t\t\tif (!tex)return;\r\n\t\t\t\tif (tex.loaded){\r\n\t\t\t\t\tvar ctxi=Render._context.ctx;\r\n\t\t\t\t\tvar w=tex.bitmap.width,h=tex.bitmap.height,uv=tex.uv;\r\n\t\t\t\t\tvar pat;\r\n\t\t\t\t\tif (tex.uv !=Texture.DEF_UV){\r\n\t\t\t\t\t\tpat=ctxi.createPattern(tex.bitmap.source,type,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tpat=ctxi.createPattern(tex.bitmap.source,type);\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar sX=0,sY=0;\r\n\t\t\t\t\tif (offset){\r\n\t\t\t\t\t\tx+=offset.x % tex.width;\r\n\t\t\t\t\t\ty+=offset.y % tex.height;\r\n\t\t\t\t\t\tsX-=offset.x % tex.width;\r\n\t\t\t\t\t\tsY-=offset.y % tex.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._fillImage(pat,x,y,sX,sY,width,height);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tGraphics._cache=[];\r\n\treturn Graphics;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*Graphic bounds数据类\r\n*/\r\n//class laya.display.GraphicsBounds\r\nvar GraphicsBounds=(function(){\r\n\tfunction GraphicsBounds(){\r\n\t\t/**@private */\r\n\t\t//this._temp=null;\r\n\t\t/**@private */\r\n\t\t//this._bounds=null;\r\n\t\t/**@private */\r\n\t\t//this._rstBoundPoints=null;\r\n\t\t/**@private */\r\n\t\tthis._cacheBoundsType=false;\r\n\t\t/**@private */\r\n\t\t//this._graphics=null;\r\n\t}\r\n\r\n\t__class(GraphicsBounds,'laya.display.GraphicsBounds');\r\n\tvar __proto=GraphicsBounds.prototype;\r\n\t/**\r\n\t*销毁\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis._graphics=null;\r\n\t\tthis._temp=null;\r\n\t\tthis._rstBoundPoints=null;\r\n\t\tthis._bounds=null;\r\n\t}\r\n\r\n\t/**\r\n\t*重置数据\r\n\t*/\r\n\t__proto.reset=function(){\r\n\t\tthis._temp && (this._temp.length=0);\r\n\t}\r\n\r\n\t/**\r\n\t*获取位置及宽高信息矩阵(比较耗CPU，频繁使用会造成卡顿，尽量少用)。\r\n\t*@param realSize （可选）使用图片的真实大小，默认为false\r\n\t*@return 位置与宽高组成的 一个 Rectangle 对象。\r\n\t*/\r\n\t__proto.getBounds=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tif (!this._bounds || !this._temp || this._temp.length < 1 || realSize !=this._cacheBoundsType){\r\n\t\t\tthis._bounds=Rectangle._getWrapRec(this.getBoundPoints(realSize),this._bounds)\r\n\t\t}\r\n\t\tthis._cacheBoundsType=realSize;\r\n\t\treturn this._bounds;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@param realSize （可选）使用图片的真实大小，默认为false\r\n\t*获取端点列表。\r\n\t*/\r\n\t__proto.getBoundPoints=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tif (!this._temp || this._temp.length < 1 || realSize !=this._cacheBoundsType)\r\n\t\t\tthis._temp=this._getCmdPoints(realSize);\r\n\t\tthis._cacheBoundsType=realSize;\r\n\t\treturn this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp);\r\n\t}\r\n\r\n\t__proto._getCmdPoints=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tvar context=Render._context;\r\n\t\tvar cmds=this._graphics.cmds;\r\n\t\tvar rst;\r\n\t\trst=this._temp || (this._temp=[]);\r\n\t\trst.length=0;\r\n\t\tif (!cmds && this._graphics._one !=null){\r\n\t\t\tGraphicsBounds._tempCmds.length=0;\r\n\t\t\tGraphicsBounds._tempCmds.push(this._graphics._one);\r\n\t\t\tcmds=GraphicsBounds._tempCmds;\r\n\t\t}\r\n\t\tif (!cmds)\r\n\t\t\treturn rst;\r\n\t\tvar matrixs;\r\n\t\tmatrixs=GraphicsBounds._tempMatrixArrays;\r\n\t\tmatrixs.length=0;\r\n\t\tvar tMatrix=GraphicsBounds._initMatrix;\r\n\t\ttMatrix.identity();\r\n\t\tvar tempMatrix=GraphicsBounds._tempMatrix;\r\n\t\tvar cmd;\r\n\t\tvar tex;\r\n\t\tvar wRate=NaN;\r\n\t\tvar hRate=NaN;\r\n\t\tvar oWidth=NaN;\r\n\t\tvar oHeight=NaN;\r\n\t\tvar offX=NaN;\r\n\t\tvar offY=NaN;\r\n\t\tfor (var i=0,n=cmds.length;i < n;i++){\r\n\t\t\tcmd=cmds[i];\r\n\t\t\tif (!cmd.callee)continue ;\r\n\t\t\tswitch (cmd.callee){\r\n\t\t\t\tcase context._save:\r\n\t\t\t\tcase 7:\r\n\t\t\t\t\tmatrixs.push(tMatrix);\r\n\t\t\t\t\ttMatrix=tMatrix.clone();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._restore:\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\ttMatrix=matrixs.pop();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._scale:\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\ttempMatrix.identity();\r\n\t\t\t\t\ttempMatrix.translate(-cmd[2],-cmd[3]);\r\n\t\t\t\t\ttempMatrix.scale(cmd[0],cmd[1]);\r\n\t\t\t\t\ttempMatrix.translate(cmd[2],cmd[3]);\r\n\t\t\t\t\tthis._switchMatrix(tMatrix,tempMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._rotate:\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\ttempMatrix.identity();\r\n\t\t\t\t\ttempMatrix.translate(-cmd[1],-cmd[2]);\r\n\t\t\t\t\ttempMatrix.rotate(cmd[0]);\r\n\t\t\t\t\ttempMatrix.translate(cmd[1],cmd[2]);\r\n\t\t\t\t\tthis._switchMatrix(tMatrix,tempMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._translate:\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\ttempMatrix.identity();\r\n\t\t\t\t\ttempMatrix.translate(cmd[0],cmd[1]);\r\n\t\t\t\t\tthis._switchMatrix(tMatrix,tempMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._transform:\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\ttempMatrix.identity();\r\n\t\t\t\t\ttempMatrix.translate(-cmd[1],-cmd[2]);\r\n\t\t\t\t\ttempMatrix.concat(cmd[0]);\r\n\t\t\t\t\ttempMatrix.translate(cmd[1],cmd[2]);\r\n\t\t\t\t\tthis._switchMatrix(tMatrix,tempMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 16:\r\n\t\t\t\tcase 24:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 17:\r\n\t\t\t\t\ttMatrix.copyTo(tempMatrix);\r\n\t\t\t\t\ttempMatrix.concat(cmd[4]);\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tempMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawTexture:\r\n\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\tif (realSize){\r\n\t\t\t\t\t\tif (cmd[3] && cmd[4]){\r\n\t\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\twRate=(cmd[3] || tex.sourceWidth)/ tex.width;\r\n\t\t\t\t\t\thRate=(cmd[4] || tex.sourceHeight)/ tex.height;\r\n\t\t\t\t\t\toWidth=wRate *tex.sourceWidth;\r\n\t\t\t\t\t\toHeight=hRate *tex.sourceHeight;\r\n\t\t\t\t\t\toffX=tex.offsetX > 0 ? tex.offsetX :0;\r\n\t\t\t\t\t\toffY=tex.offsetY > 0 ? tex.offsetY :0;\r\n\t\t\t\t\t\toffX *=wRate;\r\n\t\t\t\t\t\toffY *=hRate;\r\n\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),tMatrix);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._fillTexture:\r\n\t\t\t\t\tif (cmd[3] && cmd[4]){\r\n\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawTextureWithTransform:;\r\n\t\t\t\t\tvar drawMatrix;\r\n\t\t\t\t\tif (cmd[5]){\r\n\t\t\t\t\t\ttMatrix.copyTo(tempMatrix);\r\n\t\t\t\t\t\ttempMatrix.concat(cmd[5]);\r\n\t\t\t\t\t\tdrawMatrix=tempMatrix;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tdrawMatrix=tMatrix;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (realSize){\r\n\t\t\t\t\t\tif (cmd[3] && cmd[4]){\r\n\t\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),drawMatrix);\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),drawMatrix);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\t\twRate=(cmd[3] || tex.sourceWidth)/ tex.width;\r\n\t\t\t\t\t\thRate=(cmd[4] || tex.sourceHeight)/ tex.height;\r\n\t\t\t\t\t\toWidth=wRate *tex.sourceWidth;\r\n\t\t\t\t\t\toHeight=hRate *tex.sourceHeight;\r\n\t\t\t\t\t\toffX=tex.offsetX > 0 ? tex.offsetX :0;\r\n\t\t\t\t\t\toffY=tex.offsetY > 0 ? tex.offsetY :0;\r\n\t\t\t\t\t\toffX *=wRate;\r\n\t\t\t\t\t\toffY *=hRate;\r\n\t\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),drawMatrix);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawRect:\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawCircle:\r\n\t\t\t\tcase context._fillCircle:\r\n\t\t\t\tcase 14:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0]-cmd[2],cmd[1]-cmd[2],cmd[2]+cmd[2],cmd[2]+cmd[2]),tMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawLine:\r\n\t\t\t\tcase 20:\r\n\t\t\t\t\tGraphicsBounds._tempPoints.length=0;\r\n\t\t\t\t\tvar lineWidth=NaN;\r\n\t\t\t\t\tlineWidth=cmd[5] *0.5;\r\n\t\t\t\t\tif (cmd[0]==cmd[2]){\r\n\t\t\t\t\t\tGraphicsBounds._tempPoints.push(cmd[0]+lineWidth,cmd[1],cmd[2]+lineWidth,cmd[3],cmd[0]-lineWidth,cmd[1],cmd[2]-lineWidth,cmd[3]);\r\n\t\t\t\t\t\t}else if (cmd[1]==cmd[3]){\r\n\t\t\t\t\t\tGraphicsBounds._tempPoints.push(cmd[0],cmd[1]+lineWidth,cmd[2],cmd[3]+lineWidth,cmd[0],cmd[1]-lineWidth,cmd[2],cmd[3]-lineWidth);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tGraphicsBounds._tempPoints.push(cmd[0],cmd[1],cmd[2],cmd[3]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,GraphicsBounds._tempPoints,tMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawCurves:\r\n\t\t\t\tcase 22:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,Bezier.I.getBezierPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawPoly:\r\n\t\t\t\tcase context._drawLines:\r\n\t\t\t\tcase 18:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,cmd[2],tMatrix,cmd[0],cmd[1]);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawPath:\r\n\t\t\t\tcase 19:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,this._getPathPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase context._drawPie:\r\n\t\t\t\tcase 15:\r\n\t\t\t\t\tGraphicsBounds._addPointArrToRst(rst,this._getPiePoints(cmd[0],cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\tif (rst.length > 200){\r\n\t\t\trst=Utils.copyArray(rst,Rectangle._getWrapRec(rst)._getBoundPoints());\r\n\t\t}else if (rst.length > 8)\r\n\t\trst=GrahamScan.scanPList(rst);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto._switchMatrix=function(tMatix,tempMatrix){\r\n\t\ttempMatrix.concat(tMatix);\r\n\t\ttempMatrix.copyTo(tMatix);\r\n\t}\r\n\r\n\t__proto._getPiePoints=function(x,y,radius,startAngle,endAngle){\r\n\t\tvar rst=GraphicsBounds._tempPoints;\r\n\t\tGraphicsBounds._tempPoints.length=0;\r\n\t\trst.push(x,y);\r\n\t\tvar delta=(endAngle-startAngle)% (2 *Math.PI);\r\n\t\tvar segnum=10;\r\n\t\tvar step=delta / segnum;\r\n\t\tvar i=NaN;\r\n\t\tvar angle=startAngle;\r\n\t\tfor (i=0;i <=segnum;i++){\r\n\t\t\trst.push(x+radius *Math.cos(angle),y+radius *Math.sin(angle));\r\n\t\t\tangle+=step;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__proto._getPathPoints=function(paths){\r\n\t\tvar i=0,len=0;\r\n\t\tvar rst=GraphicsBounds._tempPoints;\r\n\t\trst.length=0;\r\n\t\tlen=paths.length;\r\n\t\tvar tCMD;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttCMD=paths[i];\r\n\t\t\tif (tCMD.length > 1){\r\n\t\t\t\trst.push(tCMD[1],tCMD[2]);\r\n\t\t\t\tif (tCMD.length > 3){\r\n\t\t\t\t\trst.push(tCMD[3],tCMD[4]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGraphicsBounds._addPointArrToRst=function(rst,points,matrix,dx,dy){\r\n\t\t(dx===void 0)&& (dx=0);\r\n\t\t(dy===void 0)&& (dy=0);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=points.length;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\tGraphicsBounds._addPointToRst(rst,points[i]+dx,points[i+1]+dy,matrix);\r\n\t\t}\r\n\t}\r\n\r\n\tGraphicsBounds._addPointToRst=function(rst,x,y,matrix){\r\n\t\tvar _tempPoint=Point.TEMP;\r\n\t\t_tempPoint.setTo(x ? x :0,y ? y :0);\r\n\t\tmatrix.transformPoint(_tempPoint);\r\n\t\trst.push(_tempPoint.x,_tempPoint.y);\r\n\t}\r\n\r\n\tGraphicsBounds._tempPoints=[];\r\n\tGraphicsBounds._tempMatrixArrays=[];\r\n\tGraphicsBounds._tempCmds=[];\r\n\t__static(GraphicsBounds,\r\n\t['_tempMatrix',function(){return this._tempMatrix=new Matrix();},'_initMatrix',function(){return this._initMatrix=new Matrix();}\r\n\t]);\r\n\treturn GraphicsBounds;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Event</code> 是事件类型的集合。一般当发生事件时，<code>Event</code> 对象将作为参数传递给事件侦听器。\r\n*/\r\n//class laya.events.Event\r\nvar Event=(function(){\r\n\tfunction Event(){\r\n\t\t/**事件类型。*/\r\n\t\t//this.type=null;\r\n\t\t/**原生浏览器事件。*/\r\n\t\t//this.nativeEvent=null;\r\n\t\t/**事件目标触发对象。*/\r\n\t\t//this.target=null;\r\n\t\t/**事件当前冒泡对象。*/\r\n\t\t//this.currentTarget=null;\r\n\t\t/**@private */\r\n\t\t//this._stoped=false;\r\n\t\t/**分配给触摸点的唯一标识号（作为 int）。*/\r\n\t\t//this.touchId=0;\r\n\t\t/**键盘值*/\r\n\t\t//this.keyCode=0;\r\n\t\t/**滚轮滑动增量*/\r\n\t\t//this.delta=0;\r\n\t}\r\n\r\n\t__class(Event,'laya.events.Event');\r\n\tvar __proto=Event.prototype;\r\n\t/**\r\n\t*设置事件数据。\r\n\t*@param type 事件类型。\r\n\t*@param currentTarget 事件目标触发对象。\r\n\t*@param target 事件当前冒泡对象。\r\n\t*@return 返回当前 Event 对象。\r\n\t*/\r\n\t__proto.setTo=function(type,currentTarget,target){\r\n\t\tthis.type=type;\r\n\t\tthis.currentTarget=currentTarget;\r\n\t\tthis.target=target;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*阻止对事件流中当前节点的后续节点中的所有事件侦听器进行处理。此方法不会影响当前节点 (currentTarget)中的任何事件侦听器。\r\n\t*/\r\n\t__proto.stopPropagation=function(){\r\n\t\tthis._stoped=true;\r\n\t}\r\n\r\n\t/**鼠标在 Stage 上的 Y 轴坐标*/\r\n\t__getset(0,__proto,'stageY',function(){\r\n\t\treturn Laya.stage.mouseY;\r\n\t});\r\n\r\n\t/**\r\n\t*包含按下或释放的键的字符代码值。字符代码值为英文键盘值。\r\n\t*/\r\n\t__getset(0,__proto,'charCode',function(){\r\n\t\treturn this.nativeEvent.charCode;\r\n\t});\r\n\r\n\t/**\r\n\t*触摸点列表。\r\n\t*/\r\n\t__getset(0,__proto,'touches',function(){\r\n\t\tvar arr=this.nativeEvent.touches;\r\n\t\tif (arr){\r\n\t\t\tvar stage=Laya.stage;\r\n\t\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\t\tvar e=arr[i];\r\n\t\t\t\tvar point=Point.TEMP;\r\n\t\t\t\tpoint.setTo(e.clientX,e.clientY);\r\n\t\t\t\tstage._canvasTransform.invertTransformPoint(point);\r\n\t\t\t\tstage.transform.invertTransformPoint(point);\r\n\t\t\t\te.stageX=point.x;\r\n\t\t\t\te.stageY=point.y;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t});\r\n\r\n\t/**\r\n\t*表示键在键盘上的位置。这对于区分在键盘上多次出现的键非常有用。<br>\r\n\t*例如，您可以根据此属性的值来区分左 Shift 键和右 Shift 键：左 Shift 键的值为 KeyLocation.LEFT，右 Shift 键的值为 KeyLocation.RIGHT。另一个示例是区分标准键盘 (KeyLocation.STANDARD)与数字键盘 (KeyLocation.NUM_PAD)上按下的数字键。\r\n\t*/\r\n\t__getset(0,__proto,'keyLocation',function(){\r\n\t\treturn this.nativeEvent.keyLocation;\r\n\t});\r\n\r\n\t/**\r\n\t*表示 Ctrl 键是处于活动状态 (true)还是非活动状态 (false)。\r\n\t*/\r\n\t__getset(0,__proto,'ctrlKey',function(){\r\n\t\treturn this.nativeEvent.ctrlKey;\r\n\t});\r\n\r\n\t/**\r\n\t*表示 Alt 键是处于活动状态 (true)还是非活动状态 (false)。\r\n\t*/\r\n\t__getset(0,__proto,'altKey',function(){\r\n\t\treturn this.nativeEvent.altKey;\r\n\t});\r\n\r\n\t/**\r\n\t*表示 Shift 键是处于活动状态 (true)还是非活动状态 (false)。\r\n\t*/\r\n\t__getset(0,__proto,'shiftKey',function(){\r\n\t\treturn this.nativeEvent.shiftKey;\r\n\t});\r\n\r\n\t/**鼠标在 Stage 上的 X 轴坐标*/\r\n\t__getset(0,__proto,'stageX',function(){\r\n\t\treturn Laya.stage.mouseX;\r\n\t});\r\n\r\n\tEvent.MOUSE_DOWN=\"mousedown\";\r\n\tEvent.MOUSE_UP=\"mouseup\";\r\n\tEvent.CLICK=\"click\";\r\n\tEvent.RIGHT_MOUSE_DOWN=\"rightmousedown\";\r\n\tEvent.RIGHT_MOUSE_UP=\"rightmouseup\";\r\n\tEvent.RIGHT_CLICK=\"rightclick\";\r\n\tEvent.MOUSE_MOVE=\"mousemove\";\r\n\tEvent.MOUSE_OVER=\"mouseover\";\r\n\tEvent.MOUSE_OUT=\"mouseout\";\r\n\tEvent.MOUSE_WHEEL=\"mousewheel\";\r\n\tEvent.ROLL_OVER=\"mouseover\";\r\n\tEvent.ROLL_OUT=\"mouseout\";\r\n\tEvent.DOUBLE_CLICK=\"doubleclick\";\r\n\tEvent.CHANGE=\"change\";\r\n\tEvent.CHANGED=\"changed\";\r\n\tEvent.RESIZE=\"resize\";\r\n\tEvent.ADDED=\"added\";\r\n\tEvent.REMOVED=\"removed\";\r\n\tEvent.DISPLAY=\"display\";\r\n\tEvent.UNDISPLAY=\"undisplay\";\r\n\tEvent.ERROR=\"error\";\r\n\tEvent.COMPLETE=\"complete\";\r\n\tEvent.LOADED=\"loaded\";\r\n\tEvent.PROGRESS=\"progress\";\r\n\tEvent.INPUT=\"input\";\r\n\tEvent.RENDER=\"render\";\r\n\tEvent.OPEN=\"open\";\r\n\tEvent.MESSAGE=\"message\";\r\n\tEvent.CLOSE=\"close\";\r\n\tEvent.KEY_DOWN=\"keydown\";\r\n\tEvent.KEY_PRESS=\"keypress\";\r\n\tEvent.KEY_UP=\"keyup\";\r\n\tEvent.FRAME=\"enterframe\";\r\n\tEvent.DRAG_START=\"dragstart\";\r\n\tEvent.DRAG_MOVE=\"dragmove\";\r\n\tEvent.DRAG_END=\"dragend\";\r\n\tEvent.ENTER=\"enter\";\r\n\tEvent.SELECT=\"select\";\r\n\tEvent.BLUR=\"blur\";\r\n\tEvent.FOCUS=\"focus\";\r\n\tEvent.VISIBILITY_CHANGE=\"visibilitychange\";\r\n\tEvent.FOCUS_CHANGE=\"focuschange\";\r\n\tEvent.PLAYED=\"played\";\r\n\tEvent.PAUSED=\"paused\";\r\n\tEvent.STOPPED=\"stopped\";\r\n\tEvent.START=\"start\";\r\n\tEvent.END=\"end\";\r\n\tEvent.ENABLE_CHANGED=\"enablechanged\";\r\n\tEvent.ACTIVE_IN_HIERARCHY_CHANGED=\"activeinhierarchychanged\";\r\n\tEvent.COMPONENT_ADDED=\"componentadded\";\r\n\tEvent.COMPONENT_REMOVED=\"componentremoved\";\r\n\tEvent.LAYER_CHANGED=\"layerchanged\";\r\n\tEvent.HIERARCHY_LOADED=\"hierarchyloaded\";\r\n\tEvent.RECOVERED=\"recovered\";\r\n\tEvent.RELEASED=\"released\";\r\n\tEvent.LINK=\"link\";\r\n\tEvent.LABEL=\"label\";\r\n\tEvent.FULL_SCREEN_CHANGE=\"fullscreenchange\";\r\n\tEvent.DEVICE_LOST=\"devicelost\";\r\n\tEvent.MESH_CHANGED=\"meshchanged\";\r\n\tEvent.MATERIAL_CHANGED=\"materialchanged\";\r\n\tEvent.WORLDMATRIX_NEEDCHANGE=\"worldmatrixneedchanged\";\r\n\tEvent.ANIMATION_CHANGED=\"animationchanged\";\r\n\tEvent.TRIGGER_ENTER=\"triggerenter\";\r\n\tEvent.TRIGGER_STAY=\"triggerstay\";\r\n\tEvent.TRIGGER_EXIT=\"triggerexit\";\r\n\tEvent.TRAIL_Filter_CHANGE=\"trailfilterchange\";\r\n\t__static(Event,\r\n\t['EMPTY',function(){return this.EMPTY=new Event();}\r\n\t]);\r\n\treturn Event;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Keyboard</code> 类的属性是一些常数，这些常数表示控制游戏时最常用的键。\r\n*/\r\n//class laya.events.Keyboard\r\nvar Keyboard=(function(){\r\n\tfunction Keyboard(){}\r\n\t__class(Keyboard,'laya.events.Keyboard');\r\n\tKeyboard.NUMBER_0=48;\r\n\tKeyboard.NUMBER_1=49;\r\n\tKeyboard.NUMBER_2=50;\r\n\tKeyboard.NUMBER_3=51;\r\n\tKeyboard.NUMBER_4=52;\r\n\tKeyboard.NUMBER_5=53;\r\n\tKeyboard.NUMBER_6=54;\r\n\tKeyboard.NUMBER_7=55;\r\n\tKeyboard.NUMBER_8=56;\r\n\tKeyboard.NUMBER_9=57;\r\n\tKeyboard.A=65;\r\n\tKeyboard.B=66;\r\n\tKeyboard.C=67;\r\n\tKeyboard.D=68;\r\n\tKeyboard.E=69;\r\n\tKeyboard.F=70;\r\n\tKeyboard.G=71;\r\n\tKeyboard.H=72;\r\n\tKeyboard.I=73;\r\n\tKeyboard.J=74;\r\n\tKeyboard.K=75;\r\n\tKeyboard.L=76;\r\n\tKeyboard.M=77;\r\n\tKeyboard.N=78;\r\n\tKeyboard.O=79;\r\n\tKeyboard.P=80;\r\n\tKeyboard.Q=81;\r\n\tKeyboard.R=82;\r\n\tKeyboard.S=83;\r\n\tKeyboard.T=84;\r\n\tKeyboard.U=85;\r\n\tKeyboard.V=86;\r\n\tKeyboard.W=87;\r\n\tKeyboard.X=88;\r\n\tKeyboard.Y=89;\r\n\tKeyboard.Z=90;\r\n\tKeyboard.F1=112;\r\n\tKeyboard.F2=113;\r\n\tKeyboard.F3=114;\r\n\tKeyboard.F4=115;\r\n\tKeyboard.F5=116;\r\n\tKeyboard.F6=117;\r\n\tKeyboard.F7=118;\r\n\tKeyboard.F8=119;\r\n\tKeyboard.F9=120;\r\n\tKeyboard.F10=121;\r\n\tKeyboard.F11=122;\r\n\tKeyboard.F12=123;\r\n\tKeyboard.F13=124;\r\n\tKeyboard.F14=125;\r\n\tKeyboard.F15=126;\r\n\tKeyboard.NUMPAD=21;\r\n\tKeyboard.NUMPAD_0=96;\r\n\tKeyboard.NUMPAD_1=97;\r\n\tKeyboard.NUMPAD_2=98;\r\n\tKeyboard.NUMPAD_3=99;\r\n\tKeyboard.NUMPAD_4=100;\r\n\tKeyboard.NUMPAD_5=101;\r\n\tKeyboard.NUMPAD_6=102;\r\n\tKeyboard.NUMPAD_7=103;\r\n\tKeyboard.NUMPAD_8=104;\r\n\tKeyboard.NUMPAD_9=105;\r\n\tKeyboard.NUMPAD_ADD=107;\r\n\tKeyboard.NUMPAD_DECIMAL=110;\r\n\tKeyboard.NUMPAD_DIVIDE=111;\r\n\tKeyboard.NUMPAD_ENTER=108;\r\n\tKeyboard.NUMPAD_MULTIPLY=106;\r\n\tKeyboard.NUMPAD_SUBTRACT=109;\r\n\tKeyboard.SEMICOLON=186;\r\n\tKeyboard.EQUAL=187;\r\n\tKeyboard.COMMA=188;\r\n\tKeyboard.MINUS=189;\r\n\tKeyboard.PERIOD=190;\r\n\tKeyboard.SLASH=191;\r\n\tKeyboard.BACKQUOTE=192;\r\n\tKeyboard.LEFTBRACKET=219;\r\n\tKeyboard.BACKSLASH=220;\r\n\tKeyboard.RIGHTBRACKET=221;\r\n\tKeyboard.QUOTE=222;\r\n\tKeyboard.ALTERNATE=18;\r\n\tKeyboard.BACKSPACE=8;\r\n\tKeyboard.CAPS_LOCK=20;\r\n\tKeyboard.COMMAND=15;\r\n\tKeyboard.CONTROL=17;\r\n\tKeyboard.DELETE=46;\r\n\tKeyboard.ENTER=13;\r\n\tKeyboard.ESCAPE=27;\r\n\tKeyboard.PAGE_UP=33;\r\n\tKeyboard.PAGE_DOWN=34;\r\n\tKeyboard.END=35;\r\n\tKeyboard.HOME=36;\r\n\tKeyboard.LEFT=37;\r\n\tKeyboard.UP=38;\r\n\tKeyboard.RIGHT=39;\r\n\tKeyboard.DOWN=40;\r\n\tKeyboard.SHIFT=16;\r\n\tKeyboard.SPACE=32;\r\n\tKeyboard.TAB=9;\r\n\tKeyboard.INSERT=45;\r\n\treturn Keyboard;\r\n})()\r\n\r\n\r\n/**\r\n*<p><code>KeyBoardManager</code> 是键盘事件管理类。该类从浏览器中接收键盘事件，并派发该事件。</p>\r\n*<p>派发事件时若 Stage.focus 为空则只从 Stage 上派发该事件，否则将从 Stage.focus 对象开始一直冒泡派发该事件。所以在 Laya.stage 上监听键盘事件一定能够收到，如果在其他地方监听，则必须处在Stage.focus的冒泡链上才能收到该事件。</p>\r\n*<p>用户可以通过代码 Laya.stage.focus=someNode 的方式来设置focus对象。</p>\r\n*<p>用户可统一的根据事件对象中 e.keyCode 来判断按键类型，该属性兼容了不同浏览器的实现。</p>\r\n*/\r\n//class laya.events.KeyBoardManager\r\nvar KeyBoardManager=(function(){\r\n\tfunction KeyBoardManager(){}\r\n\t__class(KeyBoardManager,'laya.events.KeyBoardManager');\r\n\tKeyBoardManager.__init__=function(){\r\n\t\tKeyBoardManager._addEvent(\"keydown\");\r\n\t\tKeyBoardManager._addEvent(\"keypress\");\r\n\t\tKeyBoardManager._addEvent(\"keyup\");\r\n\t}\r\n\r\n\tKeyBoardManager._addEvent=function(type){\r\n\t\tBrowser.document.addEventListener(type,function(e){\r\n\t\t\tlaya.events.KeyBoardManager._dispatch(e,type);\r\n\t\t},true);\r\n\t}\r\n\r\n\tKeyBoardManager._dispatch=function(e,type){\r\n\t\tif (!KeyBoardManager.enabled)return;\r\n\t\tKeyBoardManager._event._stoped=false;\r\n\t\tKeyBoardManager._event.nativeEvent=e;\r\n\t\tKeyBoardManager._event.keyCode=e.keyCode || e.which || e.charCode;\r\n\t\tif (type===\"keydown\")KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=true;\r\n\t\telse if (type===\"keyup\")KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=null;\r\n\t\tvar target=(Laya.stage.focus && (Laya.stage.focus.event !=null)&& Laya.stage.focus.displayedInStage)? Laya.stage.focus :Laya.stage;\r\n\t\tvar ct=target;\r\n\t\twhile (ct){\r\n\t\t\tct.event(type,KeyBoardManager._event.setTo(type,ct,target));\r\n\t\t\tct=ct.parent;\r\n\t\t}\r\n\t}\r\n\r\n\tKeyBoardManager.hasKeyDown=function(key){\r\n\t\treturn KeyBoardManager._pressKeys[key];\r\n\t}\r\n\r\n\tKeyBoardManager._pressKeys={};\r\n\tKeyBoardManager.enabled=true;\r\n\t__static(KeyBoardManager,\r\n\t['_event',function(){return this._event=new Event();}\r\n\t]);\r\n\treturn KeyBoardManager;\r\n})()\r\n\r\n\r\n/**\r\n*<p><code>KeyLocation</code> 类包含表示在键盘或类似键盘的输入设备上按键位置的常量。</p>\r\n*<p><code>KeyLocation</code> 常数用在键盘事件对象的 <code>keyLocation </code>属性中。</p>\r\n*/\r\n//class laya.events.KeyLocation\r\nvar KeyLocation=(function(){\r\n\tfunction KeyLocation(){}\r\n\t__class(KeyLocation,'laya.events.KeyLocation');\r\n\tKeyLocation.STANDARD=0;\r\n\tKeyLocation.LEFT=1;\r\n\tKeyLocation.RIGHT=2;\r\n\tKeyLocation.NUM_PAD=3;\r\n\treturn KeyLocation;\r\n})()\r\n\r\n\r\n/**\r\n*<p><code>MouseManager</code> 是鼠标、触摸交互管理器。</p>\r\n*<p>鼠标事件流包括捕获阶段、目标阶段、冒泡阶段。<br/>\r\n*捕获阶段：此阶段引擎会从stage开始递归检测stage及其子对象，直到找到命中的目标对象或者未命中任何对象；<br/>\r\n*目标阶段：找到命中的目标对象；<br/>\r\n*冒泡阶段：事件离开目标对象，按节点层级向上逐层通知，直到到达舞台的过程。</p>\r\n*/\r\n//class laya.events.MouseManager\r\nvar MouseManager=(function(){\r\n\tfunction MouseManager(){\r\n\t\t/**canvas 上的鼠标X坐标。*/\r\n\t\tthis.mouseX=0;\r\n\t\t/**canvas 上的鼠标Y坐标。*/\r\n\t\tthis.mouseY=0;\r\n\t\t/**是否禁用除 stage 以外的鼠标事件检测。*/\r\n\t\tthis.disableMouseEvent=false;\r\n\t\t/**鼠标按下的时间。单位为毫秒。*/\r\n\t\tthis.mouseDownTime=0;\r\n\t\t/**鼠标移动精度。*/\r\n\t\tthis.mouseMoveAccuracy=2;\r\n\t\tthis._stage=null;\r\n\t\tthis._target=null;\r\n\t\tthis._lastMoveTimer=0;\r\n\t\tthis._isLeftMouse=false;\r\n\t\tthis._eventList=[];\r\n\t\tthis._touchIDs={};\r\n\t\tthis._id=1;\r\n\t\tthis._tTouchID=0;\r\n\t\tthis._event=new Event();\r\n\t\tthis._matrix=new Matrix();\r\n\t\tthis._point=new Point();\r\n\t\tthis._rect=new Rectangle();\r\n\t\tthis._prePoint=new Point();\r\n\t\tthis._curTouchID=NaN;\r\n\t}\r\n\r\n\t__class(MouseManager,'laya.events.MouseManager');\r\n\tvar __proto=MouseManager.prototype;\r\n\t/**\r\n\t*@private\r\n\t*初始化。\r\n\t*/\r\n\t__proto.__init__=function(stage,canvas){\r\n\t\tvar _$this=this;\r\n\t\tthis._stage=stage;\r\n\t\tvar _this=this;\r\n\t\tvar list=this._eventList;\r\n\t\tcanvas.oncontextmenu=function (e){\r\n\t\t\tif (MouseManager.enabled)return false;\r\n\t\t}\r\n\t\tcanvas.addEventListener('mousedown',function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\tif(!Browser.onIE)e.preventDefault();\r\n\t\t\t\tlist.push(e);\r\n\t\t\t\t_this.mouseDownTime=Browser.now();\r\n\t\t\t}\r\n\t\t});\r\n\t\tcanvas.addEventListener('mouseup',function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tlist.push(e);\r\n\t\t\t\t_this.mouseDownTime=-Browser.now();\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tcanvas.addEventListener('mousemove',function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar now=Browser.now();\r\n\t\t\t\tif (now-_this._lastMoveTimer < 10)return;\r\n\t\t\t\t_this._lastMoveTimer=now;\r\n\t\t\t\tlist.push(e);\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tcanvas.addEventListener(\"mouseout\",function(e){\r\n\t\t\tif (MouseManager.enabled)list.push(e);\r\n\t\t})\r\n\t\tcanvas.addEventListener(\"mouseover\",function(e){\r\n\t\t\tif (MouseManager.enabled)list.push(e);\r\n\t\t})\r\n\t\tcanvas.addEventListener(\"touchstart\",function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\tlist.push(e);\r\n\t\t\t\tif (!MouseManager._isFirstTouch&&!Input.isInputting)e.preventDefault();\r\n\t\t\t\t_this.mouseDownTime=Browser.now();\r\n\t\t\t}\r\n\t\t});\r\n\t\tcanvas.addEventListener(\"touchend\",function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\tif (!MouseManager._isFirstTouch&&!Input.isInputting)e.preventDefault();\r\n\t\t\t\tMouseManager._isFirstTouch=false;\r\n\t\t\t\tlist.push(e);\r\n\t\t\t\t_this.mouseDownTime=-Browser.now();\r\n\t\t\t\t}else {\r\n\t\t\t\t_$this._curTouchID=NaN;\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tcanvas.addEventListener(\"touchmove\",function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tlist.push(e);\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tcanvas.addEventListener(\"touchcancel\",function(e){\r\n\t\t\tif (MouseManager.enabled){\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tlist.push(e);\r\n\t\t\t\t}else {\r\n\t\t\t\t_$this._curTouchID=NaN;\r\n\t\t\t}\r\n\t\t},true);\r\n\t\tcanvas.addEventListener('mousewheel',function(e){\r\n\t\t\tif (MouseManager.enabled)list.push(e);\r\n\t\t});\r\n\t\tcanvas.addEventListener('DOMMouseScroll',function(e){\r\n\t\t\tif (MouseManager.enabled)list.push(e);\r\n\t\t});\r\n\t}\r\n\r\n\t__proto.initEvent=function(e,nativeEvent){\r\n\t\tvar _this=this;\r\n\t\t_this._event._stoped=false;\r\n\t\t_this._event.nativeEvent=nativeEvent || e;\r\n\t\t_this._target=null;\r\n\t\tthis._point.setTo(e.pageX || e.clientX,e.pageY || e.clientY);\r\n\t\tthis._stage._canvasTransform.invertTransformPoint(this._point);\r\n\t\t_this.mouseX=this._point.x;\r\n\t\t_this.mouseY=this._point.y;\r\n\t\t_this._event.touchId=e.identifier || 0;\r\n\t\tthis._tTouchID=_this._event.touchId;\r\n\t\tvar evt;\r\n\t\tevt=TouchManager.I._event;\r\n\t\tevt._stoped=false;\r\n\t\tevt.nativeEvent=_this._event.nativeEvent;\r\n\t\tevt.touchId=_this._event.touchId;\r\n\t}\r\n\r\n\t__proto.checkMouseWheel=function(e){\r\n\t\tthis._event.delta=e.wheelDelta ? e.wheelDelta *0.025 :-e.detail;\r\n\t\tvar _lastOvers=TouchManager.I.getLastOvers();\r\n\t\tfor (var i=0,n=_lastOvers.length;i < n;i++){\r\n\t\t\tvar ele=_lastOvers[i];\r\n\t\t\tele.event(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",this._event.setTo(/*laya.events.Event.MOUSE_WHEEL*/\"mousewheel\",ele,this._target));\r\n\t\t}\r\n\t}\r\n\r\n\t// _stage.event(Event.MOUSE_WHEEL,_event.setTo(Event.MOUSE_WHEEL,_stage,_target));\r\n\t__proto.onMouseMove=function(ele){\r\n\t\tTouchManager.I.onMouseMove(ele,this._tTouchID);\r\n\t}\r\n\r\n\t__proto.onMouseDown=function(ele){\r\n\t\tif (Input.isInputting && Laya.stage.focus && Laya.stage.focus[\"focus\"] && !Laya.stage.focus.contains(this._target)){\r\n\t\t\tvar pre_input=Laya.stage.focus['_tf'] || Laya.stage.focus;\r\n\t\t\tvar new_input=ele['_tf'] || ele;\r\n\t\t\tif ((new_input instanceof laya.display.Input )&& new_input.multiline==pre_input.multiline)\r\n\t\t\t\tpre_input['_focusOut']();\r\n\t\t\telse\r\n\t\t\tpre_input.focus=false;\r\n\t\t}\r\n\t\tTouchManager.I.onMouseDown(ele,this._tTouchID,this._isLeftMouse);\r\n\t}\r\n\r\n\t__proto.onMouseUp=function(ele){\r\n\t\tTouchManager.I.onMouseUp(ele,this._tTouchID,this._isLeftMouse);\r\n\t}\r\n\r\n\t__proto.check=function(sp,mouseX,mouseY,callBack){\r\n\t\tthis._point.setTo(mouseX,mouseY);\r\n\t\tsp.fromParentPoint(this._point);\r\n\t\tmouseX=this._point.x;\r\n\t\tmouseY=this._point.y;\r\n\t\tvar scrollRect=sp.scrollRect;\r\n\t\tif (scrollRect){\r\n\t\t\tthis._rect.setTo(scrollRect.x,scrollRect.y,scrollRect.width,scrollRect.height);\r\n\t\t\tif (!this._rect.contains(mouseX,mouseY))return false;\r\n\t\t}\r\n\t\tif (!this.disableMouseEvent){\r\n\t\t\tif (sp.hitTestPrior && !sp.mouseThrough && !this.hitTest(sp,mouseX,mouseY)){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i=sp._childs.length-1;i >-1;i--){\r\n\t\t\t\tvar child=sp._childs[i];\r\n\t\t\t\tif (!child.destroyed && child.mouseEnabled && child.visible){\r\n\t\t\t\t\tif (this.check(child,mouseX,mouseY,callBack))return true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar isHit=(sp.hitTestPrior && !sp.mouseThrough && !this.disableMouseEvent)? true :this.hitTest(sp,mouseX,mouseY);\r\n\t\tif (isHit){\r\n\t\t\tthis._target=sp;\r\n\t\t\tcallBack.call(this,sp);\r\n\t\t\t}else if (callBack===this.onMouseUp && sp===this._stage){\r\n\t\t\tthis._target=this._stage;\r\n\t\t\tcallBack.call(this,this._target);\r\n\t\t}\r\n\t\treturn isHit;\r\n\t}\r\n\r\n\t__proto.hitTest=function(sp,mouseX,mouseY){\r\n\t\tvar isHit=false;\r\n\t\tif (sp.scrollRect){\r\n\t\t\tmouseX-=sp.scrollRect.x;\r\n\t\t\tmouseY-=sp.scrollRect.y;\r\n\t\t}\r\n\t\tif ((sp.hitArea instanceof laya.utils.HitArea )){\r\n\t\t\treturn sp.hitArea.isHit(mouseX,mouseY);\r\n\t\t}\r\n\t\tif (sp.width > 0 && sp.height > 0 || sp.mouseThrough || sp.hitArea){\r\n\t\t\tif (!sp.mouseThrough){\r\n\t\t\t\tvar hitRect=this._rect;\r\n\t\t\t\tif (sp.hitArea)hitRect=sp.hitArea;\r\n\t\t\t\telse hitRect.setTo(0,0,sp.width,sp.height);\r\n\t\t\t\tisHit=hitRect.contains(mouseX,mouseY);\r\n\t\t\t\t}else {\r\n\t\t\t\tisHit=sp.getGraphicBounds().contains(mouseX,mouseY);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn isHit;\r\n\t}\r\n\r\n\t/**\r\n\t*执行事件处理。\r\n\t*/\r\n\t__proto.runEvent=function(){\r\n\t\tvar len=this._eventList.length;\r\n\t\tif (!len)return;\r\n\t\tvar _this=this;\r\n\t\tvar i=0,j=0,n=0,touch;\r\n\t\twhile (i < len){\r\n\t\t\tvar evt=this._eventList[i];\r\n\t\t\tif (evt.type!=='mousemove')this._prePoint.x=this._prePoint.y=-1000000;\r\n\t\t\tswitch (evt.type){\r\n\t\t\t\tcase 'mousedown':\r\n\t\t\t\t\tthis._touchIDs[0]=this._id++;\r\n\t\t\t\t\tif (!MouseManager._isTouchRespond){\r\n\t\t\t\t\t\t_this._isLeftMouse=evt.button===0;\r\n\t\t\t\t\t\t_this.initEvent(evt);\r\n\t\t\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseDown);\r\n\t\t\t\t\t}else\r\n\t\t\t\t\tMouseManager._isTouchRespond=false;\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'mouseup':\r\n\t\t\t\t\t_this._isLeftMouse=evt.button===0;\r\n\t\t\t\t\t_this.initEvent(evt);\r\n\t\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseUp);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'mousemove':\r\n\t\t\t\t\tif ((Math.abs(this._prePoint.x-evt.clientX)+Math.abs(this._prePoint.y-evt.clientY))>=this.mouseMoveAccuracy){\r\n\t\t\t\t\t\tthis._prePoint.x=evt.clientX;\r\n\t\t\t\t\t\tthis._prePoint.y=evt.clientY;\r\n\t\t\t\t\t\t_this.initEvent(evt);\r\n\t\t\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseMove);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"touchstart\":\r\n\t\t\t\t\tMouseManager._isTouchRespond=true;\r\n\t\t\t\t\t_this._isLeftMouse=true;\r\n\t\t\t\t\tvar touches=evt.changedTouches;\r\n\t\t\t\t\tfor (j=0,n=touches.length;j < n;j++){\r\n\t\t\t\t\t\ttouch=touches[j];\r\n\t\t\t\t\t\tif (MouseManager.multiTouchEnabled || isNaN(this._curTouchID)){\r\n\t\t\t\t\t\t\tthis._curTouchID=touch.identifier;\r\n\t\t\t\t\t\t\tif (this._id % 200===0)this._touchIDs={};\r\n\t\t\t\t\t\t\tthis._touchIDs[touch.identifier]=this._id++;\r\n\t\t\t\t\t\t\t_this.initEvent(touch,evt);\r\n\t\t\t\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseDown);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"touchend\":\r\n\t\t\t\tcase \"touchcancel\":\r\n\t\t\t\t\tMouseManager._isTouchRespond=true;\r\n\t\t\t\t\t_this._isLeftMouse=true;\r\n\t\t\t\t\tvar touchends=evt.changedTouches;\r\n\t\t\t\t\tfor (j=0,n=touchends.length;j < n;j++){\r\n\t\t\t\t\t\ttouch=touchends[j];\r\n\t\t\t\t\t\tif (MouseManager.multiTouchEnabled || touch.identifier==this._curTouchID){\r\n\t\t\t\t\t\t\tthis._curTouchID=NaN;\r\n\t\t\t\t\t\t\t_this.initEvent(touch,evt);\r\n\t\t\t\t\t\t\tvar isChecked=false;\r\n\t\t\t\t\t\t\tisChecked=_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseUp);\r\n\t\t\t\t\t\t\tif (!isChecked){\r\n\t\t\t\t\t\t\t\t_this.onMouseUp(null);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"touchmove\":;\r\n\t\t\t\t\tvar touchemoves=evt.changedTouches;\r\n\t\t\t\t\tfor (j=0,n=touchemoves.length;j < n;j++){\r\n\t\t\t\t\t\ttouch=touchemoves[j];\r\n\t\t\t\t\t\tif (MouseManager.multiTouchEnabled || touch.identifier==this._curTouchID){\r\n\t\t\t\t\t\t\t_this.initEvent(touch,evt);\r\n\t\t\t\t\t\t\t_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseMove);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"wheel\":\r\n\t\t\t\tcase \"mousewheel\":\r\n\t\t\t\tcase \"DOMMouseScroll\":\r\n\t\t\t\t\t_this.checkMouseWheel(evt);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"mouseout\":\r\n\t\t\t\t\tTouchManager.I.stageMouseOut();\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"mouseover\":\r\n\t\t\t\t\t_this._stage.event(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",_this._event.setTo(/*laya.events.Event.MOUSE_OVER*/\"mouseover\",_this._stage,_this._stage));\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tthis._eventList.length=0;\r\n\t}\r\n\r\n\tMouseManager.enabled=true;\r\n\tMouseManager.multiTouchEnabled=true;\r\n\tMouseManager._isTouchRespond=false;\r\n\tMouseManager._isFirstTouch=true;\r\n\t__static(MouseManager,\r\n\t['instance',function(){return this.instance=new MouseManager();}\r\n\t]);\r\n\treturn MouseManager;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*Touch事件管理类，处理多点触控下的鼠标事件\r\n*/\r\n//class laya.events.TouchManager\r\nvar TouchManager=(function(){\r\n\tfunction TouchManager(){\r\n\t\t/**\r\n\t\t*当前over的touch表\r\n\t\t*/\r\n\t\tthis.preOvers=[];\r\n\t\t/**\r\n\t\t*当前down的touch表\r\n\t\t*/\r\n\t\tthis.preDowns=[];\r\n\t\tthis.preRightDowns=[];\r\n\t\t/**\r\n\t\t*是否启用\r\n\t\t*/\r\n\t\tthis.enable=true;\r\n\t\tthis._lastClickTime=0;\r\n\t\tthis._event=new Event();\r\n\t}\r\n\r\n\t__class(TouchManager,'laya.events.TouchManager');\r\n\tvar __proto=TouchManager.prototype;\r\n\t__proto._clearTempArrs=function(){\r\n\t\tTouchManager._oldArr.length=0;\r\n\t\tTouchManager._newArr.length=0;\r\n\t\tTouchManager._tEleArr.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*从touch表里查找对应touchID的数据\r\n\t*@param touchID touch ID\r\n\t*@param arr touch表\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.getTouchFromArr=function(touchID,arr){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=arr.length;\r\n\t\tvar tTouchO;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttTouchO=arr[i];\r\n\t\t\tif (tTouchO.id==touchID){\r\n\t\t\t\treturn tTouchO;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*从touch表里移除一个元素\r\n\t*@param touchID touch ID\r\n\t*@param arr touch表\r\n\t*\r\n\t*/\r\n\t__proto.removeTouchFromArr=function(touchID,arr){\r\n\t\tvar i=0;\r\n\t\tfor (i=arr.length-1;i >=0;i--){\r\n\t\t\tif (arr[i].id==touchID){\r\n\t\t\t\tarr.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*创建一个touch数据\r\n\t*@param ele 当前的根节点\r\n\t*@param touchID touchID\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.createTouchO=function(ele,touchID){\r\n\t\tvar rst;\r\n\t\trst=Pool.getItem(\"TouchData\")|| {};\r\n\t\trst.id=touchID;\r\n\t\trst.tar=ele;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*处理touchStart\r\n\t*@param ele 根节点\r\n\t*@param touchID touchID\r\n\t*@param isLeft （可选）是否为左键\r\n\t*/\r\n\t__proto.onMouseDown=function(ele,touchID,isLeft){\r\n\t\t(isLeft===void 0)&& (isLeft=false);\r\n\t\tif (!this.enable)\r\n\t\t\treturn;\r\n\t\tvar preO;\r\n\t\tvar tO;\r\n\t\tvar arrs;\r\n\t\tpreO=this.getTouchFromArr(touchID,this.preOvers);\r\n\t\tarrs=this.getEles(ele,null,TouchManager._tEleArr);\r\n\t\tif (!preO){\r\n\t\t\ttO=this.createTouchO(ele,touchID);\r\n\t\t\tthis.preOvers.push(tO);\r\n\t\t\t}else {\r\n\t\t\tpreO.tar=ele;\r\n\t\t}\r\n\t\tif (Browser.onMobile)\r\n\t\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_OVER*/\"mouseover\",touchID);\r\n\t\tvar preDowns;\r\n\t\tpreDowns=isLeft ? this.preDowns :this.preRightDowns;\r\n\t\tpreO=this.getTouchFromArr(touchID,preDowns);\r\n\t\tif (!preO){\r\n\t\t\ttO=this.createTouchO(ele,touchID);\r\n\t\t\tpreDowns.push(tO);\r\n\t\t\t}else {\r\n\t\t\tpreO.tar=ele;\r\n\t\t}\r\n\t\tthis.sendEvents(arrs,isLeft ? /*laya.events.Event.MOUSE_DOWN*/\"mousedown\" :/*laya.events.Event.RIGHT_MOUSE_DOWN*/\"rightmousedown\",touchID);\r\n\t\tthis._clearTempArrs();\r\n\t}\r\n\r\n\t/**\r\n\t*派发事件。\r\n\t*@param eles 对象列表。\r\n\t*@param type 事件类型。\r\n\t*@param touchID （可选）touchID，默认为0。\r\n\t*/\r\n\t__proto.sendEvents=function(eles,type,touchID){\r\n\t\t(touchID===void 0)&& (touchID=0);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=eles.length;\r\n\t\tthis._event._stoped=false;\r\n\t\tvar _target;\r\n\t\t_target=eles[0];\r\n\t\tvar tE;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttE=eles[i];\r\n\t\t\tif (tE.destroyed)return;\r\n\t\t\ttE.event(type,this._event.setTo(type,tE,_target));\r\n\t\t\tif (this._event._stoped)\r\n\t\t\t\tbreak ;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取对象列表。\r\n\t*@param start 起始节点。\r\n\t*@param end 结束节点。\r\n\t*@param rst 返回值。如果此值不为空，则将其赋值为计算结果，从而避免创建新数组；如果此值为空，则创建新数组返回。\r\n\t*@return Array 返回节点列表。\r\n\t*/\r\n\t__proto.getEles=function(start,end,rst){\r\n\t\tif (!rst){\r\n\t\t\trst=[];\r\n\t\t\t}else {\r\n\t\t\trst.length=0;\r\n\t\t}\r\n\t\twhile (start && start !=end){\r\n\t\t\trst.push(start);\r\n\t\t\tstart=start.parent;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*touchMove时处理out事件和over时间。\r\n\t*@param eleNew 新的根节点。\r\n\t*@param elePre 旧的根节点。\r\n\t*@param touchID （可选）touchID，默认为0。\r\n\t*/\r\n\t__proto.checkMouseOutAndOverOfMove=function(eleNew,elePre,touchID){\r\n\t\t(touchID===void 0)&& (touchID=0);\r\n\t\tif (elePre==eleNew)\r\n\t\t\treturn;\r\n\t\tvar tar;\r\n\t\tvar arrs;\r\n\t\tvar i=0,len=0;\r\n\t\tif (elePre.contains(eleNew)){\r\n\t\t\tarrs=this.getEles(eleNew,elePre,TouchManager._tEleArr);\r\n\t\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_OVER*/\"mouseover\",touchID);\r\n\t\t\t}else if (eleNew.contains(elePre)){\r\n\t\t\tarrs=this.getEles(elePre,eleNew,TouchManager._tEleArr);\r\n\t\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_OUT*/\"mouseout\",touchID);\r\n\t\t\t}else {\r\n\t\t\tarrs=TouchManager._tEleArr;\r\n\t\t\tarrs.length=0;\r\n\t\t\tvar oldArr;\r\n\t\t\toldArr=this.getEles(elePre,null,TouchManager._oldArr);\r\n\t\t\tvar newArr;\r\n\t\t\tnewArr=this.getEles(eleNew,null,TouchManager._newArr);\r\n\t\t\tlen=oldArr.length;\r\n\t\t\tvar tIndex=0;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttar=oldArr[i];\r\n\t\t\t\ttIndex=newArr.indexOf(tar);\r\n\t\t\t\tif (tIndex >=0){\r\n\t\t\t\t\tnewArr.splice(tIndex,newArr.length-tIndex);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tarrs.push(tar);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (arrs.length > 0){\r\n\t\t\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_OUT*/\"mouseout\",touchID);\r\n\t\t\t}\r\n\t\t\tif (newArr.length > 0){\r\n\t\t\t\tthis.sendEvents(newArr,/*laya.events.Event.MOUSE_OVER*/\"mouseover\",touchID);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*处理TouchMove事件\r\n\t*@param ele 根节点\r\n\t*@param touchID touchID\r\n\t*\r\n\t*/\r\n\t__proto.onMouseMove=function(ele,touchID){\r\n\t\tif (!this.enable)\r\n\t\t\treturn;\r\n\t\tvar preO;\r\n\t\tpreO=this.getTouchFromArr(touchID,this.preOvers);\r\n\t\tvar arrs;\r\n\t\tvar tO;\r\n\t\tif (!preO){\r\n\t\t\tarrs=this.getEles(ele,null,TouchManager._tEleArr);\r\n\t\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_OVER*/\"mouseover\",touchID);\r\n\t\t\tthis.preOvers.push(this.createTouchO(ele,touchID));\r\n\t\t\t}else {\r\n\t\t\tthis.checkMouseOutAndOverOfMove(ele,preO.tar);\r\n\t\t\tpreO.tar=ele;\r\n\t\t\tarrs=this.getEles(ele,null,TouchManager._tEleArr);\r\n\t\t}\r\n\t\tthis.sendEvents(arrs,/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",touchID);\r\n\t\tthis._clearTempArrs();\r\n\t}\r\n\r\n\t__proto.getLastOvers=function(){\r\n\t\tTouchManager._tEleArr.length=0;\r\n\t\tif (this.preOvers.length > 0 && this.preOvers[0].tar){\r\n\t\t\treturn this.getEles(this.preOvers[0].tar,null,TouchManager._tEleArr);\r\n\t\t}\r\n\t\tTouchManager._tEleArr.push(Laya.stage);\r\n\t\treturn TouchManager._tEleArr;\r\n\t}\r\n\r\n\t__proto.stageMouseOut=function(){\r\n\t\tvar lastOvers;\r\n\t\tlastOvers=this.getLastOvers();\r\n\t\tthis.preOvers.length=0;\r\n\t\tthis.sendEvents(lastOvers,/*laya.events.Event.MOUSE_OUT*/\"mouseout\",0);\r\n\t}\r\n\r\n\t/**\r\n\t*处理TouchEnd事件\r\n\t*@param ele 根节点\r\n\t*@param touchID touchID\r\n\t*@param isLeft 是否为左键\r\n\t*/\r\n\t__proto.onMouseUp=function(ele,touchID,isLeft){\r\n\t\t(isLeft===void 0)&& (isLeft=false);\r\n\t\tif (!this.enable)\r\n\t\t\treturn;\r\n\t\tvar preO;\r\n\t\tvar tO;\r\n\t\tvar arrs;\r\n\t\tvar oldArr;\r\n\t\tvar i=0,len=0;\r\n\t\tvar tar;\r\n\t\tvar sendArr;\r\n\t\tvar onMobile=Browser.onMobile;\r\n\t\tarrs=this.getEles(ele,null,TouchManager._tEleArr);\r\n\t\tthis.sendEvents(arrs,isLeft ? /*laya.events.Event.MOUSE_UP*/\"mouseup\" :/*laya.events.Event.RIGHT_MOUSE_UP*/\"rightmouseup\",touchID);\r\n\t\tvar preDowns;\r\n\t\tpreDowns=isLeft ? this.preDowns :this.preRightDowns;\r\n\t\tpreO=this.getTouchFromArr(touchID,preDowns);\r\n\t\tif (!preO){\r\n\t\t\t}else {\r\n\t\t\tvar isDouble=false;\r\n\t\t\tvar now=Browser.now();\r\n\t\t\tisDouble=now-this._lastClickTime < 300;\r\n\t\t\tthis._lastClickTime=now;\r\n\t\t\tif (ele==preO.tar){\r\n\t\t\t\tsendArr=arrs;\r\n\t\t\t\t}else {\r\n\t\t\t\toldArr=this.getEles(preO.tar,null,TouchManager._oldArr);\r\n\t\t\t\tsendArr=TouchManager._newArr;\r\n\t\t\t\tsendArr.length=0;\r\n\t\t\t\tlen=oldArr.length;\r\n\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\ttar=oldArr[i];\r\n\t\t\t\t\tif (arrs.indexOf(tar)>=0){\r\n\t\t\t\t\t\tsendArr.push(tar);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (sendArr.length > 0){\r\n\t\t\t\tthis.sendEvents(sendArr,isLeft ? /*laya.events.Event.CLICK*/\"click\" :/*laya.events.Event.RIGHT_CLICK*/\"rightclick\",touchID);\r\n\t\t\t}\r\n\t\t\tif (isLeft && isDouble){\r\n\t\t\t\tthis.sendEvents(sendArr,/*laya.events.Event.DOUBLE_CLICK*/\"doubleclick\",touchID);\r\n\t\t\t}\r\n\t\t\tthis.removeTouchFromArr(touchID,preDowns);\r\n\t\t\tpreO.tar=null;\r\n\t\t\tPool.recover(\"TouchData\",preO);\r\n\t\t}\r\n\t\tpreO=this.getTouchFromArr(touchID,this.preOvers);\r\n\t\tif (!preO){\r\n\t\t\t}else {\r\n\t\t\tif (onMobile){\r\n\t\t\t\tsendArr=this.getEles(preO.tar,null,sendArr);\r\n\t\t\t\tif (sendArr && sendArr.length > 0){\r\n\t\t\t\t\tthis.sendEvents(sendArr,/*laya.events.Event.MOUSE_OUT*/\"mouseout\",touchID);\r\n\t\t\t\t}\r\n\t\t\t\tthis.removeTouchFromArr(touchID,this.preOvers);\r\n\t\t\t\tpreO.tar=null;\r\n\t\t\t\tPool.recover(\"TouchData\",preO);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._clearTempArrs();\r\n\t}\r\n\r\n\tTouchManager._oldArr=[];\r\n\tTouchManager._newArr=[];\r\n\tTouchManager._tEleArr=[];\r\n\t__static(TouchManager,\r\n\t['I',function(){return this.I=new TouchManager();}\r\n\t]);\r\n\treturn TouchManager;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Filter</code> 是滤镜基类。\r\n*/\r\n//class laya.filters.Filter\r\nvar Filter=(function(){\r\n\tfunction Filter(){\r\n\t\t/**@private */\r\n\t\tthis._action=null;\r\n\t}\r\n\r\n\t__class(Filter,'laya.filters.Filter');\r\n\tvar __proto=Filter.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilter\":true})\r\n\t/**@private */\r\n\t__proto.callNative=function(sp){}\r\n\t/**@private 滤镜类型。*/\r\n\t__getset(0,__proto,'type',function(){return-1});\r\n\t/**@private 滤镜动作。*/\r\n\t__getset(0,__proto,'action',function(){return this._action });\r\n\tFilter.BLUR=0x10;\r\n\tFilter.COLOR=0x20;\r\n\tFilter.GLOW=0x08;\r\n\tFilter._filterStart=null;\r\n\tFilter._filterEnd=null;\r\n\tFilter._EndTarget=null;\r\n\tFilter._recycleScope=null;\r\n\tFilter._filter=null;\r\n\tFilter._useSrc=null;\r\n\tFilter._endSrc=null;\r\n\tFilter._useOut=null;\r\n\tFilter._endOut=null;\r\n\treturn Filter;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>ColorFilterAction</code> 是一个颜色滤镜应用类。\r\n*/\r\n//class laya.filters.ColorFilterAction\r\nvar ColorFilterAction=(function(){\r\n\tfunction ColorFilterAction(){\r\n\t\tthis.data=null;\r\n\t}\r\n\r\n\t__class(ColorFilterAction,'laya.filters.ColorFilterAction');\r\n\tvar __proto=ColorFilterAction.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilterAction\":true})\r\n\t/**\r\n\t*给指定的对象应用颜色滤镜。\r\n\t*@param srcCanvas 需要应用画布对象。\r\n\t*@return 应用了滤镜后的画布对象。\r\n\t*/\r\n\t__proto.apply=function(srcCanvas){\r\n\t\tvar ctx=srcCanvas.ctx.ctx;\r\n\t\tvar canvas=srcCanvas.ctx.ctx.canvas;\r\n\t\tif (canvas.width==0 || canvas.height==0)return canvas;\r\n\t\tvar imgdata=ctx.getImageData(0,0,canvas.width,canvas.height);\r\n\t\tvar data=imgdata.data;\r\n\t\tvar nData;\r\n\t\tfor (var i=0,n=data.length;i < n;i+=4){\r\n\t\t\tnData=this.getColor(data[i],data[i+1],data[i+2],data[i+3]);\r\n\t\t\tif (data[i+3]==0)continue ;\r\n\t\t\tdata[i]=nData[0];\r\n\t\t\tdata[i+1]=nData[1];\r\n\t\t\tdata[i+2]=nData[2];\r\n\t\t\tdata[i+3]=nData[3];\r\n\t\t}\r\n\t\tctx.putImageData(imgdata,0,0);\r\n\t\treturn srcCanvas;\r\n\t}\r\n\r\n\t__proto.getColor=function(red,green,blue,alpha){\r\n\t\tvar rst=[];\r\n\t\tif (this.data._mat && this.data._alpha){\r\n\t\t\tvar mat=this.data._mat;\r\n\t\t\tvar tempAlpha=this.data._alpha;\r\n\t\t\trst[0]=mat[0] *red+mat[1] *green+mat[2] *blue+mat[3] *alpha+tempAlpha[0];\r\n\t\t\trst[1]=mat[4] *red+mat[5] *green+mat[6] *blue+mat[7] *alpha+tempAlpha[1];\r\n\t\t\trst[2]=mat[8] *red+mat[9] *green+mat[10] *blue+mat[11] *alpha+tempAlpha[2];\r\n\t\t\trst[3]=mat[12] *red+mat[13] *green+mat[14] *blue+mat[15] *alpha+tempAlpha[3];\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\treturn ColorFilterAction;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.maths.Arith\r\nvar Arith=(function(){\r\n\tfunction Arith(){}\r\n\t__class(Arith,'laya.maths.Arith');\r\n\tArith.formatR=function(r){\r\n\t\tif (r > Math.PI)r-=Math.PI *2;\r\n\t\tif (r <-Math.PI)r+=Math.PI *2;\r\n\t\treturn r;\r\n\t}\r\n\r\n\tArith.isPOT=function(w,h){\r\n\t\treturn (w > 0 && (w & (w-1))===0 && h > 0 && (h & (h-1))===0);\r\n\t}\r\n\r\n\tArith.setMatToArray=function(mat,array){\r\n\t\tmat.a,mat.b,0,0,mat.c,mat.d,0,0,0,0,1,0,mat.tx+20,mat.ty+20,0,1\r\n\t\tarray[0]=mat.a;\r\n\t\tarray[1]=mat.b;\r\n\t\tarray[4]=mat.c;\r\n\t\tarray[5]=mat.d;\r\n\t\tarray[12]=mat.tx;\r\n\t\tarray[13]=mat.ty;\r\n\t}\r\n\r\n\treturn Arith;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*计算贝塞尔曲线的工具类。\r\n*/\r\n//class laya.maths.Bezier\r\nvar Bezier=(function(){\r\n\tfunction Bezier(){\r\n\t\t/**@private */\r\n\t\tthis._controlPoints=[new Point(),new Point(),new Point()];\r\n\t\tthis._calFun=this.getPoint2;\r\n\t}\r\n\r\n\t__class(Bezier,'laya.maths.Bezier');\r\n\tvar __proto=Bezier.prototype;\r\n\t/**@private */\r\n\t__proto._switchPoint=function(x,y){\r\n\t\tvar tPoint=this._controlPoints.shift();\r\n\t\ttPoint.setTo(x,y);\r\n\t\tthis._controlPoints.push(tPoint);\r\n\t}\r\n\r\n\t/**\r\n\t*计算二次贝塞尔点。\r\n\t*@param t\r\n\t*@param rst\r\n\t*\r\n\t*/\r\n\t__proto.getPoint2=function(t,rst){\r\n\t\tvar p1=this._controlPoints[0];\r\n\t\tvar p2=this._controlPoints[1];\r\n\t\tvar p3=this._controlPoints[2];\r\n\t\tvar lineX=Math.pow((1-t),2)*p1.x+2 *t *(1-t)*p2.x+Math.pow(t,2)*p3.x;\r\n\t\tvar lineY=Math.pow((1-t),2)*p1.y+2 *t *(1-t)*p2.y+Math.pow(t,2)*p3.y;\r\n\t\trst.push(lineX,lineY);\r\n\t}\r\n\r\n\t/**\r\n\t*计算三次贝塞尔点\r\n\t*@param t\r\n\t*@param rst\r\n\t*\r\n\t*/\r\n\t__proto.getPoint3=function(t,rst){\r\n\t\tvar p1=this._controlPoints[0];\r\n\t\tvar p2=this._controlPoints[1];\r\n\t\tvar p3=this._controlPoints[2];\r\n\t\tvar p4=this._controlPoints[3];\r\n\t\tvar lineX=Math.pow((1-t),3)*p1.x+3 *p2.x *t *(1-t)*(1-t)+3 *p3.x *t *t *(1-t)+p4.x *Math.pow(t,3);\r\n\t\tvar lineY=Math.pow((1-t),3)*p1.y+3 *p2.y *t *(1-t)*(1-t)+3 *p3.y *t *t *(1-t)+p4.y *Math.pow(t,3);\r\n\t\trst.push(lineX,lineY);\r\n\t}\r\n\r\n\t/**\r\n\t*计算贝塞尔点序列\r\n\t*@param count\r\n\t*@param rst\r\n\t*\r\n\t*/\r\n\t__proto.insertPoints=function(count,rst){\r\n\t\tvar i=NaN;\r\n\t\tcount=count > 0 ? count :5;\r\n\t\tvar dLen=NaN;\r\n\t\tdLen=1 / count;\r\n\t\tfor (i=0;i <=1;i+=dLen){\r\n\t\t\tthis._calFun(i,rst);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取贝塞尔曲线上的点。\r\n\t*@param pList 控制点[x0,y0,x1,y1...]\r\n\t*@param inSertCount 每次曲线的插值数量\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.getBezierPoints=function(pList,inSertCount,count){\r\n\t\t(inSertCount===void 0)&& (inSertCount=5);\r\n\t\t(count===void 0)&& (count=2);\r\n\t\tvar i=0,len=0;\r\n\t\tlen=pList.length;\r\n\t\tif (len < (count+1)*2)return [];\r\n\t\tvar rst;\r\n\t\trst=[];\r\n\t\tswitch (count){\r\n\t\t\tcase 2:\r\n\t\t\t\tthis._calFun=this.getPoint2;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 3:\r\n\t\t\t\tthis._calFun=this.getPoint3;\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\twhile (this._controlPoints.length <=count){\r\n\t\t\tthis._controlPoints.push(new Point());\r\n\t\t}\r\n\t\tfor (i=0;i < count *2;i+=2){\r\n\t\t\tthis._switchPoint(pList[i],pList[i+1]);\r\n\t\t}\r\n\t\tfor (i=count *2;i < len;i+=2){\r\n\t\t\tthis._switchPoint(pList[i],pList[i+1]);\r\n\t\t\tif ((i / 2)% count==0)\r\n\t\t\t\tthis.insertPoints(inSertCount,rst);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__static(Bezier,\r\n\t['I',function(){return this.I=new Bezier();}\r\n\t]);\r\n\treturn Bezier;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*凸包算法。\r\n*/\r\n//class laya.maths.GrahamScan\r\nvar GrahamScan=(function(){\r\n\tfunction GrahamScan(){}\r\n\t__class(GrahamScan,'laya.maths.GrahamScan');\r\n\tGrahamScan.multiply=function(p1,p2,p0){\r\n\t\treturn ((p1.x-p0.x)*(p2.y-p0.y)-(p2.x-p0.x)*(p1.y-p0.y));\r\n\t}\r\n\r\n\tGrahamScan.dis=function(p1,p2){\r\n\t\treturn (p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);\r\n\t}\r\n\r\n\tGrahamScan._getPoints=function(count,tempUse,rst){\r\n\t\t(tempUse===void 0)&& (tempUse=false);\r\n\t\tif (!GrahamScan._mPointList)GrahamScan._mPointList=[];\r\n\t\twhile (GrahamScan._mPointList.length < count)GrahamScan._mPointList.push(new Point());\r\n\t\tif (!rst)rst=[];\r\n\t\trst.length=0;\r\n\t\tif (tempUse){\r\n\t\t\tGrahamScan.getFrom(rst,GrahamScan._mPointList,count);\r\n\t\t\t}else {\r\n\t\t\tGrahamScan.getFromR(rst,GrahamScan._mPointList,count);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGrahamScan.getFrom=function(rst,src,count){\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < count;i++){\r\n\t\t\trst.push(src[i]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGrahamScan.getFromR=function(rst,src,count){\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < count;i++){\r\n\t\t\trst.push(src.pop());\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGrahamScan.pListToPointList=function(pList,tempUse){\r\n\t\t(tempUse===void 0)&& (tempUse=false);\r\n\t\tvar i=0,len=pList.length / 2,rst=GrahamScan._getPoints(len,tempUse,GrahamScan._tempPointList);\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst[i].setTo(pList[i+i],pList[i+i+1]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGrahamScan.pointListToPlist=function(pointList){\r\n\t\tvar i=0,len=pointList.length,rst=GrahamScan._temPList,tPoint;\r\n\t\trst.length=0;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttPoint=pointList[i];\r\n\t\t\trst.push(tPoint.x,tPoint.y);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGrahamScan.scanPList=function(pList){\r\n\t\treturn Utils.copyArray(pList,GrahamScan.pointListToPlist(GrahamScan.scan(GrahamScan.pListToPointList(pList,true))));\r\n\t}\r\n\r\n\tGrahamScan.scan=function(PointSet){\r\n\t\tvar i=0,j=0,k=0,top=2,tmp,n=PointSet.length,ch;\r\n\t\tvar _tmpDic={};\r\n\t\tvar key;\r\n\t\tch=GrahamScan._temArr;\r\n\t\tch.length=0;\r\n\t\tn=PointSet.length;\r\n\t\tfor (i=n-1;i >=0;i--){\r\n\t\t\ttmp=PointSet[i];\r\n\t\t\tkey=tmp.x+\"_\"+tmp.y;\r\n\t\t\tif (!_tmpDic.hasOwnProperty(key)){\r\n\t\t\t\t_tmpDic[key]=true;\r\n\t\t\t\tch.push(tmp);\r\n\t\t\t}\r\n\t\t}\r\n\t\tn=ch.length;\r\n\t\tUtils.copyArray(PointSet,ch);\r\n\t\tfor (i=1;i < n;i++)\r\n\t\tif ((PointSet[i].y < PointSet[k].y)|| ((PointSet[i].y==PointSet[k].y)&& (PointSet[i].x < PointSet[k].x)))\r\n\t\t\tk=i;\r\n\t\ttmp=PointSet[0];\r\n\t\tPointSet[0]=PointSet[k];\r\n\t\tPointSet[k]=tmp;\r\n\t\tfor (i=1;i < n-1;i++){\r\n\t\t\tk=i;\r\n\t\t\tfor (j=i+1;j < n;j++)\r\n\t\t\tif ((GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])> 0)|| ((GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])==0)&& (GrahamScan.dis(PointSet[0],PointSet[j])< GrahamScan.dis(PointSet[0],PointSet[k]))))\r\n\t\t\t\tk=j;\r\n\t\t\ttmp=PointSet[i];\r\n\t\t\tPointSet[i]=PointSet[k];\r\n\t\t\tPointSet[k]=tmp;\r\n\t\t}\r\n\t\tch=GrahamScan._temArr;\r\n\t\tch.length=0;\r\n\t\tif (PointSet.length < 3){\r\n\t\t\treturn Utils.copyArray(ch,PointSet);\r\n\t\t}\r\n\t\tch.push(PointSet[0],PointSet[1],PointSet[2]);\r\n\t\tfor (i=3;i < n;i++){\r\n\t\t\twhile (ch.length >=2 && GrahamScan.multiply(PointSet[i],ch[ch.length-1],ch[ch.length-2])>=0)ch.pop();\r\n\t\t\tPointSet[i] && ch.push(PointSet[i]);\r\n\t\t}\r\n\t\treturn ch;\r\n\t}\r\n\r\n\tGrahamScan._mPointList=null;\r\n\tGrahamScan._tempPointList=[];\r\n\tGrahamScan._temPList=[];\r\n\tGrahamScan._temArr=[];\r\n\treturn GrahamScan;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>MathUtil</code> 是一个数据处理工具类。\r\n*/\r\n//class laya.maths.MathUtil\r\nvar MathUtil=(function(){\r\n\tfunction MathUtil(){}\r\n\t__class(MathUtil,'laya.maths.MathUtil');\r\n\tMathUtil.subtractVector3=function(l,r,o){\r\n\t\to[0]=l[0]-r[0];\r\n\t\to[1]=l[1]-r[1];\r\n\t\to[2]=l[2]-r[2];\r\n\t}\r\n\r\n\tMathUtil.lerp=function(left,right,amount){\r\n\t\treturn left *(1-amount)+right *amount;\r\n\t}\r\n\r\n\tMathUtil.scaleVector3=function(f,b,e){\r\n\t\te[0]=f[0] *b;\r\n\t\te[1]=f[1] *b;\r\n\t\te[2]=f[2] *b;\r\n\t}\r\n\r\n\tMathUtil.lerpVector3=function(l,r,t,o){\r\n\t\tvar ax=l[0],ay=l[1],az=l[2];\r\n\t\to[0]=ax+t *(r[0]-ax);\r\n\t\to[1]=ay+t *(r[1]-ay);\r\n\t\to[2]=az+t *(r[2]-az);\r\n\t}\r\n\r\n\tMathUtil.lerpVector4=function(l,r,t,o){\r\n\t\tvar ax=l[0],ay=l[1],az=l[2],aw=l[3];\r\n\t\to[0]=ax+t *(r[0]-ax);\r\n\t\to[1]=ay+t *(r[1]-ay);\r\n\t\to[2]=az+t *(r[2]-az);\r\n\t\to[3]=aw+t *(r[3]-aw);\r\n\t}\r\n\r\n\tMathUtil.slerpQuaternionArray=function(a,Offset1,b,Offset2,t,out,Offset3){\r\n\t\tvar ax=a[Offset1+0],ay=a[Offset1+1],az=a[Offset1+2],aw=a[Offset1+3],bx=b[Offset2+0],by=b[Offset2+1],bz=b[Offset2+2],bw=b[Offset2+3];\r\n\t\tvar omega,cosom,sinom,scale0,scale1;\r\n\t\tcosom=ax *bx+ay *by+az *bz+aw *bw;\r\n\t\tif (cosom < 0.0){\r\n\t\t\tcosom=-cosom;\r\n\t\t\tbx=-bx;\r\n\t\t\tby=-by;\r\n\t\t\tbz=-bz;\r\n\t\t\tbw=-bw;\r\n\t\t}\r\n\t\tif ((1.0-cosom)> 0.000001){\r\n\t\t\tomega=Math.acos(cosom);\r\n\t\t\tsinom=Math.sin(omega);\r\n\t\t\tscale0=Math.sin((1.0-t)*omega)/ sinom;\r\n\t\t\tscale1=Math.sin(t *omega)/ sinom;\r\n\t\t\t}else {\r\n\t\t\tscale0=1.0-t;\r\n\t\t\tscale1=t;\r\n\t\t}\r\n\t\tout[Offset3+0]=scale0 *ax+scale1 *bx;\r\n\t\tout[Offset3+1]=scale0 *ay+scale1 *by;\r\n\t\tout[Offset3+2]=scale0 *az+scale1 *bz;\r\n\t\tout[Offset3+3]=scale0 *aw+scale1 *bw;\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMathUtil.getRotation=function(x0,y0,x1,y1){\r\n\t\treturn Math.atan2(y1-y0,x1-x0)/ Math.PI *180;\r\n\t}\r\n\r\n\tMathUtil.sortBigFirst=function(a,b){\r\n\t\tif (a==b)\r\n\t\t\treturn 0;\r\n\t\treturn b > a ? 1 :-1;\r\n\t}\r\n\r\n\tMathUtil.sortSmallFirst=function(a,b){\r\n\t\tif (a==b)\r\n\t\t\treturn 0;\r\n\t\treturn b > a ?-1 :1;\r\n\t}\r\n\r\n\tMathUtil.sortNumBigFirst=function(a,b){\r\n\t\treturn parseFloat(b)-parseFloat(a);\r\n\t}\r\n\r\n\tMathUtil.sortNumSmallFirst=function(a,b){\r\n\t\treturn parseFloat(a)-parseFloat(b);\r\n\t}\r\n\r\n\tMathUtil.sortByKey=function(key,bigFirst,forceNum){\r\n\t\t(bigFirst===void 0)&& (bigFirst=false);\r\n\t\t(forceNum===void 0)&& (forceNum=true);\r\n\t\tvar _sortFun;\r\n\t\tif (bigFirst){\r\n\t\t\t_sortFun=forceNum ? MathUtil.sortNumBigFirst :MathUtil.sortBigFirst;\r\n\t\t\t}else {\r\n\t\t\t_sortFun=forceNum ? MathUtil.sortNumSmallFirst :MathUtil.sortSmallFirst;\r\n\t\t}\r\n\t\treturn function (a,b){\r\n\t\t\treturn _sortFun(a[key],b[key]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn MathUtil;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>Matrix</code> 类表示一个转换矩阵，它确定如何将点从一个坐标空间映射到另一个坐标空间。</p>\r\n*<p>您可以对一个显示对象执行不同的图形转换，方法是设置 Matrix 对象的属性，将该 Matrix 对象应用于 Transform 对象的 matrix 属性，然后应用该 Transform 对象作为显示对象的 transform 属性。这些转换函数包括平移（x 和 y 重新定位）、旋转、缩放和倾斜。</p>\r\n*/\r\n//class laya.maths.Matrix\r\nvar Matrix=(function(){\r\n\tfunction Matrix(a,b,c,d,tx,ty){\r\n\t\t/**缩放或旋转图像时影响像素沿 x 轴定位的值。*/\r\n\t\t//this.a=NaN;\r\n\t\t/**旋转或倾斜图像时影响像素沿 y 轴定位的值。*/\r\n\t\t//this.b=NaN;\r\n\t\t/**旋转或倾斜图像时影响像素沿 x 轴定位的值。*/\r\n\t\t//this.c=NaN;\r\n\t\t/**缩放或旋转图像时影响像素沿 y 轴定位的值。*/\r\n\t\t//this.d=NaN;\r\n\t\t/**沿 x 轴平移每个点的距离。*/\r\n\t\t//this.tx=NaN;\r\n\t\t/**沿 y 轴平移每个点的距离。*/\r\n\t\t//this.ty=NaN;\r\n\t\t/**@private 表示此对象是否在对象池中。*/\r\n\t\tthis.inPool=false;\r\n\t\t/**@private 是否有改变矩阵的值。*/\r\n\t\tthis.bTransform=false;\r\n\t\t(a===void 0)&& (a=1);\r\n\t\t(b===void 0)&& (b=0);\r\n\t\t(c===void 0)&& (c=0);\r\n\t\t(d===void 0)&& (d=1);\r\n\t\t(tx===void 0)&& (tx=0);\r\n\t\t(ty===void 0)&& (ty=0);\r\n\t\tthis.a=a;\r\n\t\tthis.b=b;\r\n\t\tthis.c=c;\r\n\t\tthis.d=d;\r\n\t\tthis.tx=tx;\r\n\t\tthis.ty=ty;\r\n\t\tthis._checkTransform();\r\n\t}\r\n\r\n\t__class(Matrix,'laya.maths.Matrix');\r\n\tvar __proto=Matrix.prototype;\r\n\t/**\r\n\t*将本矩阵设置为单位矩阵。\r\n\t*@return 返回当前矩形。\r\n\t*/\r\n\t__proto.identity=function(){\r\n\t\tthis.a=this.d=1;\r\n\t\tthis.b=this.tx=this.ty=this.c=0;\r\n\t\tthis.bTransform=false;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._checkTransform=function(){\r\n\t\treturn this.bTransform=(this.a!==1 || this.b!==0 || this.c!==0 || this.d!==1);\r\n\t}\r\n\r\n\t/**\r\n\t*设置沿 x 、y 轴平移每个点的距离。\r\n\t*@param x 沿 x 轴平移每个点的距离。\r\n\t*@param y 沿 y 轴平移每个点的距离。\r\n\t*@return 返回对象本身\r\n\t*/\r\n\t__proto.setTranslate=function(x,y){\r\n\t\tthis.tx=x;\r\n\t\tthis.ty=y;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*沿 x 和 y 轴平移矩阵，平移的变化量由 x 和 y 参数指定。\r\n\t*@param x 沿 x 轴向右移动的量（以像素为单位）。\r\n\t*@param y 沿 y 轴向下移动的量（以像素为单位）。\r\n\t*@return 返回此矩形对象。\r\n\t*/\r\n\t__proto.translate=function(x,y){\r\n\t\tthis.tx+=x;\r\n\t\tthis.ty+=y;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*对矩阵应用缩放转换。\r\n\t*@param x 用于沿 x 轴缩放对象的乘数。\r\n\t*@param y 用于沿 y 轴缩放对象的乘数。\r\n\t*/\r\n\t__proto.scale=function(x,y){\r\n\t\tthis.a *=x;\r\n\t\tthis.d *=y;\r\n\t\tthis.c *=x;\r\n\t\tthis.b *=y;\r\n\t\tthis.tx *=x;\r\n\t\tthis.ty *=y;\r\n\t\tthis.bTransform=true;\r\n\t}\r\n\r\n\t/**\r\n\t*对 Matrix 对象应用旋转转换。\r\n\t*@param angle 以弧度为单位的旋转角度。\r\n\t*/\r\n\t__proto.rotate=function(angle){\r\n\t\tvar cos=Math.cos(angle);\r\n\t\tvar sin=Math.sin(angle);\r\n\t\tvar a1=this.a;\r\n\t\tvar c1=this.c;\r\n\t\tvar tx1=this.tx;\r\n\t\tthis.a=a1 *cos-this.b *sin;\r\n\t\tthis.b=a1 *sin+this.b *cos;\r\n\t\tthis.c=c1 *cos-this.d *sin;\r\n\t\tthis.d=c1 *sin+this.d *cos;\r\n\t\tthis.tx=tx1 *cos-this.ty *sin;\r\n\t\tthis.ty=tx1 *sin+this.ty *cos;\r\n\t\tthis.bTransform=true;\r\n\t}\r\n\r\n\t/**\r\n\t*对 Matrix 对象应用倾斜转换。\r\n\t*@param x 沿着 X 轴的 2D 倾斜弧度。\r\n\t*@param y 沿着 Y 轴的 2D 倾斜弧度。\r\n\t*@return 当前 Matrix 对象。\r\n\t*/\r\n\t__proto.skew=function(x,y){\r\n\t\tvar tanX=Math.tan(x);\r\n\t\tvar tanY=Math.tan(y);\r\n\t\tvar a1=this.a;\r\n\t\tvar b1=this.b;\r\n\t\tthis.a+=tanY *this.c;\r\n\t\tthis.b+=tanY *this.d;\r\n\t\tthis.c+=tanX *a1;\r\n\t\tthis.d+=tanX *b1;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*对指定的点应用当前矩阵的逆转化并返回此点。\r\n\t*@param out 待转化的点 Point 对象。\r\n\t*@return 返回out\r\n\t*/\r\n\t__proto.invertTransformPoint=function(out){\r\n\t\tvar a1=this.a;\r\n\t\tvar b1=this.b;\r\n\t\tvar c1=this.c;\r\n\t\tvar d1=this.d;\r\n\t\tvar tx1=this.tx;\r\n\t\tvar n=a1 *d1-b1 *c1;\r\n\t\tvar a2=d1 / n;\r\n\t\tvar b2=-b1 / n;\r\n\t\tvar c2=-c1 / n;\r\n\t\tvar d2=a1 / n;\r\n\t\tvar tx2=(c1 *this.ty-d1 *tx1)/ n;\r\n\t\tvar ty2=-(a1 *this.ty-b1 *tx1)/ n;\r\n\t\treturn out.setTo(a2 *out.x+c2 *out.y+tx2,b2 *out.x+d2 *out.y+ty2);\r\n\t}\r\n\r\n\t/**\r\n\t*将 Matrix 对象表示的几何转换应用于指定点。\r\n\t*@param out 用来设定输出结果的点。\r\n\t*@return 返回out\r\n\t*/\r\n\t__proto.transformPoint=function(out){\r\n\t\treturn out.setTo(this.a *out.x+this.c *out.y+this.tx,this.b *out.x+this.d *out.y+this.ty);\r\n\t}\r\n\r\n\t/**\r\n\t*将 Matrix 对象表示的几何转换应用于指定点，忽略tx、ty。\r\n\t*@param out 用来设定输出结果的点。\r\n\t*@return 返回out\r\n\t*/\r\n\t__proto.transformPointN=function(out){\r\n\t\treturn out.setTo(this.a *out.x+this.c *out.y ,this.b *out.x+this.d *out.y);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*将 Matrix 对象表示的几何转换应用于指定点。\r\n\t*@param data 点集合。\r\n\t*@param out 存储应用转化的点的列表。\r\n\t*@return 返回out数组\r\n\t*/\r\n\t__proto.transformPointArray=function(data,out){\r\n\t\tvar len=data.length;\r\n\t\tfor (var i=0;i < len;i+=2){\r\n\t\t\tvar x=data[i],y=data[i+1];\r\n\t\t\tout[i]=this.a *x+this.c *y+this.tx;\r\n\t\t\tout[i+1]=this.b *x+this.d *y+this.ty;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*将 Matrix 对象表示的几何缩放转换应用于指定点。\r\n\t*@param data 点集合。\r\n\t*@param out 存储应用转化的点的列表。\r\n\t*@return 返回out数组\r\n\t*/\r\n\t__proto.transformPointArrayScale=function(data,out){\r\n\t\tvar len=data.length;\r\n\t\tfor (var i=0;i < len;i+=2){\r\n\t\t\tvar x=data[i],y=data[i+1];\r\n\t\t\tout[i]=this.a *x+this.c *y;\r\n\t\t\tout[i+1]=this.b *x+this.d *y;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t*获取 X 轴缩放值。\r\n\t*@return X 轴缩放值。\r\n\t*/\r\n\t__proto.getScaleX=function(){\r\n\t\treturn this.b===0 ? this.a :Math.sqrt(this.a *this.a+this.b *this.b);\r\n\t}\r\n\r\n\t/**\r\n\t*获取 Y 轴缩放值。\r\n\t*@return Y 轴缩放值。\r\n\t*/\r\n\t__proto.getScaleY=function(){\r\n\t\treturn this.c===0 ? this.d :Math.sqrt(this.c *this.c+this.d *this.d);\r\n\t}\r\n\r\n\t/**\r\n\t*执行原始矩阵的逆转换。\r\n\t*@return 当前矩阵对象。\r\n\t*/\r\n\t__proto.invert=function(){\r\n\t\tvar a1=this.a;\r\n\t\tvar b1=this.b;\r\n\t\tvar c1=this.c;\r\n\t\tvar d1=this.d;\r\n\t\tvar tx1=this.tx;\r\n\t\tvar n=a1 *d1-b1 *c1;\r\n\t\tthis.a=d1 / n;\r\n\t\tthis.b=-b1 / n;\r\n\t\tthis.c=-c1 / n;\r\n\t\tthis.d=a1 / n;\r\n\t\tthis.tx=(c1 *this.ty-d1 *tx1)/ n;\r\n\t\tthis.ty=-(a1 *this.ty-b1 *tx1)/ n;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*将 Matrix 的成员设置为指定值。\r\n\t*@param a 缩放或旋转图像时影响像素沿 x 轴定位的值。\r\n\t*@param b 旋转或倾斜图像时影响像素沿 y 轴定位的值。\r\n\t*@param c 旋转或倾斜图像时影响像素沿 x 轴定位的值。\r\n\t*@param d 缩放或旋转图像时影响像素沿 y 轴定位的值。\r\n\t*@param tx 沿 x 轴平移每个点的距离。\r\n\t*@param ty 沿 y 轴平移每个点的距离。\r\n\t*@return 当前矩阵对象。\r\n\t*/\r\n\t__proto.setTo=function(a,b,c,d,tx,ty){\r\n\t\tthis.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*将指定矩阵与当前矩阵连接，从而将这两个矩阵的几何效果有效地结合在一起。\r\n\t*@param matrix 要连接到源矩阵的矩阵。\r\n\t*@return 当前矩阵。\r\n\t*/\r\n\t__proto.concat=function(matrix){\r\n\t\tvar a=this.a;\r\n\t\tvar c=this.c;\r\n\t\tvar tx=this.tx;\r\n\t\tthis.a=a *matrix.a+this.b *matrix.c;\r\n\t\tthis.b=a *matrix.b+this.b *matrix.d;\r\n\t\tthis.c=c *matrix.a+this.d *matrix.c;\r\n\t\tthis.d=c *matrix.b+this.d *matrix.d;\r\n\t\tthis.tx=tx *matrix.a+this.ty *matrix.c+matrix.tx;\r\n\t\tthis.ty=tx *matrix.b+this.ty *matrix.d+matrix.ty;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*对矩阵应用缩放转换。反向相乘\r\n\t*@param x 用于沿 x 轴缩放对象的乘数。\r\n\t*@param y 用于沿 y 轴缩放对象的乘数。\r\n\t*/\r\n\t__proto.scaleEx=function(x,y){\r\n\t\tvar ba=this.a,bb=this.b,bc=this.c,bd=this.d;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tthis.a=x *ba;\r\n\t\t\tthis.b=x *bb;\r\n\t\t\tthis.c=y *bc;\r\n\t\t\tthis.d=y *bd;\r\n\t\t\t}else {\r\n\t\t\tthis.a=x *ba;\r\n\t\t\tthis.b=0 *bd;\r\n\t\t\tthis.c=0 *ba;\r\n\t\t\tthis.d=y *bd;\r\n\t\t}\r\n\t\tthis.bTransform=true;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*对 Matrix 对象应用旋转转换。反向相乘\r\n\t*@param angle 以弧度为单位的旋转角度。\r\n\t*/\r\n\t__proto.rotateEx=function(angle){\r\n\t\tvar cos=Math.cos(angle);\r\n\t\tvar sin=Math.sin(angle);\r\n\t\tvar ba=this.a,bb=this.b,bc=this.c,bd=this.d;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tthis.a=cos *ba+sin *bc;\r\n\t\t\tthis.b=cos *bb+sin *bd;\r\n\t\t\tthis.c=-sin *ba+cos *bc;\r\n\t\t\tthis.d=-sin *bb+cos *bd;\r\n\t\t\t}else {\r\n\t\t\tthis.a=cos *ba;\r\n\t\t\tthis.b=sin *bd;\r\n\t\t\tthis.c=-sin *ba;\r\n\t\t\tthis.d=cos *bd;\r\n\t\t}\r\n\t\tthis.bTransform=true;\r\n\t}\r\n\r\n\t/**\r\n\t*返回此 Matrix 对象的副本。\r\n\t*@return 与原始实例具有完全相同的属性的新 Matrix 实例。\r\n\t*/\r\n\t__proto.clone=function(){\r\n\t\tvar dec=Matrix.create();\r\n\t\tdec.a=this.a;\r\n\t\tdec.b=this.b;\r\n\t\tdec.c=this.c;\r\n\t\tdec.d=this.d;\r\n\t\tdec.tx=this.tx;\r\n\t\tdec.ty=this.ty;\r\n\t\tdec.bTransform=this.bTransform;\r\n\t\treturn dec;\r\n\t}\r\n\r\n\t/**\r\n\t*将当前 Matrix 对象中的所有矩阵数据复制到指定的 Matrix 对象中。\r\n\t*@param dec 要复制当前矩阵数据的 Matrix 对象。\r\n\t*@return 已复制当前矩阵数据的 Matrix 对象。\r\n\t*/\r\n\t__proto.copyTo=function(dec){\r\n\t\tdec.a=this.a;\r\n\t\tdec.b=this.b;\r\n\t\tdec.c=this.c;\r\n\t\tdec.d=this.d;\r\n\t\tdec.tx=this.tx;\r\n\t\tdec.ty=this.ty;\r\n\t\tdec.bTransform=this.bTransform;\r\n\t\treturn dec;\r\n\t}\r\n\r\n\t/**\r\n\t*返回列出该 Matrix 对象属性的文本值。\r\n\t*@return 一个字符串，它包含 Matrix 对象的属性值：a、b、c、d、tx 和 ty。\r\n\t*/\r\n\t__proto.toString=function(){\r\n\t\treturn this.a+\",\"+this.b+\",\"+this.c+\",\"+this.d+\",\"+this.tx+\",\"+this.ty;\r\n\t}\r\n\r\n\t/**\r\n\t*销毁此对象。\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tif (this.inPool)return;\r\n\t\tvar cache=Matrix._cache;\r\n\t\tthis.inPool=true;\r\n\t\tcache._length || (cache._length=0);\r\n\t\tcache[cache._length++]=this;\r\n\t\tthis.a=this.d=1;\r\n\t\tthis.b=this.c=this.tx=this.ty=0;\r\n\t\tthis.bTransform=false;\r\n\t}\r\n\r\n\tMatrix.mul=function(m1,m2,out){\r\n\t\tvar aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;\r\n\t\tvar ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tout.a=aa *ba+ab *bc;\r\n\t\t\tout.b=aa *bb+ab *bd;\r\n\t\t\tout.c=ac *ba+ad *bc;\r\n\t\t\tout.d=ac *bb+ad *bd;\r\n\t\t\tout.tx=ba *atx+bc *aty+btx;\r\n\t\t\tout.ty=bb *atx+bd *aty+bty;\r\n\t\t\t}else {\r\n\t\t\tout.a=aa *ba;\r\n\t\t\tout.b=ab *bd;\r\n\t\t\tout.c=ac *ba;\r\n\t\t\tout.d=ad *bd;\r\n\t\t\tout.tx=ba *atx+btx;\r\n\t\t\tout.ty=bd *aty+bty;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.mul16=function(m1,m2,out){\r\n\t\tvar aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;\r\n\t\tvar ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tout[0]=aa *ba+ab *bc;\r\n\t\t\tout[1]=aa *bb+ab *bd;\r\n\t\t\tout[4]=ac *ba+ad *bc;\r\n\t\t\tout[5]=ac *bb+ad *bd;\r\n\t\t\tout[12]=ba *atx+bc *aty+btx;\r\n\t\t\tout[13]=bb *atx+bd *aty+bty;\r\n\t\t\t}else {\r\n\t\t\tout[0]=aa *ba;\r\n\t\t\tout[1]=ab *bd;\r\n\t\t\tout[4]=ac *ba;\r\n\t\t\tout[5]=ad *bd;\r\n\t\t\tout[12]=ba *atx+btx;\r\n\t\t\tout[13]=bd *aty+bty;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.mulPre=function(m1,ba,bb,bc,bd,btx,bty,out){\r\n\t\tvar aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tout.a=aa *ba+ab *bc;\r\n\t\t\tout.b=aa *bb+ab *bd;\r\n\t\t\tout.c=ac *ba+ad *bc;\r\n\t\t\tout.d=ac *bb+ad *bd;\r\n\t\t\tout.tx=ba *atx+bc *aty+btx;\r\n\t\t\tout.ty=bb *atx+bd *aty+bty;\r\n\t\t\t}else {\r\n\t\t\tout.a=aa *ba;\r\n\t\t\tout.b=ab *bd;\r\n\t\t\tout.c=ac *ba;\r\n\t\t\tout.d=ad *bd;\r\n\t\t\tout.tx=ba *atx+btx;\r\n\t\t\tout.ty=bd *aty+bty;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.mulPos=function(m1,aa,ab,ac,ad,atx,aty,out){\r\n\t\tvar ba=m1.a,bb=m1.b,bc=m1.c,bd=m1.d,btx=m1.tx,bty=m1.ty;\r\n\t\tif (bb!==0 || bc!==0){\r\n\t\t\tout.a=aa *ba+ab *bc;\r\n\t\t\tout.b=aa *bb+ab *bd;\r\n\t\t\tout.c=ac *ba+ad *bc;\r\n\t\t\tout.d=ac *bb+ad *bd;\r\n\t\t\tout.tx=ba *atx+bc *aty+btx;\r\n\t\t\tout.ty=bb *atx+bd *aty+bty;\r\n\t\t\t}else {\r\n\t\t\tout.a=aa *ba;\r\n\t\t\tout.b=ab *bd;\r\n\t\t\tout.c=ac *ba;\r\n\t\t\tout.d=ad *bd;\r\n\t\t\tout.tx=ba *atx+btx;\r\n\t\t\tout.ty=bd *aty+bty;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.preMul=function(parent,self,out){\r\n\t\tvar pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d;\r\n\t\tvar na=self.a,nb=self.b,nc=self.c,nd=self.d,ntx=self.tx,nty=self.ty;\r\n\t\tout.a=na *pa;\r\n\t\tout.b=out.c=0;\r\n\t\tout.d=nd *pd;\r\n\t\tout.tx=ntx *pa+parent.tx;\r\n\t\tout.ty=nty *pd+parent.ty;\r\n\t\tif (nb!==0 || nc!==0 || pb!==0 || pc!==0){\r\n\t\t\tout.a+=nb *pc;\r\n\t\t\tout.d+=nc *pb;\r\n\t\t\tout.b+=na *pb+nb *pd;\r\n\t\t\tout.c+=nc *pa+nd *pc;\r\n\t\t\tout.tx+=nty *pc;\r\n\t\t\tout.ty+=ntx *pb;\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.preMulXY=function(parent,x,y,out){\r\n\t\tvar pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d;\r\n\t\tout.a=pa;\r\n\t\tout.b=pb;\r\n\t\tout.c=pc;\r\n\t\tout.d=pd;\r\n\t\tout.tx=x *pa+parent.tx+y *pc;\r\n\t\tout.ty=y *pd+parent.ty+x *pb;\r\n\t\treturn out;\r\n\t}\r\n\r\n\tMatrix.create=function(){\r\n\t\tvar cache=Matrix._cache;\r\n\t\tvar mat=!cache._length ? (new Matrix()):cache[--cache._length];\r\n\t\tmat.inPool=false;\r\n\t\treturn mat;\r\n\t}\r\n\r\n\tMatrix._cache=[];\r\n\t__static(Matrix,\r\n\t['EMPTY',function(){return this.EMPTY=new Matrix();},'TEMP',function(){return this.TEMP=new Matrix();}\r\n\t]);\r\n\treturn Matrix;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Point</code> 对象表示二维坐标系统中的某个位置，其中 x 表示水平轴，y 表示垂直轴。\r\n*/\r\n//class laya.maths.Point\r\nvar Point=(function(){\r\n\tfunction Point(x,y){\r\n\t\t/**该点的水平坐标。*/\r\n\t\t//this.x=NaN;\r\n\t\t/**该点的垂直坐标。*/\r\n\t\t//this.y=NaN;\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t}\r\n\r\n\t__class(Point,'laya.maths.Point');\r\n\tvar __proto=Point.prototype;\r\n\t/**\r\n\t*将 <code>Point</code> 的成员设置为指定值。\r\n\t*@param x 水平坐标。\r\n\t*@param y 垂直坐标。\r\n\t*@return 当前 Point 对象。\r\n\t*/\r\n\t__proto.setTo=function(x,y){\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*计算当前点和目标点(x，y)的距离。\r\n\t*@param x 水平坐标。\r\n\t*@param y 垂直坐标。\r\n\t*@return 返回当前点和目标点之间的距离。\r\n\t*/\r\n\t__proto.distance=function(x,y){\r\n\t\treturn Math.sqrt((this.x-x)*(this.x-x)+(this.y-y)*(this.y-y));\r\n\t}\r\n\r\n\t/**返回包含 x 和 y 坐标的值的字符串。*/\r\n\t__proto.toString=function(){\r\n\t\treturn this.x+\",\"+this.y;\r\n\t}\r\n\r\n\t/**\r\n\t*标准化向量。\r\n\t*/\r\n\t__proto.normalize=function(){\r\n\t\tvar d=Math.sqrt(this.x *this.x+this.y *this.y);\r\n\t\tif (d > 0){\r\n\t\t\tvar id=1.0 / d;\r\n\t\t\tthis.x *=id;\r\n\t\t\tthis.y *=id;\r\n\t\t}\r\n\t}\r\n\r\n\t__static(Point,\r\n\t['TEMP',function(){return this.TEMP=new Point();},'EMPTY',function(){return this.EMPTY=new Point();}\r\n\t]);\r\n\treturn Point;\r\n})()\r\n\r\n\r\n/**\r\n*<p><code>Rectangle</code> 对象是按其位置（由它左上角的点 (x,y)确定）以及宽度和高度定义的区域。</p>\r\n*<p>Rectangle 类的 x、y、width 和 height 属性相互独立；更改一个属性的值不会影响其他属性。</p>\r\n*/\r\n//class laya.maths.Rectangle\r\nvar Rectangle=(function(){\r\n\tfunction Rectangle(x,y,width,height){\r\n\t\t/**矩形左上角的 X 轴坐标。*/\r\n\t\t//this.x=NaN;\r\n\t\t/**矩形左上角的 Y 轴坐标。*/\r\n\t\t//this.y=NaN;\r\n\t\t/**矩形的宽度。*/\r\n\t\t//this.width=NaN;\r\n\t\t/**矩形的高度。*/\r\n\t\t//this.height=NaN;\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t\tthis.width=width;\r\n\t\tthis.height=height;\r\n\t}\r\n\r\n\t__class(Rectangle,'laya.maths.Rectangle');\r\n\tvar __proto=Rectangle.prototype;\r\n\t/**\r\n\t*将 Rectangle 的属性设置为指定值。\r\n\t*@param x x 矩形左上角的 X 轴坐标。\r\n\t*@param y x 矩形左上角的 Y 轴坐标。\r\n\t*@param width 矩形的宽度。\r\n\t*@param height 矩形的高。\r\n\t*@return 返回属性值修改后的矩形对象本身。\r\n\t*/\r\n\t__proto.setTo=function(x,y,width,height){\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t\tthis.width=width;\r\n\t\tthis.height=height;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*复制 source 对象的属性值到此矩形对象中。\r\n\t*@param sourceRect 源 Rectangle 对象。\r\n\t*@return 返回属性值修改后的矩形对象本身。\r\n\t*/\r\n\t__proto.copyFrom=function(source){\r\n\t\tthis.x=source.x;\r\n\t\tthis.y=source.y;\r\n\t\tthis.width=source.width;\r\n\t\tthis.height=source.height;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*确定由此 Rectangle 对象定义的矩形区域内是否包含指定的点。\r\n\t*@param x 点的 X 轴坐标值（水平位置）。\r\n\t*@param y 点的 Y 轴坐标值（垂直位置）。\r\n\t*@return 如果 Rectangle 对象包含指定的点，则值为 true；否则为 false。\r\n\t*/\r\n\t__proto.contains=function(x,y){\r\n\t\tif (this.width <=0 || this.height <=0)return false;\r\n\t\tif (x >=this.x && x < this.right){\r\n\t\t\tif (y >=this.y && y < this.bottom){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*确定在 rect 参数中指定的对象是否与此 Rectangle 对象相交。此方法检查指定的 Rectangle 对象的 x、y、width 和 height 属性，以查看它是否与此 Rectangle 对象相交。\r\n\t*@param rect Rectangle 对象。\r\n\t*@return 如果传入的矩形对象与此对象相交，则返回 true 值，否则返回 false。\r\n\t*/\r\n\t__proto.intersects=function(rect){\r\n\t\treturn !(rect.x > (this.x+this.width)|| (rect.x+rect.width)< this.x || rect.y > (this.y+this.height)|| (rect.y+rect.height)< this.y);\r\n\t}\r\n\r\n\t/**\r\n\t*如果在 rect 参数中指定的 Rectangle 对象与此 Rectangle 对象相交，则返回交集区域作为 Rectangle 对象。如果矩形不相交，则此方法返回null。\r\n\t*@param rect 待比较的矩形区域。\r\n\t*@param out （可选）待输出的矩形区域。如果为空则创建一个新的。建议：尽量复用对象，减少对象创建消耗。\r\n\t*@return 返回相交的矩形区域对象。\r\n\t*/\r\n\t__proto.intersection=function(rect,out){\r\n\t\tif (!this.intersects(rect))return null;\r\n\t\tout || (out=new Rectangle());\r\n\t\tout.x=Math.max(this.x,rect.x);\r\n\t\tout.y=Math.max(this.y,rect.y);\r\n\t\tout.width=Math.min(this.right,rect.right)-out.x;\r\n\t\tout.height=Math.min(this.bottom,rect.bottom)-out.y;\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>矩形联合，通过填充两个矩形之间的水平和垂直空间，将这两个矩形组合在一起以创建一个新的 Rectangle 对象。</p>\r\n\t*<p>注意：union()方法忽略高度或宽度值为 0 的矩形，如：var rect2:Rectangle=new Rectangle(300,300,50,0);</p>\r\n\t*@param 要添加到此 Rectangle 对象的 Rectangle 对象。\r\n\t*@param out 用于存储输出结果的矩形对象。如果为空，则创建一个新的。建议：尽量复用对象，减少对象创建消耗。Rectangle.TEMP对象用于对象复用。\r\n\t*@return 充当两个矩形的联合的新 Rectangle 对象。\r\n\t*/\r\n\t__proto.union=function(source,out){\r\n\t\tout || (out=new Rectangle());\r\n\t\tthis.clone(out);\r\n\t\tif (source.width <=0 || source.height <=0)return out;\r\n\t\tout.addPoint(source.x,source.y);\r\n\t\tout.addPoint(source.right,source.bottom);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*返回一个 Rectangle 对象，其 x、y、width 和 height 属性的值与当前 Rectangle 对象的对应值相同。\r\n\t*@param out （可选）用于存储结果的矩形对象。如果为空，则创建一个新的。建议：尽量复用对象，减少对象创建消耗。。Rectangle.TEMP对象用于对象复用。\r\n\t*@return Rectangle 对象，其 x、y、width 和 height 属性的值与当前 Rectangle 对象的对应值相同。\r\n\t*/\r\n\t__proto.clone=function(out){\r\n\t\tout || (out=new Rectangle());\r\n\t\tout.x=this.x;\r\n\t\tout.y=this.y;\r\n\t\tout.width=this.width;\r\n\t\tout.height=this.height;\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t*当前 Rectangle 对象的水平位置 x 和垂直位置 y 以及高度 width 和宽度 height 以逗号连接成的字符串。\r\n\t*/\r\n\t__proto.toString=function(){\r\n\t\treturn this.x+\",\"+this.y+\",\"+this.width+\",\"+this.height;\r\n\t}\r\n\r\n\t/**\r\n\t*检测传入的 Rectangle 对象的属性是否与当前 Rectangle 对象的属性 x、y、width、height 属性值都相等。\r\n\t*@param rect 待比较的 Rectangle 对象。\r\n\t*@return 如果判断的属性都相等，则返回 true ,否则返回 false。\r\n\t*/\r\n\t__proto.equals=function(rect){\r\n\t\tif (!rect || rect.x!==this.x || rect.y!==this.y || rect.width!==this.width || rect.height!==this.height)return false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>为当前矩形对象加一个点，以使当前矩形扩展为包含当前矩形和此点的最小矩形。</p>\r\n\t*<p>此方法会修改本对象。</p>\r\n\t*@param x 点的 X 坐标。\r\n\t*@param y 点的 Y 坐标。\r\n\t*@return 返回此 Rectangle 对象。\r\n\t*/\r\n\t__proto.addPoint=function(x,y){\r\n\t\tthis.x > x && (this.width+=this.x-x,this.x=x);\r\n\t\tthis.y > y && (this.height+=this.y-y,this.y=y);\r\n\t\tif (this.width < x-this.x)this.width=x-this.x;\r\n\t\tif (this.height < y-this.y)this.height=y-this.y;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*返回代表当前矩形的顶点数据。\r\n\t*@return 顶点数据。\r\n\t*/\r\n\t__proto._getBoundPoints=function(){\r\n\t\tvar rst=Rectangle._temB;\r\n\t\trst.length=0;\r\n\t\tif (this.width==0 || this.height==0)return rst;\r\n\t\trst.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*确定此 Rectangle 对象是否为空。\r\n\t*@return 如果 Rectangle 对象的宽度或高度小于等于 0，则返回 true 值，否则返回 false。\r\n\t*/\r\n\t__proto.isEmpty=function(){\r\n\t\tif (this.width <=0 || this.height <=0)return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**此矩形右侧的 X 轴坐标。 x 和 width 属性的和。*/\r\n\t__getset(0,__proto,'right',function(){\r\n\t\treturn this.x+this.width;\r\n\t});\r\n\r\n\t/**此矩形底端的 Y 轴坐标。y 和 height 属性的和。*/\r\n\t__getset(0,__proto,'bottom',function(){\r\n\t\treturn this.y+this.height;\r\n\t});\r\n\r\n\tRectangle._getBoundPointS=function(x,y,width,height){\r\n\t\tvar rst=Rectangle._temA;\r\n\t\trst.length=0;\r\n\t\tif (width==0 || height==0)return rst;\r\n\t\trst.push(x,y,x+width,y,x,y+height,x+width,y+height);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tRectangle._getWrapRec=function(pointList,rst){\r\n\t\tif (!pointList || pointList.length < 1)return rst ? rst.setTo(0,0,0,0):Rectangle.TEMP.setTo(0,0,0,0);\r\n\t\trst=rst ? rst :new Rectangle();\r\n\t\tvar i,len=pointList.length,minX,maxX,minY,maxY,tPoint=Point.TEMP;\r\n\t\tminX=minY=99999;\r\n\t\tmaxX=maxY=-minX;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\ttPoint.x=pointList[i];\r\n\t\t\ttPoint.y=pointList[i+1];\r\n\t\t\tminX=minX < tPoint.x ? minX :tPoint.x;\r\n\t\t\tminY=minY < tPoint.y ? minY :tPoint.y;\r\n\t\t\tmaxX=maxX > tPoint.x ? maxX :tPoint.x;\r\n\t\t\tmaxY=maxY > tPoint.y ? maxY :tPoint.y;\r\n\t\t}\r\n\t\treturn rst.setTo(minX,minY,maxX-minX,maxY-minY);\r\n\t}\r\n\r\n\tRectangle._temB=[];\r\n\tRectangle._temA=[];\r\n\t__static(Rectangle,\r\n\t['EMPTY',function(){return this.EMPTY=new Rectangle();},'TEMP',function(){return this.TEMP=new Rectangle();}\r\n\t]);\r\n\treturn Rectangle;\r\n})()\r\n\r\n\r\n/**\r\n*<code>SoundManager</code> 是一个声音管理类。提供了对背景音乐、音效的播放控制方法。\r\n*引擎默认有两套声音方案：WebAudio和H5Audio\r\n*播放音效，优先使用WebAudio播放声音，如果WebAudio不可用，则用H5Audio播放，H5Audio在部分机器上有兼容问题（比如不能混音，播放有延迟等）。\r\n*播放背景音乐，则使用H5Audio播放（使用WebAudio会增加特别大的内存，并且要等加载完毕后才能播放，有延迟）\r\n*建议背景音乐用mp3类型，音效用wav或者mp3类型（如果打包为app，音效只能用wav格式）。\r\n*详细教程及声音格式请参考：http://ldc.layabox.com/doc/?nav=ch-as-1-7-0\r\n*/\r\n//class laya.media.SoundManager\r\nvar SoundManager=(function(){\r\n\tfunction SoundManager(){}\r\n\t__class(SoundManager,'laya.media.SoundManager');\r\n\t__getset(1,SoundManager,'useAudioMusic',function(){\r\n\t\treturn SoundManager._useAudioMusic;\r\n\t\t},function(value){\r\n\t\tSoundManager._useAudioMusic=value;\r\n\t\tif (value)SoundManager._musicClass=AudioSound;\r\n\t});\r\n\r\n\t/**\r\n\t*失去焦点后是否自动停止背景音乐。\r\n\t*@param v Boolean 失去焦点后是否自动停止背景音乐。\r\n\t*\r\n\t*/\r\n\t/**\r\n\t*失去焦点后是否自动停止背景音乐。\r\n\t*/\r\n\t__getset(1,SoundManager,'autoStopMusic',function(){\r\n\t\treturn SoundManager._autoStopMusic;\r\n\t\t},function(v){\r\n\t\tLaya.stage.off(/*laya.events.Event.BLUR*/\"blur\",null,SoundManager._stageOnBlur);\r\n\t\tLaya.stage.off(/*laya.events.Event.FOCUS*/\"focus\",null,SoundManager._stageOnFocus);\r\n\t\tLaya.stage.off(/*laya.events.Event.VISIBILITY_CHANGE*/\"visibilitychange\",null,SoundManager._visibilityChange);\r\n\t\tSoundManager._autoStopMusic=v;\r\n\t\tif (v){\r\n\t\t\tLaya.stage.on(/*laya.events.Event.BLUR*/\"blur\",null,SoundManager._stageOnBlur);\r\n\t\t\tLaya.stage.on(/*laya.events.Event.FOCUS*/\"focus\",null,SoundManager._stageOnFocus);\r\n\t\t\tLaya.stage.on(/*laya.events.Event.VISIBILITY_CHANGE*/\"visibilitychange\",null,SoundManager._visibilityChange);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*背景音乐和所有音效是否静音。\r\n\t*/\r\n\t__getset(1,SoundManager,'muted',function(){\r\n\t\treturn SoundManager._muted;\r\n\t\t},function(value){\r\n\t\tif (value==SoundManager._muted)return;\r\n\t\tif (value){\r\n\t\t\tSoundManager.stopAllSound();\r\n\t\t}\r\n\t\tSoundManager.musicMuted=value;\r\n\t\tSoundManager._muted=value;\r\n\t});\r\n\r\n\t/**\r\n\t*背景音乐（不包括音效）是否静音。\r\n\t*/\r\n\t__getset(1,SoundManager,'musicMuted',function(){\r\n\t\treturn SoundManager._musicMuted;\r\n\t\t},function(value){\r\n\t\tif (value==SoundManager._musicMuted)return;\r\n\t\tif (value){\r\n\t\t\tif (SoundManager._tMusic){\r\n\t\t\t\tif (SoundManager._musicChannel&&!SoundManager._musicChannel.isStopped){\r\n\t\t\t\t\tSoundManager._musicChannel.pause();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tSoundManager._musicChannel=null;\r\n\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\tSoundManager._musicChannel=null;\r\n\t\t\t}\r\n\t\t\tSoundManager._musicMuted=value;\r\n\t\t\t}else {\r\n\t\t\tSoundManager._musicMuted=value;\r\n\t\t\tif (SoundManager._tMusic){\r\n\t\t\t\tif (SoundManager._musicChannel){\r\n\t\t\t\t\tSoundManager._musicChannel.resume();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*所有音效（不包括背景音乐）是否静音。\r\n\t*/\r\n\t__getset(1,SoundManager,'soundMuted',function(){\r\n\t\treturn SoundManager._soundMuted;\r\n\t\t},function(value){\r\n\t\tSoundManager._soundMuted=value;\r\n\t});\r\n\r\n\tSoundManager.addChannel=function(channel){\r\n\t\tif (SoundManager._channels.indexOf(channel)>=0)return;\r\n\t\tSoundManager._channels.push(channel);\r\n\t}\r\n\r\n\tSoundManager.removeChannel=function(channel){\r\n\t\tvar i=0;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tif (SoundManager._channels[i]==channel){\r\n\t\t\t\tSoundManager._channels.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.disposeSoundIfNotUsed=function(url){\r\n\t\tvar i=0;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tif (SoundManager._channels[i].url==url){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tSoundManager.destroySound(url);\r\n\t}\r\n\r\n\tSoundManager._visibilityChange=function(){\r\n\t\tif (Laya.stage.isVisibility){\r\n\t\t\tSoundManager._stageOnFocus();\r\n\t\t\t}else {\r\n\t\t\tSoundManager._stageOnBlur();\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager._stageOnBlur=function(){\r\n\t\tSoundManager._isActive=false;\r\n\t\tif (SoundManager._musicChannel){\r\n\t\t\tif (!SoundManager._musicChannel.isStopped){\r\n\t\t\t\tSoundManager._blurPaused=true;\r\n\t\t\t\tSoundManager._musicLoops=SoundManager._musicChannel.loops;\r\n\t\t\t\tSoundManager._musicCompleteHandler=SoundManager._musicChannel.completeHandler;\r\n\t\t\t\tSoundManager._musicPosition=SoundManager._musicChannel.position;\r\n\t\t\t\tSoundManager._musicChannel.stop();\r\n\t\t\t\tLaya.stage.once(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",null,SoundManager._stageOnFocus);\r\n\t\t\t}\r\n\t\t}\r\n\t\tSoundManager.stopAllSound();\r\n\t}\r\n\r\n\tSoundManager._stageOnFocus=function(){\r\n\t\tSoundManager._isActive=true;\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",null,SoundManager._stageOnFocus);\r\n\t\tif (SoundManager._blurPaused){\r\n\t\t\tif (SoundManager._tMusic){\r\n\t\t\t\tSoundManager.playMusic(SoundManager._tMusic,SoundManager._musicLoops,SoundManager._musicCompleteHandler,SoundManager._musicPosition);\r\n\t\t\t}\r\n\t\t\tSoundManager._blurPaused=false;\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.playSound=function(url,loops,complete,soundClass,startTime){\r\n\t\t(loops===void 0)&& (loops=1);\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\tif (!SoundManager._isActive || !url)return null;\r\n\t\tif (SoundManager._muted)return null;\r\n\t\turl=URL.formatURL(url);\r\n\t\tif (url==SoundManager._tMusic){\r\n\t\t\tif (SoundManager._musicMuted)return null;\r\n\t\t\t}else {\r\n\t\t\tif (Render.isConchApp){\r\n\t\t\t\tvar ext=Utils.getFileExtension(url);\r\n\t\t\t\tif (ext !=\"wav\" && ext !=\"ogg\"){\r\n\t\t\t\t\talert(\"The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document.\");\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (SoundManager._soundMuted)return null;\r\n\t\t};\r\n\t\tvar tSound;\r\n\t\tif (!Browser.onMiniGame){\r\n\t\t\ttSound=Laya.loader.getRes(url);\r\n\t\t}\r\n\t\tif (!soundClass)soundClass=SoundManager._soundClass;\r\n\t\tif (!tSound){\r\n\t\t\ttSound=new soundClass();\r\n\t\t\ttSound.load(url);\r\n\t\t\tLoader.cacheRes(url,tSound);\r\n\t\t};\r\n\t\tvar channel;\r\n\t\tchannel=tSound.play(startTime,loops);\r\n\t\tif (!channel)return null;\r\n\t\tchannel.url=url;\r\n\t\tchannel.volume=(url==SoundManager._tMusic)? SoundManager.musicVolume :SoundManager.soundVolume;\r\n\t\tchannel.completeHandler=complete;\r\n\t\treturn channel;\r\n\t}\r\n\r\n\tSoundManager.destroySound=function(url){\r\n\t\tvar tSound=Laya.loader.getRes(url);\r\n\t\tif (tSound){\r\n\t\t\tLoader.clearRes(url);\r\n\t\t\ttSound.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.playMusic=function(url,loops,complete,startTime){\r\n\t\t(loops===void 0)&& (loops=0);\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\turl=URL.formatURL(url);\r\n\t\tSoundManager._tMusic=url;\r\n\t\tif (SoundManager._musicChannel)SoundManager._musicChannel.stop();\r\n\t\treturn SoundManager._musicChannel=SoundManager.playSound(url,loops,complete,SoundManager._musicClass,startTime);\r\n\t}\r\n\r\n\tSoundManager.stopSound=function(url){\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar i=0;\r\n\t\tvar channel;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tchannel=SoundManager._channels[i];\r\n\t\t\tif (channel.url==url){\r\n\t\t\t\tchannel.stop();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.stopAll=function(){\r\n\t\tSoundManager._tMusic=null;\r\n\t\tvar i=0;\r\n\t\tvar channel;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tchannel=SoundManager._channels[i];\r\n\t\t\tchannel.stop();\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.stopAllSound=function(){\r\n\t\tvar i=0;\r\n\t\tvar channel;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tchannel=SoundManager._channels[i];\r\n\t\t\tif (channel.url !=SoundManager._tMusic){\r\n\t\t\t\tchannel.stop();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.stopMusic=function(){\r\n\t\tif (SoundManager._musicChannel)SoundManager._musicChannel.stop();\r\n\t\tSoundManager._tMusic=null;\r\n\t}\r\n\r\n\tSoundManager.setSoundVolume=function(volume,url){\r\n\t\tif (url){\r\n\t\t\turl=URL.formatURL(url);\r\n\t\t\tSoundManager._setVolume(url,volume);\r\n\t\t\t}else {\r\n\t\t\tSoundManager.soundVolume=volume;\r\n\t\t\tvar i=0;\r\n\t\t\tvar channel;\r\n\t\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\t\tchannel=SoundManager._channels[i];\r\n\t\t\t\tif (channel.url !=SoundManager._tMusic){\r\n\t\t\t\t\tchannel.volume=volume;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.setMusicVolume=function(volume){\r\n\t\tSoundManager.musicVolume=volume;\r\n\t\tSoundManager._setVolume(SoundManager._tMusic,volume);\r\n\t}\r\n\r\n\tSoundManager._setVolume=function(url,volume){\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar i=0;\r\n\t\tvar channel;\r\n\t\tfor (i=SoundManager._channels.length-1;i >=0;i--){\r\n\t\t\tchannel=SoundManager._channels[i];\r\n\t\t\tif (channel.url==url){\r\n\t\t\t\tchannel.volume=volume;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tSoundManager.musicVolume=1;\r\n\tSoundManager.soundVolume=1;\r\n\tSoundManager.playbackRate=1;\r\n\tSoundManager._useAudioMusic=true;\r\n\tSoundManager._muted=false;\r\n\tSoundManager._soundMuted=false;\r\n\tSoundManager._musicMuted=false;\r\n\tSoundManager._tMusic=null;\r\n\tSoundManager._musicChannel=null;\r\n\tSoundManager._channels=[];\r\n\tSoundManager._autoStopMusic=false;\r\n\tSoundManager._blurPaused=false;\r\n\tSoundManager._isActive=true;\r\n\tSoundManager._musicLoops=0;\r\n\tSoundManager._musicPosition=0;\r\n\tSoundManager._musicCompleteHandler=null;\r\n\tSoundManager._soundClass=null;\r\n\tSoundManager._musicClass=null;\r\n\tSoundManager.autoReleaseSound=true;\r\n\treturn SoundManager;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>LocalStorage</code> 类用于没有时间限制的数据存储。</p>\r\n*/\r\n//class laya.net.LocalStorage\r\nvar LocalStorage=(function(){\r\n\tvar Storage;\r\n\tfunction LocalStorage(){}\r\n\t__class(LocalStorage,'laya.net.LocalStorage');\r\n\tLocalStorage.__init__=function(){\r\n\t\tif (!LocalStorage._baseClass){\r\n\t\t\tLocalStorage._baseClass=Storage;\r\n\t\t\tStorage.init();\r\n\t\t}\r\n\t\tLocalStorage.items=LocalStorage._baseClass.items;\r\n\t\tLocalStorage.support=LocalStorage._baseClass.support;\r\n\t}\r\n\r\n\tLocalStorage.setItem=function(key,value){\r\n\t\tLocalStorage._baseClass.setItem(key,value);\r\n\t}\r\n\r\n\tLocalStorage.getItem=function(key){\r\n\t\treturn LocalStorage._baseClass.getItem(key);\r\n\t}\r\n\r\n\tLocalStorage.setJSON=function(key,value){\r\n\t\tLocalStorage._baseClass.setJSON(key,value);\r\n\t}\r\n\r\n\tLocalStorage.getJSON=function(key){\r\n\t\treturn LocalStorage._baseClass.getJSON(key);\r\n\t}\r\n\r\n\tLocalStorage.removeItem=function(key){\r\n\t\tLocalStorage._baseClass.removeItem(key);\r\n\t}\r\n\r\n\tLocalStorage.clear=function(){\r\n\t\tLocalStorage._baseClass.clear();\r\n\t}\r\n\r\n\tLocalStorage._baseClass=null;\r\n\tLocalStorage.items=null;\r\n\tLocalStorage.support=false;\r\n\tLocalStorage.__init$=function(){\r\n\t\t//class Storage\r\n\t\tStorage=(function(){\r\n\t\t\tfunction Storage(){}\r\n\t\t\t__class(Storage,'');\r\n\t\t\tStorage.init=function(){\r\n\t\t\t\t/*__JS__ */try{Storage.items=window.localStorage;Storage.setItem('laya','1');Storage.removeItem('laya');Storage.support=true;}catch(e){}if(!Storage.support)console.log('LocalStorage is not supprot or browser is private mode.');\r\n\t\t\t}\r\n\t\t\tStorage.setItem=function(key,value){\r\n\t\t\t\ttry {\r\n\t\t\t\t\tStorage.support && Storage.items.setItem(key,value);\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\tconsole.warn(\"set localStorage failed\",e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tStorage.getItem=function(key){\r\n\t\t\t\treturn Storage.support ? Storage.items.getItem(key):null;\r\n\t\t\t}\r\n\t\t\tStorage.setJSON=function(key,value){\r\n\t\t\t\ttry {\r\n\t\t\t\t\tStorage.support && Storage.items.setItem(key,JSON.stringify(value));\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\tconsole.warn(\"set localStorage failed\",e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tStorage.getJSON=function(key){\r\n\t\t\t\treturn JSON.parse(Storage.support ? Storage.items.getItem(key):null);\r\n\t\t\t}\r\n\t\t\tStorage.removeItem=function(key){\r\n\t\t\t\tStorage.support && Storage.items.removeItem(key);\r\n\t\t\t}\r\n\t\t\tStorage.clear=function(){\r\n\t\t\t\tStorage.support && Storage.items.clear();\r\n\t\t\t}\r\n\t\t\tStorage.items=null;\r\n\t\t\tStorage.support=false;\r\n\t\t\treturn Storage;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn LocalStorage;\r\n})()\r\n\r\n\r\n/**\r\n*<p>资源版本的生成由layacmd或IDE完成，使用 <code>ResourceVersion</code> 简化使用过程。</p>\r\n*<p>调用 <code>enable</code> 启用资源版本管理。</p>\r\n*/\r\n//class laya.net.ResourceVersion\r\nvar ResourceVersion=(function(){\r\n\tfunction ResourceVersion(){}\r\n\t__class(ResourceVersion,'laya.net.ResourceVersion');\r\n\tResourceVersion.enable=function(manifestFile,callback,type){\r\n\t\t(type===void 0)&& (type=2);\r\n\t\tlaya.net.ResourceVersion.type=type;\r\n\t\tLaya.loader.load(manifestFile,Handler.create(null,ResourceVersion.onManifestLoaded,[callback]),null,/*laya.net.Loader.JSON*/\"json\");\r\n\t\tURL.customFormat=ResourceVersion.addVersionPrefix;\r\n\t}\r\n\r\n\tResourceVersion.onManifestLoaded=function(callback,data){\r\n\t\tResourceVersion.manifest=data;\r\n\t\tcallback.run();\r\n\t\tif (!data){\r\n\t\t\tconsole.warn(\"资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。\");\r\n\t\t}\r\n\t}\r\n\r\n\tResourceVersion.addVersionPrefix=function(originURL){\r\n\t\tif (ResourceVersion.manifest && ResourceVersion.manifest[originURL]){\r\n\t\t\tif (ResourceVersion.type==2)return ResourceVersion.manifest[originURL];\r\n\t\t\treturn ResourceVersion.manifest[originURL]+\"/\"+originURL;\r\n\t\t}\r\n\t\treturn originURL;\r\n\t}\r\n\r\n\tResourceVersion.FOLDER_VERSION=1;\r\n\tResourceVersion.FILENAME_VERSION=2;\r\n\tResourceVersion.manifest=null;\r\n\tResourceVersion.type=1;\r\n\treturn ResourceVersion;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.net.TTFLoader\r\nvar TTFLoader=(function(){\r\n\tfunction TTFLoader(){\r\n\t\tthis.fontName=null;\r\n\t\tthis.complete=null;\r\n\t\tthis.err=null;\r\n\t\tthis._fontTxt=null;\r\n\t\tthis._url=null;\r\n\t\tthis._div=null;\r\n\t\tthis._txtWidth=NaN;\r\n\t\tthis._http=null;\r\n\t}\r\n\r\n\t__class(TTFLoader,'laya.net.TTFLoader');\r\n\tvar __proto=TTFLoader.prototype;\r\n\t__proto.load=function(fontPath){\r\n\t\tthis._url=fontPath;\r\n\t\tvar tArr=fontPath.split(\".ttf\")[0].split(\"/\");\r\n\t\tthis.fontName=tArr[tArr.length-1];\r\n\t\tif (Browser.window.conch){\r\n\t\t\tthis._loadConch();\r\n\t\t}else\r\n\t\tif (Browser.window.FontFace){\r\n\t\t\tthis._loadWithFontFace()\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._loadWithCSS();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._loadConch=function(){\r\n\t\tthis._http=new HttpRequest();\r\n\t\tthis._http.on(/*laya.events.Event.ERROR*/\"error\",this,this._onErr);\r\n\t\tthis._http.on(/*laya.events.Event.COMPLETE*/\"complete\",this,this._onHttpLoaded);\r\n\t\tthis._http.send(this._url,null,\"get\",/*laya.net.Loader.BUFFER*/\"arraybuffer\");\r\n\t}\r\n\r\n\t__proto._onHttpLoaded=function(data){\r\n\t\tBrowser.window.conch.setFontFaceFromBuffer(this.fontName,data);\r\n\t\tthis._clearHttp();\r\n\t\tthis._complete();\r\n\t}\r\n\r\n\t__proto._clearHttp=function(){\r\n\t\tif (this._http){\r\n\t\t\tthis._http.off(/*laya.events.Event.ERROR*/\"error\",this,this._onErr);\r\n\t\t\tthis._http.off(/*laya.events.Event.COMPLETE*/\"complete\",this,this._onHttpLoaded);\r\n\t\t\tthis._http=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._onErr=function(){\r\n\t\tthis._clearHttp();\r\n\t\tif (this.err){\r\n\t\t\tthis.err.runWith(\"fail:\"+this._url);\r\n\t\t\tthis.err=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._complete=function(){\r\n\t\tLaya.timer.clear(this,this._complete);\r\n\t\tLaya.timer.clear(this,this._checkComplete);\r\n\t\tif (this._div && this._div.parentNode){\r\n\t\t\tthis._div.parentNode.removeChild(this._div);\r\n\t\t\tthis._div=null;\r\n\t\t}\r\n\t\tif (this.complete){\r\n\t\t\tthis.complete.runWith(this);\r\n\t\t\tthis.complete=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._checkComplete=function(){\r\n\t\tif (RunDriver.measureText(\"LayaTTFFont\",this._fontTxt).width !=this._txtWidth){\r\n\t\t\tthis._complete();\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._loadWithFontFace=function(){\r\n\t\tvar fontFace=new Browser.window.FontFace(this.fontName,\"url('\"+this._url+\"')\");\r\n\t\tBrowser.window.document.fonts.add(fontFace);\r\n\t\tvar self=this;\r\n\t\tfontFace.loaded.then((function(){\r\n\t\t\tself._complete()\r\n\t\t}));\r\n\t\tfontFace.load();\r\n\t}\r\n\r\n\t__proto._createDiv=function(){\r\n\t\tthis._div=Browser.createElement(\"div\");\r\n\t\tthis._div.innerHTML=\"laya\";\r\n\t\tvar _style=this._div.style;\r\n\t\t_style.fontFamily=this.fontName;\r\n\t\t_style.position=\"absolute\";\r\n\t\t_style.left=\"-100px\";\r\n\t\t_style.top=\"-100px\";\r\n\t\tBrowser.document.body.appendChild(this._div);\r\n\t}\r\n\r\n\t__proto._loadWithCSS=function(){\r\n\t\tvar _$this=this;\r\n\t\tvar fontStyle=Browser.createElement(\"style\");\r\n\t\tfontStyle.type=\"text/css\";\r\n\t\tBrowser.document.body.appendChild(fontStyle);\r\n\t\tfontStyle.textContent=\"@font-face { font-family:'\"+this.fontName+\"'; src:url('\"+this._url+\"');}\";\r\n\t\tthis._fontTxt=\"40px \"+this.fontName;\r\n\t\tthis._txtWidth=RunDriver.measureText(\"LayaTTFFont\",this._fontTxt).width;\r\n\t\tvar self=this;\r\n\t\tfontStyle.onload=function (){\r\n\t\t\tLaya.timer.once(10000,self,_$this._complete);\r\n\t\t};\r\n\t\tLaya.timer.loop(20,this,this._checkComplete);\r\n\t\tthis._createDiv();\r\n\t}\r\n\r\n\tTTFLoader._testString=\"LayaTTFFont\";\r\n\treturn TTFLoader;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>URL</code> 类用于定义地址信息。</p>\r\n*/\r\n//class laya.net.URL\r\nvar URL=(function(){\r\n\tfunction URL(url){\r\n\t\t/**@private */\r\n\t\tthis._url=null;\r\n\t\t/**@private */\r\n\t\tthis._path=null;\r\n\t\tthis._url=URL.formatURL(url);\r\n\t\tthis._path=URL.getPath(url);\r\n\t}\r\n\r\n\t__class(URL,'laya.net.URL');\r\n\tvar __proto=URL.prototype;\r\n\t/**地址的路径。*/\r\n\t__getset(0,__proto,'path',function(){\r\n\t\treturn this._path;\r\n\t});\r\n\r\n\t/**格式化后的地址。*/\r\n\t__getset(0,__proto,'url',function(){\r\n\t\treturn this._url;\r\n\t});\r\n\r\n\tURL.formatURL=function(url,base){\r\n\t\tif (!url)return \"null path\";\r\n\t\tif (url.indexOf(\":\")> 0)return url;\r\n\t\tif (URL.customFormat !=null)url=URL.customFormat(url,base);\r\n\t\tvar char1=url.charAt(0);\r\n\t\tif (char1===\".\"){\r\n\t\t\treturn URL.formatRelativePath((base || URL.basePath)+url);\r\n\t\t\t}else if (char1==='~'){\r\n\t\t\treturn URL.rootPath+url.substring(1);\r\n\t\t\t}else if (char1===\"d\"){\r\n\t\t\tif (url.indexOf(\"data:image\")===0)return url;\r\n\t\t\t}else if (char1===\"/\"){\r\n\t\t\treturn url;\r\n\t\t}\r\n\t\treturn (base || URL.basePath)+url;\r\n\t}\r\n\r\n\tURL.formatRelativePath=function(value){\r\n\t\tvar parts=value.split(\"/\");\r\n\t\tfor (var i=0,len=parts.length;i < len;i++){\r\n\t\t\tif (parts[i]=='..'){\r\n\t\t\t\tparts.splice(i-1,2);\r\n\t\t\t\ti-=2;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn parts.join('/');\r\n\t}\r\n\r\n\tURL.isAbsolute=function(url){\r\n\t\treturn url.indexOf(\":\")> 0 || url.charAt(0)=='/';\r\n\t}\r\n\r\n\tURL.getPath=function(url){\r\n\t\tvar ofs=url.lastIndexOf('/');\r\n\t\treturn ofs > 0 ? url.substr(0,ofs+1):\"\";\r\n\t}\r\n\r\n\tURL.getFileName=function(url){\r\n\t\tvar ofs=url.lastIndexOf('/');\r\n\t\treturn ofs > 0 ? url.substr(ofs+1):url;\r\n\t}\r\n\r\n\tURL.version={};\r\n\tURL.basePath=\"\";\r\n\tURL.rootPath=\"\";\r\n\tURL.customFormat=function(url){\r\n\t\tvar newUrl=URL.version[url];\r\n\t\tif (!Render.isConchApp && newUrl)url+=\"?v=\"+newUrl;\r\n\t\treturn url;\r\n\t}\r\n\r\n\treturn URL;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Render</code> 是渲染管理类。它是一个单例，可以使用 Laya.render 访问。\r\n*/\r\n//class laya.renders.Render\r\nvar Render=(function(){\r\n\tfunction Render(width,height){\r\n\t\t/**@private */\r\n\t\tthis._timeId=0;\r\n\t\tvar style=Render._mainCanvas.source.style;\r\n\t\tstyle.position='absolute';\r\n\t\tstyle.top=style.left=\"0px\";\r\n\t\tstyle.background=\"#000000\";\r\n\t\tRender._mainCanvas.source.id=\"layaCanvas\";\r\n\t\tvar isWebGl=laya.renders.Render.isWebGL;\r\n\t\tRender._mainCanvas.source.width=width;\r\n\t\tRender._mainCanvas.source.height=height;\r\n\t\tisWebGl && Render.WebGL.init(Render._mainCanvas,width,height);\r\n\t\tBrowser.container.appendChild(Render._mainCanvas.source);\r\n\t\tRender._context=new RenderContext(width,height,isWebGl ? null :Render._mainCanvas);\r\n\t\tRender._context.ctx.setIsMainContext();\r\n\t\tBrowser.window.requestAnimationFrame(loop);\r\n\t\tfunction loop (){\r\n\t\t\tLaya.stage._loop();\r\n\t\t\tBrowser.window.requestAnimationFrame(loop);\r\n\t\t}\r\n\t\tLaya.stage.on(\"visibilitychange\",this,this._onVisibilitychange);\r\n\t}\r\n\r\n\t__class(Render,'laya.renders.Render');\r\n\tvar __proto=Render.prototype;\r\n\t/**@private */\r\n\t__proto._onVisibilitychange=function(){\r\n\t\tif (!Laya.stage.isVisibility){\r\n\t\t\tthis._timeId=Browser.window.setInterval(this._enterFrame,1000);\r\n\t\t\t}else if (this._timeId !=0){\r\n\t\t\tBrowser.window.clearInterval(this._timeId);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._enterFrame=function(e){\r\n\t\tLaya.stage._loop();\r\n\t}\r\n\r\n\t/**目前使用的渲染器。*/\r\n\t__getset(1,Render,'context',function(){\r\n\t\treturn Render._context;\r\n\t});\r\n\r\n\t/**渲染使用的原生画布引用。 */\r\n\t__getset(1,Render,'canvas',function(){\r\n\t\treturn Render._mainCanvas.source;\r\n\t});\r\n\r\n\tRender._context=null;\r\n\tRender._mainCanvas=null;\r\n\tRender.WebGL=null;\r\n\tRender.isConchNode=false;\r\n\tRender.isConchApp=false;\r\n\tRender.isConchWebGL=false;\r\n\tRender.isWebGL=false;\r\n\tRender.is3DMode=false;\r\n\tRender.optimizeTextureMemory=function(url,texture){\r\n\t\treturn true;\r\n\t}\r\n\r\n\tRender.__init$=function(){\r\n\t\t/*__JS__ */window.ConchRenderType=window.ConchRenderType||1;\r\n\t\t/*__JS__ */window.ConchRenderType|=(!window.conch?0:0x04);;{\r\n\t\t\tRender.isConchNode=/*__JS__ */(window.ConchRenderType & 5)==5;\r\n\t\t\tRender.isConchApp=/*__JS__ */(window.ConchRenderType & 0x04)==0x04;\r\n\t\t\tRender.isConchWebGL=/*__JS__ */window.ConchRenderType==6;\r\n\t\t};;\r\n\t}\r\n\r\n\treturn Render;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*渲染环境\r\n*/\r\n//class laya.renders.RenderContext\r\nvar RenderContext=(function(){\r\n\tfunction RenderContext(width,height,canvas){\r\n\t\t/**全局x坐标 */\r\n\t\tthis.x=0;\r\n\t\t/**全局y坐标 */\r\n\t\tthis.y=0;\r\n\t\t/**当前使用的画布 */\r\n\t\t//this.canvas=null;\r\n\t\t/**当前使用的画布上下文 */\r\n\t\t//this.ctx=null;\r\n\t\tthis._drawTexture=function(x,y,args){\r\n\t\t\tif (args[0].loaded)this.ctx.drawTexture(args[0],args[1],args[2],args[3],args[4],x,y);\r\n\t\t}\r\n\t\tthis._fillTexture=function(x,y,args){\r\n\t\t\tif (args[0].loaded)this.ctx.fillTexture(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7]);\r\n\t\t}\r\n\t\tthis._drawTextureWithTransform=function(x,y,args){\r\n\t\t\tif (args[0].loaded)this.ctx.drawTextureWithTransform(args[0],args[1],args[2],args[3],args[4],args[5],x,y,args[6]);\r\n\t\t}\r\n\t\tthis._fillQuadrangle=function(x,y,args){\r\n\t\t\tthis.ctx.fillQuadrangle(args[0],args[1],args[2],args[3],args[4]);\r\n\t\t}\r\n\t\tthis._drawRect=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tif (args[4] !=null){\r\n\t\t\t\tctx.fillStyle=args[4];\r\n\t\t\t\tctx.fillRect(x+args[0],y+args[1],args[2],args[3],null);\r\n\t\t\t}\r\n\t\t\tif (args[5] !=null){\r\n\t\t\t\tctx.strokeStyle=args[5];\r\n\t\t\t\tctx.lineWidth=args[6];\r\n\t\t\t\tctx.strokeRect(x+args[0],y+args[1],args[2],args[3],args[6]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//矢量方法\r\n\t\tthis._drawPie=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tRender.isWebGL && ctx.setPathId(args[8]);\r\n\t\t\tctx.beginPath();\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tctx.movePath(args[0]+x,args[1]+y);\r\n\t\t\t\tctx.moveTo(0,0);\r\n\t\t\t\t}else {\r\n\t\t\t\tctx.moveTo(x+args[0],y+args[1]);\r\n\t\t\t}\r\n\t\t\tctx.arc(x+args[0],y+args[1],args[2],args[3],args[4]);\r\n\t\t\tctx.closePath();\r\n\t\t\tthis._fillAndStroke(args[5],args[6],args[7],true);\r\n\t\t}\r\n\t\tthis._clipRect=function(x,y,args){\r\n\t\t\tthis.ctx.clipRect(x+args[0],y+args[1],args[2],args[3]);\r\n\t\t}\r\n\t\tthis._fillRect=function(x,y,args){\r\n\t\t\tthis.ctx.fillRect(x+args[0],y+args[1],args[2],args[3],args[4]);\r\n\t\t}\r\n\t\tthis._drawCircle=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tRender.isWebGL && ctx.setPathId(args[6]);\r\n\t\t\tStat.drawCall++;\r\n\t\t\tctx.beginPath();\r\n\t\t\tRender.isWebGL && ctx.movePath(args[0]+x,args[1]+y);\r\n\t\t\tctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2);\r\n\t\t\tctx.closePath();\r\n\t\t\tthis._fillAndStroke(args[3],args[4],args[5],true);\r\n\t\t}\r\n\t\tthis._fillCircle=function(x,y,args){\r\n\t\t\tStat.drawCall++;\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.fillStyle=args[3];\r\n\t\t\tctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2);\r\n\t\t\tctx.fill();\r\n\t\t}\r\n\t\tthis._setShader=function(x,y,args){\r\n\t\t\tthis.ctx.setShader(args[0]);\r\n\t\t}\r\n\t\tthis._drawLine=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tRender.isWebGL && ctx.setPathId(args[6]);\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.strokeStyle=args[4];\r\n\t\t\tctx.lineWidth=args[5];\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tctx.movePath(x,y);\r\n\t\t\t\tctx.moveTo(args[0],args[1]);\r\n\t\t\t\tctx.lineTo(args[2],args[3]);\r\n\t\t\t\t}else {\r\n\t\t\t\tctx.moveTo(x+args[0],y+args[1]);\r\n\t\t\t\tctx.lineTo(x+args[2],y+args[3]);\r\n\t\t\t}\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t\tthis._drawLines=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tRender.isWebGL && ctx.setPathId(args[5]);\r\n\t\t\tctx.beginPath();\r\n\t\t\tx+=args[0],y+=args[1];\r\n\t\t\tRender.isWebGL && ctx.movePath(x,y);\r\n\t\t\tctx.strokeStyle=args[3];\r\n\t\t\tctx.lineWidth=args[4];\r\n\t\t\tvar points=args[2];\r\n\t\t\tvar i=2,n=points.length;\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tctx.moveTo(points[0],points[1]);\r\n\t\t\t\twhile (i < n){\r\n\t\t\t\t\tctx.lineTo(points[i++],points[i++]);\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tctx.moveTo(x+points[0],y+points[1]);\r\n\t\t\t\twhile (i < n){\r\n\t\t\t\t\tctx.lineTo(x+points[i++],y+points[i++]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t\tthis._drawLinesWebGL=function(x,y,args){\r\n\t\t\tthis.ctx.drawLines(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4]);\r\n\t\t}\r\n\t\t//x:Number,y:Number,points:Array,lineColor:String,lineWidth:Number=1\r\n\t\tthis._drawCurves=function(x,y,args){\r\n\t\t\tthis.ctx.drawCurves(x,y,args);\r\n\t\t}\r\n\t\tthis._draw=function(x,y,args){\r\n\t\t\targs[0].call(null,this,x,y);\r\n\t\t}\r\n\t\tthis._transformByMatrix=function(x,y,args){\r\n\t\t\tthis.ctx.transformByMatrix(args[0]);\r\n\t\t}\r\n\t\tthis._setTransform=function(x,y,args){\r\n\t\t\tthis.ctx.setTransform(args[0],args[1],args[2],args[3],args[4],args[5]);\r\n\t\t}\r\n\t\tthis._setTransformByMatrix=function(x,y,args){\r\n\t\t\tthis.ctx.setTransformByMatrix(args[0]);\r\n\t\t}\r\n\t\tthis._save=function(x,y,args){\r\n\t\t\tthis.ctx.save();\r\n\t\t}\r\n\t\tthis._restore=function(x,y,args){\r\n\t\t\tthis.ctx.restore();\r\n\t\t}\r\n\t\tthis._translate=function(x,y,args){\r\n\t\t\tthis.ctx.translate(args[0],args[1]);\r\n\t\t}\r\n\t\tthis._transform=function(x,y,args){\r\n\t\t\tthis.ctx.translate(args[1]+x,args[2]+y);\r\n\t\t\tvar mat=args[0];\r\n\t\t\tthis.ctx.transform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty);\r\n\t\t\tthis.ctx.translate(-x-args[1],-y-args[2]);\r\n\t\t}\r\n\t\tthis._rotate=function(x,y,args){\r\n\t\t\tthis.ctx.translate(args[1]+x,args[2]+y);\r\n\t\t\tthis.ctx.rotate(args[0]);\r\n\t\t\tthis.ctx.translate(-x-args[1],-y-args[2]);\r\n\t\t}\r\n\t\tthis._scale=function(x,y,args){\r\n\t\t\tthis.ctx.translate(args[2]+x,args[3]+y);\r\n\t\t\tthis.ctx.scale(args[0],args[1]);\r\n\t\t\tthis.ctx.translate(-x-args[2],-y-args[3]);\r\n\t\t}\r\n\t\tthis._alpha=function(x,y,args){\r\n\t\t\tthis.ctx.globalAlpha *=args[0];\r\n\t\t}\r\n\t\tthis._setAlpha=function(x,y,args){\r\n\t\t\tthis.ctx.globalAlpha=args[0];\r\n\t\t}\r\n\t\tthis._fillText=function(x,y,args){\r\n\t\t\tthis.ctx.fillText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5]);\r\n\t\t}\r\n\t\tthis._strokeText=function(x,y,args){\r\n\t\t\tthis.ctx.strokeText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6]);\r\n\t\t}\r\n\t\tthis._fillBorderText=function(x,y,args){\r\n\t\t\tthis.ctx.fillBorderText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7]);\r\n\t\t}\r\n\t\tthis._blendMode=function(x,y,args){\r\n\t\t\tthis.ctx.globalCompositeOperation=args[0];\r\n\t\t}\r\n\t\tthis._beginClip=function(x,y,args){\r\n\t\t\tthis.ctx.beginClip && this.ctx.beginClip(x+args[0],y+args[1],args[2],args[3]);\r\n\t\t}\r\n\t\tthis._setIBVB=function(x,y,args){\r\n\t\t\tthis.ctx.setIBVB(args[0]+x,args[1]+y,args[2],args[3],args[4],args[5],args[6],args[7]);\r\n\t\t}\r\n\t\tthis._fillTrangles=function(x,y,args){\r\n\t\t\tthis.ctx.fillTrangles(args[0],args[1]+x,args[2]+y,args[3],args[4]);\r\n\t\t}\r\n\t\t//x:Number,y:Number,paths:Array,brush:Object=null,pen:Object=null\r\n\t\tthis._drawPath=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tRender.isWebGL && ctx.setPathId(-1);\r\n\t\t\tctx.beginPath();\r\n\t\t\tx+=args[0],y+=args[1];\r\n\t\t\tRender.isWebGL && ctx.movePath(x,y);\r\n\t\t\tvar paths=args[2];\r\n\t\t\tfor (var i=0,n=paths.length;i < n;i++){\r\n\t\t\t\tvar path=paths[i];\r\n\t\t\t\tswitch (path[0]){\r\n\t\t\t\t\tcase \"moveTo\":\r\n\t\t\t\t\t\tRender.isWebGL ? ctx.moveTo(path[1],path[2]):ctx.moveTo(x+path[1],y+path[2]);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"lineTo\":\r\n\t\t\t\t\t\tRender.isWebGL ? ctx.lineTo(path[1],path[2]):ctx.lineTo(x+path[1],y+path[2]);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"arcTo\":\r\n\t\t\t\t\t\tRender.isWebGL ? ctx.arcTo(path[1],path[2],path[3],path[4],path[5]):ctx.arcTo(x+path[1],y+path[2],x+path[3],y+path[4],path[5]);\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\tcase \"closePath\":\r\n\t\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tvar brush=args[3];\r\n\t\t\tif (brush !=null){\r\n\t\t\t\tctx.fillStyle=brush.fillStyle;\r\n\t\t\t\tctx.fill();\r\n\t\t\t};\r\n\t\t\tvar pen=args[4];\r\n\t\t\tif (pen !=null){\r\n\t\t\t\tctx.strokeStyle=pen.strokeStyle;\r\n\t\t\t\tctx.lineWidth=pen.lineWidth || 1;\r\n\t\t\t\tctx.lineJoin=pen.lineJoin;\r\n\t\t\t\tctx.lineCap=pen.lineCap;\r\n\t\t\t\tctx.miterLimit=pen.miterLimit;\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t}\r\n\t\t// polygon(x:Number,y:Number,r:Number,edges:Number,color:uint,borderWidth:int=2,borderColor:uint=0)\r\n\t\tthis.drawPoly=function(x,y,args){\r\n\t\t\tthis.ctx.drawPoly(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4],args[5],args[6]);\r\n\t\t}\r\n\t\t//x:Number,y:Number,points:Array,fillColor:String,lineColor:String=null,lineWidth:Number=1\r\n\t\tthis._drawPoly=function(x,y,args){\r\n\t\t\tvar ctx=this.ctx;\r\n\t\t\tvar points=args[2];\r\n\t\t\tvar i=2,n=points.length;\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tctx.setPathId(args[6]);\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tx+=args[0],y+=args[1];\r\n\t\t\t\tctx.movePath(x,y);\r\n\t\t\t\tctx.moveTo(points[0],points[1]);\r\n\t\t\t\twhile (i < n){\r\n\t\t\t\t\tctx.lineTo(points[i++],points[i++]);\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tx+=args[0],y+=args[1];\r\n\t\t\t\tctx.moveTo(x+points[0],y+points[1]);\r\n\t\t\t\twhile (i < n){\r\n\t\t\t\t\tctx.lineTo(x+points[i++],y+points[i++]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.closePath();\r\n\t\t\tthis._fillAndStroke(args[3],args[4],args[5],args[7]);\r\n\t\t}\r\n\t\tthis._drawSkin=function(x,y,args){\r\n\t\t\tvar tSprite=args[0];\r\n\t\t\tif (tSprite){\r\n\t\t\t\tvar ctx=this.ctx;\r\n\t\t\t\ttSprite.render(ctx,x,y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._drawParticle=function(x,y,args){\r\n\t\t\tthis.ctx.drawParticle(x+this.x,y+this.y,args[0]);\r\n\t\t}\r\n\t\tthis._setFilters=function(x,y,args){\r\n\t\t\tthis.ctx.setFilters(args);\r\n\t\t}\r\n\t\tif (canvas){\r\n\t\t\tthis.ctx=canvas.getContext('2d');\r\n\t\t\t}else {\r\n\t\t\tcanvas=HTMLCanvas.create(\"3D\");\r\n\t\t\tthis.ctx=RunDriver.createWebGLContext2D(canvas);\r\n\t\t\tcanvas._setContext(this.ctx);\r\n\t\t}\r\n\t\tcanvas.size(width,height);\r\n\t\tthis.canvas=canvas;\r\n\t}\r\n\r\n\t__class(RenderContext,'laya.renders.RenderContext');\r\n\tvar __proto=RenderContext.prototype;\r\n\t/**销毁当前渲染环境*/\r\n\t__proto.destroy=function(){\r\n\t\tif (this.canvas){\r\n\t\t\tthis.canvas.destroy();\r\n\t\t\tthis.canvas=null;\r\n\t\t\tthis.ctx=null;\r\n\t\t}\r\n\t\tif (this.ctx){\r\n\t\t\tthis.ctx.destroy();\r\n\t\t\tthis.ctx=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.drawTexture=function(tex,x,y,width,height){\r\n\t\tif (tex.loaded)this.ctx.drawTexture(tex,x,y,width,height,this.x,this.y);\r\n\t}\r\n\r\n\t__proto._drawTextures=function(x,y,args){\r\n\t\tif (args[0].loaded)this.ctx.drawTextures(args[0],args[1],x+this.x,y+this.y);\r\n\t}\r\n\r\n\t__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,alpha){\r\n\t\tif (tex.loaded)this.ctx.drawTextureWithTransform(tex,x,y,width,height,m,this.x,this.y,alpha);\r\n\t}\r\n\r\n\t__proto.fillQuadrangle=function(tex,x,y,point4,m){\r\n\t\tthis.ctx.fillQuadrangle(tex,x,y,point4,m);\r\n\t}\r\n\r\n\t__proto.drawCanvas=function(canvas,x,y,width,height){\r\n\t\tthis.ctx.drawCanvas(canvas,x+this.x,y+this.y,width,height);\r\n\t}\r\n\r\n\t__proto.drawRect=function(x,y,width,height,color,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar ctx=this.ctx;\r\n\t\tctx.strokeStyle=color;\r\n\t\tctx.lineWidth=lineWidth;\r\n\t\tctx.strokeRect(x+this.x,y+this.y,width,height,lineWidth);\r\n\t}\r\n\r\n\t__proto._fillAndStroke=function(fillColor,strokeColor,lineWidth,isConvexPolygon){\r\n\t\t(isConvexPolygon===void 0)&& (isConvexPolygon=false);\r\n\t\tvar ctx=this.ctx;\r\n\t\tif (fillColor !=null){\r\n\t\t\tctx.fillStyle=fillColor;\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tctx.fill(isConvexPolygon);\r\n\t\t\t\t}else {\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (strokeColor !=null && lineWidth > 0){\r\n\t\t\tctx.strokeStyle=strokeColor;\r\n\t\t\tctx.lineWidth=lineWidth;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t}\r\n\r\n\t//ctx.translate(-x-args[0],-y-args[1]);\r\n\t__proto.clipRect=function(x,y,width,height){\r\n\t\tthis.ctx.clipRect(x+this.x,y+this.y,width,height);\r\n\t}\r\n\r\n\t__proto.fillRect=function(x,y,width,height,fillStyle){\r\n\t\tthis.ctx.fillRect(x+this.x,y+this.y,width,height,fillStyle);\r\n\t}\r\n\r\n\t__proto.drawCircle=function(x,y,radius,color,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tStat.drawCall++;\r\n\t\tvar ctx=this.ctx;\r\n\t\tctx.beginPath();\r\n\t\tctx.strokeStyle=color;\r\n\t\tctx.lineWidth=lineWidth;\r\n\t\tctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2);\r\n\t\tctx.stroke();\r\n\t}\r\n\r\n\t__proto.fillCircle=function(x,y,radius,color){\r\n\t\tStat.drawCall++;\r\n\t\tvar ctx=this.ctx;\r\n\t\tctx.beginPath();\r\n\t\tctx.fillStyle=color;\r\n\t\tctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2);\r\n\t\tctx.fill();\r\n\t}\r\n\r\n\t__proto.setShader=function(shader){\r\n\t\tthis.ctx.setShader(shader);\r\n\t}\r\n\r\n\t__proto.drawLine=function(fromX,fromY,toX,toY,color,lineWidth){\r\n\t\t(lineWidth===void 0)&& (lineWidth=1);\r\n\t\tvar ctx=this.ctx;\r\n\t\tctx.beginPath();\r\n\t\tctx.strokeStyle=color;\r\n\t\tctx.lineWidth=lineWidth;\r\n\t\tctx.moveTo(this.x+fromX,this.y+fromY);\r\n\t\tctx.lineTo(this.x+toX,this.y+toY);\r\n\t\tctx.stroke();\r\n\t}\r\n\r\n\t__proto.clear=function(){\r\n\t\tthis.ctx.clear();\r\n\t}\r\n\r\n\t__proto.transformByMatrix=function(value){\r\n\t\tthis.ctx.transformByMatrix(value);\r\n\t}\r\n\r\n\t__proto.setTransform=function(a,b,c,d,tx,ty){\r\n\t\tthis.ctx.setTransform(a,b,c,d,tx,ty);\r\n\t}\r\n\r\n\t__proto.setTransformByMatrix=function(value){\r\n\t\tthis.ctx.setTransformByMatrix(value);\r\n\t}\r\n\r\n\t__proto.save=function(){\r\n\t\tthis.ctx.save();\r\n\t}\r\n\r\n\t__proto.restore=function(){\r\n\t\tthis.ctx.restore();\r\n\t}\r\n\r\n\t__proto.translate=function(x,y){\r\n\t\tthis.ctx.translate(x,y);\r\n\t}\r\n\r\n\t__proto.transform=function(a,b,c,d,tx,ty){\r\n\t\tthis.ctx.transform(a,b,c,d,tx,ty);\r\n\t}\r\n\r\n\t__proto.rotate=function(angle){\r\n\t\tthis.ctx.rotate(angle);\r\n\t}\r\n\r\n\t__proto.scale=function(scaleX,scaleY){\r\n\t\tthis.ctx.scale(scaleX,scaleY);\r\n\t}\r\n\r\n\t__proto.alpha=function(value){\r\n\t\tthis.ctx.globalAlpha *=value;\r\n\t}\r\n\r\n\t__proto.setAlpha=function(value){\r\n\t\tthis.ctx.globalAlpha=value;\r\n\t}\r\n\r\n\t__proto.fillWords=function(words,x,y,font,color,underLine){\r\n\t\t(underLine===void 0)&& (underLine=0);\r\n\t\tthis.ctx.fillWords(words,x,y,font,color,underLine);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillBorderWords=function(words,x,y,font,fillColor,borderColor,lineWidth){\r\n\t\tthis.ctx.fillBorderWords(words,x,y,font,fillColor,borderColor,lineWidth);\r\n\t}\r\n\r\n\t__proto.fillText=function(text,x,y,font,color,textAlign){\r\n\t\tthis.ctx.fillText(text,x+this.x,y+this.y,font,color,textAlign);\r\n\t}\r\n\r\n\t__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){\r\n\t\tthis.ctx.strokeText(text,x+this.x,y+this.y,font,color,lineWidth,textAlign);\r\n\t}\r\n\r\n\t__proto.blendMode=function(type){\r\n\t\tthis.ctx.globalCompositeOperation=type;\r\n\t}\r\n\r\n\t__proto.flush=function(){\r\n\t\tthis.ctx.flush && this.ctx.flush();\r\n\t}\r\n\r\n\t__proto.addRenderObject=function(o){\r\n\t\tthis.ctx.addRenderObject(o);\r\n\t}\r\n\r\n\t__proto.beginClip=function(x,y,w,h){\r\n\t\tthis.ctx.beginClip && this.ctx.beginClip(x,y,w,h);\r\n\t}\r\n\r\n\t__proto.endClip=function(){\r\n\t\tthis.ctx.endClip && this.ctx.endClip();\r\n\t}\r\n\r\n\t__proto.fillTrangles=function(x,y,args){\r\n\t\tthis.ctx.fillTrangles(args[0],args[1],args[2],args[3],args.length > 4 ? args[4] :null);\r\n\t}\r\n\r\n\t__static(RenderContext,\r\n\t['PI2',function(){return this.PI2=2 *Math.PI;}\r\n\t]);\r\n\treturn RenderContext;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*精灵渲染器\r\n*/\r\n//class laya.renders.RenderSprite\r\nvar RenderSprite=(function(){\r\n\tfunction RenderSprite(type,next){\r\n\t\t/**@private */\r\n\t\t//this._next=null;\r\n\t\t/**@private */\r\n\t\t//this._fun=null;\r\n\t\tthis._next=next || RenderSprite.NORENDER;\r\n\t\tswitch (type){\r\n\t\t\tcase 0:\r\n\t\t\t\tthis._fun=this._no;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x01:\r\n\t\t\t\tthis._fun=this._image;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x02:\r\n\t\t\t\tthis._fun=this._alpha;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x04:\r\n\t\t\t\tthis._fun=this._transform;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x08:\r\n\t\t\t\tthis._fun=this._blend;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x10:\r\n\t\t\t\tthis._fun=this._canvas;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x40:\r\n\t\t\t\tthis._fun=this._mask;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x80:\r\n\t\t\t\tthis._fun=this._clip;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x100:\r\n\t\t\t\tthis._fun=this._style;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x200:\r\n\t\t\t\tthis._fun=this._graphics;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x800:\r\n\t\t\t\tthis._fun=this._childs;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x400:\r\n\t\t\t\tthis._fun=this._custom;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x01 | 0x200:\r\n\t\t\t\tthis._fun=this._image2;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x01 | 0x04 | 0x200:\r\n\t\t\t\tthis._fun=this._image2;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x20:\r\n\t\t\t\tthis._fun=Filter._filter;\r\n\t\t\t\treturn;\r\n\t\t\tcase 0x11111:\r\n\t\t\t\tthis._fun=RenderSprite._initRenderFun;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\tthis.onCreate(type);\r\n\t}\r\n\r\n\t__class(RenderSprite,'laya.renders.RenderSprite');\r\n\tvar __proto=RenderSprite.prototype;\r\n\t__proto.onCreate=function(type){}\r\n\t__proto._style=function(sprite,context,x,y){\r\n\t\tsprite._style.render(sprite,context,x,y);\r\n\t\tvar next=this._next;\r\n\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t}\r\n\r\n\t__proto._no=function(sprite,context,x,y){}\r\n\t__proto._custom=function(sprite,context,x,y){\r\n\t\tsprite.customRender(context,x,y);\r\n\t\tvar tf=sprite._style._tf;\r\n\t\tthis._next._fun.call(this._next,sprite,context,x-tf.translateX,y-tf.translateY);\r\n\t}\r\n\r\n\t__proto._clip=function(sprite,context,x,y){\r\n\t\tvar next=this._next;\r\n\t\tif (next==RenderSprite.NORENDER)return;\r\n\t\tvar r=sprite._style.scrollRect;\r\n\t\tcontext.ctx.save();\r\n\t\tcontext.ctx.clipRect(x,y,r.width,r.height);\r\n\t\tnext._fun.call(next,sprite,context,x-r.x,y-r.y);\r\n\t\tcontext.ctx.restore();\r\n\t}\r\n\r\n\t__proto._blend=function(sprite,context,x,y){\r\n\t\tvar style=sprite._style;\r\n\t\tif (style.blendMode){\r\n\t\t\tcontext.ctx.globalCompositeOperation=style.blendMode;\r\n\t\t};\r\n\t\tvar next=this._next;\r\n\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\tcontext.ctx.globalCompositeOperation=\"source-over\";\r\n\t}\r\n\r\n\t__proto._mask=function(sprite,context,x,y){\r\n\t\tvar next=this._next;\r\n\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\tvar mask=sprite.mask;\r\n\t\tif (mask){\r\n\t\t\tcontext.ctx.globalCompositeOperation=\"destination-in\";\r\n\t\t\tif (mask.numChildren > 0 || !mask.graphics._isOnlyOne()){\r\n\t\t\t\tmask.cacheAsBitmap=true;\r\n\t\t\t}\r\n\t\t\tmask.render(context,x-sprite.pivotX,y-sprite.pivotY);\r\n\t\t}\r\n\t\tcontext.ctx.globalCompositeOperation=\"source-over\";\r\n\t}\r\n\r\n\t__proto._graphics=function(sprite,context,x,y){\r\n\t\tvar tf=sprite._style._tf;\r\n\t\tsprite._graphics && sprite._graphics._render(sprite,context,x-tf.translateX,y-tf.translateY);\r\n\t\tvar next=this._next;\r\n\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t}\r\n\r\n\t__proto._image=function(sprite,context,x,y){\r\n\t\tvar style=sprite._style;\r\n\t\tcontext.ctx.drawTexture2(x,y,style._tf.translateX,style._tf.translateY,sprite.transform,style.alpha,style.blendMode,sprite._graphics._one);\r\n\t}\r\n\r\n\t__proto._image2=function(sprite,context,x,y){\r\n\t\tvar tf=sprite._style._tf;\r\n\t\tcontext.ctx.drawTexture2(x,y,tf.translateX,tf.translateY,sprite.transform,1,null,sprite._graphics._one);\r\n\t}\r\n\r\n\t__proto._alpha=function(sprite,context,x,y){\r\n\t\tvar style=sprite._style;\r\n\t\tvar alpha;\r\n\t\tif ((alpha=style.alpha)> 0.01 || sprite._needRepaint()){\r\n\t\t\tvar temp=context.ctx.globalAlpha;\r\n\t\t\tcontext.ctx.globalAlpha *=alpha;\r\n\t\t\tvar next=this._next;\r\n\t\t\tnext._fun.call(next,sprite,context,x,y);\r\n\t\t\tcontext.ctx.globalAlpha=temp;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._transform=function(sprite,context,x,y){\r\n\t\tvar transform=sprite.transform,_next=this._next;\r\n\t\tif (transform && _next !=RenderSprite.NORENDER){\r\n\t\t\tcontext.save();\r\n\t\t\tcontext.transform(transform.a,transform.b,transform.c,transform.d,transform.tx+x,transform.ty+y);\r\n\t\t\t_next._fun.call(_next,sprite,context,0,0);\r\n\t\t\tcontext.restore();\r\n\t\t}else\r\n\t\t_next._fun.call(_next,sprite,context,x,y);\r\n\t}\r\n\r\n\t__proto._childs=function(sprite,context,x,y){\r\n\t\tvar style=sprite._style;\r\n\t\tvar tf=style._tf;\r\n\t\tx=x-tf.translateX+style.paddingLeft;\r\n\t\ty=y-tf.translateY+style.paddingTop;\r\n\t\tif (style._calculation){\r\n\t\t\tvar words=sprite._getWords();\r\n\t\t\tif (words){\r\n\t\t\t\tvar tStyle=style;\r\n\t\t\t\tif (tStyle){\r\n\t\t\t\t\tif (tStyle.stroke){\r\n\t\t\t\t\t\tcontext.fillBorderWords(words,x,y,tStyle.font,tStyle.color,tStyle.strokeColor,tStyle.stroke);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\tcontext.fillWords(words,x,y,tStyle.font,tStyle.color,tStyle.underLine);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar childs=sprite._childs,n=childs.length,ele;\r\n\t\tif (sprite.viewport || (sprite.optimizeScrollRect && sprite._style.scrollRect)){\r\n\t\t\tvar rect=sprite.viewport || sprite._style.scrollRect;\r\n\t\t\tvar left=rect.x;\r\n\t\t\tvar top=rect.y;\r\n\t\t\tvar right=rect.right;\r\n\t\t\tvar bottom=rect.bottom;\r\n\t\t\tvar _x=NaN,_y=NaN;\r\n\t\t\tfor (i=0;i < n;++i){\r\n\t\t\t\tif ((ele=childs [i]).visible && ((_x=ele._x)< right && (_x+ele.width)> left && (_y=ele._y)< bottom && (_y+ele.height)> top)){\r\n\t\t\t\t\tele.render(context,x,y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (var i=0;i < n;++i)\r\n\t\t\t(ele=(childs [i]))._style.visible && ele.render(context,x,y);\r\n\t\t}\r\n\t}\r\n\r\n\t//}\r\n\t__proto._canvas=function(sprite,context,x,y){\r\n\t\tvar _cacheCanvas=sprite._$P.cacheCanvas;\r\n\t\tif (!_cacheCanvas){\r\n\t\t\tthis._next._fun.call(this._next,sprite,context,x,y);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_cacheCanvas.type==='bitmap' ? (Stat.canvasBitmap++):(Stat.canvasNormal++);\r\n\t\tvar tx=_cacheCanvas.ctx;\r\n\t\tif (sprite._needRepaint()|| !tx){\r\n\t\t\tthis._canvas_repaint(sprite,context,x,y);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tvar tRec=_cacheCanvas._cacheRec;\r\n\t\t\tcontext.drawCanvas(tx.canvas,x+tRec.x,y+tRec.y,tRec.width,tRec.height);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._canvas_repaint=function(sprite,context,x,y){\r\n\t\tvar _cacheCanvas=sprite._$P.cacheCanvas;\r\n\t\tvar _next=this._next;\r\n\t\tif (!_cacheCanvas){\r\n\t\t\t_next._fun.call(_next,sprite,tx,x,y);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tx=_cacheCanvas.ctx;\r\n\t\tvar _repaint=sprite._needRepaint()|| (!tx);\r\n\t\tvar canvas;\r\n\t\tvar left;\r\n\t\tvar top;\r\n\t\tvar tRec;\r\n\t\tvar tCacheType=_cacheCanvas.type;\r\n\t\ttCacheType==='bitmap' ? (Stat.canvasBitmap++):(Stat.canvasNormal++);\r\n\t\tif (_repaint){\r\n\t\t\tif (!_cacheCanvas._cacheRec)\r\n\t\t\t\t_cacheCanvas._cacheRec=new Rectangle();\r\n\t\t\tvar w,h;\r\n\t\t\tif (!Render.isWebGL || tCacheType===\"bitmap\"){\r\n\t\t\t\ttRec=sprite.getSelfBounds();\r\n\t\t\t\ttRec.x=tRec.x-sprite.pivotX;\r\n\t\t\t\ttRec.y=tRec.y-sprite.pivotY;\r\n\t\t\t\ttRec.x=tRec.x-16;\r\n\t\t\t\ttRec.y=tRec.y-16;\r\n\t\t\t\ttRec.width=tRec.width+32;\r\n\t\t\t\ttRec.height=tRec.height+32;\r\n\t\t\t\ttRec.x=Math.floor(tRec.x+x)-x;\r\n\t\t\t\ttRec.y=Math.floor(tRec.y+y)-y;\r\n\t\t\t\ttRec.width=Math.floor(tRec.width);\r\n\t\t\t\ttRec.height=Math.floor(tRec.height);\r\n\t\t\t\t_cacheCanvas._cacheRec.copyFrom(tRec);\r\n\t\t\t\t}else{\r\n\t\t\t\t_cacheCanvas._cacheRec.setTo(-sprite.pivotX,-sprite.pivotY,1,1);\r\n\t\t\t}\r\n\t\t\ttRec=_cacheCanvas._cacheRec;\r\n\t\t\tvar scaleX=Render.isWebGL ? 1 :Browser.pixelRatio *Laya.stage.clientScaleX;\r\n\t\t\tvar scaleY=Render.isWebGL ? 1 :Browser.pixelRatio *Laya.stage.clientScaleY;\r\n\t\t\tif (!Render.isWebGL){\r\n\t\t\t\tvar chainScaleX=1;\r\n\t\t\t\tvar chainScaleY=1;\r\n\t\t\t\tvar tar;\r\n\t\t\t\ttar=sprite;\r\n\t\t\t\twhile (tar && tar !=Laya.stage){\r\n\t\t\t\t\tchainScaleX *=tar.scaleX;\r\n\t\t\t\t\tchainScaleY *=tar.scaleY;\r\n\t\t\t\t\ttar=tar.parent;\r\n\t\t\t\t}\r\n\t\t\t\tif (Render.isWebGL){\r\n\t\t\t\t\tif (chainScaleX < 1)scaleX *=chainScaleX;\r\n\t\t\t\t\tif (chainScaleY < 1)scaleY *=chainScaleY;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tif (chainScaleX > 1)scaleX *=chainScaleX;\r\n\t\t\t\t\tif (chainScaleY > 1)scaleY *=chainScaleY;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (sprite.scrollRect){\r\n\t\t\t\tvar scrollRect=sprite.scrollRect;\r\n\t\t\t\ttRec.x-=scrollRect.x;\r\n\t\t\t\ttRec.y-=scrollRect.y;\r\n\t\t\t}\r\n\t\t\tw=tRec.width *scaleX;\r\n\t\t\th=tRec.height *scaleY;\r\n\t\t\tleft=tRec.x;\r\n\t\t\ttop=tRec.y;\r\n\t\t\tif (Render.isWebGL && tCacheType==='bitmap' && (w > 2048 || h > 2048)){\r\n\t\t\t\tconsole.warn(\"cache bitmap size larger than 2048,cache ignored\");\r\n\t\t\t\tif (_cacheCanvas.ctx){\r\n\t\t\t\t\tPool.recover(\"RenderContext\",_cacheCanvas.ctx);\r\n\t\t\t\t\t_cacheCanvas.ctx.canvas.size(0,0);\r\n\t\t\t\t\t_cacheCanvas.ctx=null;\r\n\t\t\t\t}\r\n\t\t\t\t_next._fun.call(_next,sprite,context,x,y);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!tx){\r\n\t\t\t\ttx=_cacheCanvas.ctx=Pool.getItem(\"RenderContext\")|| new RenderContext(w,h,HTMLCanvas.create(/*laya.resource.HTMLCanvas.TYPEAUTO*/\"AUTO\"));\r\n\t\t\t}\r\n\t\t\ttx.ctx.sprite=sprite;\r\n\t\t\tcanvas=tx.canvas;\r\n\t\t\tcanvas.clear();\r\n\t\t\t(canvas.width !=w || canvas.height !=h)&& canvas.size(w,h);\r\n\t\t\tif (tCacheType==='bitmap')canvas.context.asBitmap=true;\r\n\t\t\telse if(tCacheType==='normal')canvas.context.asBitmap=false;\r\n\t\t\tvar t;\r\n\t\t\tif (scaleX !=1 || scaleY !=1){\r\n\t\t\t\tvar ctx=(tx).ctx;\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.scale(scaleX,scaleY);\r\n\t\t\t\tif (!Render.isConchWebGL && Render.isConchApp){\r\n\t\t\t\t\tt=sprite._$P.cf;\r\n\t\t\t\t\tt && ctx.setFilterMatrix && ctx.setFilterMatrix(t._mat,t._alpha);\r\n\t\t\t\t}\r\n\t\t\t\t_next._fun.call(_next,sprite,tx,-left,-top);\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tif (!Render.isConchApp || Render.isConchWebGL)sprite._applyFilters();\r\n\t\t\t\t}else {\r\n\t\t\t\tctx=(tx).ctx;\r\n\t\t\t\tif (!Render.isConchWebGL && Render.isConchApp){\r\n\t\t\t\t\tt=sprite._$P.cf;\r\n\t\t\t\t\tt && ctx.setFilterMatrix && ctx.setFilterMatrix(t._mat,t._alpha);\r\n\t\t\t\t}\r\n\t\t\t\t_next._fun.call(_next,sprite,tx,-left,-top);\r\n\t\t\t\tif (!Render.isConchApp || Render.isConchWebGL)sprite._applyFilters();\r\n\t\t\t}\r\n\t\t\tif (sprite._$P.staticCache)_cacheCanvas.reCache=false;\r\n\t\t\tStat.canvasReCache++;\r\n\t\t\t}else {\r\n\t\t\ttRec=_cacheCanvas._cacheRec;\r\n\t\t\tleft=tRec.x;\r\n\t\t\ttop=tRec.y;\r\n\t\t\tcanvas=tx.canvas;\r\n\t\t}\r\n\t\tcontext.drawCanvas(canvas,x+left,y+top,tRec.width,tRec.height);\r\n\t}\r\n\r\n\tRenderSprite.__init__=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tvar initRender;\r\n\t\tinitRender=RunDriver.createRenderSprite(0x11111,null);\r\n\t\tlen=RenderSprite.renders.length=0x800 *2;\r\n\t\tfor (i=0;i < len;i++)\r\n\t\tRenderSprite.renders[i]=initRender;\r\n\t\tRenderSprite.renders[0]=RunDriver.createRenderSprite(0,null);\r\n\t\tfunction _initSame (value,o){\r\n\t\t\tvar n=0;\r\n\t\t\tfor (var i=0;i < value.length;i++){\r\n\t\t\t\tn |=value[i];\r\n\t\t\t\tRenderSprite.renders[n]=o;\r\n\t\t\t}\r\n\t\t}\r\n\t\t_initSame([0x01,0x200,0x04,0x02],new RenderSprite(0x01,null));\r\n\t\tRenderSprite.renders[0x01 | 0x200]=RunDriver.createRenderSprite(0x01 | 0x200,null);\r\n\t\tRenderSprite.renders[0x01 | 0x04 | 0x200]=new RenderSprite(0x01 | 0x04 | 0x200,null);\r\n\t}\r\n\r\n\tRenderSprite._initRenderFun=function(sprite,context,x,y){\r\n\t\tvar type=sprite._renderType;\r\n\t\tvar r=RenderSprite.renders[type]=RenderSprite._getTypeRender(type);\r\n\t\tr._fun(sprite,context,x,y);\r\n\t}\r\n\r\n\tRenderSprite._getTypeRender=function(type){\r\n\t\tvar rst=null;\r\n\t\tvar tType=0x800;\r\n\t\twhile (tType > 1){\r\n\t\t\tif (tType & type)\r\n\t\t\t\trst=RunDriver.createRenderSprite(tType,rst);\r\n\t\t\ttType=tType >> 1;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tRenderSprite.IMAGE=0x01;\r\n\tRenderSprite.ALPHA=0x02;\r\n\tRenderSprite.TRANSFORM=0x04;\r\n\tRenderSprite.BLEND=0x08;\r\n\tRenderSprite.CANVAS=0x10;\r\n\tRenderSprite.FILTERS=0x20;\r\n\tRenderSprite.MASK=0x40;\r\n\tRenderSprite.CLIP=0x80;\r\n\tRenderSprite.STYLE=0x100;\r\n\tRenderSprite.GRAPHICS=0x200;\r\n\tRenderSprite.CUSTOM=0x400;\r\n\tRenderSprite.CHILDS=0x800;\r\n\tRenderSprite.INIT=0x11111;\r\n\tRenderSprite.renders=[];\r\n\t__static(RenderSprite,\r\n\t['NORENDER',function(){return this.NORENDER=new RenderSprite(0,null);}\r\n\t]);\r\n\treturn RenderSprite;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*Context扩展类\r\n*/\r\n//class laya.resource.Context\r\nvar Context=(function(){\r\n\tfunction Context(){\r\n\t\t/***@private */\r\n\t\t//this._canvas=null;\r\n\t\tthis._repaint=false;\r\n\t}\r\n\r\n\t__class(Context,'laya.resource.Context');\r\n\tvar __proto=Context.prototype;\r\n\t__proto.replaceReset=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=Context.replaceKeys.length;\r\n\t\tvar key;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=Context.replaceKeys[i];\r\n\t\t\tthis[Context.newKeys[i]]=this[key];\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.replaceResotre=function(){\r\n\t\t/*__JS__ */this.__restore();\r\n\t\t/*__JS__ */this.__reset();\r\n\t}\r\n\r\n\t__proto.setIsMainContext=function(){}\r\n\t__proto.drawTextures=function(tex,pos,tx,ty){\r\n\t\tStat.drawCall+=pos.length / 2;\r\n\t\tvar w=tex.width;\r\n\t\tvar h=tex.height;\r\n\t\tfor (var i=0,sz=pos.length;i < sz;i+=2){\r\n\t\t\tthis.drawTexture(tex,pos[i],pos[i+1],w,h,tx,ty);\r\n\t\t}\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.drawCanvas=function(canvas,x,y,width,height){\r\n\t\tStat.drawCall++;\r\n\t\tthis.drawImage(canvas.source,x,y,width,height);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillRect=function(x,y,width,height,style){\r\n\t\tStat.drawCall++;\r\n\t\tstyle && (this.fillStyle=style);\r\n\t\t/*__JS__ */this.__fillRect(x,y,width,height);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillText=function(text,x,y,font,color,textAlign){\r\n\t\tStat.drawCall++;\r\n\t\tif (arguments.length > 3 && font !=null){\r\n\t\t\tthis.font=font;\r\n\t\t\tthis.fillStyle=color;\r\n\t\t\t/*__JS__ */this.textAlign=textAlign;\r\n\t\t\tthis.textBaseline=\"top\";\r\n\t\t}\r\n\t\t/*__JS__ */this.__fillText(text,x,y);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){\r\n\t\tStat.drawCall++;\r\n\t\tthis.font=font;\r\n\t\tthis.fillStyle=fillColor;\r\n\t\tthis.textBaseline=\"top\";\r\n\t\t/*__JS__ */this.strokeStyle=borderColor;\r\n\t\t/*__JS__ */this.lineWidth=lineWidth;\r\n\t\t/*__JS__ */this.textAlign=textAlign;\r\n\t\t/*__JS__ */this.__strokeText(text,x,y);\r\n\t\t/*__JS__ */this.__fillText(text,x,y);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){\r\n\t\tStat.drawCall++;\r\n\t\tif (arguments.length > 3 && font !=null){\r\n\t\t\tthis.font=font;\r\n\t\t\t/*__JS__ */this.strokeStyle=color;\r\n\t\t\t/*__JS__ */this.lineWidth=lineWidth;\r\n\t\t\t/*__JS__ */this.textAlign=textAlign;\r\n\t\t\tthis.textBaseline=\"top\";\r\n\t\t}\r\n\t\t/*__JS__ */this.__strokeText(text,x,y);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.transformByMatrix=function(value){\r\n\t\tthis.transform(value.a,value.b,value.c,value.d,value.tx,value.ty);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.setTransformByMatrix=function(value){\r\n\t\tthis.setTransform(value.a,value.b,value.c,value.d,value.tx,value.ty);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.clipRect=function(x,y,width,height){\r\n\t\tStat.drawCall++;\r\n\t\tthis.beginPath();\r\n\t\tthis.rect(x,y,width,height);\r\n\t\tthis.clip();\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.drawTexture=function(tex,x,y,width,height,tx,ty){\r\n\t\tStat.drawCall++;\r\n\t\tvar uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;\r\n\t\tthis.drawImage(tex.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx,y+ty,width,height);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,tx,ty,alpha){\r\n\t\tStat.drawCall++;\r\n\t\tvar uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;\r\n\t\tthis.save();\r\n\t\talpha !=1 && (this.globalAlpha *=alpha);\r\n\t\tif (m){\r\n\t\t\tthis.transform(m.a,m.b,m.c,m.d,m.tx+tx,m.ty+ty);\r\n\t\t\tthis.drawImage(tex.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x ,y,width,height);\r\n\t\t\t}else {\r\n\t\t\tthis.drawImage(tex.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx ,y+ty,width,height);\r\n\t\t}\r\n\t\tthis.restore();\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.drawTexture2=function(x,y,pivotX,pivotY,m,alpha,blendMode,args2){\r\n\t\t'use strict';\r\n\t\tvar tex=args2[0];\r\n\t\tif (!(tex.loaded && tex.bitmap && tex.source)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tStat.drawCall++;\r\n\t\tvar alphaChanged=alpha!==1;\r\n\t\tif (alphaChanged){\r\n\t\t\tvar temp=this.globalAlpha;\r\n\t\t\tthis.globalAlpha *=alpha;\r\n\t\t};\r\n\t\tvar uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;\r\n\t\tif (m){\r\n\t\t\tthis.save();\r\n\t\t\tthis.transform(m.a,m.b,m.c,m.d,m.tx+x,m.ty+y);\r\n\t\t\tthis.drawImage(tex.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX ,args2[2]-pivotY,args2[3],args2[4]);\r\n\t\t\tthis.restore();\r\n\t\t\t}else {\r\n\t\t\tthis.drawImage(tex.source,uv[0] *w,uv[1] *h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX+x ,args2[2]-pivotY+y,args2[3],args2[4]);\r\n\t\t}\r\n\t\tif (alphaChanged)this.globalAlpha=temp;\r\n\t}\r\n\r\n\t__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){\r\n\t\tif (!other.pat){\r\n\t\t\tif (texture.uv !=Texture.DEF_UV){\r\n\t\t\t\tvar canvas=new HTMLCanvas(\"2D\");\r\n\t\t\t\tcanvas.getContext('2d');\r\n\t\t\t\tcanvas.size(texture.width,texture.height);\r\n\t\t\t\tcanvas.context.drawTexture(texture,0,0,texture.width,texture.height,0,0);\r\n\t\t\t\ttexture=new Texture(canvas);\r\n\t\t\t}\r\n\t\t\tother.pat=this.createPattern(texture.bitmap.source,type);\r\n\t\t};\r\n\t\tvar oX=x,oY=y;\r\n\t\tvar sX=0,sY=0;\r\n\t\tif (offset){\r\n\t\t\toX+=offset.x % texture.width;\r\n\t\t\toY+=offset.y % texture.height;\r\n\t\t\tsX-=offset.x % texture.width;\r\n\t\t\tsY-=offset.y % texture.height;\r\n\t\t}\r\n\t\tthis.translate(oX,oY);\r\n\t\tthis.fillRect(sX,sY,width,height,other.pat);\r\n\t\tthis.translate(-oX,-oY);\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.flush=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillWords=function(words,x,y,font,color,underLine){\r\n\t\tfont && (this.font=font);\r\n\t\tcolor && (this.fillStyle=color);\r\n\t\tvar _this=this;\r\n\t\tthis.textBaseline=\"top\";\r\n\t\t/*__JS__ */this.textAlign='left';\r\n\t\tfor (var i=0,n=words.length;i < n;i++){\r\n\t\t\tvar a=words[i];\r\n\t\t\t/*__JS__ */this.__fillText(a.char,a.x+x,a.y+y);\r\n\t\t\tif (underLine===1){\r\n\t\t\t\tvar tHeight=a.height;\r\n\t\t\t\tvar dX=a.style.letterSpacing*0.5;\r\n\t\t\t\tif (!dX)dX=0;\r\n\t\t\t\tthis.beginPath();\r\n\t\t\t\tthis.strokeStyle=color;\r\n\t\t\t\tthis.lineWidth=1;\r\n\t\t\t\tthis.moveTo(x+a.x-dX+0.5,y+a.y+tHeight+0.5);\r\n\t\t\t\tthis.lineTo(x+a.x+a.width+dX+0.5,y+a.y+tHeight+0.5);\r\n\t\t\t\tthis.stroke();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){\r\n\t\tfont && (this.font=font);\r\n\t\tcolor && (this.fillStyle=color);\r\n\t\tthis.textBaseline=\"top\";\r\n\t\t/*__JS__ */this.lineWidth=lineWidth;\r\n\t\t/*__JS__ */this.textAlign='left';\r\n\t\t/*__JS__ */this.strokeStyle=borderColor;\r\n\t\tfor (var i=0,n=words.length;i < n;i++){\r\n\t\t\tvar a=words[i];\r\n\t\t\t/*__JS__ */this.__strokeText(a.char,a.x+x,a.y+y);\r\n\t\t\t/*__JS__ */this.__fillText(a.char,a.x+x,a.y+y);\r\n\t\t}\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.destroy=function(){\r\n\t\t/*__JS__ */this.canvas.width=this.canvas.height=0;\r\n\t}\r\n\r\n\t/***@private */\r\n\t__proto.clear=function(){\r\n\t\tthis.clearRect(0,0,this._canvas.width,this._canvas.height);\r\n\t\tthis._repaint=false;\r\n\t}\r\n\r\n\t__proto.drawCurves=function(x,y,args){\r\n\t\tthis.beginPath();\r\n\t\tthis.strokeStyle=args[3];\r\n\t\tthis.lineWidth=args[4];\r\n\t\tvar points=args[2];\r\n\t\tx+=args[0],y+=args[1];\r\n\t\tthis.moveTo(x+points[0],y+points[1]);\r\n\t\tvar i=2,n=points.length;\r\n\t\twhile (i < n){\r\n\t\t\tthis.quadraticCurveTo(x+points[i++],y+points[i++],x+points[i++],y+points[i++]);\r\n\t\t}\r\n\t\tthis.stroke();\r\n\t}\r\n\r\n\tContext.__init__=function(to){\r\n\t\tif (Context._inited)return;\r\n\t\tContext._inited=true;\r\n\t\tvar from=laya.resource.Context.prototype;\r\n\t\tto=to || /*__JS__ */CanvasRenderingContext2D.prototype;\r\n\t\tto.__fillText=to.fillText;\r\n\t\tto.__fillRect=to.fillRect;\r\n\t\tto.__strokeText=to.strokeText;\r\n\t\tvar funs=['drawTextures','fillWords','fillBorderWords','setIsMainContext','fillRect','strokeText','fillTexture','fillText','transformByMatrix','setTransformByMatrix','clipRect','drawTexture','drawTexture2','drawTextureWithTransform','flush','clear','destroy','drawCanvas','fillBorderText','drawCurves'];\r\n\t\tfuns.forEach(function(i){\r\n\t\t\tto[i]=from[i];\r\n\t\t});\r\n\t}\r\n\r\n\tContext.replaceCanvasGetSet=function(tar,key){\r\n\t\tvar oldO=/*__JS__ */Object.getOwnPropertyDescriptor(tar,key);\r\n\t\tif (!oldO||!oldO.configurable)return false;\r\n\t\tvar newO={};\r\n\t\tvar tkey;\r\n\t\tfor (tkey in oldO){\r\n\t\t\tif (tkey !=\"set\"){\r\n\t\t\t\tnewO[tkey]=oldO[tkey];\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar preFun=oldO[\"set\"];\r\n\t\tnewO[\"set\"]=function (v){\r\n\t\t\tvar _self=/*__JS__ */this;\r\n\t\t\tpreFun.call(_self,v);\r\n\t\t\tvar _ct=_self.getContext(\"2d\");\r\n\t\t\tif (_ct && \"__reset\" in _ct){\r\n\t\t\t\t_ct.__reset();\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*__JS__ */Object.defineProperty(tar,key,newO);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tContext.replaceGetSet=function(tar,key){\r\n\t\tvar oldO=/*__JS__ */Object.getOwnPropertyDescriptor(tar,key);\r\n\t\tif (!oldO||!oldO.configurable)return false;\r\n\t\tvar newO={};\r\n\t\tvar tkey;\r\n\t\tfor (tkey in oldO){\r\n\t\t\tif (tkey !=\"set\"){\r\n\t\t\t\tnewO[tkey]=oldO[tkey];\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar preFun=oldO[\"set\"];\r\n\t\tvar dataKey=\"___\"+key+\"__\";\r\n\t\tContext.newKeys.push(dataKey);\r\n\t\tnewO[\"set\"]=function (v){\r\n\t\t\tvar _self=/*__JS__ */this;\r\n\t\t\tif (v !=_self[dataKey]){\r\n\t\t\t\t_self[dataKey]=v;\r\n\t\t\t\tpreFun.call(_self,v);\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*__JS__ */Object.defineProperty(tar,key,newO);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tContext.newKeys=[];\r\n\tContext._inited=false;\r\n\t__static(Context,\r\n\t['_default',function(){return this._default=new Context();},'replaceKeys',function(){return this.replaceKeys=[\"font\",\"fillStyle\",\"textBaseline\"];}\r\n\t]);\r\n\treturn Context;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>ResourceManager</code> 是资源管理类。它用于资源的载入、获取、销毁。\r\n*/\r\n//class laya.resource.ResourceManager\r\nvar ResourceManager=(function(){\r\n\tfunction ResourceManager(name){\r\n\t\t/**唯一标识ID。*/\r\n\t\tthis._id=0;\r\n\t\t/**名字。*/\r\n\t\tthis._name=null;\r\n\t\t/**所管理资源。*/\r\n\t\tthis._resources=null;\r\n\t\t/**所管理资源的累计内存,以字节为单位。*/\r\n\t\tthis._memorySize=0;\r\n\t\t/**垃圾回收比例，范围是0到1。*/\r\n\t\tthis._garbageCollectionRate=NaN;\r\n\t\t/**自动释放机制中内存是否溢出。*/\r\n\t\tthis._isOverflow=false;\r\n\t\t/**是否启用自动释放机制。*/\r\n\t\tthis.autoRelease=false;\r\n\t\t/**自动释放机制的内存触发上限,以字节为单位。*/\r\n\t\tthis.autoReleaseMaxSize=0;\r\n\t\tthis._id=++ResourceManager._uniqueIDCounter;\r\n\t\tthis._name=name ? name :\"Content Manager\";\r\n\t\tResourceManager._isResourceManagersSorted=false;\r\n\t\tthis._memorySize=0;\r\n\t\tthis._isOverflow=false;\r\n\t\tthis.autoRelease=false;\r\n\t\tthis.autoReleaseMaxSize=1024 *1024 *512;\r\n\t\tthis._garbageCollectionRate=0.2;\r\n\t\tResourceManager._resourceManagers.push(this);\r\n\t\tthis._resources=[];\r\n\t}\r\n\r\n\t__class(ResourceManager,'laya.resource.ResourceManager');\r\n\tvar __proto=ResourceManager.prototype;\r\n\tLaya.imps(__proto,{\"laya.resource.IDispose\":true})\r\n\t/**\r\n\t*获取指定索引的资源 Resource 对象。\r\n\t*@param 索引。\r\n\t*@return 资源 Resource 对象。\r\n\t*/\r\n\t__proto.getResourceByIndex=function(index){\r\n\t\treturn this._resources[index];\r\n\t}\r\n\r\n\t/**\r\n\t*获取此管理器所管理的资源个数。\r\n\t*@return 资源个数。\r\n\t*/\r\n\t__proto.getResourcesLength=function(){\r\n\t\treturn this._resources.length;\r\n\t}\r\n\r\n\t/**\r\n\t*添加指定资源。\r\n\t*@param resource 需要添加的资源 Resource 对象。\r\n\t*@return 是否添加成功。\r\n\t*/\r\n\t__proto.addResource=function(resource){\r\n\t\tif (resource.resourceManager)\r\n\t\t\tresource.resourceManager.removeResource(resource);\r\n\t\tvar index=this._resources.indexOf(resource);\r\n\t\tif (index===-1){\r\n\t\t\tresource._resourceManager=this;\r\n\t\t\tthis._resources.push(resource);\r\n\t\t\tthis.addSize(resource.memorySize);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*移除指定资源。\r\n\t*@param resource 需要移除的资源 Resource 对象\r\n\t*@return 是否移除成功。\r\n\t*/\r\n\t__proto.removeResource=function(resource){\r\n\t\tvar index=this._resources.indexOf(resource);\r\n\t\tif (index!==-1){\r\n\t\t\tthis._resources.splice(index,1);\r\n\t\t\tresource._resourceManager=null;\r\n\t\t\tthis._memorySize-=resource.memorySize;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*卸载此资源管理器载入的资源。\r\n\t*/\r\n\t__proto.unload=function(){\r\n\t\tvar tempResources=this._resources.slice(0,this._resources.length);\r\n\t\tfor (var i=0;i < tempResources.length;i++){\r\n\t\t\tvar resource=tempResources[i];\r\n\t\t\tresource.destroy();\r\n\t\t}\r\n\t\ttempResources.length=0;\r\n\t}\r\n\r\n\t/**释放资源。*/\r\n\t__proto.dispose=function(){\r\n\t\tif (this===ResourceManager._systemResourceManager)\r\n\t\t\tthrow new Error(\"systemResourceManager不能被释放！\");\r\n\t\tResourceManager._resourceManagers.splice(ResourceManager._resourceManagers.indexOf(this),1);\r\n\t\tResourceManager._isResourceManagersSorted=false;\r\n\t\tvar tempResources=this._resources.slice(0,this._resources.length);\r\n\t\tfor (var i=0;i < tempResources.length;i++){\r\n\t\t\tvar resource=tempResources[i];\r\n\t\t\tresource.resourceManager.removeResource(resource);\r\n\t\t\tresource.destroy();\r\n\t\t}\r\n\t\ttempResources.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*增加内存。\r\n\t*@param add 需要增加的内存大小。\r\n\t*/\r\n\t__proto.addSize=function(add){\r\n\t\tif (add){\r\n\t\t\tif (this.autoRelease && add > 0)\r\n\t\t\t\t((this._memorySize+add)> this.autoReleaseMaxSize)&& (this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize));\r\n\t\t\tthis._memorySize+=add;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*垃圾回收。\r\n\t*@param reserveSize 保留尺寸。\r\n\t*/\r\n\t__proto.garbageCollection=function(reserveSize){\r\n\t\tvar all=this._resources;\r\n\t\tall=all.slice();\r\n\t\tall.sort(function(a,b){\r\n\t\t\tif (!a || !b)\r\n\t\t\t\tthrow new Error(\"a或b不能为空！\");\r\n\t\t\tif (a.released && b.released)\r\n\t\t\t\treturn 0;\r\n\t\t\telse if (a.released)\r\n\t\t\treturn 1;\r\n\t\t\telse if (b.released)\r\n\t\t\treturn-1;\r\n\t\t\treturn a._lastUseFrameCount-b._lastUseFrameCount;\r\n\t\t});\r\n\t\tvar currentFrameCount=Stat.loopCount;\r\n\t\tfor (var i=0,n=all.length;i < n;i++){\r\n\t\t\tvar resou=all[i];\r\n\t\t\tif (currentFrameCount-resou._lastUseFrameCount > 1){\r\n\t\t\t\tresou.releaseResource();\r\n\t\t\t\t}else {\r\n\t\t\t\tif (this._memorySize >=reserveSize)\r\n\t\t\t\t\tthis._isOverflow=true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this._memorySize < reserveSize){\r\n\t\t\t\tthis._isOverflow=false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*唯一标识 ID 。\r\n\t*/\r\n\t__getset(0,__proto,'id',function(){\r\n\t\treturn this._id;\r\n\t});\r\n\r\n\t/**\r\n\t*名字。\r\n\t*/\r\n\t__getset(0,__proto,'name',function(){\r\n\t\treturn this._name;\r\n\t\t},function(value){\r\n\t\tif ((value || value!==\"\")&& this._name!==value){\r\n\t\t\tthis._name=value;\r\n\t\t\tResourceManager._isResourceManagersSorted=false;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*此管理器所管理资源的累计内存，以字节为单位。\r\n\t*/\r\n\t__getset(0,__proto,'memorySize',function(){\r\n\t\treturn this._memorySize;\r\n\t});\r\n\r\n\t/**\r\n\t*系统资源管理器。\r\n\t*/\r\n\t__getset(1,ResourceManager,'systemResourceManager',function(){\r\n\t\treturn ResourceManager._systemResourceManager;\r\n\t});\r\n\r\n\tResourceManager.__init__=function(){\r\n\t\tResourceManager.currentResourceManager=ResourceManager.systemResourceManager;\r\n\t}\r\n\r\n\tResourceManager.getLoadedResourceManagerByIndex=function(index){\r\n\t\treturn ResourceManager._resourceManagers[index];\r\n\t}\r\n\r\n\tResourceManager.getLoadedResourceManagersCount=function(){\r\n\t\treturn ResourceManager._resourceManagers.length;\r\n\t}\r\n\r\n\tResourceManager.recreateContentManagers=function(force){\r\n\t\t(force===void 0)&& (force=false);\r\n\t\tvar temp=ResourceManager.currentResourceManager;\r\n\t\tfor (var i=0;i < ResourceManager._resourceManagers.length;i++){\r\n\t\t\tResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];\r\n\t\t\tfor (var j=0;j < ResourceManager.currentResourceManager._resources.length;j++){\r\n\t\t\t\tResourceManager.currentResourceManager._resources[j].releaseResource(force);\r\n\t\t\t\tResourceManager.currentResourceManager._resources[j].activeResource(force);\r\n\t\t\t}\r\n\t\t}\r\n\t\tResourceManager.currentResourceManager=temp;\r\n\t}\r\n\r\n\tResourceManager.releaseContentManagers=function(force){\r\n\t\t(force===void 0)&& (force=false);\r\n\t\tvar temp=ResourceManager.currentResourceManager;\r\n\t\tfor (var i=0;i < ResourceManager._resourceManagers.length;i++){\r\n\t\t\tResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];\r\n\t\t\tfor (var j=0;j < ResourceManager.currentResourceManager._resources.length;j++){\r\n\t\t\t\tvar resource=ResourceManager.currentResourceManager._resources[j];\r\n\t\t\t\t(!resource.released)&& (resource.releaseResource(force));\r\n\t\t\t}\r\n\t\t}\r\n\t\tResourceManager.currentResourceManager=temp;\r\n\t}\r\n\r\n\tResourceManager._uniqueIDCounter=0;\r\n\tResourceManager._isResourceManagersSorted=false;\r\n\tResourceManager._resourceManagers=[];\r\n\t__static(ResourceManager,\r\n\t['_systemResourceManager',function(){return this._systemResourceManager=new ResourceManager(\"System Resource Manager\");},'currentResourceManager',function(){return this.currentResourceManager=ResourceManager._systemResourceManager;}\r\n\t]);\r\n\treturn ResourceManager;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.system.System\r\nvar System=(function(){\r\n\tfunction System(){}\r\n\t__class(System,'laya.system.System');\r\n\tSystem.changeDefinition=function(name,classObj){\r\n\t\tLaya[name]=classObj;\r\n\t\tvar str=name+\"=classObj\";\r\n\t\t/*__JS__ */eval(str);\r\n\t}\r\n\r\n\tSystem.__init__=function(){\r\n\t\tif (Render.isConchApp){\r\n\t\t\t/*__JS__ */conch.disableConchResManager();\r\n\t\t\t/*__JS__ */conch.disableConchAutoRestoreLostedDevice();\r\n\t\t}\r\n\t}\r\n\r\n\treturn System;\r\n})()\r\n\r\n\r\nSoundManager;\r\n/**\r\n*<code>Browser</code> 是浏览器代理类。封装浏览器及原生 js 提供的一些功能。\r\n*/\r\n//class laya.utils.Browser\r\nvar Browser=(function(){\r\n\tfunction Browser(){}\r\n\t__class(Browser,'laya.utils.Browser');\r\n\t/**设备像素比。*/\r\n\t__getset(1,Browser,'pixelRatio',function(){\r\n\t\tBrowser.__init__();\r\n\t\tif (Browser.userAgent.indexOf(\"Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)\")>-1)return 2;\r\n\t\treturn RunDriver.getPixelRatio();\r\n\t});\r\n\r\n\t/**浏览器窗口物理高度，其值等于clientHeight *pixelRatio，并且浏览器发生反转之后，宽高会互换。*/\r\n\t__getset(1,Browser,'height',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn ((Laya.stage && Laya.stage.canvasRotation)? Browser.clientWidth :Browser.clientHeight)*Browser.pixelRatio;\r\n\t});\r\n\r\n\t/**\r\n\t*浏览器窗口可视宽度。\r\n\t*通过分析浏览器信息获得。浏览器多个属性值优先级为：window.innerWidth(包含滚动条宽度)> document.body.clientWidth(不包含滚动条宽度)，如果前者为0或为空，则选择后者。\r\n\t*/\r\n\t__getset(1,Browser,'clientWidth',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser.window.innerWidth || Browser.document.body.clientWidth;\r\n\t});\r\n\r\n\t/**浏览器原生 window 对象的引用。*/\r\n\t__getset(1,Browser,'window',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser._window;\r\n\t});\r\n\r\n\t/**\r\n\t*浏览器窗口可视高度。\r\n\t*通过分析浏览器信息获得。浏览器多个属性值优先级为：window.innerHeight(包含滚动条高度)> document.body.clientHeight(不包含滚动条高度)> document.documentElement.clientHeight(不包含滚动条高度)，如果前者为0或为空，则选择后者。\r\n\t*/\r\n\t__getset(1,Browser,'clientHeight',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser.window.innerHeight || Browser.document.body.clientHeight || Browser.document.documentElement.clientHeight;\r\n\t});\r\n\r\n\t/**浏览器窗口物理宽度，其值等于clientWidth *pixelRatio，并且浏览器发生反转之后，宽高会互换。*/\r\n\t__getset(1,Browser,'width',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn ((Laya.stage && Laya.stage.canvasRotation)? Browser.clientHeight :Browser.clientWidth)*Browser.pixelRatio;\r\n\t});\r\n\r\n\t/**画布容器，用来盛放画布的容器。方便对画布进行控制*/\r\n\t__getset(1,Browser,'container',function(){\r\n\t\tBrowser.__init__();\r\n\t\tif (!Browser._container){\r\n\t\t\tBrowser._container=Browser.createElement(\"div\");\r\n\t\t\tBrowser._container.id=\"layaContainer\";\r\n\t\t\tBrowser.document.body.appendChild(Browser._container);\r\n\t\t}\r\n\t\treturn Browser._container;\r\n\t\t},function(value){\r\n\t\tBrowser._container=value;\r\n\t});\r\n\r\n\t/**浏览器原生 document 对象的引用。*/\r\n\t__getset(1,Browser,'document',function(){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser._document;\r\n\t});\r\n\r\n\tBrowser.__init__=function(){\r\n\t\tSoundManager;\r\n\t\tif (Browser._window)return;\r\n\t\tBrowser._window=RunDriver.getWindow();\r\n\t\tBrowser._document=Browser.window.document;\r\n\t\tBrowser._window.addEventListener('message',function(e){\r\n\t\t\tlaya.utils.Browser._onMessage(e);\r\n\t\t},false);\r\n\t\t/*__JS__ */Browser.document.__createElement=Browser.document.createElement;\r\n\t\t/*__JS__ */window.requestAnimationFrame=window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (c){return window.setTimeout(c,1000 / 60);};;\r\n\t\tBrowser.userAgent=Browser.window.navigator.userAgent;\r\n\t\tBrowser.u=Browser.userAgent;\r\n\t\tBrowser.onIOS=!!Browser.u.match(/\\(i[^;]+;(U;)? CPU.+Mac OS X/);\r\n\t\tBrowser.onMobile=Browser.u.indexOf(\"Mobile\")>-1;\r\n\t\tBrowser.onIPhone=Browser.u.indexOf(\"iPhone\")>-1;\r\n\t\tBrowser.onMac=Browser.u.indexOf(\"Mac OS X\")>-1;\r\n\t\tBrowser.onIPad=Browser.u.indexOf(\"iPad\")>-1;\r\n\t\tBrowser.onAndriod=Browser.u.indexOf('Android')>-1 || Browser.u.indexOf('Adr')>-1;\r\n\t\tBrowser.onWP=Browser.u.indexOf(\"Windows Phone\")>-1;\r\n\t\tBrowser.onQQBrowser=Browser.u.indexOf(\"QQBrowser\")>-1;\r\n\t\tBrowser.onMQQBrowser=Browser.u.indexOf(\"MQQBrowser\")>-1 || (Browser.u.indexOf(\"Mobile\")>-1 && Browser.u.indexOf(\"QQ\")>-1);\r\n\t\tBrowser.onIE=!!Browser.window.ActiveXObject || \"ActiveXObject\" in Browser.window;\r\n\t\tBrowser.onWeiXin=Browser.u.indexOf('MicroMessenger')>-1;\r\n\t\tBrowser.onPC=!Browser.onMobile;\r\n\t\tBrowser.onSafari=!!Browser.u.match(/Version\\/\\d+\\.\\d\\x20Mobile\\/\\S+\\x20Safari/);\r\n\t\tBrowser.onFirefox=Browser.u.indexOf('Firefox')>-1;\r\n\t\tBrowser.onEdge=Browser.u.indexOf('Edge')>-1;\r\n\t\tBrowser.onMiniGame=Browser.u.indexOf('MiniGame')>-1;\r\n\t\tBrowser.httpProtocol=Browser.window.location.protocol==\"http:\";\r\n\t\tif (Browser.onMiniGame && Browser.window.focus==null){\r\n\t\t\tconsole.error(\"请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0\");\r\n\t\t}\r\n\t\tBrowser.webAudioEnabled=Browser.window[\"AudioContext\"] || Browser.window[\"webkitAudioContext\"] || Browser.window[\"mozAudioContext\"] ? true :false;\r\n\t\tBrowser.soundType=Browser.webAudioEnabled ? \"WEBAUDIOSOUND\" :\"AUDIOSOUND\";\r\n\t\t/*__JS__ */Sound=Browser.webAudioEnabled?WebAudioSound:AudioSound;;\r\n\t\t/*__JS__ */if (Browser.webAudioEnabled)WebAudioSound.initWebAudio();;\r\n\t\tAudioSound._initMusicAudio();\r\n\t\t/*__JS__ */Browser.enableTouch=(('ontouchstart' in window)|| window.DocumentTouch && document instanceof DocumentTouch);\r\n\t\t/*__JS__ */window.focus();\r\n\t\t/*__JS__ */SoundManager._soundClass=Sound;;\r\n\t\tRender._mainCanvas=Render._mainCanvas || HTMLCanvas.create('2D');\r\n\t\tif (Browser.canvas)return;\r\n\t\tBrowser.canvas=HTMLCanvas.create('2D');\r\n\t\tBrowser.context=Browser.canvas.getContext('2d');\r\n\t}\r\n\r\n\tBrowser._onMessage=function(e){\r\n\t\tif (!e.data)return;\r\n\t\tif (e.data.name==\"size\"){\r\n\t\t\tBrowser.window.innerWidth=e.data.width;\r\n\t\t\tBrowser.window.innerHeight=e.data.height;\r\n\t\t\tBrowser.window.__innerHeight=e.data.clientHeight;\r\n\t\t\tif (!Browser.document.createEvent){\r\n\t\t\t\tconsole.warn(\"no document.createEvent\");\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t\tvar evt=Browser.document.createEvent(\"HTMLEvents\");\r\n\t\t\tevt.initEvent(\"resize\",false,false);\r\n\t\t\tBrowser.window.dispatchEvent(evt);\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tBrowser.createElement=function(type){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser.document.__createElement(type);\r\n\t}\r\n\r\n\tBrowser.getElementById=function(type){\r\n\t\tBrowser.__init__();\r\n\t\treturn Browser.document.getElementById(type);\r\n\t}\r\n\r\n\tBrowser.removeElement=function(ele){\r\n\t\tif (ele && ele.parentNode)ele.parentNode.removeChild(ele);\r\n\t}\r\n\r\n\tBrowser.now=function(){\r\n\t\treturn RunDriver.now();\r\n\t}\r\n\r\n\tBrowser._window=null;\r\n\tBrowser._document=null;\r\n\tBrowser._container=null;\r\n\tBrowser.userAgent=null;\r\n\tBrowser.u=null;\r\n\tBrowser.onIOS=false;\r\n\tBrowser.onMac=false;\r\n\tBrowser.onMobile=false;\r\n\tBrowser.onIPhone=false;\r\n\tBrowser.onIPad=false;\r\n\tBrowser.onAndriod=false;\r\n\tBrowser.onAndroid=false;\r\n\tBrowser.onWP=false;\r\n\tBrowser.onQQBrowser=false;\r\n\tBrowser.onMQQBrowser=false;\r\n\tBrowser.onSafari=false;\r\n\tBrowser.onFirefox=false;\r\n\tBrowser.onEdge=false;\r\n\tBrowser.onIE=false;\r\n\tBrowser.onWeiXin=false;\r\n\tBrowser.onMiniGame=false;\r\n\tBrowser.onPC=false;\r\n\tBrowser.httpProtocol=false;\r\n\tBrowser.webAudioEnabled=false;\r\n\tBrowser.soundType=null;\r\n\tBrowser.enableTouch=false;\r\n\tBrowser.canvas=null;\r\n\tBrowser.context=null;\r\n\tBrowser.__init$=function(){\r\n\t\tAudioSound;\r\n\t\tWebAudioSound;\r\n\t}\r\n\r\n\treturn Browser;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>Byte</code> 类提供用于优化读取、写入以及处理二进制数据的方法和属性。</p>\r\n*<p><b>注意：</b> <code>Byte</code> 类适用于需要在字节层访问数据的高级开发人员。</p>\r\n*/\r\n//class laya.utils.Byte\r\nvar Byte=(function(){\r\n\tfunction Byte(data){\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*是否为小端数据。\r\n\t\t*/\r\n\t\tthis._xd_=true;\r\n\t\tthis._allocated_=8;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*原始数据。\r\n\t\t*/\r\n\t\t//this._d_=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*DataView\r\n\t\t*/\r\n\t\t//this._u8d_=null;\r\n\t\t/**@private */\r\n\t\tthis._pos_=0;\r\n\t\t/**@private */\r\n\t\tthis._length=0;\r\n\t\tif (data){\r\n\t\t\tthis._u8d_=new Uint8Array(data);\r\n\t\t\tthis._d_=new DataView(this._u8d_.buffer);\r\n\t\t\tthis._length=this._d_.byteLength;\r\n\t\t\t}else {\r\n\t\t\tthis.___resizeBuffer(this._allocated_);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(Byte,'laya.utils.Byte');\r\n\tvar __proto=Byte.prototype;\r\n\t/**@private */\r\n\t__proto.___resizeBuffer=function(len){\r\n\t\ttry {\r\n\t\t\tvar newByteView=new Uint8Array(len);\r\n\t\t\tif (this._u8d_ !=null){\r\n\t\t\t\tif (this._u8d_.length <=len)newByteView.set(this._u8d_);\r\n\t\t\t\telse newByteView.set(this._u8d_.subarray(0,len));\r\n\t\t\t}\r\n\t\t\tthis._u8d_=newByteView;\r\n\t\t\tthis._d_=new DataView(newByteView.buffer);\r\n\t\t\t}catch (err){\r\n\t\t\tthrow \"___resizeBuffer err:\"+len;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>常用于解析固定格式的字节流。</p>\r\n\t*<p>先从字节流的当前字节偏移位置处读取一个 <code>Uint16</code> 值，然后以此值为长度，读取此长度的字符串。</p>\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.getString=function(){\r\n\t\treturn this.rUTF(this.getUint16());\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流中 <code>start</code> 参数指定的位置开始，读取 <code>len</code> 参数指定的字节数的数据，用于创建一个 <code>Float32Array</code> 对象并返回此对象。\r\n\t*@param start 开始位置。\r\n\t*@param len 需要读取的字节长度。如果要读取的长度超过可读取范围，则只返回可读范围内的值。\r\n\t*@return 读取的 Float32Array 对象。\r\n\t*/\r\n\t__proto.getFloat32Array=function(start,len){\r\n\t\tvar end=start+len;\r\n\t\tend=(end > this._length)? this._length :end;\r\n\t\tvar v=new Float32Array(this._d_.buffer.slice(start,end));\r\n\t\tthis._pos_=end;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流中 <code>start</code> 参数指定的位置开始，读取 <code>len</code> 参数指定的字节数的数据，用于创建一个 <code>Uint8Array</code> 对象并返回此对象。\r\n\t*@param start 开始位置。\r\n\t*@param len 需要读取的字节长度。如果要读取的长度超过可读取范围，则只返回可读范围内的值。\r\n\t*@return 读取的 Uint8Array 对象。\r\n\t*/\r\n\t__proto.getUint8Array=function(start,len){\r\n\t\tvar end=start+len;\r\n\t\tend=(end > this._length)? this._length :end;\r\n\t\tvar v=new Uint8Array(this._d_.buffer.slice(start,end));\r\n\t\tthis._pos_=end;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流中 <code>start</code> 参数指定的位置开始，读取 <code>len</code> 参数指定的字节数的数据，用于创建一个 <code>Int16Array</code> 对象并返回此对象。\r\n\t*@param start 开始读取的字节偏移量位置。\r\n\t*@param len 需要读取的字节长度。如果要读取的长度超过可读取范围，则只返回可读范围内的值。\r\n\t*@return 读取的 Uint8Array 对象。\r\n\t*/\r\n\t__proto.getInt16Array=function(start,len){\r\n\t\tvar end=start+len;\r\n\t\tend=(end > this._length)? this._length :end;\r\n\t\tvar v=new Int16Array(this._d_.buffer.slice(start,end));\r\n\t\tthis._pos_=end;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移位置处读取一个 IEEE 754 单精度（32 位）浮点数。\r\n\t*@return 单精度（32 位）浮点数。\r\n\t*/\r\n\t__proto.getFloat32=function(){\r\n\t\tif (this._pos_+4 > this._length)throw \"getFloat32 error - Out of bounds\";\r\n\t\tvar v=this._d_.getFloat32(this._pos_,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 IEEE 754 双精度（64 位）浮点数。\r\n\t*@return 双精度（64 位）浮点数。\r\n\t*/\r\n\t__proto.getFloat64=function(){\r\n\t\tif (this._pos_+8 > this._length)throw \"getFloat64 error - Out of bounds\";\r\n\t\tvar v=this._d_.getFloat64(this._pos_,this._xd_);\r\n\t\tthis._pos_+=8;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入一个 IEEE 754 单精度（32 位）浮点数。\r\n\t*@param value 单精度（32 位）浮点数。\r\n\t*/\r\n\t__proto.writeFloat32=function(value){\r\n\t\tthis.ensureWrite(this._pos_+4);\r\n\t\tthis._d_.setFloat32(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入一个 IEEE 754 双精度（64 位）浮点数。\r\n\t*@param value 双精度（64 位）浮点数。\r\n\t*/\r\n\t__proto.writeFloat64=function(value){\r\n\t\tthis.ensureWrite(this._pos_+8);\r\n\t\tthis._d_.setFloat64(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=8;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 Int32 值。\r\n\t*@return Int32 值。\r\n\t*/\r\n\t__proto.getInt32=function(){\r\n\t\tif (this._pos_+4 > this._length)throw \"getInt32 error - Out of bounds\";\r\n\t\tvar float=this._d_.getInt32(this._pos_,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t\treturn float;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 Uint32 值。\r\n\t*@return Uint32 值。\r\n\t*/\r\n\t__proto.getUint32=function(){\r\n\t\tif (this._pos_+4 > this._length)throw \"getUint32 error - Out of bounds\";\r\n\t\tvar v=this._d_.getUint32(this._pos_,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入指定的 Int32 值。\r\n\t*@param value 需要写入的 Int32 值。\r\n\t*/\r\n\t__proto.writeInt32=function(value){\r\n\t\tthis.ensureWrite(this._pos_+4);\r\n\t\tthis._d_.setInt32(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入 Uint32 值。\r\n\t*@param value 需要写入的 Uint32 值。\r\n\t*/\r\n\t__proto.writeUint32=function(value){\r\n\t\tthis.ensureWrite(this._pos_+4);\r\n\t\tthis._d_.setUint32(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=4;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 Int16 值。\r\n\t*@return Int16 值。\r\n\t*/\r\n\t__proto.getInt16=function(){\r\n\t\tif (this._pos_+2 > this._length)throw \"getInt16 error - Out of bounds\";\r\n\t\tvar us=this._d_.getInt16(this._pos_,this._xd_);\r\n\t\tthis._pos_+=2;\r\n\t\treturn us;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 Uint16 值。\r\n\t*@return Uint16 值。\r\n\t*/\r\n\t__proto.getUint16=function(){\r\n\t\tif (this._pos_+2 > this._length)throw \"getUint16 error - Out of bounds\";\r\n\t\tvar us=this._d_.getUint16(this._pos_,this._xd_);\r\n\t\tthis._pos_+=2;\r\n\t\treturn us;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入指定的 Uint16 值。\r\n\t*@param value 需要写入的Uint16 值。\r\n\t*/\r\n\t__proto.writeUint16=function(value){\r\n\t\tthis.ensureWrite(this._pos_+2);\r\n\t\tthis._d_.setUint16(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=2;\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入指定的 Int16 值。\r\n\t*@param value 需要写入的 Int16 值。\r\n\t*/\r\n\t__proto.writeInt16=function(value){\r\n\t\tthis.ensureWrite(this._pos_+2);\r\n\t\tthis._d_.setInt16(this._pos_,value,this._xd_);\r\n\t\tthis._pos_+=2;\r\n\t}\r\n\r\n\t/**\r\n\t*从字节流的当前字节偏移量位置处读取一个 Uint8 值。\r\n\t*@return Uint8 值。\r\n\t*/\r\n\t__proto.getUint8=function(){\r\n\t\tif (this._pos_+1 > this._length)throw \"getUint8 error - Out of bounds\";\r\n\t\treturn this._d_.getUint8(this._pos_++);\r\n\t}\r\n\r\n\t/**\r\n\t*在字节流的当前字节偏移量位置处写入指定的 Uint8 值。\r\n\t*@param value 需要写入的 Uint8 值。\r\n\t*/\r\n\t__proto.writeUint8=function(value){\r\n\t\tthis.ensureWrite(this._pos_+1);\r\n\t\tthis._d_.setUint8(this._pos_,value);\r\n\t\tthis._pos_++;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*从字节流的指定字节偏移量位置处读取一个 Uint8 值。\r\n\t*@param pos 字节读取位置。\r\n\t*@return Uint8 值。\r\n\t*/\r\n\t__proto._getUInt8=function(pos){\r\n\t\treturn this._d_.getUint8(pos);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*从字节流的指定字节偏移量位置处读取一个 Uint16 值。\r\n\t*@param pos 字节读取位置。\r\n\t*@return Uint16 值。\r\n\t*/\r\n\t__proto._getUint16=function(pos){\r\n\t\treturn this._d_.getUint16(pos,this._xd_);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*使用 getFloat32()读取6个值，用于创建并返回一个 Matrix 对象。\r\n\t*@return Matrix 对象。\r\n\t*/\r\n\t__proto._getMatrix=function(){\r\n\t\tvar rst=new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*读取指定长度的 UTF 型字符串。\r\n\t*@param len 需要读取的长度。\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.rUTF=function(len){\r\n\t\tvar v=\"\",max=this._pos_+len,c=0,c2=0,c3=0,f=String.fromCharCode;\r\n\t\tvar u=this._u8d_,i=0;\r\n\t\twhile (this._pos_ < max){\r\n\t\t\tc=u[this._pos_++];\r\n\t\t\tif (c < 0x80){\r\n\t\t\t\tif (c !=0){\r\n\t\t\t\t\tv+=f(c);\r\n\t\t\t\t}\r\n\t\t\t\t}else if (c < 0xE0){\r\n\t\t\t\tv+=f(((c & 0x3F)<< 6)| (u[this._pos_++] & 0x7F));\r\n\t\t\t\t}else if (c < 0xF0){\r\n\t\t\t\tc2=u[this._pos_++];\r\n\t\t\t\tv+=f(((c & 0x1F)<< 12)| ((c2 & 0x7F)<< 6)| (u[this._pos_++] & 0x7F));\r\n\t\t\t\t}else {\r\n\t\t\t\tc2=u[this._pos_++];\r\n\t\t\t\tc3=u[this._pos_++];\r\n\t\t\t\tv+=f(((c & 0x0F)<< 18)| ((c2 & 0x7F)<< 12)| ((c3 << 6)& 0x7F)| (u[this._pos_++] & 0x7F));\r\n\t\t\t}\r\n\t\t\ti++;\r\n\t\t}\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*读取 <code>len</code> 参数指定的长度的字符串。\r\n\t*@param len 要读取的字符串的长度。\r\n\t*@return 指定长度的字符串。\r\n\t*/\r\n\t__proto.getCustomString=function(len){\r\n\t\tvar v=\"\",ulen=0,c=0,c2=0,f=String.fromCharCode;\r\n\t\tvar u=this._u8d_,i=0;\r\n\t\twhile (len > 0){\r\n\t\t\tc=u[this._pos_];\r\n\t\t\tif (c < 0x80){\r\n\t\t\t\tv+=f(c);\r\n\t\t\t\tthis._pos_++;\r\n\t\t\t\tlen--;\r\n\t\t\t\t}else {\r\n\t\t\t\tulen=c-0x80;\r\n\t\t\t\tthis._pos_++;\r\n\t\t\t\tlen-=ulen;\r\n\t\t\t\twhile (ulen > 0){\r\n\t\t\t\t\tc=u[this._pos_++];\r\n\t\t\t\t\tc2=u[this._pos_++];\r\n\t\t\t\t\tv+=f((c2 << 8)| c);\r\n\t\t\t\t\tulen--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn v;\r\n\t}\r\n\r\n\t/**\r\n\t*清除字节数组的内容，并将 length 和 pos 属性重置为 0。调用此方法将释放 Byte 实例占用的内存。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis._pos_=0;\r\n\t\tthis.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取此对象的 ArrayBuffer 引用。\r\n\t*@return\r\n\t*/\r\n\t__proto.__getBuffer=function(){\r\n\t\treturn this._d_.buffer;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>将 UTF-8 字符串写入字节流。类似于 writeUTF()方法，但 writeUTFBytes()不使用 16 位长度的字为字符串添加前缀。</p>\r\n\t*<p>对应的读取方法为： getUTFBytes 。</p>\r\n\t*@param value 要写入的字符串。\r\n\t*/\r\n\t__proto.writeUTFBytes=function(value){\r\n\t\tvalue=value+\"\";\r\n\t\tfor (var i=0,sz=value.length;i < sz;i++){\r\n\t\t\tvar c=value.charCodeAt(i);\r\n\t\t\tif (c <=0x7F){\r\n\t\t\t\tthis.writeByte(c);\r\n\t\t\t\t}else if (c <=0x7FF){\r\n\t\t\t\tthis.ensureWrite(this._pos_+2);\r\n\t\t\t\tthis._u8d_.set([0xC0 | (c >> 6),0x80 | (c & 0x3F)],this._pos_);\r\n\t\t\t\tthis._pos_+=2;\r\n\t\t\t\t}else if (c <=0xFFFF){\r\n\t\t\t\tthis.ensureWrite(this._pos_+3);\r\n\t\t\t\tthis._u8d_.set([0xE0 | (c >> 12),0x80 | ((c >> 6)& 0x3F),0x80 | (c & 0x3F)],this._pos_);\r\n\t\t\t\tthis._pos_+=3;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.ensureWrite(this._pos_+4);\r\n\t\t\t\tthis._u8d_.set([0xF0 | (c >> 18),0x80 | ((c >> 12)& 0x3F),0x80 | ((c >> 6)& 0x3F),0x80 | (c & 0x3F)],this._pos_);\r\n\t\t\t\tthis._pos_+=4;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>将 UTF-8 字符串写入字节流。先写入以字节表示的 UTF-8 字符串长度（作为 16 位整数），然后写入表示字符串字符的字节。</p>\r\n\t*<p>对应的读取方法为： getUTFString 。</p>\r\n\t*@param value 要写入的字符串值。\r\n\t*/\r\n\t__proto.writeUTFString=function(value){\r\n\t\tvar tPos=this.pos;\r\n\t\tthis.writeUint16(1);\r\n\t\tthis.writeUTFBytes(value);\r\n\t\tvar dPos=this.pos-tPos-2;\r\n\t\tif (dPos >=65536){\r\n\t\t\tthrow \"writeUTFString byte len more than 65536\";\r\n\t\t}\r\n\t\tthis._d_.setUint16(tPos,dPos,this._xd_);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*读取 UTF-8 字符串。\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.readUTFString=function(){\r\n\t\treturn this.readUTFBytes(this.getUint16());\r\n\t}\r\n\r\n\t/**\r\n\t*<p>从字节流中读取一个 UTF-8 字符串。假定字符串的前缀是一个无符号的短整型（以此字节表示要读取的长度）。</p>\r\n\t*<p>对应的写入方法为： writeUTFString 。</p>\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.getUTFString=function(){\r\n\t\treturn this.readUTFString();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*读字符串，必须是 writeUTFBytes 方法写入的字符串。\r\n\t*@param len 要读的buffer长度，默认将读取缓冲区全部数据。\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.readUTFBytes=function(len){\r\n\t\t(len===void 0)&& (len=-1);\r\n\t\tif (len==0)return \"\";\r\n\t\tvar lastBytes=this.bytesAvailable;\r\n\t\tif (len > lastBytes)throw \"readUTFBytes error - Out of bounds\";\r\n\t\tlen=len > 0 ? len :lastBytes;\r\n\t\treturn this.rUTF(len);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>从字节流中读取一个由 length 参数指定的长度的 UTF-8 字节序列，并返回一个字符串。</p>\r\n\t*<p>一般读取的是由 writeUTFBytes 方法写入的字符串。</p>\r\n\t*@param len 要读的buffer长度，默认将读取缓冲区全部数据。\r\n\t*@return 读取的字符串。\r\n\t*/\r\n\t__proto.getUTFBytes=function(len){\r\n\t\t(len===void 0)&& (len=-1);\r\n\t\treturn this.readUTFBytes(len);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>在字节流中写入一个字节。</p>\r\n\t*<p>使用参数的低 8 位。忽略高 24 位。</p>\r\n\t*@param value\r\n\t*/\r\n\t__proto.writeByte=function(value){\r\n\t\tthis.ensureWrite(this._pos_+1);\r\n\t\tthis._d_.setInt8(this._pos_,value);\r\n\t\tthis._pos_+=1;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*从字节流中读取带符号的字节。\r\n\t*/\r\n\t__proto.readByte=function(){\r\n\t\tif (this._pos_+1 > this._length)throw \"readByte error - Out of bounds\";\r\n\t\treturn this._d_.getInt8(this._pos_++);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>从字节流中读取带符号的字节。</p>\r\n\t*<p>返回值的范围是从-128 到 127。</p>\r\n\t*@return 介于-128 和 127 之间的整数。\r\n\t*/\r\n\t__proto.getByte=function(){\r\n\t\treturn this.readByte();\r\n\t}\r\n\r\n\t/**\r\n\t*<p>保证该字节流的可用长度不小于 <code>lengthToEnsure</code> 参数指定的值。</p>\r\n\t*@param lengthToEnsure 指定的长度。\r\n\t*/\r\n\t__proto.ensureWrite=function(lengthToEnsure){\r\n\t\tif (this._length < lengthToEnsure)this._length=lengthToEnsure;\r\n\t\tif (this._allocated_ < lengthToEnsure)this.length=lengthToEnsure;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>将指定 arraybuffer 对象中的以 offset 为起始偏移量， length 为长度的字节序列写入字节流。</p>\r\n\t*<p>如果省略 length 参数，则使用默认长度 0，该方法将从 offset 开始写入整个缓冲区；如果还省略了 offset 参数，则写入整个缓冲区。</p>\r\n\t*<p>如果 offset 或 length 小于0，本函数将抛出异常。</p>\r\n\t*$NEXTBIG 由于没有判断length和arraybuffer的合法性，当开发者填写了错误的length值时，会导致写入多余的空白数据甚至内存溢出，为了避免影响开发者正在使用此方法的功能，下个重大版本会修复这些问题。\r\n\t*@param arraybuffer 需要写入的 Arraybuffer 对象。\r\n\t*@param offset Arraybuffer 对象的索引的偏移量（以字节为单位）\r\n\t*@param length 从 Arraybuffer 对象写入到 Byte 对象的长度（以字节为单位）\r\n\t*/\r\n\t__proto.writeArrayBuffer=function(arraybuffer,offset,length){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\t(length===void 0)&& (length=0);\r\n\t\tif (offset < 0 || length < 0)throw \"writeArrayBuffer error - Out of bounds\";\r\n\t\tif (length==0)length=arraybuffer.byteLength-offset;\r\n\t\tthis.ensureWrite(this._pos_+length);\r\n\t\tvar uint8array=new Uint8Array(arraybuffer);\r\n\t\tthis._u8d_.set(uint8array.subarray(offset,offset+length),this._pos_);\r\n\t\tthis._pos_+=length;\r\n\t}\r\n\r\n\t/**\r\n\t*获取此对象的 ArrayBuffer 数据，数据只包含有效数据部分。\r\n\t*/\r\n\t__getset(0,__proto,'buffer',function(){\r\n\t\tvar rstBuffer=this._d_.buffer;\r\n\t\tif (rstBuffer.byteLength==this.length)return rstBuffer;\r\n\t\treturn rstBuffer.slice(0,this.length);\r\n\t});\r\n\r\n\t/**\r\n\t*<p> <code>Byte</code> 实例的字节序。取值为：<code>BIG_ENDIAN</code> 或 <code>BIG_ENDIAN</code> 。</p>\r\n\t*<p>主机字节序，是 CPU 存放数据的两种不同顺序，包括小端字节序和大端字节序。通过 <code>getSystemEndian</code> 可以获取当前系统的字节序。</p>\r\n\t*<p> <code>BIG_ENDIAN</code> ：大端字节序，地址低位存储值的高位，地址高位存储值的低位。有时也称之为网络字节序。<br/>\r\n\t*<code>LITTLE_ENDIAN</code> ：小端字节序，地址低位存储值的低位，地址高位存储值的高位。</p>\r\n\t*/\r\n\t__getset(0,__proto,'endian',function(){\r\n\t\treturn this._xd_ ? \"littleEndian\" :\"bigEndian\";\r\n\t\t},function(endianStr){\r\n\t\tthis._xd_=(endianStr==\"littleEndian\");\r\n\t});\r\n\r\n\t/**\r\n\t*<p> <code>Byte</code> 对象的长度（以字节为单位）。</p>\r\n\t*<p>如果将长度设置为大于当前长度的值，则用零填充字节数组的右侧；如果将长度设置为小于当前长度的值，将会截断该字节数组。</p>\r\n\t*<p>如果要设置的长度大于当前已分配的内存空间的字节长度，则重新分配内存空间，大小为以下两者较大者：要设置的长度、当前已分配的长度的2倍，并将原有数据拷贝到新的内存空间中；如果要设置的长度小于当前已分配的内存空间的字节长度，也会重新分配内存空间，大小为要设置的长度，并将原有数据从头截断为要设置的长度存入新的内存空间中。</p>\r\n\t*/\r\n\t__getset(0,__proto,'length',function(){\r\n\t\treturn this._length;\r\n\t\t},function(value){\r\n\t\tif (this._allocated_ < value)\r\n\t\t\tthis.___resizeBuffer(this._allocated_=Math.floor(Math.max(value,this._allocated_ *2)));\r\n\t\telse if (this._allocated_ > value)\r\n\t\tthis.___resizeBuffer(this._allocated_=value);\r\n\t\tthis._length=value;\r\n\t});\r\n\r\n\t/**\r\n\t*移动或返回 Byte 对象的读写指针的当前位置（以字节为单位）。下一次调用读取方法时将在此位置开始读取，或者下一次调用写入方法时将在此位置开始写入。\r\n\t*/\r\n\t__getset(0,__proto,'pos',function(){\r\n\t\treturn this._pos_;\r\n\t\t},function(value){\r\n\t\tthis._pos_=value;\r\n\t});\r\n\r\n\t/**\r\n\t*可从字节流的当前位置到末尾读取的数据的字节数。\r\n\t*/\r\n\t__getset(0,__proto,'bytesAvailable',function(){\r\n\t\treturn this._length-this._pos_;\r\n\t});\r\n\r\n\tByte.getSystemEndian=function(){\r\n\t\tif (!Byte._sysEndian){\r\n\t\t\tvar buffer=new ArrayBuffer(2);\r\n\t\t\tnew DataView(buffer).setInt16(0,256,true);\r\n\t\t\tByte._sysEndian=(new Int16Array(buffer))[0]===256 ? /*CLASS CONST:laya.utils.Byte.LITTLE_ENDIAN*/\"littleEndian\" :/*CLASS CONST:laya.utils.Byte.BIG_ENDIAN*/\"bigEndian\";\r\n\t\t}\r\n\t\treturn Byte._sysEndian;\r\n\t}\r\n\r\n\tByte.BIG_ENDIAN=\"bigEndian\";\r\n\tByte.LITTLE_ENDIAN=\"littleEndian\";\r\n\tByte._sysEndian=null;\r\n\treturn Byte;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*对象缓存统一管理类\r\n*/\r\n//class laya.utils.CacheManager\r\nvar CacheManager=(function(){\r\n\tfunction CacheManager(){}\r\n\t__class(CacheManager,'laya.utils.CacheManager');\r\n\tCacheManager.regCacheByFunction=function(disposeFunction,getCacheListFunction){\r\n\t\tCacheManager.unRegCacheByFunction(disposeFunction,getCacheListFunction);\r\n\t\tvar cache;\r\n\t\tcache={tryDispose:disposeFunction,getCacheList:getCacheListFunction};\r\n\t\tCacheManager._cacheList.push(cache);\r\n\t}\r\n\r\n\tCacheManager.unRegCacheByFunction=function(disposeFunction,getCacheListFunction){\r\n\t\tvar i=0,len=0;\r\n\t\tlen=CacheManager._cacheList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (CacheManager._cacheList[i].tryDispose==disposeFunction && CacheManager._cacheList[i].getCacheList==getCacheListFunction){\r\n\t\t\t\tCacheManager._cacheList.splice(i,1);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tCacheManager.forceDispose=function(){\r\n\t\tvar i=0,len=CacheManager._cacheList.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tCacheManager._cacheList[i].tryDispose(true);\r\n\t\t}\r\n\t}\r\n\r\n\tCacheManager.beginCheck=function(waitTime){\r\n\t\t(waitTime===void 0)&& (waitTime=15000);\r\n\t\tLaya.timer.loop(waitTime,null,CacheManager._checkLoop);\r\n\t}\r\n\r\n\tCacheManager.stopCheck=function(){\r\n\t\tLaya.timer.clear(null,CacheManager._checkLoop);\r\n\t}\r\n\r\n\tCacheManager._checkLoop=function(){\r\n\t\tvar cacheList=CacheManager._cacheList;\r\n\t\tif (cacheList.length < 1)return;\r\n\t\tvar tTime=Browser.now();\r\n\t\tvar count=0;\r\n\t\tvar len=0;\r\n\t\tlen=count=cacheList.length;\r\n\t\twhile (count > 0){\r\n\t\t\tCacheManager._index++;\r\n\t\t\tCacheManager._index=CacheManager._index % len;\r\n\t\t\tcacheList[CacheManager._index].tryDispose(false);\r\n\t\t\tif (Browser.now()-tTime > CacheManager.loopTimeLimit)break ;\r\n\t\t\tcount--;\r\n\t\t}\r\n\t}\r\n\r\n\tCacheManager.loopTimeLimit=2;\r\n\tCacheManager._cacheList=[];\r\n\tCacheManager._index=0;\r\n\treturn CacheManager;\r\n})()\r\n\r\n\r\n/**\r\n*<code>ClassUtils</code> 是一个类工具类。\r\n*/\r\n//class laya.utils.ClassUtils\r\nvar ClassUtils=(function(){\r\n\tfunction ClassUtils(){}\r\n\t__class(ClassUtils,'laya.utils.ClassUtils');\r\n\tClassUtils.regClass=function(className,classDef){\r\n\t\tClassUtils._classMap[className]=classDef;\r\n\t}\r\n\r\n\tClassUtils.getRegClass=function(className){\r\n\t\treturn ClassUtils._classMap[className];\r\n\t}\r\n\r\n\tClassUtils.getInstance=function(className){\r\n\t\tvar compClass=ClassUtils.getClass(className);\r\n\t\tif (compClass)\r\n\t\t\treturn new compClass();\r\n\t\telse\r\n\t\tconsole.warn(\"[error] Undefined class:\",className);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tClassUtils.createByJson=function(json,node,root,customHandler,instanceHandler){\r\n\t\tif ((typeof json=='string'))\r\n\t\t\tjson=JSON.parse(json);\r\n\t\tvar props=json.props;\r\n\t\tif (!node){\r\n\t\t\tnode=instanceHandler ? instanceHandler.runWith(json):ClassUtils.getInstance(props.runtime || json.type);\r\n\t\t\tif (!node)\r\n\t\t\t\treturn null;\r\n\t\t};\r\n\t\tvar child=json.child;\r\n\t\tif (child){\r\n\t\t\tfor (var i=0,n=child.length;i < n;i++){\r\n\t\t\t\tvar data=child[i];\r\n\t\t\t\tif ((data.props.name===\"render\" || data.props.renderType===\"render\")&& node[\"_$set_itemRender\"])\r\n\t\t\t\t\tnode.itemRender=data;\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (data.type==\"Graphic\"){\r\n\t\t\t\t\t\tClassUtils.addGraphicsToSprite(data,node);\r\n\t\t\t\t\t\t}else if (ClassUtils.isDrawType(data.type)){\r\n\t\t\t\t\t\tClassUtils.addGraphicToSprite(data,node,true);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tvar tChild=ClassUtils.createByJson(data,null,root,customHandler,instanceHandler)\r\n\t\t\t\t\t\tif (data.type==\"Script\"){\r\n\t\t\t\t\t\t\tif (tChild.hasOwnProperty(\"owner\")){\r\n\t\t\t\t\t\t\t\ttChild[\"owner\"]=node;\r\n\t\t\t\t\t\t\t\t}else if (tChild.hasOwnProperty(\"target\")){\r\n\t\t\t\t\t\t\t\ttChild[\"target\"]=node;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else if (data.props.renderType==\"mask\"){\r\n\t\t\t\t\t\t\tnode.mask=tChild;\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\tnode.addChild(tChild);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (props){\r\n\t\t\tfor (var prop in props){\r\n\t\t\t\tvar value=props[prop];\r\n\t\t\t\tif (prop===\"var\" && root){\r\n\t\t\t\t\troot[value]=node;\r\n\t\t\t\t\t}else if ((value instanceof Array)&& (typeof (node[prop])=='function')){\r\n\t\t\t\t\tnode[prop].apply(node,value);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tnode[prop]=value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (customHandler && json.customProps){\r\n\t\t\tcustomHandler.runWith([node,json]);\r\n\t\t}\r\n\t\tif (node[\"created\"])\r\n\t\t\tnode.created();\r\n\t\treturn node;\r\n\t}\r\n\r\n\tClassUtils.addGraphicsToSprite=function(graphicO,sprite){\r\n\t\tvar graphics;\r\n\t\tgraphics=graphicO.child;\r\n\t\tif (!graphics || graphics.length < 1)\r\n\t\t\treturn;\r\n\t\tvar g;\r\n\t\tg=ClassUtils._getGraphicsFromSprite(graphicO,sprite);\r\n\t\tvar ox=0;\r\n\t\tvar oy=0;\r\n\t\tif (graphicO.props){\r\n\t\t\tox=ClassUtils._getObjVar(graphicO.props,\"x\",0);\r\n\t\t\toy=ClassUtils._getObjVar(graphicO.props,\"y\",0);\r\n\t\t}\r\n\t\tif (ox !=0 && oy !=0){\r\n\t\t\tg.translate(ox,oy);\r\n\t\t};\r\n\t\tvar i=0,len=0;\r\n\t\tlen=graphics.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tClassUtils._addGraphicToGraphics(graphics[i],g);\r\n\t\t}\r\n\t\tif (ox !=0 && oy !=0){\r\n\t\t\tg.translate(-ox,-oy);\r\n\t\t}\r\n\t}\r\n\r\n\tClassUtils.addGraphicToSprite=function(graphicO,sprite,isChild){\r\n\t\t(isChild===void 0)&& (isChild=false);\r\n\t\tvar g;\r\n\t\tg=isChild ? ClassUtils._getGraphicsFromSprite(graphicO,sprite):sprite.graphics;\r\n\t\tClassUtils._addGraphicToGraphics(graphicO,g);\r\n\t}\r\n\r\n\tClassUtils._getGraphicsFromSprite=function(dataO,sprite){\r\n\t\tvar g;\r\n\t\tif (!dataO || !dataO.props)\r\n\t\t\treturn sprite.graphics;\r\n\t\tvar propsName;\r\n\t\tpropsName=dataO.props.renderType;\r\n\t\tswitch (propsName){\r\n\t\t\tcase \"hit\":\r\n\t\t\tcase \"unHit\":;\r\n\t\t\t\tvar hitArea;\r\n\t\t\t\tif (!sprite.hitArea){\r\n\t\t\t\t\tsprite.hitArea=new HitArea();\r\n\t\t\t\t}\r\n\t\t\t\thitArea=sprite.hitArea;\r\n\t\t\t\tif (!hitArea[propsName]){\r\n\t\t\t\t\thitArea[propsName]=new Graphics();\r\n\t\t\t\t}\r\n\t\t\t\tg=hitArea[propsName];\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t}\r\n\t\tif (!g)\r\n\t\t\tg=sprite.graphics;\r\n\t\treturn g;\r\n\t}\r\n\r\n\tClassUtils._getTransformData=function(propsO){\r\n\t\tvar m;\r\n\t\tif (propsO.hasOwnProperty(\"pivotX\")|| propsO.hasOwnProperty(\"pivotY\")){\r\n\t\t\tm=m || new Matrix();\r\n\t\t\tm.translate(-ClassUtils._getObjVar(propsO,\"pivotX\",0),-ClassUtils._getObjVar(propsO,\"pivotY\",0));\r\n\t\t};\r\n\t\tvar sx=ClassUtils._getObjVar(propsO,\"scaleX\",1),sy=ClassUtils._getObjVar(propsO,\"scaleY\",1);\r\n\t\tvar rotate=ClassUtils._getObjVar(propsO,\"rotation\",0);\r\n\t\tvar skewX=ClassUtils._getObjVar(propsO,\"skewX\",0);\r\n\t\tvar skewY=ClassUtils._getObjVar(propsO,\"skewY\",0);\r\n\t\tif (sx !=1 || sy !=1 || rotate !=0){\r\n\t\t\tm=m || new Matrix();\r\n\t\t\tm.scale(sx,sy);\r\n\t\t\tm.rotate(rotate *0.0174532922222222);\r\n\t\t}\r\n\t\treturn m;\r\n\t}\r\n\r\n\tClassUtils._addGraphicToGraphics=function(graphicO,graphic){\r\n\t\tvar propsO;\r\n\t\tpropsO=graphicO.props;\r\n\t\tif (!propsO)\r\n\t\t\treturn;\r\n\t\tvar drawConfig;\r\n\t\tdrawConfig=ClassUtils.DrawTypeDic[graphicO.type];\r\n\t\tif (!drawConfig)\r\n\t\t\treturn;\r\n\t\tvar g;\r\n\t\tg=graphic;\r\n\t\tvar m;\r\n\t\tvar params=ClassUtils._getParams(propsO,drawConfig[1],drawConfig[2],drawConfig[3]);\r\n\t\tm=ClassUtils._tM;\r\n\t\tif (m || ClassUtils._alpha !=1){\r\n\t\t\tg.save();\r\n\t\t\tif (m)\r\n\t\t\t\tg.transform(m);\r\n\t\t\tif (ClassUtils._alpha !=1)\r\n\t\t\t\tg.alpha(ClassUtils._alpha);\r\n\t\t}\r\n\t\tg[drawConfig[0]].apply(g,params);\r\n\t\tif (m || ClassUtils._alpha !=1){\r\n\t\t\tg.restore();\r\n\t\t}\r\n\t}\r\n\r\n\tClassUtils._adptLineData=function(params){\r\n\t\tparams[2]=parseFloat(params[0])+parseFloat(params[2]);\r\n\t\tparams[3]=parseFloat(params[1])+parseFloat(params[3]);\r\n\t\treturn params;\r\n\t}\r\n\r\n\tClassUtils._adptTextureData=function(params){\r\n\t\tparams[0]=Loader.getRes(params[0]);\r\n\t\treturn params;\r\n\t}\r\n\r\n\tClassUtils._adptLinesData=function(params){\r\n\t\tparams[2]=ClassUtils._getPointListByStr(params[2]);\r\n\t\treturn params;\r\n\t}\r\n\r\n\tClassUtils.isDrawType=function(type){\r\n\t\tif (type==\"Image\")\r\n\t\t\treturn false;\r\n\t\treturn ClassUtils.DrawTypeDic.hasOwnProperty(type);\r\n\t}\r\n\r\n\tClassUtils._getParams=function(obj,params,xPos,adptFun){\r\n\t\t(xPos===void 0)&& (xPos=0);\r\n\t\tvar rst;\r\n\t\trst=ClassUtils._temParam;\r\n\t\trst.length=params.length;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=params.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst[i]=ClassUtils._getObjVar(obj,params[i][0],params[i][1]);\r\n\t\t}\r\n\t\tClassUtils._alpha=ClassUtils._getObjVar(obj,\"alpha\",1);\r\n\t\tvar m;\r\n\t\tm=ClassUtils._getTransformData(obj);\r\n\t\tif (m){\r\n\t\t\tif (!xPos)xPos=0;\r\n\t\t\tm.translate(rst[xPos],rst[xPos+1]);\r\n\t\t\trst[xPos]=rst[xPos+1]=0;\r\n\t\t\tClassUtils._tM=m;\r\n\t\t\t}else {\r\n\t\t\tClassUtils._tM=null;\r\n\t\t}\r\n\t\tif (adptFun && ClassUtils[adptFun]){\r\n\t\t\trst=ClassUtils[adptFun](rst);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tClassUtils._getPointListByStr=function(str){\r\n\t\tvar pointArr;\r\n\t\tpointArr=str.split(\",\");\r\n\t\tvar i=0,len=0;\r\n\t\tlen=pointArr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tpointArr[i]=parseFloat(pointArr[i]);\r\n\t\t}\r\n\t\treturn pointArr;\r\n\t}\r\n\r\n\tClassUtils._getObjVar=function(obj,key,noValue){\r\n\t\tif (obj.hasOwnProperty(key)){\r\n\t\t\treturn obj[key];\r\n\t\t}\r\n\t\treturn noValue;\r\n\t}\r\n\r\n\tClassUtils._temParam=[];\r\n\tClassUtils.getClass=function(className){\r\n\t\tvar classObject=ClassUtils._classMap[className] || className;\r\n\t\tif ((typeof classObject=='string'))\r\n\t\t\treturn Laya[\"__classmap\"][classObject];\r\n\t\treturn classObject;\r\n\t}\r\n\r\n\tClassUtils._tM=null;\r\n\tClassUtils._alpha=NaN;\r\n\t__static(ClassUtils,\r\n\t['DrawTypeDic',function(){return this.DrawTypeDic={\"Rect\":[\"drawRect\",[[\"x\",0],[\"y\",0],[\"width\",0],[\"height\",0],[\"fillColor\",null],[\"lineColor\",null],[\"lineWidth\",1]]],\"Circle\":[\"drawCircle\",[[\"x\",0],[\"y\",0],[\"radius\",0],[\"fillColor\",null],[\"lineColor\",null],[\"lineWidth\",1]]],\"Pie\":[\"drawPie\",[[\"x\",0],[\"y\",0],[\"radius\",0],[\"startAngle\",0],[\"endAngle\",0],[\"fillColor\",null],[\"lineColor\",null],[\"lineWidth\",1]]],\"Image\":[\"drawTexture\",[[\"x\",0],[\"y\",0],[\"width\",0],[\"height\",0]]],\"Texture\":[\"drawTexture\",[[\"skin\",null],[\"x\",0],[\"y\",0],[\"width\",0],[\"height\",0]],1,\"_adptTextureData\"],\"FillTexture\":[\"fillTexture\",[[\"skin\",null],[\"x\",0],[\"y\",0],[\"width\",0],[\"height\",0],[\"repeat\",null]],1,\"_adptTextureData\"],\"FillText\":[\"fillText\",[[\"text\",\"\"],[\"x\",0],[\"y\",0],[\"font\",null],[\"color\",null],[\"textAlign\",null]],1],\"Line\":[\"drawLine\",[[\"x\",0],[\"y\",0],[\"toX\",0],[\"toY\",0],[\"lineColor\",null],[\"lineWidth\",0]],0,\"_adptLineData\"],\"Lines\":[\"drawLines\",[[\"x\",0],[\"y\",0],[\"points\",\"\"],[\"lineColor\",null],[\"lineWidth\",0]],0,\"_adptLinesData\"],\"Curves\":[\"drawCurves\",[[\"x\",0],[\"y\",0],[\"points\",\"\"],[\"lineColor\",null],[\"lineWidth\",0]],0,\"_adptLinesData\"],\"Poly\":[\"drawPoly\",[[\"x\",0],[\"y\",0],[\"points\",\"\"],[\"fillColor\",null],[\"lineColor\",null],[\"lineWidth\",1]],0,\"_adptLinesData\"]};},'_classMap',function(){return this._classMap={'Sprite':'laya.display.Sprite','Text':'laya.display.Text','Animation':'laya.display.Animation','Skeleton':'laya.ani.bone.Skeleton','Particle2D':'laya.particle.Particle2D','div':'laya.html.dom.HTMLDivElement','p':'laya.html.dom.HTMLElement','img':'laya.html.dom.HTMLImageElement','span':'laya.html.dom.HTMLElement','br':'laya.html.dom.HTMLBrElement','style':'laya.html.dom.HTMLStyleElement','font':'laya.html.dom.HTMLElement','a':'laya.html.dom.HTMLElement','#text':'laya.html.dom.HTMLElement'};}\r\n\t]);\r\n\treturn ClassUtils;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Color</code> 是一个颜色值处理类。\r\n*/\r\n//class laya.utils.Color\r\nvar Color=(function(){\r\n\tfunction Color(str){\r\n\t\t/**@private */\r\n\t\tthis._color=[];\r\n\t\t/**字符串型颜色值。*/\r\n\t\t//this.strColor=null;\r\n\t\t/**uint 型颜色值。*/\r\n\t\t//this.numColor=0;\r\n\t\t//this._drawStyle=null;\r\n\t\tif ((typeof str=='string')){\r\n\t\t\tthis.strColor=str;\r\n\t\t\tif (str===null)str=\"#000000\";\r\n\t\t\tstr.charAt(0)=='#' && (str=str.substr(1));\r\n\t\t\tvar len=str.length;\r\n\t\t\tif (len==3 || len==4){\r\n\t\t\t\tvar temp=\"\";\r\n\t\t\t\tfor (var i=0;i < len;i++){\r\n\t\t\t\t\ttemp+=(str[i]+str[i]);\r\n\t\t\t\t}\r\n\t\t\t\tstr=temp;\r\n\t\t\t};\r\n\t\t\tvar color=this.numColor=parseInt(str,16);\r\n\t\t\tvar flag=(str.length==8);\r\n\t\t\tif (flag){\r\n\t\t\t\tthis._color=[parseInt(str.substr(0,2),16)/ 255,((0x00FF0000 & color)>> 16)/ 255,((0x0000FF00 & color)>> 8)/ 255,(0x000000FF & color)/ 255];\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tcolor=this.numColor=str;\r\n\t\t\tthis.strColor=Utils.toHexColor(color);\r\n\t\t}\r\n\t\tthis._color=[((0xFF0000 & color)>> 16)/ 255,((0xFF00 & color)>> 8)/ 255,(0xFF & color)/ 255,1];\r\n\t\t(this._color).__id=++Color._COLODID;\r\n\t}\r\n\r\n\t__class(Color,'laya.utils.Color');\r\n\tColor._initDefault=function(){\r\n\t\tColor._DEFAULT={};\r\n\t\tfor (var i in Color._COLOR_MAP)Color._SAVE[i]=Color._DEFAULT[i]=new Color(Color._COLOR_MAP[i]);\r\n\t\treturn Color._DEFAULT;\r\n\t}\r\n\r\n\tColor._initSaveMap=function(){\r\n\t\tColor._SAVE_SIZE=0;\r\n\t\tColor._SAVE={};\r\n\t\tfor (var i in Color._DEFAULT)Color._SAVE[i]=Color._DEFAULT[i];\r\n\t}\r\n\r\n\tColor.create=function(str){\r\n\t\tvar color=Color._SAVE[str+\"\"];\r\n\t\tif (color !=null)return color;\r\n\t\t(Color._SAVE_SIZE < 1000)|| Color._initSaveMap();\r\n\t\treturn Color._SAVE[str+\"\"]=new Color(str);\r\n\t}\r\n\r\n\tColor._SAVE={};\r\n\tColor._SAVE_SIZE=0;\r\n\tColor._COLODID=1;\r\n\t__static(Color,\r\n\t['_COLOR_MAP',function(){return this._COLOR_MAP={\"white\":'#FFFFFF',\"red\":'#FF0000',\"green\":'#00FF00',\"blue\":'#0000FF',\"black\":'#000000',\"yellow\":'#FFFF00','gray':'#AAAAAA'};},'_DEFAULT',function(){return this._DEFAULT=Color._initDefault();}\r\n\t]);\r\n\treturn Color;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Dictionary</code> 是一个字典型的数据存取类。\r\n*/\r\n//class laya.utils.Dictionary\r\nvar Dictionary=(function(){\r\n\tfunction Dictionary(){\r\n\t\tthis._values=[];\r\n\t\tthis._keys=[];\r\n\t}\r\n\r\n\t__class(Dictionary,'laya.utils.Dictionary');\r\n\tvar __proto=Dictionary.prototype;\r\n\t/**\r\n\t*给指定的键名设置值。\r\n\t*@param key 键名。\r\n\t*@param value 值。\r\n\t*/\r\n\t__proto.set=function(key,value){\r\n\t\tvar index=this.indexOf(key);\r\n\t\tif (index >=0){\r\n\t\t\tthis._values[index]=value;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._keys.push(key);\r\n\t\tthis._values.push(value);\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定对象的键名索引。\r\n\t*@param key 键名对象。\r\n\t*@return 键名索引。\r\n\t*/\r\n\t__proto.indexOf=function(key){\r\n\t\tvar index=this._keys.indexOf(key);\r\n\t\tif (index >=0)return index;\r\n\t\tkey=((typeof key=='string'))? Number(key):(((typeof key=='number'))? key.toString():key);\r\n\t\treturn this._keys.indexOf(key);\r\n\t}\r\n\r\n\t/**\r\n\t*返回指定键名的值。\r\n\t*@param key 键名对象。\r\n\t*@return 指定键名的值。\r\n\t*/\r\n\t__proto.get=function(key){\r\n\t\tvar index=this.indexOf(key);\r\n\t\treturn index < 0 ? null :this._values[index];\r\n\t}\r\n\r\n\t/**\r\n\t*移除指定键名的值。\r\n\t*@param key 键名对象。\r\n\t*@return 是否成功移除。\r\n\t*/\r\n\t__proto.remove=function(key){\r\n\t\tvar index=this.indexOf(key);\r\n\t\tif (index >=0){\r\n\t\t\tthis._keys.splice(index,1);\r\n\t\t\tthis._values.splice(index,1);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*清除此对象的键名列表和键值列表。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis._values.length=0;\r\n\t\tthis._keys.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*获取所有的子元素列表。\r\n\t*/\r\n\t__getset(0,__proto,'values',function(){\r\n\t\treturn this._values;\r\n\t});\r\n\r\n\t/**\r\n\t*获取所有的子元素键名列表。\r\n\t*/\r\n\t__getset(0,__proto,'keys',function(){\r\n\t\treturn this._keys;\r\n\t});\r\n\r\n\treturn Dictionary;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Dragging</code> 类是触摸滑动控件。\r\n*/\r\n//class laya.utils.Dragging\r\nvar Dragging=(function(){\r\n\tfunction Dragging(){\r\n\t\t/**被拖动的对象。*/\r\n\t\t//this.target=null;\r\n\t\t/**缓动衰减系数。*/\r\n\t\tthis.ratio=0.92;\r\n\t\t/**单帧最大偏移量。*/\r\n\t\tthis.maxOffset=60;\r\n\t\t/**滑动范围。*/\r\n\t\t//this.area=null;\r\n\t\t/**表示拖动是否有惯性。*/\r\n\t\t//this.hasInertia=false;\r\n\t\t/**橡皮筋最大值。*/\r\n\t\t//this.elasticDistance=NaN;\r\n\t\t/**橡皮筋回弹时间，单位为毫秒。*/\r\n\t\t//this.elasticBackTime=NaN;\r\n\t\t/**事件携带数据。*/\r\n\t\t//this.data=null;\r\n\t\tthis._dragging=false;\r\n\t\tthis._clickOnly=true;\r\n\t\t//this._elasticRateX=NaN;\r\n\t\t//this._elasticRateY=NaN;\r\n\t\t//this._lastX=NaN;\r\n\t\t//this._lastY=NaN;\r\n\t\t//this._offsetX=NaN;\r\n\t\t//this._offsetY=NaN;\r\n\t\t//this._offsets=null;\r\n\t\t//this._disableMouseEvent=false;\r\n\t\t//this._tween=null;\r\n\t\t//this._parent=null;\r\n\t}\r\n\r\n\t__class(Dragging,'laya.utils.Dragging');\r\n\tvar __proto=Dragging.prototype;\r\n\t/**\r\n\t*开始拖拽。\r\n\t*@param target 待拖拽的 <code>Sprite</code> 对象。\r\n\t*@param area 滑动范围。\r\n\t*@param hasInertia 拖动是否有惯性。\r\n\t*@param elasticDistance 橡皮筋最大值。\r\n\t*@param elasticBackTime 橡皮筋回弹时间，单位为毫秒。\r\n\t*@param data 事件携带数据。\r\n\t*@param disableMouseEvent 鼠标事件是否有效。\r\n\t*@param ratio 惯性阻尼系数\r\n\t*/\r\n\t__proto.start=function(target,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){\r\n\t\t(ratio===void 0)&& (ratio=0.92);\r\n\t\tthis.clearTimer();\r\n\t\tthis.target=target;\r\n\t\tthis.area=area;\r\n\t\tthis.hasInertia=hasInertia;\r\n\t\tthis.elasticDistance=area ? elasticDistance :0;\r\n\t\tthis.elasticBackTime=elasticBackTime;\r\n\t\tthis.data=data;\r\n\t\tthis._disableMouseEvent=disableMouseEvent;\r\n\t\tthis.ratio=ratio;\r\n\t\tif (target.globalScaleX !=1 || target.globalScaleY !=1){\r\n\t\t\tthis._parent=target.parent;\r\n\t\t\t}else {\r\n\t\t\tthis._parent=Laya.stage;\r\n\t\t}\r\n\t\tthis._clickOnly=true;\r\n\t\tthis._dragging=true;\r\n\t\tthis._elasticRateX=this._elasticRateY=1;\r\n\t\tthis._lastX=this._parent.mouseX;\r\n\t\tthis._lastY=this._parent.mouseY;\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp);\r\n\t\tLaya.stage.on(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onStageMouseUp);\r\n\t\tLaya.timer.frameLoop(1,this,this.loop);\r\n\t}\r\n\r\n\t/**\r\n\t*清除计时器。\r\n\t*/\r\n\t__proto.clearTimer=function(){\r\n\t\tLaya.timer.clear(this,this.loop);\r\n\t\tLaya.timer.clear(this,this.tweenMove);\r\n\t\tif (this._tween){\r\n\t\t\tthis._tween.recover();\r\n\t\t\tthis._tween=null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止拖拽。\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tif (this._dragging){\r\n\t\t\tMouseManager.instance.disableMouseEvent=false;\r\n\t\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp);\r\n\t\t\tLaya.stage.off(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onStageMouseUp);\r\n\t\t\tthis._dragging=false;\r\n\t\t\tthis.target && this.area && this.backToArea();\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*拖拽的循环处理函数。\r\n\t*/\r\n\t__proto.loop=function(){\r\n\t\tvar point=this._parent.getMousePoint();\r\n\t\tvar mouseX=point.x;\r\n\t\tvar mouseY=point.y;\r\n\t\tvar offsetX=mouseX-this._lastX;\r\n\t\tvar offsetY=mouseY-this._lastY;\r\n\t\tif (this._clickOnly){\r\n\t\t\tif (Math.abs(offsetX *Laya.stage._canvasTransform.getScaleX())> 1 || Math.abs(offsetY *Laya.stage._canvasTransform.getScaleY())> 1){\r\n\t\t\t\tthis._clickOnly=false;\r\n\t\t\t\tthis._offsets || (this._offsets=[]);\r\n\t\t\t\tthis._offsets.length=0;\r\n\t\t\t\tthis.target.event(/*laya.events.Event.DRAG_START*/\"dragstart\",this.data);\r\n\t\t\t\tMouseManager.instance.disableMouseEvent=this._disableMouseEvent;\r\n\t\t\t\tthis.target._set$P(\"$_MOUSEDOWN\",false);\r\n\t\t\t}else return;\r\n\t\t\t}else {\r\n\t\t\tthis._offsets.push(offsetX,offsetY);\r\n\t\t}\r\n\t\tif (offsetX===0 && offsetY===0)return;\r\n\t\tthis._lastX=mouseX;\r\n\t\tthis._lastY=mouseY;\r\n\t\tthis.target.x+=offsetX *this._elasticRateX;\r\n\t\tthis.target.y+=offsetY *this._elasticRateY;\r\n\t\tthis.area && this.checkArea();\r\n\t\tthis.target.event(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",this.data);\r\n\t}\r\n\r\n\t/**\r\n\t*拖拽区域检测。\r\n\t*/\r\n\t__proto.checkArea=function(){\r\n\t\tif (this.elasticDistance <=0){\r\n\t\t\tthis.backToArea();\r\n\t\t\t}else {\r\n\t\t\tif (this.target.x < this.area.x){\r\n\t\t\t\tvar offsetX=this.area.x-this.target.x;\r\n\t\t\t\t}else if (this.target.x > this.area.x+this.area.width){\r\n\t\t\t\toffsetX=this.target.x-this.area.x-this.area.width;\r\n\t\t\t\t}else {\r\n\t\t\t\toffsetX=0;\r\n\t\t\t}\r\n\t\t\tthis._elasticRateX=Math.max(0,1-(offsetX / this.elasticDistance));\r\n\t\t\tif (this.target.y < this.area.y){\r\n\t\t\t\tvar offsetY=this.area.y-this.target.y;\r\n\t\t\t\t}else if (this.target.y > this.area.y+this.area.height){\r\n\t\t\t\toffsetY=this.target.y-this.area.y-this.area.height;\r\n\t\t\t\t}else {\r\n\t\t\t\toffsetY=0;\r\n\t\t\t}\r\n\t\t\tthis._elasticRateY=Math.max(0,1-(offsetY / this.elasticDistance));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*移动至设定的拖拽区域。\r\n\t*/\r\n\t__proto.backToArea=function(){\r\n\t\tthis.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width);\r\n\t\tthis.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height);\r\n\t}\r\n\r\n\t/**\r\n\t*舞台的抬起事件侦听函数。\r\n\t*@param e Event 对象。\r\n\t*/\r\n\t__proto.onStageMouseUp=function(e){\r\n\t\tMouseManager.instance.disableMouseEvent=false;\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_UP*/\"mouseup\",this,this.onStageMouseUp);\r\n\t\tLaya.stage.off(/*laya.events.Event.MOUSE_OUT*/\"mouseout\",this,this.onStageMouseUp);\r\n\t\tLaya.timer.clear(this,this.loop);\r\n\t\tif (this._clickOnly || !this.target)return;\r\n\t\tif (this.hasInertia){\r\n\t\t\tif (this._offsets.length < 1){\r\n\t\t\t\tthis._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY);\r\n\t\t\t}\r\n\t\t\tthis._offsetX=this._offsetY=0;\r\n\t\t\tvar len=this._offsets.length;\r\n\t\t\tvar n=Math.min(len,6);\r\n\t\t\tvar m=this._offsets.length-n;\r\n\t\t\tfor (var i=len-1;i > m;i--){\r\n\t\t\t\tthis._offsetY+=this._offsets[i--];\r\n\t\t\t\tthis._offsetX+=this._offsets[i];\r\n\t\t\t}\r\n\t\t\tthis._offsetX=this._offsetX / n *2;\r\n\t\t\tthis._offsetY=this._offsetY / n *2;\r\n\t\t\tif (Math.abs(this._offsetX)> this.maxOffset)this._offsetX=this._offsetX > 0 ? this.maxOffset :-this.maxOffset;\r\n\t\t\tif (Math.abs(this._offsetY)> this.maxOffset)this._offsetY=this._offsetY > 0 ? this.maxOffset :-this.maxOffset;\r\n\t\t\tLaya.timer.frameLoop(1,this,this.tweenMove);\r\n\t\t\t}else if (this.elasticDistance > 0){\r\n\t\t\tthis.checkElastic();\r\n\t\t\t}else {\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*橡皮筋效果检测。\r\n\t*/\r\n\t__proto.checkElastic=function(){\r\n\t\tvar tx=NaN;\r\n\t\tvar ty=NaN;\r\n\t\tif (this.target.x < this.area.x)tx=this.area.x;\r\n\t\telse if (this.target.x > this.area.x+this.area.width)tx=this.area.x+this.area.width;\r\n\t\tif (this.target.y < this.area.y)ty=this.area.y;\r\n\t\telse if (this.target.y > this.area.y+this.area.height)ty=this.area.y+this.area.height;\r\n\t\tif (!isNaN(tx)|| !isNaN(ty)){\r\n\t\t\tvar obj={};\r\n\t\t\tif (!isNaN(tx))obj.x=tx;\r\n\t\t\tif (!isNaN(ty))obj.y=ty;\r\n\t\t\tthis._tween=Tween.to(this.target,obj,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,false,false);\r\n\t\t\t}else {\r\n\t\t\tthis.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*移动。\r\n\t*/\r\n\t__proto.tweenMove=function(){\r\n\t\tthis._offsetX *=this.ratio *this._elasticRateX;\r\n\t\tthis._offsetY *=this.ratio *this._elasticRateY;\r\n\t\tthis.target.x+=this._offsetX;\r\n\t\tthis.target.y+=this._offsetY;\r\n\t\tthis.area && this.checkArea();\r\n\t\tthis.target.event(/*laya.events.Event.DRAG_MOVE*/\"dragmove\",this.data);\r\n\t\tif ((Math.abs(this._offsetX)< 1 && Math.abs(this._offsetY)< 1)|| this._elasticRateX < 0.5 || this._elasticRateY < 0.5){\r\n\t\t\tLaya.timer.clear(this,this.tweenMove);\r\n\t\t\tif (this.elasticDistance > 0)this.checkElastic();\r\n\t\t\telse this.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*结束拖拽。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tif (this.target){\r\n\t\t\tthis.clearTimer();\r\n\t\t\tvar sp=this.target;\r\n\t\t\tthis.target=null;\r\n\t\t\tthis._parent=null;\r\n\t\t\tsp.event(/*laya.events.Event.DRAG_END*/\"dragend\",this.data);\r\n\t\t}\r\n\t}\r\n\r\n\treturn Dragging;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Ease</code> 类定义了缓动函数，以便实现 <code>Tween</code> 动画的缓动效果。\r\n*/\r\n//class laya.utils.Ease\r\nvar Ease=(function(){\r\n\tfunction Ease(){}\r\n\t__class(Ease,'laya.utils.Ease');\r\n\tEase.linearNone=function(t,b,c,d){\r\n\t\treturn c *t / d+b;\r\n\t}\r\n\r\n\tEase.linearIn=function(t,b,c,d){\r\n\t\treturn c *t / d+b;\r\n\t}\r\n\r\n\tEase.linearInOut=function(t,b,c,d){\r\n\t\treturn c *t / d+b;\r\n\t}\r\n\r\n\tEase.linearOut=function(t,b,c,d){\r\n\t\treturn c *t / d+b;\r\n\t}\r\n\r\n\tEase.bounceIn=function(t,b,c,d){\r\n\t\treturn c-Ease.bounceOut(d-t,0,c,d)+b;\r\n\t}\r\n\r\n\tEase.bounceInOut=function(t,b,c,d){\r\n\t\tif (t < d *0.5)return Ease.bounceIn(t *2,0,c,d)*.5+b;\r\n\t\telse return Ease.bounceOut(t *2-d,0,c,d)*.5+c *.5+b;\r\n\t}\r\n\r\n\tEase.bounceOut=function(t,b,c,d){\r\n\t\tif ((t /=d)< (1 / 2.75))return c *(7.5625 *t *t)+b;\r\n\t\telse if (t < (2 / 2.75))return c *(7.5625 *(t-=(1.5 / 2.75))*t+.75)+b;\r\n\t\telse if (t < (2.5 / 2.75))return c *(7.5625 *(t-=(2.25 / 2.75))*t+.9375)+b;\r\n\t\telse return c *(7.5625 *(t-=(2.625 / 2.75))*t+.984375)+b;\r\n\t}\r\n\r\n\tEase.backIn=function(t,b,c,d,s){\r\n\t\t(s===void 0)&& (s=1.70158);\r\n\t\treturn c *(t /=d)*t *((s+1)*t-s)+b;\r\n\t}\r\n\r\n\tEase.backInOut=function(t,b,c,d,s){\r\n\t\t(s===void 0)&& (s=1.70158);\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *(t *t *(((s *=(1.525))+1)*t-s))+b;\r\n\t\treturn c / 2 *((t-=2)*t *(((s *=(1.525))+1)*t+s)+2)+b;\r\n\t}\r\n\r\n\tEase.backOut=function(t,b,c,d,s){\r\n\t\t(s===void 0)&& (s=1.70158);\r\n\t\treturn c *((t=t / d-1)*t *((s+1)*t+s)+1)+b;\r\n\t}\r\n\r\n\tEase.elasticIn=function(t,b,c,d,a,p){\r\n\t\t(a===void 0)&& (a=0);\r\n\t\t(p===void 0)&& (p=0);\r\n\t\tvar s;\r\n\t\tif (t==0)return b;\r\n\t\tif ((t /=d)==1)return b+c;\r\n\t\tif (!p)p=d *.3;\r\n\t\tif (!a || (c > 0 && a < c)|| (c < 0 && a <-c)){\r\n\t\t\ta=c;\r\n\t\t\ts=p / 4;\r\n\t\t}else s=p / Ease.PI2 *Math.asin(c / a);\r\n\t\treturn-(a *Math.pow(2,10 *(t-=1))*Math.sin((t *d-s)*Ease.PI2 / p))+b;\r\n\t}\r\n\r\n\tEase.elasticInOut=function(t,b,c,d,a,p){\r\n\t\t(a===void 0)&& (a=0);\r\n\t\t(p===void 0)&& (p=0);\r\n\t\tvar s;\r\n\t\tif (t==0)return b;\r\n\t\tif ((t /=d *0.5)==2)return b+c;\r\n\t\tif (!p)p=d *(.3 *1.5);\r\n\t\tif (!a || (c > 0 && a < c)|| (c < 0 && a <-c)){\r\n\t\t\ta=c;\r\n\t\t\ts=p / 4;\r\n\t\t}else s=p / Ease.PI2 *Math.asin(c / a);\r\n\t\tif (t < 1)return-.5 *(a *Math.pow(2,10 *(t-=1))*Math.sin((t *d-s)*Ease.PI2 / p))+b;\r\n\t\treturn a *Math.pow(2,-10 *(t-=1))*Math.sin((t *d-s)*Ease.PI2 / p)*.5+c+b;\r\n\t}\r\n\r\n\tEase.elasticOut=function(t,b,c,d,a,p){\r\n\t\t(a===void 0)&& (a=0);\r\n\t\t(p===void 0)&& (p=0);\r\n\t\tvar s;\r\n\t\tif (t==0)return b;\r\n\t\tif ((t /=d)==1)return b+c;\r\n\t\tif (!p)p=d *.3;\r\n\t\tif (!a || (c > 0 && a < c)|| (c < 0 && a <-c)){\r\n\t\t\ta=c;\r\n\t\t\ts=p / 4;\r\n\t\t}else s=p / Ease.PI2 *Math.asin(c / a);\r\n\t\treturn (a *Math.pow(2,-10 *t)*Math.sin((t *d-s)*Ease.PI2 / p)+c+b);\r\n\t}\r\n\r\n\tEase.strongIn=function(t,b,c,d){\r\n\t\treturn c *(t /=d)*t *t *t *t+b;\r\n\t}\r\n\r\n\tEase.strongInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *t *t *t *t *t+b;\r\n\t\treturn c *0.5 *((t-=2)*t *t *t *t+2)+b;\r\n\t}\r\n\r\n\tEase.strongOut=function(t,b,c,d){\r\n\t\treturn c *((t=t / d-1)*t *t *t *t+1)+b;\r\n\t}\r\n\r\n\tEase.sineInOut=function(t,b,c,d){\r\n\t\treturn-c *0.5 *(Math.cos(Math.PI *t / d)-1)+b;\r\n\t}\r\n\r\n\tEase.sineIn=function(t,b,c,d){\r\n\t\treturn-c *Math.cos(t / d *Ease.HALF_PI)+c+b;\r\n\t}\r\n\r\n\tEase.sineOut=function(t,b,c,d){\r\n\t\treturn c *Math.sin(t / d *Ease.HALF_PI)+b;\r\n\t}\r\n\r\n\tEase.quintIn=function(t,b,c,d){\r\n\t\treturn c *(t /=d)*t *t *t *t+b;\r\n\t}\r\n\r\n\tEase.quintInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *t *t *t *t *t+b;\r\n\t\treturn c *0.5 *((t-=2)*t *t *t *t+2)+b;\r\n\t}\r\n\r\n\tEase.quintOut=function(t,b,c,d){\r\n\t\treturn c *((t=t / d-1)*t *t *t *t+1)+b;\r\n\t}\r\n\r\n\tEase.quartIn=function(t,b,c,d){\r\n\t\treturn c *(t /=d)*t *t *t+b;\r\n\t}\r\n\r\n\tEase.quartInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *t *t *t *t+b;\r\n\t\treturn-c *0.5 *((t-=2)*t *t *t-2)+b;\r\n\t}\r\n\r\n\tEase.quartOut=function(t,b,c,d){\r\n\t\treturn-c *((t=t / d-1)*t *t *t-1)+b;\r\n\t}\r\n\r\n\tEase.cubicIn=function(t,b,c,d){\r\n\t\treturn c *(t /=d)*t *t+b;\r\n\t}\r\n\r\n\tEase.cubicInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *t *t *t+b;\r\n\t\treturn c *0.5 *((t-=2)*t *t+2)+b;\r\n\t}\r\n\r\n\tEase.cubicOut=function(t,b,c,d){\r\n\t\treturn c *((t=t / d-1)*t *t+1)+b;\r\n\t}\r\n\r\n\tEase.quadIn=function(t,b,c,d){\r\n\t\treturn c *(t /=d)*t+b;\r\n\t}\r\n\r\n\tEase.quadInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *t *t+b;\r\n\t\treturn-c *0.5 *((--t)*(t-2)-1)+b;\r\n\t}\r\n\r\n\tEase.quadOut=function(t,b,c,d){\r\n\t\treturn-c *(t /=d)*(t-2)+b;\r\n\t}\r\n\r\n\tEase.expoIn=function(t,b,c,d){\r\n\t\treturn (t==0)? b :c *Math.pow(2,10 *(t / d-1))+b-c *0.001;\r\n\t}\r\n\r\n\tEase.expoInOut=function(t,b,c,d){\r\n\t\tif (t==0)return b;\r\n\t\tif (t==d)return b+c;\r\n\t\tif ((t /=d *0.5)< 1)return c *0.5 *Math.pow(2,10 *(t-1))+b;\r\n\t\treturn c *0.5 *(-Math.pow(2,-10 *--t)+2)+b;\r\n\t}\r\n\r\n\tEase.expoOut=function(t,b,c,d){\r\n\t\treturn (t==d)? b+c :c *(-Math.pow(2,-10 *t / d)+1)+b;\r\n\t}\r\n\r\n\tEase.circIn=function(t,b,c,d){\r\n\t\treturn-c *(Math.sqrt(1-(t /=d)*t)-1)+b;\r\n\t}\r\n\r\n\tEase.circInOut=function(t,b,c,d){\r\n\t\tif ((t /=d *0.5)< 1)return-c *0.5 *(Math.sqrt(1-t *t)-1)+b;\r\n\t\treturn c *0.5 *(Math.sqrt(1-(t-=2)*t)+1)+b;\r\n\t}\r\n\r\n\tEase.circOut=function(t,b,c,d){\r\n\t\treturn c *Math.sqrt(1-(t=t / d-1)*t)+b;\r\n\t}\r\n\r\n\t__static(Ease,\r\n\t['HALF_PI',function(){return this.HALF_PI=Math.PI *0.5;},'PI2',function(){return this.PI2=Math.PI *2;}\r\n\t]);\r\n\treturn Ease;\r\n})()\r\n\r\n\r\n/**\r\n*鼠标点击区域，可以设置绘制一系列矢量图作为点击区域和非点击区域（目前只支持圆形，矩形，多边形）\r\n*/\r\n//class laya.utils.HitArea\r\nvar HitArea=(function(){\r\n\tfunction HitArea(){\r\n\t\t/**@private */\r\n\t\tthis._hit=null;\r\n\t\t/**@private */\r\n\t\tthis._unHit=null;\r\n\t}\r\n\r\n\t__class(HitArea,'laya.utils.HitArea');\r\n\tvar __proto=HitArea.prototype;\r\n\t/**\r\n\t*是否包含某个点\r\n\t*@param x x坐标\r\n\t*@param y y坐标\r\n\t*@return 是否点击到\r\n\t*/\r\n\t__proto.isHit=function(x,y){\r\n\t\tif (!HitArea.isHitGraphic(x,y,this.hit))return false;\r\n\t\treturn !HitArea.isHitGraphic(x,y,this.unHit);\r\n\t}\r\n\r\n\t/**\r\n\t*检测对象是否包含指定的点。\r\n\t*@param x 点的 X 轴坐标值（水平位置）。\r\n\t*@param y 点的 Y 轴坐标值（垂直位置）。\r\n\t*@return 如果包含指定的点，则值为 true；否则为 false。\r\n\t*/\r\n\t__proto.contains=function(x,y){\r\n\t\treturn this.isHit(x,y);\r\n\t}\r\n\r\n\t/**\r\n\t*可点击区域，可以设置绘制一系列矢量图作为点击区域（目前只支持圆形，矩形，多边形）\r\n\t*/\r\n\t__getset(0,__proto,'hit',function(){\r\n\t\tif (!this._hit)this._hit=new Graphics();\r\n\t\treturn this._hit;\r\n\t\t},function(value){\r\n\t\tthis._hit=value;\r\n\t});\r\n\r\n\t/**\r\n\t*不可点击区域，可以设置绘制一系列矢量图作为非点击区域（目前只支持圆形，矩形，多边形）\r\n\t*/\r\n\t__getset(0,__proto,'unHit',function(){\r\n\t\tif (!this._unHit)this._unHit=new Graphics();\r\n\t\treturn this._unHit;\r\n\t\t},function(value){\r\n\t\tthis._unHit=value;\r\n\t});\r\n\r\n\tHitArea.isHitGraphic=function(x,y,graphic){\r\n\t\tif (!graphic)return false;\r\n\t\tvar cmds;\r\n\t\tcmds=graphic.cmds;\r\n\t\tif (!cmds && graphic._one){\r\n\t\t\tcmds=HitArea._cmds;\r\n\t\t\tcmds.length=1;\r\n\t\t\tcmds[0]=graphic._one;\r\n\t\t}\r\n\t\tif (!cmds)return false;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=cmds.length;\r\n\t\tvar cmd;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tcmd=cmds[i];\r\n\t\t\tif (!cmd)continue ;\r\n\t\t\tvar context=Render._context;\r\n\t\t\tswitch (cmd.callee){\r\n\t\t\t\tcase context._translate:\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\tx-=cmd[0];\r\n\t\t\t\t\ty-=cmd[1];\r\n\t\t\t\tdefault :\r\n\t\t\t\t}\r\n\t\t\tif (HitArea.isHitCmd(x,y,cmd))return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tHitArea.isHitCmd=function(x,y,cmd){\r\n\t\tif (!cmd)return false;\r\n\t\tvar context=Render._context;\r\n\t\tvar rst=false;\r\n\t\tswitch (cmd[\"callee\"]){\r\n\t\t\tcase context._drawRect:\r\n\t\t\tcase 13:\r\n\t\t\t\tHitArea._rec.setTo(cmd[0],cmd[1],cmd[2],cmd[3]);\r\n\t\t\t\trst=HitArea._rec.contains(x,y);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase context._drawCircle:\r\n\t\t\tcase context._fillCircle:\r\n\t\t\tcase 14:;\r\n\t\t\t\tvar d=NaN;\r\n\t\t\t\tx-=cmd[0];\r\n\t\t\t\ty-=cmd[1];\r\n\t\t\t\td=x *x+y *y;\r\n\t\t\t\trst=d < cmd[2] *cmd[2];\r\n\t\t\t\tbreak ;\r\n\t\t\tcase context._drawPoly:\r\n\t\t\tcase 18:\r\n\t\t\t\tx-=cmd[0];\r\n\t\t\t\ty-=cmd[1];\r\n\t\t\t\trst=HitArea.ptInPolygon(x,y,cmd[2]);\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tHitArea.ptInPolygon=function(x,y,areaPoints){\r\n\t\tvar p;\r\n\t\tp=HitArea._ptPoint;\r\n\t\tp.setTo(x,y);\r\n\t\tvar nCross=0;\r\n\t\tvar p1x=NaN,p1y=NaN,p2x=NaN,p2y=NaN;\r\n\t\tvar len=0;\r\n\t\tlen=areaPoints.length;\r\n\t\tfor (var i=0;i < len;i+=2){\r\n\t\t\tp1x=areaPoints[i];\r\n\t\t\tp1y=areaPoints[i+1];\r\n\t\t\tp2x=areaPoints[(i+2)% len];\r\n\t\t\tp2y=areaPoints[(i+3)% len];\r\n\t\t\tif (p1y==p2y)\r\n\t\t\t\tcontinue ;\r\n\t\t\tif (p.y < Math.min(p1y,p2y))\r\n\t\t\t\tcontinue ;\r\n\t\t\tif (p.y >=Math.max(p1y,p2y))\r\n\t\t\t\tcontinue ;\r\n\t\t\tvar tx=(p.y-p1y)*(p2x-p1x)/ (p2y-p1y)+p1x;\r\n\t\t\tif (tx > p.x){\r\n\t\t\t\tnCross++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (nCross % 2==1);\r\n\t}\r\n\r\n\tHitArea._cmds=[];\r\n\t__static(HitArea,\r\n\t['_rec',function(){return this._rec=new Rectangle();},'_ptPoint',function(){return this._ptPoint=new Point();}\r\n\t]);\r\n\treturn HitArea;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>HTMLChar</code> 是一个 HTML 字符类。\r\n*/\r\n//class laya.utils.HTMLChar\r\nvar HTMLChar=(function(){\r\n\tfunction HTMLChar(char,w,h,style){\r\n\t\t//this._sprite=null;\r\n\t\t//this._x=NaN;\r\n\t\t//this._y=NaN;\r\n\t\t//this._w=NaN;\r\n\t\t//this._h=NaN;\r\n\t\t/**表示是否是正常单词(英文|.|数字)。*/\r\n\t\t//this.isWord=false;\r\n\t\t/**字符。*/\r\n\t\t//this.char=null;\r\n\t\t/**字符数量。*/\r\n\t\t//this.charNum=NaN;\r\n\t\t/**CSS 样式。*/\r\n\t\t//this.style=null;\r\n\t\tthis.char=char;\r\n\t\tthis.charNum=char.charCodeAt(0);\r\n\t\tthis._x=this._y=0;\r\n\t\tthis.width=w;\r\n\t\tthis.height=h;\r\n\t\tthis.style=style;\r\n\t\tthis.isWord=!HTMLChar._isWordRegExp.test(char);\r\n\t}\r\n\r\n\t__class(HTMLChar,'laya.utils.HTMLChar');\r\n\tvar __proto=HTMLChar.prototype;\r\n\tLaya.imps(__proto,{\"laya.display.ILayout\":true})\r\n\t/**\r\n\t*设置与此对象绑定的显示对象 <code>Sprite</code> 。\r\n\t*@param sprite 显示对象 <code>Sprite</code> 。\r\n\t*/\r\n\t__proto.setSprite=function(sprite){\r\n\t\tthis._sprite=sprite;\r\n\t}\r\n\r\n\t/**\r\n\t*获取与此对象绑定的显示对象 <code>Sprite</code>。\r\n\t*@return\r\n\t*/\r\n\t__proto.getSprite=function(){\r\n\t\treturn this._sprite;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._isChar=function(){\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getCSSStyle=function(){\r\n\t\treturn this.style;\r\n\t}\r\n\r\n\t/**\r\n\t*宽度。\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\treturn this._w;\r\n\t\t},function(value){\r\n\t\tthis._w=value;\r\n\t});\r\n\r\n\t/**\r\n\t*此对象存储的 X 轴坐标值。\r\n\t*当设置此值时，如果此对象有绑定的 Sprite 对象，则改变 Sprite 对象的属性 x 的值。\r\n\t*/\r\n\t__getset(0,__proto,'x',function(){\r\n\t\treturn this._x;\r\n\t\t},function(value){\r\n\t\tif (this._sprite){\r\n\t\t\tthis._sprite.x=value;\r\n\t\t}\r\n\t\tthis._x=value;\r\n\t});\r\n\r\n\t/**\r\n\t*此对象存储的 Y 轴坐标值。\r\n\t*当设置此值时，如果此对象有绑定的 Sprite 对象，则改变 Sprite 对象的属性 y 的值。\r\n\t*/\r\n\t__getset(0,__proto,'y',function(){\r\n\t\treturn this._y;\r\n\t\t},function(value){\r\n\t\tif (this._sprite){\r\n\t\t\tthis._sprite.y=value;\r\n\t\t}\r\n\t\tthis._y=value;\r\n\t});\r\n\r\n\t/**\r\n\t*高度。\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\treturn this._h;\r\n\t\t},function(value){\r\n\t\tthis._h=value;\r\n\t});\r\n\r\n\t__static(HTMLChar,\r\n\t['_isWordRegExp',function(){return this._isWordRegExp=new RegExp(\"[\\\\w\\.]\",\"\");}\r\n\t]);\r\n\treturn HTMLChar;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Log</code> 类用于在界面内显示日志记录信息。\r\n*/\r\n//class laya.utils.Log\r\nvar Log=(function(){\r\n\tfunction Log(){}\r\n\t__class(Log,'laya.utils.Log');\r\n\tLog.enable=function(){\r\n\t\tif (!Log._logdiv){\r\n\t\t\tLog._logdiv=Browser.window.document.createElement('div');\r\n\t\t\tBrowser.window.document.body.appendChild(Log._logdiv);\r\n\t\t\tLog._logdiv.style.cssText=\"pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;\";\r\n\t\t}\r\n\t}\r\n\r\n\tLog.toggle=function(){\r\n\t\tvar style=Log._logdiv.style;\r\n\t\tif (style.width==\"1px\"){\r\n\t\t\tstyle.width=style.height=\"50%\";\r\n\t\t\t}else {\r\n\t\t\tstyle.width=style.height=\"1px\";\r\n\t\t}\r\n\t}\r\n\r\n\tLog.print=function(value){\r\n\t\tif (Log._logdiv){\r\n\t\t\tif (Log._count >=Log.maxCount)Log.clear();\r\n\t\t\tLog._count++;\r\n\t\t\tLog._logdiv.innerText+=value+\"\\n\";\r\n\t\t\tLog._logdiv.scrollTop=Log._logdiv.scrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tLog.clear=function(){\r\n\t\tLog._logdiv.innerText=\"\";\r\n\t\tLog._count=0;\r\n\t}\r\n\r\n\tLog._logdiv=null;\r\n\tLog._count=0;\r\n\tLog.maxCount=20;\r\n\treturn Log;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Mouse</code> 类用于控制鼠标光标。\r\n*/\r\n//class laya.utils.Mouse\r\nvar Mouse=(function(){\r\n\tfunction Mouse(){}\r\n\t__class(Mouse,'laya.utils.Mouse');\r\n\t/**\r\n\t*设置鼠标样式\r\n\t*@param cursorStr\r\n\t*例如auto move no-drop col-resize\r\n\t*all-scroll pointer not-allowed row-resize\r\n\t*crosshair progress e-resize ne-resize\r\n\t*default text n-resize nw-resize\r\n\t*help vertical-text s-resize se-resize\r\n\t*inherit wait w-resize sw-resize\r\n\t*\r\n\t*/\r\n\t__getset(1,Mouse,'cursor',function(){\r\n\t\treturn Mouse._style.cursor;\r\n\t\t},function(cursorStr){\r\n\t\tMouse._style.cursor=cursorStr;\r\n\t});\r\n\r\n\tMouse.hide=function(){\r\n\t\tif (Mouse.cursor !=\"none\"){\r\n\t\t\tMouse._preCursor=Mouse.cursor;\r\n\t\t\tMouse.cursor=\"none\";\r\n\t\t}\r\n\t}\r\n\r\n\tMouse.show=function(){\r\n\t\tif (Mouse.cursor==\"none\"){\r\n\t\t\tif (Mouse._preCursor){\r\n\t\t\t\tMouse.cursor=Mouse._preCursor;\r\n\t\t\t\t}else {\r\n\t\t\t\tMouse.cursor=\"auto\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tMouse._preCursor=null;\r\n\t__static(Mouse,\r\n\t['_style',function(){return this._style=Browser.document.body.style;}\r\n\t]);\r\n\treturn Mouse;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>Pool</code> 是对象池类，用于对象的存贮、重复使用。</p>\r\n*<p>合理使用对象池，可以有效减少对象创建的开销，避免频繁的垃圾回收，从而优化游戏流畅度。</p>\r\n*/\r\n//class laya.utils.Pool\r\nvar Pool=(function(){\r\n\tfunction Pool(){}\r\n\t__class(Pool,'laya.utils.Pool');\r\n\tPool.getPoolBySign=function(sign){\r\n\t\treturn Pool._poolDic[sign] || (Pool._poolDic[sign]=[]);\r\n\t}\r\n\r\n\tPool.clearBySign=function(sign){\r\n\t\tif (Pool._poolDic[sign])Pool._poolDic[sign].length=0;\r\n\t}\r\n\r\n\tPool.recover=function(sign,item){\r\n\t\tif (item[\"__InPool\"])return;\r\n\t\titem[\"__InPool\"]=true;\r\n\t\tPool.getPoolBySign(sign).push(item);\r\n\t}\r\n\r\n\tPool.getItemByClass=function(sign,cls){\r\n\t\tvar pool=Pool.getPoolBySign(sign);\r\n\t\tvar rst=pool.length ? pool.pop():new cls();\r\n\t\trst[\"__InPool\"]=false;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tPool.getItemByCreateFun=function(sign,createFun){\r\n\t\tvar pool=Pool.getPoolBySign(sign);\r\n\t\tvar rst=pool.length ? pool.pop():createFun();\r\n\t\trst[\"__InPool\"]=false;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tPool.getItem=function(sign){\r\n\t\tvar pool=Pool.getPoolBySign(sign);\r\n\t\tvar rst=pool.length ? pool.pop():null;\r\n\t\tif (rst){\r\n\t\t\trst[\"__InPool\"]=false;\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tPool._poolDic={};\r\n\tPool.InPoolSign=\"__InPool\";\r\n\treturn Pool;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*基于个数的对象缓存管理器\r\n*/\r\n//class laya.utils.PoolCache\r\nvar PoolCache=(function(){\r\n\tfunction PoolCache(){\r\n\t\t/**\r\n\t\t*对象在Pool中的标识\r\n\t\t*/\r\n\t\tthis.sign=null;\r\n\t\t/**\r\n\t\t*允许缓存的最大数量\r\n\t\t*/\r\n\t\tthis.maxCount=1000;\r\n\t}\r\n\r\n\t__class(PoolCache,'laya.utils.PoolCache');\r\n\tvar __proto=PoolCache.prototype;\r\n\t/**\r\n\t*获取缓存的对象列表\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.getCacheList=function(){\r\n\t\treturn Pool.getPoolBySign(this.sign);\r\n\t}\r\n\r\n\t/**\r\n\t*尝试清理缓存\r\n\t*@param force 是否强制清理\r\n\t*\r\n\t*/\r\n\t__proto.tryDispose=function(force){\r\n\t\tvar list;\r\n\t\tlist=Pool.getPoolBySign(this.sign);\r\n\t\tif (list.length > this.maxCount){\r\n\t\t\tlist.splice(this.maxCount,list.length-this.maxCount);\r\n\t\t}\r\n\t}\r\n\r\n\tPoolCache.addPoolCacheManager=function(sign,maxCount){\r\n\t\t(maxCount===void 0)&& (maxCount=100);\r\n\t\tvar cache;\r\n\t\tcache=new PoolCache();\r\n\t\tcache.sign=sign;\r\n\t\tcache.maxCount=maxCount;\r\n\t\tCacheManager.regCacheByFunction(Utils.bind(cache.tryDispose,cache),Utils.bind(cache.getCacheList,cache));\r\n\t}\r\n\r\n\treturn PoolCache;\r\n})()\r\n\r\n\r\n/**\r\n*<p> <code>Stat</code> 是一个性能统计面板，可以实时更新相关的性能参数。</p>\r\n*<p>参与统计的性能参数如下（所有参数都是每大约1秒进行更新）：<br/>\r\n*FPS(Canvas)/FPS(WebGL)：Canvas 模式或者 WebGL 模式下的帧频，也就是每秒显示的帧数，值越高、越稳定，感觉越流畅；<br/>\r\n*Sprite：统计所有渲染节点（包括容器）数量，它的大小会影响引擎进行节点遍历、数据组织和渲染的效率。其值越小，游戏运行效率越高；<br/>\r\n*DrawCall：此值是决定性能的重要指标，其值越小，游戏运行效率越高。Canvas模式下表示每大约1秒的图像绘制次数；WebGL模式下表示每大约1秒的渲染提交批次，每次准备数据并通知GPU渲染绘制的过程称为1次DrawCall，在每次DrawCall中除了在通知GPU的渲染上比较耗时之外，切换材质与shader也是非常耗时的操作；<br/>\r\n*CurMem：Canvas模式下，表示内存占用大小，值越小越好，过高会导致游戏闪退；WebGL模式下，表示内存与显存的占用，值越小越好；<br/>\r\n*Shader：是 WebGL 模式独有的性能指标，表示每大约1秒 Shader 提交次数，值越小越好；<br/>\r\n*Canvas：由三个数值组成，只有设置 CacheAs 后才会有值，默认为0/0/0。从左到右数值的意义分别为：每帧重绘的画布数量 / 缓存类型为\"normal\"类型的画布数量 / 缓存类型为\"bitmap\"类型的画布数量。</p>\r\n*/\r\n//class laya.utils.Stat\r\nvar Stat=(function(){\r\n\tfunction Stat(){}\r\n\t__class(Stat,'laya.utils.Stat');\r\n\t/**\r\n\t*点击性能统计显示区域的处理函数。\r\n\t*/\r\n\t__getset(1,Stat,'onclick',null,function(fn){\r\n\t\tif (Stat._sp){\r\n\t\t\tStat._sp.on(\"click\",Stat._sp,fn);\r\n\t\t}\r\n\t\tif (Stat._canvas){\r\n\t\t\tStat._canvas.source.onclick=fn;\r\n\t\t\tStat._canvas.source.style.pointerEvents='';\r\n\t\t}\r\n\t});\r\n\r\n\tStat.show=function(x,y){\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\tif (Render.isConchApp){\r\n\t\t\tBrowser.window.conch.showFPS && Browser.window.conch.showFPS(x,y);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!Browser.onMiniGame)Stat._useCanvas=true;\r\n\t\tStat._show=true;\r\n\t\tStat._fpsData.length=60;\r\n\t\tStat._view[0]={title:\"FPS(Canvas)\",value:\"_fpsStr\",color:\"yellow\",units:\"int\"};\r\n\t\tStat._view[1]={title:\"Sprite\",value:\"_spriteStr\",color:\"white\",units:\"int\"};\r\n\t\tStat._view[2]={title:\"DrawCall\",value:\"drawCall\",color:\"white\",units:\"int\"};\r\n\t\tStat._view[3]={title:\"CurMem\",value:\"currentMemorySize\",color:\"yellow\",units:\"M\"};\r\n\t\tif (Render.isWebGL){\r\n\t\t\tStat._view[4]={title:\"Shader\",value:\"shaderCall\",color:\"white\",units:\"int\"};\r\n\t\t\tif (!Render.is3DMode){\r\n\t\t\t\tStat._view[0].title=\"FPS(WebGL)\";\r\n\t\t\t\tStat._view[5]={title:\"Canvas\",value:\"_canvasStr\",color:\"white\",units:\"int\"};\r\n\t\t\t\t}else {\r\n\t\t\t\tStat._view[0].title=\"FPS(3D)\";\r\n\t\t\t\tStat._view[5]={title:\"TriFaces\",value:\"trianglesFaces\",color:\"white\",units:\"int\"};\r\n\t\t\t\tStat._view[6]={title:\"treeNodeColl\",value:\"treeNodeCollision\",color:\"white\",units:\"int\"};\r\n\t\t\t\tStat._view[7]={title:\"treeSpriteColl\",value:\"treeSpriteCollision\",color:\"white\",units:\"int\"};\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tStat._view[4]={title:\"Canvas\",value:\"_canvasStr\",color:\"white\",units:\"int\"};\r\n\t\t}\r\n\t\tif (Stat._useCanvas){\r\n\t\t\tStat.createUIPre(x,y);\r\n\t\t}else\r\n\t\tStat.createUI(x,y);\r\n\t\tStat.enable();\r\n\t}\r\n\r\n\tStat.createUIPre=function(x,y){\r\n\t\tvar pixel=Browser.pixelRatio;\r\n\t\tStat._width=pixel *130;\r\n\t\tStat._vx=pixel *75;\r\n\t\tStat._height=pixel *(Stat._view.length *12+3 *pixel)+4;\r\n\t\tStat._fontSize=12 *pixel;\r\n\t\tfor (var i=0;i < Stat._view.length;i++){\r\n\t\t\tStat._view[i].x=4;\r\n\t\t\tStat._view[i].y=i *Stat._fontSize+2 *pixel;\r\n\t\t}\r\n\t\tif (!Stat._canvas){\r\n\t\t\tStat._canvas=new HTMLCanvas('2D');\r\n\t\t\tStat._canvas.size(Stat._width,Stat._height);\r\n\t\t\tStat._ctx=Stat._canvas.getContext('2d');\r\n\t\t\tStat._ctx.textBaseline=\"top\";\r\n\t\t\tStat._ctx.font=Stat._fontSize+\"px Sans-serif\";\r\n\t\t\tStat._canvas.source.style.cssText=\"pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:\"+x+\"px;top:\"+y+\"px;width:\"+(Stat._width / pixel)+\"px;height:\"+(Stat._height / pixel)+\"px;\";\r\n\t\t}\r\n\t\tStat._first=true;\r\n\t\tStat.loop();\r\n\t\tStat._first=false;\r\n\t\tBrowser.container.appendChild(Stat._canvas.source);\r\n\t}\r\n\r\n\tStat.createUI=function(x,y){\r\n\t\tvar stat=Stat._sp;\r\n\t\tvar pixel=Browser.pixelRatio;\r\n\t\tif (!stat){\r\n\t\t\tstat=new Sprite();\r\n\t\t\tStat._leftText=new Text();\r\n\t\t\tStat._leftText.pos(5,5);\r\n\t\t\tStat._leftText.color=\"#ffffff\";\r\n\t\t\tstat.addChild(Stat._leftText);\r\n\t\t\tStat._txt=new Text();\r\n\t\t\tStat._txt.pos(80*pixel,5);\r\n\t\t\tStat._txt.color=\"#ffffff\";\r\n\t\t\tstat.addChild(Stat._txt);\r\n\t\t\tStat._sp=stat;\r\n\t\t}\r\n\t\tstat.pos(x,y);\r\n\t\tvar text=\"\";\r\n\t\tfor (var i=0;i < Stat._view.length;i++){\r\n\t\t\tvar one=Stat._view[i];\r\n\t\t\ttext+=one.title+\"\\n\";\r\n\t\t}\r\n\t\tStat._leftText.text=text;\r\n\t\tvar width=pixel *138;\r\n\t\tvar height=pixel *(Stat._view.length *12+3 *pixel)+4;\r\n\t\tStat._txt.fontSize=Stat._fontSize *pixel;\r\n\t\tStat._leftText.fontSize=Stat._fontSize *pixel;\r\n\t\tstat.size(width,height);\r\n\t\tstat.graphics.clear();\r\n\t\tstat.graphics.setAlpha(0.5);\r\n\t\tstat.graphics.drawRect(0,0,width,height,\"#999999\");\r\n\t\tstat.graphics.setAlpha(1);\r\n\t\tStat.loop();\r\n\t}\r\n\r\n\tStat.enable=function(){\r\n\t\tLaya.timer.frameLoop(1,Stat,Stat.loop);\r\n\t}\r\n\r\n\tStat.hide=function(){\r\n\t\tStat._show=false;\r\n\t\tLaya.timer.clear(Stat,Stat.loop);\r\n\t\tif (Stat._canvas){\r\n\t\t\tBrowser.removeElement(Stat._canvas.source);\r\n\t\t}\r\n\t}\r\n\r\n\tStat.clear=function(){\r\n\t\tStat.trianglesFaces=Stat.drawCall=Stat.shaderCall=Stat.spriteCount=Stat.spriteRenderUseCacheCount=Stat.treeNodeCollision=Stat.treeSpriteCollision=Stat.canvasNormal=Stat.canvasBitmap=Stat.canvasReCache=0;\r\n\t}\r\n\r\n\tStat.loop=function(){\r\n\t\tStat._count++;\r\n\t\tvar timer=Browser.now();\r\n\t\tif (timer-Stat._timer < 1000)return;\r\n\t\tvar count=Stat._count;\r\n\t\tStat.FPS=Math.round((count *1000)/ (timer-Stat._timer));\r\n\t\tif (Stat._show){\r\n\t\t\tStat.trianglesFaces=Math.round(Stat.trianglesFaces / count);\r\n\t\t\tif (!Stat._useCanvas){\r\n\t\t\t\tStat.drawCall=Math.round(Stat.drawCall / count)-2;\r\n\t\t\t\tStat.shaderCall=Math.round(Stat.shaderCall / count)-4;\r\n\t\t\t\tStat.spriteCount=Math.round(Stat.spriteCount / count)-4;\r\n\t\t\t\t}else{\r\n\t\t\t\tStat.drawCall=Math.round(Stat.drawCall / count)-2;\r\n\t\t\t\tStat.shaderCall=Math.round(Stat.shaderCall / count);\r\n\t\t\t\tStat.spriteCount=Math.round(Stat.spriteCount / count)-1;\r\n\t\t\t}\r\n\t\t\tStat.spriteRenderUseCacheCount=Math.round(Stat.spriteRenderUseCacheCount / count);\r\n\t\t\tStat.canvasNormal=Math.round(Stat.canvasNormal / count);\r\n\t\t\tStat.canvasBitmap=Math.round(Stat.canvasBitmap / count);\r\n\t\t\tStat.canvasReCache=Math.ceil(Stat.canvasReCache / count);\r\n\t\t\tStat.treeNodeCollision=Math.round(Stat.treeNodeCollision / count);\r\n\t\t\tStat.treeSpriteCollision=Math.round(Stat.treeSpriteCollision / count);\r\n\t\t\tvar delay=Stat.FPS > 0 ? Math.floor(1000 / Stat.FPS).toString():\" \";\r\n\t\t\tStat._fpsStr=Stat.FPS+(Stat.renderSlow ? \" slow\" :\"\")+\" \"+delay;\r\n\t\t\tStat._spriteStr=Stat.spriteCount+(Stat.spriteRenderUseCacheCount ? (\"/\"+Stat.spriteRenderUseCacheCount):'');\r\n\t\t\tStat._canvasStr=Stat.canvasReCache+\"/\"+Stat.canvasNormal+\"/\"+Stat.canvasBitmap;\r\n\t\t\tStat.currentMemorySize=ResourceManager.systemResourceManager.memorySize;\r\n\t\t\tif (Stat._useCanvas){\r\n\t\t\t\tStat.renderInfoPre();\r\n\t\t\t}else\r\n\t\t\tStat.renderInfo();\r\n\t\t\tStat.clear();\r\n\t\t}\r\n\t\tStat._count=0;\r\n\t\tStat._timer=timer;\r\n\t}\r\n\r\n\tStat.renderInfoPre=function(){\r\n\t\tif (Stat._canvas){\r\n\t\t\tvar ctx=Stat._ctx;\r\n\t\t\tctx.clearRect(Stat._first ? 0 :Stat._vx,0,Stat._width,Stat._height);\r\n\t\t\tfor (var i=0;i < Stat._view.length;i++){\r\n\t\t\t\tvar one=Stat._view[i];\r\n\t\t\t\tif (Stat._first){\r\n\t\t\t\t\tctx.fillStyle=\"white\";\r\n\t\t\t\t\tctx.fillText(one.title,one.x,one.y,null,null,null);\r\n\t\t\t\t}\r\n\t\t\t\tctx.fillStyle=one.color;\r\n\t\t\t\tvar value=Stat[one.value];\r\n\t\t\t\t(one.units==\"M\")&& (value=Math.floor(value / (1024 *1024)*100)/ 100+\" M\");\r\n\t\t\t\tctx.fillText(value+\"\",one.x+Stat._vx,one.y,null,null,null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tStat.renderInfo=function(){\r\n\t\tvar text=\"\";\r\n\t\tfor (var i=0;i < Stat._view.length;i++){\r\n\t\t\tvar one=Stat._view[i];\r\n\t\t\tvar value=Stat[one.value];\r\n\t\t\t(one.units==\"M\")&& (value=Math.floor(value / (1024 *1024)*100)/ 100+\" M\");\r\n\t\t\t(one.units==\"K\")&& (value=Math.floor(value / (1024)*100)/ 100+\" K\");\r\n\t\t\ttext+=value+\"\\n\";\r\n\t\t}\r\n\t\tStat._txt.text=text;\r\n\t}\r\n\r\n\tStat.FPS=0;\r\n\tStat.loopCount=0;\r\n\tStat.shaderCall=0;\r\n\tStat.drawCall=0;\r\n\tStat.trianglesFaces=0;\r\n\tStat.spriteCount=0;\r\n\tStat.spriteRenderUseCacheCount=0;\r\n\tStat.treeNodeCollision=0;\r\n\tStat.treeSpriteCollision=0;\r\n\tStat.canvasNormal=0;\r\n\tStat.canvasBitmap=0;\r\n\tStat.canvasReCache=0;\r\n\tStat.renderSlow=false;\r\n\tStat.currentMemorySize=0;\r\n\tStat._fpsStr=null;\r\n\tStat._canvasStr=null;\r\n\tStat._spriteStr=null;\r\n\tStat._fpsData=[];\r\n\tStat._timer=0;\r\n\tStat._count=0;\r\n\tStat._view=[];\r\n\tStat._fontSize=12;\r\n\tStat._txt=null;\r\n\tStat._leftText=null;\r\n\tStat._sp=null;\r\n\tStat._show=false;\r\n\tStat._useCanvas=false;\r\n\tStat._canvas=null;\r\n\tStat._ctx=null;\r\n\tStat._first=false;\r\n\tStat._vx=NaN;\r\n\tStat._width=0;\r\n\tStat._height=100;\r\n\treturn Stat;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*<code>StringKey</code> 类用于存取字符串对应的数字。\r\n*/\r\n//class laya.utils.StringKey\r\nvar StringKey=(function(){\r\n\tfunction StringKey(){\r\n\t\tthis._strsToID={};\r\n\t\tthis._idToStrs=[];\r\n\t\tthis._length=0;\r\n\t}\r\n\r\n\t__class(StringKey,'laya.utils.StringKey');\r\n\tvar __proto=StringKey.prototype;\r\n\t/**\r\n\t*添加一个字符。\r\n\t*@param str 字符，将作为key 存储相应生成的数字。\r\n\t*@return 此字符对应的数字。\r\n\t*/\r\n\t__proto.add=function(str){\r\n\t\tvar index=this._strsToID[str];\r\n\t\tif (index !=null)return index;\r\n\t\tthis._idToStrs[this._length]=str;\r\n\t\treturn this._strsToID[str]=this._length++;\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定字符对应的ID。\r\n\t*@param str 字符。\r\n\t*@return 此字符对应的ID。\r\n\t*/\r\n\t__proto.getID=function(str){\r\n\t\tvar index=this._strsToID[str];\r\n\t\treturn index==null ?-1 :index;\r\n\t}\r\n\r\n\t/**\r\n\t*根据指定ID获取对应字符。\r\n\t*@param id ID。\r\n\t*@return 此id对应的字符。\r\n\t*/\r\n\t__proto.getName=function(id){\r\n\t\tvar str=this._idToStrs[id];\r\n\t\treturn str==null ? undefined :str;\r\n\t}\r\n\r\n\treturn StringKey;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Timer</code> 是时钟管理类。它是一个单例，不要手动实例化此类，应该通过 Laya.timer 访问。\r\n*/\r\n//class laya.utils.Timer\r\nvar Timer=(function(){\r\n\tvar TimerHandler;\r\n\tfunction Timer(){\r\n\t\t/**两帧之间的时间间隔,单位毫秒。*/\r\n\t\tthis._delta=0;\r\n\t\t/**时针缩放。*/\r\n\t\tthis.scale=1;\r\n\t\t/**当前的帧数。*/\r\n\t\tthis.currFrame=0;\r\n\t\t/**@private */\r\n\t\tthis._mid=1;\r\n\t\t/**@private */\r\n\t\tthis._map=[];\r\n\t\t/**@private */\r\n\t\tthis._laters=[];\r\n\t\t/**@private */\r\n\t\tthis._handlers=[];\r\n\t\t/**@private */\r\n\t\tthis._temp=[];\r\n\t\t/**@private */\r\n\t\tthis._count=0;\r\n\t\tthis.currTimer=this._now();\r\n\t\tthis._lastTimer=this._now();\r\n\t\tthis._init();\r\n\t}\r\n\r\n\t__class(Timer,'laya.utils.Timer');\r\n\tvar __proto=Timer.prototype;\r\n\t/**@private */\r\n\t__proto._init=function(){\r\n\t\tLaya.timer && Laya.timer.frameLoop(1,this,this._update);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._now=function(){\r\n\t\treturn /*__JS__ */Date.now();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*帧循环处理函数。\r\n\t*/\r\n\t__proto._update=function(){\r\n\t\tif (this.scale <=0){\r\n\t\t\tthis._lastTimer=this._now();\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar frame=this.currFrame=this.currFrame+this.scale;\r\n\t\tvar now=this._now();\r\n\t\tthis._delta=(now-this._lastTimer)*this.scale;\r\n\t\tvar timer=this.currTimer=this.currTimer+this._delta;\r\n\t\tthis._lastTimer=now;\r\n\t\tvar handlers=this._handlers;\r\n\t\tthis._count=0;\r\n\t\tfor (i=0,n=handlers.length;i < n;i++){\r\n\t\t\thandler=handlers[i];\r\n\t\t\tif (handler.method!==null){\r\n\t\t\t\tvar t=handler.userFrame ? frame :timer;\r\n\t\t\t\tif (t >=handler.exeTime){\r\n\t\t\t\t\tif (handler.repeat){\r\n\t\t\t\t\t\tif (!handler.jumpFrame){\r\n\t\t\t\t\t\t\thandler.exeTime+=handler.delay;\r\n\t\t\t\t\t\t\thandler.run(false);\r\n\t\t\t\t\t\t\tif (t > handler.exeTime){\r\n\t\t\t\t\t\t\t\thandler.exeTime+=Math.ceil((t-handler.exeTime)/ handler.delay)*handler.delay;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\t\twhile (t >=handler.exeTime){\r\n\t\t\t\t\t\t\t\thandler.exeTime+=handler.delay;\r\n\t\t\t\t\t\t\t\thandler.run(false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\thandler.run(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._count++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._count > 30 || frame % 200===0)this._clearHandlers();\r\n\t\tvar laters=this._laters;\r\n\t\tfor (var i=0,n=laters.length-1;i <=n;i++){\r\n\t\t\tvar handler=laters[i];\r\n\t\t\tif (handler.method!==null){\r\n\t\t\t\tthis._map[handler.key]=null;\r\n\t\t\t\thandler.run(false);\r\n\t\t\t}\r\n\t\t\tthis._recoverHandler(handler);\r\n\t\t\ti===n && (n=laters.length-1);\r\n\t\t}\r\n\t\tlaters.length=0;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._clearHandlers=function(){\r\n\t\tvar handlers=this._handlers;\r\n\t\tfor (var i=0,n=handlers.length;i < n;i++){\r\n\t\t\tvar handler=handlers[i];\r\n\t\t\tif (handler.method!==null)this._temp.push(handler);\r\n\t\t\telse this._recoverHandler(handler);\r\n\t\t}\r\n\t\tthis._handlers=this._temp;\r\n\t\tthis._temp=handlers;\r\n\t\tthis._temp.length=0;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._recoverHandler=function(handler){\r\n\t\tif(this._map[handler.key]==handler)this._map[handler.key]=null;\r\n\t\thandler.clear();\r\n\t\tTimer._pool.push(handler);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._create=function(useFrame,repeat,delay,caller,method,args,coverBefore){\r\n\t\tif (!delay){\r\n\t\t\tmethod.apply(caller,args);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (coverBefore){\r\n\t\t\tvar handler=this._getHandler(caller,method);\r\n\t\t\tif (handler){\r\n\t\t\t\thandler.repeat=repeat;\r\n\t\t\t\thandler.userFrame=useFrame;\r\n\t\t\t\thandler.delay=delay;\r\n\t\t\t\thandler.caller=caller;\r\n\t\t\t\thandler.method=method;\r\n\t\t\t\thandler.args=args;\r\n\t\t\t\thandler.exeTime=delay+(useFrame ? this.currFrame :this.currTimer+this._now()-this._lastTimer);\r\n\t\t\t\treturn handler;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler=Timer._pool.length > 0 ? Timer._pool.pop():new TimerHandler();\r\n\t\thandler.repeat=repeat;\r\n\t\thandler.userFrame=useFrame;\r\n\t\thandler.delay=delay;\r\n\t\thandler.caller=caller;\r\n\t\thandler.method=method;\r\n\t\thandler.args=args;\r\n\t\thandler.exeTime=delay+(useFrame ? this.currFrame :this.currTimer+this._now()-this._lastTimer)+1;\r\n\t\tthis._indexHandler(handler);\r\n\t\tthis._handlers.push(handler);\r\n\t\treturn handler;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._indexHandler=function(handler){\r\n\t\tvar caller=handler.caller;\r\n\t\tvar method=handler.method;\r\n\t\tvar cid=caller ? caller.$_GID || (caller.$_GID=Utils.getGID()):0;\r\n\t\tvar mid=method.$_TID || (method.$_TID=(this._mid++)*100000);\r\n\t\thandler.key=cid+mid;\r\n\t\tthis._map[handler.key]=handler;\r\n\t}\r\n\r\n\t/**\r\n\t*定时执行一次。\r\n\t*@param delay 延迟时间(单位为毫秒)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*@param coverBefore 是否覆盖之前的延迟执行，默认为 true 。\r\n\t*/\r\n\t__proto.once=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis._create(false,false,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**\r\n\t*定时重复执行。\r\n\t*@param delay 间隔时间(单位毫秒)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*@param coverBefore 是否覆盖之前的延迟执行，默认为 true 。\r\n\t*@param jumpFrame 时钟是否跳帧。基于时间的循环回调，单位时间间隔内，如能执行多次回调，出于性能考虑，引擎默认只执行一次，设置jumpFrame=true后，则回调会连续执行多次\r\n\t*/\r\n\t__proto.loop=function(delay,caller,method,args,coverBefore,jumpFrame){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\t(jumpFrame===void 0)&& (jumpFrame=false);\r\n\t\tvar handler=this._create(false,true,delay,caller,method,args,coverBefore);\r\n\t\tif (handler)handler.jumpFrame=jumpFrame;\r\n\t}\r\n\r\n\t/**\r\n\t*定时执行一次(基于帧率)。\r\n\t*@param delay 延迟几帧(单位为帧)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*@param coverBefore 是否覆盖之前的延迟执行，默认为 true 。\r\n\t*/\r\n\t__proto.frameOnce=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis._create(true,false,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**\r\n\t*定时重复执行(基于帧率)。\r\n\t*@param delay 间隔几帧(单位为帧)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*@param coverBefore 是否覆盖之前的延迟执行，默认为 true 。\r\n\t*/\r\n\t__proto.frameLoop=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis._create(true,true,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**返回统计信息。*/\r\n\t__proto.toString=function(){\r\n\t\treturn \"callLater:\"+this._laters.length+\" handlers:\"+this._handlers.length+\" pool:\"+Timer._pool.length;\r\n\t}\r\n\r\n\t/**\r\n\t*清理定时器。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*/\r\n\t__proto.clear=function(caller,method){\r\n\t\tvar handler=this._getHandler(caller,method);\r\n\t\tif (handler){\r\n\t\t\tthis._map[handler.key]=null;handler.key=0;\r\n\t\t\thandler.clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*清理对象身上的所有定时器。\r\n\t*@param caller 执行域(this)。\r\n\t*/\r\n\t__proto.clearAll=function(caller){\r\n\t\tif (!caller)return;\r\n\t\tfor (var i=0,n=this._handlers.length;i < n;i++){\r\n\t\t\tvar handler=this._handlers[i];\r\n\t\t\tif (handler.caller===caller){\r\n\t\t\t\tthis._map[handler.key]=null;handler.key=0;\r\n\t\t\t\thandler.clear();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getHandler=function(caller,method){\r\n\t\tvar cid=caller ? caller.$_GID || (caller.$_GID=Utils.getGID()):0;\r\n\t\tvar mid=method.$_TID || (method.$_TID=(this._mid++)*100000);\r\n\t\treturn this._map[cid+mid];\r\n\t}\r\n\r\n\t/**\r\n\t*延迟执行。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*@param args 回调参数。\r\n\t*/\r\n\t__proto.callLater=function(caller,method,args){\r\n\t\tif (this._getHandler(caller,method)==null){\r\n\t\t\tif (Timer._pool.length)\r\n\t\t\t\tvar handler=Timer._pool.pop();\r\n\t\t\telse handler=new TimerHandler();\r\n\t\t\thandler.caller=caller;\r\n\t\t\thandler.method=method;\r\n\t\t\thandler.args=args;\r\n\t\t\tthis._indexHandler(handler);\r\n\t\t\tthis._laters.push(handler);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*立即执行 callLater 。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*/\r\n\t__proto.runCallLater=function(caller,method){\r\n\t\tvar handler=this._getHandler(caller,method);\r\n\t\tif (handler && handler.method !=null){\r\n\t\t\tthis._map[handler.key]=null;\r\n\t\t\thandler.run(true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*立即提前执行定时器，执行之后从队列中删除\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 定时器回调函数。\r\n\t*/\r\n\t__proto.runTimer=function(caller,method){\r\n\t\tthis.runCallLater(caller,method);\r\n\t}\r\n\r\n\t/**\r\n\t*两帧之间的时间间隔,单位毫秒。\r\n\t*/\r\n\t__getset(0,__proto,'delta',function(){\r\n\t\treturn this._delta;\r\n\t});\r\n\r\n\tTimer._pool=[];\r\n\tTimer.__init$=function(){\r\n\t\t/**@private */\r\n\t\t//class TimerHandler\r\n\t\tTimerHandler=(function(){\r\n\t\t\tfunction TimerHandler(){\r\n\t\t\t\tthis.key=0;\r\n\t\t\t\tthis.repeat=false;\r\n\t\t\t\tthis.delay=0;\r\n\t\t\t\tthis.userFrame=false;\r\n\t\t\t\tthis.exeTime=0;\r\n\t\t\t\tthis.caller=null;\r\n\t\t\t\tthis.method=null;\r\n\t\t\t\tthis.args=null;\r\n\t\t\t\tthis.jumpFrame=false;\r\n\t\t\t}\r\n\t\t\t__class(TimerHandler,'');\r\n\t\t\tvar __proto=TimerHandler.prototype;\r\n\t\t\t__proto.clear=function(){\r\n\t\t\t\tthis.caller=null;\r\n\t\t\t\tthis.method=null;\r\n\t\t\t\tthis.args=null;\r\n\t\t\t}\r\n\t\t\t__proto.run=function(withClear){\r\n\t\t\t\tvar caller=this.caller;\r\n\t\t\t\tif (caller && caller.destroyed)return this.clear();\r\n\t\t\t\tvar method=this.method;\r\n\t\t\t\tvar args=this.args;\r\n\t\t\t\twithClear && this.clear();\r\n\t\t\t\tif (method==null)return;\r\n\t\t\t\targs ? method.apply(caller,args):method.call(caller);\r\n\t\t\t}\r\n\t\t\treturn TimerHandler;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn Timer;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Tween</code> 是一个缓动类。使用此类能够实现对目标对象属性的渐变。\r\n*/\r\n//class laya.utils.Tween\r\nvar Tween=(function(){\r\n\tfunction Tween(){\r\n\t\t/**@private */\r\n\t\t//this._complete=null;\r\n\t\t/**@private */\r\n\t\t//this._target=null;\r\n\t\t/**@private */\r\n\t\t//this._ease=null;\r\n\t\t/**@private */\r\n\t\t//this._props=null;\r\n\t\t/**@private */\r\n\t\t//this._duration=0;\r\n\t\t/**@private */\r\n\t\t//this._delay=0;\r\n\t\t/**@private */\r\n\t\t//this._startTimer=0;\r\n\t\t/**@private */\r\n\t\t//this._usedTimer=0;\r\n\t\t/**@private */\r\n\t\t//this._usedPool=false;\r\n\t\t/**@private */\r\n\t\t//this._delayParam=null;\r\n\t\t/**@private 唯一标识，TimeLintLite用到*/\r\n\t\tthis.gid=0;\r\n\t\t/**更新回调，缓动数值发生变化时，回调变化的值*/\r\n\t\t//this.update=null;\r\n\t}\r\n\r\n\t__class(Tween,'laya.utils.Tween');\r\n\tvar __proto=Tween.prototype;\r\n\t/**\r\n\t*缓动对象的props属性到目标值。\r\n\t*@param target 目标对象(即将更改属性值的对象)。\r\n\t*@param props 变化的属性列表，比如{x:100,y:20,ease:Ease.backOut,complete:Handler.create(this,onComplete),update:new Handler(this,onComplete)}。\r\n\t*@param duration 花费的时间，单位毫秒。\r\n\t*@param ease 缓动类型，默认为匀速运动。\r\n\t*@param complete 结束回调函数。\r\n\t*@param delay 延迟执行时间。\r\n\t*@param coverBefore 是否覆盖之前的缓动。\r\n\t*@return 返回Tween对象。\r\n\t*/\r\n\t__proto.to=function(target,props,duration,ease,complete,delay,coverBefore){\r\n\t\t(delay===void 0)&& (delay=0);\r\n\t\t(coverBefore===void 0)&& (coverBefore=false);\r\n\t\treturn this._create(target,props,duration,ease,complete,delay,coverBefore,true,false,true);\r\n\t}\r\n\r\n\t/**\r\n\t*从props属性，缓动到当前状态。\r\n\t*@param target 目标对象(即将更改属性值的对象)。\r\n\t*@param props 变化的属性列表，比如{x:100,y:20,ease:Ease.backOut,complete:Handler.create(this,onComplete),update:new Handler(this,onComplete)}。\r\n\t*@param duration 花费的时间，单位毫秒。\r\n\t*@param ease 缓动类型，默认为匀速运动。\r\n\t*@param complete 结束回调函数。\r\n\t*@param delay 延迟执行时间。\r\n\t*@param coverBefore 是否覆盖之前的缓动。\r\n\t*@return 返回Tween对象。\r\n\t*/\r\n\t__proto.from=function(target,props,duration,ease,complete,delay,coverBefore){\r\n\t\t(delay===void 0)&& (delay=0);\r\n\t\t(coverBefore===void 0)&& (coverBefore=false);\r\n\t\treturn this._create(target,props,duration,ease,complete,delay,coverBefore,false,false,true);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._create=function(target,props,duration,ease,complete,delay,coverBefore,isTo,usePool,runNow){\r\n\t\tif (!target)throw new Error(\"Tween:target is null\");\r\n\t\tthis._target=target;\r\n\t\tthis._duration=duration;\r\n\t\tthis._ease=ease || props.ease || Tween.easeNone;\r\n\t\tthis._complete=complete || props.complete;\r\n\t\tthis._delay=delay;\r\n\t\tthis._props=[];\r\n\t\tthis._usedTimer=0;\r\n\t\tthis._startTimer=Browser.now();\r\n\t\tthis._usedPool=usePool;\r\n\t\tthis._delayParam=null;\r\n\t\tthis.update=props.update;\r\n\t\tvar gid=(target.$_GID || (target.$_GID=Utils.getGID()));\r\n\t\tif (!Tween.tweenMap[gid]){\r\n\t\t\tTween.tweenMap[gid]=[this];\r\n\t\t\t}else {\r\n\t\t\tif (coverBefore)Tween.clearTween(target);\r\n\t\t\tTween.tweenMap[gid].push(this);\r\n\t\t}\r\n\t\tif (runNow){\r\n\t\t\tif (delay <=0)this.firstStart(target,props,isTo);\r\n\t\t\telse{\r\n\t\t\t\tthis._delayParam=[target,props,isTo];\r\n\t\t\t\tLaya.scaleTimer.once(delay,this,this.firstStart,this._delayParam);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis._initProps(target,props,isTo);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto.firstStart=function(target,props,isTo){\r\n\t\tthis._delayParam=null;\r\n\t\tif (target.destroyed){\r\n\t\t\tthis.clear();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._initProps(target,props,isTo);\r\n\t\tthis._beginLoop();\r\n\t}\r\n\r\n\t__proto._initProps=function(target,props,isTo){\r\n\t\tfor (var p in props){\r\n\t\t\tif ((typeof (target[p])=='number')){\r\n\t\t\t\tvar start=isTo ? target[p] :props[p];\r\n\t\t\t\tvar end=isTo ? props[p] :target[p];\r\n\t\t\t\tthis._props.push([p,start,end-start]);\r\n\t\t\t\tif (!isTo)target[p]=start;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._beginLoop=function(){\r\n\t\tLaya.scaleTimer.frameLoop(1,this,this._doEase);\r\n\t}\r\n\r\n\t/**执行缓动**/\r\n\t__proto._doEase=function(){\r\n\t\tthis._updateEase(Browser.now());\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._updateEase=function(time){\r\n\t\tvar target=this._target;\r\n\t\tif (!target)return;\r\n\t\tif (target.destroyed)return Tween.clearTween(target);\r\n\t\tvar usedTimer=this._usedTimer=time-this._startTimer-this._delay;\r\n\t\tif (usedTimer < 0)return;\r\n\t\tif (usedTimer >=this._duration)return this.complete();\r\n\t\tvar ratio=usedTimer > 0 ? this._ease(usedTimer,0,1,this._duration):0;\r\n\t\tvar props=this._props;\r\n\t\tfor (var i=0,n=props.length;i < n;i++){\r\n\t\t\tvar prop=props[i];\r\n\t\t\ttarget[prop[0]]=prop[1]+(ratio *prop[2]);\r\n\t\t}\r\n\t\tif (this.update)this.update.run();\r\n\t}\r\n\r\n\t/**\r\n\t*立即结束缓动并到终点。\r\n\t*/\r\n\t__proto.complete=function(){\r\n\t\tif (!this._target)return;\r\n\t\tLaya.scaleTimer.runTimer(this,this.firstStart);\r\n\t\tvar target=this._target;\r\n\t\tvar props=this._props;\r\n\t\tvar handler=this._complete;\r\n\t\tfor (var i=0,n=props.length;i < n;i++){\r\n\t\t\tvar prop=props[i];\r\n\t\t\ttarget[prop[0]]=prop[1]+prop[2];\r\n\t\t}\r\n\t\tif (this.update)this.update.run();\r\n\t\tthis.clear();\r\n\t\thandler && handler.run();\r\n\t}\r\n\r\n\t/**\r\n\t*暂停缓动，可以通过resume或restart重新开始。\r\n\t*/\r\n\t__proto.pause=function(){\r\n\t\tLaya.scaleTimer.clear(this,this._beginLoop);\r\n\t\tLaya.scaleTimer.clear(this,this._doEase);\r\n\t\tLaya.scaleTimer.clear(this,this.firstStart);\r\n\t\tvar time=Browser.now();\r\n\t\tvar dTime=NaN;\r\n\t\tdTime=time-this._startTimer-this._delay;\r\n\t\tif (dTime < 0){\r\n\t\t\tthis._usedTimer=dTime;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置开始时间。\r\n\t*@param startTime 开始时间。\r\n\t*/\r\n\t__proto.setStartTime=function(startTime){\r\n\t\tthis._startTimer=startTime;\r\n\t}\r\n\r\n\t/**\r\n\t*停止并清理当前缓动。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tif (this._target){\r\n\t\t\tthis._remove();\r\n\t\t\tthis._clear();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._clear=function(){\r\n\t\tthis.pause();\r\n\t\tLaya.scaleTimer.clear(this,this.firstStart);\r\n\t\tthis._complete=null;\r\n\t\tthis._target=null;\r\n\t\tthis._ease=null;\r\n\t\tthis._props=null;\r\n\t\tthis._delayParam=null;\r\n\t\tif (this._usedPool){\r\n\t\t\tthis.update=null;\r\n\t\t\tPool.recover(\"tween\",this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**回收到对象池。*/\r\n\t__proto.recover=function(){\r\n\t\tthis._usedPool=true;\r\n\t\tthis._clear();\r\n\t}\r\n\r\n\t__proto._remove=function(){\r\n\t\tvar tweens=Tween.tweenMap[this._target.$_GID];\r\n\t\tif (tweens){\r\n\t\t\tfor (var i=0,n=tweens.length;i < n;i++){\r\n\t\t\t\tif (tweens[i]===this){\r\n\t\t\t\t\ttweens.splice(i,1);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*重新开始暂停的缓动。\r\n\t*/\r\n\t__proto.restart=function(){\r\n\t\tthis.pause();\r\n\t\tthis._usedTimer=0;\r\n\t\tthis._startTimer=Browser.now();\r\n\t\tif (this._delayParam){\r\n\t\t\tLaya.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar props=this._props;\r\n\t\tfor (var i=0,n=props.length;i < n;i++){\r\n\t\t\tvar prop=props[i];\r\n\t\t\tthis._target[prop[0]]=prop[1];\r\n\t\t}\r\n\t\tLaya.scaleTimer.once(this._delay,this,this._beginLoop);\r\n\t}\r\n\r\n\t/**\r\n\t*恢复暂停的缓动。\r\n\t*/\r\n\t__proto.resume=function(){\r\n\t\tif (this._usedTimer >=this._duration)return;\r\n\t\tthis._startTimer=Browser.now()-this._usedTimer-this._delay;\r\n\t\tif (this._delayParam){\r\n\t\t\tif (this._usedTimer < 0){\r\n\t\t\t\tLaya.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam);\r\n\t\t\t\t}else{\r\n\t\t\t\tthis.firstStart.apply(this,this._delayParam);\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t\tthis._beginLoop();\r\n\t\t}\r\n\t}\r\n\r\n\t/**设置当前执行比例**/\r\n\t__getset(0,__proto,'progress',null,function(v){\r\n\t\tvar uTime=v *this._duration;\r\n\t\tthis._startTimer=Browser.now()-this._delay-uTime;\r\n\t});\r\n\r\n\tTween.to=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){\r\n\t\t(delay===void 0)&& (delay=0);\r\n\t\t(coverBefore===void 0)&& (coverBefore=false);\r\n\t\t(autoRecover===void 0)&& (autoRecover=true);\r\n\t\treturn Pool.getItemByClass(\"tween\",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,true,autoRecover,true);\r\n\t}\r\n\r\n\tTween.from=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){\r\n\t\t(delay===void 0)&& (delay=0);\r\n\t\t(coverBefore===void 0)&& (coverBefore=false);\r\n\t\t(autoRecover===void 0)&& (autoRecover=true);\r\n\t\treturn Pool.getItemByClass(\"tween\",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,false,autoRecover,true);\r\n\t}\r\n\r\n\tTween.clearAll=function(target){\r\n\t\tif (!target || !target.$_GID)return;\r\n\t\tvar tweens=Tween.tweenMap[target.$_GID];\r\n\t\tif (tweens){\r\n\t\t\tfor (var i=0,n=tweens.length;i < n;i++){\r\n\t\t\t\ttweens[i]._clear();\r\n\t\t\t}\r\n\t\t\ttweens.length=0;\r\n\t\t}\r\n\t}\r\n\r\n\tTween.clear=function(tween){\r\n\t\ttween.clear();\r\n\t}\r\n\r\n\tTween.clearTween=function(target){\r\n\t\tTween.clearAll(target);\r\n\t}\r\n\r\n\tTween.easeNone=function(t,b,c,d){\r\n\t\treturn c *t / d+b;\r\n\t}\r\n\r\n\tTween.tweenMap={};\r\n\treturn Tween;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Utils</code> 是工具类。\r\n*/\r\n//class laya.utils.Utils\r\nvar Utils=(function(){\r\n\tfunction Utils(){}\r\n\t__class(Utils,'laya.utils.Utils');\r\n\tUtils.toRadian=function(angle){\r\n\t\treturn angle *Utils._pi2;\r\n\t}\r\n\r\n\tUtils.toAngle=function(radian){\r\n\t\treturn radian *Utils._pi;\r\n\t}\r\n\r\n\tUtils.toHexColor=function(color){\r\n\t\tif (color < 0 || isNaN(color))return null;\r\n\t\tvar str=color.toString(16);\r\n\t\twhile (str.length < 6)str=\"0\"+str;\r\n\t\treturn \"#\"+str;\r\n\t}\r\n\r\n\tUtils.getGID=function(){\r\n\t\treturn Utils._gid++;\r\n\t}\r\n\r\n\tUtils.concatArray=function(source,array){\r\n\t\tif (!array)return source;\r\n\t\tif (!source)return array;\r\n\t\tvar i=0,len=array.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tsource.push(array[i]);\r\n\t\t}\r\n\t\treturn source;\r\n\t}\r\n\r\n\tUtils.clearArray=function(array){\r\n\t\tif (!array)return array;\r\n\t\tarray.length=0;\r\n\t\treturn array;\r\n\t}\r\n\r\n\tUtils.copyArray=function(source,array){\r\n\t\tsource || (source=[]);\r\n\t\tif (!array)return source;\r\n\t\tsource.length=array.length;\r\n\t\tvar i=0,len=array.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tsource[i]=array[i];\r\n\t\t}\r\n\t\treturn source;\r\n\t}\r\n\r\n\tUtils.getGlobalRecByPoints=function(sprite,x0,y0,x1,y1){\r\n\t\tvar newLTPoint;\r\n\t\tnewLTPoint=new Point(x0,y0);\r\n\t\tnewLTPoint=sprite.localToGlobal(newLTPoint);\r\n\t\tvar newRBPoint;\r\n\t\tnewRBPoint=new Point(x1,y1);\r\n\t\tnewRBPoint=sprite.localToGlobal(newRBPoint);\r\n\t\treturn Rectangle._getWrapRec([newLTPoint.x,newLTPoint.y,newRBPoint.x,newRBPoint.y]);\r\n\t}\r\n\r\n\tUtils.getGlobalPosAndScale=function(sprite){\r\n\t\treturn Utils.getGlobalRecByPoints(sprite,0,0,1,1);\r\n\t}\r\n\r\n\tUtils.bind=function(fun,scope){\r\n\t\tvar rst=fun;\r\n\t\t/*__JS__ */rst=fun.bind(scope);;\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tUtils.measureText=function(txt,font){\r\n\t\treturn RunDriver.measureText(txt,font);\r\n\t}\r\n\r\n\tUtils.updateOrder=function(array){\r\n\t\tif (!array || array.length < 2)return false;\r\n\t\tvar i=1,j=0,len=array.length,key=NaN,c;\r\n\t\twhile (i < len){\r\n\t\t\tj=i;\r\n\t\t\tc=array[j];\r\n\t\t\tkey=array[j]._zOrder;\r\n\t\t\twhile (--j >-1){\r\n\t\t\t\tif (array[j]._zOrder > key)array[j+1]=array[j];\r\n\t\t\t\telse break ;\r\n\t\t\t}\r\n\t\t\tarray[j+1]=c;\r\n\t\t\ti++;\r\n\t\t};\r\n\t\tvar model=c.parent.conchModel;\r\n\t\tif (model){\r\n\t\t\tif (model.updateZOrder !=null){\r\n\t\t\t\tmodel.updateZOrder();\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\tmodel.removeChild(array[i].conchModel);\r\n\t\t\t\t}\r\n\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\tmodel.addChildAt(array[i].conchModel,i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tUtils.transPointList=function(points,x,y){\r\n\t\tvar i=0,len=points.length;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\tpoints[i]+=x;\r\n\t\t\tpoints[i+1]+=y;\r\n\t\t}\r\n\t}\r\n\r\n\tUtils.parseInt=function(str,radix){\r\n\t\t(radix===void 0)&& (radix=0);\r\n\t\tvar result=Browser.window.parseInt(str,radix);\r\n\t\tif (isNaN(result))return 0;\r\n\t\treturn result;\r\n\t}\r\n\r\n\tUtils.getFileExtension=function(path){\r\n\t\tUtils._extReg.lastIndex=path.lastIndexOf(\".\");\r\n\t\tvar result=Utils._extReg.exec(path);\r\n\t\tif (result && result.length > 1){\r\n\t\t\treturn result[1].toLowerCase();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tUtils.getTransformRelativeToWindow=function(coordinateSpace,x,y){\r\n\t\tvar stage=Laya.stage;\r\n\t\tvar globalTransform=laya.utils.Utils.getGlobalPosAndScale(coordinateSpace);\r\n\t\tvar canvasMatrix=stage._canvasTransform.clone();\r\n\t\tvar canvasLeft=canvasMatrix.tx;\r\n\t\tvar canvasTop=canvasMatrix.ty;\r\n\t\tcanvasMatrix.rotate(-Math.PI / 180 *Laya.stage.canvasDegree);\r\n\t\tcanvasMatrix.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);\r\n\t\tvar perpendicular=(Laya.stage.canvasDegree % 180 !=0);\r\n\t\tvar tx=NaN,ty=NaN;\r\n\t\tif (perpendicular){\r\n\t\t\ttx=y+globalTransform.y;\r\n\t\t\tty=x+globalTransform.x;\r\n\t\t\ttx *=canvasMatrix.d;\r\n\t\t\tty *=canvasMatrix.a;\r\n\t\t\tif (Laya.stage.canvasDegree==90){\r\n\t\t\t\ttx=canvasLeft-tx;\r\n\t\t\t\tty+=canvasTop;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttx+=canvasLeft;\r\n\t\t\t\tty=canvasTop-ty;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttx=x+globalTransform.x;\r\n\t\t\tty=y+globalTransform.y;\r\n\t\t\ttx *=canvasMatrix.a;\r\n\t\t\tty *=canvasMatrix.d;\r\n\t\t\ttx+=canvasLeft;\r\n\t\t\tty+=canvasTop;\r\n\t\t};\r\n\t\tvar domScaleX=NaN,domScaleY=NaN;\r\n\t\tif (perpendicular){\r\n\t\t\tdomScaleX=canvasMatrix.d *globalTransform.height;\r\n\t\t\tdomScaleY=canvasMatrix.a *globalTransform.width;\r\n\t\t\t}else {\r\n\t\t\tdomScaleX=canvasMatrix.a *globalTransform.width;\r\n\t\t\tdomScaleY=canvasMatrix.d *globalTransform.height;\r\n\t\t}\r\n\t\treturn {x:tx,y:ty,scaleX:domScaleX,scaleY:domScaleY};\r\n\t}\r\n\r\n\tUtils.fitDOMElementInArea=function(dom,coordinateSpace,x,y,width,height){\r\n\t\tif (!dom._fitLayaAirInitialized){\r\n\t\t\tdom._fitLayaAirInitialized=true;\r\n\t\t\tdom.style.transformOrigin=dom.style.webKittransformOrigin=\"left top\";\r\n\t\t\tdom.style.position=\"absolute\"\r\n\t\t};\r\n\t\tvar transform=Utils.getTransformRelativeToWindow(coordinateSpace,x,y);\r\n\t\tdom.style.transform=dom.style.webkitTransform=\"scale(\"+transform.scaleX+\",\"+transform.scaleY+\") rotate(\"+(Laya.stage.canvasDegree)+\"deg)\";\r\n\t\tdom.style.width=width+'px';\r\n\t\tdom.style.height=height+'px';\r\n\t\tdom.style.left=transform.x+'px';\r\n\t\tdom.style.top=transform.y+'px';\r\n\t}\r\n\r\n\tUtils.isOkTextureList=function(textureList){\r\n\t\tif (!textureList)return false;\r\n\t\tvar i=0,len=textureList.length;\r\n\t\tvar tTexture;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttTexture=textureList[i];\r\n\t\t\tif (!tTexture||!tTexture.source)return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tUtils.isOKCmdList=function(cmds){\r\n\t\tif (!cmds)return false;\r\n\t\tvar i=0,len=cmds.length;\r\n\t\tvar context=Render._context;\r\n\t\tvar cmd;\r\n\t\tvar tex;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tcmd=cmds[i];\r\n\t\t\tswitch(cmd.callee){\r\n\t\t\t\tcase context._drawTexture:\r\n\t\t\t\tcase context._fillTexture:\r\n\t\t\t\tcase context._drawTextureWithTransform:\r\n\t\t\t\t\ttex=cmd[0];\r\n\t\t\t\t\tif (!tex || !tex.source)return false;\r\n\t\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tUtils._gid=1;\r\n\tUtils.parseXMLFromString=function(value){\r\n\t\tvar rst;\r\n\t\tvalue=value.replace(/>\\s+</g,'><');\r\n\t\t/*__JS__ */rst=(new DOMParser()).parseFromString(value,'text/xml');\r\n\t\tif (rst.firstChild.textContent.indexOf(\"This page contains the following errors\")>-1){\r\n\t\t\tthrow new Error(rst.firstChild.firstChild.textContent);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t__static(Utils,\r\n\t['_pi',function(){return this._pi=180 / Math.PI;},'_pi2',function(){return this._pi2=Math.PI / 180;},'_extReg',function(){return this._extReg=/\\.(\\w+)\\??/g;}\r\n\t]);\r\n\treturn Utils;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.utils.VectorGraphManager\r\nvar VectorGraphManager=(function(){\r\n\tfunction VectorGraphManager(){\r\n\t\tthis.useDic={};\r\n\t\tthis.shapeDic={};\r\n\t\tthis.shapeLineDic={};\r\n\t\tthis._id=0;\r\n\t\tthis._checkKey=false;\r\n\t\tthis._freeIdArray=[];\r\n\t\tif (Render.isWebGL){\r\n\t\t\tCacheManager.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this));\r\n\t\t}\r\n\t}\r\n\r\n\t__class(VectorGraphManager,'laya.utils.VectorGraphManager');\r\n\tvar __proto=VectorGraphManager.prototype;\r\n\t/**\r\n\t*得到个空闲的ID\r\n\t*@return\r\n\t*/\r\n\t__proto.getId=function(){\r\n\t\treturn this._id++;\r\n\t}\r\n\r\n\t/**\r\n\t*添加一个图形到列表中\r\n\t*@param id\r\n\t*@param shape\r\n\t*/\r\n\t__proto.addShape=function(id,shape){\r\n\t\tthis.shapeDic[id]=shape;\r\n\t\tif (!this.useDic[id]){\r\n\t\t\tthis.useDic[id]=true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*添加一个线图形到列表中\r\n\t*@param id\r\n\t*@param Line\r\n\t*/\r\n\t__proto.addLine=function(id,Line){\r\n\t\tthis.shapeLineDic[id]=Line;\r\n\t\tif (!this.shapeLineDic[id]){\r\n\t\t\tthis.shapeLineDic[id]=true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*检测一个对象是否在使用中\r\n\t*@param id\r\n\t*/\r\n\t__proto.getShape=function(id){\r\n\t\tif (this._checkKey){\r\n\t\t\tif (this.useDic[id] !=null){\r\n\t\t\t\tthis.useDic[id]=true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*删除一个图形对象\r\n\t*@param id\r\n\t*/\r\n\t__proto.deleteShape=function(id){\r\n\t\tif (this.shapeDic[id]){\r\n\t\t\tthis.shapeDic[id]=null;\r\n\t\t\tdelete this.shapeDic[id];\r\n\t\t}\r\n\t\tif (this.shapeLineDic[id]){\r\n\t\t\tthis.shapeLineDic[id]=null;\r\n\t\t\tdelete this.shapeLineDic[id];\r\n\t\t}\r\n\t\tif (this.useDic[id] !=null){\r\n\t\t\tdelete this.useDic[id];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*得到缓存列表\r\n\t*@return\r\n\t*/\r\n\t__proto.getCacheList=function(){\r\n\t\tvar str;\r\n\t\tvar list=[];\r\n\t\tfor (str in this.shapeDic){\r\n\t\t\tlist.push(this.shapeDic[str]);\r\n\t\t}\r\n\t\tfor (str in this.shapeLineDic){\r\n\t\t\tlist.push(this.shapeLineDic[str]);\r\n\t\t}\r\n\t\treturn list;\r\n\t}\r\n\r\n\t/**\r\n\t*开始清理状态，准备销毁\r\n\t*/\r\n\t__proto.startDispose=function(key){\r\n\t\tvar str;\r\n\t\tfor (str in this.useDic){\r\n\t\t\tthis.useDic[str]=false;\r\n\t\t}\r\n\t\tthis._checkKey=true;\r\n\t}\r\n\r\n\t/**\r\n\t*确认销毁\r\n\t*/\r\n\t__proto.endDispose=function(){\r\n\t\tif (this._checkKey){\r\n\t\t\tvar str;\r\n\t\t\tfor (str in this.useDic){\r\n\t\t\t\tif (!this.useDic[str]){\r\n\t\t\t\t\tthis.deleteShape(str);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._checkKey=false;\r\n\t\t}\r\n\t}\r\n\r\n\tVectorGraphManager.getInstance=function(){\r\n\t\treturn VectorGraphManager.instance=VectorGraphManager.instance|| new VectorGraphManager();\r\n\t}\r\n\r\n\tVectorGraphManager.instance=null;\r\n\treturn VectorGraphManager;\r\n})()\r\n\r\n\r\n/**\r\n*封装弱引用WeakMap\r\n*如果支持WeakMap，则使用WeakMap，如果不支持，则用Object代替\r\n*注意：如果采用Object，为了防止内存泄漏，则采用定时清理缓存策略\r\n*/\r\n//class laya.utils.WeakObject\r\nvar WeakObject=(function(){\r\n\tfunction WeakObject(){\r\n\t\t/**@private */\r\n\t\tthis._obj=null;\r\n\t\tthis._obj=WeakObject.supportWeakMap ? new Browser.window.WeakMap():{};\r\n\t\tif (!WeakObject.supportWeakMap)WeakObject._maps.push(this);\r\n\t}\r\n\r\n\t__class(WeakObject,'laya.utils.WeakObject');\r\n\tvar __proto=WeakObject.prototype;\r\n\t/**\r\n\t*设置缓存\r\n\t*@param key kye对象，可被回收\r\n\t*@param value object对象，可被回收\r\n\t*/\r\n\t__proto.set=function(key,value){\r\n\t\tif (key==null)return;\r\n\t\tif (WeakObject.supportWeakMap){\r\n\t\t\tvar objKey=key;\r\n\t\t\tif ((typeof key=='string')|| (typeof key=='number')){\r\n\t\t\t\tobjKey=WeakObject._keys[key];\r\n\t\t\t\tif (!objKey)objKey=WeakObject._keys[key]={k:key};\r\n\t\t\t}\r\n\t\t\tthis._obj.set(objKey,value);\r\n\t\t\t}else {\r\n\t\t\tif ((typeof key=='string')|| (typeof key=='number')){\r\n\t\t\t\tthis._obj[key]=value;\r\n\t\t\t\t}else {\r\n\t\t\t\tkey.$_GID || (key.$_GID=Utils.getGID());\r\n\t\t\t\tthis._obj[key.$_GID]=value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*获取缓存\r\n\t*@param key kye对象，可被回收\r\n\t*/\r\n\t__proto.get=function(key){\r\n\t\tif (key==null)return null;\r\n\t\tif (WeakObject.supportWeakMap){\r\n\t\t\tvar objKey=((typeof key=='string')|| (typeof key=='number'))? WeakObject._keys[key] :key;\r\n\t\t\tif (!objKey)return null;\r\n\t\t\treturn this._obj.get(objKey);\r\n\t\t\t}else {\r\n\t\t\tif ((typeof key=='string')|| (typeof key=='number'))return this._obj[key];\r\n\t\t\treturn this._obj[key.$_GID];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*删除缓存\r\n\t*/\r\n\t__proto.del=function(key){\r\n\t\tif (key==null)return;\r\n\t\tif (WeakObject.supportWeakMap){\r\n\t\t\tvar objKey=((typeof key=='string')|| (typeof key=='number'))? WeakObject._keys[key] :key;\r\n\t\t\tif (!objKey)return;\r\n\t\t\t/*__JS__ */this._obj.delete(objKey);\r\n\t\t\t}else {\r\n\t\t\tif ((typeof key=='string')|| (typeof key=='number'))delete this._obj[key];\r\n\t\t\telse delete this._obj[this._obj.$_GID];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*是否有缓存\r\n\t*/\r\n\t__proto.has=function(key){\r\n\t\tif (key==null)return false;\r\n\t\tif (WeakObject.supportWeakMap){\r\n\t\t\tvar objKey=((typeof key=='string')|| (typeof key=='number'))? WeakObject._keys[key] :key;\r\n\t\t\treturn this._obj.has(objKey);\r\n\t\t\t}else {\r\n\t\t\tif ((typeof key=='string')|| (typeof key=='number'))return this._obj[key] !=null;\r\n\t\t\treturn this._obj[this._obj.$_GID] !=null;\r\n\t\t}\r\n\t}\r\n\r\n\tWeakObject.__init__=function(){\r\n\t\tWeakObject.supportWeakMap=Browser.window.WeakMap !=null;\r\n\t\tif (!WeakObject.supportWeakMap)Laya.timer.loop(WeakObject.delInterval,null,WeakObject.clearCache);\r\n\t}\r\n\r\n\tWeakObject.clearCache=function(){\r\n\t\tfor (var i=0,n=WeakObject._maps.length;i < n;i++){\r\n\t\t\tvar obj=WeakObject._maps[i];\r\n\t\t\tobj._obj={};\r\n\t\t}\r\n\t}\r\n\r\n\tWeakObject.supportWeakMap=false;\r\n\tWeakObject.delInterval=5 *60 *1000;\r\n\tWeakObject._keys={};\r\n\tWeakObject._maps=[];\r\n\t__static(WeakObject,\r\n\t['I',function(){return this.I=new WeakObject();}\r\n\t]);\r\n\treturn WeakObject;\r\n})()\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.utils.WordText\r\nvar WordText=(function(){\r\n\tfunction WordText(){\r\n\t\tthis.id=NaN;\r\n\t\tthis.save=[];\r\n\t\tthis.toUpperCase=null;\r\n\t\tthis.changed=false;\r\n\t\tthis._text=null;\r\n\t}\r\n\r\n\t__class(WordText,'laya.utils.WordText');\r\n\tvar __proto=WordText.prototype;\r\n\t__proto.setText=function(txt){\r\n\t\tthis.changed=true;\r\n\t\tthis._text=txt;\r\n\t}\r\n\r\n\t__proto.toString=function(){\r\n\t\treturn this._text;\r\n\t}\r\n\r\n\t__proto.charCodeAt=function(i){\r\n\t\treturn this._text ? this._text.charCodeAt(i):NaN;\r\n\t}\r\n\r\n\t__proto.charAt=function(i){\r\n\t\treturn this._text ? this._text.charAt(i):null;\r\n\t}\r\n\r\n\t__getset(0,__proto,'length',function(){\r\n\t\treturn this._text ? this._text.length :0;\r\n\t});\r\n\r\n\treturn WordText;\r\n})()\r\n\r\n\r\n/**\r\n*<code>Node</code> 类是可放在显示列表中的所有对象的基类。该显示列表管理 Laya 运行时中显示的所有对象。使用 Node 类排列显示列表中的显示对象。Node 对象可以有子显示对象。\r\n*/\r\n//class laya.display.Node extends laya.events.EventDispatcher\r\nvar Node=(function(_super){\r\n\tfunction Node(){\r\n\t\t/**@private */\r\n\t\tthis._bits=0;\r\n\t\t/**@private 是否在显示列表中显示*/\r\n\t\tthis._displayedInStage=false;\r\n\t\t/**@private 父节点对象*/\r\n\t\tthis._parent=null;\r\n\t\t/**@private */\r\n\t\tthis.conchModel=null;\r\n\t\t/**节点名称。*/\r\n\t\tthis.name=\"\";\r\n\t\t/**[只读]是否已经销毁。对象销毁后不能再使用。*/\r\n\t\tthis._destroyed=false;\r\n\t\tNode.__super.call(this);\r\n\t\tthis._childs=Node.ARRAY_EMPTY;\r\n\t\tthis._$P=Node.PROP_EMPTY;\r\n\t\tthis.timer=Laya.scaleTimer;\r\n\t\tthis.conchModel=Render.isConchNode ? this.createConchModel():null;\r\n\t}\r\n\r\n\t__class(Node,'laya.display.Node',_super);\r\n\tvar __proto=Node.prototype;\r\n\t/**@private */\r\n\t__proto._setBit=function(type,value){\r\n\t\tif (type==0x1){\r\n\t\t\tvar preValue=this._getBit(type);\r\n\t\t\tif (preValue !=value){\r\n\t\t\t\tthis._updateDisplayedInstage();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (value){\r\n\t\t\tthis._bits |=type;\r\n\t\t\t}else {\r\n\t\t\tthis._bits &=~type;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getBit=function(type){\r\n\t\treturn (this._bits & type)!=0;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setUpNoticeChain=function(){\r\n\t\tif (this._getBit(0x1)){\r\n\t\t\tthis._setUpNoticeType(0x1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setUpNoticeType=function(type){\r\n\t\tvar ele=this;\r\n\t\tele._setBit(type,true);\r\n\t\tele=ele.parent;\r\n\t\twhile (ele){\r\n\t\t\tif (ele._getBit(type))return;\r\n\t\t\tele._setBit(type,true);\r\n\t\t\tele=ele.parent;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>增加事件侦听器，以使侦听器能够接收事件通知。</p>\r\n\t*<p>如果侦听鼠标事件，则会自动设置自己和父亲节点的属性 mouseEnabled 的值为 true(如果父节点mouseEnabled=false，则停止设置父节点mouseEnabled属性)。</p>\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.on=function(type,caller,listener,args){\r\n\t\tif (type===/*laya.events.Event.DISPLAY*/\"display\" || type===/*laya.events.Event.UNDISPLAY*/\"undisplay\"){\r\n\t\t\tif (!this._getBit(0x1)){\r\n\t\t\t\tthis._setUpNoticeType(0x1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._createListener(type,caller,listener,args,false);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>增加事件侦听器，以使侦听器能够接收事件通知，此侦听事件响应一次后则自动移除侦听。</p>\r\n\t*<p>如果侦听鼠标事件，则会自动设置自己和父亲节点的属性 mouseEnabled 的值为 true(如果父节点mouseEnabled=false，则停止设置父节点mouseEnabled属性)。</p>\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.once=function(type,caller,listener,args){\r\n\t\tif (type===/*laya.events.Event.DISPLAY*/\"display\" || type===/*laya.events.Event.UNDISPLAY*/\"undisplay\"){\r\n\t\t\tif (!this._getBit(0x1)){\r\n\t\t\t\tthis._setUpNoticeType(0x1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._createListener(type,caller,listener,args,true);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.createConchModel=function(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>销毁此对象。destroy对象默认会把自己从父节点移除，并且清理自身引用关系，等待js自动垃圾回收机制回收。destroy后不能再使用。</p>\r\n\t*<p>destroy时会移除自身的事情监听，自身的timer监听，移除子对象及从父节点移除自己。</p>\r\n\t*@param destroyChild （可选）是否同时销毁子节点，若值为true,则销毁子节点，否则不销毁子节点。\r\n\t*/\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis._destroyed=true;\r\n\t\tthis._parent && this._parent.removeChild(this);\r\n\t\tif (this._childs){\r\n\t\t\tif (destroyChild)this.destroyChildren();\r\n\t\t\telse this.removeChildren();\r\n\t\t}\r\n\t\tthis._childs=null;\r\n\t\tthis._$P=null;\r\n\t\tthis.offAll();\r\n\t\tthis.timer.clearAll(this);\r\n\t}\r\n\r\n\t/**\r\n\t*销毁所有子对象，不销毁自己本身。\r\n\t*/\r\n\t__proto.destroyChildren=function(){\r\n\t\tif (this._childs){\r\n\t\t\tfor (var i=this._childs.length-1;i >-1;i--){\r\n\t\t\t\tthis._childs[i].destroy(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*添加子节点。\r\n\t*@param node 节点对象\r\n\t*@return 返回添加的节点\r\n\t*/\r\n\t__proto.addChild=function(node){\r\n\t\tif (!node || this.destroyed || node===this)return node;\r\n\t\tif ((node).zOrder)this._set$P(\"hasZorder\",true);\r\n\t\tif (node._parent===this){\r\n\t\t\tvar index=this.getChildIndex(node);\r\n\t\t\tif (index!==this._childs.length-1){\r\n\t\t\t\tthis._childs.splice(index,1);\r\n\t\t\t\tthis._childs.push(node);\r\n\t\t\t\tif (this.conchModel){\r\n\t\t\t\t\tthis.conchModel.removeChild(node.conchModel);\r\n\t\t\t\t\tthis.conchModel.addChildAt(node.conchModel,this._childs.length-1);\r\n\t\t\t\t}\r\n\t\t\t\tthis._childChanged();\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tnode.parent && node.parent.removeChild(node);\r\n\t\t\tthis._childs===Node.ARRAY_EMPTY && (this._childs=[]);\r\n\t\t\tthis._childs.push(node);\r\n\t\t\tthis.conchModel && this.conchModel.addChildAt(node.conchModel,this._childs.length-1);\r\n\t\t\tnode.parent=this;\r\n\t\t\tthis._childChanged();\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t*批量增加子节点\r\n\t*@param ...args 无数子节点。\r\n\t*/\r\n\t__proto.addChildren=function(__args){\r\n\t\tvar args=arguments;\r\n\t\tvar i=0,n=args.length;\r\n\t\twhile (i < n){\r\n\t\t\tthis.addChild(args[i++]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*添加子节点到指定的索引位置。\r\n\t*@param node 节点对象。\r\n\t*@param index 索引位置。\r\n\t*@return 返回添加的节点。\r\n\t*/\r\n\t__proto.addChildAt=function(node,index){\r\n\t\tif (!node || this.destroyed || node===this)return node;\r\n\t\tif ((node).zOrder)this._set$P(\"hasZorder\",true);\r\n\t\tif (index >=0 && index <=this._childs.length){\r\n\t\t\tif (node._parent===this){\r\n\t\t\t\tvar oldIndex=this.getChildIndex(node);\r\n\t\t\t\tthis._childs.splice(oldIndex,1);\r\n\t\t\t\tthis._childs.splice(index,0,node);\r\n\t\t\t\tif (this.conchModel){\r\n\t\t\t\t\tthis.conchModel.removeChild(node.conchModel);\r\n\t\t\t\t\tthis.conchModel.addChildAt(node.conchModel,index);\r\n\t\t\t\t}\r\n\t\t\t\tthis._childChanged();\r\n\t\t\t\t}else {\r\n\t\t\t\tnode.parent && node.parent.removeChild(node);\r\n\t\t\t\tthis._childs===Node.ARRAY_EMPTY && (this._childs=[]);\r\n\t\t\t\tthis._childs.splice(index,0,node);\r\n\t\t\t\tthis.conchModel && this.conchModel.addChildAt(node.conchModel,index);\r\n\t\t\t\tnode.parent=this;\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t\t}else {\r\n\t\t\tthrow new Error(\"appendChildAt:The index is out of bounds\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*根据子节点对象，获取子节点的索引位置。\r\n\t*@param node 子节点。\r\n\t*@return 子节点所在的索引位置。\r\n\t*/\r\n\t__proto.getChildIndex=function(node){\r\n\t\treturn this._childs.indexOf(node);\r\n\t}\r\n\r\n\t/**\r\n\t*根据子节点的名字，获取子节点对象。\r\n\t*@param name 子节点的名字。\r\n\t*@return 节点对象。\r\n\t*/\r\n\t__proto.getChildByName=function(name){\r\n\t\tvar nodes=this._childs;\r\n\t\tif (nodes){\r\n\t\t\tfor (var i=0,n=nodes.length;i < n;i++){\r\n\t\t\t\tvar node=nodes[i];\r\n\t\t\t\tif (node.name===name)return node;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._get$P=function(key){\r\n\t\treturn this._$P[key];\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._set$P=function(key,value){\r\n\t\tif (!this.destroyed){\r\n\t\t\tthis._$P===Node.PROP_EMPTY && (this._$P={});\r\n\t\t\tthis._$P[key]=value;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t*根据子节点的索引位置，获取子节点对象。\r\n\t*@param index 索引位置\r\n\t*@return 子节点\r\n\t*/\r\n\t__proto.getChildAt=function(index){\r\n\t\treturn this._childs[index];\r\n\t}\r\n\r\n\t/**\r\n\t*设置子节点的索引位置。\r\n\t*@param node 子节点。\r\n\t*@param index 新的索引。\r\n\t*@return 返回子节点本身。\r\n\t*/\r\n\t__proto.setChildIndex=function(node,index){\r\n\t\tvar childs=this._childs;\r\n\t\tif (index < 0 || index >=childs.length){\r\n\t\t\tthrow new Error(\"setChildIndex:The index is out of bounds.\");\r\n\t\t};\r\n\t\tvar oldIndex=this.getChildIndex(node);\r\n\t\tif (oldIndex < 0)throw new Error(\"setChildIndex:node is must child of this object.\");\r\n\t\tchilds.splice(oldIndex,1);\r\n\t\tchilds.splice(index,0,node);\r\n\t\tif (this.conchModel){\r\n\t\t\tthis.conchModel.removeChild(node.conchModel);\r\n\t\t\tthis.conchModel.addChildAt(node.conchModel,index);\r\n\t\t}\r\n\t\tthis._childChanged();\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*子节点发生改变。\r\n\t*@param child 子节点。\r\n\t*/\r\n\t__proto._childChanged=function(child){}\r\n\t/**\r\n\t*删除子节点。\r\n\t*@param node 子节点\r\n\t*@return 被删除的节点\r\n\t*/\r\n\t__proto.removeChild=function(node){\r\n\t\tif (!this._childs)return node;\r\n\t\tvar index=this._childs.indexOf(node);\r\n\t\treturn this.removeChildAt(index);\r\n\t}\r\n\r\n\t/**\r\n\t*从父容器删除自己，如已经被删除不会抛出异常。\r\n\t*@return 当前节点（ Node ）对象。\r\n\t*/\r\n\t__proto.removeSelf=function(){\r\n\t\tthis._parent && this._parent.removeChild(this);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*根据子节点名字删除对应的子节点对象，如果找不到不会抛出异常。\r\n\t*@param name 对象名字。\r\n\t*@return 查找到的节点（ Node ）对象。\r\n\t*/\r\n\t__proto.removeChildByName=function(name){\r\n\t\tvar node=this.getChildByName(name);\r\n\t\tnode && this.removeChild(node);\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t*根据子节点索引位置，删除对应的子节点对象。\r\n\t*@param index 节点索引位置。\r\n\t*@return 被删除的节点。\r\n\t*/\r\n\t__proto.removeChildAt=function(index){\r\n\t\tvar node=this.getChildAt(index);\r\n\t\tif (node){\r\n\t\t\tthis._childs.splice(index,1);\r\n\t\t\tthis.conchModel && this.conchModel.removeChild(node.conchModel);\r\n\t\t\tnode.parent=null;\r\n\t\t}\r\n\t\treturn node;\r\n\t}\r\n\r\n\t/**\r\n\t*删除指定索引区间的所有子对象。\r\n\t*@param beginIndex 开始索引。\r\n\t*@param endIndex 结束索引。\r\n\t*@return 当前节点对象。\r\n\t*/\r\n\t__proto.removeChildren=function(beginIndex,endIndex){\r\n\t\t(beginIndex===void 0)&& (beginIndex=0);\r\n\t\t(endIndex===void 0)&& (endIndex=0x7fffffff);\r\n\t\tif (this._childs && this._childs.length > 0){\r\n\t\t\tvar childs=this._childs;\r\n\t\t\tif (beginIndex===0 && endIndex >=n){\r\n\t\t\t\tvar arr=childs;\r\n\t\t\t\tthis._childs=Node.ARRAY_EMPTY;\r\n\t\t\t\t}else {\r\n\t\t\t\tarr=childs.splice(beginIndex,endIndex-beginIndex);\r\n\t\t\t}\r\n\t\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\t\tarr[i].parent=null;\r\n\t\t\t\tthis.conchModel && this.conchModel.removeChild(arr[i].conchModel);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*替换子节点。\r\n\t*@internal 将传入的新节点对象替换到已有子节点索引位置处。\r\n\t*@param newNode 新节点。\r\n\t*@param oldNode 老节点。\r\n\t*@return 返回新节点。\r\n\t*/\r\n\t__proto.replaceChild=function(newNode,oldNode){\r\n\t\tvar index=this._childs.indexOf(oldNode);\r\n\t\tif (index >-1){\r\n\t\t\tthis._childs.splice(index,1,newNode);\r\n\t\t\tif (this.conchModel){\r\n\t\t\t\tthis.conchModel.removeChild(oldNode.conchModel);\r\n\t\t\t\tthis.conchModel.addChildAt(newNode.conchModel,index);\r\n\t\t\t}\r\n\t\t\toldNode.parent=null;\r\n\t\t\tnewNode.parent=this;\r\n\t\t\treturn newNode;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._updateDisplayedInstage=function(){\r\n\t\tvar ele;\r\n\t\tele=this;\r\n\t\tvar stage=Laya.stage;\r\n\t\tthis._displayedInStage=false;\r\n\t\twhile (ele){\r\n\t\t\tif (ele._getBit(0x1)){\r\n\t\t\t\tthis._displayedInStage=ele._displayedInStage;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tif (ele==stage || ele._displayedInStage){\r\n\t\t\t\tthis._displayedInStage=true;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tele=ele.parent;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setDisplay=function(value){\r\n\t\tif (this._displayedInStage!==value){\r\n\t\t\tthis._displayedInStage=value;\r\n\t\t\tif (value)this.event(/*laya.events.Event.DISPLAY*/\"display\");\r\n\t\t\telse this.event(/*laya.events.Event.UNDISPLAY*/\"undisplay\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置指定节点对象是否可见(是否在渲染列表中)。\r\n\t*@param node 节点。\r\n\t*@param display 是否可见。\r\n\t*/\r\n\t__proto._displayChild=function(node,display){\r\n\t\tvar childs=node._childs;\r\n\t\tif (childs){\r\n\t\t\tfor (var i=0,n=childs.length;i < n;i++){\r\n\t\t\t\tvar child=childs[i];\r\n\t\t\t\tif (!child._getBit(0x1))continue ;\r\n\t\t\t\tif (child._childs.length > 0){\r\n\t\t\t\t\tthis._displayChild(child,display);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tchild._setDisplay(display);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tnode._setDisplay(display);\r\n\t}\r\n\r\n\t/**\r\n\t*当前容器是否包含指定的 <code>Node</code> 节点对象 。\r\n\t*@param node 指定的 <code>Node</code> 节点对象 。\r\n\t*@return 一个布尔值表示是否包含指定的 <code>Node</code> 节点对象 。\r\n\t*/\r\n\t__proto.contains=function(node){\r\n\t\tif (node===this)return true;\r\n\t\twhile (node){\r\n\t\t\tif (node.parent===this)return true;\r\n\t\t\tnode=node.parent;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*定时重复执行某函数。功能同Laya.timer.timerLoop()。\r\n\t*@param delay 间隔时间(单位毫秒)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 结束时的回调方法。\r\n\t*@param args （可选）回调参数。\r\n\t*@param coverBefore （可选）是否覆盖之前的延迟执行，默认为true。\r\n\t*@param jumpFrame 时钟是否跳帧。基于时间的循环回调，单位时间间隔内，如能执行多次回调，出于性能考虑，引擎默认只执行一次，设置jumpFrame=true后，则回调会连续执行多次\r\n\t*/\r\n\t__proto.timerLoop=function(delay,caller,method,args,coverBefore,jumpFrame){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\t(jumpFrame===void 0)&& (jumpFrame=false);\r\n\t\tthis.timer.loop(delay,caller,method,args,coverBefore,jumpFrame);\r\n\t}\r\n\r\n\t/**\r\n\t*定时执行某函数一次。功能同Laya.timer.timerOnce()。\r\n\t*@param delay 延迟时间(单位毫秒)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 结束时的回调方法。\r\n\t*@param args （可选）回调参数。\r\n\t*@param coverBefore （可选）是否覆盖之前的延迟执行，默认为true。\r\n\t*/\r\n\t__proto.timerOnce=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis.timer._create(false,false,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**\r\n\t*定时重复执行某函数(基于帧率)。功能同Laya.timer.frameLoop()。\r\n\t*@param delay 间隔几帧(单位为帧)。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 结束时的回调方法。\r\n\t*@param args （可选）回调参数。\r\n\t*@param coverBefore （可选）是否覆盖之前的延迟执行，默认为true。\r\n\t*/\r\n\t__proto.frameLoop=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis.timer._create(true,true,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**\r\n\t*定时执行一次某函数(基于帧率)。功能同Laya.timer.frameOnce()。\r\n\t*@param delay 延迟几帧(单位为帧)。\r\n\t*@param caller 执行域(this)\r\n\t*@param method 结束时的回调方法\r\n\t*@param args （可选）回调参数\r\n\t*@param coverBefore （可选）是否覆盖之前的延迟执行，默认为true\r\n\t*/\r\n\t__proto.frameOnce=function(delay,caller,method,args,coverBefore){\r\n\t\t(coverBefore===void 0)&& (coverBefore=true);\r\n\t\tthis.timer._create(true,false,delay,caller,method,args,coverBefore);\r\n\t}\r\n\r\n\t/**\r\n\t*清理定时器。功能同Laya.timer.clearTimer()。\r\n\t*@param caller 执行域(this)。\r\n\t*@param method 结束时的回调方法。\r\n\t*/\r\n\t__proto.clearTimer=function(caller,method){\r\n\t\tthis.timer.clear(caller,method);\r\n\t}\r\n\r\n\t/**\r\n\t*子对象数量。\r\n\t*/\r\n\t__getset(0,__proto,'numChildren',function(){\r\n\t\treturn this._childs.length;\r\n\t});\r\n\r\n\t/**\r\n\t*[只读]是否已经销毁。对象销毁后不能再使用。\r\n\t*@return\r\n\t*/\r\n\t__getset(0,__proto,'destroyed',function(){\r\n\t\treturn this._destroyed;\r\n\t});\r\n\r\n\t/**父节点。*/\r\n\t__getset(0,__proto,'parent',function(){\r\n\t\treturn this._parent;\r\n\t\t},function(value){\r\n\t\tif (this._parent!==value){\r\n\t\t\tif (value){\r\n\t\t\t\tthis._parent=value;\r\n\t\t\t\tthis.event(/*laya.events.Event.ADDED*/\"added\");\r\n\t\t\t\tif (this._getBit(0x1)){\r\n\t\t\t\t\tthis._setUpNoticeChain();\r\n\t\t\t\t\tvalue.displayedInStage && this._displayChild(this,true);\r\n\t\t\t\t}\r\n\t\t\t\tvalue._childChanged(this);\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.event(/*laya.events.Event.REMOVED*/\"removed\");\r\n\t\t\t\tthis._parent._childChanged();\r\n\t\t\t\tif (this._getBit(0x1))this._displayChild(this,false);\r\n\t\t\t\tthis._parent=value;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**表示是否在显示列表中显示。*/\r\n\t__getset(0,__proto,'displayedInStage',function(){\r\n\t\tif (this._getBit(0x1))return this._displayedInStage;\r\n\t\tthis._setUpNoticeType(0x1);\r\n\t\treturn this._displayedInStage;\r\n\t});\r\n\r\n\tNode.ARRAY_EMPTY=[];\r\n\tNode.PROP_EMPTY={};\r\n\tNode.NOTICE_DISPLAY=0x1;\r\n\tNode.MOUSEENABLE=0x2;\r\n\treturn Node;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*<code>CSSStyle</code> 类是元素CSS样式定义类。\r\n*/\r\n//class laya.display.css.CSSStyle extends laya.display.css.Style\r\nvar CSSStyle=(function(_super){\r\n\tfunction CSSStyle(ower){\r\n\t\tthis._bgground=null;\r\n\t\tthis._border=null;\r\n\t\t//this._ower=null;\r\n\t\tthis._rect=null;\r\n\t\t/**@private */\r\n\t\tthis.underLine=0;\r\n\t\t/**行高。 */\r\n\t\tthis.lineHeight=0;\r\n\t\tCSSStyle.__super.call(this);\r\n\t\tthis._padding=CSSStyle._PADDING;\r\n\t\tthis._spacing=CSSStyle._SPACING;\r\n\t\tthis._aligns=CSSStyle._ALIGNS;\r\n\t\tthis._font=Font.EMPTY;\r\n\t\tthis._ower=ower;\r\n\t}\r\n\r\n\t__class(CSSStyle,'laya.display.css.CSSStyle',_super);\r\n\tvar __proto=CSSStyle.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(){\r\n\t\tthis._ower=null;\r\n\t\tthis._font=null;\r\n\t\tthis._rect=null;\r\n\t}\r\n\r\n\t/**\r\n\t*复制传入的 CSSStyle 属性值。\r\n\t*@param src 待复制的 CSSStyle 对象。\r\n\t*/\r\n\t__proto.inherit=function(src){\r\n\t\tthis._font=src._font;\r\n\t\tthis._spacing=src._spacing===CSSStyle._SPACING ? CSSStyle._SPACING :src._spacing.slice();\r\n\t\tthis.lineHeight=src.lineHeight;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._widthAuto=function(){\r\n\t\treturn (this._type & 0x40000)!==0;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.widthed=function(sprite){\r\n\t\treturn (this._type & 0x8)!=0;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._calculation=function(type,value){\r\n\t\tif (value.indexOf('%')< 0)return false;\r\n\t\tvar ower=this._ower;\r\n\t\tvar parent=ower.parent;\r\n\t\tvar rect=this._rect;\r\n\t\tfunction getValue (pw,w,nums){\r\n\t\t\treturn (pw *nums[0]+w *nums[1]+nums[2]);\r\n\t\t}\r\n\t\tfunction onParentResize (type){\r\n\t\t\tvar pw=parent.width,w=ower.width;\r\n\t\t\trect.width && (ower.width=getValue(pw,w,rect.width));\r\n\t\t\trect.height && (ower.height=getValue(pw,w,rect.height));\r\n\t\t\trect.left && (ower.x=getValue(pw,w,rect.left));\r\n\t\t\trect.top && (ower.y=getValue(pw,w,rect.top));\r\n\t\t}\r\n\t\tif (rect===null){\r\n\t\t\tparent._getCSSStyle()._type |=0x80000;\r\n\t\t\tparent.on(/*laya.events.Event.RESIZE*/\"resize\",this,onParentResize);\r\n\t\t\tthis._rect=rect={input:{}};\r\n\t\t};\r\n\t\tvar nums=value.split(' ');\r\n\t\tnums[0]=parseFloat(nums[0])/ 100;\r\n\t\tif (nums.length==1)\r\n\t\t\tnums[1]=nums[2]=0;\r\n\t\telse {\r\n\t\t\tnums[1]=parseFloat(nums[1])/ 100;\r\n\t\t\tnums[2]=parseFloat(nums[2]);\r\n\t\t}\r\n\t\trect[type]=nums;\r\n\t\trect.input[type]=value;\r\n\t\tonParentResize(type);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t*是否已设置高度。\r\n\t*@param sprite 显示对象 Sprite。\r\n\t*@return 一个Boolean 表示是否已设置高度。\r\n\t*/\r\n\t__proto.heighted=function(sprite){\r\n\t\treturn (this._type & 0x2000)!=0;\r\n\t}\r\n\r\n\t/**\r\n\t*设置宽高。\r\n\t*@param w 宽度。\r\n\t*@param h 高度。\r\n\t*/\r\n\t__proto.size=function(w,h){\r\n\t\tvar ower=this._ower;\r\n\t\tvar resize=false;\r\n\t\tif (w!==-1 && w !=this._ower.width){\r\n\t\t\tthis._type |=0x8;\r\n\t\t\tthis._ower.width=w;\r\n\t\t\tresize=true;\r\n\t\t}\r\n\t\tif (h!==-1 && h !=this._ower.height){\r\n\t\t\tthis._type |=0x2000;\r\n\t\t\tthis._ower.height=h;\r\n\t\t\tresize=true;\r\n\t\t}\r\n\t\tif (resize){\r\n\t\t\tower._layoutLater();\r\n\t\t\t(this._type & 0x80000)&& ower.event(/*laya.events.Event.RESIZE*/\"resize\",this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getAlign=function(){\r\n\t\treturn this._aligns[0];\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getValign=function(){\r\n\t\treturn this._aligns[1];\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getCssFloat=function(){\r\n\t\treturn (this._type & 0x8000)!=0 ? 0x8000 :0;\r\n\t}\r\n\r\n\t__proto._createFont=function(){\r\n\t\treturn (this._type & 0x1000)? this._font :(this._type |=0x1000,this._font=new Font(this._font));\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.render=function(sprite,context,x,y){\r\n\t\tvar w=sprite.width;\r\n\t\tvar h=sprite.height;\r\n\t\tx-=sprite.pivotX;\r\n\t\ty-=sprite.pivotY;\r\n\t\tthis._bgground && this._bgground.color !=null && context.ctx.fillRect(x,y,w,h,this._bgground.color);\r\n\t\tthis._border && this._border.color && context.drawRect(x,y,w,h,this._border.color.strColor,this._border.size);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.getCSSStyle=function(){\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*设置 CSS 样式字符串。\r\n\t*@param text CSS样式字符串。\r\n\t*/\r\n\t__proto.cssText=function(text){\r\n\t\tthis.attrs(CSSStyle.parseOneCSS(text,';'));\r\n\t}\r\n\r\n\t/**\r\n\t*根据传入的属性名、属性值列表，设置此对象的属性值。\r\n\t*@param attrs 属性名与属性值列表。\r\n\t*/\r\n\t__proto.attrs=function(attrs){\r\n\t\tif (attrs){\r\n\t\t\tfor (var i=0,n=attrs.length;i < n;i++){\r\n\t\t\t\tvar attr=attrs[i];\r\n\t\t\t\tthis[attr[0]]=attr[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.setTransform=function(value){\r\n\t\t(value==='none')? (this._tf=Style._TF_EMPTY):this.attrs(CSSStyle.parseOneCSS(value,','));\r\n\t}\r\n\r\n\t/**\r\n\t*定义 X 轴、Y 轴移动转换。\r\n\t*@param x X 轴平移量。\r\n\t*@param y Y 轴平移量。\r\n\t*/\r\n\t__proto.translate=function(x,y){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.translateX=x;\r\n\t\tthis._tf.translateY=y;\r\n\t}\r\n\r\n\t/**\r\n\t*定义 缩放转换。\r\n\t*@param x X 轴缩放值。\r\n\t*@param y Y 轴缩放值。\r\n\t*/\r\n\t__proto.scale=function(x,y){\r\n\t\tthis._tf===Style._TF_EMPTY && (this._tf=new TransformInfo());\r\n\t\tthis._tf.scaleX=x;\r\n\t\tthis._tf.scaleY=y;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._enableLayout=function(){\r\n\t\treturn (this._type & 0x2)===0 && (this._type & 0x4)===0;\r\n\t}\r\n\r\n\t/**\r\n\t*是否显示为块级元素。\r\n\t*/\r\n\t__getset(0,__proto,'block',_super.prototype._$get_block,function(value){\r\n\t\tvalue ? (this._type |=0x1):(this._type &=(~0x1));\r\n\t});\r\n\r\n\t/**\r\n\t*垂直对齐方式。\r\n\t*/\r\n\t__getset(0,__proto,'valign',function(){\r\n\t\treturn CSSStyle._valigndef[this._aligns[1]];\r\n\t\t},function(value){\r\n\t\tthis._aligns===CSSStyle._ALIGNS && (this._aligns=[0,0,0]);\r\n\t\tthis._aligns[1]=CSSStyle._valigndef[value];\r\n\t});\r\n\r\n\t/**\r\n\t*高度。\r\n\t*/\r\n\t__getset(0,__proto,'height',null,function(h){\r\n\t\tthis._type |=0x2000;\r\n\t\tif ((typeof h=='string')){\r\n\t\t\tif (this._calculation(\"height\",h))return;\r\n\t\t\th=parseInt(h);\r\n\t\t}\r\n\t\tthis.size(-1,h);\r\n\t});\r\n\r\n\t/**\r\n\t*宽度。\r\n\t*/\r\n\t__getset(0,__proto,'width',null,function(w){\r\n\t\tthis._type |=0x8;\r\n\t\tif ((typeof w=='string')){\r\n\t\t\tvar offset=w.indexOf('auto');\r\n\t\t\tif (offset >=0){\r\n\t\t\t\tthis._type |=0x40000;\r\n\t\t\t\tw=w.substr(0,offset);\r\n\t\t\t}\r\n\t\t\tif (this._calculation(\"width\",w))return;\r\n\t\t\tw=parseInt(w);\r\n\t\t}\r\n\t\tthis.size(w,-1);\r\n\t});\r\n\r\n\t/**\r\n\t*字体粗细。\r\n\t*/\r\n\t__getset(0,__proto,'fontWeight',function(){\r\n\t\treturn this._font.weight;\r\n\t\t},function(value){\r\n\t\tthis._createFont().weight=value;\r\n\t});\r\n\r\n\t/**\r\n\t*表示左边距。\r\n\t*/\r\n\t__getset(0,__proto,'left',null,function(value){\r\n\t\tvar ower=this._ower;\r\n\t\tif (((typeof value=='string'))){\r\n\t\t\tif (value===\"center\")\r\n\t\t\t\tvalue=\"50% -50% 0\";\r\n\t\t\telse if (value===\"right\")\r\n\t\t\tvalue=\"100% -100% 0\";\r\n\t\t\tif (this._calculation(\"left\",value))return;\r\n\t\t\tvalue=parseInt(value);\r\n\t\t}\r\n\t\tower.x=value;\r\n\t});\r\n\r\n\t__getset(0,__proto,'_translate',null,function(value){\r\n\t\tthis.translate(value[0],value[1]);\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'absolute',function(){\r\n\t\treturn (this._type & 0x4)!==0;\r\n\t});\r\n\r\n\t/**\r\n\t*表示上边距。\r\n\t*/\r\n\t__getset(0,__proto,'top',null,function(value){\r\n\t\tvar ower=this._ower;\r\n\t\tif (((typeof value=='string'))){\r\n\t\t\tif (value===\"middle\")\r\n\t\t\t\tvalue=\"50% -50% 0\";\r\n\t\t\telse if (value===\"bottom\")\r\n\t\t\tvalue=\"100% -100% 0\";\r\n\t\t\tif (this._calculation(\"top\",value))return;\r\n\t\t\tvalue=parseInt(value);\r\n\t\t}\r\n\t\tower.y=value;\r\n\t});\r\n\r\n\t/**\r\n\t*水平对齐方式。\r\n\t*/\r\n\t__getset(0,__proto,'align',function(){\r\n\t\treturn CSSStyle._aligndef[this._aligns[0]];\r\n\t\t},function(value){\r\n\t\tthis._aligns===CSSStyle._ALIGNS && (this._aligns=[0,0,0]);\r\n\t\tthis._aligns[0]=CSSStyle._aligndef[value];\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否加粗。\r\n\t*/\r\n\t__getset(0,__proto,'bold',function(){\r\n\t\treturn this._font.bold;\r\n\t\t},function(value){\r\n\t\tthis._createFont().bold=value;\r\n\t});\r\n\r\n\t/**\r\n\t*边距信息。\r\n\t*/\r\n\t__getset(0,__proto,'padding',function(){\r\n\t\treturn this._padding;\r\n\t\t},function(value){\r\n\t\tthis._padding=value;\r\n\t});\r\n\r\n\t/**\r\n\t*行间距。\r\n\t*/\r\n\t__getset(0,__proto,'leading',function(){\r\n\t\treturn this._spacing[1];\r\n\t\t},function(d){\r\n\t\t((typeof d=='string'))&& (d=parseInt(d+\"\"));\r\n\t\tthis._spacing===CSSStyle._SPACING && (this._spacing=[0,0]);\r\n\t\tthis._spacing[1]=d;\r\n\t});\r\n\r\n\t/**\r\n\t*是否是行元素。\r\n\t*/\r\n\t__getset(0,__proto,'lineElement',function(){\r\n\t\treturn (this._type & 0x10000)!=0;\r\n\t\t},function(value){\r\n\t\tvalue ? (this._type |=0x10000):(this._type &=(~0x10000));\r\n\t});\r\n\r\n\t/**\r\n\t*浮动方向。\r\n\t*/\r\n\t__getset(0,__proto,'cssFloat',function(){\r\n\t\treturn (this._type & 0x8000)!=0 ? \"right\" :\"left\";\r\n\t\t},function(value){\r\n\t\tthis.lineElement=false;\r\n\t\tvalue===\"right\" ? (this._type |=0x8000):(this._type &=(~0x8000));\r\n\t});\r\n\r\n\t/**\r\n\t*添加到文本的修饰。\r\n\t*/\r\n\t__getset(0,__proto,'textDecoration',function(){\r\n\t\treturn this._font.decoration;\r\n\t\t},function(value){\r\n\t\tthis._createFont().decoration=value;\r\n\t});\r\n\r\n\t/**\r\n\t*设置如何处理元素内的空白。\r\n\t*/\r\n\t__getset(0,__proto,'whiteSpace',function(){\r\n\t\treturn (this._type & 0x20000)? \"nowrap\" :\"\";\r\n\t\t},function(type){\r\n\t\ttype===\"nowrap\" && (this._type |=0x20000);\r\n\t\ttype===\"none\" && (this._type &=~0x20000);\r\n\t});\r\n\r\n\t__getset(0,__proto,'background',null,function(value){\r\n\t\tif (!value){\r\n\t\t\tthis._bgground=null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._bgground || (this._bgground={});\r\n\t\tthis._bgground.color=value;\r\n\t\tthis._ower.conchModel && this._ower.conchModel.bgColor(value);\r\n\t\tthis._type |=0x4000;\r\n\t\tthis._ower._renderType |=/*laya.renders.RenderSprite.STYLE*/0x100;\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否换行。\r\n\t*/\r\n\t__getset(0,__proto,'wordWrap',function(){\r\n\t\treturn (this._type & 0x20000)===0;\r\n\t\t},function(value){\r\n\t\tvalue ? (this._type &=~0x20000):(this._type |=0x20000);\r\n\t});\r\n\r\n\t/**\r\n\t*字体颜色。\r\n\t*/\r\n\t__getset(0,__proto,'color',function(){\r\n\t\treturn this._font.color;\r\n\t\t},function(value){\r\n\t\tthis._createFont().color=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指定文本字段是否是密码文本字段。</p>\r\n\t*如果此属性的值为 true，则文本字段被视为密码文本字段，并使用星号而不是实际字符来隐藏输入的字符。如果为 false，则不会将文本字段视为密码文本字段。\r\n\t*/\r\n\t__getset(0,__proto,'password',function(){\r\n\t\treturn this._font.password;\r\n\t\t},function(value){\r\n\t\tthis._createFont().password=value;\r\n\t});\r\n\r\n\t/**\r\n\t*背景颜色。\r\n\t*/\r\n\t__getset(0,__proto,'backgroundColor',function(){\r\n\t\treturn this._bgground ? this._bgground.color :null;\r\n\t\t},function(value){\r\n\t\tif (value==='none')this._bgground=null;\r\n\t\telse (this._bgground || (this._bgground={}),this._bgground.color=value);\r\n\t\tthis._ower.conchModel && this._ower.conchModel.bgColor(value);\r\n\t\tthis._ower._renderType |=/*laya.renders.RenderSprite.STYLE*/0x100;\r\n\t});\r\n\r\n\t/**\r\n\t*字体信息。\r\n\t*/\r\n\t__getset(0,__proto,'font',function(){\r\n\t\treturn this._font.toString();\r\n\t\t},function(value){\r\n\t\tthis._createFont().set(value);\r\n\t});\r\n\r\n\t/**\r\n\t*文本的粗细。\r\n\t*/\r\n\t__getset(0,__proto,'weight',null,function(value){\r\n\t\tthis._createFont().weight=value;\r\n\t});\r\n\r\n\t/**\r\n\t*间距。\r\n\t*/\r\n\t__getset(0,__proto,'letterSpacing',function(){\r\n\t\treturn this._spacing[0];\r\n\t\t},function(d){\r\n\t\t((typeof d=='string'))&& (d=parseInt(d+\"\"));\r\n\t\tthis._spacing===CSSStyle._SPACING && (this._spacing=[0,0]);\r\n\t\tthis._spacing[0]=d;\r\n\t});\r\n\r\n\t/**\r\n\t*字体大小。\r\n\t*/\r\n\t__getset(0,__proto,'fontSize',function(){\r\n\t\treturn this._font.size;\r\n\t\t},function(value){\r\n\t\tthis._createFont().size=value;\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否为斜体。\r\n\t*/\r\n\t__getset(0,__proto,'italic',function(){\r\n\t\treturn this._font.italic;\r\n\t\t},function(value){\r\n\t\tthis._createFont().italic=value;\r\n\t});\r\n\r\n\t/**\r\n\t*字体系列。\r\n\t*/\r\n\t__getset(0,__proto,'fontFamily',function(){\r\n\t\treturn this._font.family;\r\n\t\t},function(value){\r\n\t\tthis._createFont().family=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边宽度（以像素为单位）。</p>\r\n\t*默认值0，表示不描边。\r\n\t*@default 0\r\n\t*/\r\n\t__getset(0,__proto,'stroke',function(){\r\n\t\treturn this._font.stroke[0];\r\n\t\t},function(value){\r\n\t\tif (this._createFont().stroke===Font._STROKE)this._font.stroke=[0,\"#000000\"];\r\n\t\tthis._font.stroke[0]=value;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边颜色，以字符串表示。</p>\r\n\t*@default \"#000000\";\r\n\t*/\r\n\t__getset(0,__proto,'strokeColor',function(){\r\n\t\treturn this._font.stroke[1];\r\n\t\t},function(value){\r\n\t\tif (this._createFont().stroke===Font._STROKE)this._font.stroke=[0,\"#000000\"];\r\n\t\tthis._font.stroke[1]=value;\r\n\t});\r\n\r\n\t/**\r\n\t*边框属性，比如border=\"5px solid red\"\r\n\t*/\r\n\t__getset(0,__proto,'border',function(){\r\n\t\treturn this._border ? this._border.value :\"\";\r\n\t\t},function(value){\r\n\t\tif (value=='none'){\r\n\t\t\tthis._border=null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._border || (this._border={});\r\n\t\tthis._border.value=value;\r\n\t\tvar values=value.split(' ');\r\n\t\tthis._border.color=Color.create(values[values.length-1]);\r\n\t\tif (values.length==1){\r\n\t\t\tthis._border.size=1;\r\n\t\t\tthis._border.type='solid';\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar i=0;\r\n\t\tif (values[0].indexOf('px')> 0){\r\n\t\t\tthis._border.size=parseInt(values[0]);\r\n\t\t\ti++;\r\n\t\t}else this._border.size=1;\r\n\t\tthis._border.type=values[i];\r\n\t\tthis._ower._renderType |=/*laya.renders.RenderSprite.STYLE*/0x100;\r\n\t});\r\n\r\n\t/**\r\n\t*边框的颜色。\r\n\t*/\r\n\t__getset(0,__proto,'borderColor',function(){\r\n\t\treturn (this._border && this._border.color)? this._border.color.strColor :null;\r\n\t\t},function(value){\r\n\t\tif (!value){\r\n\t\t\tthis._border=null;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._border || (this._border={size:1,type:'solid'});\r\n\t\tthis._border.color=(value==null)? null :Color.create(value);\r\n\t\tthis._ower.conchModel && this._ower.conchModel.border(this._border.color.strColor);\r\n\t\tthis._ower._renderType |=/*laya.renders.RenderSprite.STYLE*/0x100;\r\n\t});\r\n\r\n\t/**\r\n\t*元素的定位类型。\r\n\t*/\r\n\t__getset(0,__proto,'position',function(){\r\n\t\treturn (this._type & 0x4)? \"absolute\" :\"\";\r\n\t\t},function(value){\r\n\t\tvalue==\"absolute\" ? (this._type |=0x4):(this._type &=~0x4);\r\n\t});\r\n\r\n\t/**\r\n\t*规定元素应该生成的框的类型。\r\n\t*/\r\n\t__getset(0,__proto,'display',null,function(value){\r\n\t\tswitch (value){\r\n\t\t\tcase '':\r\n\t\t\t\tthis._type &=~0x2;\r\n\t\t\t\tthis.visible=true;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'none':\r\n\t\t\t\tthis._type |=0x2;\r\n\t\t\t\tthis.visible=false;\r\n\t\t\t\tthis._ower._layoutLater();\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'paddingLeft',function(){\r\n\t\treturn this.padding[3];\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'paddingTop',function(){\r\n\t\treturn this.padding[0];\r\n\t});\r\n\r\n\t__getset(0,__proto,'_scale',null,function(value){\r\n\t\tthis._ower.scale(value[0],value[1]);\r\n\t});\r\n\r\n\t__getset(0,__proto,'_rotate',null,function(value){\r\n\t\tthis._ower.rotation=value;\r\n\t});\r\n\r\n\tCSSStyle.parseOneCSS=function(text,clipWord){\r\n\t\tvar out=[];\r\n\t\tvar attrs=text.split(clipWord);\r\n\t\tvar valueArray;\r\n\t\tfor (var i=0,n=attrs.length;i < n;i++){\r\n\t\t\tvar attr=attrs[i];\r\n\t\t\tvar ofs=attr.indexOf(':');\r\n\t\t\tvar name=attr.substr(0,ofs).replace(/^\\s+|\\s+$/g,'');\r\n\t\t\tif (name.length==0)\r\n\t\t\t\tcontinue ;\r\n\t\t\tvar value=attr.substr(ofs+1).replace(/^\\s+|\\s+$/g,'');\r\n\t\t\tvar one=[name,value];\r\n\t\t\tswitch (name){\r\n\t\t\t\tcase 'italic':\r\n\t\t\t\tcase 'bold':\r\n\t\t\t\t\tone[1]=value==\"true\";\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'line-height':\r\n\t\t\t\t\tone[0]='lineHeight';\r\n\t\t\t\t\tone[1]=parseInt(value);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'font-size':\r\n\t\t\t\t\tone[0]='fontSize';\r\n\t\t\t\t\tone[1]=parseInt(value);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'padding':\r\n\t\t\t\t\tvalueArray=value.split(' ');\r\n\t\t\t\t\tvalueArray.length > 1 || (valueArray[1]=valueArray[2]=valueArray[3]=valueArray[0]);\r\n\t\t\t\t\tone[1]=[parseInt(valueArray[0]),parseInt(valueArray[1]),parseInt(valueArray[2]),parseInt(valueArray[3])];\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'rotate':\r\n\t\t\t\t\tone[0]=\"_rotate\";\r\n\t\t\t\t\tone[1]=parseFloat(value);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'scale':\r\n\t\t\t\t\tvalueArray=value.split(' ');\r\n\t\t\t\t\tone[0]=\"_scale\";\r\n\t\t\t\t\tone[1]=[parseFloat(valueArray[0]),parseFloat(valueArray[1])];\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase 'translate':\r\n\t\t\t\t\tvalueArray=value.split(' ');\r\n\t\t\t\t\tone[0]=\"_translate\";\r\n\t\t\t\t\tone[1]=[parseInt(valueArray[0]),parseInt(valueArray[1])];\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\t(one[0]=CSSStyle._CSSTOVALUE[name])|| (one[0]=name);\r\n\t\t\t\t}\r\n\t\t\tout.push(one);\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\r\n\tCSSStyle.parseCSS=function(text,uri){\r\n\t\tvar one;\r\n\t\twhile ((one=CSSStyle._parseCSSRegExp.exec(text))!=null){\r\n\t\t\tCSSStyle.styleSheets[one[1]]=CSSStyle.parseOneCSS(one[2],';');\r\n\t\t}\r\n\t}\r\n\r\n\tCSSStyle.styleSheets={};\r\n\tCSSStyle.ALIGN_CENTER=1;\r\n\tCSSStyle.ALIGN_RIGHT=2;\r\n\tCSSStyle.VALIGN_MIDDLE=1;\r\n\tCSSStyle.VALIGN_BOTTOM=2;\r\n\tCSSStyle._CSS_BLOCK=0x1;\r\n\tCSSStyle._DISPLAY_NONE=0x2;\r\n\tCSSStyle._ABSOLUTE=0x4;\r\n\tCSSStyle._WIDTH_SET=0x8;\r\n\tCSSStyle.ADDLAYOUTED=0x200;\r\n\tCSSStyle._NEWFONT=0x1000;\r\n\tCSSStyle._HEIGHT_SET=0x2000;\r\n\tCSSStyle._BACKGROUND_SET=0x4000;\r\n\tCSSStyle._FLOAT_RIGHT=0x8000;\r\n\tCSSStyle._LINE_ELEMENT=0x10000;\r\n\tCSSStyle._NOWARP=0x20000;\r\n\tCSSStyle._WIDTHAUTO=0x40000;\r\n\tCSSStyle._LISTERRESZIE=0x80000;\r\n\t__static(CSSStyle,\r\n\t['EMPTY',function(){return this.EMPTY=new CSSStyle(null);},'_CSSTOVALUE',function(){return this._CSSTOVALUE={'letter-spacing':'letterSpacing','line-spacing':'lineSpacing','white-space':'whiteSpace','line-height':'lineHeight','scale-x':'scaleX','scale-y':'scaleY','translate-x':'translateX','translate-y':'translateY','font-family':'fontFamily','font-weight':'fontWeight','vertical-align':'valign','text-decoration':'textDecoration','background-color':'backgroundColor','border-color':'borderColor','float':'cssFloat'};},'_parseCSSRegExp',function(){return this._parseCSSRegExp=new RegExp(\"([\\.\\#]\\\\w+)\\\\s*{([\\\\s\\\\S]*?)}\",\"g\");},'_aligndef',function(){return this._aligndef={'left':0,'center':1,'right':2,0:'left',1:'center',2:'right'};},'_valigndef',function(){return this._valigndef={'top':0,'middle':1,'bottom':2,0:'top',1:'middle',2:'bottom'};},'_PADDING',function(){return this._PADDING=[0,0,0,0];},'_RECT',function(){return this._RECT=[-1,-1,-1,-1];},'_SPACING',function(){return this._SPACING=[0,0];},'_ALIGNS',function(){return this._ALIGNS=[0,0,0];}\r\n\t]);\r\n\treturn CSSStyle;\r\n})(Style)\r\n\r\n\r\n/**\r\n*@private\r\n*使用Audio标签播放声音\r\n*/\r\n//class laya.media.h5audio.AudioSound extends laya.events.EventDispatcher\r\nvar AudioSound=(function(_super){\r\n\tfunction AudioSound(){\r\n\t\t/**\r\n\t\t*声音URL\r\n\t\t*/\r\n\t\tthis.url=null;\r\n\t\t/**\r\n\t\t*播放用的audio标签\r\n\t\t*/\r\n\t\tthis.audio=null;\r\n\t\t/**\r\n\t\t*是否已加载完成\r\n\t\t*/\r\n\t\tthis.loaded=false;\r\n\t\tAudioSound.__super.call(this);\r\n\t}\r\n\r\n\t__class(AudioSound,'laya.media.h5audio.AudioSound',_super);\r\n\tvar __proto=AudioSound.prototype;\r\n\t/**\r\n\t*释放声音\r\n\t*\r\n\t*/\r\n\t__proto.dispose=function(){\r\n\t\tvar ad=AudioSound._audioCache[this.url];\r\n\t\tif (ad){\r\n\t\t\tad.src=\"\";\r\n\t\t\tdelete AudioSound._audioCache[this.url];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*加载声音\r\n\t*@param url\r\n\t*\r\n\t*/\r\n\t__proto.load=function(url){\r\n\t\turl=URL.formatURL(url);\r\n\t\tthis.url=url;\r\n\t\tvar ad;\r\n\t\tif (url==SoundManager._tMusic){\r\n\t\t\tAudioSound._initMusicAudio();\r\n\t\t\tad=AudioSound._musicAudio;\r\n\t\t\tif (ad.src !=url){\r\n\t\t\t\tAudioSound._audioCache[ad.src]=null;\r\n\t\t\t\tad=null;\r\n\t\t\t}\r\n\t\t\t}else{\r\n\t\t\tad=AudioSound._audioCache[url];\r\n\t\t}\r\n\t\tif (ad && ad.readyState >=2){\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!ad){\r\n\t\t\tif (url==SoundManager._tMusic){\r\n\t\t\t\tAudioSound._initMusicAudio();\r\n\t\t\t\tad=AudioSound._musicAudio;\r\n\t\t\t\t}else{\r\n\t\t\t\tad=Browser.createElement(\"audio\");\r\n\t\t\t}\r\n\t\t\tAudioSound._audioCache[url]=ad;\r\n\t\t\tad.src=url;\r\n\t\t}\r\n\t\tad.addEventListener(\"canplaythrough\",onLoaded);\r\n\t\tad.addEventListener(\"error\",onErr);\r\n\t\tvar me=this;\r\n\t\tfunction onLoaded (){\r\n\t\t\toffs();\r\n\t\t\tme.loaded=true;\r\n\t\t\tme.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t}\r\n\t\tfunction onErr (){\r\n\t\t\tad.load=null;\r\n\t\t\toffs();\r\n\t\t\tme.event(/*laya.events.Event.ERROR*/\"error\");\r\n\t\t}\r\n\t\tfunction offs (){\r\n\t\t\tad.removeEventListener(\"canplaythrough\",onLoaded);\r\n\t\t\tad.removeEventListener(\"error\",onErr);\r\n\t\t}\r\n\t\tthis.audio=ad;\r\n\t\tif (ad.load){\r\n\t\t\tad.load();\r\n\t\t\t}else {\r\n\t\t\tonErr();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*播放声音\r\n\t*@param startTime 起始时间\r\n\t*@param loops 循环次数\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.play=function(startTime,loops){\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\t(loops===void 0)&& (loops=0);\r\n\t\tif (!this.url)return null;\r\n\t\tvar ad;\r\n\t\tif (this.url==SoundManager._tMusic){\r\n\t\t\tad=AudioSound._musicAudio;\r\n\t\t\t}else{\r\n\t\t\tad=AudioSound._audioCache[this.url];\r\n\t\t}\r\n\t\tif (!ad)return null;\r\n\t\tvar tAd;\r\n\t\ttAd=Pool.getItem(\"audio:\"+this.url);\r\n\t\tif (Render.isConchApp){\r\n\t\t\tif (!tAd){\r\n\t\t\t\ttAd=Browser.createElement(\"audio\");\r\n\t\t\t\ttAd.src=this.url;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.url==SoundManager._tMusic){\r\n\t\t\t\tAudioSound._initMusicAudio();\r\n\t\t\t\ttAd=AudioSound._musicAudio;\r\n\t\t\t\ttAd.src=this.url;\r\n\t\t\t\t}else{\r\n\t\t\t\ttAd=tAd ? tAd :ad.cloneNode(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar channel=new AudioSoundChannel(tAd);\r\n\t\tchannel.url=this.url;\r\n\t\tchannel.loops=loops;\r\n\t\tchannel.startTime=startTime;\r\n\t\tchannel.play();\r\n\t\tSoundManager.addChannel(channel);\r\n\t\treturn channel;\r\n\t}\r\n\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\tvar ad;\r\n\t\tad=AudioSound._audioCache[this.url];\r\n\t\tif (!ad)\r\n\t\t\treturn 0;\r\n\t\treturn ad.duration;\r\n\t});\r\n\r\n\tAudioSound._initMusicAudio=function(){\r\n\t\tif (AudioSound._musicAudio)return;\r\n\t\tif (!AudioSound._musicAudio)AudioSound._musicAudio=Browser.createElement(\"audio\");\r\n\t\tif (!Render.isConchApp){\r\n\t\t\tBrowser.document.addEventListener(\"mousedown\",AudioSound._makeMusicOK);\r\n\t\t}\r\n\t}\r\n\r\n\tAudioSound._makeMusicOK=function(){\r\n\t\tBrowser.document.removeEventListener(\"mousedown\",AudioSound._makeMusicOK);\r\n\t\tif (!AudioSound._musicAudio.src){\r\n\t\t\tAudioSound._musicAudio.src=\"\";\r\n\t\t\tAudioSound._musicAudio.load();\r\n\t\t\t}else{\r\n\t\t\tAudioSound._musicAudio.play();\r\n\t\t}\r\n\t}\r\n\r\n\tAudioSound._audioCache={};\r\n\tAudioSound._musicAudio=null;\r\n\treturn AudioSound;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<p> <code>SoundChannel</code> 用来控制程序中的声音。每个声音均分配给一个声道，而且应用程序可以具有混合在一起的多个声道。</p>\r\n*<p> <code>SoundChannel</code> 类包含控制声音的播放、暂停、停止、音量的方法，以及获取声音的播放状态、总时间、当前播放时间、总循环次数、播放地址等信息的方法。</p>\r\n*/\r\n//class laya.media.SoundChannel extends laya.events.EventDispatcher\r\nvar SoundChannel=(function(_super){\r\n\tfunction SoundChannel(){\r\n\t\t/**\r\n\t\t*声音地址。\r\n\t\t*/\r\n\t\tthis.url=null;\r\n\t\t/**\r\n\t\t*循环次数。\r\n\t\t*/\r\n\t\tthis.loops=0;\r\n\t\t/**\r\n\t\t*开始时间。\r\n\t\t*/\r\n\t\tthis.startTime=NaN;\r\n\t\t/**\r\n\t\t*表示声音是否已暂停。\r\n\t\t*/\r\n\t\tthis.isStopped=false;\r\n\t\t/**\r\n\t\t*播放完成处理器。\r\n\t\t*/\r\n\t\tthis.completeHandler=null;\r\n\t\tSoundChannel.__super.call(this);\r\n\t}\r\n\r\n\t__class(SoundChannel,'laya.media.SoundChannel',_super);\r\n\tvar __proto=SoundChannel.prototype;\r\n\t/**\r\n\t*播放。\r\n\t*/\r\n\t__proto.play=function(){}\r\n\t/**\r\n\t*停止。\r\n\t*/\r\n\t__proto.stop=function(){}\r\n\t/**\r\n\t*暂停。\r\n\t*/\r\n\t__proto.pause=function(){}\r\n\t/**\r\n\t*继续播放。\r\n\t*/\r\n\t__proto.resume=function(){}\r\n\t/**\r\n\t*private\r\n\t*/\r\n\t__proto.__runComplete=function(handler){\r\n\t\tif (handler){\r\n\t\t\thandler.run();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*音量范围从 0（静音）至 1（最大音量）。\r\n\t*/\r\n\t__getset(0,__proto,'volume',function(){\r\n\t\treturn 1;\r\n\t\t},function(v){\r\n\t});\r\n\r\n\t/**\r\n\t*获取当前播放时间。\r\n\t*/\r\n\t__getset(0,__proto,'position',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\treturn SoundChannel;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<code>Sound</code> 类是用来播放控制声音的类。\r\n*/\r\n//class laya.media.Sound extends laya.events.EventDispatcher\r\nvar Sound=(function(_super){\r\n\tfunction Sound(){\r\n\t\tSound.__super.call(this);;\r\n\t}\r\n\r\n\t__class(Sound,'laya.media.Sound',_super);\r\n\tvar __proto=Sound.prototype;\r\n\t/**\r\n\t*加载声音。\r\n\t*@param url 地址。\r\n\t*\r\n\t*/\r\n\t__proto.load=function(url){}\r\n\t/**\r\n\t*播放声音。\r\n\t*@param startTime 开始时间,单位秒\r\n\t*@param loops 循环次数,0表示一直循环\r\n\t*@return 声道 SoundChannel 对象。\r\n\t*\r\n\t*/\r\n\t__proto.play=function(startTime,loops){\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\t(loops===void 0)&& (loops=0);\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t*释放声音资源。\r\n\t*\r\n\t*/\r\n\t__proto.dispose=function(){}\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\treturn 0;\r\n\t});\r\n\r\n\treturn Sound;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*web audio api方式播放声音\r\n*/\r\n//class laya.media.webaudio.WebAudioSound extends laya.events.EventDispatcher\r\nvar WebAudioSound=(function(_super){\r\n\tfunction WebAudioSound(){\r\n\t\t/**\r\n\t\t*声音URL\r\n\t\t*/\r\n\t\tthis.url=null;\r\n\t\t/**\r\n\t\t*是否已加载完成\r\n\t\t*/\r\n\t\tthis.loaded=false;\r\n\t\t/**\r\n\t\t*声音文件数据\r\n\t\t*/\r\n\t\tthis.data=null;\r\n\t\t/**\r\n\t\t*声音原始文件数据\r\n\t\t*/\r\n\t\tthis.audioBuffer=null;\r\n\t\t/**\r\n\t\t*待播放的声音列表\r\n\t\t*/\r\n\t\tthis.__toPlays=null;\r\n\t\tWebAudioSound.__super.call(this);\r\n\t}\r\n\r\n\t__class(WebAudioSound,'laya.media.webaudio.WebAudioSound',_super);\r\n\tvar __proto=WebAudioSound.prototype;\r\n\t/**\r\n\t*加载声音\r\n\t*@param url\r\n\t*\r\n\t*/\r\n\t__proto.load=function(url){\r\n\t\tvar me=this;\r\n\t\turl=URL.formatURL(url);\r\n\t\tthis.url=url;\r\n\t\tthis.audioBuffer=WebAudioSound._dataCache[url];\r\n\t\tif (this.audioBuffer){\r\n\t\t\tthis._loaded(this.audioBuffer);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tWebAudioSound.e.on(\"loaded:\"+url,this,this._loaded);\r\n\t\tWebAudioSound.e.on(\"err:\"+url,this,this._err);\r\n\t\tif (WebAudioSound.__loadingSound[url]){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tWebAudioSound.__loadingSound[url]=true;\r\n\t\tvar request=new Browser.window.XMLHttpRequest();\r\n\t\trequest.open(\"GET\",url,true);\r\n\t\trequest.responseType=\"arraybuffer\";\r\n\t\trequest.onload=function (){\r\n\t\t\tme.data=request.response;\r\n\t\t\tWebAudioSound.buffs.push({\"buffer\":me.data,\"url\":me.url});\r\n\t\t\tWebAudioSound.decode();\r\n\t\t};\r\n\t\trequest.onerror=function (e){\r\n\t\t\tme._err();\r\n\t\t}\r\n\t\trequest.send();\r\n\t}\r\n\r\n\t__proto._err=function(){\r\n\t\tthis._removeLoadEvents();\r\n\t\tWebAudioSound.__loadingSound[this.url]=false;\r\n\t\tthis.event(/*laya.events.Event.ERROR*/\"error\");\r\n\t}\r\n\r\n\t__proto._loaded=function(audioBuffer){\r\n\t\tthis._removeLoadEvents();\r\n\t\tthis.audioBuffer=audioBuffer;\r\n\t\tWebAudioSound._dataCache[this.url]=this.audioBuffer;\r\n\t\tthis.loaded=true;\r\n\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t}\r\n\r\n\t__proto._removeLoadEvents=function(){\r\n\t\tWebAudioSound.e.off(\"loaded:\"+this.url,this,this._loaded);\r\n\t\tWebAudioSound.e.off(\"err:\"+this.url,this,this._err);\r\n\t}\r\n\r\n\t__proto.__playAfterLoaded=function(){\r\n\t\tif (!this.__toPlays)return;\r\n\t\tvar i=0,len=0;\r\n\t\tvar toPlays;\r\n\t\ttoPlays=this.__toPlays;\r\n\t\tlen=toPlays.length;\r\n\t\tvar tParams;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttParams=toPlays[i];\r\n\t\t\tif (tParams[2] && !(tParams [2]).isStopped){\r\n\t\t\t\tthis.play(tParams[0],tParams[1],tParams[2]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.__toPlays.length=0;\r\n\t}\r\n\r\n\t/**\r\n\t*播放声音\r\n\t*@param startTime 起始时间\r\n\t*@param loops 循环次数\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__proto.play=function(startTime,loops,channel){\r\n\t\t(startTime===void 0)&& (startTime=0);\r\n\t\t(loops===void 0)&& (loops=0);\r\n\t\tchannel=channel ? channel :new WebAudioSoundChannel();\r\n\t\tif (!this.audioBuffer){\r\n\t\t\tif (this.url){\r\n\t\t\t\tif (!this.__toPlays)this.__toPlays=[];\r\n\t\t\t\tthis.__toPlays.push([startTime,loops,channel]);\r\n\t\t\t\tthis.once(/*laya.events.Event.COMPLETE*/\"complete\",this,this.__playAfterLoaded);\r\n\t\t\t\tthis.load(this.url);\r\n\t\t\t}\r\n\t\t}\r\n\t\tchannel.url=this.url;\r\n\t\tchannel.loops=loops;\r\n\t\tchannel[\"audioBuffer\"]=this.audioBuffer;\r\n\t\tchannel.startTime=startTime;\r\n\t\tchannel.play();\r\n\t\tSoundManager.addChannel(channel);\r\n\t\treturn channel;\r\n\t}\r\n\r\n\t__proto.dispose=function(){\r\n\t\tdelete WebAudioSound._dataCache[this.url];\r\n\t\tdelete WebAudioSound.__loadingSound[this.url];\r\n\t}\r\n\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\tif (this.audioBuffer){\r\n\t\t\treturn this.audioBuffer.duration;\r\n\t\t}\r\n\t\treturn 0;\r\n\t});\r\n\r\n\tWebAudioSound.decode=function(){\r\n\t\tif (WebAudioSound.buffs.length <=0 || WebAudioSound.isDecoding){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tWebAudioSound.isDecoding=true;\r\n\t\tWebAudioSound.tInfo=WebAudioSound.buffs.shift();\r\n\t\tWebAudioSound.ctx.decodeAudioData(WebAudioSound.tInfo[\"buffer\"],WebAudioSound._done,WebAudioSound._fail);\r\n\t}\r\n\r\n\tWebAudioSound._done=function(audioBuffer){\r\n\t\tWebAudioSound.e.event(\"loaded:\"+WebAudioSound.tInfo.url,audioBuffer);\r\n\t\tWebAudioSound.isDecoding=false;\r\n\t\tWebAudioSound.decode();\r\n\t}\r\n\r\n\tWebAudioSound._fail=function(){\r\n\t\tWebAudioSound.e.event(\"err:\"+WebAudioSound.tInfo.url,null);\r\n\t\tWebAudioSound.isDecoding=false;\r\n\t\tWebAudioSound.decode();\r\n\t}\r\n\r\n\tWebAudioSound._playEmptySound=function(){\r\n\t\tif (WebAudioSound.ctx==null){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar source=WebAudioSound.ctx.createBufferSource();\r\n\t\tsource.buffer=WebAudioSound._miniBuffer;\r\n\t\tsource.connect(WebAudioSound.ctx.destination);\r\n\t\tsource.start(0,0,0);\r\n\t}\r\n\r\n\tWebAudioSound._unlock=function(){\r\n\t\tif (WebAudioSound._unlocked){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tWebAudioSound._playEmptySound();\r\n\t\tif (WebAudioSound.ctx.state==\"running\"){\r\n\t\t\tBrowser.document.removeEventListener(\"mousedown\",WebAudioSound._unlock,true);\r\n\t\t\tBrowser.document.removeEventListener(\"touchend\",WebAudioSound._unlock,true);\r\n\t\t\tWebAudioSound._unlocked=true;\r\n\t\t}\r\n\t}\r\n\r\n\tWebAudioSound.initWebAudio=function(){\r\n\t\tif (WebAudioSound.ctx.state !=\"running\"){\r\n\t\t\tWebAudioSound._unlock();\r\n\t\t\tBrowser.document.addEventListener(\"mousedown\",WebAudioSound._unlock,true);\r\n\t\t\tBrowser.document.addEventListener(\"touchend\",WebAudioSound._unlock,true);\r\n\t\t}\r\n\t}\r\n\r\n\tWebAudioSound._dataCache={};\r\n\tWebAudioSound.buffs=[];\r\n\tWebAudioSound.isDecoding=false;\r\n\tWebAudioSound._unlocked=false;\r\n\tWebAudioSound.tInfo=null;\r\n\tWebAudioSound.__loadingSound={};\r\n\t__static(WebAudioSound,\r\n\t['window',function(){return this.window=Browser.window;},'webAudioEnabled',function(){return this.webAudioEnabled=WebAudioSound.window[\"AudioContext\"] || WebAudioSound.window[\"webkitAudioContext\"] || WebAudioSound.window[\"mozAudioContext\"];},'ctx',function(){return this.ctx=WebAudioSound.webAudioEnabled ? new (WebAudioSound.window[\"AudioContext\"] || WebAudioSound.window[\"webkitAudioContext\"] || WebAudioSound.window[\"mozAudioContext\"])():undefined;},'_miniBuffer',function(){return this._miniBuffer=WebAudioSound.ctx.createBuffer(1,1,22050);},'e',function(){return this.e=new EventDispatcher();}\r\n\t]);\r\n\treturn WebAudioSound;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<p> <code>HttpRequest</code> 通过封装 HTML <code>XMLHttpRequest</code> 对象提供了对 HTTP 协议的完全的访问，包括做出 POST 和 HEAD 请求以及普通的 GET 请求的能力。 <code>HttpRequest</code> 只提供以异步的形式返回 Web 服务器的响应，并且能够以文本或者二进制的形式返回内容。</p>\r\n*<p><b>注意：</b>建议每次请求都使用新的 <code>HttpRequest</code> 对象，因为每次调用该对象的send方法时，都会清空之前设置的数据，并重置 HTTP 请求的状态，这会导致之前还未返回响应的请求被重置，从而得不到之前请求的响应结果。</p>\r\n*/\r\n//class laya.net.HttpRequest extends laya.events.EventDispatcher\r\nvar HttpRequest=(function(_super){\r\n\tfunction HttpRequest(){\r\n\t\t/**@private */\r\n\t\tthis._responseType=null;\r\n\t\t/**@private */\r\n\t\tthis._data=null;\r\n\t\tHttpRequest.__super.call(this);\r\n\t\tthis._http=new Browser.window.XMLHttpRequest();\r\n\t}\r\n\r\n\t__class(HttpRequest,'laya.net.HttpRequest',_super);\r\n\tvar __proto=HttpRequest.prototype;\r\n\t/**\r\n\t*发送 HTTP 请求。\r\n\t*@param url 请求的地址。大多数浏览器实施了一个同源安全策略，并且要求这个 URL 与包含脚本的文本具有相同的主机名和端口。\r\n\t*@param data (default=null)发送的数据。\r\n\t*@param method (default=\"get\")用于请求的 HTTP 方法。值包括 \"get\"、\"post\"、\"head\"。\r\n\t*@param responseType (default=\"text\")Web 服务器的响应类型，可设置为 \"text\"、\"json\"、\"xml\"、\"arraybuffer\"。\r\n\t*@param headers (default=null)HTTP 请求的头部信息。参数形如key-value数组：key是头部的名称，不应该包括空白、冒号或换行；value是头部的值，不应该包括换行。比如[\"Content-Type\",\"application/json\"]。\r\n\t*/\r\n\t__proto.send=function(url,data,method,responseType,headers){\r\n\t\t(method===void 0)&& (method=\"get\");\r\n\t\t(responseType===void 0)&& (responseType=\"text\");\r\n\t\tthis._responseType=responseType;\r\n\t\tthis._data=null;\r\n\t\tvar _this=this;\r\n\t\tvar http=this._http;\r\n\t\thttp.open(method,url,true);\r\n\t\tif (headers){\r\n\t\t\tfor (var i=0;i < headers.length;i++){\r\n\t\t\t\thttp.setRequestHeader(headers[i++],headers[i]);\r\n\t\t\t}\r\n\t\t\t}else if (!Render.isConchApp){\r\n\t\t\tif (!data || (typeof data=='string'))http.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");\r\n\t\t\telse http.setRequestHeader(\"Content-Type\",\"application/json\");\r\n\t\t}\r\n\t\thttp.responseType=responseType!==\"arraybuffer\" ? \"text\" :\"arraybuffer\";\r\n\t\thttp.onerror=function (e){\r\n\t\t\t_this._onError(e);\r\n\t\t}\r\n\t\thttp.onabort=function (e){\r\n\t\t\t_this._onAbort(e);\r\n\t\t}\r\n\t\thttp.onprogress=function (e){\r\n\t\t\t_this._onProgress(e);\r\n\t\t}\r\n\t\thttp.onload=function (e){\r\n\t\t\t_this._onLoad(e);\r\n\t\t}\r\n\t\thttp.send(data);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求进度的侦听处理函数。\r\n\t*@param e 事件对象。\r\n\t*/\r\n\t__proto._onProgress=function(e){\r\n\t\tif (e && e.lengthComputable)this.event(/*laya.events.Event.PROGRESS*/\"progress\",e.loaded / e.total);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求中断的侦听处理函数。\r\n\t*@param e 事件对象。\r\n\t*/\r\n\t__proto._onAbort=function(e){\r\n\t\tthis.error(\"Request was aborted by user\");\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求出错侦的听处理函数。\r\n\t*@param e 事件对象。\r\n\t*/\r\n\t__proto._onError=function(e){\r\n\t\tthis.error(\"Request failed Status:\"+this._http.status+\" text:\"+this._http.statusText);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求消息返回的侦听处理函数。\r\n\t*@param e 事件对象。\r\n\t*/\r\n\t__proto._onLoad=function(e){\r\n\t\tvar http=this._http;\r\n\t\tvar status=http.status!==undefined ? http.status :200;\r\n\t\tif (status===200 || status===204 || status===0){\r\n\t\t\tthis.complete();\r\n\t\t\t}else {\r\n\t\t\tthis.error(\"[\"+http.status+\"]\"+http.statusText+\":\"+http.responseURL);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求错误的处理函数。\r\n\t*@param message 错误信息。\r\n\t*/\r\n\t__proto.error=function(message){\r\n\t\tthis.clear();\r\n\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",message);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*请求成功完成的处理函数。\r\n\t*/\r\n\t__proto.complete=function(){\r\n\t\tthis.clear();\r\n\t\tvar flag=true;\r\n\t\ttry {\r\n\t\t\tif (this._responseType===\"json\"){\r\n\t\t\t\tthis._data=JSON.parse(this._http.responseText);\r\n\t\t\t\t}else if (this._responseType===\"xml\"){\r\n\t\t\t\tthis._data=Utils.parseXMLFromString(this._http.responseText);\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._data=this._http.response || this._http.responseText;\r\n\t\t\t}\r\n\t\t\t}catch (e){\r\n\t\t\tflag=false;\r\n\t\t\tthis.error(e.message);\r\n\t\t}\r\n\t\tflag && this.event(/*laya.events.Event.COMPLETE*/\"complete\",(this._data instanceof Array)? [this._data] :this._data);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*清除当前请求。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tvar http=this._http;\r\n\t\thttp.onerror=http.onabort=http.onprogress=http.onload=null;\r\n\t}\r\n\r\n\t/**请求的地址。*/\r\n\t__getset(0,__proto,'url',function(){\r\n\t\treturn this._http.responseURL;\r\n\t});\r\n\r\n\t/**\r\n\t*本对象所封装的原生 XMLHttpRequest 引用。\r\n\t*/\r\n\t__getset(0,__proto,'http',function(){\r\n\t\treturn this._http;\r\n\t});\r\n\r\n\t/**返回的数据。*/\r\n\t__getset(0,__proto,'data',function(){\r\n\t\treturn this._data;\r\n\t});\r\n\r\n\treturn HttpRequest;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<code>Loader</code> 类可用来加载文本、JSON、XML、二进制、图像等资源。\r\n*/\r\n//class laya.net.Loader extends laya.events.EventDispatcher\r\nvar Loader=(function(_super){\r\n\tfunction Loader(){\r\n\t\t/**@private 加载后的数据对象，只读*/\r\n\t\tthis._data=null;\r\n\t\t/**@private */\r\n\t\tthis._class=null;\r\n\t\t/**@private */\r\n\t\tthis._url=null;\r\n\t\t/**@private */\r\n\t\tthis._type=null;\r\n\t\t/**@private */\r\n\t\tthis._cache=false;\r\n\t\t/**@private */\r\n\t\tthis._http=null;\r\n\t\t/**@private 自定义解析不派发complete事件，但会派发loaded事件，手动调用endLoad方法再派发complete事件*/\r\n\t\tthis._customParse=false;\r\n\t\tLoader.__super.call(this);\r\n\t}\r\n\r\n\t__class(Loader,'laya.net.Loader',_super);\r\n\tvar __proto=Loader.prototype;\r\n\t/**\r\n\t*加载资源。加载错误会派发 Event.ERROR 事件，参数为错误信息。\r\n\t*@param url 资源地址。\r\n\t*@param type (default=null)资源类型。可选值为：Loader.TEXT、Loader.JSON、Loader.XML、Loader.BUFFER、Loader.IMAGE、Loader.SOUND、Loader.ATLAS、Loader.FONT。如果为null，则根据文件后缀分析类型。\r\n\t*@param cache (default=true)是否缓存数据。\r\n\t*@param group (default=null)分组名称。\r\n\t*@param ignoreCache (default=false)是否忽略缓存，强制重新加载。\r\n\t*/\r\n\t__proto.load=function(url,type,cache,group,ignoreCache){\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\tthis._url=url;\r\n\t\tif (url.indexOf(\"data:image\")===0)this._type=type=\"image\";\r\n\t\telse {\r\n\t\t\tthis._type=type || (type=this.getTypeFromUrl(url));\r\n\t\t\turl=URL.formatURL(url);\r\n\t\t}\r\n\t\tthis._cache=cache;\r\n\t\tthis._data=null;\r\n\t\tif (!ignoreCache && Loader.loadedMap[url]){\r\n\t\t\tthis._data=Loader.loadedMap[url];\r\n\t\t\tthis.event(/*laya.events.Event.PROGRESS*/\"progress\",1);\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\",this._data);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (group)Loader.setGroup(url,group);\r\n\t\tif (Loader.parserMap[type] !=null){\r\n\t\t\tthis._customParse=true;\r\n\t\t\tif (((Loader.parserMap[type])instanceof laya.utils.Handler ))Loader.parserMap[type].runWith(this);\r\n\t\t\telse Loader.parserMap[type].call(null,this);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (type===\"image\" || type===\"htmlimage\" || type===\"nativeimage\")return this._loadImage(url);\r\n\t\tif (type===\"sound\")return this._loadSound(url);\r\n\t\tif (type===\"ttf\")return this._loadTTF(url);\r\n\t\tif (type==\"atlas\"){\r\n\t\t\tif (Loader.preLoadedAtlasConfigMap[url]){\r\n\t\t\t\tthis.onLoaded(Loader.preLoadedAtlasConfigMap[url]);\r\n\t\t\t\tdelete Loader.preLoadedAtlasConfigMap[url];\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this._http){\r\n\t\t\tthis._http=new HttpRequest();\r\n\t\t\tthis._http.on(/*laya.events.Event.PROGRESS*/\"progress\",this,this.onProgress);\r\n\t\t\tthis._http.on(/*laya.events.Event.ERROR*/\"error\",this,this.onError);\r\n\t\t\tthis._http.on(/*laya.events.Event.COMPLETE*/\"complete\",this,this.onLoaded);\r\n\t\t};\r\n\t\tvar contentType;\r\n\t\tswitch (type){\r\n\t\t\tcase \"atlas\":\r\n\t\t\t\tcontentType=\"json\";\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"font\":\r\n\t\t\t\tcontentType=\"xml\";\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"pkm\":\r\n\t\t\t\tcontentType=\"arraybuffer\";\r\n\t\t\t\tbreak\r\n\t\t\tdefault :\r\n\t\t\t\tcontentType=type;\r\n\t\t\t}\r\n\t\tthis._http.send(url,null,\"get\",contentType);\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定资源地址的数据类型。\r\n\t*@param url 资源地址。\r\n\t*@return 数据类型。\r\n\t*/\r\n\t__proto.getTypeFromUrl=function(url){\r\n\t\tvar type=Utils.getFileExtension(url);\r\n\t\tif (type)return Loader.typeMap[type];\r\n\t\tconsole.warn(\"Not recognize the resources suffix\",url);\r\n\t\treturn \"text\";\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载TTF资源。\r\n\t*@param url 资源地址。\r\n\t*/\r\n\t__proto._loadTTF=function(url){\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar ttfLoader=new TTFLoader();\r\n\t\tttfLoader.complete=Handler.create(this,this.onLoaded);\r\n\t\tttfLoader.load(url);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载图片资源。\r\n\t*@param url 资源地址。\r\n\t*/\r\n\t__proto._loadImage=function(url){\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar _this=this;\r\n\t\tvar image;\r\n\t\tfunction clear (){\r\n\t\t\timage.onload=null;\r\n\t\t\timage.onerror=null;\r\n\t\t\tdelete Loader.imgCache[url]\r\n\t\t};\r\n\t\tvar onload=function (){\r\n\t\t\tclear();\r\n\t\t\t_this.onLoaded(image);\r\n\t\t};\r\n\t\tvar onerror=function (){\r\n\t\t\tclear();\r\n\t\t\t_this.event(/*laya.events.Event.ERROR*/\"error\",\"Load image failed\");\r\n\t\t}\r\n\t\tif (this._type===\"nativeimage\"){\r\n\t\t\timage=new Browser.window.Image();\r\n\t\t\timage.crossOrigin=\"\";\r\n\t\t\timage.onload=onload;\r\n\t\t\timage.onerror=onerror;\r\n\t\t\timage.src=url;\r\n\t\t\tLoader.imgCache[url]=image;\r\n\t\t\t}else {\r\n\t\t\tnew HTMLImage.create(url,{onload:onload,onerror:onerror,onCreate:function (img){\r\n\t\t\t\t\timage=img;\r\n\t\t\t\t\tLoader.imgCache[url]=img;\r\n\t\t\t}});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载声音资源。\r\n\t*@param url 资源地址。\r\n\t*/\r\n\t__proto._loadSound=function(url){\r\n\t\tvar sound=(new SoundManager._soundClass());\r\n\t\tvar _this=this;\r\n\t\tsound.on(/*laya.events.Event.COMPLETE*/\"complete\",this,soundOnload);\r\n\t\tsound.on(/*laya.events.Event.ERROR*/\"error\",this,soundOnErr);\r\n\t\tsound.load(url);\r\n\t\tfunction soundOnload (){\r\n\t\t\tclear();\r\n\t\t\t_this.onLoaded(sound);\r\n\t\t}\r\n\t\tfunction soundOnErr (){\r\n\t\t\tclear();\r\n\t\t\tsound.dispose();\r\n\t\t\t_this.event(/*laya.events.Event.ERROR*/\"error\",\"Load sound failed\");\r\n\t\t}\r\n\t\tfunction clear (){\r\n\t\t\tsound.offAll();\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onProgress=function(value){\r\n\t\tif (this._type===\"atlas\")this.event(/*laya.events.Event.PROGRESS*/\"progress\",value *0.3);\r\n\t\telse this.event(/*laya.events.Event.PROGRESS*/\"progress\",value);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onError=function(message){\r\n\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",message);\r\n\t}\r\n\r\n\t/**\r\n\t*资源加载完成的处理函数。\r\n\t*@param data 数据。\r\n\t*/\r\n\t__proto.onLoaded=function(data){\r\n\t\tvar type=this._type;\r\n\t\tif (type===\"image\"){\r\n\t\t\tvar tex=new Texture(data);\r\n\t\t\ttex.url=this._url;\r\n\t\t\tthis.complete(tex);\r\n\t\t\t}else if (type===\"sound\" || type===\"htmlimage\" || type===\"nativeimage\"){\r\n\t\t\tthis.complete(data);\r\n\t\t\t}else if (type===\"atlas\"){\r\n\t\t\tif (!data.src && !data._setContext){\r\n\t\t\t\tif (!this._data){\r\n\t\t\t\t\tthis._data=data;\r\n\t\t\t\t\tif (data.meta && data.meta.image){\r\n\t\t\t\t\t\tvar toloadPics=data.meta.image.split(\",\");\r\n\t\t\t\t\t\tvar split=this._url.indexOf(\"/\")>=0 ? \"/\" :\"\\\\\";\r\n\t\t\t\t\t\tvar idx=this._url.lastIndexOf(split);\r\n\t\t\t\t\t\tvar folderPath=idx >=0 ? this._url.substr(0,idx+1):\"\";\r\n\t\t\t\t\t\tfor (var i=0,len=toloadPics.length;i < len;i++){\r\n\t\t\t\t\t\t\ttoloadPics[i]=folderPath+toloadPics[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttoloadPics=[this._url.replace(\".json\",\".png\")];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoloadPics.reverse();\r\n\t\t\t\t\tdata.toLoads=toloadPics;\r\n\t\t\t\t\tdata.pics=[];\r\n\t\t\t\t}\r\n\t\t\t\tthis.event(/*laya.events.Event.PROGRESS*/\"progress\",0.3+1 / toloadPics.length *0.6);\r\n\t\t\t\treturn this._loadImage(toloadPics.pop());\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._data.pics.push(data);\r\n\t\t\t\tif (this._data.toLoads.length > 0){\r\n\t\t\t\t\tthis.event(/*laya.events.Event.PROGRESS*/\"progress\",0.3+1 / this._data.toLoads.length *0.6);\r\n\t\t\t\t\treturn this._loadImage(this._data.toLoads.pop());\r\n\t\t\t\t};\r\n\t\t\t\tvar frames=this._data.frames;\r\n\t\t\t\tvar cleanUrl=this._url.split(\"?\")[0];\r\n\t\t\t\tvar directory=(this._data.meta && this._data.meta.prefix)? this._data.meta.prefix :cleanUrl.substring(0,cleanUrl.lastIndexOf(\".\"))+\"/\";\r\n\t\t\t\tvar pics=this._data.pics;\r\n\t\t\t\tvar atlasURL=URL.formatURL(this._url);\r\n\t\t\t\tvar map=Loader.atlasMap[atlasURL] || (Loader.atlasMap[atlasURL]=[]);\r\n\t\t\t\tmap.dir=directory;\r\n\t\t\t\tvar scaleRate=1;\r\n\t\t\t\tif (this._data.meta && this._data.meta.scale && this._data.meta.scale !=1){\r\n\t\t\t\t\tscaleRate=parseFloat(this._data.meta.scale);\r\n\t\t\t\t\tfor (var name in frames){\r\n\t\t\t\t\t\tvar obj=frames[name];\r\n\t\t\t\t\t\tvar tPic=pics[obj.frame.idx ? obj.frame.idx :0];\r\n\t\t\t\t\t\tvar url=URL.formatURL(directory+name);\r\n\t\t\t\t\t\ttPic.scaleRate=scaleRate;\r\n\t\t\t\t\t\tLoader.cacheRes(url,Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h));\r\n\t\t\t\t\t\tLoader.loadedMap[url].url=url;\r\n\t\t\t\t\t\tmap.push(url);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\tfor (name in frames){\r\n\t\t\t\t\t\tobj=frames[name];\r\n\t\t\t\t\t\ttPic=pics[obj.frame.idx ? obj.frame.idx :0];\r\n\t\t\t\t\t\turl=URL.formatURL(directory+name);\r\n\t\t\t\t\t\tLoader.cacheRes(url,Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h));\r\n\t\t\t\t\t\tLoader.loadedMap[url].url=url;\r\n\t\t\t\t\t\tmap.push(url);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdelete this._data.pics;\r\n\t\t\t\tthis.complete(this._data);\r\n\t\t\t}\r\n\t\t\t}else if (type==\"font\"){\r\n\t\t\tif (!data.src){\r\n\t\t\t\tthis._data=data;\r\n\t\t\t\tthis.event(/*laya.events.Event.PROGRESS*/\"progress\",0.5);\r\n\t\t\t\treturn this._loadImage(this._url.replace(\".fnt\",\".png\"));\r\n\t\t\t\t}else {\r\n\t\t\t\tvar bFont=new BitmapFont();\r\n\t\t\t\tbFont.parseFont(this._data,data);\r\n\t\t\t\tvar tArr=this._url.split(\".fnt\")[0].split(\"/\");\r\n\t\t\t\tvar fontName=tArr[tArr.length-1];\r\n\t\t\t\tText.registerBitmapFont(fontName,bFont);\r\n\t\t\t\tthis._data=bFont;\r\n\t\t\t\tthis.complete(this._data);\r\n\t\t\t}\r\n\t\t\t}else if (type==\"pkm\"){\r\n\t\t\tvar image=HTMLImage.create(data,this._url);\r\n\t\t\tvar tex1=new Texture(image);\r\n\t\t\ttex1.url=this._url;\r\n\t\t\tthis.complete(tex1);\r\n\t\t\t}else {\r\n\t\t\tthis.complete(data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*加载完成。\r\n\t*@param data 加载的数据。\r\n\t*/\r\n\t__proto.complete=function(data){\r\n\t\tthis._data=data;\r\n\t\tif (this._customParse){\r\n\t\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\",(data instanceof Array)? [data] :data);\r\n\t\t\t}else {\r\n\t\t\tLoader._loaders.push(this);\r\n\t\t\tif (!Loader._isWorking)Loader.checkNext();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*结束加载，处理是否缓存及派发完成事件 <code>Event.COMPLETE</code> 。\r\n\t*@param content 加载后的数据\r\n\t*/\r\n\t__proto.endLoad=function(content){\r\n\t\tcontent && (this._data=content);\r\n\t\tif (this._cache)Loader.cacheRes(this._url,this._data);\r\n\t\tthis._customParse=false;\r\n\t\tthis.event(/*laya.events.Event.PROGRESS*/\"progress\",1);\r\n\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\",(this.data instanceof Array)? [this.data] :this.data);\r\n\t}\r\n\r\n\t/**加载地址。*/\r\n\t__getset(0,__proto,'url',function(){\r\n\t\treturn this._url;\r\n\t});\r\n\r\n\t/**返回的数据。*/\r\n\t__getset(0,__proto,'data',function(){\r\n\t\treturn this._data;\r\n\t});\r\n\r\n\t/**是否缓存。*/\r\n\t__getset(0,__proto,'cache',function(){\r\n\t\treturn this._cache;\r\n\t});\r\n\r\n\t/**加载类型。*/\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn this._type;\r\n\t});\r\n\r\n\tLoader.checkNext=function(){\r\n\t\tLoader._isWorking=true;\r\n\t\tvar startTimer=Browser.now();\r\n\t\tvar thisTimer=startTimer;\r\n\t\twhile (Loader._startIndex < Loader._loaders.length){\r\n\t\t\tthisTimer=Browser.now();\r\n\t\t\tLoader._loaders[Loader._startIndex].endLoad();\r\n\t\t\tLoader._startIndex++;\r\n\t\t\tif (Browser.now()-startTimer > Loader.maxTimeOut){\r\n\t\t\t\tconsole.warn(\"loader callback cost a long time:\"+(Browser.now()-startTimer)+\" url=\"+Loader._loaders[Loader._startIndex-1].url);\r\n\t\t\t\tLaya.timer.frameOnce(1,null,Loader.checkNext);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tLoader._loaders.length=0;\r\n\t\tLoader._startIndex=0;\r\n\t\tLoader._isWorking=false;\r\n\t}\r\n\r\n\tLoader.clearRes=function(url,forceDispose){\r\n\t\t(forceDispose===void 0)&& (forceDispose=false);\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar arr=Loader.getAtlas(url);\r\n\t\tif (arr){\r\n\t\t\tfor (var i=0,n=arr.length;i < n;i++){\r\n\t\t\t\tvar resUrl=arr[i];\r\n\t\t\t\tvar tex=Loader.getRes(resUrl);\r\n\t\t\t\tdelete Loader.loadedMap[resUrl];\r\n\t\t\t\tif (tex)tex.destroy(forceDispose);\r\n\t\t\t}\r\n\t\t\tarr.length=0;\r\n\t\t\tdelete Loader.atlasMap[url];\r\n\t\t\tdelete Loader.loadedMap[url];\r\n\t\t\t}else {\r\n\t\t\tvar res=Loader.loadedMap[url];\r\n\t\t\tif (res){\r\n\t\t\t\tdelete Loader.loadedMap[url];\r\n\t\t\t\tif ((res instanceof laya.resource.Texture )&& res.bitmap)(res).destroy(forceDispose);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLoader.clearTextureRes=function(url){\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar arr=laya.net.Loader.getAtlas(url);\r\n\t\tvar res=(arr && arr.length>0)? laya.net.Loader.getRes(arr[0]):laya.net.Loader.getRes(url);\r\n\t\tif (res && res.bitmap){\r\n\t\t\tif (Render.isConchApp){\r\n\t\t\t\tif (res.bitmap.source.releaseTexture){\r\n\t\t\t\t\tres.bitmap.source.releaseTexture();\r\n\t\t\t\t}\r\n\t\t\t\t}else if (res.bitmap._atlaser==null){\r\n\t\t\t\tres.bitmap.releaseResource(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tLoader.setAtlasConfigs=function(url,config){\r\n\t\tLoader.preLoadedAtlasConfigMap[URL.formatURL(url)]=config;\r\n\t}\r\n\r\n\tLoader.getRes=function(url){\r\n\t\treturn Loader.loadedMap[URL.formatURL(url)];\r\n\t}\r\n\r\n\tLoader.getAtlas=function(url){\r\n\t\treturn Loader.atlasMap[URL.formatURL(url)];\r\n\t}\r\n\r\n\tLoader.cacheRes=function(url,data){\r\n\t\turl=URL.formatURL(url);\r\n\t\tif (Loader.loadedMap[url] !=null){\r\n\t\t\tconsole.warn(\"Resources already exist,is repeated loading:\",url);\r\n\t\t\t}else {\r\n\t\t\tLoader.loadedMap[url]=data;\r\n\t\t}\r\n\t}\r\n\r\n\tLoader.setGroup=function(url,group){\r\n\t\tif (!Loader.groupMap[group])Loader.groupMap[group]=[];\r\n\t\tLoader.groupMap[group].push(url);\r\n\t}\r\n\r\n\tLoader.clearResByGroup=function(group){\r\n\t\tif (!Loader.groupMap[group])return;\r\n\t\tvar arr=Loader.groupMap[group],i=0,len=arr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tLoader.clearRes(arr[i]);\r\n\t\t}\r\n\t\tarr.length=0;\r\n\t}\r\n\r\n\tLoader.TEXT=\"text\";\r\n\tLoader.JSON=\"json\";\r\n\tLoader.XML=\"xml\";\r\n\tLoader.BUFFER=\"arraybuffer\";\r\n\tLoader.IMAGE=\"image\";\r\n\tLoader.SOUND=\"sound\";\r\n\tLoader.ATLAS=\"atlas\";\r\n\tLoader.FONT=\"font\";\r\n\tLoader.TTF=\"ttf\";\r\n\tLoader.PKM=\"pkm\";\r\n\tLoader.parserMap={};\r\n\tLoader.groupMap={};\r\n\tLoader.maxTimeOut=100;\r\n\tLoader.loadedMap={};\r\n\tLoader.preLoadedAtlasConfigMap={};\r\n\tLoader.atlasMap={};\r\n\tLoader._loaders=[];\r\n\tLoader._isWorking=false;\r\n\tLoader._startIndex=0;\r\n\tLoader.imgCache={};\r\n\t__static(Loader,\r\n\t['typeMap',function(){return this.typeMap={\"png\":\"image\",\"jpg\":\"image\",\"jpeg\":\"image\",\"txt\":\"text\",\"json\":\"json\",\"xml\":\"xml\",\"als\":\"atlas\",\"atlas\":\"atlas\",\"mp3\":\"sound\",\"ogg\":\"sound\",\"wav\":\"sound\",\"part\":\"json\",\"fnt\":\"font\",\"pkm\":\"pkm\",\"ttf\":\"ttf\"};}\r\n\t]);\r\n\treturn Loader;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<p> <code>LoaderManager</code> 类用于用于批量加载资源。此类是单例，不要手动实例化此类，请通过Laya.loader访问。</p>\r\n*<p>全部队列加载完成，会派发 Event.COMPLETE 事件；如果队列中任意一个加载失败，会派发 Event.ERROR 事件，事件回调参数值为加载出错的资源地址。</p>\r\n*<p> <code>LoaderManager</code> 类提供了以下几种功能：<br/>\r\n*多线程：默认5个加载线程，可以通过maxLoader属性修改线程数量；<br/>\r\n*多优先级：有0-4共5个优先级，优先级高的优先加载。0最高，4最低；<br/>\r\n*重复过滤：自动过滤重复加载（不会有多个相同地址的资源同时加载）以及复用缓存资源，防止重复加载；<br/>\r\n*错误重试：资源加载失败后，会重试加载（以最低优先级插入加载队列），retryNum设定加载失败后重试次数，retryDelay设定加载重试的时间间隔。</p>\r\n*@see laya.net.Loader\r\n*/\r\n//class laya.net.LoaderManager extends laya.events.EventDispatcher\r\nvar LoaderManager=(function(_super){\r\n\tvar ResInfo;\r\n\tfunction LoaderManager(){\r\n\t\t/**加载出错后的重试次数，默认重试一次*/\r\n\t\tthis.retryNum=1;\r\n\t\t/**延迟时间多久再进行错误重试，默认立即重试*/\r\n\t\tthis.retryDelay=0;\r\n\t\t/**最大下载线程，默认为5个*/\r\n\t\tthis.maxLoader=5;\r\n\t\t/**@private */\r\n\t\tthis._loaders=[];\r\n\t\t/**@private */\r\n\t\tthis._loaderCount=0;\r\n\t\t/**@private */\r\n\t\tthis._resInfos=[];\r\n\t\t/**@private */\r\n\t\tthis._infoPool=[];\r\n\t\t/**@private */\r\n\t\tthis._maxPriority=5;\r\n\t\t/**@private */\r\n\t\tthis._failRes={};\r\n\t\tLoaderManager.__super.call(this);\r\n\t\tfor (var i=0;i < this._maxPriority;i++)this._resInfos[i]=[];\r\n\t}\r\n\r\n\t__class(LoaderManager,'laya.net.LoaderManager',_super);\r\n\tvar __proto=LoaderManager.prototype;\r\n\t/**\r\n\t*<p>根据clas类型创建一个未初始化资源的对象，随后进行异步加载，资源加载完成后，初始化对象的资源，并通过此对象派发 Event.LOADED 事件，事件回调参数值为此对象本身。套嵌资源的子资源会保留资源路径\"?\"后的部分。</p>\r\n\t*<p>如果url为数组，返回true；否则返回指定的资源类对象，可以通过侦听此对象的 Event.LOADED 事件来判断资源是否已经加载完毕。</p>\r\n\t*<p><b>注意：</b>cache参数只能对文件后缀为atlas的资源进行缓存控制，其他资源会忽略缓存，强制重新加载。</p>\r\n\t*@param url 资源地址或者数组。如果url和clas同时指定了资源类型，优先使用url指定的资源类型。参数形如：[{url:xx,clas:xx,priority:xx,params:xx},{url:xx,clas:xx,priority:xx,params:xx}]。\r\n\t*@param complete 加载结束回调。根据url类型不同分为2种情况：1. url为String类型，也就是单个资源地址，如果加载成功，则回调参数值为加载完成的资源，否则为null；2. url为数组类型，指定了一组要加载的资源，如果全部加载成功，则回调参数值为true，否则为false。\r\n\t*@param progress 资源加载进度回调，回调参数值为当前资源加载的进度信息(0-1)。\r\n\t*@param clas 资源类名。如果url和clas同时指定了资源类型，优先使用url指定的资源类型。参数形如：Texture。\r\n\t*@param params 资源构造参数。\r\n\t*@param priority (default=1)加载的优先级，优先级高的优先加载。有0-4共5个优先级，0最高，4最低。\r\n\t*@param cache 是否缓存加载的资源。\r\n\t*@return 如果url为数组，返回true；否则返回指定的资源类对象。\r\n\t*/\r\n\t__proto.create=function(url,complete,progress,clas,params,priority,cache,group){\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\tif ((url instanceof Array)){\r\n\t\t\tvar items=url;\r\n\t\t\tvar itemCount=items.length;\r\n\t\t\tvar loadedCount=0;\r\n\t\t\tif (progress){\r\n\t\t\t\tvar progress2=Handler.create(progress.caller,progress.method,progress.args,false);\r\n\t\t\t}\r\n\t\t\tfor (var i=0;i < itemCount;i++){\r\n\t\t\t\tvar item=items[i];\r\n\t\t\t\tif ((typeof item=='string'))item=items[i]={url:item};\r\n\t\t\t\titem.progress=0;\r\n\t\t\t\tvar progressHandler=progress ? Handler.create(null,onProgress,[item],false):null;\r\n\t\t\t\tvar completeHandler=(progress || complete)? Handler.create(null,onComplete,[item]):null;\r\n\t\t\t\tthis._create(item.url,completeHandler,progressHandler,item.clas || clas,item.params || params,item.priority || priority,cache,item.group || group);\r\n\t\t\t}\r\n\t\t\tfunction onComplete (item,content){\r\n\t\t\t\tloadedCount++;\r\n\t\t\t\titem.progress=1;\r\n\t\t\t\tif (loadedCount===itemCount && complete){\r\n\t\t\t\t\tcomplete.run();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfunction onProgress (item,value){\r\n\t\t\t\titem.progress=value;\r\n\t\t\t\tvar num=0;\r\n\t\t\t\tfor (var j=0;j < itemCount;j++){\r\n\t\t\t\t\tvar item1=items[j];\r\n\t\t\t\t\tnum+=item1.progress;\r\n\t\t\t\t};\r\n\t\t\t\tvar v=num / itemCount;\r\n\t\t\t\tprogress2.runWith(v);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}else return this._create(url,complete,progress,clas,params,priority,cache,group);\r\n\t}\r\n\r\n\t__proto._create=function(url,complete,progress,clas,params,priority,cache,group){\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\turl=URL.formatURL(url);\r\n\t\tvar item=this.getRes(url);\r\n\t\tif (!item){\r\n\t\t\tvar extension=Utils.getFileExtension(url);\r\n\t\t\tvar creatItem=LoaderManager.createMap[extension];\r\n\t\t\tif (!creatItem)\r\n\t\t\t\tthrow new Error(\"LoaderManager:unknown file(\"+url+\") extension with: \"+extension+\".\");\r\n\t\t\tif (!clas)clas=creatItem[0];\r\n\t\t\tvar type=creatItem[1];\r\n\t\t\tif (extension==\"atlas\"){\r\n\t\t\t\tthis.load(url,complete,progress,type,priority,cache);\r\n\t\t\t\t}else {\r\n\t\t\t\tif (clas===Texture)type=\"htmlimage\";\r\n\t\t\t\titem=clas ? new clas():null;\r\n\t\t\t\tif (item.hasOwnProperty(\"_loaded\"))\r\n\t\t\t\t\titem._loaded=false;\r\n\t\t\t\titem._setUrl(url);\r\n\t\t\t\t(group)&& (item._setGroup(group));\r\n\t\t\t\tthis._createLoad(item,url,Handler.create(null,onLoaded),progress,type,priority,false,group,true);\r\n\t\t\t\tfunction onLoaded (data){\r\n\t\t\t\t\t(item && !item.destroyed && data)&& (item.onAsynLoaded.call(item,url,data,params));\r\n\t\t\t\t\tif (complete)complete.run();\r\n\t\t\t\t\tLaya.loader.event(url);\r\n\t\t\t\t}\r\n\t\t\t\t(cache)&& (this.cacheRes(url,item));\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tif (!item.hasOwnProperty(\"loaded\")|| item.loaded){\r\n\t\t\t\tprogress && progress.runWith(1);\r\n\t\t\t\tcomplete && complete.run();\r\n\t\t\t\t}else if (complete){\r\n\t\t\t\tLaya.loader._createListener(url,complete.caller,complete.method,complete.args,true,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn item;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>加载资源。资源加载错误时，本对象会派发 Event.ERROR 事件，事件回调参数值为加载出错的资源地址。</p>\r\n\t*<p>因为返回值为 LoaderManager 对象本身，所以可以使用如下语法：Laya.loader.load(...).load(...);</p>\r\n\t*@param url 要加载的单个资源地址或资源信息数组。比如：简单数组：[\"a.png\",\"b.png\"]；复杂数组[{url:\"a.png\",type:Loader.IMAGE,size:100,priority:1},{url:\"b.json\",type:Loader.JSON,size:50,priority:1}]。\r\n\t*@param complete 加载结束回调。根据url类型不同分为2种情况：1. url为String类型，也就是单个资源地址，如果加载成功，则回调参数值为加载完成的资源，否则为null；2. url为数组类型，指定了一组要加载的资源，如果全部加载成功，则回调参数值为true，否则为false。\r\n\t*@param progress 加载进度回调。回调参数值为当前资源的加载进度信息(0-1)。\r\n\t*@param type 资源类型。比如：Loader.IMAGE。\r\n\t*@param priority (default=1)加载的优先级，优先级高的优先加载。有0-4共5个优先级，0最高，4最低。\r\n\t*@param cache 是否缓存加载结果。\r\n\t*@param group 分组，方便对资源进行管理。\r\n\t*@param ignoreCache 是否忽略缓存，强制重新加载。\r\n\t*@return 此 LoaderManager 对象本身。\r\n\t*/\r\n\t__proto.load=function(url,complete,progress,type,priority,cache,group,ignoreCache){\r\n\t\tvar _$this=this;\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\tif ((url instanceof Array))return this._loadAssets(url,complete,progress,type,priority,cache,group);\r\n\t\tvar content=Loader.getRes(url);\r\n\t\tif (content !=null){\r\n\t\t\tLaya.timer.frameOnce(1,null,function(){\r\n\t\t\t\tprogress && progress.runWith(1);\r\n\t\t\t\tcomplete && complete.runWith(content);\r\n\t\t\t\t_$this._loaderCount || _$this.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t});\r\n\t\t\t}else {\r\n\t\t\tvar info=LoaderManager._resMap[url];\r\n\t\t\tif (!info){\r\n\t\t\t\tinfo=this._infoPool.length ? this._infoPool.pop():new ResInfo();\r\n\t\t\t\tinfo.url=url;\r\n\t\t\t\tinfo.type=type;\r\n\t\t\t\tinfo.cache=cache;\r\n\t\t\t\tinfo.group=group;\r\n\t\t\t\tinfo.ignoreCache=ignoreCache;\r\n\t\t\t\tcomplete && info.on(/*laya.events.Event.COMPLETE*/\"complete\",complete.caller,complete.method,complete.args);\r\n\t\t\t\tprogress && info.on(/*laya.events.Event.PROGRESS*/\"progress\",progress.caller,progress.method,progress.args);\r\n\t\t\t\tLoaderManager._resMap[url]=info;\r\n\t\t\t\tpriority=priority < this._maxPriority ? priority :this._maxPriority-1;\r\n\t\t\t\tthis._resInfos[priority].push(info);\r\n\t\t\t\tthis._next();\r\n\t\t\t\t}else {\r\n\t\t\t\tcomplete && info._createListener(/*laya.events.Event.COMPLETE*/\"complete\",complete.caller,complete.method,complete.args,false,false);\r\n\t\t\t\tprogress && info._createListener(/*laya.events.Event.PROGRESS*/\"progress\",progress.caller,progress.method,progress.args,false,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._createLoad=function(item,url,complete,progress,type,priority,cache,group,ignoreCache){\r\n\t\tvar _$this=this;\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\t(ignoreCache===void 0)&& (ignoreCache=false);\r\n\t\tif ((url instanceof Array))return this._loadAssets(url,complete,progress,type,priority,cache,group);\r\n\t\tvar content=Loader.getRes(url);\r\n\t\tif (content !=null){\r\n\t\t\tLaya.timer.frameOnce(1,null,function(){\r\n\t\t\t\tprogress && progress.runWith(1);\r\n\t\t\t\tcomplete && complete.runWith(content);\r\n\t\t\t\t_$this._loaderCount || _$this.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t});\r\n\t\t\t}else {\r\n\t\t\tvar info=LoaderManager._resMap[url];\r\n\t\t\tif (!info){\r\n\t\t\t\tinfo=this._infoPool.length ? this._infoPool.pop():new ResInfo();\r\n\t\t\t\tinfo.url=url;\r\n\t\t\t\tinfo.clas=item;\r\n\t\t\t\tinfo.type=type;\r\n\t\t\t\tinfo.cache=cache;\r\n\t\t\t\tinfo.group=group;\r\n\t\t\t\tinfo.ignoreCache=ignoreCache;\r\n\t\t\t\tcomplete && info.on(/*laya.events.Event.COMPLETE*/\"complete\",complete.caller,complete.method,complete.args);\r\n\t\t\t\tprogress && info.on(/*laya.events.Event.PROGRESS*/\"progress\",progress.caller,progress.method,progress.args);\r\n\t\t\t\tLoaderManager._resMap[url]=info;\r\n\t\t\t\tpriority=priority < this._maxPriority ? priority :this._maxPriority-1;\r\n\t\t\t\tthis._resInfos[priority].push(info);\r\n\t\t\t\tthis._next();\r\n\t\t\t\t}else {\r\n\t\t\t\tcomplete && info._createListener(/*laya.events.Event.COMPLETE*/\"complete\",complete.caller,complete.method,complete.args,false,false);\r\n\t\t\t\tprogress && info._createListener(/*laya.events.Event.PROGRESS*/\"progress\",progress.caller,progress.method,progress.args,false,false);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t__proto._next=function(){\r\n\t\tif (this._loaderCount >=this.maxLoader)return;\r\n\t\tfor (var i=0;i < this._maxPriority;i++){\r\n\t\t\tvar infos=this._resInfos[i];\r\n\t\t\twhile (infos.length > 0){\r\n\t\t\t\tvar info=infos.shift();\r\n\t\t\t\tif (info)return this._doLoad(info);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._loaderCount || this.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t}\r\n\r\n\t__proto._doLoad=function(resInfo){\r\n\t\tthis._loaderCount++;\r\n\t\tvar loader=this._loaders.length ? this._loaders.pop():new Loader();\r\n\t\tloader.on(/*laya.events.Event.COMPLETE*/\"complete\",null,onLoaded);\r\n\t\tloader.on(/*laya.events.Event.PROGRESS*/\"progress\",null,function(num){\r\n\t\t\tresInfo.event(/*laya.events.Event.PROGRESS*/\"progress\",num);\r\n\t\t});\r\n\t\tloader.on(/*laya.events.Event.ERROR*/\"error\",null,function(msg){\r\n\t\t\tonLoaded(null);\r\n\t\t});\r\n\t\tvar _this=this;\r\n\t\tfunction onLoaded (data){\r\n\t\t\tloader.offAll();\r\n\t\t\tloader._data=null;\r\n\t\t\t_this._loaders.push(loader);\r\n\t\t\t_this._endLoad(resInfo,(data instanceof Array)? [data] :data);\r\n\t\t\t_this._loaderCount--;\r\n\t\t\t_this._next();\r\n\t\t}\r\n\t\tloader._class=resInfo.clas;\r\n\t\tloader.load(resInfo.url,resInfo.type,resInfo.cache,resInfo.group,resInfo.ignoreCache);\r\n\t}\r\n\r\n\t__proto._endLoad=function(resInfo,content){\r\n\t\tvar url=resInfo.url;\r\n\t\tif (content==null){\r\n\t\t\tvar errorCount=this._failRes[url] || 0;\r\n\t\t\tif (errorCount < this.retryNum){\r\n\t\t\t\tconsole.warn(\"[warn]Retry to load:\",url);\r\n\t\t\t\tthis._failRes[url]=errorCount+1;\r\n\t\t\t\tLaya.timer.once(this.retryDelay,this,this._addReTry,[resInfo],false);\r\n\t\t\t\treturn;\r\n\t\t\t\t}else {\r\n\t\t\t\tconsole.warn(\"[error]Failed to load:\",url);\r\n\t\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",url);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._failRes[url])this._failRes[url]=0;\r\n\t\tdelete LoaderManager._resMap[url];\r\n\t\tresInfo.event(/*laya.events.Event.COMPLETE*/\"complete\",content);\r\n\t\tresInfo.offAll();\r\n\t\tthis._infoPool.push(resInfo);\r\n\t}\r\n\r\n\t__proto._addReTry=function(resInfo){\r\n\t\tthis._resInfos[this._maxPriority-1].push(resInfo);\r\n\t\tthis._next();\r\n\t}\r\n\r\n\t/**\r\n\t*清理指定资源地址缓存。\r\n\t*@param url 资源地址。\r\n\t*@param forceDispose 是否强制销毁，有些资源是采用引用计数方式销毁，如果forceDispose=true，则忽略引用计数，直接销毁，比如Texture，默认为false\r\n\t*/\r\n\t__proto.clearRes=function(url,forceDispose){\r\n\t\t(forceDispose===void 0)&& (forceDispose=false);\r\n\t\tLoader.clearRes(url,forceDispose);\r\n\t}\r\n\r\n\t/**\r\n\t*获取指定资源地址的资源。\r\n\t*@param url 资源地址。\r\n\t*@return 返回资源。\r\n\t*/\r\n\t__proto.getRes=function(url){\r\n\t\treturn Loader.getRes(url);\r\n\t}\r\n\r\n\t/**\r\n\t*缓存资源。\r\n\t*@param url 资源地址。\r\n\t*@param data 要缓存的内容。\r\n\t*/\r\n\t__proto.cacheRes=function(url,data){\r\n\t\tLoader.cacheRes(url,data);\r\n\t}\r\n\r\n\t/**\r\n\t*销毁Texture使用的图片资源，保留texture壳，如果下次渲染的时候，发现texture使用的图片资源不存在，则会自动恢复\r\n\t*相比clearRes，clearTextureRes只是清理texture里面使用的图片资源，并不销毁texture，再次使用到的时候会自动恢复图片资源\r\n\t*而clearRes会彻底销毁texture，导致不能再使用；clearTextureRes能确保立即销毁图片资源，并且不用担心销毁错误，clearRes则采用引用计数方式销毁\r\n\t*【注意】如果图片本身在自动合集里面（默认图片小于512*512），内存是不能被销毁的，此图片被大图合集管理器管理\r\n\t*@param url 图集地址或者texture地址，比如 Loader.clearTextureRes(\"res/atlas/comp.atlas\");Loader.clearTextureRes(\"hall/bg.jpg\");\r\n\t*/\r\n\t__proto.clearTextureRes=function(url){\r\n\t\tLoader.clearTextureRes(url);\r\n\t}\r\n\r\n\t/**\r\n\t*设置资源分组。\r\n\t*@param url 资源地址。\r\n\t*@param group 分组名\r\n\t*/\r\n\t__proto.setGroup=function(url,group){\r\n\t\tLoader.setGroup(url,group);\r\n\t}\r\n\r\n\t/**\r\n\t*根据分组清理资源。\r\n\t*@param group 分组名\r\n\t*/\r\n\t__proto.clearResByGroup=function(group){\r\n\t\tLoader.clearResByGroup(group);\r\n\t}\r\n\r\n\t/**清理当前未完成的加载，所有未加载的内容全部停止加载。*/\r\n\t__proto.clearUnLoaded=function(){\r\n\t\tfor (var i=0;i < this._maxPriority;i++){\r\n\t\t\tvar infos=this._resInfos[i];\r\n\t\t\tfor (var j=infos.length-1;j >-1;j--){\r\n\t\t\t\tvar info=infos[j];\r\n\t\t\t\tif (info){\r\n\t\t\t\t\tinfo.offAll();\r\n\t\t\t\t\tthis._infoPool.push(info);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tinfos.length=0;\r\n\t\t}\r\n\t\tthis._loaderCount=0;\r\n\t\tLoaderManager._resMap={};\r\n\t}\r\n\r\n\t/**\r\n\t*根据地址集合清理掉未加载的内容\r\n\t*@param urls 资源地址集合\r\n\t*/\r\n\t__proto.cancelLoadByUrls=function(urls){\r\n\t\tif (!urls)return;\r\n\t\tfor (var i=0,n=urls.length;i < n;i++){\r\n\t\t\tthis.cancelLoadByUrl(urls[i]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*根据地址清理掉未加载的内容\r\n\t*@param url 资源地址\r\n\t*/\r\n\t__proto.cancelLoadByUrl=function(url){\r\n\t\tfor (var i=0;i < this._maxPriority;i++){\r\n\t\t\tvar infos=this._resInfos[i];\r\n\t\t\tfor (var j=infos.length-1;j >-1;j--){\r\n\t\t\t\tvar info=infos[j];\r\n\t\t\t\tif (info && info.url===url){\r\n\t\t\t\t\tinfos[j]=null;\r\n\t\t\t\t\tinfo.offAll();\r\n\t\t\t\t\tthis._infoPool.push(info);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (LoaderManager._resMap[url])delete LoaderManager._resMap[url];\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载数组里面的资源。\r\n\t*@param arr 简单：[\"a.png\",\"b.png\"]，复杂[{url:\"a.png\",type:Loader.IMAGE,size:100,priority:1},{url:\"b.json\",type:Loader.JSON,size:50,priority:1}]*/\r\n\t__proto._loadAssets=function(arr,complete,progress,type,priority,cache,group){\r\n\t\t(priority===void 0)&& (priority=1);\r\n\t\t(cache===void 0)&& (cache=true);\r\n\t\tvar itemCount=arr.length;\r\n\t\tvar loadedCount=0;\r\n\t\tvar totalSize=0;\r\n\t\tvar items=[];\r\n\t\tvar success=true;\r\n\t\tfor (var i=0;i < itemCount;i++){\r\n\t\t\tvar item=arr[i];\r\n\t\t\tif ((typeof item=='string'))item={url:item,type:type,size:1,priority:priority};\r\n\t\t\tif (!item.size)item.size=1;\r\n\t\t\titem.progress=0;\r\n\t\t\ttotalSize+=item.size;\r\n\t\t\titems.push(item);\r\n\t\t\tvar progressHandler=progress ? Handler.create(null,loadProgress,[item],false):null;\r\n\t\t\tvar completeHandler=(complete || progress)? Handler.create(null,loadComplete,[item]):null;\r\n\t\t\tthis.load(item.url,completeHandler,progressHandler,item.type,item.priority || 1,cache,item.group || group);\r\n\t\t}\r\n\t\tfunction loadComplete (item,content){\r\n\t\t\tloadedCount++;\r\n\t\t\titem.progress=1;\r\n\t\t\tif (!content)success=false;\r\n\t\t\tif (loadedCount===itemCount && complete){\r\n\t\t\t\tcomplete.runWith(success);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction loadProgress (item,value){\r\n\t\t\tif (progress !=null){\r\n\t\t\t\titem.progress=value;\r\n\t\t\t\tvar num=0;\r\n\t\t\t\tfor (var j=0;j < items.length;j++){\r\n\t\t\t\t\tvar item1=items[j];\r\n\t\t\t\t\tnum+=item1.size *item1.progress;\r\n\t\t\t\t};\r\n\t\t\t\tvar v=num / totalSize;\r\n\t\t\t\tprogress.runWith(v);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tLoaderManager.cacheRes=function(url,data){\r\n\t\tLoader.cacheRes(url,data);\r\n\t}\r\n\r\n\tLoaderManager._resMap={};\r\n\t__static(LoaderManager,\r\n\t['createMap',function(){return this.createMap={atlas:[null,/*laya.net.Loader.ATLAS*/\"atlas\"]};}\r\n\t]);\r\n\tLoaderManager.__init$=function(){\r\n\t\t//class ResInfo extends laya.events.EventDispatcher\r\n\t\tResInfo=(function(_super){\r\n\t\t\tfunction ResInfo(){\r\n\t\t\t\tthis.url=null;\r\n\t\t\t\tthis.type=null;\r\n\t\t\t\tthis.cache=false;\r\n\t\t\t\tthis.group=null;\r\n\t\t\t\tthis.ignoreCache=false;\r\n\t\t\t\tthis.clas=null;\r\n\t\t\t\tResInfo.__super.call(this);\r\n\t\t\t}\r\n\t\t\t__class(ResInfo,'',_super);\r\n\t\t\treturn ResInfo;\r\n\t\t})(EventDispatcher)\r\n\t}\r\n\r\n\treturn LoaderManager;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<p><code>ColorFilter</code> 是颜色滤镜。使用 ColorFilter 类可以将 4 x 5 矩阵转换应用于输入图像上的每个像素的 RGBA 颜色和 Alpha 值，以生成具有一组新的 RGBA 颜色和 Alpha 值的结果。该类允许饱和度更改、色相旋转、亮度转 Alpha 以及各种其他效果。您可以将滤镜应用于任何显示对象（即，从 Sprite 类继承的对象）。</p>\r\n*<p>注意：对于 RGBA 值，最高有效字节代表红色通道值，其后的有效字节分别代表绿色、蓝色和 Alpha 通道值。</p>\r\n*/\r\n//class laya.filters.ColorFilter extends laya.filters.Filter\r\nvar ColorFilter=(function(_super){\r\n\tfunction ColorFilter(mat){\r\n\t\t/**@private */\r\n\t\t//this._mat=null;\r\n\t\t/**@private */\r\n\t\t//this._alpha=null;\r\n\t\tColorFilter.__super.call(this);\r\n\t\tif (!mat){\r\n\t\t\tmat=[0.3,0.59,0.11,0,0,0.3,0.59,0.11,0,0,0.3,0.59,0.11,0,0,0,0,0,1,0];\r\n\t\t}\r\n\t\tthis._mat=new Float32Array(16);\r\n\t\tthis._alpha=new Float32Array(4);\r\n\t\tvar j=0;\r\n\t\tvar z=0;\r\n\t\tfor (var i=0;i < 20;i++){\r\n\t\t\tif (i % 5 !=4){\r\n\t\t\t\tthis._mat[j++]=mat[i];\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._alpha[z++]=mat[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._action=RunDriver.createFilterAction(0x20);\r\n\t\tthis._action.data=this;\r\n\t}\r\n\r\n\t__class(ColorFilter,'laya.filters.ColorFilter',_super);\r\n\tvar __proto=ColorFilter.prototype;\r\n\tLaya.imps(__proto,{\"laya.filters.IFilter\":true})\r\n\t/**\r\n\t*@private 通知微端\r\n\t*/\r\n\t__proto.callNative=function(sp){\r\n\t\tvar t=sp._$P.cf=this;\r\n\t\tsp.conchModel && sp.conchModel.setFilterMatrix && sp.conchModel.setFilterMatrix(this._mat,this._alpha);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn 0x20;\r\n\t});\r\n\r\n\t/**@private */\r\n\t__getset(0,__proto,'action',function(){\r\n\t\treturn this._action;\r\n\t});\r\n\r\n\treturn ColorFilter;\r\n})(Filter)\r\n\r\n\r\n/**\r\n*<p> <code>Socket</code> 封装了 HTML5 WebSocket ，允许服务器端与客户端进行全双工（full-duplex）的实时通信，并且允许跨域通信。在建立连接后，服务器和 Browser/Client Agent 都能主动的向对方发送或接收文本和二进制数据。</p>\r\n*<p>要使用 <code>Socket</code> 类的方法，请先使用构造函数 <code>new Socket</code> 创建一个 <code>Socket</code> 对象。 <code>Socket</code> 以异步方式传输和接收数据。</p>\r\n*/\r\n//class laya.net.Socket extends laya.events.EventDispatcher\r\nvar Socket=(function(_super){\r\n\tfunction Socket(host,port,byteClass){\r\n\t\t/**@private */\r\n\t\tthis._endian=null;\r\n\t\t/**@private */\r\n\t\tthis._stamp=NaN;\r\n\t\t/**@private */\r\n\t\tthis._socket=null;\r\n\t\t/**@private */\r\n\t\tthis._connected=false;\r\n\t\t/**@private */\r\n\t\tthis._addInputPosition=0;\r\n\t\t/**@private */\r\n\t\tthis._input=null;\r\n\t\t/**@private */\r\n\t\tthis._output=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*表示建立连接时需等待的毫秒数。\r\n\t\t*/\r\n\t\tthis.timeout=0;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*在写入或读取对象时，控制所使用的 AMF 的版本。\r\n\t\t*/\r\n\t\tthis.objectEncoding=0;\r\n\t\t/**\r\n\t\t*不再缓存服务端发来的数据。\r\n\t\t*/\r\n\t\tthis.disableInput=false;\r\n\t\t/**\r\n\t\t*用来发送和接收数据的 <code>Byte</code> 类。\r\n\t\t*/\r\n\t\tthis._byteClass=null;\r\n\t\t/**\r\n\t\t*<p>子协议名称。子协议名称字符串，或由多个子协议名称字符串构成的数组。必须在调用 connect 或者 connectByUrl 之前进行赋值，否则无效。</p>\r\n\t\t*<p>指定后，只有当服务器选择了其中的某个子协议，连接才能建立成功，否则建立失败，派发 Event.ERROR 事件。</p>\r\n\t\t*@see https://html.spec.whatwg.org/multipage/comms.html#dom-websocket\r\n\t\t*/\r\n\t\tthis.protocols=[];\r\n\t\t(port===void 0)&& (port=0);\r\n\t\tSocket.__super.call(this);\r\n\t\tthis._byteClass=byteClass ? byteClass :Byte;\r\n\t\tthis.endian=\"bigEndian\";\r\n\t\tthis.timeout=20000;\r\n\t\tthis._addInputPosition=0;\r\n\t\tif (host && port > 0 && port < 65535)\r\n\t\t\tthis.connect(host,port);\r\n\t}\r\n\r\n\t__class(Socket,'laya.net.Socket',_super);\r\n\tvar __proto=Socket.prototype;\r\n\t/**\r\n\t*<p>连接到指定的主机和端口。</p>\r\n\t*<p>连接成功派发 Event.OPEN 事件；连接失败派发 Event.ERROR 事件；连接被关闭派发 Event.CLOSE 事件；接收到数据派发 Event.MESSAGE 事件； 除了 Event.MESSAGE 事件参数为数据内容，其他事件参数都是原生的 HTML DOM Event 对象。</p>\r\n\t*@param host 服务器地址。\r\n\t*@param port 服务器端口。\r\n\t*/\r\n\t__proto.connect=function(host,port){\r\n\t\tvar url=\"ws://\"+host+\":\"+port;\r\n\t\tif (Browser.window.location.protocol==\"https:\"){\r\n\t\t\turl=\"wss://\"+host+\":\"+port;\r\n\t\t\t}else {\r\n\t\t\turl=\"ws://\"+host+\":\"+port;\r\n\t\t}\r\n\t\tthis.connectByUrl(url);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>连接到指定的服务端 WebSocket URL。 URL 类似 ws://yourdomain:port。</p>\r\n\t*<p>连接成功派发 Event.OPEN 事件；连接失败派发 Event.ERROR 事件；连接被关闭派发 Event.CLOSE 事件；接收到数据派发 Event.MESSAGE 事件； 除了 Event.MESSAGE 事件参数为数据内容，其他事件参数都是原生的 HTML DOM Event 对象。</p>\r\n\t*@param url 要连接的服务端 WebSocket URL。 URL 类似 ws://yourdomain:port。\r\n\t*/\r\n\t__proto.connectByUrl=function(url){\r\n\t\tvar _$this=this;\r\n\t\tif (this._socket !=null)\r\n\t\t\tthis.close();\r\n\t\tthis._socket && this.cleanSocket();\r\n\t\tif (!this.protocols || this.protocols.length==0){\r\n\t\t\tthis._socket=new Browser.window.WebSocket(url);\r\n\t\t\t}else {\r\n\t\t\tthis._socket=new Browser.window.WebSocket(url,this.protocols);\r\n\t\t}\r\n\t\tthis._socket.binaryType=\"arraybuffer\";\r\n\t\tthis._output=new this._byteClass();\r\n\t\tthis._output.endian=this.endian;\r\n\t\tthis._input=new this._byteClass();\r\n\t\tthis._input.endian=this.endian;\r\n\t\tthis._addInputPosition=0;\r\n\t\tthis._socket.onopen=function (e){\r\n\t\t\t_$this._onOpen(e);\r\n\t\t};\r\n\t\tthis._socket.onmessage=function (msg){\r\n\t\t\t_$this._onMessage(msg);\r\n\t\t};\r\n\t\tthis._socket.onclose=function (e){\r\n\t\t\t_$this._onClose(e);\r\n\t\t};\r\n\t\tthis._socket.onerror=function (e){\r\n\t\t\t_$this._onError(e);\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t*清理socket。\r\n\t*/\r\n\t__proto.cleanSocket=function(){\r\n\t\ttry {\r\n\t\t\tthis._socket.close();\r\n\t\t}catch (e){}\r\n\t\tthis._connected=false;\r\n\t\tthis._socket.onopen=null;\r\n\t\tthis._socket.onmessage=null;\r\n\t\tthis._socket.onclose=null;\r\n\t\tthis._socket.onerror=null;\r\n\t\tthis._socket=null;\r\n\t}\r\n\r\n\t/**\r\n\t*关闭连接。\r\n\t*/\r\n\t__proto.close=function(){\r\n\t\tif (this._socket !=null){\r\n\t\t\ttry {\r\n\t\t\t\tthis._socket.close();\r\n\t\t\t}catch (e){}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*连接建立成功 。\r\n\t*/\r\n\t__proto._onOpen=function(e){\r\n\t\tthis._connected=true;\r\n\t\tthis.event(/*laya.events.Event.OPEN*/\"open\",e);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*接收到数据处理方法。\r\n\t*@param msg 数据。\r\n\t*/\r\n\t__proto._onMessage=function(msg){\r\n\t\tif (!msg || !msg.data)return;\r\n\t\tvar data=msg.data;\r\n\t\tif (this.disableInput && data){\r\n\t\t\tthis.event(/*laya.events.Event.MESSAGE*/\"message\",data);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this._input.length > 0 && this._input.bytesAvailable < 1){\r\n\t\t\tthis._input.clear();\r\n\t\t\tthis._addInputPosition=0;\r\n\t\t};\r\n\t\tvar pre=this._input.pos;\r\n\t\t!this._addInputPosition && (this._addInputPosition=0);\r\n\t\tthis._input.pos=this._addInputPosition;\r\n\t\tif (data){\r\n\t\t\tif ((typeof data=='string')){\r\n\t\t\t\tthis._input.writeUTFBytes(data);\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._input.writeArrayBuffer(data);\r\n\t\t\t}\r\n\t\t\tthis._addInputPosition=this._input.pos;\r\n\t\t\tthis._input.pos=pre;\r\n\t\t}\r\n\t\tthis.event(/*laya.events.Event.MESSAGE*/\"message\",data);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*连接被关闭处理方法。\r\n\t*/\r\n\t__proto._onClose=function(e){\r\n\t\tthis._connected=false;\r\n\t\tthis.event(/*laya.events.Event.CLOSE*/\"close\",e)\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*出现异常处理方法。\r\n\t*/\r\n\t__proto._onError=function(e){\r\n\t\tthis.event(/*laya.events.Event.ERROR*/\"error\",e)\r\n\t}\r\n\r\n\t/**\r\n\t*发送数据到服务器。\r\n\t*@param data 需要发送的数据，可以是String或者ArrayBuffer。\r\n\t*/\r\n\t__proto.send=function(data){\r\n\t\tthis._socket.send(data);\r\n\t}\r\n\r\n\t/**\r\n\t*发送缓冲区中的数据到服务器。\r\n\t*/\r\n\t__proto.flush=function(){\r\n\t\tif (this._output && this._output.length > 0){\r\n\t\t\tvar evt;\r\n\t\t\ttry {\r\n\t\t\t\tthis._socket && this._socket.send(this._output.__getBuffer().slice(0,this._output.length));\r\n\t\t\t\t}catch (e){\r\n\t\t\t\tevt=e;\r\n\t\t\t}\r\n\t\t\tthis._output.endian=this.endian;\r\n\t\t\tthis._output.clear();\r\n\t\t\tif (evt)this.event(/*laya.events.Event.ERROR*/\"error\",evt);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*缓存的服务端发来的数据。\r\n\t*/\r\n\t__getset(0,__proto,'input',function(){\r\n\t\treturn this._input;\r\n\t});\r\n\r\n\t/**\r\n\t*表示需要发送至服务端的缓冲区中的数据。\r\n\t*/\r\n\t__getset(0,__proto,'output',function(){\r\n\t\treturn this._output;\r\n\t});\r\n\r\n\t/**\r\n\t*表示此 Socket 对象目前是否已连接。\r\n\t*/\r\n\t__getset(0,__proto,'connected',function(){\r\n\t\treturn this._connected;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>主机字节序，是 CPU 存放数据的两种不同顺序，包括小端字节序和大端字节序。</p>\r\n\t*<p> LITTLE_ENDIAN ：小端字节序，地址低位存储值的低位，地址高位存储值的高位。</p>\r\n\t*<p> BIG_ENDIAN ：大端字节序，地址低位存储值的高位，地址高位存储值的低位。</p>\r\n\t*/\r\n\t__getset(0,__proto,'endian',function(){\r\n\t\treturn this._endian;\r\n\t\t},function(value){\r\n\t\tthis._endian=value;\r\n\t\tif (this._input !=null)this._input.endian=value;\r\n\t\tif (this._output !=null)this._output.endian=value;\r\n\t});\r\n\r\n\tSocket.LITTLE_ENDIAN=\"littleEndian\";\r\n\tSocket.BIG_ENDIAN=\"bigEndian\";\r\n\treturn Socket;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*Worker Image加载器\r\n*/\r\n//class laya.net.WorkerLoader extends laya.events.EventDispatcher\r\nvar WorkerLoader=(function(_super){\r\n\tfunction WorkerLoader(){\r\n\t\t/**\r\n\t\t*使用的Worker对象。\r\n\t\t*/\r\n\t\tthis.worker=null;\r\n\t\tWorkerLoader.__super.call(this);\r\n\t\tvar _$this=this;\r\n\t\tthis.worker=new Browser.window.Worker(WorkerLoader.workerPath);\r\n\t\tthis.worker.onmessage=function (evt){\r\n\t\t\t_$this.workerMessage(evt.data);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(WorkerLoader,'laya.net.WorkerLoader',_super);\r\n\tvar __proto=WorkerLoader.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.workerMessage=function(data){\r\n\t\tif (data){\r\n\t\t\tswitch(data.type){\r\n\t\t\t\tcase \"Image\":\r\n\t\t\t\t\tthis.imageLoaded(data);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"Msg\":\r\n\t\t\t\t\tthis.event(\"image_msg\",data.msg);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.imageLoaded=function(data){\r\n\t\tif (data && data.buffer && data.buffer.length < 10){\r\n\t\t\tWorkerLoader._enable=false;\r\n\t\t\tthis._myTrace(\"buffer lost when postmessage ,disable workerloader\");\r\n\t\t\tthis.event(data.url,null);\r\n\t\t\tthis.event(\"image_err\",data.url+\"\\n\"+data.msg);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!data.dataType){\r\n\t\t\tthis.event(data.url,null);\r\n\t\t\tthis.event(\"image_err\",data.url+\"\\n\"+data.msg);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar canvas,ctx;\r\n\t\tvar imageData;\r\n\t\tswitch(data.dataType){\r\n\t\t\tcase \"buffer\":\r\n\t\t\t\tcanvas=new HTMLCanvas(\"2D\");\r\n\t\t\t\tctx=canvas.source.getContext(\"2d\");\r\n\t\t\t\timageData=ctx.createImageData(data.width,data.height);\r\n\t\t\t\timageData.data.set(data.buffer);\r\n\t\t\t\tcanvas.size(imageData.width,imageData.height);\r\n\t\t\t\tctx.putImageData(imageData,0,0);\r\n\t\t\t\tcanvas.memorySize=0;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"imagedata\":\r\n\t\t\t\tcanvas=new HTMLCanvas(\"2D\");\r\n\t\t\t\tctx=canvas.source.getContext(\"2d\");\r\n\t\t\t\timageData=data.imagedata;\r\n\t\t\t\tcanvas.size(imageData.width,imageData.height);\r\n\t\t\t\tctx.putImageData(imageData,0,0);\r\n\t\t\t\timageData=data.imagedata;\r\n\t\t\t\tcanvas.memorySize=0;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"imageBitmap\":\r\n\t\t\t\timageData=data.imageBitmap;\r\n\t\t\t\tif (!Render.isWebGL){\r\n\t\t\t\t\tcanvas=new HTMLCanvas(\"2D\");\r\n\t\t\t\t\tctx=canvas.source.getContext(\"2d\");\r\n\t\t\t\t\tcanvas.size(imageData.width,imageData.height);\r\n\t\t\t\t\tctx.drawImage(imageData,0,0);\r\n\t\t\t\t\tcanvas.src=data.url;\r\n\t\t\t\t}else\r\n\t\t\t\tcanvas=imageData;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tif (Render.isWebGL)\r\n\t\t\t/*__JS__ */canvas=new laya.webgl.resource.WebGLImage(canvas,data.url);;\r\n\t\tthis.event(data.url,canvas);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._myTrace=function(__arg){\r\n\t\tvar arg=arguments;\r\n\t\tvar rst=[];\r\n\t\tvar i=0,len=arg.length;\r\n\t\tfor(i=0;i<len;i++){\r\n\t\t\trst.push(arg[i]);\r\n\t\t}\r\n\t\tthis.event(\"image_msg\",rst.join(\" \"));\r\n\t}\r\n\r\n\t/**\r\n\t*加载图片\r\n\t*@param url 图片地址\r\n\t*/\r\n\t__proto.loadImage=function(url){\r\n\t\tvar data;\r\n\t\tdata={};\r\n\t\tdata.type=\"load\";\r\n\t\tdata.url=url;\r\n\t\tthis.worker.postMessage(data);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*加载图片资源。\r\n\t*@param url 资源地址。\r\n\t*/\r\n\t__proto._loadImage=function(url){\r\n\t\tvar _this=this;\r\n\t\tif (!WorkerLoader._enable||url.toLowerCase().indexOf(\".png\")< 0){\r\n\t\t\tWorkerLoader._preLoadFun.call(_this,url);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\turl=URL.formatURL(url);\r\n\t\tfunction clear (){\r\n\t\t\tlaya.net.WorkerLoader.I.off(url,_this,onload);\r\n\t\t};\r\n\t\tvar onload=function (image){\r\n\t\t\tclear();\r\n\t\t\tif (image){\r\n\t\t\t\t_this[\"onLoaded\"](image);\r\n\t\t\t\t}else{\r\n\t\t\t\tWorkerLoader._preLoadFun.call(_this,url);\r\n\t\t\t}\r\n\t\t};\r\n\t\tlaya.net.WorkerLoader.I.on(url,_this,onload);\r\n\t\tlaya.net.WorkerLoader.I.loadImage(url);\r\n\t}\r\n\r\n\t/**\r\n\t*是否启用。\r\n\t*/\r\n\t__getset(1,WorkerLoader,'enable',function(){\r\n\t\treturn WorkerLoader._enable;\r\n\t\t},function(v){\r\n\t\tif (WorkerLoader.disableJSDecode && (!Browser.window.createImageBitmap))return;\r\n\t\tWorkerLoader._enable=v;\r\n\t\tif (WorkerLoader._enable && WorkerLoader._preLoadFun==null)WorkerLoader._enable=WorkerLoader.__init__();\r\n\t});\r\n\r\n\tWorkerLoader.__init__=function(){\r\n\t\tif (WorkerLoader._preLoadFun !=null)return false;\r\n\t\tif (!Browser.window.Worker)return false;\r\n\t\tWorkerLoader._preLoadFun=Loader[\"prototype\"][\"_loadImage\"];\r\n\t\tLoader[\"prototype\"][\"_loadImage\"]=WorkerLoader[\"prototype\"][\"_loadImage\"];\r\n\t\tif (!WorkerLoader.I)WorkerLoader.I=new WorkerLoader();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tWorkerLoader.workerSupported=function(){\r\n\t\treturn Browser.window.Worker?true:false;\r\n\t}\r\n\r\n\tWorkerLoader.IMAGE_LOADED=\"image_loaded\";\r\n\tWorkerLoader.IMAGE_ERR=\"image_err\";\r\n\tWorkerLoader.IMAGE_MSG=\"image_msg\";\r\n\tWorkerLoader.I=null;\r\n\tWorkerLoader._preLoadFun=null;\r\n\tWorkerLoader._enable=false;\r\n\tWorkerLoader.workerPath=\"libs/worker.js\";\r\n\tWorkerLoader.disableJSDecode=true;\r\n\treturn WorkerLoader;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Resource</code> 资源存取类。\r\n*/\r\n//class laya.resource.Resource extends laya.events.EventDispatcher\r\nvar Resource=(function(_super){\r\n\tfunction Resource(){\r\n\t\t/**@private */\r\n\t\t//this.__loaded=false;\r\n\t\t/**@private */\r\n\t\t//this._id=0;\r\n\t\t/**@private */\r\n\t\t//this._memorySize=0;\r\n\t\t/**@private */\r\n\t\t//this._released=false;\r\n\t\t/**@private */\r\n\t\t//this._destroyed=false;\r\n\t\t/**@private */\r\n\t\t//this._referenceCount=0;\r\n\t\t/**@private */\r\n\t\t//this._group=null;\r\n\t\t/**@private */\r\n\t\t//this._url=null;\r\n\t\t/**@private */\r\n\t\t//this._resourceManager=null;\r\n\t\t/**@private */\r\n\t\t//this._lastUseFrameCount=0;\r\n\t\t/**是否加锁，如果true为不能使用自动释放机制。*/\r\n\t\t//this.lock=false;\r\n\t\t/**名称。 */\r\n\t\t//this.name=null;\r\n\t\tResource.__super.call(this);\r\n\t\tthis._$1__id=++Resource._uniqueIDCounter;\r\n\t\tthis.__loaded=true;\r\n\t\tthis._destroyed=false;\r\n\t\tthis._referenceCount=0;\r\n\t\tResource._idResourcesMap[this.id]=this;\r\n\t\tthis._released=true;\r\n\t\tthis.lock=false;\r\n\t\tthis._memorySize=0;\r\n\t\tthis._lastUseFrameCount=-1;\r\n\t\t(ResourceManager.currentResourceManager)&& (ResourceManager.currentResourceManager.addResource(this));\r\n\t}\r\n\r\n\t__class(Resource,'laya.resource.Resource',_super);\r\n\tvar __proto=Resource.prototype;\r\n\tLaya.imps(__proto,{\"laya.resource.ICreateResource\":true,\"laya.resource.IDispose\":true})\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._setUrl=function(url){\r\n\t\tif (this._url!==url){\r\n\t\t\tvar resList;\r\n\t\t\tif (this._url){\r\n\t\t\t\tresList=Resource._urlResourcesMap[this._url];\r\n\t\t\t\tresList.splice(resList.indexOf(this),1);\r\n\t\t\t\t(resList.length===0)&& (delete Resource._urlResourcesMap[this._url]);\r\n\t\t\t}\r\n\t\t\tif (url){\r\n\t\t\t\tresList=Resource._urlResourcesMap[url];\r\n\t\t\t\t(resList)|| (Resource._urlResourcesMap[url]=resList=[]);\r\n\t\t\t\tresList.push(this);\r\n\t\t\t}\r\n\t\t\tthis._url=url;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._getGroup=function(){\r\n\t\treturn this._group;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._setGroup=function(value){\r\n\t\tif (this._group!==value){\r\n\t\t\tvar groupList;\r\n\t\t\tif (this._group){\r\n\t\t\t\tgroupList=Resource._groupResourcesMap[this._group];\r\n\t\t\t\tgroupList.splice(groupList.indexOf(this),1);\r\n\t\t\t\t(groupList.length===0)&& (delete Resource._groupResourcesMap[this._group]);\r\n\t\t\t}\r\n\t\t\tif (value){\r\n\t\t\t\tgroupList=Resource._groupResourcesMap[value];\r\n\t\t\t\t(groupList)|| (Resource._groupResourcesMap[value]=groupList=[]);\r\n\t\t\t\tgroupList.push(this);\r\n\t\t\t}\r\n\t\t\tthis._group=value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._addReference=function(){\r\n\t\tthis._referenceCount++;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._removeReference=function(){\r\n\t\tthis._referenceCount--;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._clearReference=function(){\r\n\t\tthis._referenceCount=0;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._endLoaded=function(){\r\n\t\tthis.__loaded=true;\r\n\t\tthis.event(/*laya.events.Event.LOADED*/\"loaded\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.recreateResource=function(){\r\n\t\tthis.completeCreate();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.disposeResource=function(){}\r\n\t/**\r\n\t*激活资源，使用资源前应先调用此函数激活。\r\n\t*@param force 是否强制创建。\r\n\t*/\r\n\t__proto.activeResource=function(force){\r\n\t\t(force===void 0)&& (force=false);\r\n\t\tthis._lastUseFrameCount=Stat.loopCount;\r\n\t\tif (!this._destroyed&&this.__loaded&& (this._released || force))\r\n\t\t\tthis.recreateResource();\r\n\t}\r\n\r\n\t/**\r\n\t*释放资源。\r\n\t*@param force 是否强制释放。\r\n\t*@return 是否成功释放。\r\n\t*/\r\n\t__proto.releaseResource=function(force){\r\n\t\t(force===void 0)&& (force=false);\r\n\t\tif (!force && this.lock)\r\n\t\t\treturn false;\r\n\t\tif (!this._released || force){\r\n\t\t\tthis.disposeResource();\r\n\t\t\tthis._released=true;\r\n\t\t\tthis._lastUseFrameCount=-1;\r\n\t\t\tthis.event(/*laya.events.Event.RELEASED*/\"released\",this);\r\n\t\t\treturn true;\r\n\t\t\t}else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.onAsynLoaded=function(url,data,params){\r\n\t\tthrow new Error(\"Resource: must override this function!\");\r\n\t}\r\n\r\n\t/**\r\n\t*<p>彻底处理资源，处理后不能恢复。</p>\r\n\t*<p><b>注意：</b>会强制解锁清理。</p>\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tif (this._destroyed)\r\n\t\t\treturn;\r\n\t\tif (this._resourceManager!==null)\r\n\t\t\tthis._resourceManager.removeResource(this);\r\n\t\tthis._destroyed=true;\r\n\t\tthis.lock=false;\r\n\t\tthis.releaseResource();\r\n\t\tdelete Resource._idResourcesMap[this.id];\r\n\t\tvar resList;\r\n\t\tif (this._url){\r\n\t\t\tresList=Resource._urlResourcesMap[this._url];\r\n\t\t\tif (resList){\r\n\t\t\t\tresList.splice(resList.indexOf(this),1);\r\n\t\t\t\t(resList.length===0)&& (delete Resource._urlResourcesMap[this.url]);\r\n\t\t\t}\r\n\t\t\tLoader.clearRes(this._url);\r\n\t\t}\r\n\t\tif (this._group){\r\n\t\t\tresList=Resource._groupResourcesMap[this._group];\r\n\t\t\tresList.splice(resList.indexOf(this),1);\r\n\t\t\t(resList.length===0)&& (delete Resource._groupResourcesMap[this.url]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**完成资源激活。*/\r\n\t__proto.completeCreate=function(){\r\n\t\tthis._released=false;\r\n\t\tthis.event(/*laya.events.Event.RECOVERED*/\"recovered\",this);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.dispose=function(){\r\n\t\tthis.destroy();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t/**\r\n\t*占用内存尺寸。\r\n\t*/\r\n\t__getset(0,__proto,'memorySize',function(){\r\n\t\treturn this._memorySize;\r\n\t\t},function(value){\r\n\t\tvar offsetValue=value-this._memorySize;\r\n\t\tthis._memorySize=value;\r\n\t\tthis.resourceManager && this.resourceManager.addSize(offsetValue);\r\n\t});\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__getset(0,__proto,'_loaded',null,function(value){\r\n\t\tthis.__loaded=value;\r\n\t});\r\n\r\n\t/**\r\n\t*获取是否已加载完成。\r\n\t*/\r\n\t__getset(0,__proto,'loaded',function(){\r\n\t\treturn this.__loaded;\r\n\t});\r\n\r\n\t/**\r\n\t*获取唯一标识ID,通常用于识别。\r\n\t*/\r\n\t__getset(0,__proto,'id',function(){\r\n\t\treturn this._$1__id;\r\n\t});\r\n\r\n\t/**\r\n\t*是否已处理。\r\n\t*/\r\n\t__getset(0,__proto,'destroyed',function(){\r\n\t\treturn this._destroyed;\r\n\t});\r\n\r\n\t/**\r\n\t*设置资源组名。\r\n\t*/\r\n\t/**\r\n\t*获取资源组名。\r\n\t*/\r\n\t__getset(0,__proto,'group',function(){\r\n\t\treturn this._getGroup();\r\n\t\t},function(value){\r\n\t\tthis._setGroup(value);\r\n\t});\r\n\r\n\t/**\r\n\t*资源管理员。\r\n\t*/\r\n\t__getset(0,__proto,'resourceManager',function(){\r\n\t\treturn this._resourceManager;\r\n\t});\r\n\r\n\t/**\r\n\t*获取资源的URL地址。\r\n\t*@return URL地址。\r\n\t*/\r\n\t__getset(0,__proto,'url',function(){\r\n\t\treturn this._url;\r\n\t});\r\n\r\n\t/**\r\n\t*是否已释放。\r\n\t*/\r\n\t__getset(0,__proto,'released',function(){\r\n\t\treturn this._released;\r\n\t});\r\n\r\n\t/**\r\n\t*获取资源的引用计数。\r\n\t*/\r\n\t__getset(0,__proto,'referenceCount',function(){\r\n\t\treturn this._referenceCount;\r\n\t});\r\n\r\n\tResource.getResourceByID=function(id){\r\n\t\treturn Resource._idResourcesMap[id];\r\n\t}\r\n\r\n\tResource.getResourceByURL=function(url,index){\r\n\t\t(index===void 0)&& (index=0);\r\n\t\treturn Resource._urlResourcesMap[url][index];\r\n\t}\r\n\r\n\tResource.getResourceCountByURL=function(url){\r\n\t\treturn Resource._urlResourcesMap[url].length;\r\n\t}\r\n\r\n\tResource.destroyUnusedResources=function(group){\r\n\t\tvar res;\r\n\t\tif (group){\r\n\t\t\tvar resouList=Resource._groupResourcesMap[group];\r\n\t\t\tif (resouList){\r\n\t\t\t\tvar tempResouList=resouList.slice();\r\n\t\t\t\tfor (var i=0,n=tempResouList.length;i < n;i++){\r\n\t\t\t\t\tres=tempResouList[i];\r\n\t\t\t\t\tif (!res.lock && res._referenceCount===0)\r\n\t\t\t\t\t\tres.destroy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (var k in Resource._idResourcesMap){\r\n\t\t\t\tres=Resource._idResourcesMap[k];\r\n\t\t\t\tif (!res.lock && res._referenceCount===0)\r\n\t\t\t\t\tres.destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tResource._uniqueIDCounter=0;\r\n\tResource._idResourcesMap={};\r\n\tResource._urlResourcesMap={};\r\n\tResource._groupResourcesMap={};\r\n\treturn Resource;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<code>Texture</code> 是一个纹理处理类。\r\n*/\r\n//class laya.resource.Texture extends laya.events.EventDispatcher\r\nvar Texture=(function(_super){\r\n\tfunction Texture(bitmap,uv){\r\n\t\t/**图片或者canvas 。*/\r\n\t\t//this.bitmap=null;\r\n\t\t/**UV信息。*/\r\n\t\t//this.uv=null;\r\n\t\t/**沿 X 轴偏移量。*/\r\n\t\tthis.offsetX=0;\r\n\t\t/**沿 Y 轴偏移量。*/\r\n\t\tthis.offsetY=0;\r\n\t\t/**原始宽度（包括被裁剪的透明区域）。*/\r\n\t\tthis.sourceWidth=0;\r\n\t\t/**原始高度（包括被裁剪的透明区域）。*/\r\n\t\tthis.sourceHeight=0;\r\n\t\t/**@private */\r\n\t\t//this._loaded=false;\r\n\t\t/**@private */\r\n\t\tthis._w=0;\r\n\t\t/**@private */\r\n\t\tthis._h=0;\r\n\t\t/**@private 唯一ID*/\r\n\t\t//this.$_GID=NaN;\r\n\t\t/**图片地址*/\r\n\t\t//this.url=null;\r\n\t\t/**@private */\r\n\t\tthis._uvID=0;\r\n\t\tthis._atlasID=-1;\r\n\t\t/**@private */\r\n\t\tthis.scaleRate=1;\r\n\t\tTexture.__super.call(this);\r\n\t\tif (bitmap){\r\n\t\t\tbitmap._addReference();\r\n\t\t}\r\n\t\tthis.setTo(bitmap,uv);\r\n\t}\r\n\r\n\t__class(Texture,'laya.resource.Texture',_super);\r\n\tvar __proto=Texture.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._setUrl=function(url){\r\n\t\tthis.url=url;\r\n\t}\r\n\r\n\t/**\r\n\t*设置此对象的位图资源、UV数据信息。\r\n\t*@param bitmap 位图资源\r\n\t*@param uv UV数据信息\r\n\t*/\r\n\t__proto.setTo=function(bitmap,uv){\r\n\t\tif (/*__JS__ */bitmap instanceof window.HTMLElement){\r\n\t\t\tvar canvas=HTMLCanvas.create(\"2D\",bitmap);\r\n\t\t\tthis.bitmap=canvas;\r\n\t\t\t}else{\r\n\t\t\tthis.bitmap=bitmap;\r\n\t\t}\r\n\t\tthis.uv=uv || Texture.DEF_UV;\r\n\t\tif (bitmap){\r\n\t\t\tthis._w=bitmap.width;\r\n\t\t\tthis._h=bitmap.height;\r\n\t\t\tthis.sourceWidth=this.sourceWidth || this._w;\r\n\t\t\tthis.sourceHeight=this.sourceHeight || this._h\r\n\t\t\tthis._loaded=this._w > 0;\r\n\t\t\tvar _this=this;\r\n\t\t\tif (this._loaded){\r\n\t\t\t\tRunDriver.addToAtlas && RunDriver.addToAtlas(_this);\r\n\t\t\t\t}else {\r\n\t\t\t\tvar bm=bitmap;\r\n\t\t\t\tif ((bm instanceof laya.resource.HTMLImage )&& bm.image)\r\n\t\t\t\t\tbm.image.addEventListener('load',function(e){\r\n\t\t\t\t\tRunDriver.addToAtlas && RunDriver.addToAtlas(_this);\r\n\t\t\t\t},false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private 激活资源。*/\r\n\t__proto.active=function(){\r\n\t\tif (this.bitmap)this.bitmap.activeResource();\r\n\t}\r\n\r\n\t/**\r\n\t*销毁纹理（分直接销毁，跟计数销毁两种）。\r\n\t*@param forceDispose (default=false)true为强制销毁主纹理，false是通过计数销毁纹理。\r\n\t*/\r\n\t__proto.destroy=function(forceDispose){\r\n\t\t(forceDispose===void 0)&& (forceDispose=false);\r\n\t\tif (this.bitmap && (this.bitmap).referenceCount > 0){\r\n\t\t\tvar temp=this.bitmap;\r\n\t\t\tif (forceDispose){\r\n\t\t\t\tif (Render.isConchApp && temp.source && temp.source.conchDestroy){\r\n\t\t\t\t\tthis.bitmap.source.conchDestroy();\r\n\t\t\t\t}\r\n\t\t\t\tthis.bitmap=null;\r\n\t\t\t\ttemp.dispose();\r\n\t\t\t\t(temp)._clearReference();\r\n\t\t\t\t}else {\r\n\t\t\t\t(temp)._removeReference();\r\n\t\t\t\tif ((temp).referenceCount==0){\r\n\t\t\t\t\tif (Render.isConchApp && temp.source && temp.source.conchDestroy){\r\n\t\t\t\t\t\tthis.bitmap.source.conchDestroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.bitmap=null;\r\n\t\t\t\t\ttemp.dispose();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.url && this===Laya.loader.getRes(this.url))Laya.loader.clearRes(this.url,forceDispose);\r\n\t\t\tthis._loaded=false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*加载指定地址的图片。\r\n\t*@param url 图片地址。\r\n\t*/\r\n\t__proto.load=function(url){\r\n\t\tvar _$this=this;\r\n\t\tthis._loaded=false;\r\n\t\turl=URL.customFormat(url);\r\n\t\tvar fileBitmap=(this.bitmap || (this.bitmap=HTMLImage.create(url)));\r\n\t\tif (fileBitmap)fileBitmap._addReference();\r\n\t\tvar _this=this;\r\n\t\tfileBitmap.onload=function (){\r\n\t\t\tfileBitmap.onload=null;\r\n\t\t\t_this._loaded=true;\r\n\t\t\t_$this.sourceWidth=_$this._w=fileBitmap.width;\r\n\t\t\t_$this.sourceHeight=_$this._h=fileBitmap.height;\r\n\t\t\t_this.event(/*laya.events.Event.LOADED*/\"loaded\",this);\r\n\t\t\t(RunDriver.addToAtlas)&& (RunDriver.addToAtlas(_this));\r\n\t\t};\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.addTextureToAtlas=function(e){\r\n\t\tRunDriver.addTextureToAtlas(this);\r\n\t}\r\n\r\n\t/**\r\n\t*获取Texture上的某个区域的像素点\r\n\t*@param x\r\n\t*@param y\r\n\t*@param width\r\n\t*@param height\r\n\t*@return 返回像素点集合\r\n\t*/\r\n\t__proto.getPixels=function(x,y,width,height){\r\n\t\tif (Render.isConchApp){\r\n\t\t\tvar temp=this.bitmap;\r\n\t\t\tif (temp.source && temp.source.getImageData){\r\n\t\t\t\tvar arraybuffer=temp.source.getImageData(x,y,width,height);\r\n\t\t\t\tvar tUint8Array=new Uint8Array(arraybuffer);\r\n\t\t\t\treturn /*__JS__ */Array.from(tUint8Array);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t\t}else if (Render.isWebGL){\r\n\t\t\treturn RunDriver.getTexturePixels(this,x,y,width,height);\r\n\t\t\t}else {\r\n\t\t\tBrowser.canvas.size(width,height);\r\n\t\t\tBrowser.canvas.clear();\r\n\t\t\tBrowser.context.drawTexture(this,-x,-y,this.width,this.height,0,0);\r\n\t\t\tvar info=Browser.context.getImageData(0,0,width,height);\r\n\t\t}\r\n\t\treturn info.data;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.onAsynLoaded=function(url,bitmap){\r\n\t\tif (bitmap)bitmap._addReference();\r\n\t\tthis.setTo(bitmap,this.uv);\r\n\t}\r\n\r\n\t/**激活并获取资源。*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\tif (!this.bitmap)return null;\r\n\t\tthis.bitmap.activeResource();\r\n\t\treturn this.bitmap.source;\r\n\t});\r\n\r\n\t/**\r\n\t*表示是否加载成功，只能表示初次载入成功（通常包含下载和载入）,并不能完全表示资源是否可立即使用（资源管理机制释放影响等）。\r\n\t*/\r\n\t__getset(0,__proto,'loaded',function(){\r\n\t\treturn this._loaded;\r\n\t});\r\n\r\n\t/**\r\n\t*表示资源是否已释放。\r\n\t*/\r\n\t__getset(0,__proto,'released',function(){\r\n\t\tif (!this.bitmap)return true;\r\n\t\treturn this.bitmap.released;\r\n\t});\r\n\r\n\t/**实际宽度。*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._w)return this._w;\r\n\t\treturn (this.uv && this.uv!==Texture.DEF_UV)? (this.uv[2]-this.uv[0])*this.bitmap.width :this.bitmap.width;\r\n\t\t},function(value){\r\n\t\tthis._w=value;\r\n\t\tthis.sourceWidth || (this.sourceWidth=value);\r\n\t});\r\n\r\n\t/**\r\n\t*通过外部设置是否启用纹理平铺(后面要改成在着色器里计算)\r\n\t*/\r\n\t/**\r\n\t*获取当前纹理是否启用了纹理平铺\r\n\t*/\r\n\t__getset(0,__proto,'repeat',function(){\r\n\t\tif (Render.isWebGL && this.bitmap){\r\n\t\t\treturn this.bitmap.repeat;\r\n\t\t}\r\n\t\treturn true;\r\n\t\t},function(value){\r\n\t\tif (value){\r\n\t\t\tif (Render.isWebGL && this.bitmap){\r\n\t\t\t\tthis.bitmap.repeat=value;\r\n\t\t\t\tif (value){\r\n\t\t\t\t\tthis.bitmap.enableMerageInAtlas=false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**实际高度。*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._h)return this._h;\r\n\t\treturn (this.uv && this.uv!==Texture.DEF_UV)? (this.uv[5]-this.uv[1])*this.bitmap.height :this.bitmap.height;\r\n\t\t},function(value){\r\n\t\tthis._h=value;\r\n\t\tthis.sourceHeight || (this.sourceHeight=value);\r\n\t});\r\n\r\n\t/**\r\n\t*设置线性采样的状态（目前只能第一次绘制前设置false生效,来关闭线性采样）。\r\n\t*/\r\n\t/**\r\n\t*获取当前纹理是否启用了线性采样。\r\n\t*/\r\n\t__getset(0,__proto,'isLinearSampling',function(){\r\n\t\treturn Render.isWebGL ? (this.bitmap.minFifter !=0x2600):true;\r\n\t\t},function(value){\r\n\t\tif (!value && Render.isWebGL){\r\n\t\t\tif (!value && (this.bitmap.minFifter==-1)&& (this.bitmap.magFifter==-1)){\r\n\t\t\t\tthis.bitmap.minFifter=0x2600;\r\n\t\t\t\tthis.bitmap.magFifter=0x2600;\r\n\t\t\t\tthis.bitmap.enableMerageInAtlas=false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tTexture.moveUV=function(offsetX,offsetY,uv){\r\n\t\tfor (var i=0;i < 8;i+=2){\r\n\t\t\tuv[i]+=offsetX;\r\n\t\t\tuv[i+1]+=offsetY;\r\n\t\t}\r\n\t\treturn uv;\r\n\t}\r\n\r\n\tTexture.create=function(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight){\r\n\t\t(offsetX===void 0)&& (offsetX=0);\r\n\t\t(offsetY===void 0)&& (offsetY=0);\r\n\t\t(sourceWidth===void 0)&& (sourceWidth=0);\r\n\t\t(sourceHeight===void 0)&& (sourceHeight=0);\r\n\t\tvar btex=(source instanceof laya.resource.Texture );\r\n\t\tvar uv=btex ? source.uv :Texture.DEF_UV;\r\n\t\tvar bitmap=btex ? source.bitmap :source;\r\n\t\tvar bIsAtlas=RunDriver.isAtlas(bitmap);\r\n\t\tif (bIsAtlas){\r\n\t\t\tvar atlaser=bitmap._atlaser;\r\n\t\t\tvar nAtlasID=(source)._atlasID;\r\n\t\t\tif (nAtlasID==-1){\r\n\t\t\t\tthrow new Error(\"create texture error\");\r\n\t\t\t}\r\n\t\t\tbitmap=atlaser._inAtlasTextureBitmapValue[nAtlasID];\r\n\t\t\tuv=atlaser._inAtlasTextureOriUVValue[nAtlasID];\r\n\t\t};\r\n\t\tvar tex=new Texture(bitmap,null);\r\n\t\tif (bitmap.width && (x+width)> bitmap.width)width=bitmap.width-x;\r\n\t\tif (bitmap.height && (y+height)> bitmap.height)height=bitmap.height-y;\r\n\t\ttex.width=width;\r\n\t\ttex.height=height;\r\n\t\ttex.offsetX=offsetX;\r\n\t\ttex.offsetY=offsetY;\r\n\t\ttex.sourceWidth=sourceWidth || width;\r\n\t\ttex.sourceHeight=sourceHeight || height;\r\n\t\tvar dwidth=1 / bitmap.width;\r\n\t\tvar dheight=1 / bitmap.height;\r\n\t\tx *=dwidth;\r\n\t\ty *=dheight;\r\n\t\twidth *=dwidth;\r\n\t\theight *=dheight;\r\n\t\tvar u1=tex.uv[0],v1=tex.uv[1],u2=tex.uv[4],v2=tex.uv[5];\r\n\t\tvar inAltasUVWidth=(u2-u1),inAltasUVHeight=(v2-v1);\r\n\t\tvar oriUV=Texture.moveUV(uv[0],uv[1],[x,y,x+width,y,x+width,y+height,x,y+height]);\r\n\t\ttex.uv=[u1+oriUV[0] *inAltasUVWidth,v1+oriUV[1] *inAltasUVHeight,u2-(1-oriUV[2])*inAltasUVWidth,v1+oriUV[3] *inAltasUVHeight,u2-(1-oriUV[4])*inAltasUVWidth,v2-(1-oriUV[5])*inAltasUVHeight,u1+oriUV[6] *inAltasUVWidth,v2-(1-oriUV[7])*inAltasUVHeight];\r\n\t\tif (bIsAtlas){\r\n\t\t\ttex.addTextureToAtlas();\r\n\t\t};\r\n\t\tvar bitmapScale=bitmap.scaleRate;\r\n\t\tif (bitmapScale && bitmapScale !=1){\r\n\t\t\ttex.sourceWidth /=bitmapScale;\r\n\t\t\ttex.sourceHeight /=bitmapScale;\r\n\t\t\ttex.width /=bitmapScale;\r\n\t\t\ttex.height /=bitmapScale;\r\n\t\t\ttex.scaleRate=bitmapScale;\r\n\t\t\ttex.offsetX /=bitmapScale;\r\n\t\t\ttex.offsetY /=bitmapScale;\r\n\t\t\t}else{\r\n\t\t\ttex.scaleRate=1;\r\n\t\t}\r\n\t\treturn tex;\r\n\t}\r\n\r\n\tTexture.createFromTexture=function(texture,x,y,width,height){\r\n\t\tvar texScaleRate=texture.scaleRate;\r\n\t\tif (texScaleRate !=1){\r\n\t\t\tx *=texScaleRate;\r\n\t\t\ty *=texScaleRate;\r\n\t\t\twidth *=texScaleRate;\r\n\t\t\theight *=texScaleRate;\r\n\t\t};\r\n\t\tvar rect=Rectangle.TEMP.setTo(x-texture.offsetX,y-texture.offsetY,width,height);\r\n\t\tvar result=rect.intersection(Texture._rect1.setTo(0,0,texture.width,texture.height),Texture._rect2);\r\n\t\tif (result)\r\n\t\t\tvar tex=Texture.create(texture,result.x,result.y,result.width,result.height,result.x-rect.x,result.y-rect.y,width,height);\r\n\t\telse return null;\r\n\t\ttex.bitmap._removeReference();\r\n\t\treturn tex;\r\n\t}\r\n\r\n\t__static(Texture,\r\n\t['DEF_UV',function(){return this.DEF_UV=[0,0,1.0,0,1.0,1.0,0,1.0];},'INV_UV',function(){return this.INV_UV=[0,1,1.0,1,1.0,0.0,0,0.0];},'_rect1',function(){return this._rect1=new Rectangle();},'_rect2',function(){return this._rect2=new Rectangle();}\r\n\t]);\r\n\treturn Texture;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<code>TimeLine</code> 是一个用来创建时间轴动画的类。\r\n*/\r\n//class laya.utils.TimeLine extends laya.events.EventDispatcher\r\nvar TimeLine=(function(_super){\r\n\tvar tweenData;\r\n\tfunction TimeLine(){\r\n\t\tthis._labelDic=null;\r\n\t\tthis._tweenDic={};\r\n\t\tthis._tweenDataList=[];\r\n\t\tthis._endTweenDataList=null;\r\n\t\t//以结束时间进行排序\r\n\t\tthis._currTime=0;\r\n\t\tthis._lastTime=0;\r\n\t\tthis._startTime=0;\r\n\t\t/**当前动画数据播放到第几个了*/\r\n\t\tthis._index=0;\r\n\t\t/**为TWEEN创建属于自己的唯一标识，方便管理*/\r\n\t\tthis._gidIndex=0;\r\n\t\t/**保留所有对象第一次注册动画时的状态（根据时间跳转时，需要把对象的回复，再计算接下来的状态）*/\r\n\t\tthis._firstTweenDic={};\r\n\t\t/**是否需要排序*/\r\n\t\tthis._startTimeSort=false;\r\n\t\tthis._endTimeSort=false;\r\n\t\t/**是否循环*/\r\n\t\tthis._loopKey=false;\r\n\t\t/**缩放动画播放的速度。*/\r\n\t\tthis.scale=1;\r\n\t\tthis._frameRate=60;\r\n\t\tthis._frameIndex=0;\r\n\t\tthis._total=0;\r\n\t\tTimeLine.__super.call(this);\r\n\t}\r\n\r\n\t__class(TimeLine,'laya.utils.TimeLine',_super);\r\n\tvar __proto=TimeLine.prototype;\r\n\t/**\r\n\t*控制一个对象，从当前点移动到目标点。\r\n\t*@param target 要控制的对象。\r\n\t*@param props 要控制对象的属性。\r\n\t*@param duration 对象TWEEN的时间。\r\n\t*@param ease 缓动类型\r\n\t*@param offset 相对于上一个对象，偏移多长时间（单位：毫秒）。\r\n\t*/\r\n\t__proto.to=function(target,props,duration,ease,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\treturn this._create(target,props,duration,ease,offset,true);\r\n\t}\r\n\r\n\t/**\r\n\t*从 props 属性，缓动到当前状态。\r\n\t*@param target target 目标对象(即将更改属性值的对象)\r\n\t*@param props 要控制对象的属性\r\n\t*@param duration 对象TWEEN的时间\r\n\t*@param ease 缓动类型\r\n\t*@param offset 相对于上一个对象，偏移多长时间（单位：毫秒）\r\n\t*/\r\n\t__proto.from=function(target,props,duration,ease,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\treturn this._create(target,props,duration,ease,offset,false);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._create=function(target,props,duration,ease,offset,isTo){\r\n\t\tvar tTweenData=Pool.getItemByClass(\"tweenData\",tweenData);\r\n\t\ttTweenData.isTo=isTo;\r\n\t\ttTweenData.type=0;\r\n\t\ttTweenData.target=target;\r\n\t\ttTweenData.duration=duration;\r\n\t\ttTweenData.data=props;\r\n\t\ttTweenData.startTime=this._startTime+offset;\r\n\t\ttTweenData.endTime=tTweenData.startTime+tTweenData.duration;\r\n\t\ttTweenData.ease=ease;\r\n\t\tthis._startTime=Math.max(tTweenData.endTime,this._startTime);\r\n\t\tthis._tweenDataList.push(tTweenData);\r\n\t\tthis._startTimeSort=true;\r\n\t\tthis._endTimeSort=true;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*在时间队列中加入一个标签。\r\n\t*@param label 标签名称。\r\n\t*@param offset 标签相对于上个动画的偏移时间(单位：毫秒)。\r\n\t*/\r\n\t__proto.addLabel=function(label,offset){\r\n\t\tvar tTweenData=Pool.getItemByClass(\"tweenData\",tweenData);\r\n\t\ttTweenData.type=1;\r\n\t\ttTweenData.data=label;\r\n\t\ttTweenData.endTime=tTweenData.startTime=this._startTime+offset;\r\n\t\tthis._labelDic || (this._labelDic={});\r\n\t\tthis._labelDic[label]=tTweenData;\r\n\t\tthis._tweenDataList.push(tTweenData);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*移除指定的标签\r\n\t*@param label\r\n\t*/\r\n\t__proto.removeLabel=function(label){\r\n\t\tif (this._labelDic && this._labelDic[label]){\r\n\t\t\tvar tTweenData=this._labelDic[label];\r\n\t\t\tif (tTweenData){\r\n\t\t\t\tvar tIndex=this._tweenDataList.indexOf(tTweenData);\r\n\t\t\t\tif (tIndex >-1){\r\n\t\t\t\t\tthis._tweenDataList.splice(tIndex,1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete this._labelDic[label];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*动画从整个动画的某一时间开始。\r\n\t*@param time(单位：毫秒)。\r\n\t*/\r\n\t__proto.gotoTime=function(time){\r\n\t\tif (this._tweenDataList==null || this._tweenDataList.length==0)return;\r\n\t\tvar tTween;\r\n\t\tvar tObject;\r\n\t\tfor (var p in this._firstTweenDic){\r\n\t\t\ttObject=this._firstTweenDic[p];\r\n\t\t\tif (tObject){\r\n\t\t\t\tfor (var tDataP in tObject){\r\n\t\t\t\t\tif (tObject.diyTarget.hasOwnProperty(tDataP)){\r\n\t\t\t\t\t\ttObject.diyTarget[tDataP]=tObject[tDataP];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (p in this._tweenDic){\r\n\t\t\ttTween=this._tweenDic[p];\r\n\t\t\ttTween.clear();\r\n\t\t\tdelete this._tweenDic[p];\r\n\t\t}\r\n\t\tthis._index=0;\r\n\t\tthis._gidIndex=0;\r\n\t\tthis._currTime=time;\r\n\t\tthis._lastTime=Browser.now();\r\n\t\tvar tTweenDataCopyList;\r\n\t\tif (this._endTweenDataList==null || this._endTimeSort){\r\n\t\t\tthis._endTimeSort=false;\r\n\t\t\tthis._endTweenDataList=tTweenDataCopyList=this._tweenDataList.concat();\r\n\t\t\tfunction Compare (paraA,paraB){\r\n\t\t\t\tif (paraA.endTime > paraB.endTime){\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t\t}else if (paraA.endTime < paraB.endTime){\r\n\t\t\t\t\treturn-1;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttTweenDataCopyList.sort(Compare);\r\n\t\t\t}else {\r\n\t\t\ttTweenDataCopyList=this._endTweenDataList\r\n\t\t};\r\n\t\tvar tTweenData;\r\n\t\tfor (var i=0,n=tTweenDataCopyList.length;i < n;i++){\r\n\t\t\ttTweenData=tTweenDataCopyList[i];\r\n\t\t\tif (tTweenData.type==0){\r\n\t\t\t\tif (time >=tTweenData.endTime){\r\n\t\t\t\t\tthis._index=Math.max(this._index,i+1);\r\n\t\t\t\t\tvar props=tTweenData.data;\r\n\t\t\t\t\tif (tTweenData.isTo){\r\n\t\t\t\t\t\tfor (var tP in props){\r\n\t\t\t\t\t\t\ttTweenData.target[tP]=props[tP];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=0,n=this._tweenDataList.length;i < n;i++){\r\n\t\t\ttTweenData=this._tweenDataList[i];\r\n\t\t\tif (tTweenData.type==0){\r\n\t\t\t\tif (time >=tTweenData.startTime && time < tTweenData.endTime){\r\n\t\t\t\t\tthis._index=Math.max(this._index,i+1);\r\n\t\t\t\t\tthis._gidIndex++;\r\n\t\t\t\t\ttTween=Pool.getItemByClass(\"tween\",Tween);\r\n\t\t\t\t\ttTween._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,false,tTweenData.isTo,true,false);\r\n\t\t\t\t\ttTween.setStartTime(this._currTime-(time-tTweenData.startTime));\r\n\t\t\t\t\ttTween._updateEase(this._currTime);\r\n\t\t\t\t\ttTween.gid=this._gidIndex;\r\n\t\t\t\t\tthis._tweenDic[this._gidIndex]=tTween;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*从指定的标签开始播。\r\n\t*@param Label 标签名。\r\n\t*/\r\n\t__proto.gotoLabel=function(Label){\r\n\t\tif (this._labelDic==null)return;\r\n\t\tvar tLabelData=this._labelDic[Label];\r\n\t\tif (tLabelData)this.gotoTime(tLabelData.startTime);\r\n\t}\r\n\r\n\t/**\r\n\t*暂停整个动画。\r\n\t*/\r\n\t__proto.pause=function(){\r\n\t\tLaya.timer.clear(this,this._update);\r\n\t}\r\n\r\n\t/**\r\n\t*恢复暂停动画的播放。\r\n\t*/\r\n\t__proto.resume=function(){\r\n\t\tthis.play(this._currTime,this._loopKey);\r\n\t}\r\n\r\n\t/**\r\n\t*播放动画。\r\n\t*@param timeOrLabel 开启播放的时间点或标签名。\r\n\t*@param loop 是否循环播放。\r\n\t*/\r\n\t__proto.play=function(timeOrLabel,loop){\r\n\t\t(timeOrLabel===void 0)&& (timeOrLabel=0);\r\n\t\t(loop===void 0)&& (loop=false);\r\n\t\tif (!this._tweenDataList)return;\r\n\t\tif (this._startTimeSort){\r\n\t\t\tthis._startTimeSort=false;\r\n\t\t\tfunction Compare (paraA,paraB){\r\n\t\t\t\tif (paraA.startTime > paraB.startTime){\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t\t}else if (paraA.startTime < paraB.startTime){\r\n\t\t\t\t\treturn-1;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._tweenDataList.sort(Compare);\r\n\t\t\tfor (var i=0,n=this._tweenDataList.length;i < n;i++){\r\n\t\t\t\tvar tTweenData=this._tweenDataList[i];\r\n\t\t\t\tif (tTweenData !=null && tTweenData.type==0){\r\n\t\t\t\t\tvar tTarget=tTweenData.target;\r\n\t\t\t\t\tvar gid=(tTarget.$_GID || (tTarget.$_GID=Utils.getGID()));\r\n\t\t\t\t\tvar tSrcData=null;\r\n\t\t\t\t\tif (this._firstTweenDic[gid]==null){\r\n\t\t\t\t\t\ttSrcData={};\r\n\t\t\t\t\t\ttSrcData.diyTarget=tTarget;\r\n\t\t\t\t\t\tthis._firstTweenDic[gid]=tSrcData;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\ttSrcData=this._firstTweenDic[gid];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var p in tTweenData.data){\r\n\t\t\t\t\t\tif (tSrcData[p]==null){\r\n\t\t\t\t\t\t\ttSrcData[p]=tTarget[p];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((typeof timeOrLabel=='string')){\r\n\t\t\tthis.gotoLabel(timeOrLabel);\r\n\t\t\t}else {\r\n\t\t\tthis.gotoTime(timeOrLabel);\r\n\t\t}\r\n\t\tthis._loopKey=loop;\r\n\t\tthis._lastTime=Browser.now();\r\n\t\tLaya.timer.frameLoop(1,this,this._update);\r\n\t}\r\n\r\n\t/**\r\n\t*更新当前动画。\r\n\t*/\r\n\t__proto._update=function(){\r\n\t\tif (this._currTime >=this._startTime){\r\n\t\t\tif (this._loopKey){\r\n\t\t\t\tthis._complete();\r\n\t\t\t\tif (!this._tweenDataList)return;\r\n\t\t\t\tthis.gotoTime(0);\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (var p in this._tweenDic){\r\n\t\t\t\t\ttTween=this._tweenDic[p];\r\n\t\t\t\t\ttTween.complete();\r\n\t\t\t\t}\r\n\t\t\t\tthis._complete();\r\n\t\t\t\tthis.pause();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tNow=Browser.now();\r\n\t\tvar tFrameTime=tNow-this._lastTime;\r\n\t\tvar tCurrTime=this._currTime+=tFrameTime *this.scale;\r\n\t\tthis._lastTime=tNow;\r\n\t\tfor (p in this._tweenDic){\r\n\t\t\ttTween=this._tweenDic[p];\r\n\t\t\ttTween._updateEase(tCurrTime);\r\n\t\t};\r\n\t\tvar tTween;\r\n\t\tif (this._tweenDataList.length !=0 && this._index < this._tweenDataList.length){\r\n\t\t\tvar tTweenData=this._tweenDataList[this._index];\r\n\t\t\tif (tCurrTime >=tTweenData.startTime){\r\n\t\t\t\tthis._index++;\r\n\t\t\t\tif (tTweenData.type==0){\r\n\t\t\t\t\tthis._gidIndex++;\r\n\t\t\t\t\ttTween=Pool.getItemByClass(\"tween\",Tween);\r\n\t\t\t\t\ttTween._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,false,tTweenData.isTo,true,false);\r\n\t\t\t\t\ttTween.setStartTime(tCurrTime);\r\n\t\t\t\t\ttTween.gid=this._gidIndex;\r\n\t\t\t\t\tthis._tweenDic[this._gidIndex]=tTween;\r\n\t\t\t\t\ttTween._updateEase(tCurrTime);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis.event(/*laya.events.Event.LABEL*/\"label\",tTweenData.data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*指定的动画索引处的动画播放完成后，把此动画从列表中删除。\r\n\t*@param index\r\n\t*/\r\n\t__proto._animComplete=function(index){\r\n\t\tvar tTween=this._tweenDic[index];\r\n\t\tif (tTween)delete this._tweenDic[index];\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._complete=function(){\r\n\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t}\r\n\r\n\t/**\r\n\t*重置所有对象，复用对象的时候使用。\r\n\t*/\r\n\t__proto.reset=function(){\r\n\t\tvar p;\r\n\t\tif (this._labelDic){\r\n\t\t\tfor (p in this._labelDic){\r\n\t\t\t\tdelete this._labelDic[p];\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar tTween;\r\n\t\tfor (p in this._tweenDic){\r\n\t\t\ttTween=this._tweenDic[p];\r\n\t\t\ttTween.clear();\r\n\t\t\tdelete this._tweenDic[p];\r\n\t\t}\r\n\t\tfor (p in this._firstTweenDic){\r\n\t\t\tdelete this._firstTweenDic[p];\r\n\t\t}\r\n\t\tthis._endTweenDataList=null;\r\n\t\tif (this._tweenDataList && this._tweenDataList.length){\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tlen=this._tweenDataList.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tif(this._tweenDataList[i])\r\n\t\t\t\t\tthis._tweenDataList[i].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._tweenDataList.length=0;\r\n\t\tthis._currTime=0;\r\n\t\tthis._lastTime=0;\r\n\t\tthis._startTime=0;\r\n\t\tthis._index=0;\r\n\t\tthis._gidIndex=0;\r\n\t\tthis.scale=1;\r\n\t\tLaya.timer.clear(this,this._update);\r\n\t}\r\n\r\n\t/**\r\n\t*彻底销毁此对象。\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis.reset();\r\n\t\tthis._labelDic=null;\r\n\t\tthis._tweenDic=null;\r\n\t\tthis._tweenDataList=null;\r\n\t\tthis._firstTweenDic=null;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置帧索引\r\n\t*/\r\n\t/**\r\n\t*@private\r\n\t*得到帧索引\r\n\t*/\r\n\t__getset(0,__proto,'index',function(){\r\n\t\treturn this._frameIndex;\r\n\t\t},function(value){\r\n\t\tthis._frameIndex=value;\r\n\t\tthis.gotoTime(this._frameIndex / this._frameRate *1000);\r\n\t});\r\n\r\n\t/**\r\n\t*得到总帧数。\r\n\t*/\r\n\t__getset(0,__proto,'total',function(){\r\n\t\tthis._total=Math.floor(this._startTime / 1000 *this._frameRate);\r\n\t\treturn this._total;\r\n\t});\r\n\r\n\tTimeLine.to=function(target,props,duration,ease,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\treturn (new TimeLine()).to(target,props,duration,ease,offset);\r\n\t}\r\n\r\n\tTimeLine.from=function(target,props,duration,ease,offset){\r\n\t\t(offset===void 0)&& (offset=0);\r\n\t\treturn (new TimeLine()).from(target,props,duration,ease,offset);\r\n\t}\r\n\r\n\tTimeLine.__init$=function(){\r\n\t\t//class tweenData\r\n\t\ttweenData=(function(){\r\n\t\t\tfunction tweenData(){\r\n\t\t\t\tthis.type=0;\r\n\t\t\t\t//0代表TWEEN,1代表标签\r\n\t\t\t\tthis.isTo=true;\r\n\t\t\t\tthis.startTime=NaN;\r\n\t\t\t\tthis.endTime=NaN;\r\n\t\t\t\tthis.target=null;\r\n\t\t\t\tthis.duration=NaN;\r\n\t\t\t\tthis.ease=null;\r\n\t\t\t\tthis.data=null;\r\n\t\t\t}\r\n\t\t\t__class(tweenData,'');\r\n\t\t\tvar __proto=tweenData.prototype;\r\n\t\t\t__proto.destroy=function(){\r\n\t\t\t\tthis.target=null;\r\n\t\t\t\tthis.ease=null;\r\n\t\t\t\tthis.data=null;\r\n\t\t\t\tthis.isTo=true;\r\n\t\t\t\tthis.type=0;\r\n\t\t\t\tPool.recover(\"tweenData\",this);\r\n\t\t\t}\r\n\t\t\treturn tweenData;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn TimeLine;\r\n})(EventDispatcher)\r\n\r\n\r\n/**\r\n*<p> <code>Sprite</code> 是基本的显示图形的显示列表节点。 <code>Sprite</code> 默认没有宽高，默认不接受鼠标事件。通过 <code>graphics</code> 可以绘制图片或者矢量图，支持旋转，缩放，位移等操作。<code>Sprite</code>同时也是容器类，可用来添加多个子节点。</p>\r\n*<p>注意： <code>Sprite</code> 默认没有宽高，可以通过<code>getBounds</code>函数获取；也可手动设置宽高；还可以设置<code>autoSize=true</code>，然后再获取宽高。<code>Sprite</code>的宽高一般用于进行碰撞检测和排版，并不影响显示图像大小，如果需要更改显示图像大小，请使用 <code>scaleX</code> ， <code>scaleY</code> ， <code>scale</code>。</p>\r\n*<p> <code>Sprite</code> 默认不接受鼠标事件，即<code>mouseEnabled=false</code>，但是只要对其监听任意鼠标事件，会自动打开自己以及所有父对象的<code>mouseEnabled=true</code>。所以一般也无需手动设置<code>mouseEnabled</code>。</p>\r\n*<p>LayaAir引擎API设计精简巧妙。核心显示类只有一个<code>Sprite</code>。<code>Sprite</code>针对不同的情况做了渲染优化，所以保证一个类实现丰富功能的同时，又达到高性能。</p>\r\n*\r\n*@example <caption>创建了一个 <code>Sprite</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.display.Sprite;\r\n\t*import laya.events.Event;\r\n\t*\r\n\t*public class Sprite_Example\r\n\t*{\r\n\t\t*private var sprite:Sprite;\r\n\t\t*private var shape:Sprite\r\n\t\t*public function Sprite_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*onInit();\r\n\t\t\t*}\r\n\t\t*private function onInit():void\r\n\t\t*{\r\n\t\t\t*sprite=new Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t\t\t*sprite.loadImage(\"resource/ui/bg.png\");//加载并显示图片。\r\n\t\t\t*sprite.x=200;//设置 sprite 对象相对于父容器的水平方向坐标值。\r\n\t\t\t*sprite.y=200;//设置 sprite 对象相对于父容器的垂直方向坐标值。\r\n\t\t\t*sprite.pivotX=0;//设置 sprite 对象的水平方法轴心点坐标。\r\n\t\t\t*sprite.pivotY=0;//设置 sprite 对象的垂直方法轴心点坐标。\r\n\t\t\t*Laya.stage.addChild(sprite);//将此 sprite 对象添加到显示列表。\r\n\t\t\t*sprite.on(Event.CLICK,this,onClickSprite);//给 sprite 对象添加点击事件侦听。\r\n\t\t\t*shape=new Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t\t\t*shape.graphics.drawRect(0,0,100,100,\"#ccff00\",\"#ff0000\",2);//绘制一个有边框的填充矩形。\r\n\t\t\t*shape.x=400;//设置 shape 对象相对于父容器的水平方向坐标值。\r\n\t\t\t*shape.y=200;//设置 shape 对象相对于父容器的垂直方向坐标值。\r\n\t\t\t*shape.width=100;//设置 shape 对象的宽度。\r\n\t\t\t*shape.height=100;//设置 shape 对象的高度。\r\n\t\t\t*shape.pivotX=50;//设置 shape 对象的水平方法轴心点坐标。\r\n\t\t\t*shape.pivotY=50;//设置 shape 对象的垂直方法轴心点坐标。\r\n\t\t\t*Laya.stage.addChild(shape);//将此 shape 对象添加到显示列表。\r\n\t\t\t*shape.on(Event.CLICK,this,onClickShape);//给 shape 对象添加点击事件侦听。\r\n\t\t\t*}\r\n\t\t*private function onClickSprite():void\r\n\t\t*{\r\n\t\t\t*trace(\"点击 sprite 对象。\");\r\n\t\t\t*sprite.rotation+=5;//旋转 sprite 对象。\r\n\t\t\t*}\r\n\t\t*private function onClickShape():void\r\n\t\t*{\r\n\t\t\t*trace(\"点击 shape 对象。\");\r\n\t\t\t*shape.rotation+=5;//旋转 shape 对象。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*\r\n*@example\r\n*var sprite;\r\n*var shape;\r\n*Sprite_Example();\r\n*function Sprite_Example()\r\n*{\r\n\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t*onInit();\r\n\t*}\r\n*function onInit()\r\n*{\r\n\t*sprite=new laya.display.Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t*sprite.loadImage(\"resource/ui/bg.png\");//加载并显示图片。\r\n\t*sprite.x=200;//设置 sprite 对象相对于父容器的水平方向坐标值。\r\n\t*sprite.y=200;//设置 sprite 对象相对于父容器的垂直方向坐标值。\r\n\t*sprite.pivotX=0;//设置 sprite 对象的水平方法轴心点坐标。\r\n\t*sprite.pivotY=0;//设置 sprite 对象的垂直方法轴心点坐标。\r\n\t*Laya.stage.addChild(sprite);//将此 sprite 对象添加到显示列表。\r\n\t*sprite.on(Event.CLICK,this,onClickSprite);//给 sprite 对象添加点击事件侦听。\r\n\t*shape=new laya.display.Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t*shape.graphics.drawRect(0,0,100,100,\"#ccff00\",\"#ff0000\",2);//绘制一个有边框的填充矩形。\r\n\t*shape.x=400;//设置 shape 对象相对于父容器的水平方向坐标值。\r\n\t*shape.y=200;//设置 shape 对象相对于父容器的垂直方向坐标值。\r\n\t*shape.width=100;//设置 shape 对象的宽度。\r\n\t*shape.height=100;//设置 shape 对象的高度。\r\n\t*shape.pivotX=50;//设置 shape 对象的水平方法轴心点坐标。\r\n\t*shape.pivotY=50;//设置 shape 对象的垂直方法轴心点坐标。\r\n\t*Laya.stage.addChild(shape);//将此 shape 对象添加到显示列表。\r\n\t*shape.on(laya.events.Event.CLICK,this,onClickShape);//给 shape 对象添加点击事件侦听。\r\n\t*}\r\n*function onClickSprite()\r\n*{\r\n\t*console.log(\"点击 sprite 对象。\");\r\n\t*sprite.rotation+=5;//旋转 sprite 对象。\r\n\t*}\r\n*function onClickShape()\r\n*{\r\n\t*console.log(\"点击 shape 对象。\");\r\n\t*shape.rotation+=5;//旋转 shape 对象。\r\n\t*}\r\n*\r\n*@example\r\n*import Sprite=laya.display.Sprite;\r\n*class Sprite_Example {\r\n\t*private sprite:Sprite;\r\n\t*private shape:Sprite\r\n\t*public Sprite_Example(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.onInit();\r\n\t\t*}\r\n\t*private onInit():void {\r\n\t\t*this.sprite=new Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t\t*this.sprite.loadImage(\"resource/ui/bg.png\");//加载并显示图片。\r\n\t\t*this.sprite.x=200;//设置 sprite 对象相对于父容器的水平方向坐标值。\r\n\t\t*this.sprite.y=200;//设置 sprite 对象相对于父容器的垂直方向坐标值。\r\n\t\t*this.sprite.pivotX=0;//设置 sprite 对象的水平方法轴心点坐标。\r\n\t\t*this.sprite.pivotY=0;//设置 sprite 对象的垂直方法轴心点坐标。\r\n\t\t*Laya.stage.addChild(this.sprite);//将此 sprite 对象添加到显示列表。\r\n\t\t*this.sprite.on(laya.events.Event.CLICK,this,this.onClickSprite);//给 sprite 对象添加点击事件侦听。\r\n\t\t*this.shape=new Sprite();//创建一个 Sprite 类的实例对象 sprite 。\r\n\t\t*this.shape.graphics.drawRect(0,0,100,100,\"#ccff00\",\"#ff0000\",2);//绘制一个有边框的填充矩形。\r\n\t\t*this.shape.x=400;//设置 shape 对象相对于父容器的水平方向坐标值。\r\n\t\t*this.shape.y=200;//设置 shape 对象相对于父容器的垂直方向坐标值。\r\n\t\t*this.shape.width=100;//设置 shape 对象的宽度。\r\n\t\t*this.shape.height=100;//设置 shape 对象的高度。\r\n\t\t*this.shape.pivotX=50;//设置 shape 对象的水平方法轴心点坐标。\r\n\t\t*this.shape.pivotY=50;//设置 shape 对象的垂直方法轴心点坐标。\r\n\t\t*Laya.stage.addChild(this.shape);//将此 shape 对象添加到显示列表。\r\n\t\t*this.shape.on(laya.events.Event.CLICK,this,this.onClickShape);//给 shape 对象添加点击事件侦听。\r\n\t\t*}\r\n\t*private onClickSprite():void {\r\n\t\t*console.log(\"点击 sprite 对象。\");\r\n\t\t*this.sprite.rotation+=5;//旋转 sprite 对象。\r\n\t\t*}\r\n\t*private onClickShape():void {\r\n\t\t*console.log(\"点击 shape 对象。\");\r\n\t\t*this.shape.rotation+=5;//旋转 shape 对象。\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.display.Sprite extends laya.display.Node\r\nvar Sprite=(function(_super){\r\n\tfunction Sprite(){\r\n\t\t/**@private 矩阵变换信息。*/\r\n\t\tthis._transform=null;\r\n\t\t/**@private */\r\n\t\tthis._tfChanged=false;\r\n\t\t/**@private */\r\n\t\tthis._x=0;\r\n\t\t/**@private */\r\n\t\tthis._y=0;\r\n\t\t/**@private */\r\n\t\tthis._width=0;\r\n\t\t/**@private */\r\n\t\tthis._height=0;\r\n\t\t/**@private */\r\n\t\tthis._repaint=1;\r\n\t\t/**@private 鼠标状态，0:auto,1:mouseEnabled=false,2:mouseEnabled=true。*/\r\n\t\tthis._mouseEnableState=0;\r\n\t\t/**@private Z排序，数值越大越靠前。*/\r\n\t\tthis._zOrder=0;\r\n\t\t/**@private */\r\n\t\tthis._graphics=null;\r\n\t\t/**@private */\r\n\t\tthis._renderType=0;\r\n\t\t/**@private */\r\n\t\tthis._optimizeScrollRect=false;\r\n\t\t/**@private */\r\n\t\tthis._texture=null;\r\n\t\t/**\r\n\t\t*<p>鼠标事件与此对象的碰撞检测是否可穿透。碰撞检测发生在鼠标事件的捕获阶段，此阶段引擎会从stage开始递归检测stage及其子对象，直到找到命中的目标对象或者未命中任何对象。</p>\r\n\t\t*<p>穿透表示鼠标事件发生的位置处于本对象绘图区域内时，才算命中，而与对象宽高和值为Rectangle对象的hitArea属性无关。如果sprite.hitArea值是HitArea对象，表示显式声明了此对象的鼠标事件响应区域，而忽略对象的宽高、mouseThrough属性。</p>\r\n\t\t*<p>影响对象鼠标事件响应区域的属性为：width、height、hitArea，优先级顺序为：hitArea(type:HitArea)>hitArea(type:Rectangle)>width/height。</p>\r\n\t\t*@default false 不可穿透，此对象的鼠标响应区域由width、height、hitArea属性决定。</p>\r\n\t\t*/\r\n\t\tthis.mouseThrough=false;\r\n\t\t/**\r\n\t\t*<p>指定是否自动计算宽高数据。默认值为 false 。</p>\r\n\t\t*<p>Sprite宽高默认为0，并且不会随着绘制内容的变化而变化，如果想根据绘制内容获取宽高，可以设置本属性为true，或者通过getBounds方法获取。设置为true，对性能有一定影响。</p>\r\n\t\t*/\r\n\t\tthis.autoSize=false;\r\n\t\t/**\r\n\t\t*<p>指定鼠标事件检测是优先检测自身，还是优先检测其子对象。鼠标事件检测发生在鼠标事件的捕获阶段，此阶段引擎会从stage开始递归检测stage及其子对象，直到找到命中的目标对象或者未命中任何对象。</p>\r\n\t\t*<p>如果为false，优先检测子对象，当有子对象被命中时，中断检测，获得命中目标。如果未命中任何子对象，最后再检测此对象；如果为true，则优先检测本对象，如果本对象没有被命中，直接中断检测，表示没有命中目标；如果本对象被命中，则进一步递归检测其子对象，以确认最终的命中目标。</p>\r\n\t\t*<p>合理使用本属性，能减少鼠标事件检测的节点，提高性能。可以设置为true的情况：开发者并不关心此节点的子节点的鼠标事件检测结果，也就是以此节点作为其子节点的鼠标事件检测依据。</p>\r\n\t\t*<p>Stage对象和UI的View组件默认为true。</p>\r\n\t\t*@default false 优先检测此对象的子对象，当递归检测完所有子对象后，仍然没有找到目标对象，最后再检测此对象。\r\n\t\t*/\r\n\t\tthis.hitTestPrior=false;\r\n\t\t/**\r\n\t\t*<p>视口大小，视口外的子对象，将不被渲染(如果想实现裁剪效果，请使用srollRect)，合理使用能提高渲染性能。比如由一个个小图片拼成的地图块，viewport外面的小图片将不渲染</p>\r\n\t\t*<p>srollRect和viewport的区别：<br/>\r\n\t\t*1. srollRect自带裁剪效果，viewport只影响子对象渲染是否渲染，不具有裁剪效果（性能更高）。<br/>\r\n\t\t*2. 设置rect的x,y属性均能实现区域滚动效果，但scrollRect会保持0,0点位置不变。</p>\r\n\t\t*@default null\r\n\t\t*/\r\n\t\tthis.viewport=null;\r\n\t\tSprite.__super.call(this);\r\n\t\tthis._style=Style.EMPTY;\r\n\t}\r\n\r\n\t__class(Sprite,'laya.display.Sprite',_super);\r\n\tvar __proto=Sprite.prototype;\r\n\tLaya.imps(__proto,{\"laya.display.ILayout\":true})\r\n\t/**@private */\r\n\t__proto.createConchModel=function(){\r\n\t\treturn /*__JS__ */new ConchNode();\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis._releaseMem();\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._style && this._style.destroy();\r\n\t\tthis._transform && this._transform.destroy();\r\n\t\tthis._transform=null;\r\n\t\tthis._style=null;\r\n\t\tthis._graphics=null;\r\n\t}\r\n\r\n\t/**根据zOrder进行重新排序。*/\r\n\t__proto.updateZOrder=function(){\r\n\t\tUtils.updateOrder(this._childs)&& this.repaint();\r\n\t}\r\n\r\n\t/**在设置cacheAs的情况下，调用此方法会重新刷新缓存。*/\r\n\t__proto.reCache=function(){\r\n\t\tif (this._$P.cacheCanvas)this._$P.cacheCanvas.reCache=true;\r\n\t\tthis._repaint=1;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置对象在自身坐标系下的边界范围。与 <code>getSelfBounds</code> 对应。当 autoSize==true 时，会影响对象宽高。设置后，当需要获取自身边界范围时，就不再需要计算，合理使用能提高性能。比如 <code>getBounds</code> 会优先使用 <code>setBounds</code> 指定的值，如果没有指定则进行计算，此计算会对性能消耗比较大。</p>\r\n\t*<p><b>注意：</b> <code>setBounds</code> 与 <code>getBounds</code> 并非对应相等关系， <code>getBounds</code> 获取的是本对象在父容器坐标系下的边界范围，通过设置 <code>setBounds</code> 会影响 <code>getBounds</code> 的结果。</p>\r\n\t*@param bound bounds矩形区域\r\n\t*/\r\n\t__proto.setBounds=function(bound){\r\n\t\tthis._set$P(\"uBounds\",bound);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>获取本对象在父容器坐标系的矩形显示区域。</p>\r\n\t*<p><b>注意：</b> 1.计算量较大，尽量少用，如果需要频繁使用，可以通过手动设置 <code>setBounds</code> 来缓存自身边界信息，从而避免比较消耗性能的计算。2. <code>setBounds</code> 与 <code>getBounds</code> 并非对应相等关系， <code>getBounds</code> 获取的是本对象在父容器坐标系下的边界范围，通过设置 <code>setBounds</code> 会影响 <code>getBounds</code> 的结果。</p>\r\n\t*@return 矩形区域。\r\n\t*/\r\n\t__proto.getBounds=function(){\r\n\t\tif (!this._$P.mBounds)this._set$P(\"mBounds\",new Rectangle());\r\n\t\treturn Rectangle._getWrapRec(this._boundPointsToParent(),this._$P.mBounds);\r\n\t}\r\n\r\n\t/**\r\n\t*获取对象在自身坐标系的边界范围。与 <code>setBounds</code> 对应。\r\n\t*<p><b>注意：</b>计算量较大，尽量少用，如果需要频繁使用，可以提前手动设置 <code>setBounds</code> 来缓存自身边界信息，从而避免比较消耗性能的计算。</p>\r\n\t*@return 矩形区域。\r\n\t*/\r\n\t__proto.getSelfBounds=function(){\r\n\t\tif (this._$P.uBounds)return this._$P.uBounds;\r\n\t\tif (!this._$P.mBounds)this._set$P(\"mBounds\",new Rectangle());\r\n\t\treturn Rectangle._getWrapRec(this._getBoundPointsM(false),this._$P.mBounds);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取本对象在父容器坐标系的显示区域多边形顶点列表。\r\n\t*当显示对象链中有旋转时，返回多边形顶点列表，无旋转时返回矩形的四个顶点。\r\n\t*@param ifRotate （可选）之前的对象链中是否有旋转。\r\n\t*@return 顶点列表。结构：[x1,y1,x2,y2,x3,y3,...]。\r\n\t*/\r\n\t__proto._boundPointsToParent=function(ifRotate){\r\n\t\t(ifRotate===void 0)&& (ifRotate=false);\r\n\t\tvar pX=0,pY=0;\r\n\t\tif (this._style){\r\n\t\t\tpX=this._style._tf.translateX;\r\n\t\t\tpY=this._style._tf.translateY;\r\n\t\t\tifRotate=ifRotate || (this._style._tf.rotate!==0);\r\n\t\t\tif (this._style.scrollRect){\r\n\t\t\t\tpX+=this._style.scrollRect.x;\r\n\t\t\t\tpY+=this._style.scrollRect.y;\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar pList=this._getBoundPointsM(ifRotate);\r\n\t\tif (!pList || pList.length < 1)return pList;\r\n\t\tif (pList.length !=8){\r\n\t\t\tpList=ifRotate ? GrahamScan.scanPList(pList):Rectangle._getWrapRec(pList,Rectangle.TEMP)._getBoundPoints();\r\n\t\t}\r\n\t\tif (!this.transform){\r\n\t\t\tUtils.transPointList(pList,this._x-pX,this._y-pY);\r\n\t\t\treturn pList;\r\n\t\t};\r\n\t\tvar tPoint=Point.TEMP;\r\n\t\tvar i=0,len=pList.length;\r\n\t\tfor (i=0;i < len;i+=2){\r\n\t\t\ttPoint.x=pList[i];\r\n\t\t\ttPoint.y=pList[i+1];\r\n\t\t\tthis.toParentPoint(tPoint);\r\n\t\t\tpList[i]=tPoint.x;\r\n\t\t\tpList[i+1]=tPoint.y;\r\n\t\t}\r\n\t\treturn pList;\r\n\t}\r\n\r\n\t/**\r\n\t*返回此实例中的绘图对象（ <code>Graphics</code> ）的显示区域，不包括子对象。\r\n\t*@param realSize （可选）使用图片的真实大小，默认为false\r\n\t*@return 一个 Rectangle 对象，表示获取到的显示区域。\r\n\t*/\r\n\t__proto.getGraphicBounds=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tif (!this._graphics)return Rectangle.TEMP.setTo(0,0,0,0);\r\n\t\treturn this._graphics.getBounds(realSize);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取自己坐标系的显示区域多边形顶点列表\r\n\t*@param ifRotate （可选）当前的显示对象链是否由旋转\r\n\t*@return 顶点列表。结构：[x1,y1,x2,y2,x3,y3,...]。\r\n\t*/\r\n\t__proto._getBoundPointsM=function(ifRotate){\r\n\t\t(ifRotate===void 0)&& (ifRotate=false);\r\n\t\tif (this._$P.uBounds)return this._$P.uBounds._getBoundPoints();\r\n\t\tif (!this._$P.temBM)this._set$P(\"temBM\",[]);\r\n\t\tif (this.scrollRect){\r\n\t\t\tvar rst=Utils.clearArray(this._$P.temBM);\r\n\t\t\tvar rec=Rectangle.TEMP;\r\n\t\t\trec.copyFrom(this.scrollRect);\r\n\t\t\tUtils.concatArray(rst,rec._getBoundPoints());\r\n\t\t\treturn rst;\r\n\t\t};\r\n\t\tvar pList=this._graphics ? this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM);\r\n\t\tvar child;\r\n\t\tvar cList;\r\n\t\tvar __childs;\r\n\t\t__childs=this._childs;\r\n\t\tfor (var i=0,n=__childs.length;i < n;i++){\r\n\t\t\tchild=__childs [i];\r\n\t\t\tif ((child instanceof laya.display.Sprite )&& child.visible==true){\r\n\t\t\t\tcList=child._boundPointsToParent(ifRotate);\r\n\t\t\t\tif (cList)\r\n\t\t\t\t\tpList=pList ? Utils.concatArray(pList,cList):cList;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pList;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取样式。\r\n\t*@return 样式 Style 。\r\n\t*/\r\n\t__proto.getStyle=function(){\r\n\t\tthis._style===Style.EMPTY && (this._style=new Style());\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置样式。\r\n\t*@param value 样式。\r\n\t*/\r\n\t__proto.setStyle=function(value){\r\n\t\tthis._style=value;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._adjustTransform=function(){\r\n\t\t'use strict';\r\n\t\tthis._tfChanged=false;\r\n\t\tvar style=this._style;\r\n\t\tvar tf=style._tf;\r\n\t\tvar sx=tf.scaleX,sy=tf.scaleY;\r\n\t\tvar m;\r\n\t\tif (tf.rotate || sx!==1 || sy!==1 || tf.skewX || tf.skewY){\r\n\t\t\tm=this._transform || (this._transform=Matrix.create());\r\n\t\t\tm.bTransform=true;\r\n\t\t\tvar skx=(tf.rotate-tf.skewX)*0.0174532922222222;\r\n\t\t\tvar sky=(tf.rotate+tf.skewY)*0.0174532922222222;\r\n\t\t\tvar cx=Math.cos(sky);\r\n\t\t\tvar ssx=Math.sin(sky);\r\n\t\t\tvar cy=Math.sin(skx);\r\n\t\t\tvar ssy=Math.cos(skx);\r\n\t\t\tm.a=sx *cx;\r\n\t\t\tm.b=sx *ssx;\r\n\t\t\tm.c=-sy *cy;\r\n\t\t\tm.d=sy *ssy;\r\n\t\t\tm.tx=m.ty=0;\r\n\t\t\treturn m;\r\n\t\t\t}else {\r\n\t\t\tthis._transform && this._transform.destroy();\r\n\t\t\tthis._transform=null;\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t}\r\n\t\treturn m;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置坐标位置。相当于分别设置x和y属性。</p>\r\n\t*<p>因为返回值为Sprite对象本身，所以可以使用如下语法：spr.pos(...).scale(...);</p>\r\n\t*@param x X轴坐标。\r\n\t*@param y Y轴坐标。\r\n\t*@param speedMode （可选）是否极速模式，正常是调用this.x=value进行赋值，极速模式直接调用内部函数处理，如果未重写x,y属性，建议设置为急速模式性能更高。\r\n\t*@return 返回对象本身。\r\n\t*/\r\n\t__proto.pos=function(x,y,speedMode){\r\n\t\t(speedMode===void 0)&& (speedMode=false);\r\n\t\tif (this._x!==x || this._y!==y){\r\n\t\t\tif (this.destroyed)return this;\r\n\t\t\tif (speedMode){\r\n\t\t\t\tthis._x=x;\r\n\t\t\t\tthis._y=y;\r\n\t\t\t\tthis.conchModel && this.conchModel.pos(this._x,this._y);\r\n\t\t\t\tvar p=this._parent;\r\n\t\t\t\tif (p && p._repaint===0){\r\n\t\t\t\t\tp._repaint=1;\r\n\t\t\t\t\tp.parentRepaint();\r\n\t\t\t\t}\r\n\t\t\t\tif (this._$P.maskParent && this._$P.maskParent._repaint===0){\r\n\t\t\t\t\tthis._$P.maskParent._repaint=1;\r\n\t\t\t\t\tthis._$P.maskParent.parentRepaint();\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.x=x;\r\n\t\t\t\tthis.y=y;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置轴心点。相当于分别设置pivotX和pivotY属性。</p>\r\n\t*<p>因为返回值为Sprite对象本身，所以可以使用如下语法：spr.pivot(...).pos(...);</p>\r\n\t*@param x X轴心点。\r\n\t*@param y Y轴心点。\r\n\t*@return 返回对象本身。\r\n\t*/\r\n\t__proto.pivot=function(x,y){\r\n\t\tthis.pivotX=x;\r\n\t\tthis.pivotY=y;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置宽高。相当于分别设置width和height属性。</p>\r\n\t*<p>因为返回值为Sprite对象本身，所以可以使用如下语法：spr.size(...).pos(...);</p>\r\n\t*@param width 宽度值。\r\n\t*@param hegiht 高度值。\r\n\t*@return 返回对象本身。\r\n\t*/\r\n\t__proto.size=function(width,height){\r\n\t\tthis.width=width;\r\n\t\tthis.height=height;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置缩放。相当于分别设置scaleX和scaleY属性。</p>\r\n\t*<p>因为返回值为Sprite对象本身，所以可以使用如下语法：spr.scale(...).pos(...);</p>\r\n\t*@param scaleX X轴缩放比例。\r\n\t*@param scaleY Y轴缩放比例。\r\n\t*@param speedMode （可选）是否极速模式，正常是调用this.scaleX=value进行赋值，极速模式直接调用内部函数处理，如果未重写scaleX,scaleY属性，建议设置为急速模式性能更高。\r\n\t*@return 返回对象本身。\r\n\t*/\r\n\t__proto.scale=function(scaleX,scaleY,speedMode){\r\n\t\t(speedMode===void 0)&& (speedMode=false);\r\n\t\tvar style=this.getStyle();\r\n\t\tvar _tf=style._tf;\r\n\t\tif (_tf.scaleX !=scaleX || _tf.scaleY !=scaleY){\r\n\t\t\tif (this.destroyed)return this;\r\n\t\t\tif (speedMode){\r\n\t\t\t\tstyle.setScale(scaleX,scaleY);\r\n\t\t\t\tthis._tfChanged=true;\r\n\t\t\t\tthis.conchModel && this.conchModel.scale(scaleX,scaleY);\r\n\t\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\t\tvar p=this._parent;\r\n\t\t\t\tif (p && p._repaint===0){\r\n\t\t\t\t\tp._repaint=1;\r\n\t\t\t\t\tp.parentRepaint();\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.scaleX=scaleX;\r\n\t\t\t\tthis.scaleY=scaleY;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>设置倾斜角度。相当于分别设置skewX和skewY属性。</p>\r\n\t*<p>因为返回值为Sprite对象本身，所以可以使用如下语法：spr.skew(...).pos(...);</p>\r\n\t*@param skewX 水平倾斜角度。\r\n\t*@param skewY 垂直倾斜角度。\r\n\t*@return 返回对象本身\r\n\t*/\r\n\t__proto.skew=function(skewX,skewY){\r\n\t\tthis.skewX=skewX;\r\n\t\tthis.skewY=skewY;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*更新、呈现显示对象。由系统调用。\r\n\t*@param context 渲染的上下文引用。\r\n\t*@param x X轴坐标。\r\n\t*@param y Y轴坐标。\r\n\t*/\r\n\t__proto.render=function(context,x,y){\r\n\t\tStat.spriteCount++;\r\n\t\tRenderSprite.renders[this._renderType]._fun(this,context,x+this._x,y+this._y);\r\n\t\tthis._repaint=0;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>绘制 当前<code>Sprite</code> 到 <code>Canvas</code> 上，并返回一个HtmlCanvas。</p>\r\n\t*<p>绘制的结果可以当作图片源，再次绘制到其他Sprite里面，示例：</p>\r\n\t*\r\n\t*var htmlCanvas:HTMLCanvas=sprite.drawToCanvas(100,100,0,0);//把精灵绘制到canvas上面\r\n\t*var texture:Texture=new Texture(htmlCanvas);//使用htmlCanvas创建Texture\r\n\t*var sp:Sprite=new Sprite().pos(0,200);//创建精灵并把它放倒200位置\r\n\t*sp.graphics.drawTexture(texture);//把截图绘制到精灵上\r\n\t*Laya.stage.addChild(sp);//把精灵显示到舞台\r\n\t*\r\n\t*<p>也可以获取原始图片数据，分享到网上，从而实现截图效果，示例：</p>\r\n\t*\r\n\t*var htmlCanvas:HTMLCanvas=sprite.drawToCanvas(100,100,0,0);//把精灵绘制到canvas上面\r\n\t*\r\n\t*htmlCanvas.toBase64(\"image/png\",0.92,function(base64){//webgl和canvas模式下为同步方法，加速器下是异步方法\r\n\t\t*trace(base64);//打印图片base64信息，可以发给服务器或者保存为图片\r\n\t\t*});\r\n\t*\r\n\t*@param canvasWidth 画布宽度。\r\n\t*@param canvasHeight 画布高度。\r\n\t*@param x 绘制的 X 轴偏移量。\r\n\t*@param y 绘制的 Y 轴偏移量。\r\n\t*@return HTMLCanvas 对象。\r\n\t*/\r\n\t__proto.drawToCanvas=function(canvasWidth,canvasHeight,offsetX,offsetY){\r\n\t\tif (Render.isConchNode){\r\n\t\t\tvar canvas=HTMLCanvas.create(\"2D\");\r\n\t\t\tvar context=new RenderContext(canvasWidth,canvasHeight,canvas);\r\n\t\t\tcontext.ctx.setCanvasType(1);\r\n\t\t\tthis.conchModel.drawToCanvas(canvas.source,offsetX,offsetY);\r\n\t\t\treturn canvas;\r\n\t\t\t}else {\r\n\t\t\treturn RunDriver.drawToCanvas(this,this._renderType,canvasWidth,canvasHeight,offsetX,offsetY);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>自定义更新、呈现显示对象。一般用来扩展渲染模式，请合理使用，可能会导致在加速器上无法渲染。</p>\r\n\t*<p><b>注意</b>不要在此函数内增加或删除树节点，否则会对树节点遍历造成影响。</p>\r\n\t*@param context 渲染的上下文引用。\r\n\t*@param x X轴坐标。\r\n\t*@param y Y轴坐标。\r\n\t*/\r\n\t__proto.customRender=function(context,x,y){\r\n\t\tthis._renderType |=/*laya.renders.RenderSprite.CUSTOM*/0x400;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*应用滤镜。\r\n\t*/\r\n\t__proto._applyFilters=function(){\r\n\t\tif (Render.isWebGL)return;\r\n\t\tvar _filters;\r\n\t\t_filters=this._$P.filters;\r\n\t\tif (!_filters || _filters.length < 1)return;\r\n\t\tfor (var i=0,n=_filters.length;i < n;i++){\r\n\t\t\t_filters[i].action.apply(this._$P.cacheCanvas);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*查看当前原件中是否包含发光滤镜。\r\n\t*@return 一个 Boolean 值，表示当前原件中是否包含发光滤镜。\r\n\t*/\r\n\t__proto._isHaveGlowFilter=function(){\r\n\t\tvar i=0,len=0;\r\n\t\tif (this.filters){\r\n\t\t\tfor (i=0;i < this.filters.length;i++){\r\n\t\t\t\tif (this.filters[i].type==/*laya.filters.Filter.GLOW*/0x08){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (i=0,len=this._childs.length;i < len;i++){\r\n\t\t\tif (this._childs[i]._isHaveGlowFilter()){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t*把本地坐标转换为相对stage的全局坐标。\r\n\t*@param point 本地坐标点。\r\n\t*@param createNewPoint （可选）是否创建一个新的Point对象作为返回值，默认为false，使用输入的point对象返回，减少对象创建开销。\r\n\t*@return 转换后的坐标的点。\r\n\t*/\r\n\t__proto.localToGlobal=function(point,createNewPoint){\r\n\t\t(createNewPoint===void 0)&& (createNewPoint=false);\r\n\t\tif (createNewPoint===true){\r\n\t\t\tpoint=new Point(point.x,point.y);\r\n\t\t};\r\n\t\tvar ele=this;\r\n\t\twhile (ele){\r\n\t\t\tif (ele==Laya.stage)break ;\r\n\t\t\tpoint=ele.toParentPoint(point);\r\n\t\t\tele=ele.parent;\r\n\t\t}\r\n\t\treturn point;\r\n\t}\r\n\r\n\t/**\r\n\t*把stage的全局坐标转换为本地坐标。\r\n\t*@param point 全局坐标点。\r\n\t*@param createNewPoint （可选）是否创建一个新的Point对象作为返回值，默认为false，使用输入的point对象返回，减少对象创建开销。\r\n\t*@return 转换后的坐标的点。\r\n\t*/\r\n\t__proto.globalToLocal=function(point,createNewPoint){\r\n\t\t(createNewPoint===void 0)&& (createNewPoint=false);\r\n\t\tif (createNewPoint){\r\n\t\t\tpoint=new Point(point.x,point.y);\r\n\t\t};\r\n\t\tvar ele=this;\r\n\t\tvar list=[];\r\n\t\twhile (ele){\r\n\t\t\tif (ele==Laya.stage)break ;\r\n\t\t\tlist.push(ele);\r\n\t\t\tele=ele.parent;\r\n\t\t};\r\n\t\tvar i=list.length-1;\r\n\t\twhile (i >=0){\r\n\t\t\tele=list[i];\r\n\t\t\tpoint=ele.fromParentPoint(point);\r\n\t\t\ti--;\r\n\t\t}\r\n\t\treturn point;\r\n\t}\r\n\r\n\t/**\r\n\t*将本地坐标系坐标转转换到父容器坐标系。\r\n\t*@param point 本地坐标点。\r\n\t*@return 转换后的点。\r\n\t*/\r\n\t__proto.toParentPoint=function(point){\r\n\t\tif (!point)return point;\r\n\t\tpoint.x-=this.pivotX;\r\n\t\tpoint.y-=this.pivotY;\r\n\t\tif (this.transform){\r\n\t\t\tthis._transform.transformPoint(point);\r\n\t\t}\r\n\t\tpoint.x+=this._x;\r\n\t\tpoint.y+=this._y;\r\n\t\tvar scroll=this._style.scrollRect;\r\n\t\tif (scroll){\r\n\t\t\tpoint.x-=scroll.x;\r\n\t\t\tpoint.y-=scroll.y;\r\n\t\t}\r\n\t\treturn point;\r\n\t}\r\n\r\n\t/**\r\n\t*将父容器坐标系坐标转换到本地坐标系。\r\n\t*@param point 父容器坐标点。\r\n\t*@return 转换后的点。\r\n\t*/\r\n\t__proto.fromParentPoint=function(point){\r\n\t\tif (!point)return point;\r\n\t\tpoint.x-=this._x;\r\n\t\tpoint.y-=this._y;\r\n\t\tvar scroll=this._style.scrollRect;\r\n\t\tif (scroll){\r\n\t\t\tpoint.x+=scroll.x;\r\n\t\t\tpoint.y+=scroll.y;\r\n\t\t}\r\n\t\tif (this.transform){\r\n\t\t\tthis._transform.invertTransformPoint(point);\r\n\t\t}\r\n\t\tpoint.x+=this.pivotX;\r\n\t\tpoint.y+=this.pivotY;\r\n\t\treturn point;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>增加事件侦听器，以使侦听器能够接收事件通知。</p>\r\n\t*<p>如果侦听鼠标事件，则会自动设置自己和父亲节点的属性 mouseEnabled 的值为 true(如果父节点mouseEnabled=false，则停止设置父节点mouseEnabled属性)。</p>\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.on=function(type,caller,listener,args){\r\n\t\tif (this._mouseEnableState!==1 && this.isMouseEvent(type)){\r\n\t\t\tthis.mouseEnabled=true;\r\n\t\t\tthis._setBit(/*laya.display.Node.MOUSEENABLE*/0x2,true);\r\n\t\t\tif (this._parent){\r\n\t\t\t\tthis._$2__onDisplay();\r\n\t\t\t}\r\n\t\t\treturn this._createListener(type,caller,listener,args,false);\r\n\t\t}\r\n\t\treturn _super.prototype.on.call(this,type,caller,listener,args);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>增加事件侦听器，以使侦听器能够接收事件通知，此侦听事件响应一次后则自动移除侦听。</p>\r\n\t*<p>如果侦听鼠标事件，则会自动设置自己和父亲节点的属性 mouseEnabled 的值为 true(如果父节点mouseEnabled=false，则停止设置父节点mouseEnabled属性)。</p>\r\n\t*@param type 事件的类型。\r\n\t*@param caller 事件侦听函数的执行域。\r\n\t*@param listener 事件侦听函数。\r\n\t*@param args （可选）事件侦听函数的回调参数。\r\n\t*@return 此 EventDispatcher 对象。\r\n\t*/\r\n\t__proto.once=function(type,caller,listener,args){\r\n\t\tif (this._mouseEnableState!==1 && this.isMouseEvent(type)){\r\n\t\t\tthis.mouseEnabled=true;\r\n\t\t\tthis._setBit(/*laya.display.Node.MOUSEENABLE*/0x2,true);\r\n\t\t\tif (this._parent){\r\n\t\t\t\tthis._$2__onDisplay();\r\n\t\t\t}\r\n\t\t\treturn this._createListener(type,caller,listener,args,true);\r\n\t\t}\r\n\t\treturn _super.prototype.once.call(this,type,caller,listener,args);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._$2__onDisplay=function(){\r\n\t\tif (this._mouseEnableState!==1){\r\n\t\t\tvar ele=this;\r\n\t\t\tele=ele.parent;\r\n\t\t\twhile (ele && ele._mouseEnableState!==1){\r\n\t\t\t\tif (ele._getBit(/*laya.display.Node.MOUSEENABLE*/0x2))break ;\r\n\t\t\t\tele.mouseEnabled=true;\r\n\t\t\t\tele._setBit(/*laya.display.Node.MOUSEENABLE*/0x2,true);\r\n\t\t\t\tele=ele.parent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*<p>加载并显示一个图片。功能等同于graphics.loadImage方法。支持异步加载。</p>\r\n\t*<p>注意：多次调用loadImage绘制不同的图片，会同时显示。</p>\r\n\t*@param url 图片地址。\r\n\t*@param x （可选）显示图片的x位置。\r\n\t*@param y （可选）显示图片的y位置。\r\n\t*@param width （可选）显示图片的宽度，设置为0表示使用图片默认宽度。\r\n\t*@param height （可选）显示图片的高度，设置为0表示使用图片默认高度。\r\n\t*@param complete （可选）加载完成回调。\r\n\t*@return 返回精灵对象本身。\r\n\t*/\r\n\t__proto.loadImage=function(url,x,y,width,height,complete){\r\n\t\tvar _$this=this;\r\n\t\t(x===void 0)&& (x=0);\r\n\t\t(y===void 0)&& (y=0);\r\n\t\t(width===void 0)&& (width=0);\r\n\t\t(height===void 0)&& (height=0);\r\n\t\tfunction loaded (tex){\r\n\t\t\tif (!_$this.destroyed){\r\n\t\t\t\t_$this.size(x+(width || tex.width),y+(height || tex.height));\r\n\t\t\t\t_$this.repaint();\r\n\t\t\t\tcomplete && complete.runWith(tex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.graphics.loadImage(url,x,y,width,height,loaded);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**cacheAs后，设置自己和父对象缓存失效。*/\r\n\t__proto.repaint=function(){\r\n\t\tthis.conchModel && this.conchModel.repaint && this.conchModel.repaint();\r\n\t\tif (this._repaint===0){\r\n\t\t\tthis._repaint=1;\r\n\t\t\tthis.parentRepaint();\r\n\t\t}\r\n\t\tif (this._$P && this._$P.maskParent){\r\n\t\t\tthis._$P.maskParent.repaint();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*获取是否重新缓存。\r\n\t*@return 如果重新缓存值为 true，否则值为 false。\r\n\t*/\r\n\t__proto._needRepaint=function(){\r\n\t\treturn (this._repaint!==0)&& this._$P.cacheCanvas && this._$P.cacheCanvas.reCache;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._childChanged=function(child){\r\n\t\tif (this._childs.length)this._renderType |=/*laya.renders.RenderSprite.CHILDS*/0x800;\r\n\t\telse this._renderType &=~ /*laya.renders.RenderSprite.CHILDS*/0x800;\r\n\t\tif (child && this._get$P(\"hasZorder\"))Laya.timer.callLater(this,this.updateZOrder);\r\n\t\tthis.repaint();\r\n\t}\r\n\r\n\t/**cacheAs时，设置所有父对象缓存失效。 */\r\n\t__proto.parentRepaint=function(){\r\n\t\tvar p=this._parent;\r\n\t\tif (p && p._repaint===0){\r\n\t\t\tp._repaint=1;\r\n\t\t\tp.parentRepaint();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*开始拖动此对象。\r\n\t*@param area （可选）拖动区域，此区域为当前对象注册点活动区域（不包括对象宽高），可选。\r\n\t*@param hasInertia （可选）鼠标松开后，是否还惯性滑动，默认为false，可选。\r\n\t*@param elasticDistance （可选）橡皮筋效果的距离值，0为无橡皮筋效果，默认为0，可选。\r\n\t*@param elasticBackTime （可选）橡皮筋回弹时间，单位为毫秒，默认为300毫秒，可选。\r\n\t*@param data （可选）拖动事件携带的数据，可选。\r\n\t*@param disableMouseEvent （可选）禁用其他对象的鼠标检测，默认为false，设置为true能提高性能。\r\n\t*@param ratio （可选）惯性阻尼系数，影响惯性力度和时长。\r\n\t*/\r\n\t__proto.startDrag=function(area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){\r\n\t\t(hasInertia===void 0)&& (hasInertia=false);\r\n\t\t(elasticDistance===void 0)&& (elasticDistance=0);\r\n\t\t(elasticBackTime===void 0)&& (elasticBackTime=300);\r\n\t\t(disableMouseEvent===void 0)&& (disableMouseEvent=false);\r\n\t\t(ratio===void 0)&& (ratio=0.92);\r\n\t\tthis._$P.dragging || (this._set$P(\"dragging\",new Dragging()));\r\n\t\tthis._$P.dragging.start(this,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio);\r\n\t}\r\n\r\n\t/**停止拖动此对象。*/\r\n\t__proto.stopDrag=function(){\r\n\t\tthis._$P.dragging && this._$P.dragging.stop();\r\n\t}\r\n\r\n\t__proto._releaseMem=function(){\r\n\t\tif (!this._$P)return;\r\n\t\tvar cc=this._$P.cacheCanvas;\r\n\t\tif (cc && cc.ctx){\r\n\t\t\tPool.recover(\"RenderContext\",cc.ctx);\r\n\t\t\tcc.ctx.canvas.size(0,0);\r\n\t\t\tcc.ctx=null;\r\n\t\t};\r\n\t\tvar fc=this._$P._filterCache;\r\n\t\tif (fc){\r\n\t\t\tfc.destroy();\r\n\t\t\tfc.recycle();\r\n\t\t\tthis._set$P('_filterCache',null);\r\n\t\t}\r\n\t\tthis._$P._isHaveGlowFilter && this._set$P('_isHaveGlowFilter',false);\r\n\t\tthis._$P._isHaveGlowFilter=null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setDisplay=function(value){\r\n\t\tif (!value)this._releaseMem();\r\n\t\t_super.prototype._setDisplay.call(this,value);\r\n\t}\r\n\r\n\t/**\r\n\t*检测某个点是否在此对象内。\r\n\t*@param x 全局x坐标。\r\n\t*@param y 全局y坐标。\r\n\t*@return 表示是否在对象内。\r\n\t*/\r\n\t__proto.hitTestPoint=function(x,y){\r\n\t\tvar point=this.globalToLocal(Point.TEMP.setTo(x,y));\r\n\t\tx=point.x;\r\n\t\ty=point.y;\r\n\t\tvar rect=this._$P.hitArea ? this._$P.hitArea :(this._width > 0 && this._height > 0)? Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds();\r\n\t\treturn rect.contains(x,y);\r\n\t}\r\n\r\n\t/**获得相对于本对象上的鼠标坐标信息。*/\r\n\t__proto.getMousePoint=function(){\r\n\t\treturn this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY));\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getWords=function(){\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._addChildsToLayout=function(out){\r\n\t\tvar words=this._getWords();\r\n\t\tif (words==null && this._childs.length==0)return false;\r\n\t\tif (words){\r\n\t\t\tfor (var i=0,n=words.length;i < n;i++){\r\n\t\t\t\tout.push(words[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._childs.forEach(function(o,index,array){\r\n\t\t\to._style._enableLayout()&& o._addToLayout(out);\r\n\t\t});\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._addToLayout=function(out){\r\n\t\tif (this._style.absolute)return;\r\n\t\tthis._style.block ? out.push(this):(this._addChildsToLayout(out)&& (this.x=this.y=0));\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._isChar=function(){\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getCSSStyle=function(){\r\n\t\treturn this._style.getCSSStyle();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*设置指定属性名的属性值。\r\n\t*@param name 属性名。\r\n\t*@param value 属性值。\r\n\t*/\r\n\t__proto._setAttributes=function(name,value){\r\n\t\tswitch (name){\r\n\t\t\tcase 'x':\r\n\t\t\t\tthis.x=parseFloat(value);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'y':\r\n\t\t\t\tthis.y=parseFloat(value);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'width':\r\n\t\t\t\tthis.width=parseFloat(value);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'height':\r\n\t\t\t\tthis.height=parseFloat(value);\r\n\t\t\t\tbreak ;\r\n\t\t\tdefault :\r\n\t\t\t\tthis[name]=value;\r\n\t\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._layoutLater=function(){\r\n\t\tthis.parent && (this.parent)._layoutLater();\r\n\t}\r\n\r\n\t/**\r\n\t*<p>指定是否对使用了 scrollRect 的显示对象进行优化处理。默认为false(不优化)。</p>\r\n\t*<p>当值为ture时：将对此对象使用了scrollRect 设定的显示区域以外的显示内容不进行渲染，以提高性能(如果子对象有旋转缩放或者中心点偏移，则显示筛选会不精确)。</p>\r\n\t*/\r\n\t__getset(0,__proto,'optimizeScrollRect',function(){\r\n\t\treturn this._optimizeScrollRect;\r\n\t\t},function(b){\r\n\t\tif (this._optimizeScrollRect !=b){\r\n\t\t\tthis._optimizeScrollRect=b;\r\n\t\t\tthis.conchModel && this.conchModel.optimizeScrollRect(b);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置是否开启自定义渲染，只有开启自定义渲染，才能使用customRender函数渲染。\r\n\t*/\r\n\t__getset(0,__proto,'customRenderEnable',null,function(b){\r\n\t\tif (b){\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.CUSTOM*/0x400;\r\n\t\t\tif (Render.isConchNode){\r\n\t\t\t\tSprite.CustomList.push(this);\r\n\t\t\t\tvar canvas=new HTMLCanvas(\"2d\");\r\n\t\t\t\tcanvas._setContext(/*__JS__ */new CanvasRenderingContext2D());\r\n\t\t\t\t/*__JS__ */this.customContext=new RenderContext(0,0,canvas);\r\n\t\t\t\tcanvas.context.setCanvasType && canvas.context.setCanvasType(2);\r\n\t\t\t\tthis.conchModel.custom(canvas.context);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*指定显示对象是否缓存为静态图像。功能同cacheAs的normal模式。建议优先使用cacheAs代替。\r\n\t*/\r\n\t__getset(0,__proto,'cacheAsBitmap',function(){\r\n\t\treturn this.cacheAs!==\"none\";\r\n\t\t},function(value){\r\n\t\tthis.cacheAs=value ? (this._$P[\"hasFilter\"] ? \"none\" :\"normal\"):\"none\";\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指定显示对象是否缓存为静态图像，cacheAs时，子对象发生变化，会自动重新缓存，同时也可以手动调用reCache方法更新缓存。</p>\r\n\t*<p>建议把不经常变化的“复杂内容”缓存为静态图像，能极大提高渲染性能。cacheAs有\"none\"，\"normal\"和\"bitmap\"三个值可选。\r\n\t*<li>默认为\"none\"，不做任何缓存。</li>\r\n\t*<li>当值为\"normal\"时，canvas模式下进行画布缓存，webgl模式下进行命令缓存。</li>\r\n\t*<li>当值为\"bitmap\"时，canvas模式下进行依然是画布缓存，webgl模式下使用renderTarget缓存。</li></p>\r\n\t*<p>webgl下renderTarget缓存模式缺点：会额外创建renderTarget对象，增加内存开销，缓存面积有最大2048限制，不断重绘时会增加CPU开销。优点：大幅减少drawcall，渲染性能最高。\r\n\t*webgl下命令缓存模式缺点：只会减少节点遍历及命令组织，不会减少drawcall数，性能中等。优点：没有额外内存开销，无需renderTarget支持。</p>\r\n\t*/\r\n\t__getset(0,__proto,'cacheAs',function(){\r\n\t\treturn this._$P.cacheCanvas==null ? \"none\" :this._$P.cacheCanvas.type;\r\n\t\t},function(value){\r\n\t\tvar cacheCanvas=this._$P.cacheCanvas;\r\n\t\tif (value===(cacheCanvas ? cacheCanvas.type :\"none\"))return;\r\n\t\tif (value!==\"none\"){\r\n\t\t\tif (!this._getBit(/*laya.display.Node.NOTICE_DISPLAY*/0x1))this._setUpNoticeType(/*laya.display.Node.NOTICE_DISPLAY*/0x1);\r\n\t\t\tcacheCanvas || (cacheCanvas=this._set$P(\"cacheCanvas\",Pool.getItemByClass(\"cacheCanvas\",Object)));\r\n\t\t\tcacheCanvas.type=value;\r\n\t\t\tcacheCanvas.reCache=true;\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.CANVAS*/0x10;\r\n\t\t\tif (value==\"bitmap\")this.conchModel && this.conchModel.cacheAs(1);\r\n\t\t\tthis._set$P(\"cacheForFilters\",false);\r\n\t\t\t}else {\r\n\t\t\tif (this._$P[\"hasFilter\"]){\r\n\t\t\t\tthis._set$P(\"cacheForFilters\",true);\r\n\t\t\t\t}else {\r\n\t\t\t\tif (cacheCanvas){\r\n\t\t\t\t\tvar cc=cacheCanvas;\r\n\t\t\t\t\tif (cc && cc.ctx){\r\n\t\t\t\t\t\tPool.recover(\"RenderContext\",cc.ctx);\r\n\t\t\t\t\t\tcc.ctx.canvas.size(0,0);\r\n\t\t\t\t\t\tcc.ctx=null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tPool.recover(\"cacheCanvas\",cacheCanvas);\r\n\t\t\t\t}\r\n\t\t\t\tthis._$P.cacheCanvas=null;\r\n\t\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.CANVAS*/0x10;\r\n\t\t\t\tthis.conchModel && this.conchModel.cacheAs(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t/**z排序，更改此值，则会按照值的大小对同一容器的所有对象重新排序。值越大，越靠上。默认为0，则根据添加顺序排序。*/\r\n\t__getset(0,__proto,'zOrder',function(){\r\n\t\treturn this._zOrder;\r\n\t\t},function(value){\r\n\t\tif (this._zOrder !=value){\r\n\t\t\tthis._zOrder=value;\r\n\t\t\tthis.conchModel && this.conchModel.setZOrder && this.conchModel.setZOrder(value);\r\n\t\t\tif (this._parent){\r\n\t\t\t\tvalue && this._parent._set$P(\"hasZorder\",true);\r\n\t\t\t\tLaya.timer.callLater(this._parent,this.updateZOrder);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**旋转角度，默认值为0。以角度为单位。*/\r\n\t__getset(0,__proto,'rotation',function(){\r\n\t\treturn this._style._tf.rotate;\r\n\t\t},function(value){\r\n\t\tvar style=this.getStyle();\r\n\t\tif (style._tf.rotate!==value){\r\n\t\t\tstyle.setRotate(value);\r\n\t\t\tthis._tfChanged=true;\r\n\t\t\tthis.conchModel && this.conchModel.rotate(value);\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>显示对象的宽度，单位为像素，默认为0。</p>\r\n\t*<p>此宽度用于鼠标碰撞检测，并不影响显示对象图像大小。需要对显示对象的图像进行缩放，请使用scale、scaleX、scaleY。</p>\r\n\t*<p>可以通过getbounds获取显示对象图像的实际宽度。</p>\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (!this.autoSize)return this._width;\r\n\t\treturn this.getSelfBounds().width;\r\n\t\t},function(value){\r\n\t\tif (this._width!==value){\r\n\t\t\tthis._width=value;\r\n\t\t\tthis.conchModel && this.conchModel.size(value,this._height)\r\n\t\t\tthis.repaint();\r\n\t\t}\r\n\t});\r\n\r\n\t/**表示显示对象相对于父容器的水平方向坐标值。*/\r\n\t__getset(0,__proto,'x',function(){\r\n\t\treturn this._x;\r\n\t\t},function(value){\r\n\t\tif (this._x!==value){\r\n\t\t\tif (this.destroyed)return;\r\n\t\t\tthis._x=value;\r\n\t\t\tthis.conchModel && this.conchModel.pos(value,this._y);\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t\tif (this._$P.maskParent && this._$P.maskParent._repaint===0){\r\n\t\t\t\tthis._$P.maskParent._repaint=1;\r\n\t\t\t\tthis._$P.maskParent.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获得相对于stage的全局Y轴缩放值（会叠加父亲节点的缩放值）。\r\n\t*/\r\n\t__getset(0,__proto,'globalScaleY',function(){\r\n\t\tvar scale=1;\r\n\t\tvar ele=this;\r\n\t\twhile (ele){\r\n\t\t\tif (ele===Laya.stage)break ;\r\n\t\t\tscale *=ele.scaleY;\r\n\t\t\tele=ele.parent;\r\n\t\t}\r\n\t\treturn scale;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>可以设置一个Rectangle区域作为点击区域，或者设置一个<code>HitArea</code>实例作为点击区域，HitArea内可以设置可点击和不可点击区域。</p>\r\n\t*<p>如果不设置hitArea，则根据宽高形成的区域进行碰撞。</p>\r\n\t*/\r\n\t__getset(0,__proto,'hitArea',function(){\r\n\t\treturn this._$P.hitArea;\r\n\t\t},function(value){\r\n\t\tthis._set$P(\"hitArea\",value);\r\n\t});\r\n\r\n\t/**\r\n\t*是否静态缓存此对象的当前帧的最终属性。为 true 时，子对象变化时不会自动更新缓存，但是可以通过调用 reCache 方法手动刷新。\r\n\t*<b>注意：</b> 1. 设置 cacheAs 为非空和非\"none\"时才有效。 2. 由于渲染的时机在脚本执行之后，也就是说当前帧渲染的是对象的最终属性，所以如果在当前帧渲染之前、设置静态缓存之后改变对象属性，则最终渲染结果表现的是对象的最终属性。\r\n\t*/\r\n\t__getset(0,__proto,'staticCache',function(){\r\n\t\treturn this._$P.staticCache;\r\n\t\t},function(value){\r\n\t\tthis._set$P(\"staticCache\",value);\r\n\t\tif (!value)this.reCache();\r\n\t});\r\n\r\n\t/**设置一个Texture实例，并显示此图片（如果之前有其他绘制，则会被清除掉）。等同于graphics.clear();graphics.drawTexture()*/\r\n\t__getset(0,__proto,'texture',function(){\r\n\t\treturn this._texture;\r\n\t\t},function(value){\r\n\t\tif (this._texture !=value){\r\n\t\t\tthis._texture=value;\r\n\t\t\tthis.graphics.cleanByTexture(value,0,0);\r\n\t\t}\r\n\t});\r\n\r\n\t/**表示显示对象相对于父容器的垂直方向坐标值。*/\r\n\t__getset(0,__proto,'y',function(){\r\n\t\treturn this._y;\r\n\t\t},function(value){\r\n\t\tif (this._y!==value){\r\n\t\t\tif (this.destroyed)return;\r\n\t\t\tthis._y=value;\r\n\t\t\tthis.conchModel && this.conchModel.pos(this._x,value);\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t\tif (this._$P.maskParent && this._$P.maskParent._repaint===0){\r\n\t\t\t\tthis._$P.maskParent._repaint=1;\r\n\t\t\t\tthis._$P.maskParent.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>显示对象的高度，单位为像素，默认为0。</p>\r\n\t*<p>此高度用于鼠标碰撞检测，并不影响显示对象图像大小。需要对显示对象的图像进行缩放，请使用scale、scaleX、scaleY。</p>\r\n\t*<p>可以通过getbounds获取显示对象图像的实际高度。</p>\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (!this.autoSize)return this._height;\r\n\t\treturn this.getSelfBounds().height;\r\n\t\t},function(value){\r\n\t\tif (this._height!==value){\r\n\t\t\tthis._height=value;\r\n\t\t\tthis.conchModel && this.conchModel.size(this._width,value);\r\n\t\t\tthis.repaint();\r\n\t\t}\r\n\t});\r\n\r\n\t/**指定要使用的混合模式。目前只支持\"lighter\"。*/\r\n\t__getset(0,__proto,'blendMode',function(){\r\n\t\treturn this._style.blendMode;\r\n\t\t},function(value){\r\n\t\tthis.getStyle().blendMode=value;\r\n\t\tthis.conchModel && this.conchModel.blendMode(value);\r\n\t\tif (value && value !=\"source-over\")this._renderType |=/*laya.renders.RenderSprite.BLEND*/0x08;\r\n\t\telse this._renderType &=~ /*laya.renders.RenderSprite.BLEND*/0x08;\r\n\t\tthis.parentRepaint();\r\n\t});\r\n\r\n\t/**X轴缩放值，默认值为1。设置为负数，可以实现水平反转效果，比如scaleX=-1。*/\r\n\t__getset(0,__proto,'scaleX',function(){\r\n\t\treturn this._style._tf.scaleX;\r\n\t\t},function(value){\r\n\t\tvar style=this.getStyle();\r\n\t\tif (style._tf.scaleX!==value){\r\n\t\t\tstyle.setScaleX(value);\r\n\t\t\tthis._tfChanged=true;\r\n\t\t\tthis.conchModel && this.conchModel.scale(value,style._tf.scaleY);\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**Y轴缩放值，默认值为1。设置为负数，可以实现垂直反转效果，比如scaleX=-1。*/\r\n\t__getset(0,__proto,'scaleY',function(){\r\n\t\treturn this._style._tf.scaleY;\r\n\t\t},function(value){\r\n\t\tvar style=this.getStyle();\r\n\t\tif (style._tf.scaleY!==value){\r\n\t\t\tstyle.setScaleY(value);\r\n\t\t\tthis._tfChanged=true;\r\n\t\t\tthis.conchModel && this.conchModel.scale(style._tf.scaleX,value);\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**对舞台 <code>stage</code> 的引用。*/\r\n\t__getset(0,__proto,'stage',function(){\r\n\t\treturn Laya.stage;\r\n\t});\r\n\r\n\t/**水平倾斜角度，默认值为0。以角度为单位。*/\r\n\t__getset(0,__proto,'skewX',function(){\r\n\t\treturn this._style._tf.skewX;\r\n\t\t},function(value){\r\n\t\tvar style=this.getStyle();\r\n\t\tif (style._tf.skewX!==value){\r\n\t\t\tstyle.setSkewX(value);\r\n\t\t\tthis._tfChanged=true;\r\n\t\t\tthis.conchModel && this.conchModel.skew(value,style._tf.skewY);\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>显示对象的滚动矩形范围，具有裁剪效果(如果只想限制子对象渲染区域，请使用viewport)，设置optimizeScrollRect=true，可以优化裁剪区域外的内容不进行渲染。</p>\r\n\t*<p> srollRect和viewport的区别：<br/>\r\n\t*1.srollRect自带裁剪效果，viewport只影响子对象渲染是否渲染，不具有裁剪效果（性能更高）。<br/>\r\n\t*2.设置rect的x,y属性均能实现区域滚动效果，但scrollRect会保持0,0点位置不变。</p>\r\n\t*/\r\n\t__getset(0,__proto,'scrollRect',function(){\r\n\t\treturn this._style.scrollRect;\r\n\t\t},function(value){\r\n\t\tthis.getStyle().scrollRect=value;\r\n\t\tthis.repaint();\r\n\t\tif (value){\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.CLIP*/0x80;\r\n\t\t\tthis.conchModel && this.conchModel.scrollRect(value.x,value.y,value.width,value.height);\r\n\t\t\t}else {\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.CLIP*/0x80;\r\n\t\t\tif (this.conchModel){\r\n\t\t\t\tif (Sprite.RUNTIMEVERION < \"0.9.1\")\r\n\t\t\t\t\tthis.conchModel.removeType(0x40);\r\n\t\t\t\telse\r\n\t\t\t\tthis.conchModel.removeType(/*laya.renders.RenderSprite.CLIP*/0x80);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**垂直倾斜角度，默认值为0。以角度为单位。*/\r\n\t__getset(0,__proto,'skewY',function(){\r\n\t\treturn this._style._tf.skewY;\r\n\t\t},function(value){\r\n\t\tvar style=this.getStyle();\r\n\t\tif (style._tf.skewY!==value){\r\n\t\t\tstyle.setSkewY(value);\r\n\t\t\tthis._tfChanged=true;\r\n\t\t\tthis.conchModel && this.conchModel.skew(style._tf.skewX,value);\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tvar p=this._parent;\r\n\t\t\tif (p && p._repaint===0){\r\n\t\t\t\tp._repaint=1;\r\n\t\t\t\tp.parentRepaint();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>对象的矩阵信息。通过设置矩阵可以实现节点旋转，缩放，位移效果。</p>\r\n\t*<p>矩阵更多信息请参考 <code>Matrix</code></p>\r\n\t*/\r\n\t__getset(0,__proto,'transform',function(){\r\n\t\treturn this._tfChanged ? this._adjustTransform():this._transform;\r\n\t\t},function(value){\r\n\t\tthis._tfChanged=false;\r\n\t\tthis._transform=value;\r\n\t\tif (value){\r\n\t\t\tthis._x=value.tx;\r\n\t\t\tthis._y=value.ty;\r\n\t\t\tvalue.tx=value.ty=0;\r\n\t\t\tthis.conchModel && this.conchModel.transform(value.a,value.b,value.c,value.d,this._x,this._y);\r\n\t\t}\r\n\t\tif (value)this._renderType |=/*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\telse {\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.TRANSFORM*/0x04;\r\n\t\t\tthis.conchModel && this.conchModel.removeType(/*laya.renders.RenderSprite.TRANSFORM*/0x04);\r\n\t\t}\r\n\t\tthis.parentRepaint();\r\n\t});\r\n\r\n\t/**X轴 轴心点的位置，单位为像素，默认为0。轴心点会影响对象位置，缩放中心，旋转中心。*/\r\n\t__getset(0,__proto,'pivotX',function(){\r\n\t\treturn this._style._tf.translateX;\r\n\t\t},function(value){\r\n\t\tthis.getStyle().setTranslateX(value);\r\n\t\tthis.conchModel && this.conchModel.pivot(value,this._style._tf.translateY);\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t/**Y轴 轴心点的位置，单位为像素，默认为0。轴心点会影响对象位置，缩放中心，旋转中心。*/\r\n\t__getset(0,__proto,'pivotY',function(){\r\n\t\treturn this._style._tf.translateY;\r\n\t\t},function(value){\r\n\t\tthis.getStyle().setTranslateY(value);\r\n\t\tthis.conchModel && this.conchModel.pivot(this._style._tf.translateX,value);\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t/**透明度，值为0-1，默认值为1，表示不透明。更改alpha值会影响drawcall。*/\r\n\t__getset(0,__proto,'alpha',function(){\r\n\t\treturn this._style.alpha;\r\n\t\t},function(value){\r\n\t\tif (this._style && this._style.alpha!==value){\r\n\t\t\tvalue=value < 0 ? 0 :(value > 1 ? 1 :value);\r\n\t\t\tthis.getStyle().alpha=value;\r\n\t\t\tthis.conchModel && this.conchModel.alpha(value);\r\n\t\t\tif (value!==1)this._renderType |=/*laya.renders.RenderSprite.ALPHA*/0x02;\r\n\t\t\telse this._renderType &=~ /*laya.renders.RenderSprite.ALPHA*/0x02;\r\n\t\t\tthis.parentRepaint();\r\n\t\t}\r\n\t});\r\n\r\n\t/**表示是否可见，默认为true。如果设置不可见，节点将不被渲染。*/\r\n\t__getset(0,__proto,'visible',function(){\r\n\t\treturn this._style.visible;\r\n\t\t},function(value){\r\n\t\tif (this._style && this._style.visible!==value){\r\n\t\t\tthis.getStyle().visible=value;\r\n\t\t\tthis.conchModel && this.conchModel.visible(value);\r\n\t\t\tthis.parentRepaint();\r\n\t\t}\r\n\t});\r\n\r\n\t/**绘图对象。封装了绘制位图和矢量图的接口，Sprite所有的绘图操作都通过Graphics来实现的。*/\r\n\t__getset(0,__proto,'graphics',function(){\r\n\t\treturn this._graphics || (this.graphics=RunDriver.createGraphics());\r\n\t\t},function(value){\r\n\t\tif (this._graphics)this._graphics._sp=null;\r\n\t\tthis._graphics=value;\r\n\t\tif (value){\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.IMAGE*/0x01;\r\n\t\t\tthis._renderType |=/*laya.renders.RenderSprite.GRAPHICS*/0x200;\r\n\t\t\tvalue._sp=this;\r\n\t\t\tthis.conchModel && this.conchModel.graphics(this._graphics);\r\n\t\t\t}else {\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.GRAPHICS*/0x200;\r\n\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.IMAGE*/0x01;\r\n\t\t\tif (this.conchModel){\r\n\t\t\t\tif (Sprite.RUNTIMEVERION < \"0.9.1\")\r\n\t\t\t\t\tthis.conchModel.removeType(0x100);\r\n\t\t\t\telse\r\n\t\t\t\tthis.conchModel.removeType(/*laya.renders.RenderSprite.GRAPHICS*/0x200);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t/**滤镜集合。可以设置多个滤镜组合。*/\r\n\t__getset(0,__proto,'filters',function(){\r\n\t\treturn this._$P.filters;\r\n\t\t},function(value){\r\n\t\tvalue && value.length===0 && (value=null);\r\n\t\tif (this._$P.filters==value)return;\r\n\t\tthis._set$P(\"filters\",value ? value.slice():null);\r\n\t\tif (Render.isConchApp){\r\n\t\t\tif (this.conchModel){\r\n\t\t\t\tif (Sprite.RUNTIMEVERION < \"0.9.1\")\r\n\t\t\t\t\tthis.conchModel.removeType(0x10);\r\n\t\t\t\telse\r\n\t\t\t\tthis.conchModel.removeType(/*laya.renders.RenderSprite.FILTERS*/0x20);\r\n\t\t\t}\r\n\t\t\tif (this._$P.filters && this._$P.filters.length==1){\r\n\t\t\t\tthis._$P.filters[0].callNative(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Render.isWebGL){\r\n\t\t\tif (value && value.length){\r\n\t\t\t\tthis._renderType |=/*laya.renders.RenderSprite.FILTERS*/0x20;\r\n\t\t\t\t}else {\r\n\t\t\t\tthis._renderType &=~ /*laya.renders.RenderSprite.FILTERS*/0x20;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (value && value.length > 0){\r\n\t\t\tif (!this._getBit(/*laya.display.Node.NOTICE_DISPLAY*/0x1))this._setUpNoticeType(/*laya.display.Node.NOTICE_DISPLAY*/0x1);\r\n\t\t\tif (!(Render.isWebGL && value.length==1 && (((value[0])instanceof laya.filters.ColorFilter )))){\r\n\t\t\t\tif (this.cacheAs !=\"bitmap\"){\r\n\t\t\t\t\tif (!Render.isConchNode)this.cacheAs=\"bitmap\";\r\n\t\t\t\t\tthis._set$P(\"cacheForFilters\",true);\r\n\t\t\t\t}\r\n\t\t\t\tthis._set$P(\"hasFilter\",true);\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis._set$P(\"hasFilter\",false);\r\n\t\t\tif (this._$P[\"cacheForFilters\"] && this.cacheAs==\"bitmap\"){\r\n\t\t\t\tthis.cacheAs=\"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.repaint();\r\n\t});\r\n\r\n\t__getset(0,__proto,'parent',_super.prototype._$get_parent,function(value){\r\n\t\tLaya.superSet(Node,this,'parent',value);\r\n\t\tif (value && this._getBit(/*laya.display.Node.MOUSEENABLE*/0x2)){\r\n\t\t\tthis._$2__onDisplay();\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>遮罩，可以设置一个对象(支持位图和矢量图)，根据对象形状进行遮罩显示。</p>\r\n\t*<p>【注意】遮罩对象坐标系是相对遮罩对象本身的，和Flash机制不同</p>\r\n\t*/\r\n\t__getset(0,__proto,'mask',function(){\r\n\t\treturn this._$P._mask;\r\n\t\t},function(value){\r\n\t\tif (value && this.mask && this.mask._$P.maskParent)return;\r\n\t\tif (value){\r\n\t\t\tthis.cacheAs=\"bitmap\";\r\n\t\t\tthis._set$P(\"_mask\",value);\r\n\t\t\tvalue._set$P(\"maskParent\",this);\r\n\t\t\t}else {\r\n\t\t\tthis.cacheAs=\"none\";\r\n\t\t\tthis.mask && this.mask._set$P(\"maskParent\",null);\r\n\t\t\tthis._set$P(\"_mask\",value);\r\n\t\t}\r\n\t\tthis.conchModel && this.conchModel.mask(value ? value.conchModel :null);\r\n\t\tthis._renderType |=/*laya.renders.RenderSprite.MASK*/0x40;\r\n\t\tthis.parentRepaint();\r\n\t});\r\n\r\n\t/**\r\n\t*是否接受鼠标事件。\r\n\t*默认为false，如果监听鼠标事件，则会自动设置本对象及父节点的属性 mouseEnable 的值都为 true（如果父节点手动设置为false，则不会更改）。\r\n\t**/\r\n\t__getset(0,__proto,'mouseEnabled',function(){\r\n\t\treturn this._mouseEnableState > 1;\r\n\t\t},function(value){\r\n\t\tthis._mouseEnableState=value ? 2 :1;\r\n\t});\r\n\r\n\t/**\r\n\t*获得相对于stage的全局X轴缩放值（会叠加父亲节点的缩放值）。\r\n\t*/\r\n\t__getset(0,__proto,'globalScaleX',function(){\r\n\t\tvar scale=1;\r\n\t\tvar ele=this;\r\n\t\twhile (ele){\r\n\t\t\tif (ele===Laya.stage)break ;\r\n\t\t\tscale *=ele.scaleX;\r\n\t\t\tele=ele.parent;\r\n\t\t}\r\n\t\treturn scale;\r\n\t});\r\n\r\n\t/**\r\n\t*返回鼠标在此对象坐标系上的 X 轴坐标信息。\r\n\t*/\r\n\t__getset(0,__proto,'mouseX',function(){\r\n\t\treturn this.getMousePoint().x;\r\n\t});\r\n\r\n\t/**\r\n\t*返回鼠标在此对象坐标系上的 Y 轴坐标信息。\r\n\t*/\r\n\t__getset(0,__proto,'mouseY',function(){\r\n\t\treturn this.getMousePoint().y;\r\n\t});\r\n\r\n\tSprite.fromImage=function(url){\r\n\t\treturn new Sprite().loadImage(url);\r\n\t}\r\n\r\n\tSprite.CustomList=[];\r\n\t__static(Sprite,\r\n\t['RUNTIMEVERION',function(){return this.RUNTIMEVERION=/*__JS__ */window.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf('-')+1):'';}\r\n\t]);\r\n\treturn Sprite;\r\n})(Node)\r\n\r\n\r\n/**\r\n*@private\r\n*audio标签播放声音的音轨控制\r\n*/\r\n//class laya.media.h5audio.AudioSoundChannel extends laya.media.SoundChannel\r\nvar AudioSoundChannel=(function(_super){\r\n\tfunction AudioSoundChannel(audio){\r\n\t\t/**\r\n\t\t*播放用的audio标签\r\n\t\t*/\r\n\t\tthis._audio=null;\r\n\t\tthis._onEnd=null;\r\n\t\tthis._resumePlay=null;\r\n\t\tAudioSoundChannel.__super.call(this);\r\n\t\tthis._onEnd=Utils.bind(this.__onEnd,this);\r\n\t\tthis._resumePlay=Utils.bind(this.__resumePlay,this);\r\n\t\taudio.addEventListener(\"ended\",this._onEnd);\r\n\t\tthis._audio=audio;\r\n\t}\r\n\r\n\t__class(AudioSoundChannel,'laya.media.h5audio.AudioSoundChannel',_super);\r\n\tvar __proto=AudioSoundChannel.prototype;\r\n\t__proto.__onEnd=function(){\r\n\t\tif (this.loops==1){\r\n\t\t\tif (this.completeHandler){\r\n\t\t\t\tLaya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);\r\n\t\t\t\tthis.completeHandler=null;\r\n\t\t\t}\r\n\t\t\tthis.stop();\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.loops > 0){\r\n\t\t\tthis.loops--;\r\n\t\t}\r\n\t\tthis.startTime=0;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\t__proto.__resumePlay=function(){\r\n\t\tif(this._audio)this._audio.removeEventListener(\"canplay\",this._resumePlay);\r\n\t\ttry {\r\n\t\t\tthis._audio.currentTime=this.startTime;\r\n\t\t\tBrowser.container.appendChild(this._audio);\r\n\t\t\tthis._audio.play();\r\n\t\t\t}catch (e){\r\n\t\t\tthis.event(/*laya.events.Event.ERROR*/\"error\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*播放\r\n\t*/\r\n\t__proto.play=function(){\r\n\t\tthis.isStopped=false;\r\n\t\ttry {\r\n\t\t\tthis._audio.playbackRate=SoundManager.playbackRate;\r\n\t\t\tthis._audio.currentTime=this.startTime;\r\n\t\t\t}catch (e){\r\n\t\t\tthis._audio.addEventListener(\"canplay\",this._resumePlay);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tSoundManager.addChannel(this);\r\n\t\tBrowser.container.appendChild(this._audio);\r\n\t\tif(\"play\" in this._audio)\r\n\t\t\tthis._audio.play();\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放\r\n\t*\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis.isStopped=true;\r\n\t\tSoundManager.removeChannel(this);\r\n\t\tthis.completeHandler=null;\r\n\t\tif (!this._audio)\r\n\t\t\treturn;\r\n\t\tif (\"pause\" in this._audio)\r\n\t\t\tif (Render.isConchApp){\r\n\t\t\tthis._audio.stop();\r\n\t\t}\r\n\t\tthis._audio.pause();\r\n\t\tthis._audio.removeEventListener(\"ended\",this._onEnd);\r\n\t\tthis._audio.removeEventListener(\"canplay\",this._resumePlay);\r\n\t\tif (!Browser.onIE){\r\n\t\t\tif (this._audio!=AudioSound._musicAudio){\r\n\t\t\t\tPool.recover(\"audio:\"+this.url,this._audio);\r\n\t\t\t}\r\n\t\t}\r\n\t\tBrowser.removeElement(this._audio);\r\n\t\tthis._audio=null;\r\n\t}\r\n\r\n\t__proto.pause=function(){\r\n\t\tthis.isStopped=true;\r\n\t\tSoundManager.removeChannel(this);\r\n\t\tif(\"pause\" in this._audio)\r\n\t\t\tthis._audio.pause();\r\n\t}\r\n\r\n\t__proto.resume=function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn;\r\n\t\tthis.isStopped=false;\r\n\t\tSoundManager.addChannel(this);\r\n\t\tif(\"play\" in this._audio)\r\n\t\t\tthis._audio.play();\r\n\t}\r\n\r\n\t/**\r\n\t*当前播放到的位置\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'position',function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn 0;\r\n\t\treturn this._audio.currentTime;\r\n\t});\r\n\r\n\t/**\r\n\t*获取总时间。\r\n\t*/\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\tif (!this._audio)\r\n\t\t\treturn 0;\r\n\t\treturn this._audio.duration;\r\n\t});\r\n\r\n\t/**\r\n\t*设置音量\r\n\t*@param v\r\n\t*\r\n\t*/\r\n\t/**\r\n\t*获取音量\r\n\t*@return\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'volume',function(){\r\n\t\tif (!this._audio)return 1;\r\n\t\treturn this._audio.volume;\r\n\t\t},function(v){\r\n\t\tif (!this._audio)return;\r\n\t\tthis._audio.volume=v;\r\n\t});\r\n\r\n\treturn AudioSoundChannel;\r\n})(SoundChannel)\r\n\r\n\r\n/**\r\n*@private\r\n*web audio api方式播放声音的音轨控制\r\n*/\r\n//class laya.media.webaudio.WebAudioSoundChannel extends laya.media.SoundChannel\r\nvar WebAudioSoundChannel=(function(_super){\r\n\tfunction WebAudioSoundChannel(){\r\n\t\t/**\r\n\t\t*声音原始文件数据\r\n\t\t*/\r\n\t\tthis.audioBuffer=null;\r\n\t\t/**\r\n\t\t*gain节点\r\n\t\t*/\r\n\t\tthis.gain=null;\r\n\t\t/**\r\n\t\t*播放用的数据\r\n\t\t*/\r\n\t\tthis.bufferSource=null;\r\n\t\t/**\r\n\t\t*当前时间\r\n\t\t*/\r\n\t\tthis._currentTime=0;\r\n\t\t/**\r\n\t\t*当前音量\r\n\t\t*/\r\n\t\tthis._volume=1;\r\n\t\t/**\r\n\t\t*播放开始时的时间戳\r\n\t\t*/\r\n\t\tthis._startTime=0;\r\n\t\tthis._pauseTime=0;\r\n\t\tthis._onPlayEnd=null;\r\n\t\tthis.context=WebAudioSound.ctx;\r\n\t\tWebAudioSoundChannel.__super.call(this);\r\n\t\tthis._onPlayEnd=Utils.bind(this.__onPlayEnd,this);\r\n\t\tif (this.context[\"createGain\"]){\r\n\t\t\tthis.gain=this.context[\"createGain\"]();\r\n\t\t\t}else {\r\n\t\t\tthis.gain=this.context[\"createGainNode\"]();\r\n\t\t}\r\n\t}\r\n\r\n\t__class(WebAudioSoundChannel,'laya.media.webaudio.WebAudioSoundChannel',_super);\r\n\tvar __proto=WebAudioSoundChannel.prototype;\r\n\t/**\r\n\t*播放声音\r\n\t*/\r\n\t__proto.play=function(){\r\n\t\tSoundManager.addChannel(this);\r\n\t\tthis.isStopped=false;\r\n\t\tthis._clearBufferSource();\r\n\t\tif (!this.audioBuffer)return;\r\n\t\tvar context=this.context;\r\n\t\tvar gain=this.gain;\r\n\t\tvar bufferSource=context.createBufferSource();\r\n\t\tthis.bufferSource=bufferSource;\r\n\t\tbufferSource.buffer=this.audioBuffer;\r\n\t\tbufferSource.connect(gain);\r\n\t\tif (gain)\r\n\t\t\tgain.disconnect();\r\n\t\tgain.connect(context.destination);\r\n\t\tbufferSource.onended=this._onPlayEnd;\r\n\t\tif (this.startTime >=this.duration)this.startTime=0;\r\n\t\tthis._startTime=Browser.now();\r\n\t\tthis.gain.gain.value=this._volume;\r\n\t\tif (this.loops==0){\r\n\t\t\tbufferSource.loop=true;\r\n\t\t}\r\n\t\tbufferSource.playbackRate.value=SoundManager.playbackRate;\r\n\t\tbufferSource.start(0,this.startTime);\r\n\t\tthis._currentTime=0;\r\n\t}\r\n\r\n\t__proto.__onPlayEnd=function(){\r\n\t\tif (this.loops==1){\r\n\t\t\tif (this.completeHandler){\r\n\t\t\t\tLaya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);\r\n\t\t\t\tthis.completeHandler=null;\r\n\t\t\t}\r\n\t\t\tthis.stop();\r\n\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.loops > 0){\r\n\t\t\tthis.loops--;\r\n\t\t}\r\n\t\tthis.startTime=0;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\t__proto._clearBufferSource=function(){\r\n\t\tif (this.bufferSource){\r\n\t\t\tvar sourceNode=this.bufferSource;\r\n\t\t\tif (sourceNode.stop){\r\n\t\t\t\tsourceNode.stop(0);\r\n\t\t\t\t}else {\r\n\t\t\t\tsourceNode.noteOff(0);\r\n\t\t\t}\r\n\t\t\tsourceNode.disconnect(0);\r\n\t\t\tsourceNode.onended=null;\r\n\t\t\tif (!WebAudioSoundChannel._tryCleanFailed)this._tryClearBuffer(sourceNode);\r\n\t\t\tthis.bufferSource=null;\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._tryClearBuffer=function(sourceNode){\r\n\t\tif (!Browser.onMac){\r\n\t\t\tWebAudioSoundChannel._tryCleanFailed=true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {sourceNode.buffer=WebAudioSound._miniBuffer;}catch (e){WebAudioSoundChannel._tryCleanFailed=true;}\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis._clearBufferSource();\r\n\t\tthis.audioBuffer=null;\r\n\t\tif (this.gain)\r\n\t\t\tthis.gain.disconnect();\r\n\t\tthis.isStopped=true;\r\n\t\tSoundManager.removeChannel(this);\r\n\t\tthis.completeHandler=null;\r\n\t\tif(SoundManager.autoReleaseSound)\r\n\t\t\tLaya.timer.once(5000,null,SoundManager.disposeSoundIfNotUsed,[this.url],false);\r\n\t}\r\n\r\n\t__proto.pause=function(){\r\n\t\tif (!this.isStopped){\r\n\t\t\tthis._pauseTime=this.position;\r\n\t\t}\r\n\t\tthis._clearBufferSource();\r\n\t\tif (this.gain)\r\n\t\t\tthis.gain.disconnect();\r\n\t\tthis.isStopped=true;\r\n\t\tSoundManager.removeChannel(this);\r\n\t\tif(SoundManager.autoReleaseSound)\r\n\t\t\tLaya.timer.once(5000,null,SoundManager.disposeSoundIfNotUsed,[this.url],false);\r\n\t}\r\n\r\n\t__proto.resume=function(){\r\n\t\tthis.startTime=this._pauseTime;\r\n\t\tthis.play();\r\n\t}\r\n\r\n\t/**\r\n\t*获取当前播放位置\r\n\t*/\r\n\t__getset(0,__proto,'position',function(){\r\n\t\tif (this.bufferSource){\r\n\t\t\treturn (Browser.now()-this._startTime)/ 1000+this.startTime;\r\n\t\t}\r\n\t\treturn 0;\r\n\t});\r\n\r\n\t__getset(0,__proto,'duration',function(){\r\n\t\tif (this.audioBuffer){\r\n\t\t\treturn this.audioBuffer.duration;\r\n\t\t}\r\n\t\treturn 0;\r\n\t});\r\n\r\n\t/**\r\n\t*设置音量\r\n\t*/\r\n\t/**\r\n\t*获取音量\r\n\t*/\r\n\t__getset(0,__proto,'volume',function(){\r\n\t\treturn this._volume;\r\n\t\t},function(v){\r\n\t\tif (this.isStopped){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._volume=v;\r\n\t\tthis.gain.gain.value=v;\r\n\t});\r\n\r\n\tWebAudioSoundChannel._tryCleanFailed=false;\r\n\treturn WebAudioSoundChannel;\r\n})(SoundChannel)\r\n\r\n\r\n/**\r\n*@private\r\n*<code>Bitmap</code> 是图片资源类。\r\n*/\r\n//class laya.resource.Bitmap extends laya.resource.Resource\r\nvar Bitmap=(function(_super){\r\n\tfunction Bitmap(){\r\n\t\t/**@private\r\n\t\t*HTML Image或HTML Canvas或WebGL Texture。\r\n\t\t**/\r\n\t\t//this._source=null;\r\n\t\t/**@private 宽度*/\r\n\t\t//this._w=NaN;\r\n\t\t/**@private 高度*/\r\n\t\t//this._h=NaN;\r\n\t\tBitmap.__super.call(this);\r\n\t\tthis._w=0;\r\n\t\tthis._h=0;\r\n\t}\r\n\r\n\t__class(Bitmap,'laya.resource.Bitmap',_super);\r\n\tvar __proto=Bitmap.prototype;\r\n\t/***\r\n\t*宽度。\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\treturn this._w;\r\n\t});\r\n\r\n\t/***\r\n\t*高度。\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\treturn this._h;\r\n\t});\r\n\r\n\t/***\r\n\t*HTML Image 或 HTML Canvas 或 WebGL Texture 。\r\n\t*/\r\n\t__getset(0,__proto,'source',function(){\r\n\t\treturn this._source;\r\n\t});\r\n\r\n\treturn Bitmap;\r\n})(Resource)\r\n\r\n\r\n/**\r\n*<p>动画播放基类，提供了基础的动画播放控制方法和帧标签事件相关功能。</p>\r\n*<p>可以继承此类，但不要直接实例化此类，因为有些方法需要由子类实现。</p>\r\n*/\r\n//class laya.display.AnimationPlayerBase extends laya.display.Sprite\r\nvar AnimationPlayerBase=(function(_super){\r\n\tfunction AnimationPlayerBase(){\r\n\t\t/**\r\n\t\t*是否循环播放，调用play(...)方法时，会将此值设置为指定的参数值。\r\n\t\t*/\r\n\t\tthis.loop=false;\r\n\t\t/**\r\n\t\t*<p>播放顺序类型：AnimationPlayerBase.WRAP_POSITIVE为正序播放，AnimationPlayerBase.WRAP_REVERSE为倒序播放，AnimationPlayerBase.WRAP_PINGPONG为pingpong播放(当按指定顺序播放完结尾后，如果继续播发，则会改变播放顺序)。</p>\r\n\t\t*<p>默认为正序播放。</p>\r\n\t\t*/\r\n\t\tthis.wrapMode=0;\r\n\t\t/**@private */\r\n\t\tthis._index=0;\r\n\t\t/**@private */\r\n\t\tthis._count=0;\r\n\t\t/**@private */\r\n\t\tthis._isPlaying=false;\r\n\t\t/**@private */\r\n\t\tthis._labels=null;\r\n\t\t/**是否是逆序播放*/\r\n\t\tthis._isReverse=false;\r\n\t\t/**@private */\r\n\t\tthis._frameRateChanged=false;\r\n\t\t/**@private */\r\n\t\tthis._controlNode=null;\r\n\t\t/**@private */\r\n\t\tthis._actionName=null;\r\n\t\tAnimationPlayerBase.__super.call(this);\r\n\t\tthis._interval=Config.animationInterval;\r\n\t\tthis._setUpNoticeType(/*laya.display.Node.NOTICE_DISPLAY*/0x1);\r\n\t}\r\n\r\n\t__class(AnimationPlayerBase,'laya.display.AnimationPlayerBase',_super);\r\n\tvar __proto=AnimationPlayerBase.prototype;\r\n\t/**\r\n\t*<p>开始播放动画。play(...)方法被设计为在创建实例后的任何时候都可以被调用，当相应的资源加载完毕、调用动画帧填充方法(set frames)或者将实例显示在舞台上时，会判断是否正在播放中，如果是，则进行播放。</p>\r\n\t*<p>配合wrapMode属性，可设置动画播放顺序类型。</p>\r\n\t*@param start （可选）指定动画播放开始的索引(int)或帧标签(String)。帧标签可以通过addLabel(...)和removeLabel(...)进行添加和删除。\r\n\t*@param loop （可选）是否循环播放。\r\n\t*@param name （可选）动画名称。\r\n\t*@param showWarn（可选）是否动画不存在时打印警告\r\n\t*/\r\n\t__proto.play=function(start,loop,name,showWarn){\r\n\t\t(start===void 0)&& (start=0);\r\n\t\t(loop===void 0)&& (loop=true);\r\n\t\t(name===void 0)&& (name=\"\");\r\n\t\t(showWarn===void 0)&& (showWarn=true);\r\n\t\tthis._isPlaying=true;\r\n\t\tthis.index=((typeof start=='string'))? this._getFrameByLabel(start):start;\r\n\t\tthis.loop=loop;\r\n\t\tthis._actionName=name;\r\n\t\tthis._isReverse=this.wrapMode==1;\r\n\t\tif (this.interval > 0){\r\n\t\t\tthis.timerLoop(this.interval,this,this._frameLoop,null,true,true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._getFrameByLabel=function(label){\r\n\t\tvar i=0;\r\n\t\tfor (i=0;i < this._count;i++){\r\n\t\t\tif (this._labels[i] && (this._labels [i]).indexOf(label)>=0)return i;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._frameLoop=function(){\r\n\t\tif (this._isReverse){\r\n\t\t\tthis._index--;\r\n\t\t\tif (this._index < 0){\r\n\t\t\t\tif (this.loop){\r\n\t\t\t\t\tif (this.wrapMode==2){\r\n\t\t\t\t\t\tthis._index=this._count > 0 ? 1 :0;\r\n\t\t\t\t\t\tthis._isReverse=false;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tthis._index=this._count-1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis._index=0;\r\n\t\t\t\t\tthis.stop();\r\n\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis._index++;\r\n\t\t\tif (this._index >=this._count){\r\n\t\t\t\tif (this.loop){\r\n\t\t\t\t\tif (this.wrapMode==2){\r\n\t\t\t\t\t\tthis._index=this._count-2 >=0 ? this._count-2 :0;\r\n\t\t\t\t\t\tthis._isReverse=true;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tthis._index=0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis._index--;\r\n\t\t\t\t\tthis.stop();\r\n\t\t\t\t\tthis.event(/*laya.events.Event.COMPLETE*/\"complete\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.index=this._index;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setControlNode=function(node){\r\n\t\tif (this._controlNode){\r\n\t\t\tthis._controlNode.off(/*laya.events.Event.DISPLAY*/\"display\",this,this._checkResumePlaying);\r\n\t\t\tthis._controlNode.off(/*laya.events.Event.UNDISPLAY*/\"undisplay\",this,this._checkResumePlaying);\r\n\t\t}\r\n\t\tthis._controlNode=node;\r\n\t\tif (node && node !=this){\r\n\t\t\tnode.on(/*laya.events.Event.DISPLAY*/\"display\",this,this._checkResumePlaying);\r\n\t\t\tnode.on(/*laya.events.Event.UNDISPLAY*/\"undisplay\",this,this._checkResumePlaying);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setDisplay=function(value){\r\n\t\t_super.prototype._setDisplay.call(this,value);\r\n\t\tthis._checkResumePlaying();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._checkResumePlaying=function(){\r\n\t\tif (this._isPlaying){\r\n\t\t\tif (this._controlNode.displayedInStage)this.play(this._index,this.loop,this._actionName);\r\n\t\t\telse this.clearTimer(this,this._frameLoop);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*停止动画播放。\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tthis._isPlaying=false;\r\n\t\tthis.clearTimer(this,this._frameLoop);\r\n\t}\r\n\r\n\t/**\r\n\t*增加一个帧标签到指定索引的帧上。当动画播放到此索引的帧时会派发Event.LABEL事件，派发事件是在完成当前帧画面更新之后。\r\n\t*@param label 帧标签名称\r\n\t*@param index 帧索引\r\n\t*/\r\n\t__proto.addLabel=function(label,index){\r\n\t\tif (!this._labels)this._labels={};\r\n\t\tif (!this._labels[index])this._labels[index]=[];\r\n\t\tthis._labels[index].push(label);\r\n\t}\r\n\r\n\t/**\r\n\t*删除指定的帧标签。\r\n\t*@param label 帧标签名称。注意：如果为空，则删除所有帧标签！\r\n\t*/\r\n\t__proto.removeLabel=function(label){\r\n\t\tif (!label)this._labels=null;\r\n\t\telse if (this._labels){\r\n\t\t\tfor (var name in this._labels){\r\n\t\t\t\tthis._removeLabelFromLabelList(this._labels[name],label);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._removeLabelFromLabelList=function(list,label){\r\n\t\tif (!list)return;\r\n\t\tfor (var i=list.length-1;i >=0;i--){\r\n\t\t\tif (list[i]==label){\r\n\t\t\t\tlist.splice(i,1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*将动画切换到指定帧并停在那里。\r\n\t*@param position 帧索引或帧标签\r\n\t*/\r\n\t__proto.gotoAndStop=function(position){\r\n\t\tthis.index=((typeof position=='string'))? this._getFrameByLabel(position):position;\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*显示到某帧\r\n\t*@param value 帧索引\r\n\t*/\r\n\t__proto._displayToIndex=function(value){}\r\n\t/**\r\n\t*停止动画播放，并清理对象属性。之后可存入对象池，方便对象复用。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis.stop();\r\n\t\tthis._labels=null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>动画播放的帧间隔时间(单位：毫秒)。默认值依赖于Config.animationInterval=50，通过Config.animationInterval可以修改默认帧间隔时间。</p>\r\n\t*<p>要想为某动画设置独立的帧间隔时间，可以使用set interval，注意：如果动画正在播放，设置后会重置帧循环定时器的起始时间为当前时间，也就是说，如果频繁设置interval，会导致动画帧更新的时间间隔会比预想的要慢，甚至不更新。</p>\r\n\t*/\r\n\t__getset(0,__proto,'interval',function(){\r\n\t\treturn this._interval;\r\n\t\t},function(value){\r\n\t\tif (this._interval !=value){\r\n\t\t\tthis._frameRateChanged=true;\r\n\t\t\tthis._interval=value;\r\n\t\t\tif (this._isPlaying && value > 0){\r\n\t\t\t\tthis.timerLoop(value,this,this._frameLoop,null,true,true);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*是否正在播放中。\r\n\t*/\r\n\t__getset(0,__proto,'isPlaying',function(){\r\n\t\treturn this._isPlaying;\r\n\t});\r\n\r\n\t/**\r\n\t*动画当前帧的索引。\r\n\t*/\r\n\t__getset(0,__proto,'index',function(){\r\n\t\treturn this._index;\r\n\t\t},function(value){\r\n\t\tthis._index=value;\r\n\t\tthis._displayToIndex(value);\r\n\t\tif (this._labels && this._labels[value]){\r\n\t\t\tvar tArr=this._labels[value];\r\n\t\t\tfor (var i=0,len=tArr.length;i < len;i++){\r\n\t\t\t\tthis.event(/*laya.events.Event.LABEL*/\"label\",tArr[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*当前动画中帧的总数。\r\n\t*/\r\n\t__getset(0,__proto,'count',function(){\r\n\t\treturn this._count;\r\n\t});\r\n\r\n\tAnimationPlayerBase.WRAP_POSITIVE=0;\r\n\tAnimationPlayerBase.WRAP_REVERSE=1;\r\n\tAnimationPlayerBase.WRAP_PINGPONG=2;\r\n\treturn AnimationPlayerBase;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*<p> <code>Text</code> 类用于创建显示对象以显示文本。</p>\r\n*<p>\r\n*注意：如果运行时系统找不到设定的字体，则用系统默认的字体渲染文字，从而导致显示异常。(通常电脑上显示正常，在一些移动端因缺少设置的字体而显示异常)。\r\n*</p>\r\n*@example\r\n*package\r\n*{\r\n\t*import laya.display.Text;\r\n\t*public class Text_Example\r\n\t*{\r\n\t\t*public function Text_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*onInit();\r\n\t\t\t*}\r\n\t\t*private function onInit():void\r\n\t\t*{\r\n\t\t\t*var text:Text=new Text();//创建一个 Text 类的实例对象 text 。\r\n\t\t\t*text.text=\"这个是一个 Text 文本示例。\";\r\n\t\t\t*text.color=\"#008fff\";//设置 text 的文本颜色。\r\n\t\t\t*text.font=\"Arial\";//设置 text 的文本字体。\r\n\t\t\t*text.bold=true;//设置 text 的文本显示为粗体。\r\n\t\t\t*text.fontSize=30;//设置 text 的字体大小。\r\n\t\t\t*text.wordWrap=true;//设置 text 的文本自动换行。\r\n\t\t\t*text.x=100;//设置 text 对象的属性 x 的值，用于控制 text 对象的显示位置。\r\n\t\t\t*text.y=100;//设置 text 对象的属性 y 的值，用于控制 text 对象的显示位置。\r\n\t\t\t*text.width=300;//设置 text 的宽度。\r\n\t\t\t*text.height=200;//设置 text 的高度。\r\n\t\t\t*text.italic=true;//设置 text 的文本显示为斜体。\r\n\t\t\t*text.borderColor=\"#fff000\";//设置 text 的文本边框颜色。\r\n\t\t\t*Laya.stage.addChild(text);//将 text 添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*@example\r\n*Text_Example();\r\n*function Text_Example()\r\n*{\r\n\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t*onInit();\r\n\t*}\r\n*function onInit()\r\n*{\r\n\t*var text=new laya.display.Text();//创建一个 Text 类的实例对象 text 。\r\n\t*text.text=\"这个是一个 Text 文本示例。\";\r\n\t*text.color=\"#008fff\";//设置 text 的文本颜色。\r\n\t*text.font=\"Arial\";//设置 text 的文本字体。\r\n\t*text.bold=true;//设置 text 的文本显示为粗体。\r\n\t*text.fontSize=30;//设置 text 的字体大小。\r\n\t*text.wordWrap=true;//设置 text 的文本自动换行。\r\n\t*text.x=100;//设置 text 对象的属性 x 的值，用于控制 text 对象的显示位置。\r\n\t*text.y=100;//设置 text 对象的属性 y 的值，用于控制 text 对象的显示位置。\r\n\t*text.width=300;//设置 text 的宽度。\r\n\t*text.height=200;//设置 text 的高度。\r\n\t*text.italic=true;//设置 text 的文本显示为斜体。\r\n\t*text.borderColor=\"#fff000\";//设置 text 的文本边框颜色。\r\n\t*Laya.stage.addChild(text);//将 text 添加到显示列表。\r\n\t*}\r\n*@example\r\n*class Text_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.onInit();\r\n\t\t*}\r\n\t*private onInit():void {\r\n\t\t*var text:laya.display.Text=new laya.display.Text();//创建一个 Text 类的实例对象 text 。\r\n\t\t*text.text=\"这个是一个 Text 文本示例。\";\r\n\t\t*text.color=\"#008fff\";//设置 text 的文本颜色。\r\n\t\t*text.font=\"Arial\";//设置 text 的文本字体。\r\n\t\t*text.bold=true;//设置 text 的文本显示为粗体。\r\n\t\t*text.fontSize=30;//设置 text 的字体大小。\r\n\t\t*text.wordWrap=true;//设置 text 的文本自动换行。\r\n\t\t*text.x=100;//设置 text 对象的属性 x 的值，用于控制 text 对象的显示位置。\r\n\t\t*text.y=100;//设置 text 对象的属性 y 的值，用于控制 text 对象的显示位置。\r\n\t\t*text.width=300;//设置 text 的宽度。\r\n\t\t*text.height=200;//设置 text 的高度。\r\n\t\t*text.italic=true;//设置 text 的文本显示为斜体。\r\n\t\t*text.borderColor=\"#fff000\";//设置 text 的文本边框颜色。\r\n\t\t*Laya.stage.addChild(text);//将 text 添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*/\r\n//class laya.display.Text extends laya.display.Sprite\r\nvar Text=(function(_super){\r\n\tfunction Text(){\r\n\t\t/**@private */\r\n\t\tthis._clipPoint=null;\r\n\t\t/**当前使用的位置字体。*/\r\n\t\tthis._currBitmapFont=null;\r\n\t\t/**@private 表示文本内容字符串。*/\r\n\t\tthis._text=null;\r\n\t\t/**@private 表示文本内容是否发生改变。*/\r\n\t\tthis._isChanged=false;\r\n\t\t/**@private 表示文本的宽度，以像素为单位。*/\r\n\t\tthis._textWidth=0;\r\n\t\t/**@private 表示文本的高度，以像素为单位。*/\r\n\t\tthis._textHeight=0;\r\n\t\t/**@private 存储文字行数信息。*/\r\n\t\tthis._lines=[];\r\n\t\t/**@private 保存每行宽度*/\r\n\t\tthis._lineWidths=[];\r\n\t\t/**@private 文本的内容位置 X 轴信息。*/\r\n\t\tthis._startX=NaN;\r\n\t\t/**@private 文本的内容位置X轴信息。 */\r\n\t\tthis._startY=NaN;\r\n\t\t/**@private 当前可视行索引。*/\r\n\t\tthis._lastVisibleLineIndex=-1;\r\n\t\t/**@private 当前可视行索引。*/\r\n\t\tthis._words=null;\r\n\t\t/**@private */\r\n\t\tthis._charSize={};\r\n\t\t/**\r\n\t\t*是否显示下划线。\r\n\t\t*/\r\n\t\tthis.underline=false;\r\n\t\t/**\r\n\t\t*下划线的颜色，为null则使用字体颜色。\r\n\t\t*/\r\n\t\tthis._underlineColor=null;\r\n\t\tText.__super.call(this);\r\n\t\tthis.overflow=Text.VISIBLE;\r\n\t\tthis._style=new CSSStyle(this);\r\n\t\t(this._style).wordWrap=false;\r\n\t}\r\n\r\n\t__class(Text,'laya.display.Text',_super);\r\n\tvar __proto=Text.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\t_super.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._lines=null;\r\n\t\tif (this._words){\r\n\t\t\tthis._words.length=0;\r\n\t\t\tthis._words=null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto._getBoundPointsM=function(ifRotate){\r\n\t\t(ifRotate===void 0)&& (ifRotate=false);\r\n\t\tvar rec=Rectangle.TEMP;\r\n\t\trec.setTo(0,0,this.width,this.height);\r\n\t\treturn rec._getBoundPoints();\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.getGraphicBounds=function(realSize){\r\n\t\t(realSize===void 0)&& (realSize=false);\r\n\t\tvar rec=Rectangle.TEMP;\r\n\t\trec.setTo(0,0,this.width,this.height);\r\n\t\treturn rec;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto._getCSSStyle=function(){\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>根据指定的文本，从语言包中取当前语言的文本内容。并对此文本中的{i}文本进行替换。</p>\r\n\t*<p>设置Text.langPacks语言包后，即可使用lang获取里面的语言</p>\r\n\t*<p>例如：\r\n\t*<li>（1）text 的值为“我的名字”，先取到这个文本对应的当前语言版本里的值“My name”，将“My name”设置为当前文本的内容。</li>\r\n\t*<li>（2）text 的值为“恭喜你赢得{0}个钻石，{1}经验。”，arg1 的值为100，arg2 的值为200。\r\n\t*则先取到这个文本对应的当前语言版本里的值“Congratulations on your winning {0}diamonds,{1}experience.”，\r\n\t*然后将文本里的{0}、{1}，依据括号里的数字从0开始替换为 arg1、arg2 的值。\r\n\t*将替换处理后的文本“Congratulations on your winning 100 diamonds,200 experience.”设置为当前文本的内容。\r\n\t*</li>\r\n\t*</p>\r\n\t*@param text 文本内容。\r\n\t*@param ...args 文本替换参数。\r\n\t*/\r\n\t__proto.lang=function(text,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10){\r\n\t\ttext=Text.langPacks && Text.langPacks[text] ? Text.langPacks[text] :text;\r\n\t\tif (arguments.length < 2){\r\n\t\t\tthis._text=text;\r\n\t\t\t}else {\r\n\t\t\tfor (var i=0,n=arguments.length;i < n;i++){\r\n\t\t\t\ttext=text.replace(\"{\"+i+\"}\",arguments[i+1]);\r\n\t\t\t}\r\n\t\t\tthis._text=text;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._isPassWordMode=function(){\r\n\t\tvar style=this._style;\r\n\t\tvar password=style.password;\r\n\t\tif ((\"prompt\" in this)&& this['prompt']==this._text)\r\n\t\t\tpassword=false;\r\n\t\treturn password;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._getPassWordTxt=function(txt){\r\n\t\tvar len=txt.length;\r\n\t\tvar word;\r\n\t\tword=\"\";\r\n\t\tfor (var j=len;j > 0;j--){\r\n\t\t\tword+=\"●\";\r\n\t\t}\r\n\t\treturn word;\r\n\t}\r\n\r\n\t/**\r\n\t*渲染文字。\r\n\t*@param begin 开始渲染的行索引。\r\n\t*@param visibleLineCount 渲染的行数。\r\n\t*/\r\n\t__proto.renderText=function(begin,visibleLineCount){\r\n\t\tvar graphics=this.graphics;\r\n\t\tgraphics.clear(true);\r\n\t\tvar ctxFont=(this.italic ? \"italic \" :\"\")+(this.bold ? \"bold \" :\"\")+this.fontSize+\"px \"+(Browser.onIPhone ? (laya.display.Text._fontFamilyMap[this.font] || this.font):this.font);\r\n\t\tBrowser.context.font=ctxFont;\r\n\t\tvar padding=this.padding;\r\n\t\tvar startX=padding[3];\r\n\t\tvar textAlgin=\"left\";\r\n\t\tvar lines=this._lines;\r\n\t\tvar lineHeight=this.leading+this._charSize.height;\r\n\t\tvar tCurrBitmapFont=this._currBitmapFont;\r\n\t\tif (tCurrBitmapFont){\r\n\t\t\tlineHeight=this.leading+tCurrBitmapFont.getMaxHeight();\r\n\t\t};\r\n\t\tvar startY=padding[0];\r\n\t\tif ((!tCurrBitmapFont)&& this._width > 0 && this._textWidth <=this._width){\r\n\t\t\tif (this.align==\"right\"){\r\n\t\t\t\ttextAlgin=\"right\";\r\n\t\t\t\tstartX=this._width-padding[1];\r\n\t\t\t\t}else if (this.align==\"center\"){\r\n\t\t\t\ttextAlgin=\"center\";\r\n\t\t\t\tstartX=this._width *0.5+padding[3]-padding[1];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._height > 0){\r\n\t\t\tvar tempVAlign=(this._textHeight > this._height)? \"top\" :this.valign;\r\n\t\t\tif (tempVAlign===\"middle\")\r\n\t\t\t\tstartY=(this._height-visibleLineCount *lineHeight)*0.5+padding[0]-padding[2];\r\n\t\t\telse if (tempVAlign===\"bottom\")\r\n\t\t\tstartY=this._height-visibleLineCount *lineHeight-padding[2];\r\n\t\t};\r\n\t\tvar style=this._style;\r\n\t\tif (tCurrBitmapFont && tCurrBitmapFont.autoScaleSize){\r\n\t\t\tvar bitmapScale=tCurrBitmapFont.fontSize / this.fontSize;\r\n\t\t}\r\n\t\tif (this._clipPoint){\r\n\t\t\tgraphics.save();\r\n\t\t\tif (tCurrBitmapFont && tCurrBitmapFont.autoScaleSize){\r\n\t\t\t\tvar tClipWidth=0;\r\n\t\t\t\tvar tClipHeight=0;\r\n\t\t\t\tthis._width ? tClipWidth=(this._width-padding[3]-padding[1]):tClipWidth=this._textWidth;\r\n\t\t\t\tthis._height ? tClipHeight=(this._height-padding[0]-padding[2]):tClipHeight=this._textHeight;\r\n\t\t\t\ttClipWidth *=bitmapScale;\r\n\t\t\t\ttClipHeight *=bitmapScale;\r\n\t\t\t\tgraphics.clipRect(padding[3],padding[0],tClipWidth,tClipHeight);\r\n\t\t\t\t}else {\r\n\t\t\t\tgraphics.clipRect(padding[3],padding[0],this._width ? (this._width-padding[3]-padding[1]):this._textWidth,this._height ? (this._height-padding[0]-padding[2]):this._textHeight);\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar password=style.password;\r\n\t\tif ((\"prompt\" in this)&& this['prompt']==this._text)\r\n\t\t\tpassword=false;\r\n\t\tvar x=0,y=0;\r\n\t\tvar end=Math.min(this._lines.length,visibleLineCount+begin)|| 1;\r\n\t\tfor (var i=begin;i < end;i++){\r\n\t\t\tvar word=lines[i];\r\n\t\t\tvar _word;\r\n\t\t\tif (password){\r\n\t\t\t\tvar len=word.length;\r\n\t\t\t\tword=\"\";\r\n\t\t\t\tfor (var j=len;j > 0;j--){\r\n\t\t\t\t\tword+=\"●\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tx=startX-(this._clipPoint ? this._clipPoint.x :0);\r\n\t\t\ty=startY+lineHeight *i-(this._clipPoint ? this._clipPoint.y :0);\r\n\t\t\tthis.underline && this.drawUnderline(textAlgin,x,y,i);\r\n\t\t\tif (tCurrBitmapFont){\r\n\t\t\t\tvar tWidth=this.width;\r\n\t\t\t\tif (tCurrBitmapFont.autoScaleSize){\r\n\t\t\t\t\ttWidth=this.width *bitmapScale;\r\n\t\t\t\t}\r\n\t\t\t\ttCurrBitmapFont.drawText(word,this,x,y,this.align,tWidth);\r\n\t\t\t\t}else {\r\n\t\t\t\tif (Render.isWebGL){\r\n\t\t\t\t\tthis._words || (this._words=[]);\r\n\t\t\t\t\t_word=this._words.length > (i-begin)? this._words[i-begin] :new WordText();\r\n\t\t\t\t\t_word.setText(word);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t_word=word;\r\n\t\t\t\t}\r\n\t\t\t\tstyle.stroke ? graphics.fillBorderText(_word,x,y,ctxFont,this.color,style.strokeColor,style.stroke,textAlgin):graphics.fillText(_word,x,y,ctxFont,this.color,textAlgin);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tCurrBitmapFont && tCurrBitmapFont.autoScaleSize){\r\n\t\t\tvar tScale=1 / bitmapScale;\r\n\t\t\tthis.scale(tScale,tScale);\r\n\t\t}\r\n\t\tif (this._clipPoint)\r\n\t\t\tgraphics.restore();\r\n\t\tthis._startX=startX;\r\n\t\tthis._startY=startY;\r\n\t}\r\n\r\n\t/**\r\n\t*绘制下划线\r\n\t*@param x 本行坐标\r\n\t*@param y 本行坐标\r\n\t*@param lineIndex 本行索引\r\n\t*/\r\n\t__proto.drawUnderline=function(align,x,y,lineIndex){\r\n\t\tvar lineWidth=this._lineWidths[lineIndex];\r\n\t\tswitch (align){\r\n\t\t\tcase 'center':\r\n\t\t\t\tx-=lineWidth / 2;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'right':\r\n\t\t\t\tx-=lineWidth;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase 'left':\r\n\t\t\tdefault :\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\ty+=this._charSize.height;\r\n\t\tthis._graphics.drawLine(x,y,x+lineWidth,y,this.underlineColor || this.color,1);\r\n\t}\r\n\r\n\t/**\r\n\t*<p>排版文本。</p>\r\n\t*<p>进行宽高计算，渲染、重绘文本。</p>\r\n\t*/\r\n\t__proto.typeset=function(){\r\n\t\tthis._isChanged=false;\r\n\t\tif (!this._text){\r\n\t\t\tthis._clipPoint=null;\r\n\t\t\tthis._textWidth=this._textHeight=0;\r\n\t\t\tthis.graphics.clear(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tBrowser.context.font=this._getCSSStyle().font;\r\n\t\tthis._lines.length=0;\r\n\t\tthis._lineWidths.length=0;\r\n\t\tif (this._isPassWordMode()){\r\n\t\t\tthis.parseLines(this._getPassWordTxt(this._text));\r\n\t\t}else\r\n\t\tthis.parseLines(this._text);\r\n\t\tthis.evalTextSize();\r\n\t\tif (this.checkEnabledViewportOrNot())\r\n\t\t\tthis._clipPoint || (this._clipPoint=new Point(0,0));\r\n\t\telse\r\n\t\tthis._clipPoint=null;\r\n\t\tvar lineCount=this._lines.length;\r\n\t\tif (this.overflow !=Text.VISIBLE){\r\n\t\t\tvar func=this.overflow==Text.HIDDEN ? Math.floor :Math.ceil;\r\n\t\t\tlineCount=Math.min(lineCount,func((this.height-this.padding[0]-this.padding[2])/ (this.leading+this._charSize.height)));\r\n\t\t};\r\n\t\tvar startLine=this.scrollY / (this._charSize.height+this.leading)| 0;\r\n\t\tthis.renderText(startLine,lineCount);\r\n\t\tthis.repaint();\r\n\t}\r\n\r\n\t__proto.evalTextSize=function(){\r\n\t\tvar nw=NaN,nh=NaN;\r\n\t\tnw=Math.max.apply(this,this._lineWidths);\r\n\t\tif (this._currBitmapFont)\r\n\t\t\tnh=this._lines.length *(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2];\r\n\t\telse\r\n\t\tnh=this._lines.length *(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];\r\n\t\tif (nw !=this._textWidth || nh !=this._textHeight){\r\n\t\t\tthis._textWidth=nw;\r\n\t\t\tthis._textHeight=nh;\r\n\t\t\tif (!this._width || !this._height)\r\n\t\t\t\tthis.conchModel && this.conchModel.size(this._width || this._textWidth,this._height || this._textHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.checkEnabledViewportOrNot=function(){\r\n\t\treturn this.overflow==Text.SCROLL && ((this._width > 0 && this._textWidth > this._width)|| (this._height > 0 && this._textHeight > this._height));\r\n\t}\r\n\r\n\t/**\r\n\t*<p>快速更改显示文本。不进行排版计算，效率较高。</p>\r\n\t*<p>如果只更改文字内容，不更改文字样式，建议使用此接口，能提高效率。</p>\r\n\t*@param text 文本内容。\r\n\t*/\r\n\t__proto.changeText=function(text){\r\n\t\tif (this._text!==text){\r\n\t\t\tthis.lang(text+\"\");\r\n\t\t\tif (this._graphics && this._graphics.replaceText(this._text)){\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.typeset();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*分析文本换行。\r\n\t*/\r\n\t__proto.parseLines=function(text){\r\n\t\tvar needWordWrapOrTruncate=this.wordWrap || this.overflow==Text.HIDDEN;\r\n\t\tif (needWordWrapOrTruncate){\r\n\t\t\tvar wordWrapWidth=this.getWordWrapWidth();\r\n\t\t}\r\n\t\tif (this._currBitmapFont){\r\n\t\t\tthis._charSize.width=this._currBitmapFont.getMaxWidth();\r\n\t\t\tthis._charSize.height=this._currBitmapFont.getMaxHeight();\r\n\t\t\t}else {\r\n\t\t\tvar measureResult=Browser.context.measureText(Text._testWord);\r\n\t\t\tthis._charSize.width=measureResult.width;\r\n\t\t\tthis._charSize.height=(measureResult.height || this.fontSize);\r\n\t\t};\r\n\t\tvar lines=text.replace(/\\r\\n/g,\"\\n\").split(\"\\n\");\r\n\t\tfor (var i=0,n=lines.length;i < n;i++){\r\n\t\t\tvar line=lines[i];\r\n\t\t\tif (needWordWrapOrTruncate)\r\n\t\t\t\tthis.parseLine(line,wordWrapWidth);\r\n\t\t\telse {\r\n\t\t\t\tthis._lineWidths.push(this.getTextWidth(line));\r\n\t\t\t\tthis._lines.push(line);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*解析行文本。\r\n\t*@param line 某行的文本。\r\n\t*@param wordWrapWidth 文本的显示宽度。\r\n\t*/\r\n\t__proto.parseLine=function(line,wordWrapWidth){\r\n\t\tvar ctx=Browser.context;\r\n\t\tvar lines=this._lines;\r\n\t\tvar maybeIndex=0;\r\n\t\tvar execResult;\r\n\t\tvar charsWidth=NaN;\r\n\t\tvar wordWidth=NaN;\r\n\t\tvar startIndex=0;\r\n\t\tcharsWidth=this.getTextWidth(line);\r\n\t\tif (charsWidth <=wordWrapWidth){\r\n\t\t\tlines.push(line);\r\n\t\t\tthis._lineWidths.push(charsWidth);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcharsWidth=this._charSize.width;\r\n\t\tmaybeIndex=Math.floor(wordWrapWidth / charsWidth);\r\n\t\t(maybeIndex==0)&& (maybeIndex=1);\r\n\t\tcharsWidth=this.getTextWidth(line.substring(0,maybeIndex));\r\n\t\twordWidth=charsWidth;\r\n\t\tfor (var j=maybeIndex,m=line.length;j < m;j++){\r\n\t\t\tcharsWidth=this.getTextWidth(line.charAt(j));\r\n\t\t\twordWidth+=charsWidth;\r\n\t\t\tif (wordWidth > wordWrapWidth){\r\n\t\t\t\tif (this.wordWrap){\r\n\t\t\t\t\tvar newLine=line.substring(startIndex,j);\r\n\t\t\t\t\tif (newLine.charCodeAt(newLine.length-1)< 255){\r\n\t\t\t\t\t\texecResult=/(?:\\w|-)+$/.exec(newLine);\r\n\t\t\t\t\t\tif (execResult){\r\n\t\t\t\t\t\t\tj=execResult.index+startIndex;\r\n\t\t\t\t\t\t\tif (execResult.index==0)\r\n\t\t\t\t\t\t\t\tj+=newLine.length;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnewLine=line.substring(startIndex,j);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else\r\n\t\t\t\t\tif (Text.RightToLeft){\r\n\t\t\t\t\t\texecResult=/([\\u0600-\\u06FF])+$/.exec(newLine);\r\n\t\t\t\t\t\tif(execResult){\r\n\t\t\t\t\t\t\tj=execResult.index+startIndex;\r\n\t\t\t\t\t\t\tif (execResult.index==0)\r\n\t\t\t\t\t\t\t\tj+=newLine.length;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tnewLine=line.substring(startIndex,j);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlines.push(newLine);\r\n\t\t\t\t\tthis._lineWidths.push(wordWidth-charsWidth);\r\n\t\t\t\t\tstartIndex=j;\r\n\t\t\t\t\tif (j+maybeIndex < m){\r\n\t\t\t\t\t\tj+=maybeIndex;\r\n\t\t\t\t\t\tcharsWidth=this.getTextWidth(line.substring(startIndex,j));\r\n\t\t\t\t\t\twordWidth=charsWidth;\r\n\t\t\t\t\t\tj--;\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tlines.push(line.substring(startIndex,m));\r\n\t\t\t\t\t\tthis._lineWidths.push(this.getTextWidth(lines[lines.length-1]));\r\n\t\t\t\t\t\tstartIndex=-1;\r\n\t\t\t\t\t\tbreak ;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else if (this.overflow==Text.HIDDEN){\r\n\t\t\t\t\tlines.push(line.substring(0,j));\r\n\t\t\t\t\tthis._lineWidths.push(this.getTextWidth(lines[lines.length-1]));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.wordWrap && startIndex !=-1){\r\n\t\t\tlines.push(line.substring(startIndex,m));\r\n\t\t\tthis._lineWidths.push(this.getTextWidth(lines[lines.length-1]));\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getTextWidth=function(text){\r\n\t\tif (this._currBitmapFont)\r\n\t\t\treturn this._currBitmapFont.getTextWidth(text);\r\n\t\telse\r\n\t\treturn Browser.context.measureText(text).width;\r\n\t}\r\n\r\n\t/**\r\n\t*获取换行所需的宽度。\r\n\t*/\r\n\t__proto.getWordWrapWidth=function(){\r\n\t\tvar p=this.padding;\r\n\t\tvar w=NaN;\r\n\t\tif (this._currBitmapFont && this._currBitmapFont.autoScaleSize)\r\n\t\t\tw=this._width *(this._currBitmapFont.fontSize / this.fontSize);\r\n\t\telse\r\n\t\tw=this._width;\r\n\t\tif (w <=0){\r\n\t\t\tw=this.wordWrap ? 100 :Browser.width;\r\n\t\t}\r\n\t\tw <=0 && (w=100);\r\n\t\treturn w-p[3]-p[1];\r\n\t}\r\n\r\n\t/**\r\n\t*返回字符在本类实例的父坐标系下的坐标。\r\n\t*@param charIndex 索引位置。\r\n\t*@param out （可选）输出的Point引用。\r\n\t*@return Point 字符在本类实例的父坐标系下的坐标。如果out参数不为空，则将结果赋值给指定的Point对象，否则创建一个新的Point对象返回。建议使用Point.TEMP作为out参数，可以省去Point对象创建和垃圾回收的开销，尤其是在需要频繁执行的逻辑中，比如帧循环和MOUSE_MOVE事件回调函数里面。\r\n\t*/\r\n\t__proto.getCharPoint=function(charIndex,out){\r\n\t\tthis._isChanged && Laya.timer.runCallLater(this,this.typeset);\r\n\t\tvar len=0,lines=this._lines,startIndex=0;\r\n\t\tfor (var i=0,n=lines.length;i < n;i++){\r\n\t\t\tlen+=lines[i].length;\r\n\t\t\tif (charIndex < len){\r\n\t\t\t\tvar line=i;\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\t\tstartIndex=len;\r\n\t\t};\r\n\t\tvar ctxFont=(this.italic ? \"italic \" :\"\")+(this.bold ? \"bold \" :\"\")+this.fontSize+\"px \"+this.font;\r\n\t\tBrowser.context.font=ctxFont;\r\n\t\tvar width=this.getTextWidth(this._text.substring(startIndex,charIndex));\r\n\t\tvar point=out || new Point();\r\n\t\treturn point.setTo(this._startX+width-(this._clipPoint ? this._clipPoint.x :0),this._startY+line *(this._charSize.height+this.leading)-(this._clipPoint ? this._clipPoint.y :0));\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'width',function(){\r\n\t\tif (this._width)\r\n\t\t\treturn this._width;\r\n\t\treturn this.textWidth+this.padding[1]+this.padding[3];\r\n\t\t},function(value){\r\n\t\tif (value !=this._width){\r\n\t\t\tLaya.superSet(Sprite,this,'width',value);\r\n\t\t\tthis.isChanged=true;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示文本的宽度，以像素为单位。\r\n\t*/\r\n\t__getset(0,__proto,'textWidth',function(){\r\n\t\tthis._isChanged && Laya.timer.runCallLater(this,this.typeset);\r\n\t\treturn this._textWidth;\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'height',function(){\r\n\t\tif (this._height)return this._height;\r\n\t\treturn this.textHeight+this.padding[0]+this.padding[2];\r\n\t\t},function(value){\r\n\t\tif (value !=this._height){\r\n\t\t\tLaya.superSet(Sprite,this,'height',value);\r\n\t\t\tthis.isChanged=true;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*表示文本的高度，以像素为单位。\r\n\t*/\r\n\t__getset(0,__proto,'textHeight',function(){\r\n\t\tthis._isChanged && Laya.timer.runCallLater(this,this.typeset);\r\n\t\treturn this._textHeight;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>边距信息。</p>\r\n\t*<p>数据格式：[上边距，右边距，下边距，左边距]（边距以像素为单位）。</p>\r\n\t*/\r\n\t__getset(0,__proto,'padding',function(){\r\n\t\treturn this._getCSSStyle().padding;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().padding=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指定文本是否为粗体字。</p>\r\n\t*<p>默认值为 false，这意味着不使用粗体字。如果值为 true，则文本为粗体字。</p>\r\n\t*/\r\n\t__getset(0,__proto,'bold',function(){\r\n\t\treturn this._getCSSStyle().bold;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().bold=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**当前文本的内容字符串。*/\r\n\t__getset(0,__proto,'text',function(){\r\n\t\treturn this._text || \"\";\r\n\t\t},function(value){\r\n\t\tif (this._text!==value){\r\n\t\t\tthis.lang(value+\"\");\r\n\t\t\tthis.isChanged=true;\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示文本的颜色值。可以通过 <code>Text.defaultColor</code> 设置默认颜色。</p>\r\n\t*<p>默认值为黑色。</p>\r\n\t*/\r\n\t__getset(0,__proto,'color',function(){\r\n\t\treturn this._getCSSStyle().color;\r\n\t\t},function(value){\r\n\t\tif (this._getCSSStyle().color !=value){\r\n\t\t\tthis._getCSSStyle().color=value;\r\n\t\t\tif (!this._isChanged && this._graphics){\r\n\t\t\t\tthis._graphics.replaceTextColor(this.color)\r\n\t\t\t\t}else {\r\n\t\t\t\tthis.isChanged=true;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>文本的字体名称，以字符串形式表示。</p>\r\n\t*<p>默认值为：\"Arial\"，可以通过Font.defaultFont设置默认字体。</p>\r\n\t*<p>如果运行时系统找不到设定的字体，则用系统默认的字体渲染文字，从而导致显示异常。(通常电脑上显示正常，在一些移动端因缺少设置的字体而显示异常)。</p>\r\n\t*@see laya.display.css.Font#defaultFamily\r\n\t*/\r\n\t__getset(0,__proto,'font',function(){\r\n\t\treturn this._getCSSStyle().fontFamily;\r\n\t\t},function(value){\r\n\t\tif (this._currBitmapFont){\r\n\t\t\tthis._currBitmapFont=null;\r\n\t\t\tthis.scale(1,1);\r\n\t\t}\r\n\t\tif (Text._bitmapFonts && Text._bitmapFonts[value]){\r\n\t\t\tthis._currBitmapFont=Text._bitmapFonts[value];\r\n\t\t}\r\n\t\tthis._getCSSStyle().fontFamily=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>指定文本的字体大小（以像素为单位）。</p>\r\n\t*<p>默认为20像素，可以通过 <code>Text.defaultSize</code> 设置默认大小。</p>\r\n\t*/\r\n\t__getset(0,__proto,'fontSize',function(){\r\n\t\treturn this._getCSSStyle().fontSize;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().fontSize=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示使用此文本格式的文本是否为斜体。</p>\r\n\t*<p>默认值为 false，这意味着不使用斜体。如果值为 true，则文本为斜体。</p>\r\n\t*/\r\n\t__getset(0,__proto,'italic',function(){\r\n\t\treturn this._getCSSStyle().italic;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().italic=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示文本的水平显示方式。</p>\r\n\t*<p><b>取值：</b>\r\n\t*<li>\"left\"： 居左对齐显示。</li>\r\n\t*<li>\"center\"： 居中对齐显示。</li>\r\n\t*<li>\"right\"： 居右对齐显示。</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'align',function(){\r\n\t\treturn this._getCSSStyle().align;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().align=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示文本的垂直显示方式。</p>\r\n\t*<p><b>取值：</b>\r\n\t*<li>\"top\"： 居顶部对齐显示。</li>\r\n\t*<li>\"middle\"： 居中对齐显示。</li>\r\n\t*<li>\"bottom\"： 居底部对齐显示。</li>\r\n\t*</p>\r\n\t*/\r\n\t__getset(0,__proto,'valign',function(){\r\n\t\treturn this._getCSSStyle().valign;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().valign=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>表示文本是否自动换行，默认为false。</p>\r\n\t*<p>若值为true，则自动换行；否则不自动换行。</p>\r\n\t*/\r\n\t__getset(0,__proto,'wordWrap',function(){\r\n\t\treturn this._getCSSStyle().wordWrap;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().wordWrap=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*垂直行间距（以像素为单位）。\r\n\t*/\r\n\t__getset(0,__proto,'leading',function(){\r\n\t\treturn this._getCSSStyle().leading;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().leading=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*文本背景颜色，以字符串表示。\r\n\t*/\r\n\t__getset(0,__proto,'bgColor',function(){\r\n\t\treturn this._getCSSStyle().backgroundColor;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().backgroundColor=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*文本边框背景颜色，以字符串表示。\r\n\t*/\r\n\t__getset(0,__proto,'borderColor',function(){\r\n\t\treturn this._getCSSStyle().borderColor;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().borderColor=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边宽度（以像素为单位）。</p>\r\n\t*<p>默认值0，表示不描边。</p>\r\n\t*/\r\n\t__getset(0,__proto,'stroke',function(){\r\n\t\treturn this._getCSSStyle().stroke;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().stroke=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>描边颜色，以字符串表示。</p>\r\n\t*<p>默认值为 \"#000000\"（黑色）;</p>\r\n\t*/\r\n\t__getset(0,__proto,'strokeColor',function(){\r\n\t\treturn this._getCSSStyle().strokeColor;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().strokeColor=value;\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\t/**\r\n\t*一个布尔值，表示文本的属性是否有改变。若为true表示有改变。\r\n\t*/\r\n\t__getset(0,__proto,'isChanged',null,function(value){\r\n\t\tif (this._isChanged!==value){\r\n\t\t\tthis._isChanged=value;\r\n\t\t\tvalue && Laya.timer.callLater(this,this.typeset);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>设置横向滚动量。</p>\r\n\t*<p>即使设置超出滚动范围的值，也会被自动限制在可能的最大值处。</p>\r\n\t*/\r\n\t/**\r\n\t*获取横向滚动量。\r\n\t*/\r\n\t__getset(0,__proto,'scrollX',function(){\r\n\t\tif (!this._clipPoint)\r\n\t\t\treturn 0;\r\n\t\treturn this._clipPoint.x;\r\n\t\t},function(value){\r\n\t\tif (this.overflow !=Text.SCROLL || (this.textWidth < this._width || !this._clipPoint))\r\n\t\t\treturn;\r\n\t\tvalue=value < this.padding[3] ? this.padding[3] :value;\r\n\t\tvar maxScrollX=this._textWidth-this._width;\r\n\t\tvalue=value > maxScrollX ? maxScrollX :value;\r\n\t\tvar visibleLineCount=this._height / (this._charSize.height+this.leading)| 0+1;\r\n\t\tthis._clipPoint.x=value;\r\n\t\tthis.renderText(this._lastVisibleLineIndex,visibleLineCount);\r\n\t});\r\n\r\n\t/**\r\n\t*设置纵向滚动量（px)。即使设置超出滚动范围的值，也会被自动限制在可能的最大值处。\r\n\t*/\r\n\t/**\r\n\t*获取纵向滚动量。\r\n\t*/\r\n\t__getset(0,__proto,'scrollY',function(){\r\n\t\tif (!this._clipPoint)\r\n\t\t\treturn 0;\r\n\t\treturn this._clipPoint.y;\r\n\t\t},function(value){\r\n\t\tif (this.overflow !=Text.SCROLL || (this.textHeight < this._height || !this._clipPoint))\r\n\t\t\treturn;\r\n\t\tvalue=value < this.padding[0] ? this.padding[0] :value;\r\n\t\tvar maxScrollY=this._textHeight-this._height;\r\n\t\tvalue=value > maxScrollY ? maxScrollY :value;\r\n\t\tvar startLine=value / (this._charSize.height+this.leading)| 0;\r\n\t\tthis._lastVisibleLineIndex=startLine;\r\n\t\tvar visibleLineCount=(this._height / (this._charSize.height+this.leading)| 0)+1;\r\n\t\tthis._clipPoint.y=value;\r\n\t\tthis.renderText(startLine,visibleLineCount);\r\n\t});\r\n\r\n\t/**\r\n\t*获取横向可滚动最大值。\r\n\t*/\r\n\t__getset(0,__proto,'maxScrollX',function(){\r\n\t\treturn (this.textWidth < this._width)? 0 :this._textWidth-this._width;\r\n\t});\r\n\r\n\t/**\r\n\t*获取纵向可滚动最大值。\r\n\t*/\r\n\t__getset(0,__proto,'maxScrollY',function(){\r\n\t\treturn (this.textHeight < this._height)? 0 :this._textHeight-this._height;\r\n\t});\r\n\r\n\t__getset(0,__proto,'lines',function(){\r\n\t\tif (this._isChanged)\r\n\t\t\tthis.typeset();\r\n\t\treturn this._lines;\r\n\t});\r\n\r\n\t__getset(0,__proto,'underlineColor',function(){\r\n\t\treturn this._underlineColor;\r\n\t\t},function(value){\r\n\t\tthis._underlineColor=value;\r\n\t\tthis._isChanged=true;\r\n\t\tthis.typeset();\r\n\t});\r\n\r\n\tText.registerBitmapFont=function(name,bitmapFont){\r\n\t\tText._bitmapFonts || (Text._bitmapFonts={});\r\n\t\tText._bitmapFonts[name]=bitmapFont;\r\n\t}\r\n\r\n\tText.unregisterBitmapFont=function(name,destroy){\r\n\t\t(destroy===void 0)&& (destroy=true);\r\n\t\tif (Text._bitmapFonts && Text._bitmapFonts[name]){\r\n\t\t\tvar tBitmapFont=Text._bitmapFonts[name];\r\n\t\t\tif (destroy){\r\n\t\t\t\ttBitmapFont.destroy();\r\n\t\t\t}\r\n\t\t\tdelete Text._bitmapFonts[name];\r\n\t\t}\r\n\t}\r\n\r\n\tText.setTextRightToLeft=function(){\r\n\t\tvar style;\r\n\t\tstyle=Browser.canvas.source.style;\r\n\t\tstyle.display=\"none\";\r\n\t\tstyle.position=\"absolute\";\r\n\t\tstyle.direction=\"rtl\";\r\n\t\tRender._mainCanvas.source.style.direction=\"rtl\";\r\n\t\tlaya.display.Text.RightToLeft=true;\r\n\t\tBrowser.document.body.appendChild(Browser.canvas.source);\r\n\t}\r\n\r\n\tText.supportFont=function(font){\r\n\t\tBrowser.context.font=\"10px sans-serif\";\r\n\t\tvar defaultFontWidth=Browser.context.measureText(\"abcji\").width;\r\n\t\tBrowser.context.font=\"10px \"+font;\r\n\t\tvar customFontWidth=Browser.context.measureText(\"abcji\").width;\r\n\t\tconsole.log(defaultFontWidth,customFontWidth);\r\n\t\tif (defaultFontWidth===customFontWidth)return false;\r\n\t\telse return true;\r\n\t}\r\n\r\n\tText._testWord=\"游\";\r\n\tText.langPacks=null;\r\n\tText.VISIBLE=\"visible\";\r\n\tText.SCROLL=\"scroll\";\r\n\tText.HIDDEN=\"hidden\";\r\n\tText.CharacterCache=true;\r\n\tText.RightToLeft=false;\r\n\tText._bitmapFonts=null;\r\n\t__static(Text,\r\n\t['_fontFamilyMap',function(){return this._fontFamilyMap={\"报隶\" :\"报隶-简\",\"黑体\" :\"黑体-简\",\"楷体\" :\"楷体-简\",\"兰亭黑\" :\"兰亭黑-简\",\"隶变\" :\"隶变-简\",\"凌慧体\" :\"凌慧体-简\",\"翩翩体\" :\"翩翩体-简\",\"苹方\" :\"苹方-简\",\"手札体\" :\"手札体-简\",\"宋体\" :\"宋体-简\",\"娃娃体\" :\"娃娃体-简\",\"魏碑\" :\"魏碑-简\",\"行楷\" :\"行楷-简\",\"雅痞\" :\"雅痞-简\",\"圆体\" :\"圆体-简\"};}\r\n\t]);\r\n\treturn Text;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*<p> <code>Stage</code> 是舞台类，显示列表的根节点，所有显示对象都在舞台上显示。通过 Laya.stage 单例访问。</p>\r\n*<p>Stage提供几种适配模式，不同的适配模式会产生不同的画布大小，画布越大，渲染压力越大，所以要选择合适的适配方案。</p>\r\n*<p>Stage提供不同的帧率模式，帧率越高，渲染压力越大，越费电，合理使用帧率甚至动态更改帧率有利于改进手机耗电。</p>\r\n*/\r\n//class laya.display.Stage extends laya.display.Sprite\r\nvar Stage=(function(_super){\r\n\tfunction Stage(){\r\n\t\t/**当前焦点对象，此对象会影响当前键盘事件的派发主体。*/\r\n\t\tthis.focus=null;\r\n\t\t/**设计宽度（初始化时设置的宽度Laya.init(width,height)）*/\r\n\t\tthis.designWidth=0;\r\n\t\t/**设计高度（初始化时设置的高度Laya.init(width,height)）*/\r\n\t\tthis.designHeight=0;\r\n\t\t/**画布是否发生翻转。*/\r\n\t\tthis.canvasRotation=false;\r\n\t\t/**画布的旋转角度。*/\r\n\t\tthis.canvasDegree=0;\r\n\t\t/**\r\n\t\t*<p>设置是否渲染，设置为false，可以停止渲染，画面会停留到最后一次渲染上，减少cpu消耗，此设置不影响时钟。</p>\r\n\t\t*<p>比如非激活状态，可以设置renderingEnabled=true以节省消耗。</p>\r\n\t\t**/\r\n\t\tthis.renderingEnabled=true;\r\n\t\t/**是否启用屏幕适配，可以适配后，在某个时候关闭屏幕适配，防止某些操作导致的屏幕以外改变*/\r\n\t\tthis.screenAdaptationEnabled=true;\r\n\t\t/**@private */\r\n\t\tthis._screenMode=\"none\";\r\n\t\t/**@private */\r\n\t\tthis._scaleMode=\"noscale\";\r\n\t\t/**@private */\r\n\t\tthis._alignV=\"top\";\r\n\t\t/**@private */\r\n\t\tthis._alignH=\"left\";\r\n\t\t/**@private */\r\n\t\tthis._bgColor=\"black\";\r\n\t\t/**@private */\r\n\t\tthis._mouseMoveTime=0;\r\n\t\t/**@private */\r\n\t\tthis._renderCount=0;\r\n\t\t/**@private */\r\n\t\tthis._frameStartTime=NaN;\r\n\t\t/**@private */\r\n\t\tthis._isFocused=false;\r\n\t\t/**@private */\r\n\t\tthis._isVisibility=false;\r\n\t\t/**@private 3D场景*/\r\n\t\tthis._scenes=null;\r\n\t\t/**@private */\r\n\t\tthis._frameRate=\"fast\";\r\n\t\tStage.__super.call(this);\r\n\t\tthis.offset=new Point();\r\n\t\tthis._canvasTransform=new Matrix();\r\n\t\tthis._previousOrientation=Browser.window.orientation;\r\n\t\tvar _$this=this;\r\n\t\tthis.transform=Matrix.create();\r\n\t\tthis._scenes=[];\r\n\t\tthis.mouseEnabled=true;\r\n\t\tthis.hitTestPrior=true;\r\n\t\tthis.autoSize=false;\r\n\t\tthis._displayedInStage=true;\r\n\t\tthis._isFocused=true;\r\n\t\tthis._isVisibility=true;\r\n\t\tvar window=Browser.window;\r\n\t\tvar _this=this;\r\n\t\twindow.addEventListener(\"focus\",function(){\r\n\t\t\t_$this._isFocused=true;\r\n\t\t\t_this.event(/*laya.events.Event.FOCUS*/\"focus\");\r\n\t\t\t_this.event(/*laya.events.Event.FOCUS_CHANGE*/\"focuschange\");\r\n\t\t});\r\n\t\twindow.addEventListener(\"blur\",function(){\r\n\t\t\t_$this._isFocused=false;\r\n\t\t\t_this.event(/*laya.events.Event.BLUR*/\"blur\");\r\n\t\t\t_this.event(/*laya.events.Event.FOCUS_CHANGE*/\"focuschange\");\r\n\t\t\tif (_this._isInputting())Input[\"inputElement\"].target.focus=false;\r\n\t\t});\r\n\t\tvar hidden=\"hidden\",state=\"visibilityState\",visibilityChange=\"visibilitychange\";\r\n\t\tvar document=window.document;\r\n\t\tif (typeof document.hidden!==\"undefined\"){\r\n\t\t\tvisibilityChange=\"visibilitychange\";\r\n\t\t\tstate=\"visibilityState\";\r\n\t\t\t}else if (typeof document.mozHidden!==\"undefined\"){\r\n\t\t\tvisibilityChange=\"mozvisibilitychange\";\r\n\t\t\tstate=\"mozVisibilityState\";\r\n\t\t\t}else if (typeof document.msHidden!==\"undefined\"){\r\n\t\t\tvisibilityChange=\"msvisibilitychange\";\r\n\t\t\tstate=\"msVisibilityState\";\r\n\t\t\t}else if (typeof document.webkitHidden!==\"undefined\"){\r\n\t\t\tvisibilityChange=\"webkitvisibilitychange\";\r\n\t\t\tstate=\"webkitVisibilityState\";\r\n\t\t}\r\n\t\twindow.document.addEventListener(visibilityChange,visibleChangeFun);\r\n\t\tfunction visibleChangeFun (){\r\n\t\t\tif (Browser.document[state]==\"hidden\"){\r\n\t\t\t\t_this._setStageVisible(false);\r\n\t\t\t\t}else {\r\n\t\t\t\t_this._setStageVisible(true);\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.document.addEventListener(\"qbrowserVisibilityChange\",qbroserVisibleChangeFun);\r\n\t\tfunction qbroserVisibleChangeFun (e){\r\n\t\t\t_this._setStageVisible(!e.hidden);\r\n\t\t}\r\n\t\twindow.addEventListener(\"resize\",function(){\r\n\t\t\tvar orientation=Browser.window.orientation;\r\n\t\t\tif (orientation !=null && orientation !=_$this._previousOrientation && _this._isInputting()){\r\n\t\t\t\tInput[\"inputElement\"].target.focus=false;\r\n\t\t\t}\r\n\t\t\t_$this._previousOrientation=orientation;\r\n\t\t\tif (_this._isInputting())return;\r\n\t\t\t_this._resetCanvas();\r\n\t\t});\r\n\t\twindow.addEventListener(\"orientationchange\",function(e){\r\n\t\t\t_this._resetCanvas();\r\n\t\t});\r\n\t\tthis.on(/*laya.events.Event.MOUSE_MOVE*/\"mousemove\",this,this._onmouseMove);\r\n\t\tif (Browser.onMobile)this.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onmouseMove);\r\n\t}\r\n\r\n\t__class(Stage,'laya.display.Stage',_super);\r\n\tvar __proto=Stage.prototype;\r\n\t__proto._setStageVisible=function(value){\r\n\t\tif (this._isVisibility==value)return;\r\n\t\tthis._isVisibility=value;\r\n\t\tif (!this._isVisibility)if (this._isInputting())Input[\"inputElement\"].target.focus=false;\r\n\t\tthis.event(/*laya.events.Event.VISIBILITY_CHANGE*/\"visibilitychange\");\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*在移动端输入时，输入法弹出期间不进行画布尺寸重置。\r\n\t*/\r\n\t__proto._isInputting=function(){\r\n\t\treturn (Browser.onMobile && Input.isInputting);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._changeCanvasSize=function(){\r\n\t\tthis.setScreenSize(Browser.clientWidth *Browser.pixelRatio,Browser.clientHeight *Browser.pixelRatio);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._resetCanvas=function(){\r\n\t\tif (!this.screenAdaptationEnabled)return;\r\n\t\tvar canvas=Render._mainCanvas;\r\n\t\tvar canvasStyle=canvas.source.style;\r\n\t\tcanvas.size(1,1);\r\n\t\tLaya.timer.once(100,this,this._changeCanvasSize);\r\n\t}\r\n\r\n\t/**\r\n\t*设置屏幕大小，场景会根据屏幕大小进行适配。可以动态调用此方法，来更改游戏显示的大小。\r\n\t*@param screenWidth 屏幕宽度。\r\n\t*@param screenHeight 屏幕高度。\r\n\t*/\r\n\t__proto.setScreenSize=function(screenWidth,screenHeight){\r\n\t\tvar rotation=false;\r\n\t\tif (this._screenMode!==\"none\"){\r\n\t\t\tvar screenType=screenWidth / screenHeight < 1 ? \"vertical\" :\"horizontal\";\r\n\t\t\trotation=screenType!==this._screenMode;\r\n\t\t\tif (rotation){\r\n\t\t\t\tvar temp=screenHeight;\r\n\t\t\t\tscreenHeight=screenWidth;\r\n\t\t\t\tscreenWidth=temp;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.canvasRotation=rotation;\r\n\t\tvar canvas=Render._mainCanvas;\r\n\t\tvar canvasStyle=canvas.source.style;\r\n\t\tvar mat=this._canvasTransform.identity();\r\n\t\tvar scaleMode=this._scaleMode;\r\n\t\tvar scaleX=screenWidth / this.designWidth;\r\n\t\tvar scaleY=screenHeight / this.designHeight;\r\n\t\tvar canvasWidth=this.designWidth;\r\n\t\tvar canvasHeight=this.designHeight;\r\n\t\tvar realWidth=screenWidth;\r\n\t\tvar realHeight=screenHeight;\r\n\t\tvar pixelRatio=Browser.pixelRatio;\r\n\t\tthis._width=this.designWidth;\r\n\t\tthis._height=this.designHeight;\r\n\t\tswitch (scaleMode){\r\n\t\t\tcase \"noscale\":\r\n\t\t\t\tscaleX=scaleY=1;\r\n\t\t\t\trealWidth=this.designWidth;\r\n\t\t\t\trealHeight=this.designHeight;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"showall\":\r\n\t\t\t\tscaleX=scaleY=Math.min(scaleX,scaleY);\r\n\t\t\t\tcanvasWidth=realWidth=Math.round(this.designWidth *scaleX);\r\n\t\t\t\tcanvasHeight=realHeight=Math.round(this.designHeight *scaleY);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"noborder\":\r\n\t\t\t\tscaleX=scaleY=Math.max(scaleX,scaleY);\r\n\t\t\t\trealWidth=Math.round(this.designWidth *scaleX);\r\n\t\t\t\trealHeight=Math.round(this.designHeight *scaleY);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"full\":\r\n\t\t\t\tscaleX=scaleY=1;\r\n\t\t\t\tthis._width=canvasWidth=screenWidth;\r\n\t\t\t\tthis._height=canvasHeight=screenHeight;\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"fixedwidth\":\r\n\t\t\t\tscaleY=scaleX;\r\n\t\t\t\tthis._height=canvasHeight=Math.round(screenHeight / scaleX);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"fixedheight\":\r\n\t\t\t\tscaleX=scaleY;\r\n\t\t\t\tthis._width=canvasWidth=Math.round(screenWidth / scaleY);\r\n\t\t\t\tbreak ;\r\n\t\t\tcase \"fixedauto\":\r\n\t\t\t\tif ((screenWidth / screenHeight)< (this.designWidth / this.designHeight)){\r\n\t\t\t\t\tscaleY=scaleX;\r\n\t\t\t\t\tthis._height=canvasHeight=Math.round(screenHeight / scaleX);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tscaleX=scaleY;\r\n\t\t\t\t\tthis._width=canvasWidth=Math.round(screenWidth / scaleY);\r\n\t\t\t\t}\r\n\t\t\t\tbreak ;\r\n\t\t\t}\r\n\t\tif (this.conchModel)this.conchModel.size(this._width,this._height);\r\n\t\tscaleX *=this.scaleX;\r\n\t\tscaleY *=this.scaleY;\r\n\t\tif (scaleX===1 && scaleY===1){\r\n\t\t\tthis.transform.identity();\r\n\t\t\t}else {\r\n\t\t\tthis.transform.a=this._formatData(scaleX / (realWidth / canvasWidth));\r\n\t\t\tthis.transform.d=this._formatData(scaleY / (realHeight / canvasHeight));\r\n\t\t\tthis.conchModel && this.conchModel.scale(this.transform.a,this.transform.d);\r\n\t\t}\r\n\t\tcanvas.size(canvasWidth,canvasHeight);\r\n\t\tRunDriver.changeWebGLSize(canvasWidth,canvasHeight);\r\n\t\tmat.scale(realWidth / canvasWidth / pixelRatio,realHeight / canvasHeight / pixelRatio);\r\n\t\tif (this._alignH===\"left\")this.offset.x=0;\r\n\t\telse if (this._alignH===\"right\")this.offset.x=screenWidth-realWidth;\r\n\t\telse this.offset.x=(screenWidth-realWidth)*0.5 / pixelRatio;\r\n\t\tif (this._alignV===\"top\")this.offset.y=0;\r\n\t\telse if (this._alignV===\"bottom\")this.offset.y=screenHeight-realHeight;\r\n\t\telse this.offset.y=(screenHeight-realHeight)*0.5 / pixelRatio;\r\n\t\tthis.offset.x=Math.round(this.offset.x);\r\n\t\tthis.offset.y=Math.round(this.offset.y);\r\n\t\tmat.translate(this.offset.x,this.offset.y);\r\n\t\tthis.canvasDegree=0;\r\n\t\tif (rotation){\r\n\t\t\tif (this._screenMode===\"horizontal\"){\r\n\t\t\t\tmat.rotate(Math.PI / 2);\r\n\t\t\t\tmat.translate(screenHeight / pixelRatio,0);\r\n\t\t\t\tthis.canvasDegree=90;\r\n\t\t\t\t}else {\r\n\t\t\t\tmat.rotate(-Math.PI / 2);\r\n\t\t\t\tmat.translate(0,screenWidth / pixelRatio);\r\n\t\t\t\tthis.canvasDegree=-90;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmat.a=this._formatData(mat.a);\r\n\t\tmat.d=this._formatData(mat.d);\r\n\t\tmat.tx=this._formatData(mat.tx);\r\n\t\tmat.ty=this._formatData(mat.ty);\r\n\t\tcanvasStyle.transformOrigin=canvasStyle.webkitTransformOrigin=canvasStyle.msTransformOrigin=canvasStyle.mozTransformOrigin=canvasStyle.oTransformOrigin=\"0px 0px 0px\";\r\n\t\tcanvasStyle.transform=canvasStyle.webkitTransform=canvasStyle.msTransform=canvasStyle.mozTransform=canvasStyle.oTransform=\"matrix(\"+mat.toString()+\")\";\r\n\t\tmat.translate(parseInt(canvasStyle.left)|| 0,parseInt(canvasStyle.top)|| 0);\r\n\t\tthis.visible=true;\r\n\t\tthis._repaint=1;\r\n\t\tthis.event(/*laya.events.Event.RESIZE*/\"resize\");\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._formatData=function(value){\r\n\t\tif (Math.abs(value)< 0.000001)return 0;\r\n\t\tif (Math.abs(1-value)< 0.001)return value > 0 ? 1 :-1;\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.getMousePoint=function(){\r\n\t\treturn Point.TEMP.setTo(this.mouseX,this.mouseY);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.repaint=function(){\r\n\t\tthis._repaint=1;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.parentRepaint=function(){}\r\n\t/**@private */\r\n\t__proto._loop=function(){\r\n\t\tthis.render(Render.context,0,0);\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onmouseMove=function(e){\r\n\t\tthis._mouseMoveTime=Browser.now();\r\n\t}\r\n\r\n\t/**\r\n\t*<p>获得距当前帧开始后，过了多少时间，单位为毫秒。</p>\r\n\t*<p>可以用来判断函数内时间消耗，通过合理控制每帧函数处理消耗时长，避免一帧做事情太多，对复杂计算分帧处理，能有效降低帧率波动。</p>\r\n\t*/\r\n\t__proto.getTimeFromFrameStart=function(){\r\n\t\treturn Browser.now()-this._frameStartTime;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.render=function(context,x,y){\r\n\t\tif (this._frameRate===\"sleep\" && !Render.isConchApp){\r\n\t\t\tvar now=Browser.now();\r\n\t\t\tif (now-this._frameStartTime >=1000)this._frameStartTime=now;\r\n\t\t\telse return;\r\n\t\t}\r\n\t\tthis._renderCount++;\r\n\t\tRender.isFlash && this.repaint();\r\n\t\tif (!this._style.visible){\r\n\t\t\tif (this._renderCount % 5===0){\r\n\t\t\t\tStat.loopCount++;\r\n\t\t\t\tMouseManager.instance.runEvent();\r\n\t\t\t\tLaya.timer._update();\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._frameStartTime=Browser.now();\r\n\t\tvar frameMode=this._frameRate===\"mouse\" ? (((this._frameStartTime-this._mouseMoveTime)< 2000)? \"fast\" :\"slow\"):this._frameRate;\r\n\t\tvar isFastMode=(frameMode!==\"slow\");\r\n\t\tvar isDoubleLoop=(this._renderCount % 2===0);\r\n\t\tStat.renderSlow=!isFastMode;\r\n\t\tif (isFastMode || isDoubleLoop || Render.isConchApp){\r\n\t\t\tStat.loopCount++;\r\n\t\t\tMouseManager.instance.runEvent();\r\n\t\t\tLaya.timer._update();\r\n\t\t\tRunDriver.update3DLoop();\r\n\t\t\tvar scene;\r\n\t\t\tvar i=0,n=0;\r\n\t\t\tif (Render.isConchNode){\r\n\t\t\t\tfor (i=0,n=this._scenes.length;i < n;i++){\r\n\t\t\t\t\tscene=this._scenes[i];\r\n\t\t\t\t\t(scene)&& (scene._updateSceneConch());\r\n\t\t\t\t}\r\n\t\t\t\t}else {\r\n\t\t\t\tfor (i=0,n=this._scenes.length;i < n;i++){\r\n\t\t\t\t\tscene=this._scenes[i];\r\n\t\t\t\t\t(scene)&& (scene._updateScene());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (Render.isConchNode){\r\n\t\t\t\tvar customList=Sprite[\"CustomList\"];\r\n\t\t\t\tfor (i=0,n=customList.length;i < n;i++){\r\n\t\t\t\t\tvar customItem=customList[i];\r\n\t\t\t\t\tcustomItem.customRender(customItem.customContext,0,0);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Render.isConchNode)return;\r\n\t\tif (this.renderingEnabled && (isFastMode || !isDoubleLoop)){\r\n\t\t\tif (Render.isWebGL){\r\n\t\t\t\tcontext.clear();\r\n\t\t\t\t_super.prototype.render.call(this,context,x,y);\r\n\t\t\t\tStat._show&& Stat._sp && Stat._sp.render(context,x,y);\r\n\t\t\t\tRunDriver.clear(this._bgColor);\r\n\t\t\t\tRunDriver.beginFlush();\r\n\t\t\t\tcontext.flush();\r\n\t\t\t\tRunDriver.endFinish();\r\n\t\t\t\tVectorGraphManager.instance && VectorGraphManager.getInstance().endDispose();\r\n\t\t\t\t}else {\r\n\t\t\t\tRunDriver.clear(this._bgColor);\r\n\t\t\t\t_super.prototype.render.call(this,context,x,y);\r\n\t\t\t\tStat._show&& Stat._sp && Stat._sp.render(context,x,y);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._requestFullscreen=function(){\r\n\t\tvar element=Browser.document.documentElement;\r\n\t\tif (element.requestFullscreen){\r\n\t\t\telement.requestFullscreen();\r\n\t\t\t}else if (element.mozRequestFullScreen){\r\n\t\t\telement.mozRequestFullScreen();\r\n\t\t\t}else if (element.webkitRequestFullscreen){\r\n\t\t\telement.webkitRequestFullscreen();\r\n\t\t\t}else if (element.msRequestFullscreen){\r\n\t\t\telement.msRequestFullscreen();\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._fullScreenChanged=function(){\r\n\t\tLaya.stage.event(/*laya.events.Event.FULL_SCREEN_CHANGE*/\"fullscreenchange\");\r\n\t}\r\n\r\n\t/**退出全屏模式*/\r\n\t__proto.exitFullscreen=function(){\r\n\t\tvar document=Browser.document;\r\n\t\tif (document.exitFullscreen){\r\n\t\t\tdocument.exitFullscreen();\r\n\t\t\t}else if (document.mozCancelFullScreen){\r\n\t\t\tdocument.mozCancelFullScreen();\r\n\t\t\t}else if (document.webkitExitFullscreen){\r\n\t\t\tdocument.webkitExitFullscreen();\r\n\t\t}\r\n\t}\r\n\r\n\t/**当前视窗由缩放模式导致的 X 轴缩放系数。*/\r\n\t__getset(0,__proto,'clientScaleX',function(){\r\n\t\treturn this._transform ? this._transform.getScaleX():1;\r\n\t});\r\n\r\n\t//[Deprecated]\r\n\t__getset(0,__proto,'desginHeight',function(){\r\n\t\tconsole.debug(\"desginHeight已经弃用，请使用designHeight代替\");\r\n\t\treturn this.designHeight;\r\n\t});\r\n\r\n\t/**帧率类型，支持三种模式：fast-60帧(默认)，slow-30帧，mouse-30帧（鼠标活动后会自动加速到60，鼠标不动2秒后降低为30帧，以节省消耗），sleep-1帧。*/\r\n\t__getset(0,__proto,'frameRate',function(){\r\n\t\treturn this._frameRate;\r\n\t\t},function(value){\r\n\t\tthis._frameRate=value;\r\n\t\tif (Render.isConchApp){\r\n\t\t\tswitch (this._frameRate){\r\n\t\t\t\tcase \"slow\":\r\n\t\t\t\t\tBrowser.window.conch && Browser.window.conchConfig.setSlowFrame && Browser.window.conchConfig.setSlowFrame(true);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"fast\":\r\n\t\t\t\t\tBrowser.window.conch && Browser.window.conchConfig.setSlowFrame && Browser.window.conchConfig.setSlowFrame(false);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"mouse\":\r\n\t\t\t\t\tBrowser.window.conch && Browser.window.conchConfig.setMouseFrame && Browser.window.conchConfig.setMouseFrame(2000);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tcase \"sleep\":\r\n\t\t\t\t\tBrowser.window.conch && Browser.window.conchConfig.setLimitFPS && Browser.window.conchConfig.setLimitFPS(1);\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\tdefault :\r\n\t\t\t\t\tthrow new Error(\"Stage:frameRate invalid.\");\r\n\t\t\t\t\tbreak ;\r\n\t\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**当前视窗由缩放模式导致的 Y 轴缩放系数。*/\r\n\t__getset(0,__proto,'clientScaleY',function(){\r\n\t\treturn this._transform ? this._transform.getScaleY():1;\r\n\t});\r\n\r\n\t__getset(0,__proto,'width',_super.prototype._$get_width,function(value){\r\n\t\tthis.designWidth=value;\r\n\t\tLaya.superSet(Sprite,this,'width',value);\r\n\t\tLaya.timer.callLater(this,this._changeCanvasSize);\r\n\t});\r\n\r\n\t/**\r\n\t*<p>水平对齐方式。默认值为\"left\"。</p>\r\n\t*<p><ul>取值范围：\r\n\t*<li>\"left\" ：居左对齐；</li>\r\n\t*<li>\"center\" ：居中对齐；</li>\r\n\t*<li>\"right\" ：居右对齐；</li>\r\n\t*</ul></p>\r\n\t*/\r\n\t__getset(0,__proto,'alignH',function(){\r\n\t\treturn this._alignH;\r\n\t\t},function(value){\r\n\t\tthis._alignH=value;\r\n\t\tLaya.timer.callLater(this,this._changeCanvasSize);\r\n\t});\r\n\r\n\t/**\r\n\t*舞台是否获得焦点。\r\n\t*/\r\n\t__getset(0,__proto,'isFocused',function(){\r\n\t\treturn this._isFocused;\r\n\t});\r\n\r\n\t__getset(0,__proto,'height',_super.prototype._$get_height,function(value){\r\n\t\tthis.designHeight=value;\r\n\t\tLaya.superSet(Sprite,this,'height',value);\r\n\t\tLaya.timer.callLater(this,this._changeCanvasSize);\r\n\t});\r\n\r\n\t__getset(0,__proto,'transform',function(){\r\n\t\tif (this._tfChanged)this._adjustTransform();\r\n\t\treturn this._transform=this._transform|| Matrix.create();\r\n\t},_super.prototype._$set_transform);\r\n\r\n\t/**\r\n\t*舞台是否处于可见状态(是否进入后台)。\r\n\t*/\r\n\t__getset(0,__proto,'isVisibility',function(){\r\n\t\treturn this._isVisibility;\r\n\t});\r\n\r\n\t//[Deprecated]\r\n\t__getset(0,__proto,'desginWidth',function(){\r\n\t\tconsole.debug(\"desginWidth已经弃用，请使用designWidth代替\");\r\n\t\treturn this.designWidth;\r\n\t});\r\n\r\n\t/**\r\n\t*<p>缩放模式。默认值为 \"noscale\"。</p>\r\n\t*<p><ul>取值范围：\r\n\t*<li>\"noscale\" ：不缩放；</li>\r\n\t*<li>\"exactfit\" ：全屏不等比缩放；</li>\r\n\t*<li>\"showall\" ：最小比例缩放；</li>\r\n\t*<li>\"noborder\" ：最大比例缩放；</li>\r\n\t*<li>\"full\" ：不缩放，stage的宽高等于屏幕宽高；</li>\r\n\t*<li>\"fixedwidth\" ：宽度不变，高度根据屏幕比缩放；</li>\r\n\t*<li>\"fixedheight\" ：高度不变，宽度根据屏幕比缩放；</li>\r\n\t*<li>\"fixedauto\" ：根据宽高比，自动选择使用fixedwidth或fixedheight；</li>\r\n\t*</ul></p>\r\n\t*/\r\n\t__getset(0,__proto,'scaleMode',function(){\r\n\t\treturn this._scaleMode;\r\n\t\t},function(value){\r\n\t\tthis._scaleMode=value;\r\n\t\tLaya.timer.callLater(this,this._changeCanvasSize);\r\n\t});\r\n\r\n\t/**\r\n\t*<p>垂直对齐方式。默认值为\"top\"。</p>\r\n\t*<p><ul>取值范围：\r\n\t*<li>\"top\" ：居顶部对齐；</li>\r\n\t*<li>\"middle\" ：居中对齐；</li>\r\n\t*<li>\"bottom\" ：居底部对齐；</li>\r\n\t*</ul></p>\r\n\t*/\r\n\t__getset(0,__proto,'alignV',function(){\r\n\t\treturn this._alignV;\r\n\t\t},function(value){\r\n\t\tthis._alignV=value;\r\n\t\tLaya.timer.callLater(this,this._changeCanvasSize);\r\n\t});\r\n\r\n\t/**舞台的背景颜色，默认为黑色，null为透明。*/\r\n\t__getset(0,__proto,'bgColor',function(){\r\n\t\treturn this._bgColor;\r\n\t\t},function(value){\r\n\t\tthis._bgColor=value;\r\n\t\tthis.conchModel && this.conchModel.bgColor(value);\r\n\t\tif (Render.isWebGL){\r\n\t\t\tif (value && value!==\"black\" && value!==\"#000000\"){\r\n\t\t\t\tStage._wgColor=Color.create(value)._color;\r\n\t\t\t\t}else {\r\n\t\t\t\tif (!Browser.onMiniGame)Stage._wgColor=null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (value){\r\n\t\t\tRender.canvas.style.background=value;\r\n\t\t\t}else {\r\n\t\t\tRender.canvas.style.background=\"none\";\r\n\t\t}\r\n\t});\r\n\r\n\t/**鼠标在 Stage 上的 X 轴坐标。*/\r\n\t__getset(0,__proto,'mouseX',function(){\r\n\t\treturn Math.round(MouseManager.instance.mouseX / this.clientScaleX);\r\n\t});\r\n\r\n\t/**鼠标在 Stage 上的 Y 轴坐标。*/\r\n\t__getset(0,__proto,'mouseY',function(){\r\n\t\treturn Math.round(MouseManager.instance.mouseY / this.clientScaleY);\r\n\t});\r\n\r\n\t/**\r\n\t*<p>场景布局类型。</p>\r\n\t*<p><ul>取值范围：\r\n\t*<li>\"none\" ：不更改屏幕</li>\r\n\t*<li>\"horizontal\" ：自动横屏</li>\r\n\t*<li>\"vertical\" ：自动竖屏</li>\r\n\t*</ul></p>\r\n\t*/\r\n\t__getset(0,__proto,'screenMode',function(){\r\n\t\treturn this._screenMode;\r\n\t\t},function(value){\r\n\t\tthis._screenMode=value;\r\n\t});\r\n\r\n\t__getset(0,__proto,'visible',_super.prototype._$get_visible,function(value){\r\n\t\tif (this.visible!==value){\r\n\t\t\tLaya.superSet(Sprite,this,'visible',value);\r\n\t\t\tvar style=Render._mainCanvas.source.style;\r\n\t\t\tstyle.visibility=value ? \"visible\" :\"hidden\";\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>是否开启全屏，用户点击后进入全屏。</p>\r\n\t*<p>兼容性提示：部分浏览器不允许点击进入全屏，比如Iphone等。</p>\r\n\t*/\r\n\t__getset(0,__proto,'fullScreenEnabled',null,function(value){\r\n\t\tvar document=Browser.document;\r\n\t\tvar canvas=Render.canvas;\r\n\t\tif (value){\r\n\t\t\tcanvas.addEventListener('mousedown',this._requestFullscreen);\r\n\t\t\tcanvas.addEventListener('touchstart',this._requestFullscreen);\r\n\t\t\tdocument.addEventListener(\"fullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.addEventListener(\"mozfullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.addEventListener(\"webkitfullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.addEventListener(\"msfullscreenchange\",this._fullScreenChanged);\r\n\t\t\t}else {\r\n\t\t\tcanvas.removeEventListener('mousedown',this._requestFullscreen);\r\n\t\t\tcanvas.removeEventListener('touchstart',this._requestFullscreen);\r\n\t\t\tdocument.removeEventListener(\"fullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.removeEventListener(\"mozfullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.removeEventListener(\"webkitfullscreenchange\",this._fullScreenChanged);\r\n\t\t\tdocument.removeEventListener(\"msfullscreenchange\",this._fullScreenChanged);\r\n\t\t}\r\n\t});\r\n\r\n\tStage.SCALE_NOSCALE=\"noscale\";\r\n\tStage.SCALE_EXACTFIT=\"exactfit\";\r\n\tStage.SCALE_SHOWALL=\"showall\";\r\n\tStage.SCALE_NOBORDER=\"noborder\";\r\n\tStage.SCALE_FULL=\"full\";\r\n\tStage.SCALE_FIXED_WIDTH=\"fixedwidth\";\r\n\tStage.SCALE_FIXED_HEIGHT=\"fixedheight\";\r\n\tStage.SCALE_FIXED_AUTO=\"fixedauto\";\r\n\tStage.ALIGN_LEFT=\"left\";\r\n\tStage.ALIGN_RIGHT=\"right\";\r\n\tStage.ALIGN_CENTER=\"center\";\r\n\tStage.ALIGN_TOP=\"top\";\r\n\tStage.ALIGN_MIDDLE=\"middle\";\r\n\tStage.ALIGN_BOTTOM=\"bottom\";\r\n\tStage.SCREEN_NONE=\"none\";\r\n\tStage.SCREEN_HORIZONTAL=\"horizontal\";\r\n\tStage.SCREEN_VERTICAL=\"vertical\";\r\n\tStage.FRAME_FAST=\"fast\";\r\n\tStage.FRAME_SLOW=\"slow\";\r\n\tStage.FRAME_MOUSE=\"mouse\";\r\n\tStage.FRAME_SLEEP=\"sleep\";\r\n\tStage._wgColor=null;\r\n\tStage.FRAME_MOUSE_THREDHOLD=2000;\r\n\treturn Stage;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.media.SoundNode extends laya.display.Sprite\r\nvar SoundNode=(function(_super){\r\n\tfunction SoundNode(){\r\n\t\tthis.url=null;\r\n\t\tthis._channel=null;\r\n\t\tthis._tar=null;\r\n\t\tthis._playEvents=null;\r\n\t\tthis._stopEvents=null;\r\n\t\tSoundNode.__super.call(this);\r\n\t\tthis.visible=false;\r\n\t\tthis.on(/*laya.events.Event.ADDED*/\"added\",this,this._onParentChange);\r\n\t\tthis.on(/*laya.events.Event.REMOVED*/\"removed\",this,this._onParentChange);\r\n\t}\r\n\r\n\t__class(SoundNode,'laya.media.SoundNode',_super);\r\n\tvar __proto=SoundNode.prototype;\r\n\t/**@private */\r\n\t__proto._onParentChange=function(){\r\n\t\tthis.target=this.parent;\r\n\t}\r\n\r\n\t/**\r\n\t*播放\r\n\t*@param loops 循环次数\r\n\t*@param complete 完成回调\r\n\t*\r\n\t*/\r\n\t__proto.play=function(loops,complete){\r\n\t\t(loops===void 0)&& (loops=1);\r\n\t\tif (isNaN(loops)){\r\n\t\t\tloops=1;\r\n\t\t}\r\n\t\tif (!this.url)return;\r\n\t\tthis.stop();\r\n\t\tthis._channel=SoundManager.playSound(this.url,loops,complete);\r\n\t}\r\n\r\n\t/**\r\n\t*停止播放\r\n\t*\r\n\t*/\r\n\t__proto.stop=function(){\r\n\t\tif (this._channel && !this._channel.isStopped){\r\n\t\t\tthis._channel.stop();\r\n\t\t}\r\n\t\tthis._channel=null;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setPlayAction=function(tar,event,action,add){\r\n\t\t(add===void 0)&& (add=true);\r\n\t\tif (!this[action])return;\r\n\t\tif (!tar)return;\r\n\t\tif (add){\r\n\t\t\ttar.on(event,this,this[action]);\r\n\t\t\t}else {\r\n\t\t\ttar.off(event,this,this[action]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setPlayActions=function(tar,events,action,add){\r\n\t\t(add===void 0)&& (add=true);\r\n\t\tif (!tar)return;\r\n\t\tif (!events)return;\r\n\t\tvar eventArr=events.split(\",\");\r\n\t\tvar i=0,len=0;\r\n\t\tlen=eventArr.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._setPlayAction(tar,eventArr[i],action,add);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*设置触发播放的事件\r\n\t*@param events\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'playEvent',null,function(events){\r\n\t\tthis._playEvents=events;\r\n\t\tif (!events)return;\r\n\t\tif (this._tar){\r\n\t\t\tthis._setPlayActions(this._tar,events,\"play\");\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置控制播放的对象\r\n\t*@param tar\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'target',null,function(tar){\r\n\t\tif (this._tar){\r\n\t\t\tthis._setPlayActions(this._tar,this._playEvents,\"play\",false);\r\n\t\t\tthis._setPlayActions(this._tar,this._stopEvents,\"stop\",false);\r\n\t\t}\r\n\t\tthis._tar=tar;\r\n\t\tif (this._tar){\r\n\t\t\tthis._setPlayActions(this._tar,this._playEvents,\"play\",true);\r\n\t\t\tthis._setPlayActions(this._tar,this._stopEvents,\"stop\",true);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置触发停止的事件\r\n\t*@param events\r\n\t*\r\n\t*/\r\n\t__getset(0,__proto,'stopEvent',null,function(events){\r\n\t\tthis._stopEvents=events;\r\n\t\tif (!events)return;\r\n\t\tif (this._tar){\r\n\t\t\tthis._setPlayActions(this._tar,events,\"stop\");\r\n\t\t}\r\n\t});\r\n\r\n\treturn SoundNode;\r\n})(Sprite)\r\n\r\n\r\n/**\r\n*@private\r\n*<code>FileBitmap</code> 是图片文件资源类。\r\n*/\r\n//class laya.resource.FileBitmap extends laya.resource.Bitmap\r\nvar FileBitmap=(function(_super){\r\n\tfunction FileBitmap(){\r\n\t\t/**@private 文件路径全名。*/\r\n\t\tthis._src=null;\r\n\t\t/**@private onload触发函数*/\r\n\t\tthis._onload=null;\r\n\t\t/**@private onerror触发函数*/\r\n\t\tthis._onerror=null;\r\n\t\tFileBitmap.__super.call(this);\r\n\t}\r\n\r\n\t__class(FileBitmap,'laya.resource.FileBitmap',_super);\r\n\tvar __proto=FileBitmap.prototype;\r\n\t/**\r\n\t*文件路径全名。\r\n\t*/\r\n\t__getset(0,__proto,'src',function(){\r\n\t\treturn this._src;\r\n\t\t},function(value){\r\n\t\tthis._src=value;\r\n\t});\r\n\r\n\t/**\r\n\t*载入完成处理函数。\r\n\t*/\r\n\t__getset(0,__proto,'onload',null,function(value){\r\n\t});\r\n\r\n\t/**\r\n\t*错误处理函数。\r\n\t*/\r\n\t__getset(0,__proto,'onerror',null,function(value){\r\n\t});\r\n\r\n\treturn FileBitmap;\r\n})(Bitmap)\r\n\r\n\r\n/**\r\n*<code>HTMLCanvas</code> 是 Html Canvas 的代理类，封装了 Canvas 的属性和方法。。请不要直接使用 new HTMLCanvas！\r\n*/\r\n//class laya.resource.HTMLCanvas extends laya.resource.Bitmap\r\nvar HTMLCanvas=(function(_super){\r\n\tfunction HTMLCanvas(type,canvas){\r\n\t\t//this._ctx=null;\r\n\t\tthis._is2D=false;\r\n\t\tHTMLCanvas.__super.call(this);\r\n\t\tvar _$this=this;\r\n\t\tthis._source=this;\r\n\t\tif (type===\"2D\" || (type===\"AUTO\" && !Render.isWebGL)){\r\n\t\t\tthis._is2D=true;\r\n\t\t\tthis._source=canvas || Browser.createElement(\"canvas\");\r\n\t\t\tthis._w=this._source.width;\r\n\t\t\tthis._h=this._source.height;\r\n\t\t\tvar o=this;\r\n\t\t\to.getContext=function (contextID,other){\r\n\t\t\t\tif (_$this._ctx)return _$this._ctx;\r\n\t\t\t\tvar ctx=_$this._ctx=_$this._source.getContext(contextID,other);\r\n\t\t\t\tif (ctx){\r\n\t\t\t\t\tctx._canvas=o;\r\n\t\t\t\t\tif(!Render.isFlash)ctx.size=function (w,h){\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn ctx;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.lock=true;\r\n\t}\r\n\r\n\t__class(HTMLCanvas,'laya.resource.HTMLCanvas',_super);\r\n\tvar __proto=HTMLCanvas.prototype;\r\n\t/**\r\n\t*清空画布内容。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis._ctx && this._ctx.clear();\r\n\t}\r\n\r\n\t/**\r\n\t*销毁。\r\n\t*/\r\n\t__proto.destroy=function(){\r\n\t\tthis._ctx && this._ctx.destroy();\r\n\t\tthis._ctx=null;\r\n\t\tlaya.resource.Resource.prototype.destroy.call(this);\r\n\t}\r\n\r\n\t/**\r\n\t*释放。\r\n\t*/\r\n\t__proto.release=function(){}\r\n\t/**\r\n\t*@private\r\n\t*设置 Canvas 渲染上下文。\r\n\t*@param context Canvas 渲染上下文。\r\n\t*/\r\n\t__proto._setContext=function(context){\r\n\t\tthis._ctx=context;\r\n\t}\r\n\r\n\t/**\r\n\t*获取 Canvas 渲染上下文。\r\n\t*@param contextID 上下文ID.\r\n\t*@param other\r\n\t*@return Canvas 渲染上下文 Context 对象。\r\n\t*/\r\n\t__proto.getContext=function(contextID,other){\r\n\t\treturn this._ctx ? this._ctx :(this._ctx=HTMLCanvas._createContext(this));\r\n\t}\r\n\r\n\t/**\r\n\t*获取内存大小。\r\n\t*@return 内存大小。\r\n\t*/\r\n\t__proto.getMemSize=function(){\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t*设置宽高。\r\n\t*@param w 宽度。\r\n\t*@param h 高度。\r\n\t*/\r\n\t__proto.size=function(w,h){\r\n\t\tif (this._w !=w || this._h !=h ||(this._source && (this._source.width!=w || this._source.height!=h))){\r\n\t\t\tthis._w=w;\r\n\t\t\tthis._h=h;\r\n\t\t\tthis.memorySize=this._w *this._h *4;\r\n\t\t\tthis._ctx && this._ctx.size(w,h);\r\n\t\t\tthis._source && (this._source.height=h,this._source.width=w);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.getCanvas=function(){\r\n\t\treturn this._source;\r\n\t}\r\n\r\n\t__proto.toBase64=function(type,encoderOptions,callBack){\r\n\t\tif (this._source){\r\n\t\t\tif (Render.isConchApp && this._source.toBase64){\r\n\t\t\t\tthis._source.toBase64(type,encoderOptions,callBack);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar base64Data=this._source.toDataURL(type,encoderOptions);\r\n\t\t\t\tcallBack.call(this,base64Data);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*Canvas 渲染上下文。\r\n\t*/\r\n\t__getset(0,__proto,'context',function(){\r\n\t\treturn this._ctx;\r\n\t});\r\n\r\n\t/**\r\n\t*是否当作 Bitmap 对象。\r\n\t*/\r\n\t__getset(0,__proto,'asBitmap',null,function(value){\r\n\t});\r\n\r\n\tHTMLCanvas.create=function(type,canvas){\r\n\t\treturn new HTMLCanvas(type,canvas);\r\n\t}\r\n\r\n\tHTMLCanvas.TYPE2D=\"2D\";\r\n\tHTMLCanvas.TYPE3D=\"3D\";\r\n\tHTMLCanvas.TYPEAUTO=\"AUTO\";\r\n\tHTMLCanvas._createContext=null;\r\n\treturn HTMLCanvas;\r\n})(Bitmap)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.resource.HTMLSubImage extends laya.resource.Bitmap\r\nvar HTMLSubImage=(function(_super){\r\n\t//请不要直接使用new HTMLSubImage\r\n\tfunction HTMLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){\r\n\t\tHTMLSubImage.__super.call(this);\r\n\t\tthrow new Error(\"不允许new！\");\r\n\t}\r\n\r\n\t__class(HTMLSubImage,'laya.resource.HTMLSubImage',_super);\r\n\tHTMLSubImage.create=function(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){\r\n\t\t(allowMerageInAtlas===void 0)&& (allowMerageInAtlas=false);\r\n\t\treturn new HTMLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas);\r\n\t}\r\n\r\n\treturn HTMLSubImage;\r\n})(Bitmap)\r\n\r\n\r\n/**\r\n*<p> <code>Animation</code> 是Graphics动画类。实现了基于Graphics的动画创建、播放、控制接口。</p>\r\n*<p>本类使用了动画模版缓存池，它以一定的内存开销来节省CPU开销，当相同的动画模版被多次使用时，相比于每次都创建新的动画模版，使用动画模版缓存池，只需创建一次，缓存之后多次复用，从而节省了动画模版创建的开销。</p>\r\n*<p>动画模版缓存池，以key-value键值对存储，key可以自定义，也可以从指定的配置文件中读取，value为对应的动画模版，是一个Graphics对象数组，每个Graphics对象对应一个帧图像，动画的播放实质就是定时切换Graphics对象。</p>\r\n*<p>使用set source、loadImages(...)、loadAtlas(...)、loadAnimation(...)方法可以创建动画模版。使用play(...)可以播放指定动画。</p>\r\n*@example <caption>以下示例代码，创建了一个 <code>Text</code> 实例。</caption>\r\n*package\r\n*{\r\n\t*import laya.display.Animation;\r\n\t*import laya.net.Loader;\r\n\t*import laya.utils.Handler;\r\n\t*public class Animation_Example\r\n\t*{\r\n\t\t*public function Animation_Example()\r\n\t\t*{\r\n\t\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t\t*init();//初始化\r\n\t\t\t*}\r\n\t\t*private function init():void\r\n\t\t*{\r\n\t\t\t*var animation:Animation=new Animation();//创建一个 Animation 类的实例对象 animation 。\r\n\t\t\t*animation.loadAtlas(\"resource/ani/fighter.json\");//加载图集并播放\r\n\t\t\t*animation.x=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t\t\t*animation.y=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t\t\t*animation.interval=50;//设置 animation 对象的动画播放间隔时间，单位：毫秒。\r\n\t\t\t*animation.play();//播放动画。\r\n\t\t\t*Laya.stage.addChild(animation);//将 animation 对象添加到显示列表。\r\n\t\t\t*}\r\n\t\t*}\r\n\t*}\r\n*\r\n*@example\r\n*Animation_Example();\r\n*function Animation_Example(){\r\n\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t*init();//初始化\r\n\t*}\r\n*function init()\r\n*{\r\n\t*var animation=new Laya.Animation();//创建一个 Animation 类的实例对象 animation 。\r\n\t*animation.loadAtlas(\"resource/ani/fighter.json\");//加载图集并播放\r\n\t*animation.x=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t*animation.y=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t*animation.interval=50;//设置 animation 对象的动画播放间隔时间，单位：毫秒。\r\n\t*animation.play();//播放动画。\r\n\t*Laya.stage.addChild(animation);//将 animation 对象添加到显示列表。\r\n\t*}\r\n*\r\n*@example\r\n*import Animation=laya.display.Animation;\r\n*class Animation_Example {\r\n\t*constructor(){\r\n\t\t*Laya.init(640,800);//设置游戏画布宽高、渲染模式。\r\n\t\t*Laya.stage.bgColor=\"#efefef\";//设置画布的背景颜色。\r\n\t\t*this.init();\r\n\t\t*}\r\n\t*private init():void {\r\n\t\t*var animation:Animation=new Laya.Animation();//创建一个 Animation 类的实例对象 animation 。\r\n\t\t*animation.loadAtlas(\"resource/ani/fighter.json\");//加载图集并播放\r\n\t\t*animation.x=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t\t*animation.y=200;//设置 animation 对象的属性 x 的值，用于控制 animation 对象的显示位置。\r\n\t\t*animation.interval=50;//设置 animation 对象的动画播放间隔时间，单位：毫秒。\r\n\t\t*animation.play();//播放动画。\r\n\t\t*Laya.stage.addChild(animation);//将 animation 对象添加到显示列表。\r\n\t\t*}\r\n\t*}\r\n*new Animation_Example();\r\n*/\r\n//class laya.display.Animation extends laya.display.AnimationPlayerBase\r\nvar Animation=(function(_super){\r\n\tfunction Animation(){\r\n\t\t/**@private */\r\n\t\tthis._frames=null;\r\n\t\t/**@private */\r\n\t\tthis._url=null;\r\n\t\tAnimation.__super.call(this);\r\n\t\tthis._setControlNode(this);\r\n\t}\r\n\r\n\t__class(Animation,'laya.display.Animation',_super);\r\n\tvar __proto=Animation.prototype;\r\n\t/**@inheritDoc */\r\n\t__proto.destroy=function(destroyChild){\r\n\t\t(destroyChild===void 0)&& (destroyChild=true);\r\n\t\tthis.stop();\r\n\t\tlaya.display.Sprite.prototype.destroy.call(this,destroyChild);\r\n\t\tthis._frames=null;\r\n\t\tthis._labels=null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>开始播放动画。会在动画模版缓存池中查找key值为name的动画模版，存在则用此动画模版初始化当前序列帧， 如果不存在，则使用当前序列帧。</p>\r\n\t*<p>play(...)方法被设计为在创建实例后的任何时候都可以被调用，调用后就处于播放状态，当相应的资源加载完毕、调用动画帧填充方法(set frames)或者将实例显示在舞台上时，会判断是否处于播放状态，如果是，则开始播放。</p>\r\n\t*<p>配合wrapMode属性，可设置动画播放顺序类型。</p>\r\n\t*@param start （可选）指定动画播放开始的索引(int)或帧标签(String)。帧标签可以通过addLabel(...)和removeLabel(...)进行添加和删除。\r\n\t*@param loop （可选）是否循环播放。\r\n\t*@param name （可选）动画模板在动画模版缓存池中的key，也可认为是动画名称。如果name为空，则播放当前动画序列帧；如果不为空，则在动画模版缓存池中寻找key值为name的动画模版，如果存在则用此动画模版初始化当前序列帧并播放，如果不存在，则仍然播放当前动画序列帧；如果没有当前动画的帧数据，则不播放，但该实例仍然处于播放状态。\r\n\t*@param showWarn（可选）是否动画不存在时打印警告\r\n\t*/\r\n\t__proto.play=function(start,loop,name,showWarn){\r\n\t\t(start===void 0)&& (start=0);\r\n\t\t(loop===void 0)&& (loop=true);\r\n\t\t(name===void 0)&& (name=\"\");\r\n\t\t(showWarn===void 0)&& (showWarn=true);\r\n\t\tif (name)this._setFramesFromCache(name,showWarn);\r\n\t\tthis._isPlaying=true;\r\n\t\tthis.index=((typeof start=='string'))? this._getFrameByLabel(start):start;\r\n\t\tthis.loop=loop;\r\n\t\tthis._actionName=name;\r\n\t\tthis._isReverse=this.wrapMode==1;\r\n\t\tif (this._frames && this.interval > 0){\r\n\t\t\tthis.timerLoop(this.interval,this,this._frameLoop,null,true,true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._setFramesFromCache=function(name,showWarn){\r\n\t\t(showWarn===void 0)&& (showWarn=false);\r\n\t\tif (this._url)name=this._url+\"#\"+name;\r\n\t\tif (name && Animation.framesMap[name]){\r\n\t\t\tvar tAniO;\r\n\t\t\ttAniO=Animation.framesMap[name];\r\n\t\t\tif ((tAniO instanceof Array)){\r\n\t\t\t\tthis._frames=Animation.framesMap[name];\r\n\t\t\t\tthis._count=this._frames.length;\r\n\t\t\t\t}else {\r\n\t\t\t\tif (tAniO.nodeRoot){\r\n\t\t\t\t\tAnimation.framesMap[name]=this._parseGraphicAnimationByData(tAniO);\r\n\t\t\t\t\ttAniO=Animation.framesMap[name];\r\n\t\t\t\t}\r\n\t\t\t\tthis._frames=tAniO.frames;\r\n\t\t\t\tthis._count=this._frames.length;\r\n\t\t\t\tif (!this._frameRateChanged)this._interval=tAniO.interval;\r\n\t\t\t\tthis._labels=this._copyLabels(tAniO.labels);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t\t}else {\r\n\t\t\tif (showWarn)console.log(\"ani not found:\",name);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._copyLabels=function(labels){\r\n\t\tif (!labels)return null;\r\n\t\tvar rst;\r\n\t\trst={};\r\n\t\tvar key;\r\n\t\tfor (key in labels){\r\n\t\t\trst[key]=Utils.copyArray([],labels[key]);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._frameLoop=function(){\r\n\t\tif (this._style.visible && this._style.alpha > 0.01){\r\n\t\t\t_super.prototype._frameLoop.call(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._displayToIndex=function(value){\r\n\t\tif (this._frames)this.graphics=this._frames[value];\r\n\t}\r\n\r\n\t/**\r\n\t*停止动画播放，并清理对象属性。之后可存入对象池，方便对象复用。\r\n\t*/\r\n\t__proto.clear=function(){\r\n\t\tthis.stop();\r\n\t\tthis.graphics=null;\r\n\t\tthis._frames=null;\r\n\t\tthis._labels=null;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>根据指定的动画模版初始化当前动画序列帧。选择动画模版的过程如下：1. 动画模版缓存池中key为cacheName的动画模版；2. 如果不存在，则加载指定的图片集合并创建动画模版。注意：只有指定不为空的cacheName，才能将创建好的动画模版以此为key缓存到动画模版缓存池，否则不进行缓存。</p>\r\n\t*<p>动画模版缓存池是以一定的内存开销来节省CPU开销，当相同的动画模版被多次使用时，相比于每次都创建新的动画模版，使用动画模版缓存池，只需创建一次，缓存之后多次复用，从而节省了动画模版创建的开销。</p>\r\n\t*<p>因为返回值为Animation对象本身，所以可以使用如下语法：ani.loadImages(...).loadImages(...).play(...);。</p>\r\n\t*@param urls 图片路径集合。需要创建动画模版时，会以此为数据源。参数形如：[url1,url2,url3,...]。\r\n\t*@param cacheName （可选）动画模板在动画模版缓存池中的key。如果此参数不为空，表示使用动画模版缓存池。如果动画模版缓存池中存在key为cacheName的动画模版，则使用此模版。否则，创建新的动画模版，如果cacheName不为空，则以cacheName为key缓存到动画模版缓存池中，如果cacheName为空，不进行缓存。\r\n\t*@return 返回Animation对象本身。\r\n\t*/\r\n\t__proto.loadImages=function(urls,cacheName){\r\n\t\t(cacheName===void 0)&& (cacheName=\"\");\r\n\t\tthis._url=\"\";\r\n\t\tif (!this._setFramesFromCache(cacheName)){\r\n\t\t\tthis.frames=Animation.framesMap[cacheName] ? Animation.framesMap[cacheName] :Animation.createFrames(urls,cacheName);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>根据指定的动画模版初始化当前动画序列帧。选择动画模版的过程如下：1. 动画模版缓存池中key为cacheName的动画模版；2. 如果不存在，则加载指定的图集并创建动画模版。</p>\r\n\t*<p>注意：只有指定不为空的cacheName，才能将创建好的动画模版以此为key缓存到动画模版缓存池，否则不进行缓存。</p>\r\n\t*<p>动画模版缓存池是以一定的内存开销来节省CPU开销，当相同的动画模版被多次使用时，相比于每次都创建新的动画模版，使用动画模版缓存池，只需创建一次，缓存之后多次复用，从而节省了动画模版创建的开销。</p>\r\n\t*<p>因为返回值为Animation对象本身，所以可以使用如下语法：ani.loadAtlas(...).loadAtlas(...).play(...);。</p>\r\n\t*@param url 图集路径。需要创建动画模版时，会以此为数据源。\r\n\t*@param loaded （可选）使用指定图集初始化动画完毕的回调。\r\n\t*@param cacheName （可选）动画模板在动画模版缓存池中的key。如果此参数不为空，表示使用动画模版缓存池。如果动画模版缓存池中存在key为cacheName的动画模版，则使用此模版。否则，创建新的动画模版，如果cacheName不为空，则以cacheName为key缓存到动画模版缓存池中，如果cacheName为空，不进行缓存。\r\n\t*@return 返回动画本身。\r\n\t*/\r\n\t__proto.loadAtlas=function(url,loaded,cacheName){\r\n\t\t(cacheName===void 0)&& (cacheName=\"\");\r\n\t\tthis._url=\"\";\r\n\t\tvar _this_=this;\r\n\t\tfunction onLoaded (loadUrl){\r\n\t\t\tif (url===loadUrl){\r\n\t\t\t\t_this_.frames=Animation.framesMap[cacheName] ? Animation.framesMap[cacheName] :Animation.createFrames(url,cacheName);\r\n\t\t\t\tif (loaded)loaded.run();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!_this_._setFramesFromCache(cacheName)){\r\n\t\t\tif (Loader.getAtlas(url))onLoaded(url);\r\n\t\t\telse Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,/*laya.net.Loader.ATLAS*/\"atlas\");\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t*<p>加载并解析由LayaAir IDE制作的动画文件，此文件中可能包含多个动画。默认帧率为在IDE中设计的帧率，如果调用过set interval，则使用此帧间隔对应的帧率。加载后创建动画模版，并缓存到动画模版缓存池，key \"url#动画名称\" 对应相应动画名称的动画模板，key \"url#\" 对应动画模版集合的默认动画模版。</p>\r\n\t*<p>注意：如果调用本方法前，还没有预加载动画使用的图集，请将atlas参数指定为对应的图集路径，否则会导致动画创建失败。</p>\r\n\t*<p>动画模版缓存池是以一定的内存开销来节省CPU开销，当相同的动画模版被多次使用时，相比于每次都创建新的动画模版，使用动画模版缓存池，只需创建一次，缓存之后多次复用，从而节省了动画模版创建的开销。</p>\r\n\t*<p>因为返回值为Animation对象本身，所以可以使用如下语法：ani.loadAnimation(...).loadAnimation(...).play(...);。</p>\r\n\t*@param url 动画文件路径。可由LayaAir IDE创建并发布。\r\n\t*@param loaded （可选）使用指定动画资源初始化动画完毕的回调。\r\n\t*@param atlas （可选）动画用到的图集地址（可选）。\r\n\t*@return 返回动画本身。\r\n\t*/\r\n\t__proto.loadAnimation=function(url,loaded,atlas){\r\n\t\tthis._url=url;\r\n\t\tvar _this_=this;\r\n\t\tif (!this._actionName)this._actionName=\"\";\r\n\t\tif (!_this_._setFramesFromCache(\"\")){\r\n\t\t\tif (!atlas || Loader.getAtlas(atlas)){\r\n\t\t\t\tthis._loadAnimationData(url,loaded,atlas);\r\n\t\t\t\t}else {\r\n\t\t\t\tLaya.loader.load(atlas,Handler.create(this,this._loadAnimationData,[url,loaded,atlas]),null,/*laya.net.Loader.ATLAS*/\"atlas\")\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\t_this_._setFramesFromCache(this._actionName,true);\r\n\t\t\tthis.index=0;\r\n\t\t\tif (loaded)loaded.run();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._loadAnimationData=function(url,loaded,atlas){\r\n\t\tvar _$this=this;\r\n\t\tif (atlas && !Loader.getAtlas(atlas)){\r\n\t\t\tconsole.warn(\"atlas load fail:\"+atlas);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar _this_=this;\r\n\t\tfunction onLoaded (loadUrl){\r\n\t\t\tif (!Loader.getRes(loadUrl))return;\r\n\t\t\tif (url===loadUrl){\r\n\t\t\t\tvar tAniO;\r\n\t\t\t\tif (!Animation.framesMap[url+\"#\"]){\r\n\t\t\t\t\tvar aniData=_this_._parseGraphicAnimation(Loader.getRes(url));\r\n\t\t\t\t\tif (!aniData)return;\r\n\t\t\t\t\tvar aniList=aniData.animationList;\r\n\t\t\t\t\tvar i=0,len=aniList.length;\r\n\t\t\t\t\tvar defaultO;\r\n\t\t\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\t\t\ttAniO=aniList[i];\r\n\t\t\t\t\t\tAnimation.framesMap[url+\"#\"+tAniO.name]=tAniO;\r\n\t\t\t\t\t\tif (!defaultO)defaultO=tAniO;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultO){\r\n\t\t\t\t\t\tAnimation.framesMap[url+\"#\"]=defaultO;\r\n\t\t\t\t\t\t_this_._setFramesFromCache(_$this._actionName,true);\r\n\t\t\t\t\t\t_$this.index=0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_$this._checkResumePlaying();\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t_this_._setFramesFromCache(_$this._actionName,true);\r\n\t\t\t\t\t_$this.index=0;\r\n\t\t\t\t\t_$this._checkResumePlaying();\r\n\t\t\t\t}\r\n\t\t\t\tif (loaded)loaded.run();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Loader.getRes(url))onLoaded(url);\r\n\t\telse Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,/*laya.net.Loader.JSON*/\"json\");\r\n\t\tLoader.clearRes(url);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._parseGraphicAnimation=function(animationData){\r\n\t\treturn GraphicAnimation.parseAnimationData(animationData);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._parseGraphicAnimationByData=function(animationObject){\r\n\t\treturn GraphicAnimation.parseAnimationByData(animationObject);\r\n\t}\r\n\r\n\t/**\r\n\t*当前动画的帧图像数组。本类中，每个帧图像是一个Graphics对象，而动画播放就是定时切换Graphics对象的过程。\r\n\t*/\r\n\t__getset(0,__proto,'frames',function(){\r\n\t\treturn this._frames;\r\n\t\t},function(value){\r\n\t\tthis._frames=value;\r\n\t\tif (value){\r\n\t\t\tthis._count=value.length;\r\n\t\t\tif (this._isPlaying)this.play(this._index,this.loop,this._actionName);\r\n\t\t\telse this.index=this._index;\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*是否自动播放，默认为false。如果设置为true，则动画被创建并添加到舞台后自动播放。\r\n\t*/\r\n\t__getset(0,__proto,'autoPlay',null,function(value){\r\n\t\tif (value)this.play();\r\n\t\telse this.stop();\r\n\t});\r\n\r\n\t/**\r\n\t*<p>动画数据源。</p>\r\n\t*<p>类型如下：<br/>\r\n\t*1. LayaAir IDE动画文件路径：使用此类型需要预加载所需的图集资源，否则会创建失败，如果不想预加载或者需要创建完毕的回调，请使用loadAnimation(...)方法；<br/>\r\n\t*2. 图集路径：使用此类型创建的动画模版不会被缓存到动画模版缓存池中，如果需要缓存或者创建完毕的回调，请使用loadAtlas(...)方法；<br/>\r\n\t*3. 图片路径集合：使用此类型创建的动画模版不会被缓存到动画模版缓存池中，如果需要缓存，请使用loadImages(...)方法。</p>\r\n\t*@param value 数据源。比如：图集：\"xx/a1.atlas\"；图片集合：\"a1.png,a2.png,a3.png\"；LayaAir IDE动画\"xx/a1.ani\"。\r\n\t*/\r\n\t__getset(0,__proto,'source',null,function(value){\r\n\t\tif (value.indexOf(\".ani\")>-1)this.loadAnimation(value);\r\n\t\telse if (value.indexOf(\".json\")>-1 || value.indexOf(\"als\")>-1 || value.indexOf(\"atlas\")>-1)this.loadAtlas(value);\r\n\t\telse this.loadImages(value.split(\",\"));\r\n\t});\r\n\r\n\t/**\r\n\t*设置自动播放的动画名称，在LayaAir IDE中可以创建的多个动画组成的动画集合，选择其中一个动画名称进行播放。\r\n\t*/\r\n\t__getset(0,__proto,'autoAnimation',null,function(value){\r\n\t\tthis.play(0,true,value,false);\r\n\t});\r\n\r\n\tAnimation.createFrames=function(url,name){\r\n\t\tvar arr,i=0,n=0,g;\r\n\t\tif ((typeof url=='string')){\r\n\t\t\tvar atlas=Loader.getAtlas(url);\r\n\t\t\tif (atlas && atlas.length){\r\n\t\t\t\tarr=[];\r\n\t\t\t\tfor (i=0,n=atlas.length;i < n;i++){\r\n\t\t\t\t\tg=new RunDriver.createGraphics();\r\n\t\t\t\t\tg.drawTexture(Loader.getRes(atlas[i]),0,0);\r\n\t\t\t\t\tarr.push(g);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else if ((url instanceof Array)){\r\n\t\t\tarr=[];\r\n\t\t\tfor (i=0,n=url.length;i < n;i++){\r\n\t\t\t\tg=new RunDriver.createGraphics();\r\n\t\t\t\tg.loadImage(url[i],0,0);\r\n\t\t\t\tarr.push(g);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (name)Animation.framesMap[name]=arr;\r\n\t\treturn arr;\r\n\t}\r\n\r\n\tAnimation.clearCache=function(key){\r\n\t\tvar cache=Animation.framesMap;\r\n\t\tvar val;\r\n\t\tvar key2=key+\"#\";\r\n\t\tfor (val in cache){\r\n\t\t\tif (val===key || val.indexOf(key2)==0){\r\n\t\t\t\tdelete Animation.framesMap[val];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tAnimation.framesMap={};\r\n\treturn Animation;\r\n})(AnimationPlayerBase)\r\n\r\n\r\n/**\r\n*关键帧动画播放类。\r\n*/\r\n//class laya.display.FrameAnimation extends laya.display.AnimationPlayerBase\r\nvar FrameAnimation=(function(_super){\r\n\tfunction FrameAnimation(){\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*id对象表\r\n\t\t*/\r\n\t\tthis._targetDic=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*动画数据\r\n\t\t*/\r\n\t\tthis._animationData=null;\r\n\t\t/**@private */\r\n\t\tthis._animationNewFrames=null;\r\n\t\tFrameAnimation.__super.call(this);\r\n\t\tif (FrameAnimation._sortIndexFun==null){\r\n\t\t\tFrameAnimation._sortIndexFun=MathUtil.sortByKey(\"index\",false,true);\r\n\t\t}\r\n\t}\r\n\r\n\t__class(FrameAnimation,'laya.display.FrameAnimation',_super);\r\n\tvar __proto=FrameAnimation.prototype;\r\n\t/**\r\n\t*@private\r\n\t*初始化动画数据\r\n\t*@param targetDic 对象表\r\n\t*@param animationData 动画数据\r\n\t*\r\n\t*/\r\n\t__proto._setUp=function(targetDic,animationData){\r\n\t\tthis._labels=null;\r\n\t\tthis._animationNewFrames=null;\r\n\t\tthis._targetDic=targetDic;\r\n\t\tthis._animationData=animationData;\r\n\t\tthis.interval=1000 / animationData.frameRate;\r\n\t\tif (animationData.parsed){\r\n\t\t\tthis._count=animationData.count;\r\n\t\t\tthis._labels=animationData.labels;\r\n\t\t\tthis._animationNewFrames=animationData.animationNewFrames;\r\n\t\t\t}else {\r\n\t\t\tthis._animationNewFrames=[];\r\n\t\t\tthis._calculateDatas();\r\n\t\t}\r\n\t\tanimationData.parsed=true;\r\n\t\tanimationData.labels=this._labels;\r\n\t\tanimationData.count=this._count;\r\n\t\tanimationData.animationNewFrames=this._animationNewFrames;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto.clear=function(){\r\n\t\t_super.prototype.clear.call(this);\r\n\t\tthis._targetDic=null;\r\n\t\tthis._animationData=null;\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__proto._displayToIndex=function(value){\r\n\t\tif (!this._animationData)return;\r\n\t\tif (value < 0)value=0;\r\n\t\tif (value > this._count)value=this._count;\r\n\t\tvar nodes=this._animationData.nodes,i=0,len=nodes.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._displayNodeToFrame(nodes[i],value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*将节点设置到某一帧的状态\r\n\t*@param node 节点ID\r\n\t*@param frame\r\n\t*@param targetDic 节点表\r\n\t*\r\n\t*/\r\n\t__proto._displayNodeToFrame=function(node,frame,targetDic){\r\n\t\tif (!targetDic)targetDic=this._targetDic;\r\n\t\tvar target=targetDic[node.target];\r\n\t\tif (!target){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar frames=node.frames,key,propFrames,value;\r\n\t\tvar keys=node.keys,i=0,len=keys.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=keys[i];\r\n\t\t\tpropFrames=frames[key];\r\n\t\t\tif (propFrames.length > frame){\r\n\t\t\t\tvalue=propFrames[frame];\r\n\t\t\t\t}else {\r\n\t\t\t\tvalue=propFrames[propFrames.length-1];\r\n\t\t\t}\r\n\t\t\ttarget[key]=value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*计算帧数据\r\n\t*\r\n\t*/\r\n\t__proto._calculateDatas=function(){\r\n\t\tif (!this._animationData)return;\r\n\t\tvar nodes=this._animationData.nodes,i=0,len=nodes.length,tNode;\r\n\t\tthis._count=0;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttNode=nodes[i];\r\n\t\t\tthis._calculateNodeKeyFrames(tNode);\r\n\t\t}\r\n\t\tthis._count+=1;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*计算某个节点的帧数据\r\n\t*@param node\r\n\t*\r\n\t*/\r\n\t__proto._calculateNodeKeyFrames=function(node){\r\n\t\tvar keyFrames=node.keyframes,key,tKeyFrames,target=node.target;\r\n\t\tif (!node.frames){\r\n\t\t\tnode.frames={};\r\n\t\t}\r\n\t\tif (!node.keys){\r\n\t\t\tnode.keys=[];\r\n\t\t\t}else {\r\n\t\t\tnode.keys.length=0;\r\n\t\t}\r\n\t\tif (!node.initValues){\r\n\t\t\tnode.initValues={};\r\n\t\t}\r\n\t\tfor (key in keyFrames){\r\n\t\t\ttKeyFrames=keyFrames[key];\r\n\t\t\tif (!node.frames[key]){\r\n\t\t\t\tnode.frames[key]=[];\r\n\t\t\t}\r\n\t\t\tif (this._targetDic && this._targetDic[target]){\r\n\t\t\t\tnode.initValues[key]=this._targetDic[target][key];\r\n\t\t\t}\r\n\t\t\ttKeyFrames.sort(FrameAnimation._sortIndexFun);\r\n\t\t\tnode.keys.push(key);\r\n\t\t\tthis._calculateNodePropFrames(tKeyFrames,node.frames[key],key,target);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*将动画控制对象还原到动画控制之前的状态\r\n\t*/\r\n\t__proto.resetToInitState=function(){\r\n\t\tif (!this._targetDic)return;\r\n\t\tif (!this._animationData)return;\r\n\t\tvar nodes=this._animationData.nodes,i=0,len=nodes.length;\r\n\t\tvar tNode;\r\n\t\tvar initValues;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\ttNode=nodes[i];\r\n\t\t\tinitValues=tNode.initValues;\r\n\t\t\tif (!initValues)continue ;\r\n\t\t\tvar target=this._targetDic[tNode.target];\r\n\t\t\tif (!target)continue ;\r\n\t\t\tvar key;\r\n\t\t\tfor (key in initValues){\r\n\t\t\t\ttarget[key]=initValues[key];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*计算节点某个属性的帧数据\r\n\t*@param keyframes\r\n\t*@param frames\r\n\t*@param key\r\n\t*@param target\r\n\t*\r\n\t*/\r\n\t__proto._calculateNodePropFrames=function(keyframes,frames,key,target){\r\n\t\tvar i=0,len=keyframes.length-1;\r\n\t\tframes.length=keyframes[len].index+1;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._dealKeyFrame(keyframes[i]);\r\n\t\t\tthis._calculateFrameValues(keyframes[i],keyframes[i+1],frames);\r\n\t\t}\r\n\t\tif (len==0){\r\n\t\t\tframes[0]=keyframes[0].value;\r\n\t\t\tif (this._animationNewFrames)\r\n\t\t\t\tthis._animationNewFrames[keyframes[0].index]=true;\r\n\t\t}\r\n\t\tthis._dealKeyFrame(keyframes[i]);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*\r\n\t*/\r\n\t__proto._dealKeyFrame=function(keyFrame){\r\n\t\tif (keyFrame.label && keyFrame.label !=\"\")this.addLabel(keyFrame.label,keyFrame.index);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*计算两个关键帧直接的帧数据\r\n\t*@param startFrame\r\n\t*@param endFrame\r\n\t*@param result\r\n\t*\r\n\t*/\r\n\t__proto._calculateFrameValues=function(startFrame,endFrame,result){\r\n\t\tvar i=0,easeFun;\r\n\t\tvar start=startFrame.index,end=endFrame.index;\r\n\t\tvar startValue=startFrame.value;\r\n\t\tvar dValue=endFrame.value-startFrame.value;\r\n\t\tvar dLen=end-start;\r\n\t\tif (end > this._count)this._count=end;\r\n\t\tif (startFrame.tween){\r\n\t\t\teaseFun=Ease[startFrame.tweenMethod];\r\n\t\t\tif (easeFun==null){\r\n\t\t\t\teaseFun=Ease.linearNone;\r\n\t\t\t}\r\n\t\t\tfor (i=start;i < end;i++){\r\n\t\t\t\tresult[i]=easeFun(i-start,startValue,dValue,dLen);\r\n\t\t\t\tif (this._animationNewFrames){\r\n\t\t\t\t\tthis._animationNewFrames[i]=true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tfor (i=start;i < end;i++){\r\n\t\t\t\tresult[i]=startValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._animationNewFrames){\r\n\t\t\tthis._animationNewFrames[startFrame.index]=true;\r\n\t\t\tthis._animationNewFrames[endFrame.index]=true;\r\n\t\t}\r\n\t\tresult[endFrame.index]=endFrame.value;\r\n\t}\r\n\r\n\tFrameAnimation._sortIndexFun=null;\r\n\treturn FrameAnimation;\r\n})(AnimationPlayerBase)\r\n\r\n\r\n/**\r\n*<p><code>Input</code> 类用于创建显示对象以显示和输入文本。</p>\r\n*<p>Input 类封装了原生的文本输入框，由于不同浏览器的差异，会导致此对象的默认文本的位置与用户点击输入时的文本的位置有少许的偏差。</p>\r\n*/\r\n//class laya.display.Input extends laya.display.Text\r\nvar Input=(function(_super){\r\n\tfunction Input(){\r\n\t\t/**@private */\r\n\t\tthis._focus=false;\r\n\t\t/**@private */\r\n\t\tthis._multiline=false;\r\n\t\t/**@private */\r\n\t\tthis._editable=true;\r\n\t\t/**@private */\r\n\t\tthis._restrictPattern=null;\r\n\t\tthis._type=\"text\";\r\n\t\t/**输入提示符。*/\r\n\t\tthis._prompt='';\r\n\t\t/**输入提示符颜色。*/\r\n\t\tthis._promptColor=\"#A9A9A9\";\r\n\t\tthis._originColor=\"#000000\";\r\n\t\tthis._content='';\r\n\t\tInput.__super.call(this);\r\n\t\tthis._maxChars=1E5;\r\n\t\tthis._width=100;\r\n\t\tthis._height=20;\r\n\t\tthis.multiline=false;\r\n\t\tthis.overflow=Text.SCROLL;\r\n\t\tthis.on(/*laya.events.Event.MOUSE_DOWN*/\"mousedown\",this,this._onMouseDown);\r\n\t\tthis.on(/*laya.events.Event.UNDISPLAY*/\"undisplay\",this,this._onUnDisplay);\r\n\t}\r\n\r\n\t__class(Input,'laya.display.Input',_super);\r\n\tvar __proto=Input.prototype;\r\n\t/**\r\n\t*设置光标位置和选取字符。\r\n\t*@param startIndex 光标起始位置。\r\n\t*@param endIndex 光标结束位置。\r\n\t*/\r\n\t__proto.setSelection=function(startIndex,endIndex){\r\n\t\tthis.focus=true;\r\n\t\tlaya.display.Input.inputElement.selectionStart=startIndex;\r\n\t\tlaya.display.Input.inputElement.selectionEnd=endIndex;\r\n\t}\r\n\r\n\t__proto._onUnDisplay=function(e){\r\n\t\tthis.focus=false;\r\n\t}\r\n\r\n\t__proto._onMouseDown=function(e){\r\n\t\tthis.focus=true;\r\n\t}\r\n\r\n\t/**\r\n\t*在输入期间，如果 Input 实例的位置改变，调用_syncInputTransform同步输入框的位置。\r\n\t*/\r\n\t__proto._syncInputTransform=function(){\r\n\t\tvar inputElement=this.nativeInput;\r\n\t\tvar transform=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]);\r\n\t\tvar inputWid=this._width-this.padding[1]-this.padding[3];\r\n\t\tvar inputHei=this._height-this.padding[0]-this.padding[2];\r\n\t\tif (Render.isConchApp){\r\n\t\t\tinputElement.setScale(transform.scaleX,transform.scaleY);\r\n\t\t\tinputElement.setSize(inputWid,inputHei);\r\n\t\t\tinputElement.setPos(transform.x,transform.y);\r\n\t\t\t}else {\r\n\t\t\tInput.inputContainer.style.transform=Input.inputContainer.style.webkitTransform=\"scale(\"+transform.scaleX+\",\"+transform.scaleY+\") rotate(\"+(Laya.stage.canvasDegree)+\"deg)\";\r\n\t\t\tinputElement.style.width=inputWid+'px';\r\n\t\t\tinputElement.style.height=inputHei+'px';\r\n\t\t\tInput.inputContainer.style.left=transform.x+'px';\r\n\t\t\tInput.inputContainer.style.top=transform.y+'px';\r\n\t\t}\r\n\t}\r\n\r\n\t/**选中当前实例的所有文本。*/\r\n\t__proto.select=function(){\r\n\t\tthis.nativeInput.select();\r\n\t}\r\n\r\n\t__proto._setInputMethod=function(){\r\n\t\tInput.input.parentElement && (Input.inputContainer.removeChild(Input.input));\r\n\t\tInput.area.parentElement && (Input.inputContainer.removeChild(Input.area));\r\n\t\tInput.inputElement=(this._multiline ? Input.area :Input.input);\r\n\t\tInput.inputContainer.appendChild(Input.inputElement);\r\n\t\tif (Text.RightToLeft){\r\n\t\t\tInput.inputElement.style.direction=\"rtl\";\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._focusIn=function(){\r\n\t\tlaya.display.Input.isInputting=true;\r\n\t\tvar input=this.nativeInput;\r\n\t\tthis._focus=true;\r\n\t\tvar cssStyle=input.style;\r\n\t\tcssStyle.whiteSpace=(this.wordWrap ? \"pre-wrap\" :\"nowrap\");\r\n\t\tthis._setPromptColor();\r\n\t\tinput.readOnly=!this._editable;\r\n\t\tif (Render.isConchApp){\r\n\t\t\tinput.setType(this._type);\r\n\t\t\tinput.setForbidEdit(!this._editable);\r\n\t\t}\r\n\t\tinput.maxLength=this._maxChars;\r\n\t\tvar padding=this.padding;\r\n\t\tinput.type=this._type;\r\n\t\tinput.value=this._content;\r\n\t\tinput.placeholder=this._prompt;\r\n\t\tLaya.stage.off(/*laya.events.Event.KEY_DOWN*/\"keydown\",this,this._onKeyDown);\r\n\t\tLaya.stage.on(/*laya.events.Event.KEY_DOWN*/\"keydown\",this,this._onKeyDown);\r\n\t\tLaya.stage.focus=this;\r\n\t\tthis.event(/*laya.events.Event.FOCUS*/\"focus\");\r\n\t\tif (Browser.onPC)input.focus();\r\n\t\tif(!Browser.onMiniGame){\r\n\t\t\tvar temp=this._text;\r\n\t\t\tthis._text=null;\r\n\t\t}\r\n\t\tthis.typeset();\r\n\t\tinput.setColor(this._originColor);\r\n\t\tinput.setFontSize(this.fontSize);\r\n\t\tinput.setFontFace(Browser.onIPhone ? (Text._fontFamilyMap[this.font] || this.font):this.font);\r\n\t\tif (Render.isConchApp){\r\n\t\t\tinput.setMultiAble && input.setMultiAble(this._multiline);\r\n\t\t}\r\n\t\tcssStyle.lineHeight=(this.leading+this.fontSize)+\"px\";\r\n\t\tcssStyle.fontStyle=(this.italic ? \"italic\" :\"normal\");\r\n\t\tcssStyle.fontWeight=(this.bold ? \"bold\" :\"normal\");\r\n\t\tcssStyle.textAlign=this.align;\r\n\t\tcssStyle.padding=\"0 0\";\r\n\t\tthis._syncInputTransform();\r\n\t\tif (!Render.isConchApp && Browser.onPC)\r\n\t\t\tLaya.timer.frameLoop(1,this,this._syncInputTransform);\r\n\t}\r\n\r\n\t// 设置DOM输入框提示符颜色。\r\n\t__proto._setPromptColor=function(){\r\n\t\tInput.promptStyleDOM=Browser.getElementById(\"promptStyle\");\r\n\t\tif (!Input.promptStyleDOM){\r\n\t\t\tInput.promptStyleDOM=Browser.createElement(\"style\");\r\n\t\t\tInput.promptStyleDOM.setAttribute(\"id\",\"promptStyle\");\r\n\t\t\tBrowser.document.head.appendChild(Input.promptStyleDOM);\r\n\t\t}\r\n\t\tInput.promptStyleDOM.innerText=\"input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {\"+\"color:\"+this._promptColor+\"}\"+\"input:-moz-placeholder, textarea:-moz-placeholder {\"+\"color:\"+this._promptColor+\"}\"+\"input::-moz-placeholder, textarea::-moz-placeholder {\"+\"color:\"+this._promptColor+\"}\"+\"input:-ms-input-placeholder, textarea:-ms-input-placeholder {\"+\"color:\"+this._promptColor+\"}\";\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._focusOut=function(){\r\n\t\tlaya.display.Input.isInputting=false;\r\n\t\tthis._focus=false;\r\n\t\tthis._text=null;\r\n\t\tthis._content=this.nativeInput.value;\r\n\t\tif (!this._content){\r\n\t\t\tLaya.superSet(Text,this,'text',this._prompt);\r\n\t\t\tLaya.superSet(Text,this,'color',this._promptColor);\r\n\t\t\t}else {\r\n\t\t\tLaya.superSet(Text,this,'text',this._content);\r\n\t\t\tLaya.superSet(Text,this,'color',this._originColor);\r\n\t\t}\r\n\t\tLaya.stage.off(/*laya.events.Event.KEY_DOWN*/\"keydown\",this,this._onKeyDown);\r\n\t\tLaya.stage.focus=null;\r\n\t\tthis.event(/*laya.events.Event.BLUR*/\"blur\");\r\n\t\tif (Render.isConchApp)this.nativeInput.blur();\r\n\t\tBrowser.onPC && Laya.timer.clear(this,this._syncInputTransform);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onKeyDown=function(e){\r\n\t\tif (e.keyCode===13){\r\n\t\t\tif (Browser.onMobile && !this._multiline)\r\n\t\t\t\tthis.focus=false;\r\n\t\t\tthis.event(/*laya.events.Event.ENTER*/\"enter\");\r\n\t\t}\r\n\t}\r\n\r\n\t__proto.changeText=function(text){\r\n\t\tthis._content=text;\r\n\t\tif (this._focus){\r\n\t\t\tthis.nativeInput.value=text || '';\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t}else\r\n\t\t_super.prototype.changeText.call(this,text);\r\n\t}\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'color',_super.prototype._$get_color,function(value){\r\n\t\tif (this._focus)\r\n\t\t\tthis.nativeInput.setColor(value);\r\n\t\tLaya.superSet(Text,this,'color',this._content?value:this._promptColor);\r\n\t\tthis._originColor=value;\r\n\t});\r\n\r\n\t//[Deprecated]\r\n\t__getset(0,__proto,'inputElementYAdjuster',function(){\r\n\t\tconsole.warn(\"deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。\");\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tconsole.warn(\"deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。\");\r\n\t});\r\n\r\n\t/**表示是否是多行输入框。*/\r\n\t__getset(0,__proto,'multiline',function(){\r\n\t\treturn this._multiline;\r\n\t\t},function(value){\r\n\t\tthis._multiline=value;\r\n\t\tthis.valign=value ? \"top\" :\"middle\";\r\n\t});\r\n\r\n\t/**\r\n\t*<p>字符数量限制，默认为10000。</p>\r\n\t*<p>设置字符数量限制时，小于等于0的值将会限制字符数量为10000。</p>\r\n\t*/\r\n\t__getset(0,__proto,'maxChars',function(){\r\n\t\treturn this._maxChars;\r\n\t\t},function(value){\r\n\t\tif (value <=0)\r\n\t\t\tvalue=1E5;\r\n\t\tthis._maxChars=value;\r\n\t});\r\n\r\n\t/**@inheritDoc */\r\n\t__getset(0,__proto,'text',function(){\r\n\t\tif (this._focus)\r\n\t\t\treturn this.nativeInput.value;\r\n\t\telse\r\n\t\treturn this._content || \"\";\r\n\t\t},function(value){\r\n\t\tLaya.superSet(Text,this,'color',this._originColor);\r\n\t\tvalue+='';\r\n\t\tif (this._focus){\r\n\t\t\tthis.nativeInput.value=value || '';\r\n\t\t\tthis.event(/*laya.events.Event.CHANGE*/\"change\");\r\n\t\t\t}else {\r\n\t\t\tif (!this._multiline)\r\n\t\t\t\tvalue=value.replace(/\\r?\\n/g,'');\r\n\t\t\tthis._content=value;\r\n\t\t\tif (value)\r\n\t\t\t\tLaya.superSet(Text,this,'text',value);\r\n\t\t\telse {\r\n\t\t\t\tLaya.superSet(Text,this,'text',this._prompt);\r\n\t\t\t\tLaya.superSet(Text,this,'color',this.promptColor);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*获取对输入框的引用实例。\r\n\t*/\r\n\t__getset(0,__proto,'nativeInput',function(){\r\n\t\treturn this._multiline ? Input.area :Input.input;\r\n\t});\r\n\r\n\t/**\r\n\t*设置输入提示符。\r\n\t*/\r\n\t__getset(0,__proto,'prompt',function(){\r\n\t\treturn this._prompt;\r\n\t\t},function(value){\r\n\t\tif (!this._text && value)\r\n\t\t\tLaya.superSet(Text,this,'color',this._promptColor);\r\n\t\tthis.promptColor=this._promptColor;\r\n\t\tif (this._text)\r\n\t\t\tLaya.superSet(Text,this,'text',(this._text==this._prompt)?value:this._text);\r\n\t\telse\r\n\t\tLaya.superSet(Text,this,'text',value);\r\n\t\tthis._prompt=Text.langPacks && Text.langPacks[value] ? Text.langPacks[value] :value;\r\n\t});\r\n\r\n\t// 因此 调用focus接口是无法都在移动平台立刻弹出键盘的\r\n\t/**\r\n\t*表示焦点是否在此实例上。\r\n\t*/\r\n\t__getset(0,__proto,'focus',function(){\r\n\t\treturn this._focus;\r\n\t\t},function(value){\r\n\t\tvar input=this.nativeInput;\r\n\t\tif (this._focus!==value){\r\n\t\t\tif (value){\r\n\t\t\t\tif (input.target){\r\n\t\t\t\t\tinput.target._focusOut();\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tthis._setInputMethod();\r\n\t\t\t\t}\r\n\t\t\t\tinput.target=this;\r\n\t\t\t\tthis._focusIn();\r\n\t\t\t\t}else {\r\n\t\t\t\tinput.target=null;\r\n\t\t\t\tthis._focusOut();\r\n\t\t\t\tBrowser.document.body.scrollTop=0;\r\n\t\t\t\tinput.blur();\r\n\t\t\t\tif (Render.isConchApp){\r\n\t\t\t\t\tinput.setPos(-10000,-10000);\r\n\t\t\t\t}else if (Input.inputContainer.contains(input))\r\n\t\t\t\tInput.inputContainer.removeChild(input);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**限制输入的字符。*/\r\n\t__getset(0,__proto,'restrict',function(){\r\n\t\tif (this._restrictPattern){\r\n\t\t\treturn this._restrictPattern.source;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t\t},function(pattern){\r\n\t\tif (pattern){\r\n\t\t\tpattern=\"[^\"+pattern+\"]\";\r\n\t\t\tif (pattern.indexOf(\"^^\")>-1)\r\n\t\t\t\tpattern=pattern.replace(\"^^\",\"\");\r\n\t\t\tthis._restrictPattern=new RegExp(pattern,\"g\");\r\n\t\t}else\r\n\t\tthis._restrictPattern=null;\r\n\t});\r\n\r\n\t/**\r\n\t*是否可编辑。\r\n\t*/\r\n\t__getset(0,__proto,'editable',function(){\r\n\t\treturn this._editable;\r\n\t\t},function(value){\r\n\t\tthis._editable=value;\r\n\t\tif (Render.isConchApp){\r\n\t\t\tInput.input.setForbidEdit(!value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置输入提示符颜色。\r\n\t*/\r\n\t__getset(0,__proto,'promptColor',function(){\r\n\t\treturn this._promptColor;\r\n\t\t},function(value){\r\n\t\tthis._promptColor=value;\r\n\t\tif (!this._content)Laya.superSet(Text,this,'color',value);\r\n\t});\r\n\r\n\t/**\r\n\t*<p>输入框类型为Input静态常量之一。</p>\r\n\t*<ul>\r\n\t*<li>TYPE_TEXT</li>\r\n\t*<li>TYPE_PASSWORD</li>\r\n\t*<li>TYPE_EMAIL</li>\r\n\t*<li>TYPE_URL</li>\r\n\t*<li>TYPE_NUMBER</li>\r\n\t*<li>TYPE_RANGE</li>\r\n\t*<li>TYPE_DATE</li>\r\n\t*<li>TYPE_MONTH</li>\r\n\t*<li>TYPE_WEEK</li>\r\n\t*<li>TYPE_TIME</li>\r\n\t*<li>TYPE_DATE_TIME</li>\r\n\t*<li>TYPE_DATE_TIME_LOCAL</li>\r\n\t*</ul>\r\n\t*<p>平台兼容性参见http://www.w3school.com.cn/html5/html_5_form_input_types.asp。</p>\r\n\t*/\r\n\t__getset(0,__proto,'type',function(){\r\n\t\treturn this._type;\r\n\t\t},function(value){\r\n\t\tif (value==\"password\")\r\n\t\t\tthis._getCSSStyle().password=true;\r\n\t\telse\r\n\t\tthis._getCSSStyle().password=false;\r\n\t\tthis._type=value;\r\n\t\tif (Render.isConchApp){\r\n\t\t\tthis.nativeInput.setType(value);\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*<p>原生输入框 X 轴调整值，用来调整输入框坐标。</p>\r\n\t*<p>由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。</p>\r\n\t*@deprecated\r\n\t*/\r\n\t__getset(0,__proto,'inputElementXAdjuster',function(){\r\n\t\tconsole.warn(\"deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。\");\r\n\t\treturn 0;\r\n\t\t},function(value){\r\n\t\tconsole.warn(\"deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。\");\r\n\t});\r\n\r\n\t//[Deprecated(replacement=\"Input.type\")]\r\n\t__getset(0,__proto,'asPassword',function(){\r\n\t\treturn this._getCSSStyle().password;\r\n\t\t},function(value){\r\n\t\tthis._getCSSStyle().password=value;\r\n\t\tthis._type=/*CLASS CONST:laya.display.Input.TYPE_PASSWORD*/\"password\";\r\n\t\tconsole.warn(\"deprecated: 使用type=\\\"password\\\"替代设置asPassword, asPassword将在下次重大更新时删去\");\r\n\t\tthis.isChanged=true;\r\n\t});\r\n\r\n\tInput.__init__=function(){\r\n\t\tInput._createInputElement();\r\n\t\tif (Browser.onMobile)\r\n\t\t\tRender.canvas.addEventListener(Input.IOS_IFRAME ?(Browser.onMiniGame ? \"touchend\" :\"click\"):\"touchend\",Input._popupInputMethod);\r\n\t}\r\n\r\n\tInput._popupInputMethod=function(e){\r\n\t\tif (!laya.display.Input.isInputting)return;\r\n\t\tvar input=laya.display.Input.inputElement;\r\n\t\tinput.focus();\r\n\t}\r\n\r\n\tInput._createInputElement=function(){\r\n\t\tInput._initInput(Input.area=Browser.createElement(\"textarea\"));\r\n\t\tInput._initInput(Input.input=Browser.createElement(\"input\"));\r\n\t\tInput.inputContainer=Browser.createElement(\"div\");\r\n\t\tInput.inputContainer.style.position=\"absolute\";\r\n\t\tInput.inputContainer.style.zIndex=1E5;\r\n\t\tBrowser.container.appendChild(Input.inputContainer);\r\n\t\tInput.inputContainer.setPos=function (x,y){Input.inputContainer.style.left=x+'px';Input.inputContainer.style.top=y+'px';};\r\n\t}\r\n\r\n\tInput._initInput=function(input){\r\n\t\tvar style=input.style;\r\n\t\tstyle.cssText=\"position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;\";\r\n\t\tstyle.resize='none';\r\n\t\tstyle.backgroundColor='transparent';\r\n\t\tstyle.border='none';\r\n\t\tstyle.outline='none';\r\n\t\tstyle.zIndex=1;\r\n\t\tinput.addEventListener('input',Input._processInputting);\r\n\t\tinput.addEventListener('mousemove',Input._stopEvent);\r\n\t\tinput.addEventListener('mousedown',Input._stopEvent);\r\n\t\tinput.addEventListener('touchmove',Input._stopEvent);\r\n\t\tinput.setFontFace=function (fontFace){input.style.fontFamily=fontFace;};\r\n\t\tif(!Render.isConchApp){\r\n\t\t\tinput.setColor=function (color){input.style.color=color;};\r\n\t\t\tinput.setFontSize=function (fontSize){input.style.fontSize=fontSize+'px';};\r\n\t\t}\r\n\t}\r\n\r\n\tInput._processInputting=function(e){\r\n\t\tvar input=laya.display.Input.inputElement.target;\r\n\t\tif (!input)return;\r\n\t\tvar value=laya.display.Input.inputElement.value;\r\n\t\tif (input._restrictPattern){\r\n\t\t\tvalue=value.replace(/\\u2006|\\x27/g,\"\");\r\n\t\t\tif (input._restrictPattern.test(value)){\r\n\t\t\t\tvalue=value.replace(input._restrictPattern,\"\");\r\n\t\t\t\tlaya.display.Input.inputElement.value=value;\r\n\t\t\t}\r\n\t\t}\r\n\t\tinput._text=value;\r\n\t\tinput.event(/*laya.events.Event.INPUT*/\"input\");\r\n\t}\r\n\r\n\tInput._stopEvent=function(e){\r\n\t\tif (e.type=='touchmove')\r\n\t\t\te.preventDefault();\r\n\t\te.stopPropagation && e.stopPropagation();\r\n\t}\r\n\r\n\tInput.TYPE_TEXT=\"text\";\r\n\tInput.TYPE_PASSWORD=\"password\";\r\n\tInput.TYPE_EMAIL=\"email\";\r\n\tInput.TYPE_URL=\"url\";\r\n\tInput.TYPE_NUMBER=\"number\";\r\n\tInput.TYPE_RANGE=\"range\";\r\n\tInput.TYPE_DATE=\"date\";\r\n\tInput.TYPE_MONTH=\"month\";\r\n\tInput.TYPE_WEEK=\"week\";\r\n\tInput.TYPE_TIME=\"time\";\r\n\tInput.TYPE_DATE_TIME=\"datetime\";\r\n\tInput.TYPE_DATE_TIME_LOCAL=\"datetime-local\";\r\n\tInput.TYPE_SEARCH=\"search\";\r\n\tInput.input=null;\r\n\tInput.area=null;\r\n\tInput.inputElement=null;\r\n\tInput.inputContainer=null;\r\n\tInput.confirmButton=null;\r\n\tInput.promptStyleDOM=null;\r\n\tInput.inputHeight=45;\r\n\tInput.isInputting=false;\r\n\tInput.stageMatrix=null;\r\n\t__static(Input,\r\n\t['IOS_IFRAME',function(){return this.IOS_IFRAME=(Browser.onIOS && Browser.window.top !=Browser.window.self);}\r\n\t]);\r\n\treturn Input;\r\n})(Text)\r\n\r\n\r\n/**\r\n*@private\r\n*<p> <code>HTMLImage</code> 用于创建 HTML Image 元素。</p>\r\n*<p>请使用 <code>HTMLImage.create()<code>获取新实例，不要直接使用 <code>new HTMLImage<code> 。</p>\r\n*/\r\n//class laya.resource.HTMLImage extends laya.resource.FileBitmap\r\nvar HTMLImage=(function(_super){\r\n\tfunction HTMLImage(src,def){\r\n\t\t/**异步加载锁*/\r\n\t\tthis._recreateLock=false;\r\n\t\t/**异步加载完成后是否需要释放（有可能在恢复过程中,再次被释放，用此变量做标记）*/\r\n\t\tthis._needReleaseAgain=false;\r\n\t\tthis._enableMerageInAtlas=true;\r\n\t\tHTMLImage.__super.call(this);\r\n\t\tthis._init_(src,def);\r\n\t}\r\n\r\n\t__class(HTMLImage,'laya.resource.HTMLImage',_super);\r\n\tvar __proto=HTMLImage.prototype;\r\n\t__proto._init_=function(src,def){\r\n\t\tthis._src=src;\r\n\t\tthis._source=new Browser.window.Image();\r\n\t\tif (def){\r\n\t\t\tdef.onload && (this.onload=def.onload);\r\n\t\t\tdef.onerror && (this.onerror=def.onerror);\r\n\t\t\tdef.onCreate && def.onCreate(this);\r\n\t\t}\r\n\t\tif (src.indexOf(\"data:image\")!=0)this._source.crossOrigin=\"\";\r\n\t\t(src)&& (this._source.src=src);\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.recreateResource=function(){\r\n\t\tvar _$this=this;\r\n\t\tif (this._src===\"\")\r\n\t\t\tthrow new Error(\"src no null！\");\r\n\t\tthis._needReleaseAgain=false;\r\n\t\tif (!this._source){\r\n\t\t\tthis._recreateLock=true;\r\n\t\t\tvar _this=this;\r\n\t\t\tthis._source=new Browser.window.Image();\r\n\t\t\tthis._source.crossOrigin=\"\";\r\n\t\t\tthis._source.onload=function (){\r\n\t\t\t\tif (_this._needReleaseAgain){\r\n\t\t\t\t\t_this._needReleaseAgain=false;\r\n\t\t\t\t\t_this._source.onload=null;\r\n\t\t\t\t\t_this._source=null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t_this._source.onload=null;\r\n\t\t\t\t_this.memorySize=_$this._w *_$this._h *4;\r\n\t\t\t\t_this._recreateLock=false;\r\n\t\t\t\t_this.completeCreate();\r\n\t\t\t};\r\n\t\t\tthis._source.src=this._src;\r\n\t\t\t}else {\r\n\t\t\tif (this._recreateLock)\r\n\t\t\t\treturn;\r\n\t\t\tthis.memorySize=this._w *this._h *4;\r\n\t\t\tthis._recreateLock=false;\r\n\t\t\tthis.completeCreate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__proto.disposeResource=function(){\r\n\t\tif (this._recreateLock)\r\n\t\t\tthis._needReleaseAgain=true;\r\n\t\t(this._source)&& (this._source=null,this.memorySize=0);\r\n\t}\r\n\r\n\t/***调整尺寸。*/\r\n\t__proto.onresize=function(){\r\n\t\tthis._w=this._source.width;\r\n\t\tthis._h=this._source.height;\r\n\t}\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'onload',null,function(value){\r\n\t\tvar _$this=this;\r\n\t\tthis._onload=value;\r\n\t\tthis._source && (this._source.onload=this._onload !=null ? (function(){\r\n\t\t\t_$this.onresize();\r\n\t\t\t_$this._onload();\r\n\t\t}):null);\r\n\t});\r\n\r\n\t/**\r\n\t*@inheritDoc\r\n\t*/\r\n\t__getset(0,__proto,'onerror',null,function(value){\r\n\t\tvar _$this=this;\r\n\t\tthis._onerror=value;\r\n\t\tthis._source && (this._source.onerror=this._onerror !=null ? (function(){\r\n\t\t\t_$this._onerror()\r\n\t\t}):null);\r\n\t});\r\n\r\n\t__getset(0,__proto,'enableMerageInAtlas',function(){\r\n\t\treturn this._enableMerageInAtlas;\r\n\t\t},function(value){\r\n\t\tthis._enableMerageInAtlas=value;\r\n\t\tif (Render.isConchApp){\r\n\t\t\tif (this._source)this._source.enableMerageInAtlas=value;\r\n\t\t}\r\n\t});\r\n\r\n\tHTMLImage.create=function(src,def){\r\n\t\treturn new HTMLImage(src,def);\r\n\t}\r\n\r\n\treturn HTMLImage;\r\n})(FileBitmap)\r\n\r\n\r\n/**\r\n*<p> 动效模板。用于为指定目标对象添加动画效果。每个动效有唯一的目标对象，而同一个对象可以添加多个动效。 当一个动效开始播放时，其他动效会自动停止播放。</p>\r\n*<p> 可以通过LayaAir IDE创建。 </p>\r\n*/\r\n//class laya.display.EffectAnimation extends laya.display.FrameAnimation\r\nvar EffectAnimation=(function(_super){\r\n\tfunction EffectAnimation(){\r\n\t\t/**@private */\r\n\t\tthis._target=null;\r\n\t\t/**@private */\r\n\t\tthis._playEvents=null;\r\n\t\t/**@private */\r\n\t\tthis._initData={};\r\n\t\t/**@private */\r\n\t\tthis._aniKeys=null;\r\n\t\t/**@private */\r\n\t\tthis._effectClass=null;\r\n\t\tEffectAnimation.__super.call(this);\r\n\t}\r\n\r\n\t__class(EffectAnimation,'laya.display.EffectAnimation',_super);\r\n\tvar __proto=EffectAnimation.prototype;\r\n\t/**@private */\r\n\t__proto._onOtherBegin=function(effect){\r\n\t\tif (effect==this)\r\n\t\t\treturn;\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto.addEvent=function(){\r\n\t\tif (!this._target || !this._playEvents)\r\n\t\t\treturn;\r\n\t\tthis._setControlNode(this._target);\r\n\t\tthis._target.on(this._playEvents,this,this._onPlayAction);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._onPlayAction=function(){\r\n\t\tthis.play(0,false);\r\n\t}\r\n\r\n\t__proto.play=function(start,loop,name,showWarn){\r\n\t\t(start===void 0)&& (start=0);\r\n\t\t(loop===void 0)&& (loop=true);\r\n\t\t(name===void 0)&& (name=\"\");\r\n\t\t(showWarn===void 0)&& (showWarn=true);\r\n\t\tif (!this._target)\r\n\t\t\treturn;\r\n\t\tthis._target.event(\"effectanimationbegin\",[this]);\r\n\t\tthis._recordInitData();\r\n\t\tlaya.display.AnimationPlayerBase.prototype.play.call(this,start,loop,name,showWarn);\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._recordInitData=function(){\r\n\t\tif (!this._aniKeys)\r\n\t\t\treturn;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=this._aniKeys.length;\r\n\t\tvar key;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=this._aniKeys[i];\r\n\t\t\tthis._initData[key]=this._target[key];\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._displayToIndex=function(value){\r\n\t\tif (!this._animationData)\r\n\t\t\treturn;\r\n\t\tif (value < 0)\r\n\t\t\tvalue=0;\r\n\t\tif (value > this._count)\r\n\t\t\tvalue=this._count;\r\n\t\tvar nodes=this._animationData.nodes,i=0,len=nodes.length;\r\n\t\tlen=len > 1 ? 1 :len;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._displayNodeToFrame(nodes[i],value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._displayNodeToFrame=function(node,frame,targetDic){\r\n\t\tif (!this._target)\r\n\t\t\treturn;\r\n\t\tvar target;\r\n\t\ttarget=this._target;\r\n\t\tvar frames=node.frames,key,propFrames,value;\r\n\t\tvar keys=node.keys,i=0,len=keys.length;\r\n\t\tvar secondFrames;\r\n\t\tsecondFrames=node.secondFrames;\r\n\t\tvar tSecondFrame=0;\r\n\t\tvar easeFun;\r\n\t\tvar tKeyFrames;\r\n\t\tvar startFrame;\r\n\t\tvar endFrame;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tkey=keys[i];\r\n\t\t\tpropFrames=frames[key];\r\n\t\t\ttSecondFrame=secondFrames[key];\r\n\t\t\tif (tSecondFrame==-1){\r\n\t\t\t\tvalue=this._initData[key];\r\n\t\t\t\t}else {\r\n\t\t\t\tif (frame < tSecondFrame){\r\n\t\t\t\t\ttKeyFrames=node.keyframes[key];\r\n\t\t\t\t\tstartFrame=tKeyFrames[0];\r\n\t\t\t\t\tif (startFrame.tween){\r\n\t\t\t\t\t\teaseFun=Ease[startFrame.tweenMethod];\r\n\t\t\t\t\t\tif (easeFun==null){\r\n\t\t\t\t\t\t\teaseFun=Ease.linearNone;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tendFrame=tKeyFrames[1];\r\n\t\t\t\t\t\tvalue=easeFun(frame,this._initData[key],endFrame.value-this._initData[key],endFrame.index);\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tvalue=this._initData[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tif (propFrames.length > frame){\r\n\t\t\t\t\t\tvalue=propFrames[frame];\r\n\t\t\t\t\t\t}else {\r\n\t\t\t\t\t\tvalue=propFrames[propFrames.length-1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ttarget[key]=value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**@private */\r\n\t__proto._calculateNodeKeyFrames=function(node){\r\n\t\t_super.prototype._calculateNodeKeyFrames.call(this,node);\r\n\t\tvar keyFrames=node.keyframes,key,tKeyFrames,target=node.target;\r\n\t\tvar secondFrames;\r\n\t\tsecondFrames={};\r\n\t\tnode.secondFrames=secondFrames;\r\n\t\tfor (key in keyFrames){\r\n\t\t\ttKeyFrames=keyFrames[key];\r\n\t\t\tif (tKeyFrames.length <=1){\r\n\t\t\t\tsecondFrames[key]=-1;\r\n\t\t\t\t}else {\r\n\t\t\t\tsecondFrames[key]=tKeyFrames[1].index;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*本实例的目标对象。通过本实例控制目标对象的属性变化。\r\n\t*@param v 指定的目标对象。\r\n\t*/\r\n\t__getset(0,__proto,'target',function(){\r\n\t\treturn this._target;\r\n\t\t},function(v){\r\n\t\tif (this._target){\r\n\t\t\tthis._target.off(\"effectanimationbegin\",this,this._onOtherBegin);\r\n\t\t}\r\n\t\tthis._target=v;\r\n\t\tif (this._target){\r\n\t\t\tthis._target.on(\"effectanimationbegin\",this,this._onOtherBegin);\r\n\t\t}\r\n\t\tthis.addEvent();\r\n\t});\r\n\r\n\t/**\r\n\t*设置开始播放的事件。本实例会侦听目标对象的指定事件，触发后播放相应动画效果。\r\n\t*@param event\r\n\t*/\r\n\t__getset(0,__proto,'playEvent',null,function(event){\r\n\t\tthis._playEvents=event;\r\n\t\tif (!event)\r\n\t\t\treturn;\r\n\t\tthis.addEvent();\r\n\t});\r\n\r\n\t/**\r\n\t*设置动画数据。\r\n\t*@param uiData\r\n\t*/\r\n\t__getset(0,__proto,'effectData',null,function(uiData){\r\n\t\tif (uiData){\r\n\t\t\tvar aniData;\r\n\t\t\taniData=uiData[\"animations\"];\r\n\t\t\tif (aniData && aniData[0]){\r\n\t\t\t\tthis._setUp({},aniData[0]);\r\n\t\t\t\tif (aniData[0].nodes && aniData[0].nodes[0]){\r\n\t\t\t\t\tthis._aniKeys=aniData[0].nodes[0].keys;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t/**\r\n\t*设置提供数据的类。\r\n\t*@param classStr 类路径\r\n\t*/\r\n\t__getset(0,__proto,'effectClass',null,function(classStr){\r\n\t\tthis._effectClass=ClassUtils.getClass(classStr);\r\n\t\tif (this._effectClass){\r\n\t\t\tvar uiData;\r\n\t\t\tuiData=this._effectClass[\"uiView\"];\r\n\t\t\tif (uiData){\r\n\t\t\t\tvar aniData;\r\n\t\t\t\taniData=uiData[\"animations\"];\r\n\t\t\t\tif (aniData && aniData[0]){\r\n\t\t\t\t\tthis._setUp({},aniData[0]);\r\n\t\t\t\t\tif (aniData[0].nodes && aniData[0].nodes[0]){\r\n\t\t\t\t\t\tthis._aniKeys=aniData[0].nodes[0].keys;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tEffectAnimation.EffectAnimationBegin=\"effectanimationbegin\";\r\n\treturn EffectAnimation;\r\n})(FrameAnimation)\r\n\r\n\r\n/**\r\n*@private\r\n*/\r\n//class laya.utils.GraphicAnimation extends laya.display.FrameAnimation\r\nvar GraphicAnimation=(function(_super){\r\n\tvar GraphicNode;\r\n\tfunction GraphicAnimation(){\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis.animationList=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis.animationDic=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._nodeList=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._nodeDefaultProps=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._gList=null;\r\n\t\t/**\r\n\t\t*@private\r\n\t\t*/\r\n\t\tthis._nodeIDAniDic={};\r\n\t\tthis._rootNode=null;\r\n\t\tthis._nodeGDic=null;\r\n\t\tGraphicAnimation.__super.call(this);\r\n\t}\r\n\r\n\t__class(GraphicAnimation,'laya.utils.GraphicAnimation',_super);\r\n\tvar __proto=GraphicAnimation.prototype;\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._parseNodeList=function(uiView){\r\n\t\tif (!this._nodeList){\r\n\t\t\tthis._nodeList=[];\r\n\t\t}\r\n\t\tthis._nodeDefaultProps[uiView.compId]=uiView.props;\r\n\t\tif (uiView.compId)\r\n\t\t\tthis._nodeList.push(uiView.compId);\r\n\t\tvar childs=uiView.child;\r\n\t\tif (childs){\r\n\t\t\tvar i=0,len=childs.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tthis._parseNodeList(childs[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._calGraphicData=function(aniData){\r\n\t\tthis._setUp(null,aniData);\r\n\t\tthis._createGraphicData();\r\n\t\tif (this._nodeIDAniDic){\r\n\t\t\tvar key;\r\n\t\t\tfor (key in this._nodeIDAniDic){\r\n\t\t\t\tthis._nodeIDAniDic[key]=null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._createGraphicData=function(){\r\n\t\tvar gList=[];\r\n\t\tvar i=0,len=this.count;\r\n\t\tvar animationDataNew=this._animationNewFrames;\r\n\t\tif (!animationDataNew)animationDataNew=[];\r\n\t\tvar preGraphic;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tif (animationDataNew[i] || !preGraphic){\r\n\t\t\t\tpreGraphic=this._createFrameGraphic(i);\r\n\t\t\t}\r\n\t\t\tgList.push(preGraphic);\r\n\t\t}\r\n\t\tthis._gList=gList;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._createFrameGraphic=function(frame){\r\n\t\tvar g=RunDriver.createGraphics();\r\n\t\tif (!GraphicAnimation._rootMatrix)\r\n\t\t\tGraphicAnimation._rootMatrix=new Matrix();\r\n\t\tthis._updateNodeGraphic(this._rootNode,frame,GraphicAnimation._rootMatrix,g);\r\n\t\treturn g;\r\n\t}\r\n\r\n\t__proto._updateNodeGraphic=function(node,frame,parentTransfrom,g,alpha){\r\n\t\t(alpha===void 0)&& (alpha=1);\r\n\t\tvar tNodeG;\r\n\t\ttNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId]);\r\n\t\tvar tGraphicAlpha=tNodeG.alpha *alpha;\r\n\t\tif (tGraphicAlpha < 0.01)return;\r\n\t\tif (!tNodeG.resultTransform){\r\n\t\t\ttNodeG.resultTransform=Matrix.create();\r\n\t\t};\r\n\t\tvar tResultTransform;\r\n\t\ttResultTransform=tNodeG.resultTransform;\r\n\t\tMatrix.mul(tNodeG.transform,parentTransfrom,tResultTransform);\r\n\t\tvar tTex;\r\n\t\tif (tNodeG.skin){\r\n\t\t\ttTex=this._getTextureByUrl(tNodeG.skin);\r\n\t\t\tif (tTex){\r\n\t\t\t\tif (tResultTransform._checkTransform()){\r\n\t\t\t\t\tg.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height,tResultTransform,tGraphicAlpha);\r\n\t\t\t\t\ttNodeG.resultTransform=null;\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\tg.drawTexture(tTex,tResultTransform.tx,tResultTransform.ty,tNodeG.width,tNodeG.height,null,tGraphicAlpha);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar childs;\r\n\t\tchilds=node.child;\r\n\t\tif (!childs)\r\n\t\t\treturn;\r\n\t\tvar i=0,len=0;\r\n\t\tlen=childs.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\tthis._updateNodeGraphic(childs[i],frame,tResultTransform,g,tGraphicAlpha);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._updateNoChilds=function(tNodeG,g){\r\n\t\tif (!tNodeG.skin)\r\n\t\t\treturn;\r\n\t\tvar tTex=this._getTextureByUrl(tNodeG.skin);\r\n\t\tif (!tTex)\r\n\t\t\treturn;\r\n\t\tvar tTransform=tNodeG.transform;\r\n\t\ttTransform._checkTransform();\r\n\t\tvar onlyTranslate=false;\r\n\t\tonlyTranslate=!tTransform.bTransform;\r\n\t\tif (!onlyTranslate){\r\n\t\t\tg.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height,tTransform.clone(),tNodeG.alpha);\r\n\t\t\t}else {\r\n\t\t\tg.drawTexture(tTex,tTransform.tx,tTransform.ty,tNodeG.width,tNodeG.height,null,tNodeG.alpha);\r\n\t\t}\r\n\t}\r\n\r\n\t__proto._updateNodeGraphic2=function(node,frame,g){\r\n\t\tvar tNodeG;\r\n\t\ttNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId]);\r\n\t\tif (!node.child){\r\n\t\t\tthis._updateNoChilds(tNodeG,g);\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar tTransform=tNodeG.transform;\r\n\t\ttTransform._checkTransform();\r\n\t\tvar onlyTranslate=false;\r\n\t\tonlyTranslate=!tTransform.bTransform;\r\n\t\tvar hasTrans=false;\r\n\t\thasTrans=onlyTranslate && (tTransform.tx !=0 || tTransform.ty !=0);\r\n\t\tvar ifSave=false;\r\n\t\tifSave=(tTransform.bTransform)|| tNodeG.alpha !=1;\r\n\t\tif (ifSave){\r\n\t\t\tg.save();\r\n\t\t}\r\n\t\tif (tNodeG.alpha !=1){\r\n\t\t\tg.alpha(tNodeG.alpha);\r\n\t\t}\r\n\t\tif (!onlyTranslate){\r\n\t\t\tg.transform(tTransform.clone());\r\n\t\t\t}else if (hasTrans){\r\n\t\t\tg.translate(tTransform.tx,tTransform.ty);\r\n\t\t};\r\n\t\tvar childs;\r\n\t\tchilds=node.child;\r\n\t\tvar tTex;\r\n\t\tif (tNodeG.skin){\r\n\t\t\ttTex=this._getTextureByUrl(tNodeG.skin);\r\n\t\t\tif (tTex){\r\n\t\t\t\tg.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (childs){\r\n\t\t\tvar i=0,len=0;\r\n\t\t\tlen=childs.length;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\tthis._updateNodeGraphic2(childs[i],frame,g);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ifSave){\r\n\t\t\tg.restore();\r\n\t\t\t}else {\r\n\t\t\tif (!onlyTranslate){\r\n\t\t\t\tg.transform(tTransform.clone().invert());\r\n\t\t\t\t}else if (hasTrans){\r\n\t\t\t\tg.translate(-tTransform.tx,-tTransform.ty);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._calculateNodeKeyFrames=function(node){\r\n\t\t_super.prototype._calculateNodeKeyFrames.call(this,node);\r\n\t\tthis._nodeIDAniDic[node.target]=node;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.getNodeDataByID=function(nodeID){\r\n\t\treturn this._nodeIDAniDic[nodeID];\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._getParams=function(obj,params,frame,obj2){\r\n\t\tvar rst=GraphicAnimation._temParam;\r\n\t\trst.length=params.length;\r\n\t\tvar i=0,len=params.length;\r\n\t\tfor (i=0;i < len;i++){\r\n\t\t\trst[i]=this._getObjVar(obj,params[i][0],frame,params[i][1],obj2);\r\n\t\t}\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._getObjVar=function(obj,key,frame,noValue,obj2){\r\n\t\tif (obj.hasOwnProperty(key)){\r\n\t\t\tvar vArr=obj[key];\r\n\t\t\tif (frame >=vArr.length)\r\n\t\t\t\tframe=vArr.length-1;\r\n\t\t\treturn obj[key][frame];\r\n\t\t}\r\n\t\tif (obj2.hasOwnProperty(key)){\r\n\t\t\treturn obj2[key];\r\n\t\t}\r\n\t\treturn noValue;\r\n\t}\r\n\r\n\t__proto._getNodeGraphicData=function(nodeID,frame,rst){\r\n\t\tif (!rst)\r\n\t\t\trst=GraphicNode.create();\r\n\t\tif (!rst.transform){\r\n\t\t\trst.transform=Matrix.create();\r\n\t\t\t}else{\r\n\t\t\trst.transform.identity();\r\n\t\t};\r\n\t\tvar node=this.getNodeDataByID(nodeID);\r\n\t\tif (!node)\r\n\t\t\treturn rst;\r\n\t\tvar frameData=node.frames;\r\n\t\tvar params=this._getParams(frameData,GraphicAnimation._drawTextureCmd,frame,this._nodeDefaultProps[nodeID]);\r\n\t\tvar url=params[0];\r\n\t\tvar width=NaN,height=NaN;\r\n\t\tvar px=params[5],py=params[6];\r\n\t\tvar aX=params[13],aY=params[14];\r\n\t\tvar sx=params[7],sy=params[8];\r\n\t\tvar rotate=params[9];\r\n\t\tvar skewX=params[11],skewY=params[12]\r\n\t\twidth=params[3];\r\n\t\theight=params[4];\r\n\t\tif (width==0 || height==0)url=null;\r\n\t\tif (width==-1)width=0;\r\n\t\tif (height==-1)height=0;\r\n\t\tvar tex;\r\n\t\trst.skin=url;\r\n\t\trst.width=width;\r\n\t\trst.height=height;\r\n\t\tif (url){\r\n\t\t\ttex=this._getTextureByUrl(url);\r\n\t\t\tif (tex){\r\n\t\t\t\tif (!width)\r\n\t\t\t\t\twidth=tex.sourceWidth;\r\n\t\t\t\tif (!height)\r\n\t\t\t\t\theight=tex.sourceHeight;\r\n\t\t\t\t}else {\r\n\t\t\t\tconsole.warn(\"lost skin:\",url,\",you may load pics first\");\r\n\t\t\t}\r\n\t\t}\r\n\t\trst.alpha=params[10];\r\n\t\tvar m;\r\n\t\tm=rst.transform;\r\n\t\tif (aX !=0){\r\n\t\t\tpx=aX *width;\r\n\t\t}\r\n\t\tif (aY !=0){\r\n\t\t\tpy=aY *height;\r\n\t\t}\r\n\t\tif (px !=0 || py !=0){\r\n\t\t\tm.translate(-px,-py);\r\n\t\t};\r\n\t\tvar tm=null;\r\n\t\tif (rotate || sx!==1 || sy!==1 || skewX || skewY){\r\n\t\t\ttm=GraphicAnimation._tempMt;\r\n\t\t\ttm.identity();\r\n\t\t\ttm.bTransform=true;\r\n\t\t\tvar skx=(rotate-skewX)*0.0174532922222222;\r\n\t\t\tvar sky=(rotate+skewY)*0.0174532922222222;\r\n\t\t\tvar cx=Math.cos(sky);\r\n\t\t\tvar ssx=Math.sin(sky);\r\n\t\t\tvar cy=Math.sin(skx);\r\n\t\t\tvar ssy=Math.cos(skx);\r\n\t\t\ttm.a=sx *cx;\r\n\t\t\ttm.b=sx *ssx;\r\n\t\t\ttm.c=-sy *cy;\r\n\t\t\ttm.d=sy *ssy;\r\n\t\t\ttm.tx=tm.ty=0;\r\n\t\t}\r\n\t\tif (tm){\r\n\t\t\tm=Matrix.mul(m,tm,m);\r\n\t\t}\r\n\t\tm.translate(params[1],params[2]);\r\n\t\treturn rst;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._getTextureByUrl=function(url){\r\n\t\treturn Loader.getRes(url);\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.setAniData=function(uiView,aniName){\r\n\t\tif (uiView.animations){\r\n\t\t\tthis._nodeDefaultProps={};\r\n\t\t\tthis._nodeGDic={};\r\n\t\t\tif (this._nodeList)\r\n\t\t\t\tthis._nodeList.length=0;\r\n\t\t\tthis._rootNode=uiView;\r\n\t\t\tthis._parseNodeList(uiView);\r\n\t\t\tvar aniDic={};\r\n\t\t\tvar anilist=[];\r\n\t\t\tvar animations=uiView.animations;\r\n\t\t\tvar i=0,len=animations.length;\r\n\t\t\tvar tAniO;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttAniO=animations[i];\r\n\t\t\t\tthis._labels=null;\r\n\t\t\t\tif (aniName && aniName !=tAniO.name){\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!tAniO)\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis._calGraphicData(tAniO);\r\n\t\t\t\t\t}catch (e){\r\n\t\t\t\t\tconsole.warn(\"parse animation fail:\"+tAniO.name+\",empty animation created\");\r\n\t\t\t\t\tthis._gList=[];\r\n\t\t\t\t};\r\n\t\t\t\tvar frameO={};\r\n\t\t\t\tframeO.interval=1000 / tAniO[\"frameRate\"];\r\n\t\t\t\tframeO.frames=this._gList;\r\n\t\t\t\tframeO.labels=this._labels;\r\n\t\t\t\tframeO.name=tAniO.name;\r\n\t\t\t\tanilist.push(frameO);\r\n\t\t\t\taniDic[tAniO.name]=frameO;\r\n\t\t\t}\r\n\t\t\tthis.animationList=anilist;\r\n\t\t\tthis.animationDic=aniDic;\r\n\t\t}\r\n\t\tGraphicAnimation._temParam.length=0;\r\n\t}\r\n\r\n\t__proto.parseByData=function(aniData){\r\n\t\tvar rootNode,aniO;\r\n\t\trootNode=aniData.nodeRoot;\r\n\t\taniO=aniData.aniO;\r\n\t\tdelete aniData.nodeRoot;\r\n\t\tdelete aniData.aniO;\r\n\t\tthis._nodeDefaultProps={};\r\n\t\tthis._nodeGDic={};\r\n\t\tif (this._nodeList)\r\n\t\t\tthis._nodeList.length=0;\r\n\t\tthis._rootNode=rootNode;\r\n\t\tthis._parseNodeList(rootNode);\r\n\t\tthis._labels=null;\r\n\t\ttry {\r\n\t\t\tthis._calGraphicData(aniO);\r\n\t\t\t}catch (e){\r\n\t\t\tconsole.warn(\"parse animation fail:\"+aniO.name+\",empty animation created\");\r\n\t\t\tthis._gList=[];\r\n\t\t};\r\n\t\tvar frameO=aniData;\r\n\t\tframeO.interval=1000 / aniO[\"frameRate\"];\r\n\t\tframeO.frames=this._gList;\r\n\t\tframeO.labels=this._labels;\r\n\t\tframeO.name=aniO.name;\r\n\t\treturn frameO;\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto.setUpAniData=function(uiView){\r\n\t\tif (uiView.animations){\r\n\t\t\tvar aniDic={};\r\n\t\t\tvar anilist=[];\r\n\t\t\tvar animations=uiView.animations;\r\n\t\t\tvar i=0,len=animations.length;\r\n\t\t\tvar tAniO;\r\n\t\t\tfor (i=0;i < len;i++){\r\n\t\t\t\ttAniO=animations[i];\r\n\t\t\t\tif (!tAniO)\r\n\t\t\t\t\tcontinue ;\r\n\t\t\t\tvar frameO={};\r\n\t\t\t\tframeO.name=tAniO.name;\r\n\t\t\t\tframeO.aniO=tAniO;\r\n\t\t\t\tframeO.nodeRoot=uiView;\r\n\t\t\t\tanilist.push(frameO);\r\n\t\t\t\taniDic[tAniO.name]=frameO;\r\n\t\t\t}\r\n\t\t\tthis.animationList=anilist;\r\n\t\t\tthis.animationDic=aniDic;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t*@private\r\n\t*/\r\n\t__proto._clear=function(){\r\n\t\tthis.animationList=null;\r\n\t\tthis.animationDic=null;\r\n\t\tthis._gList=null;\r\n\t\tif (this._nodeGDic){\r\n\t\t\tvar key;\r\n\t\t\tvar tGNode;\r\n\t\t\tfor (key in this._nodeGDic){\r\n\t\t\t\ttGNode=this._nodeGDic[key];\r\n\t\t\t\tif (tGNode)tGNode.recover();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._nodeGDic=null;\r\n\t}\r\n\r\n\tGraphicAnimation.parseAnimationByData=function(animationObject){\r\n\t\tif (!GraphicAnimation._I)\r\n\t\t\tGraphicAnimation._I=new GraphicAnimation();\r\n\t\tvar rst;\r\n\t\trst=GraphicAnimation._I.parseByData(animationObject);\r\n\t\tGraphicAnimation._I._clear();\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGraphicAnimation.parseAnimationData=function(aniData){\r\n\t\tif (!GraphicAnimation._I)\r\n\t\t\tGraphicAnimation._I=new GraphicAnimation();\r\n\t\tGraphicAnimation._I.setUpAniData(aniData);\r\n\t\tvar rst;\r\n\t\trst={};\r\n\t\trst.animationList=GraphicAnimation._I.animationList;\r\n\t\trst.animationDic=GraphicAnimation._I.animationDic;\r\n\t\tGraphicAnimation._I._clear();\r\n\t\treturn rst;\r\n\t}\r\n\r\n\tGraphicAnimation._temParam=[];\r\n\tGraphicAnimation._I=null;\r\n\tGraphicAnimation._rootMatrix=null;\r\n\t__static(GraphicAnimation,\r\n\t['_drawTextureCmd',function(){return this._drawTextureCmd=[[\"skin\",null],[\"x\",0],[\"y\",0],[\"width\",-1],[\"height\",-1],[\"pivotX\",0],[\"pivotY\",0],[\"scaleX\",1],[\"scaleY\",1],[\"rotation\",0],[\"alpha\",1],[\"skewX\",0],[\"skewY\",0],[\"anchorX\",0],[\"anchorY\",0]];},'_tempMt',function(){return this._tempMt=new Matrix();}\r\n\t]);\r\n\tGraphicAnimation.__init$=function(){\r\n\t\t//class GraphicNode\r\n\t\tGraphicNode=(function(){\r\n\t\t\tfunction GraphicNode(){\r\n\t\t\t\tthis.skin=null;\r\n\t\t\t\tthis.transform=null;\r\n\t\t\t\tthis.resultTransform=null;\r\n\t\t\t\tthis.width=NaN;\r\n\t\t\t\tthis.height=NaN;\r\n\t\t\t\tthis.alpha=1;\r\n\t\t\t}\r\n\t\t\t__class(GraphicNode,'');\r\n\t\t\tvar __proto=GraphicNode.prototype;\r\n\t\t\t__proto.recover=function(){\r\n\t\t\t\tthis.skin=null;\r\n\t\t\t\tthis.width=0;\r\n\t\t\t\tthis.height=0;\r\n\t\t\t\tthis.alpha=1;\r\n\t\t\t\tif (this.transform){\r\n\t\t\t\t\tthis.transform.destroy();\r\n\t\t\t\t\tthis.transform=null;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.resultTransform){\r\n\t\t\t\t\tthis.resultTransform.destroy();\r\n\t\t\t\t\tthis.resultTransform=null;\r\n\t\t\t\t}\r\n\t\t\t\tPool.recover(\"GraphicNode\",this);\r\n\t\t\t}\r\n\t\t\tGraphicNode.create=function(){\r\n\t\t\t\treturn Pool.getItemByClass(\"GraphicNode\",GraphicNode);\r\n\t\t\t}\r\n\t\t\treturn GraphicNode;\r\n\t\t})()\r\n\t}\r\n\r\n\treturn GraphicAnimation;\r\n})(FrameAnimation)\r\n\r\n\r\n\tLaya.__init([EventDispatcher,LoaderManager,Render,Browser,Timer,LocalStorage,TimeLine,GraphicAnimation]);\r\n})(window,document,Laya);\r\n\r\n(function(window,document,Laya){\r\n\tvar __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;\r\n//class LayaMain\r\nvar LayaMain=(function(){\r\n\t/*[COMPILER OPTIONS:normal]*/\r\n\tfunction LayaMain(){}\r\n\t__class(LayaMain,'LayaMain');\r\n\treturn LayaMain;\r\n})()\r\n\r\n\r\n\r\n\tnew LayaMain();\r\n\r\n})(window,document,Laya);\r\n\r\nif (true){\r\n\t!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__, exports], __WEBPACK_AMD_DEFINE_RESULT__ = (function(require, exports) {\r\n        'use strict';\r\n        Object.defineProperty(exports, '__esModule', { value: true });\r\n        for (var i in Laya) {\r\n\t\t\tvar o = Laya[i];\r\n            o && o.__isclass && (exports[i] = o);\r\n        }\r\n    }).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n}\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = Laya;\n\n//# sourceURL=webpack:///./bin/libs/laya.core.js?./node_modules/exports-loader?Laya");

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

/***/ }),

/***/ "./src/Box2D/Box2D.ts":
/*!****************************!*\
  !*** ./src/Box2D/Box2D.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * mainpage Box2D API Documentation\n * section intro_sec Getting Started\n * For documentation please see http://box2d.org/documentation.html\n * For discussion please visit http://box2d.org/forum\n */\n// These include files constitute the main Box2D API\n__export(__webpack_require__(/*! ./Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\"));\n__export(__webpack_require__(/*! ./Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\"));\n__export(__webpack_require__(/*! ./Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\"));\n__export(__webpack_require__(/*! ./Common/b2Timer */ \"./src/Box2D/Common/b2Timer.ts\"));\n__export(__webpack_require__(/*! ./Common/b2GrowableStack */ \"./src/Box2D/Common/b2GrowableStack.ts\"));\n__export(__webpack_require__(/*! ./Common/b2BlockAllocator */ \"./src/Box2D/Common/b2BlockAllocator.ts\"));\n__export(__webpack_require__(/*! ./Common/b2StackAllocator */ \"./src/Box2D/Common/b2StackAllocator.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2Distance */ \"./src/Box2D/Collision/b2Distance.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2BroadPhase */ \"./src/Box2D/Collision/b2BroadPhase.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2DynamicTree */ \"./src/Box2D/Collision/b2DynamicTree.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2TimeOfImpact */ \"./src/Box2D/Collision/b2TimeOfImpact.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2CollideCircle */ \"./src/Box2D/Collision/b2CollideCircle.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2CollidePolygon */ \"./src/Box2D/Collision/b2CollidePolygon.ts\"));\n__export(__webpack_require__(/*! ./Collision/b2CollideEdge */ \"./src/Box2D/Collision/b2CollideEdge.ts\"));\n__export(__webpack_require__(/*! ./Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\"));\n__export(__webpack_require__(/*! ./Collision/Shapes/b2CircleShape */ \"./src/Box2D/Collision/Shapes/b2CircleShape.ts\"));\n__export(__webpack_require__(/*! ./Collision/Shapes/b2PolygonShape */ \"./src/Box2D/Collision/Shapes/b2PolygonShape.ts\"));\n__export(__webpack_require__(/*! ./Collision/Shapes/b2EdgeShape */ \"./src/Box2D/Collision/Shapes/b2EdgeShape.ts\"));\n__export(__webpack_require__(/*! ./Collision/Shapes/b2ChainShape */ \"./src/Box2D/Collision/Shapes/b2ChainShape.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2Fixture */ \"./src/Box2D/Dynamics/b2Fixture.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2Body */ \"./src/Box2D/Dynamics/b2Body.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2World */ \"./src/Box2D/Dynamics/b2World.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2Island */ \"./src/Box2D/Dynamics/b2Island.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2TimeStep */ \"./src/Box2D/Dynamics/b2TimeStep.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/b2ContactManager */ \"./src/Box2D/Dynamics/b2ContactManager.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2ContactFactory */ \"./src/Box2D/Dynamics/Contacts/b2ContactFactory.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2ContactSolver */ \"./src/Box2D/Dynamics/Contacts/b2ContactSolver.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2CircleContact */ \"./src/Box2D/Dynamics/Contacts/b2CircleContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2PolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2PolygonContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2PolygonAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2PolygonAndCircleContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2EdgeAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2EdgeAndCircleContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2EdgeAndPolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2EdgeAndPolygonContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2ChainAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2ChainAndCircleContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Contacts/b2ChainAndPolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2ChainAndPolygonContact.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2JointFactory */ \"./src/Box2D/Dynamics/Joints/b2JointFactory.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2AreaJoint */ \"./src/Box2D/Dynamics/Joints/b2AreaJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2DistanceJoint */ \"./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2FrictionJoint */ \"./src/Box2D/Dynamics/Joints/b2FrictionJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2GearJoint */ \"./src/Box2D/Dynamics/Joints/b2GearJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2MotorJoint */ \"./src/Box2D/Dynamics/Joints/b2MotorJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2MouseJoint */ \"./src/Box2D/Dynamics/Joints/b2MouseJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2PrismaticJoint */ \"./src/Box2D/Dynamics/Joints/b2PrismaticJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2PulleyJoint */ \"./src/Box2D/Dynamics/Joints/b2PulleyJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2RevoluteJoint */ \"./src/Box2D/Dynamics/Joints/b2RevoluteJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2RopeJoint */ \"./src/Box2D/Dynamics/Joints/b2RopeJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2WeldJoint */ \"./src/Box2D/Dynamics/Joints/b2WeldJoint.ts\"));\n__export(__webpack_require__(/*! ./Dynamics/Joints/b2WheelJoint */ \"./src/Box2D/Dynamics/Joints/b2WheelJoint.ts\"));\n// #if B2_ENABLE_PARTICLE\n__export(__webpack_require__(/*! ./Particle/b2Particle */ \"./src/Box2D/Particle/b2Particle.ts\"));\n__export(__webpack_require__(/*! ./Particle/b2ParticleGroup */ \"./src/Box2D/Particle/b2ParticleGroup.ts\"));\n__export(__webpack_require__(/*! ./Particle/b2ParticleSystem */ \"./src/Box2D/Particle/b2ParticleSystem.ts\"));\n// #endif\n__export(__webpack_require__(/*! ./Rope/b2Rope */ \"./src/Box2D/Rope/b2Rope.ts\"));\n\n\n//# sourceURL=webpack:///./src/Box2D/Box2D.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/Shapes/b2ChainShape.ts":
/*!****************************************************!*\
  !*** ./src/Box2D/Collision/Shapes/b2ChainShape.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2010 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2EdgeShape_1 = __webpack_require__(/*! ./b2EdgeShape */ \"./src/Box2D/Collision/Shapes/b2EdgeShape.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ./b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\n/// A chain shape is a free form sequence of line segments.\n/// The chain has two-sided collision, so you can use inside and outside collision.\n/// Therefore, you may use any winding order.\n/// Since there may be many vertices, they are allocated using b2Alloc.\n/// Connectivity information is used to create smooth collisions.\n/// WARNING: The chain will not collide properly if there are self-intersections.\nvar b2ChainShape = /** @class */ (function (_super) {\n    __extends(b2ChainShape, _super);\n    function b2ChainShape() {\n        var _this = _super.call(this, b2Shape_1.b2ShapeType.e_chainShape, b2Settings_1.b2_polygonRadius) || this;\n        _this.m_count = 0;\n        _this.m_prevVertex = new b2Math_1.b2Vec2();\n        _this.m_nextVertex = new b2Math_1.b2Vec2();\n        _this.m_hasPrevVertex = false;\n        _this.m_hasNextVertex = false;\n        return _this;\n    }\n    /// Create a loop. This automatically adjusts connectivity.\n    /// @param vertices an array of vertices, these are copied\n    /// @param count the vertex count\n    b2ChainShape.prototype.CreateLoop = function (vertices, count) {\n        /// b2Assert(this.m_vertices === null && this.m_count === 0);\n        /// b2Assert(count >= 3);\n        /// for (let i: number = 1; i < count; ++i) {\n        ///  const v1 = vertices[i - 1];\n        ///  const v2 = vertices[i];\n        ///  // If the code crashes here, it means your vertices are too close together.\n        ///  b2Assert(b2Vec2.DistanceSquaredVV(v1, v2) > b2_linearSlop * b2_linearSlop);\n        /// }\n        if (count === void 0) { count = vertices.length; }\n        this.m_count = count + 1;\n        this.m_vertices = b2Math_1.b2Vec2.MakeArray(this.m_count);\n        for (var i = 0; i < count; ++i) {\n            this.m_vertices[i].Copy(vertices[i]);\n        }\n        this.m_vertices[count].Copy(this.m_vertices[0]);\n        this.m_prevVertex.Copy(this.m_vertices[this.m_count - 2]);\n        this.m_nextVertex.Copy(this.m_vertices[1]);\n        this.m_hasPrevVertex = true;\n        this.m_hasNextVertex = true;\n        return this;\n    };\n    /// Create a chain with isolated end vertices.\n    /// @param vertices an array of vertices, these are copied\n    /// @param count the vertex count\n    b2ChainShape.prototype.CreateChain = function (vertices, count) {\n        /// b2Assert(this.m_vertices === null && this.m_count === 0);\n        /// b2Assert(count >= 2);\n        /// for (let i: number = 1; i < count; ++i) {\n        ///  const v1 = vertices[i - 1];\n        ///  const v2 = vertices[i];\n        ///  // If the code crashes here, it means your vertices are too close together.\n        ///  b2Assert(b2Vec2.DistanceSquaredVV(v1, v2) > b2_linearSlop * b2_linearSlop);\n        /// }\n        if (count === void 0) { count = vertices.length; }\n        this.m_count = count;\n        this.m_vertices = b2Math_1.b2Vec2.MakeArray(count);\n        for (var i = 0; i < count; ++i) {\n            this.m_vertices[i].Copy(vertices[i]);\n        }\n        this.m_hasPrevVertex = false;\n        this.m_hasNextVertex = false;\n        this.m_prevVertex.SetZero();\n        this.m_nextVertex.SetZero();\n        return this;\n    };\n    /// Establish connectivity to a vertex that precedes the first vertex.\n    /// Don't call this for loops.\n    b2ChainShape.prototype.SetPrevVertex = function (prevVertex) {\n        this.m_prevVertex.Copy(prevVertex);\n        this.m_hasPrevVertex = true;\n        return this;\n    };\n    /// Establish connectivity to a vertex that follows the last vertex.\n    /// Don't call this for loops.\n    b2ChainShape.prototype.SetNextVertex = function (nextVertex) {\n        this.m_nextVertex.Copy(nextVertex);\n        this.m_hasNextVertex = true;\n        return this;\n    };\n    /// Implement b2Shape. Vertices are cloned using b2Alloc.\n    b2ChainShape.prototype.Clone = function () {\n        return new b2ChainShape().Copy(this);\n    };\n    b2ChainShape.prototype.Copy = function (other) {\n        _super.prototype.Copy.call(this, other);\n        /// b2Assert(other instanceof b2ChainShape);\n        this.CreateChain(other.m_vertices, other.m_count);\n        this.m_prevVertex.Copy(other.m_prevVertex);\n        this.m_nextVertex.Copy(other.m_nextVertex);\n        this.m_hasPrevVertex = other.m_hasPrevVertex;\n        this.m_hasNextVertex = other.m_hasNextVertex;\n        return this;\n    };\n    /// @see b2Shape::GetChildCount\n    b2ChainShape.prototype.GetChildCount = function () {\n        // edge count = vertex count - 1\n        return this.m_count - 1;\n    };\n    /// Get a child edge.\n    b2ChainShape.prototype.GetChildEdge = function (edge, index) {\n        /// b2Assert(0 <= index && index < this.m_count - 1);\n        edge.m_type = b2Shape_1.b2ShapeType.e_edgeShape;\n        edge.m_radius = this.m_radius;\n        edge.m_vertex1.Copy(this.m_vertices[index]);\n        edge.m_vertex2.Copy(this.m_vertices[index + 1]);\n        if (index > 0) {\n            edge.m_vertex0.Copy(this.m_vertices[index - 1]);\n            edge.m_hasVertex0 = true;\n        }\n        else {\n            edge.m_vertex0.Copy(this.m_prevVertex);\n            edge.m_hasVertex0 = this.m_hasPrevVertex;\n        }\n        if (index < this.m_count - 2) {\n            edge.m_vertex3.Copy(this.m_vertices[index + 2]);\n            edge.m_hasVertex3 = true;\n        }\n        else {\n            edge.m_vertex3.Copy(this.m_nextVertex);\n            edge.m_hasVertex3 = this.m_hasNextVertex;\n        }\n    };\n    /// This always return false.\n    /// @see b2Shape::TestPoint\n    b2ChainShape.prototype.TestPoint = function (xf, p) {\n        return false;\n    };\n    b2ChainShape.prototype.ComputeDistance = function (xf, p, normal, childIndex) {\n        var edge = b2ChainShape.ComputeDistance_s_edgeShape;\n        this.GetChildEdge(edge, childIndex);\n        return edge.ComputeDistance(xf, p, normal, 0);\n    };\n    b2ChainShape.prototype.RayCast = function (output, input, xf, childIndex) {\n        /// b2Assert(childIndex < this.m_count);\n        var edgeShape = b2ChainShape.RayCast_s_edgeShape;\n        edgeShape.m_vertex1.Copy(this.m_vertices[childIndex]);\n        edgeShape.m_vertex2.Copy(this.m_vertices[(childIndex + 1) % this.m_count]);\n        return edgeShape.RayCast(output, input, xf, 0);\n    };\n    b2ChainShape.prototype.ComputeAABB = function (aabb, xf, childIndex) {\n        /// b2Assert(childIndex < this.m_count);\n        var vertexi1 = this.m_vertices[childIndex];\n        var vertexi2 = this.m_vertices[(childIndex + 1) % this.m_count];\n        var v1 = b2Math_1.b2Transform.MulXV(xf, vertexi1, b2ChainShape.ComputeAABB_s_v1);\n        var v2 = b2Math_1.b2Transform.MulXV(xf, vertexi2, b2ChainShape.ComputeAABB_s_v2);\n        b2Math_1.b2Vec2.MinV(v1, v2, aabb.lowerBound);\n        b2Math_1.b2Vec2.MaxV(v1, v2, aabb.upperBound);\n    };\n    /// Chains have zero mass.\n    /// @see b2Shape::ComputeMass\n    b2ChainShape.prototype.ComputeMass = function (massData, density) {\n        massData.mass = 0;\n        massData.center.SetZero();\n        massData.I = 0;\n    };\n    b2ChainShape.prototype.SetupDistanceProxy = function (proxy, index) {\n        /// b2Assert(0 <= index && index < this.m_count);\n        proxy.m_vertices = proxy.m_buffer;\n        proxy.m_vertices[0].Copy(this.m_vertices[index]);\n        if (index + 1 < this.m_count) {\n            proxy.m_vertices[1].Copy(this.m_vertices[index + 1]);\n        }\n        else {\n            proxy.m_vertices[1].Copy(this.m_vertices[0]);\n        }\n        proxy.m_count = 2;\n        proxy.m_radius = this.m_radius;\n    };\n    b2ChainShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {\n        c.SetZero();\n        return 0;\n    };\n    b2ChainShape.prototype.Dump = function (log) {\n        log(\"    const shape: b2ChainShape = new b2ChainShape();\\n\");\n        log(\"    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\\n\", b2Settings_1.b2_maxPolygonVertices);\n        for (var i = 0; i < this.m_count; ++i) {\n            log(\"    vs[%d].Set(%.15f, %.15f);\\n\", i, this.m_vertices[i].x, this.m_vertices[i].y);\n        }\n        log(\"    shape.CreateChain(vs, %d);\\n\", this.m_count);\n        log(\"    shape.m_prevVertex.Set(%.15f, %.15f);\\n\", this.m_prevVertex.x, this.m_prevVertex.y);\n        log(\"    shape.m_nextVertex.Set(%.15f, %.15f);\\n\", this.m_nextVertex.x, this.m_nextVertex.y);\n        log(\"    shape.m_hasPrevVertex = %s;\\n\", (this.m_hasPrevVertex) ? (\"true\") : (\"false\"));\n        log(\"    shape.m_hasNextVertex = %s;\\n\", (this.m_hasNextVertex) ? (\"true\") : (\"false\"));\n    };\n    // #if B2_ENABLE_PARTICLE\n    /// @see b2Shape::ComputeDistance\n    b2ChainShape.ComputeDistance_s_edgeShape = new b2EdgeShape_1.b2EdgeShape();\n    // #endif\n    /// Implement b2Shape.\n    b2ChainShape.RayCast_s_edgeShape = new b2EdgeShape_1.b2EdgeShape();\n    /// @see b2Shape::ComputeAABB\n    b2ChainShape.ComputeAABB_s_v1 = new b2Math_1.b2Vec2();\n    b2ChainShape.ComputeAABB_s_v2 = new b2Math_1.b2Vec2();\n    return b2ChainShape;\n}(b2Shape_1.b2Shape));\nexports.b2ChainShape = b2ChainShape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/Shapes/b2ChainShape.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/Shapes/b2CircleShape.ts":
/*!*****************************************************!*\
  !*** ./src/Box2D/Collision/Shapes/b2CircleShape.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ./b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\n/// A circle shape.\nvar b2CircleShape = /** @class */ (function (_super) {\n    __extends(b2CircleShape, _super);\n    function b2CircleShape(radius) {\n        if (radius === void 0) { radius = 0; }\n        var _this = _super.call(this, b2Shape_1.b2ShapeType.e_circleShape, radius) || this;\n        _this.m_p = new b2Math_1.b2Vec2();\n        return _this;\n    }\n    /// Implement b2Shape.\n    b2CircleShape.prototype.Clone = function () {\n        return new b2CircleShape().Copy(this);\n    };\n    b2CircleShape.prototype.Copy = function (other) {\n        _super.prototype.Copy.call(this, other);\n        /// b2Assert(other instanceof b2CircleShape);\n        this.m_p.Copy(other.m_p);\n        return this;\n    };\n    /// @see b2Shape::GetChildCount\n    b2CircleShape.prototype.GetChildCount = function () {\n        return 1;\n    };\n    b2CircleShape.prototype.TestPoint = function (transform, p) {\n        var center = b2Math_1.b2Transform.MulXV(transform, this.m_p, b2CircleShape.TestPoint_s_center);\n        var d = b2Math_1.b2Vec2.SubVV(p, center, b2CircleShape.TestPoint_s_d);\n        return b2Math_1.b2Vec2.DotVV(d, d) <= b2Math_1.b2Sq(this.m_radius);\n    };\n    b2CircleShape.prototype.ComputeDistance = function (xf, p, normal, childIndex) {\n        var center = b2Math_1.b2Transform.MulXV(xf, this.m_p, b2CircleShape.ComputeDistance_s_center);\n        b2Math_1.b2Vec2.SubVV(p, center, normal);\n        return normal.Normalize() - this.m_radius;\n    };\n    b2CircleShape.prototype.RayCast = function (output, input, transform, childIndex) {\n        var position = b2Math_1.b2Transform.MulXV(transform, this.m_p, b2CircleShape.RayCast_s_position);\n        var s = b2Math_1.b2Vec2.SubVV(input.p1, position, b2CircleShape.RayCast_s_s);\n        var b = b2Math_1.b2Vec2.DotVV(s, s) - b2Math_1.b2Sq(this.m_radius);\n        // Solve quadratic equation.\n        var r = b2Math_1.b2Vec2.SubVV(input.p2, input.p1, b2CircleShape.RayCast_s_r);\n        var c = b2Math_1.b2Vec2.DotVV(s, r);\n        var rr = b2Math_1.b2Vec2.DotVV(r, r);\n        var sigma = c * c - rr * b;\n        // Check for negative discriminant and short segment.\n        if (sigma < 0 || rr < b2Settings_1.b2_epsilon) {\n            return false;\n        }\n        // Find the point of intersection of the line with the circle.\n        var a = (-(c + b2Math_1.b2Sqrt(sigma)));\n        // Is the intersection point on the segment?\n        if (0 <= a && a <= input.maxFraction * rr) {\n            a /= rr;\n            output.fraction = a;\n            b2Math_1.b2Vec2.AddVMulSV(s, a, r, output.normal).SelfNormalize();\n            return true;\n        }\n        return false;\n    };\n    b2CircleShape.prototype.ComputeAABB = function (aabb, transform, childIndex) {\n        var p = b2Math_1.b2Transform.MulXV(transform, this.m_p, b2CircleShape.ComputeAABB_s_p);\n        aabb.lowerBound.Set(p.x - this.m_radius, p.y - this.m_radius);\n        aabb.upperBound.Set(p.x + this.m_radius, p.y + this.m_radius);\n    };\n    /// @see b2Shape::ComputeMass\n    b2CircleShape.prototype.ComputeMass = function (massData, density) {\n        var radius_sq = b2Math_1.b2Sq(this.m_radius);\n        massData.mass = density * b2Settings_1.b2_pi * radius_sq;\n        massData.center.Copy(this.m_p);\n        // inertia about the local origin\n        massData.I = massData.mass * (0.5 * radius_sq + b2Math_1.b2Vec2.DotVV(this.m_p, this.m_p));\n    };\n    b2CircleShape.prototype.SetupDistanceProxy = function (proxy, index) {\n        proxy.m_vertices = proxy.m_buffer;\n        proxy.m_vertices[0].Copy(this.m_p);\n        proxy.m_count = 1;\n        proxy.m_radius = this.m_radius;\n    };\n    b2CircleShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {\n        var p = b2Math_1.b2Transform.MulXV(xf, this.m_p, new b2Math_1.b2Vec2());\n        var l = (-(b2Math_1.b2Vec2.DotVV(normal, p) - offset));\n        if (l < (-this.m_radius) + b2Settings_1.b2_epsilon) {\n            // Completely dry\n            return 0;\n        }\n        if (l > this.m_radius) {\n            // Completely wet\n            c.Copy(p);\n            return b2Settings_1.b2_pi * this.m_radius * this.m_radius;\n        }\n        // Magic\n        var r2 = this.m_radius * this.m_radius;\n        var l2 = l * l;\n        var area = r2 * (b2Math_1.b2Asin(l / this.m_radius) + b2Settings_1.b2_pi / 2) + l * b2Math_1.b2Sqrt(r2 - l2);\n        var com = (-2 / 3 * b2Math_1.b2Pow(r2 - l2, 1.5) / area);\n        c.x = p.x + normal.x * com;\n        c.y = p.y + normal.y * com;\n        return area;\n    };\n    b2CircleShape.prototype.Dump = function (log) {\n        log(\"    const shape: b2CircleShape = new b2CircleShape();\\n\");\n        log(\"    shape.m_radius = %.15f;\\n\", this.m_radius);\n        log(\"    shape.m_p.Set(%.15f, %.15f);\\n\", this.m_p.x, this.m_p.y);\n    };\n    /// Implement b2Shape.\n    b2CircleShape.TestPoint_s_center = new b2Math_1.b2Vec2();\n    b2CircleShape.TestPoint_s_d = new b2Math_1.b2Vec2();\n    // #if B2_ENABLE_PARTICLE\n    /// @see b2Shape::ComputeDistance\n    b2CircleShape.ComputeDistance_s_center = new b2Math_1.b2Vec2();\n    // #endif\n    /// Implement b2Shape.\n    // Collision Detection in Interactive 3D Environments by Gino van den Bergen\n    // From Section 3.1.2\n    // x = s + a * r\n    // norm(x) = radius\n    b2CircleShape.RayCast_s_position = new b2Math_1.b2Vec2();\n    b2CircleShape.RayCast_s_s = new b2Math_1.b2Vec2();\n    b2CircleShape.RayCast_s_r = new b2Math_1.b2Vec2();\n    /// @see b2Shape::ComputeAABB\n    b2CircleShape.ComputeAABB_s_p = new b2Math_1.b2Vec2();\n    return b2CircleShape;\n}(b2Shape_1.b2Shape));\nexports.b2CircleShape = b2CircleShape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/Shapes/b2CircleShape.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/Shapes/b2EdgeShape.ts":
/*!***************************************************!*\
  !*** ./src/Box2D/Collision/Shapes/b2EdgeShape.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2010 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ./b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\n/// A line segment (edge) shape. These can be connected in chains or loops\n/// to other edge shapes. The connectivity information is used to ensure\n/// correct contact normals.\nvar b2EdgeShape = /** @class */ (function (_super) {\n    __extends(b2EdgeShape, _super);\n    function b2EdgeShape() {\n        var _this = _super.call(this, b2Shape_1.b2ShapeType.e_edgeShape, b2Settings_1.b2_polygonRadius) || this;\n        _this.m_vertex1 = new b2Math_1.b2Vec2();\n        _this.m_vertex2 = new b2Math_1.b2Vec2();\n        _this.m_vertex0 = new b2Math_1.b2Vec2();\n        _this.m_vertex3 = new b2Math_1.b2Vec2();\n        _this.m_hasVertex0 = false;\n        _this.m_hasVertex3 = false;\n        return _this;\n    }\n    /// Set this as an isolated edge.\n    b2EdgeShape.prototype.Set = function (v1, v2) {\n        this.m_vertex1.Copy(v1);\n        this.m_vertex2.Copy(v2);\n        this.m_hasVertex0 = false;\n        this.m_hasVertex3 = false;\n        return this;\n    };\n    /// Implement b2Shape.\n    b2EdgeShape.prototype.Clone = function () {\n        return new b2EdgeShape().Copy(this);\n    };\n    b2EdgeShape.prototype.Copy = function (other) {\n        _super.prototype.Copy.call(this, other);\n        /// b2Assert(other instanceof b2EdgeShape);\n        this.m_vertex1.Copy(other.m_vertex1);\n        this.m_vertex2.Copy(other.m_vertex2);\n        this.m_vertex0.Copy(other.m_vertex0);\n        this.m_vertex3.Copy(other.m_vertex3);\n        this.m_hasVertex0 = other.m_hasVertex0;\n        this.m_hasVertex3 = other.m_hasVertex3;\n        return this;\n    };\n    /// @see b2Shape::GetChildCount\n    b2EdgeShape.prototype.GetChildCount = function () {\n        return 1;\n    };\n    /// @see b2Shape::TestPoint\n    b2EdgeShape.prototype.TestPoint = function (xf, p) {\n        return false;\n    };\n    b2EdgeShape.prototype.ComputeDistance = function (xf, p, normal, childIndex) {\n        var v1 = b2Math_1.b2Transform.MulXV(xf, this.m_vertex1, b2EdgeShape.ComputeDistance_s_v1);\n        var v2 = b2Math_1.b2Transform.MulXV(xf, this.m_vertex2, b2EdgeShape.ComputeDistance_s_v2);\n        var d = b2Math_1.b2Vec2.SubVV(p, v1, b2EdgeShape.ComputeDistance_s_d);\n        var s = b2Math_1.b2Vec2.SubVV(v2, v1, b2EdgeShape.ComputeDistance_s_s);\n        var ds = b2Math_1.b2Vec2.DotVV(d, s);\n        if (ds > 0) {\n            var s2 = b2Math_1.b2Vec2.DotVV(s, s);\n            if (ds > s2) {\n                b2Math_1.b2Vec2.SubVV(p, v2, d);\n            }\n            else {\n                d.SelfMulSub(ds / s2, s);\n            }\n        }\n        normal.Copy(d);\n        return normal.Normalize();\n    };\n    b2EdgeShape.prototype.RayCast = function (output, input, xf, childIndex) {\n        // Put the ray into the edge's frame of reference.\n        var p1 = b2Math_1.b2Transform.MulTXV(xf, input.p1, b2EdgeShape.RayCast_s_p1);\n        var p2 = b2Math_1.b2Transform.MulTXV(xf, input.p2, b2EdgeShape.RayCast_s_p2);\n        var d = b2Math_1.b2Vec2.SubVV(p2, p1, b2EdgeShape.RayCast_s_d);\n        var v1 = this.m_vertex1;\n        var v2 = this.m_vertex2;\n        var e = b2Math_1.b2Vec2.SubVV(v2, v1, b2EdgeShape.RayCast_s_e);\n        var normal = output.normal.Set(e.y, -e.x).SelfNormalize();\n        // q = p1 + t * d\n        // dot(normal, q - v1) = 0\n        // dot(normal, p1 - v1) + t * dot(normal, d) = 0\n        var numerator = b2Math_1.b2Vec2.DotVV(normal, b2Math_1.b2Vec2.SubVV(v1, p1, b2Math_1.b2Vec2.s_t0));\n        var denominator = b2Math_1.b2Vec2.DotVV(normal, d);\n        if (denominator === 0) {\n            return false;\n        }\n        var t = numerator / denominator;\n        if (t < 0 || input.maxFraction < t) {\n            return false;\n        }\n        var q = b2Math_1.b2Vec2.AddVMulSV(p1, t, d, b2EdgeShape.RayCast_s_q);\n        // q = v1 + s * r\n        // s = dot(q - v1, r) / dot(r, r)\n        var r = b2Math_1.b2Vec2.SubVV(v2, v1, b2EdgeShape.RayCast_s_r);\n        var rr = b2Math_1.b2Vec2.DotVV(r, r);\n        if (rr === 0) {\n            return false;\n        }\n        var s = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(q, v1, b2Math_1.b2Vec2.s_t0), r) / rr;\n        if (s < 0 || 1 < s) {\n            return false;\n        }\n        output.fraction = t;\n        b2Math_1.b2Rot.MulRV(xf.q, output.normal, output.normal);\n        if (numerator > 0) {\n            output.normal.SelfNeg();\n        }\n        return true;\n    };\n    b2EdgeShape.prototype.ComputeAABB = function (aabb, xf, childIndex) {\n        var v1 = b2Math_1.b2Transform.MulXV(xf, this.m_vertex1, b2EdgeShape.ComputeAABB_s_v1);\n        var v2 = b2Math_1.b2Transform.MulXV(xf, this.m_vertex2, b2EdgeShape.ComputeAABB_s_v2);\n        b2Math_1.b2Vec2.MinV(v1, v2, aabb.lowerBound);\n        b2Math_1.b2Vec2.MaxV(v1, v2, aabb.upperBound);\n        var r = this.m_radius;\n        aabb.lowerBound.SelfSubXY(r, r);\n        aabb.upperBound.SelfAddXY(r, r);\n    };\n    /// @see b2Shape::ComputeMass\n    b2EdgeShape.prototype.ComputeMass = function (massData, density) {\n        massData.mass = 0;\n        b2Math_1.b2Vec2.MidVV(this.m_vertex1, this.m_vertex2, massData.center);\n        massData.I = 0;\n    };\n    b2EdgeShape.prototype.SetupDistanceProxy = function (proxy, index) {\n        proxy.m_vertices = proxy.m_buffer;\n        proxy.m_vertices[0].Copy(this.m_vertex1);\n        proxy.m_vertices[1].Copy(this.m_vertex2);\n        proxy.m_count = 2;\n        proxy.m_radius = this.m_radius;\n    };\n    b2EdgeShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {\n        c.SetZero();\n        return 0;\n    };\n    b2EdgeShape.prototype.Dump = function (log) {\n        log(\"    const shape: b2EdgeShape = new b2EdgeShape();\\n\");\n        log(\"    shape.m_radius = %.15f;\\n\", this.m_radius);\n        log(\"    shape.m_vertex0.Set(%.15f, %.15f);\\n\", this.m_vertex0.x, this.m_vertex0.y);\n        log(\"    shape.m_vertex1.Set(%.15f, %.15f);\\n\", this.m_vertex1.x, this.m_vertex1.y);\n        log(\"    shape.m_vertex2.Set(%.15f, %.15f);\\n\", this.m_vertex2.x, this.m_vertex2.y);\n        log(\"    shape.m_vertex3.Set(%.15f, %.15f);\\n\", this.m_vertex3.x, this.m_vertex3.y);\n        log(\"    shape.m_hasVertex0 = %s;\\n\", this.m_hasVertex0);\n        log(\"    shape.m_hasVertex3 = %s;\\n\", this.m_hasVertex3);\n    };\n    // #if B2_ENABLE_PARTICLE\n    /// @see b2Shape::ComputeDistance\n    b2EdgeShape.ComputeDistance_s_v1 = new b2Math_1.b2Vec2();\n    b2EdgeShape.ComputeDistance_s_v2 = new b2Math_1.b2Vec2();\n    b2EdgeShape.ComputeDistance_s_d = new b2Math_1.b2Vec2();\n    b2EdgeShape.ComputeDistance_s_s = new b2Math_1.b2Vec2();\n    // #endif\n    /// Implement b2Shape.\n    // p = p1 + t * d\n    // v = v1 + s * e\n    // p1 + t * d = v1 + s * e\n    // s * e - t * d = p1 - v1\n    b2EdgeShape.RayCast_s_p1 = new b2Math_1.b2Vec2();\n    b2EdgeShape.RayCast_s_p2 = new b2Math_1.b2Vec2();\n    b2EdgeShape.RayCast_s_d = new b2Math_1.b2Vec2();\n    b2EdgeShape.RayCast_s_e = new b2Math_1.b2Vec2();\n    b2EdgeShape.RayCast_s_q = new b2Math_1.b2Vec2();\n    b2EdgeShape.RayCast_s_r = new b2Math_1.b2Vec2();\n    /// @see b2Shape::ComputeAABB\n    b2EdgeShape.ComputeAABB_s_v1 = new b2Math_1.b2Vec2();\n    b2EdgeShape.ComputeAABB_s_v2 = new b2Math_1.b2Vec2();\n    return b2EdgeShape;\n}(b2Shape_1.b2Shape));\nexports.b2EdgeShape = b2EdgeShape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/Shapes/b2EdgeShape.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/Shapes/b2PolygonShape.ts":
/*!******************************************************!*\
  !*** ./src/Box2D/Collision/Shapes/b2PolygonShape.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ./b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Shape_2 = __webpack_require__(/*! ./b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\n/// A convex polygon. It is assumed that the interior of the polygon is to\n/// the left of each edge.\n/// Polygons have a maximum number of vertices equal to b2_maxPolygonVertices.\n/// In most cases you should not need many vertices for a convex polygon.\nvar b2PolygonShape = /** @class */ (function (_super) {\n    __extends(b2PolygonShape, _super);\n    function b2PolygonShape() {\n        var _this = _super.call(this, b2Shape_2.b2ShapeType.e_polygonShape, b2Settings_1.b2_polygonRadius) || this;\n        _this.m_centroid = new b2Math_1.b2Vec2(0, 0);\n        _this.m_vertices = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxPolygonVertices);\n        _this.m_normals = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxPolygonVertices);\n        _this.m_count = 0;\n        return _this;\n    }\n    /// Implement b2Shape.\n    b2PolygonShape.prototype.Clone = function () {\n        return new b2PolygonShape().Copy(this);\n    };\n    b2PolygonShape.prototype.Copy = function (other) {\n        _super.prototype.Copy.call(this, other);\n        /// b2Assert(other instanceof b2PolygonShape);\n        this.m_centroid.Copy(other.m_centroid);\n        this.m_count = other.m_count;\n        for (var i = 0; i < this.m_count; ++i) {\n            this.m_vertices[i].Copy(other.m_vertices[i]);\n            this.m_normals[i].Copy(other.m_normals[i]);\n        }\n        return this;\n    };\n    /// @see b2Shape::GetChildCount\n    b2PolygonShape.prototype.GetChildCount = function () {\n        return 1;\n    };\n    b2PolygonShape.prototype.Set = function (vertices, count, start) {\n        if (count === void 0) { count = vertices.length; }\n        if (start === void 0) { start = 0; }\n        /// b2Assert(3 <= count && count <= b2_maxPolygonVertices);\n        if (count < 3) {\n            return this.SetAsBox(1, 1);\n        }\n        var n = b2Math_1.b2Min(count, b2Settings_1.b2_maxPolygonVertices);\n        // Perform welding and copy vertices into local buffer.\n        var ps = b2PolygonShape.Set_s_ps;\n        var tempCount = 0;\n        for (var i = 0; i < n; ++i) {\n            var /*b2Vec2*/ v = vertices[start + i];\n            var /*bool*/ unique = true;\n            for (var /*int32*/ j = 0; j < tempCount; ++j) {\n                if (b2Math_1.b2Vec2.DistanceSquaredVV(v, ps[j]) < ((0.5 * b2Settings_1.b2_linearSlop) * (0.5 * b2Settings_1.b2_linearSlop))) {\n                    unique = false;\n                    break;\n                }\n            }\n            if (unique) {\n                ps[tempCount++].Copy(v); // ps[tempCount++] = v;\n            }\n        }\n        n = tempCount;\n        if (n < 3) {\n            // Polygon is degenerate.\n            /// b2Assert(false);\n            return this.SetAsBox(1.0, 1.0);\n        }\n        // Create the convex hull using the Gift wrapping algorithm\n        // http://en.wikipedia.org/wiki/Gift_wrapping_algorithm\n        // Find the right most point on the hull\n        var i0 = 0;\n        var x0 = ps[0].x;\n        for (var i = 1; i < n; ++i) {\n            var x = ps[i].x;\n            if (x > x0 || (x === x0 && ps[i].y < ps[i0].y)) {\n                i0 = i;\n                x0 = x;\n            }\n        }\n        var hull = b2PolygonShape.Set_s_hull;\n        var m = 0;\n        var ih = i0;\n        for (;;) {\n            hull[m] = ih;\n            var ie = 0;\n            for (var j = 1; j < n; ++j) {\n                if (ie === ih) {\n                    ie = j;\n                    continue;\n                }\n                var r = b2Math_1.b2Vec2.SubVV(ps[ie], ps[hull[m]], b2PolygonShape.Set_s_r);\n                var v = b2Math_1.b2Vec2.SubVV(ps[j], ps[hull[m]], b2PolygonShape.Set_s_v);\n                var c = b2Math_1.b2Vec2.CrossVV(r, v);\n                if (c < 0) {\n                    ie = j;\n                }\n                // Collinearity check\n                if (c === 0 && v.LengthSquared() > r.LengthSquared()) {\n                    ie = j;\n                }\n            }\n            ++m;\n            ih = ie;\n            if (ie === i0) {\n                break;\n            }\n        }\n        this.m_count = m;\n        // Copy vertices.\n        for (var i = 0; i < m; ++i) {\n            this.m_vertices[i].Copy(ps[hull[i]]);\n        }\n        // Compute normals. Ensure the edges have non-zero length.\n        for (var i = 0; i < m; ++i) {\n            var vertexi1 = this.m_vertices[i];\n            var vertexi2 = this.m_vertices[(i + 1) % m];\n            var edge = b2Math_1.b2Vec2.SubVV(vertexi2, vertexi1, b2Math_1.b2Vec2.s_t0); // edge uses s_t0\n            /// b2Assert(edge.LengthSquared() > b2_epsilon_sq);\n            b2Math_1.b2Vec2.CrossVOne(edge, this.m_normals[i]).SelfNormalize();\n        }\n        // Compute the polygon centroid.\n        b2PolygonShape.ComputeCentroid(this.m_vertices, m, this.m_centroid);\n        return this;\n    };\n    b2PolygonShape.prototype.SetAsArray = function (vertices, count) {\n        if (count === void 0) { count = vertices.length; }\n        return this.Set(vertices, count);\n    };\n    /// Build vertices to represent an axis-aligned box or an oriented box.\n    /// @param hx the half-width.\n    /// @param hy the half-height.\n    /// @param center the center of the box in local coordinates.\n    /// @param angle the rotation of the box in local coordinates.\n    b2PolygonShape.prototype.SetAsBox = function (hx, hy, center, angle) {\n        if (angle === void 0) { angle = 0; }\n        this.m_count = 4;\n        this.m_vertices[0].Set((-hx), (-hy));\n        this.m_vertices[1].Set(hx, (-hy));\n        this.m_vertices[2].Set(hx, hy);\n        this.m_vertices[3].Set((-hx), hy);\n        this.m_normals[0].Set(0, (-1));\n        this.m_normals[1].Set(1, 0);\n        this.m_normals[2].Set(0, 1);\n        this.m_normals[3].Set((-1), 0);\n        this.m_centroid.SetZero();\n        if (center instanceof b2Math_1.b2Vec2) {\n            this.m_centroid.Copy(center);\n            var xf = new b2Math_1.b2Transform();\n            xf.SetPosition(center);\n            xf.SetRotationAngle(angle);\n            // Transform vertices and normals.\n            for (var i = 0; i < this.m_count; ++i) {\n                b2Math_1.b2Transform.MulXV(xf, this.m_vertices[i], this.m_vertices[i]);\n                b2Math_1.b2Rot.MulRV(xf.q, this.m_normals[i], this.m_normals[i]);\n            }\n        }\n        return this;\n    };\n    b2PolygonShape.prototype.TestPoint = function (xf, p) {\n        var pLocal = b2Math_1.b2Transform.MulTXV(xf, p, b2PolygonShape.TestPoint_s_pLocal);\n        for (var i = 0; i < this.m_count; ++i) {\n            var dot = b2Math_1.b2Vec2.DotVV(this.m_normals[i], b2Math_1.b2Vec2.SubVV(pLocal, this.m_vertices[i], b2Math_1.b2Vec2.s_t0));\n            if (dot > 0) {\n                return false;\n            }\n        }\n        return true;\n    };\n    b2PolygonShape.prototype.ComputeDistance = function (xf, p, normal, childIndex) {\n        var pLocal = b2Math_1.b2Transform.MulTXV(xf, p, b2PolygonShape.ComputeDistance_s_pLocal);\n        var maxDistance = -b2Settings_1.b2_maxFloat;\n        var normalForMaxDistance = b2PolygonShape.ComputeDistance_s_normalForMaxDistance.Copy(pLocal);\n        for (var i = 0; i < this.m_count; ++i) {\n            var dot = b2Math_1.b2Vec2.DotVV(this.m_normals[i], b2Math_1.b2Vec2.SubVV(pLocal, this.m_vertices[i], b2Math_1.b2Vec2.s_t0));\n            if (dot > maxDistance) {\n                maxDistance = dot;\n                normalForMaxDistance.Copy(this.m_normals[i]);\n            }\n        }\n        if (maxDistance > 0) {\n            var minDistance = b2PolygonShape.ComputeDistance_s_minDistance.Copy(normalForMaxDistance);\n            var minDistance2 = maxDistance * maxDistance;\n            for (var i = 0; i < this.m_count; ++i) {\n                var distance = b2Math_1.b2Vec2.SubVV(pLocal, this.m_vertices[i], b2PolygonShape.ComputeDistance_s_distance);\n                var distance2 = distance.LengthSquared();\n                if (minDistance2 > distance2) {\n                    minDistance.Copy(distance);\n                    minDistance2 = distance2;\n                }\n            }\n            b2Math_1.b2Rot.MulRV(xf.q, minDistance, normal);\n            normal.Normalize();\n            return Math.sqrt(minDistance2);\n        }\n        else {\n            b2Math_1.b2Rot.MulRV(xf.q, normalForMaxDistance, normal);\n            return maxDistance;\n        }\n    };\n    b2PolygonShape.prototype.RayCast = function (output, input, xf, childIndex) {\n        // Put the ray into the polygon's frame of reference.\n        var p1 = b2Math_1.b2Transform.MulTXV(xf, input.p1, b2PolygonShape.RayCast_s_p1);\n        var p2 = b2Math_1.b2Transform.MulTXV(xf, input.p2, b2PolygonShape.RayCast_s_p2);\n        var d = b2Math_1.b2Vec2.SubVV(p2, p1, b2PolygonShape.RayCast_s_d);\n        var lower = 0, upper = input.maxFraction;\n        var index = -1;\n        for (var i = 0; i < this.m_count; ++i) {\n            // p = p1 + a * d\n            // dot(normal, p - v) = 0\n            // dot(normal, p1 - v) + a * dot(normal, d) = 0\n            var numerator = b2Math_1.b2Vec2.DotVV(this.m_normals[i], b2Math_1.b2Vec2.SubVV(this.m_vertices[i], p1, b2Math_1.b2Vec2.s_t0));\n            var denominator = b2Math_1.b2Vec2.DotVV(this.m_normals[i], d);\n            if (denominator === 0) {\n                if (numerator < 0) {\n                    return false;\n                }\n            }\n            else {\n                // Note: we want this predicate without division:\n                // lower < numerator / denominator, where denominator < 0\n                // Since denominator < 0, we have to flip the inequality:\n                // lower < numerator / denominator <==> denominator * lower > numerator.\n                if (denominator < 0 && numerator < lower * denominator) {\n                    // Increase lower.\n                    // The segment enters this half-space.\n                    lower = numerator / denominator;\n                    index = i;\n                }\n                else if (denominator > 0 && numerator < upper * denominator) {\n                    // Decrease upper.\n                    // The segment exits this half-space.\n                    upper = numerator / denominator;\n                }\n            }\n            // The use of epsilon here causes the assert on lower to trip\n            // in some cases. Apparently the use of epsilon was to make edge\n            // shapes work, but now those are handled separately.\n            // if (upper < lower - b2_epsilon)\n            if (upper < lower) {\n                return false;\n            }\n        }\n        /// b2Assert(0 <= lower && lower <= input.maxFraction);\n        if (index >= 0) {\n            output.fraction = lower;\n            b2Math_1.b2Rot.MulRV(xf.q, this.m_normals[index], output.normal);\n            return true;\n        }\n        return false;\n    };\n    b2PolygonShape.prototype.ComputeAABB = function (aabb, xf, childIndex) {\n        var lower = b2Math_1.b2Transform.MulXV(xf, this.m_vertices[0], aabb.lowerBound);\n        var upper = aabb.upperBound.Copy(lower);\n        for (var i = 0; i < this.m_count; ++i) {\n            var v = b2Math_1.b2Transform.MulXV(xf, this.m_vertices[i], b2PolygonShape.ComputeAABB_s_v);\n            b2Math_1.b2Vec2.MinV(v, lower, lower);\n            b2Math_1.b2Vec2.MaxV(v, upper, upper);\n        }\n        var r = this.m_radius;\n        lower.SelfSubXY(r, r);\n        upper.SelfAddXY(r, r);\n    };\n    b2PolygonShape.prototype.ComputeMass = function (massData, density) {\n        // Polygon mass, centroid, and inertia.\n        // Let rho be the polygon density in mass per unit area.\n        // Then:\n        // mass = rho * int(dA)\n        // centroid.x = (1/mass) * rho * int(x * dA)\n        // centroid.y = (1/mass) * rho * int(y * dA)\n        // I = rho * int((x*x + y*y) * dA)\n        //\n        // We can compute these integrals by summing all the integrals\n        // for each triangle of the polygon. To evaluate the integral\n        // for a single triangle, we make a change of variables to\n        // the (u,v) coordinates of the triangle:\n        // x = x0 + e1x * u + e2x * v\n        // y = y0 + e1y * u + e2y * v\n        // where 0 <= u && 0 <= v && u + v <= 1.\n        //\n        // We integrate u from [0,1-v] and then v from [0,1].\n        // We also need to use the Jacobian of the transformation:\n        // D = cross(e1, e2)\n        //\n        // Simplification: triangle centroid = (1/3) * (p1 + p2 + p3)\n        //\n        // The rest of the derivation is handled by computer algebra.\n        /// b2Assert(this.m_count >= 3);\n        var center = b2PolygonShape.ComputeMass_s_center.SetZero();\n        var area = 0;\n        var I = 0;\n        // s is the reference point for forming triangles.\n        // It's location doesn't change the result (except for rounding error).\n        var s = b2PolygonShape.ComputeMass_s_s.SetZero();\n        // This code would put the reference point inside the polygon.\n        for (var i = 0; i < this.m_count; ++i) {\n            s.SelfAdd(this.m_vertices[i]);\n        }\n        s.SelfMul(1 / this.m_count);\n        var k_inv3 = 1 / 3;\n        for (var i = 0; i < this.m_count; ++i) {\n            // Triangle vertices.\n            var e1 = b2Math_1.b2Vec2.SubVV(this.m_vertices[i], s, b2PolygonShape.ComputeMass_s_e1);\n            var e2 = b2Math_1.b2Vec2.SubVV(this.m_vertices[(i + 1) % this.m_count], s, b2PolygonShape.ComputeMass_s_e2);\n            var D = b2Math_1.b2Vec2.CrossVV(e1, e2);\n            var triangleArea = 0.5 * D;\n            area += triangleArea;\n            // Area weighted centroid\n            center.SelfAdd(b2Math_1.b2Vec2.MulSV(triangleArea * k_inv3, b2Math_1.b2Vec2.AddVV(e1, e2, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t1));\n            var ex1 = e1.x;\n            var ey1 = e1.y;\n            var ex2 = e2.x;\n            var ey2 = e2.y;\n            var intx2 = ex1 * ex1 + ex2 * ex1 + ex2 * ex2;\n            var inty2 = ey1 * ey1 + ey2 * ey1 + ey2 * ey2;\n            I += (0.25 * k_inv3 * D) * (intx2 + inty2);\n        }\n        // Total mass\n        massData.mass = density * area;\n        // Center of mass\n        /// b2Assert(area > b2_epsilon);\n        center.SelfMul(1 / area);\n        b2Math_1.b2Vec2.AddVV(center, s, massData.center);\n        // Inertia tensor relative to the local origin (point s).\n        massData.I = density * I;\n        // Shift to center of mass then to original body origin.\n        massData.I += massData.mass * (b2Math_1.b2Vec2.DotVV(massData.center, massData.center) - b2Math_1.b2Vec2.DotVV(center, center));\n    };\n    b2PolygonShape.prototype.Validate = function () {\n        for (var i = 0; i < this.m_count; ++i) {\n            var i1 = i;\n            var i2 = (i + 1) % this.m_count;\n            var p = this.m_vertices[i1];\n            var e = b2Math_1.b2Vec2.SubVV(this.m_vertices[i2], p, b2PolygonShape.Validate_s_e);\n            for (var j = 0; j < this.m_count; ++j) {\n                if (j === i1 || j === i2) {\n                    continue;\n                }\n                var v = b2Math_1.b2Vec2.SubVV(this.m_vertices[j], p, b2PolygonShape.Validate_s_v);\n                var c = b2Math_1.b2Vec2.CrossVV(e, v);\n                if (c < 0) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    };\n    b2PolygonShape.prototype.SetupDistanceProxy = function (proxy, index) {\n        proxy.m_vertices = this.m_vertices;\n        proxy.m_count = this.m_count;\n        proxy.m_radius = this.m_radius;\n    };\n    b2PolygonShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {\n        // Transform plane into shape co-ordinates\n        var normalL = b2Math_1.b2Rot.MulTRV(xf.q, normal, b2PolygonShape.ComputeSubmergedArea_s_normalL);\n        var offsetL = offset - b2Math_1.b2Vec2.DotVV(normal, xf.p);\n        var depths = b2PolygonShape.ComputeSubmergedArea_s_depths;\n        var diveCount = 0;\n        var intoIndex = -1;\n        var outoIndex = -1;\n        var lastSubmerged = false;\n        // tslint:disable-next-line:no-shadowed-variable\n        for (var i_1 = 0; i_1 < this.m_count; ++i_1) {\n            depths[i_1] = b2Math_1.b2Vec2.DotVV(normalL, this.m_vertices[i_1]) - offsetL;\n            var isSubmerged = depths[i_1] < (-b2Settings_1.b2_epsilon);\n            if (i_1 > 0) {\n                if (isSubmerged) {\n                    if (!lastSubmerged) {\n                        intoIndex = i_1 - 1;\n                        diveCount++;\n                    }\n                }\n                else {\n                    if (lastSubmerged) {\n                        outoIndex = i_1 - 1;\n                        diveCount++;\n                    }\n                }\n            }\n            lastSubmerged = isSubmerged;\n        }\n        switch (diveCount) {\n            case 0:\n                if (lastSubmerged) {\n                    // Completely submerged\n                    var md = b2PolygonShape.ComputeSubmergedArea_s_md;\n                    this.ComputeMass(md, 1);\n                    b2Math_1.b2Transform.MulXV(xf, md.center, c);\n                    return md.mass;\n                }\n                else {\n                    // Completely dry\n                    return 0;\n                }\n            case 1:\n                if (intoIndex === (-1)) {\n                    intoIndex = this.m_count - 1;\n                }\n                else {\n                    outoIndex = this.m_count - 1;\n                }\n                break;\n        }\n        var intoIndex2 = ((intoIndex + 1) % this.m_count);\n        var outoIndex2 = ((outoIndex + 1) % this.m_count);\n        var intoLamdda = (0 - depths[intoIndex]) / (depths[intoIndex2] - depths[intoIndex]);\n        var outoLamdda = (0 - depths[outoIndex]) / (depths[outoIndex2] - depths[outoIndex]);\n        var intoVec = b2PolygonShape.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[intoIndex].x * (1 - intoLamdda) + this.m_vertices[intoIndex2].x * intoLamdda, this.m_vertices[intoIndex].y * (1 - intoLamdda) + this.m_vertices[intoIndex2].y * intoLamdda);\n        var outoVec = b2PolygonShape.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[outoIndex].x * (1 - outoLamdda) + this.m_vertices[outoIndex2].x * outoLamdda, this.m_vertices[outoIndex].y * (1 - outoLamdda) + this.m_vertices[outoIndex2].y * outoLamdda);\n        // Initialize accumulator\n        var area = 0;\n        var center = b2PolygonShape.ComputeSubmergedArea_s_center.SetZero();\n        var p2 = this.m_vertices[intoIndex2];\n        var p3;\n        // An awkward loop from intoIndex2+1 to outIndex2\n        var i = intoIndex2;\n        while (i !== outoIndex2) {\n            i = (i + 1) % this.m_count;\n            if (i === outoIndex2) {\n                p3 = outoVec;\n            }\n            else {\n                p3 = this.m_vertices[i];\n            }\n            var triangleArea = 0.5 * ((p2.x - intoVec.x) * (p3.y - intoVec.y) - (p2.y - intoVec.y) * (p3.x - intoVec.x));\n            area += triangleArea;\n            // Area weighted centroid\n            center.x += triangleArea * (intoVec.x + p2.x + p3.x) / 3;\n            center.y += triangleArea * (intoVec.y + p2.y + p3.y) / 3;\n            p2 = p3;\n        }\n        // Normalize and transform centroid\n        center.SelfMul(1 / area);\n        b2Math_1.b2Transform.MulXV(xf, center, c);\n        return area;\n    };\n    b2PolygonShape.prototype.Dump = function (log) {\n        log(\"    const shape: b2PolygonShape = new b2PolygonShape();\\n\");\n        log(\"    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\\n\", b2Settings_1.b2_maxPolygonVertices);\n        for (var i = 0; i < this.m_count; ++i) {\n            log(\"    vs[%d].Set(%.15f, %.15f);\\n\", i, this.m_vertices[i].x, this.m_vertices[i].y);\n        }\n        log(\"    shape.Set(vs, %d);\\n\", this.m_count);\n    };\n    b2PolygonShape.ComputeCentroid = function (vs, count, out) {\n        /// b2Assert(count >= 3);\n        var c = out;\n        c.SetZero();\n        var area = 0;\n        // s is the reference point for forming triangles.\n        // It's location doesn't change the result (except for rounding error).\n        var pRef = b2PolygonShape.ComputeCentroid_s_pRef.SetZero();\n        /*\n    #if 0\n        // This code would put the reference point inside the polygon.\n        for (let i: number = 0; i < count; ++i) {\n          pRef.SelfAdd(vs[i]);\n        }\n        pRef.SelfMul(1 / count);\n    #endif\n        */\n        var inv3 = 1 / 3;\n        for (var i = 0; i < count; ++i) {\n            // Triangle vertices.\n            var p1 = pRef;\n            var p2 = vs[i];\n            var p3 = vs[(i + 1) % count];\n            var e1 = b2Math_1.b2Vec2.SubVV(p2, p1, b2PolygonShape.ComputeCentroid_s_e1);\n            var e2 = b2Math_1.b2Vec2.SubVV(p3, p1, b2PolygonShape.ComputeCentroid_s_e2);\n            var D = b2Math_1.b2Vec2.CrossVV(e1, e2);\n            var triangleArea = 0.5 * D;\n            area += triangleArea;\n            // Area weighted centroid\n            c.x += triangleArea * inv3 * (p1.x + p2.x + p3.x);\n            c.y += triangleArea * inv3 * (p1.y + p2.y + p3.y);\n        }\n        // Centroid\n        /// b2Assert(area > b2_epsilon);\n        c.SelfMul(1 / area);\n        return c;\n    };\n    /// Create a convex hull from the given array of points.\n    /// The count must be in the range [3, b2_maxPolygonVertices].\n    /// @warning the points may be re-ordered, even if they form a convex polygon\n    /// @warning collinear points are handled but not removed. Collinear points\n    /// may lead to poor stacking behavior.\n    b2PolygonShape.Set_s_ps = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxPolygonVertices);\n    b2PolygonShape.Set_s_hull = b2Settings_1.b2MakeNumberArray(b2Settings_1.b2_maxPolygonVertices);\n    b2PolygonShape.Set_s_r = new b2Math_1.b2Vec2();\n    b2PolygonShape.Set_s_v = new b2Math_1.b2Vec2();\n    /// @see b2Shape::TestPoint\n    b2PolygonShape.TestPoint_s_pLocal = new b2Math_1.b2Vec2();\n    // #if B2_ENABLE_PARTICLE\n    /// @see b2Shape::ComputeDistance\n    b2PolygonShape.ComputeDistance_s_pLocal = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeDistance_s_normalForMaxDistance = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeDistance_s_minDistance = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeDistance_s_distance = new b2Math_1.b2Vec2();\n    // #endif\n    /// Implement b2Shape.\n    b2PolygonShape.RayCast_s_p1 = new b2Math_1.b2Vec2();\n    b2PolygonShape.RayCast_s_p2 = new b2Math_1.b2Vec2();\n    b2PolygonShape.RayCast_s_d = new b2Math_1.b2Vec2();\n    /// @see b2Shape::ComputeAABB\n    b2PolygonShape.ComputeAABB_s_v = new b2Math_1.b2Vec2();\n    /// @see b2Shape::ComputeMass\n    b2PolygonShape.ComputeMass_s_center = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeMass_s_s = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeMass_s_e1 = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeMass_s_e2 = new b2Math_1.b2Vec2();\n    b2PolygonShape.Validate_s_e = new b2Math_1.b2Vec2();\n    b2PolygonShape.Validate_s_v = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeSubmergedArea_s_normalL = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeSubmergedArea_s_depths = b2Settings_1.b2MakeNumberArray(b2Settings_1.b2_maxPolygonVertices);\n    b2PolygonShape.ComputeSubmergedArea_s_md = new b2Shape_1.b2MassData();\n    b2PolygonShape.ComputeSubmergedArea_s_intoVec = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeSubmergedArea_s_outoVec = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeSubmergedArea_s_center = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeCentroid_s_pRef = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeCentroid_s_e1 = new b2Math_1.b2Vec2();\n    b2PolygonShape.ComputeCentroid_s_e2 = new b2Math_1.b2Vec2();\n    return b2PolygonShape;\n}(b2Shape_2.b2Shape));\nexports.b2PolygonShape = b2PolygonShape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/Shapes/b2PolygonShape.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/Shapes/b2Shape.ts":
/*!***********************************************!*\
  !*** ./src/Box2D/Collision/Shapes/b2Shape.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\n/// This holds the mass data computed for a shape.\nvar b2MassData = /** @class */ (function () {\n    function b2MassData() {\n        /// The mass of the shape, usually in kilograms.\n        this.mass = 0;\n        /// The position of the shape's centroid relative to the shape's origin.\n        this.center = new b2Math_1.b2Vec2(0, 0);\n        /// The rotational inertia of the shape about the local origin.\n        this.I = 0;\n    }\n    return b2MassData;\n}());\nexports.b2MassData = b2MassData;\nvar b2ShapeType;\n(function (b2ShapeType) {\n    b2ShapeType[b2ShapeType[\"e_unknown\"] = -1] = \"e_unknown\";\n    b2ShapeType[b2ShapeType[\"e_circleShape\"] = 0] = \"e_circleShape\";\n    b2ShapeType[b2ShapeType[\"e_edgeShape\"] = 1] = \"e_edgeShape\";\n    b2ShapeType[b2ShapeType[\"e_polygonShape\"] = 2] = \"e_polygonShape\";\n    b2ShapeType[b2ShapeType[\"e_chainShape\"] = 3] = \"e_chainShape\";\n    b2ShapeType[b2ShapeType[\"e_shapeTypeCount\"] = 4] = \"e_shapeTypeCount\";\n})(b2ShapeType = exports.b2ShapeType || (exports.b2ShapeType = {}));\n/// A shape is used for collision detection. You can create a shape however you like.\n/// Shapes used for simulation in b2World are created automatically when a b2Fixture\n/// is created. Shapes may encapsulate a one or more child shapes.\nvar b2Shape = /** @class */ (function () {\n    function b2Shape(type, radius) {\n        this.m_type = b2ShapeType.e_unknown;\n        this.m_radius = 0;\n        this.m_type = type;\n        this.m_radius = radius;\n    }\n    b2Shape.prototype.Copy = function (other) {\n        /// b2Assert(this.m_type === other.m_type);\n        this.m_radius = other.m_radius;\n        return this;\n    };\n    /// Get the type of this shape. You can use this to down cast to the concrete shape.\n    /// @return the shape type.\n    b2Shape.prototype.GetType = function () {\n        return this.m_type;\n    };\n    return b2Shape;\n}());\nexports.b2Shape = b2Shape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/Shapes/b2Shape.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2BroadPhase.ts":
/*!*********************************************!*\
  !*** ./src/Box2D/Collision/b2BroadPhase.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Collision_1 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2DynamicTree_1 = __webpack_require__(/*! ./b2DynamicTree */ \"./src/Box2D/Collision/b2DynamicTree.ts\");\nvar b2Pair = /** @class */ (function () {\n    function b2Pair() {\n        this.proxyA = null;\n        this.proxyB = null;\n    }\n    return b2Pair;\n}());\nexports.b2Pair = b2Pair;\n/// The broad-phase is used for computing pairs and performing volume queries and ray casts.\n/// This broad-phase does not persist pairs. Instead, this reports potentially new pairs.\n/// It is up to the client to consume the new pairs and to track subsequent overlap.\nvar b2BroadPhase = /** @class */ (function () {\n    function b2BroadPhase() {\n        this.m_tree = new b2DynamicTree_1.b2DynamicTree();\n        this.m_proxyCount = 0;\n        // public m_moveCapacity: number = 16;\n        this.m_moveCount = 0;\n        this.m_moveBuffer = [];\n        // public m_pairCapacity: number = 16;\n        this.m_pairCount = 0;\n        this.m_pairBuffer = [];\n    }\n    // public m_queryProxyId: number = 0;\n    /// Create a proxy with an initial AABB. Pairs are not reported until\n    /// UpdatePairs is called.\n    b2BroadPhase.prototype.CreateProxy = function (aabb, userData) {\n        var proxy = this.m_tree.CreateProxy(aabb, userData);\n        ++this.m_proxyCount;\n        this.BufferMove(proxy);\n        return proxy;\n    };\n    /// Destroy a proxy. It is up to the client to remove any pairs.\n    b2BroadPhase.prototype.DestroyProxy = function (proxy) {\n        this.UnBufferMove(proxy);\n        --this.m_proxyCount;\n        this.m_tree.DestroyProxy(proxy);\n    };\n    /// Call MoveProxy as many times as you like, then when you are done\n    /// call UpdatePairs to finalized the proxy pairs (for your time step).\n    b2BroadPhase.prototype.MoveProxy = function (proxy, aabb, displacement) {\n        var buffer = this.m_tree.MoveProxy(proxy, aabb, displacement);\n        if (buffer) {\n            this.BufferMove(proxy);\n        }\n    };\n    /// Call to trigger a re-processing of it's pairs on the next call to UpdatePairs.\n    b2BroadPhase.prototype.TouchProxy = function (proxy) {\n        this.BufferMove(proxy);\n    };\n    /// Get the fat AABB for a proxy.\n    b2BroadPhase.prototype.GetFatAABB = function (proxy) {\n        return this.m_tree.GetFatAABB(proxy);\n    };\n    /// Get user data from a proxy. Returns NULL if the id is invalid.\n    b2BroadPhase.prototype.GetUserData = function (proxy) {\n        return this.m_tree.GetUserData(proxy);\n    };\n    /// Test overlap of fat AABBs.\n    b2BroadPhase.prototype.TestOverlap = function (proxyA, proxyB) {\n        var aabbA = this.m_tree.GetFatAABB(proxyA);\n        var aabbB = this.m_tree.GetFatAABB(proxyB);\n        return b2Collision_1.b2TestOverlapAABB(aabbA, aabbB);\n    };\n    /// Get the number of proxies.\n    b2BroadPhase.prototype.GetProxyCount = function () {\n        return this.m_proxyCount;\n    };\n    /// Update the pairs. This results in pair callbacks. This can only add pairs.\n    b2BroadPhase.prototype.UpdatePairs = function (contactManager) {\n        var _this = this;\n        // Reset pair buffer\n        this.m_pairCount = 0;\n        var _loop_1 = function (i_1) {\n            var queryProxy = this_1.m_moveBuffer[i_1];\n            if (queryProxy === null) {\n                return \"continue\";\n            }\n            // This is called from box2d.b2DynamicTree::Query when we are gathering pairs.\n            // boolean b2BroadPhase::QueryCallback(int32 proxyId);\n            var QueryCallback = function (proxy) {\n                // A proxy cannot form a pair with itself.\n                if (proxy.m_id === queryProxy.m_id) {\n                    return true;\n                }\n                // Grow the pair buffer as needed.\n                if (_this.m_pairCount === _this.m_pairBuffer.length) {\n                    _this.m_pairBuffer[_this.m_pairCount] = new b2Pair();\n                }\n                var pair = _this.m_pairBuffer[_this.m_pairCount];\n                // pair.proxyA = proxy < queryProxy ? proxy : queryProxy;\n                // pair.proxyB = proxy >= queryProxy ? proxy : queryProxy;\n                if (proxy.m_id < queryProxy.m_id) {\n                    pair.proxyA = proxy;\n                    pair.proxyB = queryProxy;\n                }\n                else {\n                    pair.proxyA = queryProxy;\n                    pair.proxyB = proxy;\n                }\n                ++_this.m_pairCount;\n                return true;\n            };\n            // We have to query the tree with the fat AABB so that\n            // we don't fail to create a pair that may touch later.\n            var fatAABB = this_1.m_tree.GetFatAABB(queryProxy);\n            // Query tree, create pairs and add them pair buffer.\n            this_1.m_tree.Query(QueryCallback, fatAABB);\n        };\n        var this_1 = this;\n        // Perform tree queries for all moving proxies.\n        // tslint:disable-next-line:no-shadowed-variable\n        for (var i_1 = 0; i_1 < this.m_moveCount; ++i_1) {\n            _loop_1(i_1);\n        }\n        // Reset move buffer\n        this.m_moveCount = 0;\n        // Sort the pair buffer to expose duplicates.\n        this.m_pairBuffer.length = this.m_pairCount;\n        this.m_pairBuffer.sort(b2PairLessThan);\n        // Send the pairs back to the client.\n        var i = 0;\n        while (i < this.m_pairCount) {\n            var primaryPair = this.m_pairBuffer[i];\n            var userDataA = this.m_tree.GetUserData(primaryPair.proxyA);\n            var userDataB = this.m_tree.GetUserData(primaryPair.proxyB);\n            contactManager.AddPair(userDataA, userDataB);\n            ++i;\n            // Skip any duplicate pairs.\n            while (i < this.m_pairCount) {\n                var pair = this.m_pairBuffer[i];\n                if (pair.proxyA.m_id !== primaryPair.proxyA.m_id || pair.proxyB.m_id !== primaryPair.proxyB.m_id) {\n                    break;\n                }\n                ++i;\n            }\n        }\n        // Try to keep the tree balanced.\n        // this.m_tree.Rebalance(4);\n    };\n    /// Query an AABB for overlapping proxies. The callback class\n    /// is called for each proxy that overlaps the supplied AABB.\n    b2BroadPhase.prototype.Query = function (callback, aabb) {\n        this.m_tree.Query(callback, aabb);\n    };\n    /// Ray-cast against the proxies in the tree. This relies on the callback\n    /// to perform a exact ray-cast in the case were the proxy contains a shape.\n    /// The callback also performs the any collision filtering. This has performance\n    /// roughly equal to k * log(n), where k is the number of collisions and n is the\n    /// number of proxies in the tree.\n    /// @param input the ray-cast input data. The ray extends from p1 to p1 + maxFraction * (p2 - p1).\n    /// @param callback a callback class that is called for each proxy that is hit by the ray.\n    b2BroadPhase.prototype.RayCast = function (callback, input) {\n        this.m_tree.RayCast(callback, input);\n    };\n    /// Get the height of the embedded tree.\n    b2BroadPhase.prototype.GetTreeHeight = function () {\n        return this.m_tree.GetHeight();\n    };\n    /// Get the balance of the embedded tree.\n    b2BroadPhase.prototype.GetTreeBalance = function () {\n        return this.m_tree.GetMaxBalance();\n    };\n    /// Get the quality metric of the embedded tree.\n    b2BroadPhase.prototype.GetTreeQuality = function () {\n        return this.m_tree.GetAreaRatio();\n    };\n    /// Shift the world origin. Useful for large worlds.\n    /// The shift formula is: position -= newOrigin\n    /// @param newOrigin the new origin with respect to the old origin\n    b2BroadPhase.prototype.ShiftOrigin = function (newOrigin) {\n        this.m_tree.ShiftOrigin(newOrigin);\n    };\n    b2BroadPhase.prototype.BufferMove = function (proxy) {\n        this.m_moveBuffer[this.m_moveCount] = proxy;\n        ++this.m_moveCount;\n    };\n    b2BroadPhase.prototype.UnBufferMove = function (proxy) {\n        var i = this.m_moveBuffer.indexOf(proxy);\n        this.m_moveBuffer[i] = null;\n    };\n    return b2BroadPhase;\n}());\nexports.b2BroadPhase = b2BroadPhase;\n/// This is used to sort pairs.\nfunction b2PairLessThan(pair1, pair2) {\n    if (pair1.proxyA.m_id === pair2.proxyA.m_id) {\n        return pair1.proxyB.m_id - pair2.proxyB.m_id;\n    }\n    return pair1.proxyA.m_id - pair2.proxyA.m_id;\n}\nexports.b2PairLessThan = b2PairLessThan;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2BroadPhase.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2CollideCircle.ts":
/*!************************************************!*\
  !*** ./src/Box2D/Collision/b2CollideCircle.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Collision_1 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2CollideCircles_s_pA = new b2Math_1.b2Vec2();\nvar b2CollideCircles_s_pB = new b2Math_1.b2Vec2();\nfunction b2CollideCircles(manifold, circleA, xfA, circleB, xfB) {\n    manifold.pointCount = 0;\n    var pA = b2Math_1.b2Transform.MulXV(xfA, circleA.m_p, b2CollideCircles_s_pA);\n    var pB = b2Math_1.b2Transform.MulXV(xfB, circleB.m_p, b2CollideCircles_s_pB);\n    var distSqr = b2Math_1.b2Vec2.DistanceSquaredVV(pA, pB);\n    var radius = circleA.m_radius + circleB.m_radius;\n    if (distSqr > radius * radius) {\n        return;\n    }\n    manifold.type = b2Collision_1.b2ManifoldType.e_circles;\n    manifold.localPoint.Copy(circleA.m_p);\n    manifold.localNormal.SetZero();\n    manifold.pointCount = 1;\n    manifold.points[0].localPoint.Copy(circleB.m_p);\n    manifold.points[0].id.key = 0;\n}\nexports.b2CollideCircles = b2CollideCircles;\nvar b2CollidePolygonAndCircle_s_c = new b2Math_1.b2Vec2();\nvar b2CollidePolygonAndCircle_s_cLocal = new b2Math_1.b2Vec2();\nvar b2CollidePolygonAndCircle_s_faceCenter = new b2Math_1.b2Vec2();\nfunction b2CollidePolygonAndCircle(manifold, polygonA, xfA, circleB, xfB) {\n    manifold.pointCount = 0;\n    // Compute circle position in the frame of the polygon.\n    var c = b2Math_1.b2Transform.MulXV(xfB, circleB.m_p, b2CollidePolygonAndCircle_s_c);\n    var cLocal = b2Math_1.b2Transform.MulTXV(xfA, c, b2CollidePolygonAndCircle_s_cLocal);\n    // Find the min separating edge.\n    var normalIndex = 0;\n    var separation = (-b2Settings_1.b2_maxFloat);\n    var radius = polygonA.m_radius + circleB.m_radius;\n    var vertexCount = polygonA.m_count;\n    var vertices = polygonA.m_vertices;\n    var normals = polygonA.m_normals;\n    for (var i = 0; i < vertexCount; ++i) {\n        var s = b2Math_1.b2Vec2.DotVV(normals[i], b2Math_1.b2Vec2.SubVV(cLocal, vertices[i], b2Math_1.b2Vec2.s_t0));\n        if (s > radius) {\n            // Early out.\n            return;\n        }\n        if (s > separation) {\n            separation = s;\n            normalIndex = i;\n        }\n    }\n    // Vertices that subtend the incident face.\n    var vertIndex1 = normalIndex;\n    var vertIndex2 = (vertIndex1 + 1) % vertexCount;\n    var v1 = vertices[vertIndex1];\n    var v2 = vertices[vertIndex2];\n    // If the center is inside the polygon ...\n    if (separation < b2Settings_1.b2_epsilon) {\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_1.b2ManifoldType.e_faceA;\n        manifold.localNormal.Copy(normals[normalIndex]);\n        b2Math_1.b2Vec2.MidVV(v1, v2, manifold.localPoint);\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        manifold.points[0].id.key = 0;\n        return;\n    }\n    // Compute barycentric coordinates\n    var u1 = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cLocal, v1, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(v2, v1, b2Math_1.b2Vec2.s_t1));\n    var u2 = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cLocal, v2, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(v1, v2, b2Math_1.b2Vec2.s_t1));\n    if (u1 <= 0) {\n        if (b2Math_1.b2Vec2.DistanceSquaredVV(cLocal, v1) > radius * radius) {\n            return;\n        }\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_1.b2ManifoldType.e_faceA;\n        b2Math_1.b2Vec2.SubVV(cLocal, v1, manifold.localNormal).SelfNormalize();\n        manifold.localPoint.Copy(v1);\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        manifold.points[0].id.key = 0;\n    }\n    else if (u2 <= 0) {\n        if (b2Math_1.b2Vec2.DistanceSquaredVV(cLocal, v2) > radius * radius) {\n            return;\n        }\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_1.b2ManifoldType.e_faceA;\n        b2Math_1.b2Vec2.SubVV(cLocal, v2, manifold.localNormal).SelfNormalize();\n        manifold.localPoint.Copy(v2);\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        manifold.points[0].id.key = 0;\n    }\n    else {\n        var faceCenter = b2Math_1.b2Vec2.MidVV(v1, v2, b2CollidePolygonAndCircle_s_faceCenter);\n        separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cLocal, faceCenter, b2Math_1.b2Vec2.s_t1), normals[vertIndex1]);\n        if (separation > radius) {\n            return;\n        }\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_1.b2ManifoldType.e_faceA;\n        manifold.localNormal.Copy(normals[vertIndex1]).SelfNormalize();\n        manifold.localPoint.Copy(faceCenter);\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        manifold.points[0].id.key = 0;\n    }\n}\nexports.b2CollidePolygonAndCircle = b2CollidePolygonAndCircle;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2CollideCircle.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2CollideEdge.ts":
/*!**********************************************!*\
  !*** ./src/Box2D/Collision/b2CollideEdge.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Collision_1 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Collision_2 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2CollideEdgeAndCircle_s_Q = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_e = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_d = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_e1 = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_e2 = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_P = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_n = new b2Math_1.b2Vec2();\nvar b2CollideEdgeAndCircle_s_id = new b2Collision_1.b2ContactID();\nfunction b2CollideEdgeAndCircle(manifold, edgeA, xfA, circleB, xfB) {\n    manifold.pointCount = 0;\n    // Compute circle in frame of edge\n    var Q = b2Math_1.b2Transform.MulTXV(xfA, b2Math_1.b2Transform.MulXV(xfB, circleB.m_p, b2Math_1.b2Vec2.s_t0), b2CollideEdgeAndCircle_s_Q);\n    var A = edgeA.m_vertex1;\n    var B = edgeA.m_vertex2;\n    var e = b2Math_1.b2Vec2.SubVV(B, A, b2CollideEdgeAndCircle_s_e);\n    // Barycentric coordinates\n    var u = b2Math_1.b2Vec2.DotVV(e, b2Math_1.b2Vec2.SubVV(B, Q, b2Math_1.b2Vec2.s_t0));\n    var v = b2Math_1.b2Vec2.DotVV(e, b2Math_1.b2Vec2.SubVV(Q, A, b2Math_1.b2Vec2.s_t0));\n    var radius = edgeA.m_radius + circleB.m_radius;\n    // const cf: b2ContactFeature = new b2ContactFeature();\n    var id = b2CollideEdgeAndCircle_s_id;\n    id.cf.indexB = 0;\n    id.cf.typeB = b2Collision_1.b2ContactFeatureType.e_vertex;\n    // Region A\n    if (v <= 0) {\n        // tslint:disable-next-line:no-shadowed-variable\n        var P_1 = A;\n        // tslint:disable-next-line:no-shadowed-variable\n        var d_1 = b2Math_1.b2Vec2.SubVV(Q, P_1, b2CollideEdgeAndCircle_s_d);\n        // tslint:disable-next-line:no-shadowed-variable\n        var dd_1 = b2Math_1.b2Vec2.DotVV(d_1, d_1);\n        if (dd_1 > radius * radius) {\n            return;\n        }\n        // Is there an edge connected to A?\n        if (edgeA.m_hasVertex0) {\n            var A1 = edgeA.m_vertex0;\n            var B1 = A;\n            var e1 = b2Math_1.b2Vec2.SubVV(B1, A1, b2CollideEdgeAndCircle_s_e1);\n            var u1 = b2Math_1.b2Vec2.DotVV(e1, b2Math_1.b2Vec2.SubVV(B1, Q, b2Math_1.b2Vec2.s_t0));\n            // Is the circle in Region AB of the previous edge?\n            if (u1 > 0) {\n                return;\n            }\n        }\n        id.cf.indexA = 0;\n        id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_vertex;\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_2.b2ManifoldType.e_circles;\n        manifold.localNormal.SetZero();\n        manifold.localPoint.Copy(P_1);\n        manifold.points[0].id.Copy(id);\n        // manifold.points[0].id.key = 0;\n        // manifold.points[0].id.cf = cf;\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        return;\n    }\n    // Region B\n    if (u <= 0) {\n        // tslint:disable-next-line:no-shadowed-variable\n        var P_2 = B;\n        // tslint:disable-next-line:no-shadowed-variable\n        var d_2 = b2Math_1.b2Vec2.SubVV(Q, P_2, b2CollideEdgeAndCircle_s_d);\n        // tslint:disable-next-line:no-shadowed-variable\n        var dd_2 = b2Math_1.b2Vec2.DotVV(d_2, d_2);\n        if (dd_2 > radius * radius) {\n            return;\n        }\n        // Is there an edge connected to B?\n        if (edgeA.m_hasVertex3) {\n            var B2 = edgeA.m_vertex3;\n            var A2 = B;\n            var e2 = b2Math_1.b2Vec2.SubVV(B2, A2, b2CollideEdgeAndCircle_s_e2);\n            var v2 = b2Math_1.b2Vec2.DotVV(e2, b2Math_1.b2Vec2.SubVV(Q, A2, b2Math_1.b2Vec2.s_t0));\n            // Is the circle in Region AB of the next edge?\n            if (v2 > 0) {\n                return;\n            }\n        }\n        id.cf.indexA = 1;\n        id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_vertex;\n        manifold.pointCount = 1;\n        manifold.type = b2Collision_2.b2ManifoldType.e_circles;\n        manifold.localNormal.SetZero();\n        manifold.localPoint.Copy(P_2);\n        manifold.points[0].id.Copy(id);\n        // manifold.points[0].id.key = 0;\n        // manifold.points[0].id.cf = cf;\n        manifold.points[0].localPoint.Copy(circleB.m_p);\n        return;\n    }\n    // Region AB\n    var den = b2Math_1.b2Vec2.DotVV(e, e);\n    /// b2Assert(den > 0);\n    var P = b2CollideEdgeAndCircle_s_P;\n    P.x = (1 / den) * (u * A.x + v * B.x);\n    P.y = (1 / den) * (u * A.y + v * B.y);\n    var d = b2Math_1.b2Vec2.SubVV(Q, P, b2CollideEdgeAndCircle_s_d);\n    var dd = b2Math_1.b2Vec2.DotVV(d, d);\n    if (dd > radius * radius) {\n        return;\n    }\n    var n = b2CollideEdgeAndCircle_s_n.Set(-e.y, e.x);\n    if (b2Math_1.b2Vec2.DotVV(n, b2Math_1.b2Vec2.SubVV(Q, A, b2Math_1.b2Vec2.s_t0)) < 0) {\n        n.Set(-n.x, -n.y);\n    }\n    n.Normalize();\n    id.cf.indexA = 0;\n    id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_face;\n    manifold.pointCount = 1;\n    manifold.type = b2Collision_2.b2ManifoldType.e_faceA;\n    manifold.localNormal.Copy(n);\n    manifold.localPoint.Copy(A);\n    manifold.points[0].id.Copy(id);\n    // manifold.points[0].id.key = 0;\n    // manifold.points[0].id.cf = cf;\n    manifold.points[0].localPoint.Copy(circleB.m_p);\n}\nexports.b2CollideEdgeAndCircle = b2CollideEdgeAndCircle;\nvar b2EPAxisType;\n(function (b2EPAxisType) {\n    b2EPAxisType[b2EPAxisType[\"e_unknown\"] = 0] = \"e_unknown\";\n    b2EPAxisType[b2EPAxisType[\"e_edgeA\"] = 1] = \"e_edgeA\";\n    b2EPAxisType[b2EPAxisType[\"e_edgeB\"] = 2] = \"e_edgeB\";\n})(b2EPAxisType || (b2EPAxisType = {}));\nvar b2EPAxis = /** @class */ (function () {\n    function b2EPAxis() {\n        this.type = b2EPAxisType.e_unknown;\n        this.index = 0;\n        this.separation = 0;\n    }\n    return b2EPAxis;\n}());\nvar b2TempPolygon = /** @class */ (function () {\n    function b2TempPolygon() {\n        this.vertices = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxPolygonVertices);\n        this.normals = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxPolygonVertices);\n        this.count = 0;\n    }\n    return b2TempPolygon;\n}());\nvar b2ReferenceFace = /** @class */ (function () {\n    function b2ReferenceFace() {\n        this.i1 = 0;\n        this.i2 = 0;\n        this.v1 = new b2Math_1.b2Vec2();\n        this.v2 = new b2Math_1.b2Vec2();\n        this.normal = new b2Math_1.b2Vec2();\n        this.sideNormal1 = new b2Math_1.b2Vec2();\n        this.sideOffset1 = 0;\n        this.sideNormal2 = new b2Math_1.b2Vec2();\n        this.sideOffset2 = 0;\n    }\n    return b2ReferenceFace;\n}());\nvar b2EPColliderVertexType;\n(function (b2EPColliderVertexType) {\n    b2EPColliderVertexType[b2EPColliderVertexType[\"e_isolated\"] = 0] = \"e_isolated\";\n    b2EPColliderVertexType[b2EPColliderVertexType[\"e_concave\"] = 1] = \"e_concave\";\n    b2EPColliderVertexType[b2EPColliderVertexType[\"e_convex\"] = 2] = \"e_convex\";\n})(b2EPColliderVertexType || (b2EPColliderVertexType = {}));\nvar b2EPCollider = /** @class */ (function () {\n    function b2EPCollider() {\n        this.m_polygonB = new b2TempPolygon();\n        this.m_xf = new b2Math_1.b2Transform();\n        this.m_centroidB = new b2Math_1.b2Vec2();\n        this.m_v0 = new b2Math_1.b2Vec2();\n        this.m_v1 = new b2Math_1.b2Vec2();\n        this.m_v2 = new b2Math_1.b2Vec2();\n        this.m_v3 = new b2Math_1.b2Vec2();\n        this.m_normal0 = new b2Math_1.b2Vec2();\n        this.m_normal1 = new b2Math_1.b2Vec2();\n        this.m_normal2 = new b2Math_1.b2Vec2();\n        this.m_normal = new b2Math_1.b2Vec2();\n        this.m_type1 = b2EPColliderVertexType.e_isolated;\n        this.m_type2 = b2EPColliderVertexType.e_isolated;\n        this.m_lowerLimit = new b2Math_1.b2Vec2();\n        this.m_upperLimit = new b2Math_1.b2Vec2();\n        this.m_radius = 0;\n        this.m_front = false;\n    }\n    b2EPCollider.prototype.Collide = function (manifold, edgeA, xfA, polygonB, xfB) {\n        b2Math_1.b2Transform.MulTXX(xfA, xfB, this.m_xf);\n        b2Math_1.b2Transform.MulXV(this.m_xf, polygonB.m_centroid, this.m_centroidB);\n        this.m_v0.Copy(edgeA.m_vertex0);\n        this.m_v1.Copy(edgeA.m_vertex1);\n        this.m_v2.Copy(edgeA.m_vertex2);\n        this.m_v3.Copy(edgeA.m_vertex3);\n        var hasVertex0 = edgeA.m_hasVertex0;\n        var hasVertex3 = edgeA.m_hasVertex3;\n        var edge1 = b2Math_1.b2Vec2.SubVV(this.m_v2, this.m_v1, b2EPCollider.s_edge1);\n        edge1.Normalize();\n        this.m_normal1.Set(edge1.y, -edge1.x);\n        var offset1 = b2Math_1.b2Vec2.DotVV(this.m_normal1, b2Math_1.b2Vec2.SubVV(this.m_centroidB, this.m_v1, b2Math_1.b2Vec2.s_t0));\n        var offset0 = 0;\n        var offset2 = 0;\n        var convex1 = false;\n        var convex2 = false;\n        // Is there a preceding edge?\n        if (hasVertex0) {\n            var edge0 = b2Math_1.b2Vec2.SubVV(this.m_v1, this.m_v0, b2EPCollider.s_edge0);\n            edge0.Normalize();\n            this.m_normal0.Set(edge0.y, -edge0.x);\n            convex1 = b2Math_1.b2Vec2.CrossVV(edge0, edge1) >= 0;\n            offset0 = b2Math_1.b2Vec2.DotVV(this.m_normal0, b2Math_1.b2Vec2.SubVV(this.m_centroidB, this.m_v0, b2Math_1.b2Vec2.s_t0));\n        }\n        // Is there a following edge?\n        if (hasVertex3) {\n            var edge2 = b2Math_1.b2Vec2.SubVV(this.m_v3, this.m_v2, b2EPCollider.s_edge2);\n            edge2.Normalize();\n            this.m_normal2.Set(edge2.y, -edge2.x);\n            convex2 = b2Math_1.b2Vec2.CrossVV(edge1, edge2) > 0;\n            offset2 = b2Math_1.b2Vec2.DotVV(this.m_normal2, b2Math_1.b2Vec2.SubVV(this.m_centroidB, this.m_v2, b2Math_1.b2Vec2.s_t0));\n        }\n        // Determine front or back collision. Determine collision normal limits.\n        if (hasVertex0 && hasVertex3) {\n            if (convex1 && convex2) {\n                this.m_front = offset0 >= 0 || offset1 >= 0 || offset2 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal0);\n                    this.m_upperLimit.Copy(this.m_normal2);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n                }\n            }\n            else if (convex1) {\n                this.m_front = offset0 >= 0 || (offset1 >= 0 && offset2 >= 0);\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal0);\n                    this.m_upperLimit.Copy(this.m_normal1);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n                }\n            }\n            else if (convex2) {\n                this.m_front = offset2 >= 0 || (offset0 >= 0 && offset1 >= 0);\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal1);\n                    this.m_upperLimit.Copy(this.m_normal2);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal0).SelfNeg();\n                }\n            }\n            else {\n                this.m_front = offset0 >= 0 && offset1 >= 0 && offset2 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal1);\n                    this.m_upperLimit.Copy(this.m_normal1);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal0).SelfNeg();\n                }\n            }\n        }\n        else if (hasVertex0) {\n            if (convex1) {\n                this.m_front = offset0 >= 0 || offset1 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal0);\n                    this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal1);\n                    this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n                }\n            }\n            else {\n                this.m_front = offset0 >= 0 && offset1 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal1);\n                    this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal1);\n                    this.m_upperLimit.Copy(this.m_normal0).SelfNeg();\n                }\n            }\n        }\n        else if (hasVertex3) {\n            if (convex2) {\n                this.m_front = offset1 >= 0 || offset2 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal2);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal1);\n                }\n            }\n            else {\n                this.m_front = offset1 >= 0 && offset2 >= 0;\n                if (this.m_front) {\n                    this.m_normal.Copy(this.m_normal1);\n                    this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal1);\n                }\n                else {\n                    this.m_normal.Copy(this.m_normal1).SelfNeg();\n                    this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();\n                    this.m_upperLimit.Copy(this.m_normal1);\n                }\n            }\n        }\n        else {\n            this.m_front = offset1 >= 0;\n            if (this.m_front) {\n                this.m_normal.Copy(this.m_normal1);\n                this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();\n                this.m_upperLimit.Copy(this.m_normal1).SelfNeg();\n            }\n            else {\n                this.m_normal.Copy(this.m_normal1).SelfNeg();\n                this.m_lowerLimit.Copy(this.m_normal1);\n                this.m_upperLimit.Copy(this.m_normal1);\n            }\n        }\n        // Get polygonB in frameA\n        this.m_polygonB.count = polygonB.m_count;\n        for (var i = 0; i < polygonB.m_count; ++i) {\n            b2Math_1.b2Transform.MulXV(this.m_xf, polygonB.m_vertices[i], this.m_polygonB.vertices[i]);\n            b2Math_1.b2Rot.MulRV(this.m_xf.q, polygonB.m_normals[i], this.m_polygonB.normals[i]);\n        }\n        this.m_radius = 2 * b2Settings_1.b2_polygonRadius;\n        manifold.pointCount = 0;\n        var edgeAxis = this.ComputeEdgeSeparation(b2EPCollider.s_edgeAxis);\n        // If no valid normal can be found than this edge should not collide.\n        if (edgeAxis.type === b2EPAxisType.e_unknown) {\n            return;\n        }\n        if (edgeAxis.separation > this.m_radius) {\n            return;\n        }\n        var polygonAxis = this.ComputePolygonSeparation(b2EPCollider.s_polygonAxis);\n        if (polygonAxis.type !== b2EPAxisType.e_unknown && polygonAxis.separation > this.m_radius) {\n            return;\n        }\n        // Use hysteresis for jitter reduction.\n        var k_relativeTol = 0.98;\n        var k_absoluteTol = 0.001;\n        var primaryAxis;\n        if (polygonAxis.type === b2EPAxisType.e_unknown) {\n            primaryAxis = edgeAxis;\n        }\n        else if (polygonAxis.separation > k_relativeTol * edgeAxis.separation + k_absoluteTol) {\n            primaryAxis = polygonAxis;\n        }\n        else {\n            primaryAxis = edgeAxis;\n        }\n        var ie = b2EPCollider.s_ie;\n        var rf = b2EPCollider.s_rf;\n        if (primaryAxis.type === b2EPAxisType.e_edgeA) {\n            manifold.type = b2Collision_2.b2ManifoldType.e_faceA;\n            // Search for the polygon normal that is most anti-parallel to the edge normal.\n            var bestIndex = 0;\n            var bestValue = b2Math_1.b2Vec2.DotVV(this.m_normal, this.m_polygonB.normals[0]);\n            for (var i = 1; i < this.m_polygonB.count; ++i) {\n                var value = b2Math_1.b2Vec2.DotVV(this.m_normal, this.m_polygonB.normals[i]);\n                if (value < bestValue) {\n                    bestValue = value;\n                    bestIndex = i;\n                }\n            }\n            var i1 = bestIndex;\n            var i2 = (i1 + 1) % this.m_polygonB.count;\n            var ie0 = ie[0];\n            ie0.v.Copy(this.m_polygonB.vertices[i1]);\n            ie0.id.cf.indexA = 0;\n            ie0.id.cf.indexB = i1;\n            ie0.id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_face;\n            ie0.id.cf.typeB = b2Collision_1.b2ContactFeatureType.e_vertex;\n            var ie1 = ie[1];\n            ie1.v.Copy(this.m_polygonB.vertices[i2]);\n            ie1.id.cf.indexA = 0;\n            ie1.id.cf.indexB = i2;\n            ie1.id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_face;\n            ie1.id.cf.typeB = b2Collision_1.b2ContactFeatureType.e_vertex;\n            if (this.m_front) {\n                rf.i1 = 0;\n                rf.i2 = 1;\n                rf.v1.Copy(this.m_v1);\n                rf.v2.Copy(this.m_v2);\n                rf.normal.Copy(this.m_normal1);\n            }\n            else {\n                rf.i1 = 1;\n                rf.i2 = 0;\n                rf.v1.Copy(this.m_v2);\n                rf.v2.Copy(this.m_v1);\n                rf.normal.Copy(this.m_normal1).SelfNeg();\n            }\n        }\n        else {\n            manifold.type = b2Collision_2.b2ManifoldType.e_faceB;\n            var ie0 = ie[0];\n            ie0.v.Copy(this.m_v1);\n            ie0.id.cf.indexA = 0;\n            ie0.id.cf.indexB = primaryAxis.index;\n            ie0.id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_vertex;\n            ie0.id.cf.typeB = b2Collision_1.b2ContactFeatureType.e_face;\n            var ie1 = ie[1];\n            ie1.v.Copy(this.m_v2);\n            ie1.id.cf.indexA = 0;\n            ie1.id.cf.indexB = primaryAxis.index;\n            ie1.id.cf.typeA = b2Collision_1.b2ContactFeatureType.e_vertex;\n            ie1.id.cf.typeB = b2Collision_1.b2ContactFeatureType.e_face;\n            rf.i1 = primaryAxis.index;\n            rf.i2 = (rf.i1 + 1) % this.m_polygonB.count;\n            rf.v1.Copy(this.m_polygonB.vertices[rf.i1]);\n            rf.v2.Copy(this.m_polygonB.vertices[rf.i2]);\n            rf.normal.Copy(this.m_polygonB.normals[rf.i1]);\n        }\n        rf.sideNormal1.Set(rf.normal.y, -rf.normal.x);\n        rf.sideNormal2.Copy(rf.sideNormal1).SelfNeg();\n        rf.sideOffset1 = b2Math_1.b2Vec2.DotVV(rf.sideNormal1, rf.v1);\n        rf.sideOffset2 = b2Math_1.b2Vec2.DotVV(rf.sideNormal2, rf.v2);\n        // Clip incident edge against extruded edge1 side edges.\n        var clipPoints1 = b2EPCollider.s_clipPoints1;\n        var clipPoints2 = b2EPCollider.s_clipPoints2;\n        var np = 0;\n        // Clip to box side 1\n        np = b2Collision_2.b2ClipSegmentToLine(clipPoints1, ie, rf.sideNormal1, rf.sideOffset1, rf.i1);\n        if (np < b2Settings_1.b2_maxManifoldPoints) {\n            return;\n        }\n        // Clip to negative box side 1\n        np = b2Collision_2.b2ClipSegmentToLine(clipPoints2, clipPoints1, rf.sideNormal2, rf.sideOffset2, rf.i2);\n        if (np < b2Settings_1.b2_maxManifoldPoints) {\n            return;\n        }\n        // Now clipPoints2 contains the clipped points.\n        if (primaryAxis.type === b2EPAxisType.e_edgeA) {\n            manifold.localNormal.Copy(rf.normal);\n            manifold.localPoint.Copy(rf.v1);\n        }\n        else {\n            manifold.localNormal.Copy(polygonB.m_normals[rf.i1]);\n            manifold.localPoint.Copy(polygonB.m_vertices[rf.i1]);\n        }\n        var pointCount = 0;\n        for (var i = 0; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n            var separation = void 0;\n            separation = b2Math_1.b2Vec2.DotVV(rf.normal, b2Math_1.b2Vec2.SubVV(clipPoints2[i].v, rf.v1, b2Math_1.b2Vec2.s_t0));\n            if (separation <= this.m_radius) {\n                var cp = manifold.points[pointCount];\n                if (primaryAxis.type === b2EPAxisType.e_edgeA) {\n                    b2Math_1.b2Transform.MulTXV(this.m_xf, clipPoints2[i].v, cp.localPoint);\n                    cp.id = clipPoints2[i].id;\n                }\n                else {\n                    cp.localPoint.Copy(clipPoints2[i].v);\n                    cp.id.cf.typeA = clipPoints2[i].id.cf.typeB;\n                    cp.id.cf.typeB = clipPoints2[i].id.cf.typeA;\n                    cp.id.cf.indexA = clipPoints2[i].id.cf.indexB;\n                    cp.id.cf.indexB = clipPoints2[i].id.cf.indexA;\n                }\n                ++pointCount;\n            }\n        }\n        manifold.pointCount = pointCount;\n    };\n    b2EPCollider.prototype.ComputeEdgeSeparation = function (out) {\n        var axis = out;\n        axis.type = b2EPAxisType.e_edgeA;\n        axis.index = this.m_front ? 0 : 1;\n        axis.separation = b2Settings_1.b2_maxFloat;\n        for (var i = 0; i < this.m_polygonB.count; ++i) {\n            var s = b2Math_1.b2Vec2.DotVV(this.m_normal, b2Math_1.b2Vec2.SubVV(this.m_polygonB.vertices[i], this.m_v1, b2Math_1.b2Vec2.s_t0));\n            if (s < axis.separation) {\n                axis.separation = s;\n            }\n        }\n        return axis;\n    };\n    b2EPCollider.prototype.ComputePolygonSeparation = function (out) {\n        var axis = out;\n        axis.type = b2EPAxisType.e_unknown;\n        axis.index = -1;\n        axis.separation = -b2Settings_1.b2_maxFloat;\n        var perp = b2EPCollider.s_perp.Set(-this.m_normal.y, this.m_normal.x);\n        for (var i = 0; i < this.m_polygonB.count; ++i) {\n            var n = b2Math_1.b2Vec2.NegV(this.m_polygonB.normals[i], b2EPCollider.s_n);\n            var s1 = b2Math_1.b2Vec2.DotVV(n, b2Math_1.b2Vec2.SubVV(this.m_polygonB.vertices[i], this.m_v1, b2Math_1.b2Vec2.s_t0));\n            var s2 = b2Math_1.b2Vec2.DotVV(n, b2Math_1.b2Vec2.SubVV(this.m_polygonB.vertices[i], this.m_v2, b2Math_1.b2Vec2.s_t0));\n            var s = b2Math_1.b2Min(s1, s2);\n            if (s > this.m_radius) {\n                // No collision\n                axis.type = b2EPAxisType.e_edgeB;\n                axis.index = i;\n                axis.separation = s;\n                return axis;\n            }\n            // Adjacency\n            if (b2Math_1.b2Vec2.DotVV(n, perp) >= 0) {\n                if (b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(n, this.m_upperLimit, b2Math_1.b2Vec2.s_t0), this.m_normal) < -b2Settings_1.b2_angularSlop) {\n                    continue;\n                }\n            }\n            else {\n                if (b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(n, this.m_lowerLimit, b2Math_1.b2Vec2.s_t0), this.m_normal) < -b2Settings_1.b2_angularSlop) {\n                    continue;\n                }\n            }\n            if (s > axis.separation) {\n                axis.type = b2EPAxisType.e_edgeB;\n                axis.index = i;\n                axis.separation = s;\n            }\n        }\n        return axis;\n    };\n    b2EPCollider.s_edge1 = new b2Math_1.b2Vec2();\n    b2EPCollider.s_edge0 = new b2Math_1.b2Vec2();\n    b2EPCollider.s_edge2 = new b2Math_1.b2Vec2();\n    b2EPCollider.s_ie = b2Collision_2.b2ClipVertex.MakeArray(2);\n    b2EPCollider.s_rf = new b2ReferenceFace();\n    b2EPCollider.s_clipPoints1 = b2Collision_2.b2ClipVertex.MakeArray(2);\n    b2EPCollider.s_clipPoints2 = b2Collision_2.b2ClipVertex.MakeArray(2);\n    b2EPCollider.s_edgeAxis = new b2EPAxis();\n    b2EPCollider.s_polygonAxis = new b2EPAxis();\n    b2EPCollider.s_n = new b2Math_1.b2Vec2();\n    b2EPCollider.s_perp = new b2Math_1.b2Vec2();\n    return b2EPCollider;\n}());\nvar b2CollideEdgeAndPolygon_s_collider = new b2EPCollider();\nfunction b2CollideEdgeAndPolygon(manifold, edgeA, xfA, polygonB, xfB) {\n    var collider = b2CollideEdgeAndPolygon_s_collider;\n    collider.Collide(manifold, edgeA, xfA, polygonB, xfB);\n}\nexports.b2CollideEdgeAndPolygon = b2CollideEdgeAndPolygon;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2CollideEdge.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2CollidePolygon.ts":
/*!*************************************************!*\
  !*** ./src/Box2D/Collision/b2CollidePolygon.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Collision_1 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Collision_2 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2EdgeSeparation_s_normal1World = new b2Math_1.b2Vec2();\nvar b2EdgeSeparation_s_normal1 = new b2Math_1.b2Vec2();\nvar b2EdgeSeparation_s_v1 = new b2Math_1.b2Vec2();\nvar b2EdgeSeparation_s_v2 = new b2Math_1.b2Vec2();\nfunction b2EdgeSeparation(poly1, xf1, edge1, poly2, xf2) {\n    /// const count1: number = poly1.m_count;\n    var vertices1 = poly1.m_vertices;\n    var normals1 = poly1.m_normals;\n    var count2 = poly2.m_count;\n    var vertices2 = poly2.m_vertices;\n    /// b2Assert(0 <= edge1 && edge1 < count1);\n    // Convert normal from poly1's frame into poly2's frame.\n    var normal1World = b2Math_1.b2Rot.MulRV(xf1.q, normals1[edge1], b2EdgeSeparation_s_normal1World);\n    var normal1 = b2Math_1.b2Rot.MulTRV(xf2.q, normal1World, b2EdgeSeparation_s_normal1);\n    // Find support vertex on poly2 for -normal.\n    var index = 0;\n    var minDot = b2Settings_1.b2_maxFloat;\n    for (var i = 0; i < count2; ++i) {\n        var dot = b2Math_1.b2Vec2.DotVV(vertices2[i], normal1);\n        if (dot < minDot) {\n            minDot = dot;\n            index = i;\n        }\n    }\n    var v1 = b2Math_1.b2Transform.MulXV(xf1, vertices1[edge1], b2EdgeSeparation_s_v1);\n    var v2 = b2Math_1.b2Transform.MulXV(xf2, vertices2[index], b2EdgeSeparation_s_v2);\n    var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(v2, v1, b2Math_1.b2Vec2.s_t0), normal1World);\n    return separation;\n}\nvar b2FindMaxSeparation_s_d = new b2Math_1.b2Vec2();\nvar b2FindMaxSeparation_s_dLocal1 = new b2Math_1.b2Vec2();\nfunction b2FindMaxSeparation(edgeIndex, poly1, xf1, poly2, xf2) {\n    var count1 = poly1.m_count;\n    var normals1 = poly1.m_normals;\n    // Vector pointing from the centroid of poly1 to the centroid of poly2.\n    var d = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Transform.MulXV(xf2, poly2.m_centroid, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Transform.MulXV(xf1, poly1.m_centroid, b2Math_1.b2Vec2.s_t1), b2FindMaxSeparation_s_d);\n    var dLocal1 = b2Math_1.b2Rot.MulTRV(xf1.q, d, b2FindMaxSeparation_s_dLocal1);\n    // Find edge normal on poly1 that has the largest projection onto d.\n    var edge = 0;\n    var maxDot = (-b2Settings_1.b2_maxFloat);\n    for (var i = 0; i < count1; ++i) {\n        var dot = b2Math_1.b2Vec2.DotVV(normals1[i], dLocal1);\n        if (dot > maxDot) {\n            maxDot = dot;\n            edge = i;\n        }\n    }\n    // Get the separation for the edge normal.\n    var s = b2EdgeSeparation(poly1, xf1, edge, poly2, xf2);\n    // Check the separation for the previous edge normal.\n    var prevEdge = (edge + count1 - 1) % count1;\n    var sPrev = b2EdgeSeparation(poly1, xf1, prevEdge, poly2, xf2);\n    // Check the separation for the next edge normal.\n    var nextEdge = (edge + 1) % count1;\n    var sNext = b2EdgeSeparation(poly1, xf1, nextEdge, poly2, xf2);\n    // Find the best edge and the search direction.\n    var bestEdge = 0;\n    var bestSeparation = 0;\n    var increment = 0;\n    if (sPrev > s && sPrev > sNext) {\n        increment = -1;\n        bestEdge = prevEdge;\n        bestSeparation = sPrev;\n    }\n    else if (sNext > s) {\n        increment = 1;\n        bestEdge = nextEdge;\n        bestSeparation = sNext;\n    }\n    else {\n        edgeIndex[0] = edge;\n        return s;\n    }\n    // Perform a local search for the best edge normal.\n    while (true) {\n        if (increment === -1) {\n            edge = (bestEdge + count1 - 1) % count1;\n        }\n        else {\n            edge = (bestEdge + 1) % count1;\n        }\n        s = b2EdgeSeparation(poly1, xf1, edge, poly2, xf2);\n        if (s > bestSeparation) {\n            bestEdge = edge;\n            bestSeparation = s;\n        }\n        else {\n            break;\n        }\n    }\n    edgeIndex[0] = bestEdge;\n    return bestSeparation;\n}\nvar b2FindIncidentEdge_s_normal1 = new b2Math_1.b2Vec2();\nfunction b2FindIncidentEdge(c, poly1, xf1, edge1, poly2, xf2) {\n    /// const count1: number = poly1.m_count;\n    var normals1 = poly1.m_normals;\n    var count2 = poly2.m_count;\n    var vertices2 = poly2.m_vertices;\n    var normals2 = poly2.m_normals;\n    /// b2Assert(0 <= edge1 && edge1 < count1);\n    // Get the normal of the reference edge in poly2's frame.\n    var normal1 = b2Math_1.b2Rot.MulTRV(xf2.q, b2Math_1.b2Rot.MulRV(xf1.q, normals1[edge1], b2Math_1.b2Vec2.s_t0), b2FindIncidentEdge_s_normal1);\n    // Find the incident edge on poly2.\n    var index = 0;\n    var minDot = b2Settings_1.b2_maxFloat;\n    for (var i = 0; i < count2; ++i) {\n        var dot = b2Math_1.b2Vec2.DotVV(normal1, normals2[i]);\n        if (dot < minDot) {\n            minDot = dot;\n            index = i;\n        }\n    }\n    // Build the clip vertices for the incident edge.\n    var i1 = index;\n    var i2 = (i1 + 1) % count2;\n    var c0 = c[0];\n    b2Math_1.b2Transform.MulXV(xf2, vertices2[i1], c0.v);\n    var cf0 = c0.id.cf;\n    cf0.indexA = edge1;\n    cf0.indexB = i1;\n    cf0.typeA = b2Collision_1.b2ContactFeatureType.e_face;\n    cf0.typeB = b2Collision_1.b2ContactFeatureType.e_vertex;\n    var c1 = c[1];\n    b2Math_1.b2Transform.MulXV(xf2, vertices2[i2], c1.v);\n    var cf1 = c1.id.cf;\n    cf1.indexA = edge1;\n    cf1.indexB = i2;\n    cf1.typeA = b2Collision_1.b2ContactFeatureType.e_face;\n    cf1.typeB = b2Collision_1.b2ContactFeatureType.e_vertex;\n}\nvar b2CollidePolygons_s_incidentEdge = b2Collision_2.b2ClipVertex.MakeArray(2);\nvar b2CollidePolygons_s_clipPoints1 = b2Collision_2.b2ClipVertex.MakeArray(2);\nvar b2CollidePolygons_s_clipPoints2 = b2Collision_2.b2ClipVertex.MakeArray(2);\nvar b2CollidePolygons_s_edgeA = [0];\nvar b2CollidePolygons_s_edgeB = [0];\nvar b2CollidePolygons_s_localTangent = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_localNormal = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_planePoint = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_normal = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_tangent = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_ntangent = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_v11 = new b2Math_1.b2Vec2();\nvar b2CollidePolygons_s_v12 = new b2Math_1.b2Vec2();\nfunction b2CollidePolygons(manifold, polyA, xfA, polyB, xfB) {\n    manifold.pointCount = 0;\n    var totalRadius = polyA.m_radius + polyB.m_radius;\n    var edgeA = b2CollidePolygons_s_edgeA;\n    edgeA[0] = 0;\n    var separationA = b2FindMaxSeparation(edgeA, polyA, xfA, polyB, xfB);\n    if (separationA > totalRadius) {\n        return;\n    }\n    var edgeB = b2CollidePolygons_s_edgeB;\n    edgeB[0] = 0;\n    var separationB = b2FindMaxSeparation(edgeB, polyB, xfB, polyA, xfA);\n    if (separationB > totalRadius) {\n        return;\n    }\n    var poly1; // reference polygon\n    var poly2; // incident polygon\n    var xf1, xf2;\n    var edge1 = 0; // reference edge\n    var flip = 0;\n    var k_relativeTol = 0.98;\n    var k_absoluteTol = 0.001;\n    if (separationB > k_relativeTol * separationA + k_absoluteTol) {\n        poly1 = polyB;\n        poly2 = polyA;\n        xf1 = xfB;\n        xf2 = xfA;\n        edge1 = edgeB[0];\n        manifold.type = b2Collision_2.b2ManifoldType.e_faceB;\n        flip = 1;\n    }\n    else {\n        poly1 = polyA;\n        poly2 = polyB;\n        xf1 = xfA;\n        xf2 = xfB;\n        edge1 = edgeA[0];\n        manifold.type = b2Collision_2.b2ManifoldType.e_faceA;\n        flip = 0;\n    }\n    var incidentEdge = b2CollidePolygons_s_incidentEdge;\n    b2FindIncidentEdge(incidentEdge, poly1, xf1, edge1, poly2, xf2);\n    var count1 = poly1.m_count;\n    var vertices1 = poly1.m_vertices;\n    var iv1 = edge1;\n    var iv2 = (edge1 + 1) % count1;\n    var local_v11 = vertices1[iv1];\n    var local_v12 = vertices1[iv2];\n    var localTangent = b2Math_1.b2Vec2.SubVV(local_v12, local_v11, b2CollidePolygons_s_localTangent);\n    localTangent.Normalize();\n    var localNormal = b2Math_1.b2Vec2.CrossVOne(localTangent, b2CollidePolygons_s_localNormal);\n    var planePoint = b2Math_1.b2Vec2.MidVV(local_v11, local_v12, b2CollidePolygons_s_planePoint);\n    var tangent = b2Math_1.b2Rot.MulRV(xf1.q, localTangent, b2CollidePolygons_s_tangent);\n    var normal = b2Math_1.b2Vec2.CrossVOne(tangent, b2CollidePolygons_s_normal);\n    var v11 = b2Math_1.b2Transform.MulXV(xf1, local_v11, b2CollidePolygons_s_v11);\n    var v12 = b2Math_1.b2Transform.MulXV(xf1, local_v12, b2CollidePolygons_s_v12);\n    // Face offset.\n    var frontOffset = b2Math_1.b2Vec2.DotVV(normal, v11);\n    // Side offsets, extended by polytope skin thickness.\n    var sideOffset1 = -b2Math_1.b2Vec2.DotVV(tangent, v11) + totalRadius;\n    var sideOffset2 = b2Math_1.b2Vec2.DotVV(tangent, v12) + totalRadius;\n    // Clip incident edge against extruded edge1 side edges.\n    var clipPoints1 = b2CollidePolygons_s_clipPoints1;\n    var clipPoints2 = b2CollidePolygons_s_clipPoints2;\n    var np;\n    // Clip to box side 1\n    var ntangent = b2Math_1.b2Vec2.NegV(tangent, b2CollidePolygons_s_ntangent);\n    np = b2Collision_2.b2ClipSegmentToLine(clipPoints1, incidentEdge, ntangent, sideOffset1, iv1);\n    if (np < 2) {\n        return;\n    }\n    // Clip to negative box side 1\n    np = b2Collision_2.b2ClipSegmentToLine(clipPoints2, clipPoints1, tangent, sideOffset2, iv2);\n    if (np < 2) {\n        return;\n    }\n    // Now clipPoints2 contains the clipped points.\n    manifold.localNormal.Copy(localNormal);\n    manifold.localPoint.Copy(planePoint);\n    var pointCount = 0;\n    for (var i = 0; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n        var cv = clipPoints2[i];\n        var separation = b2Math_1.b2Vec2.DotVV(normal, cv.v) - frontOffset;\n        if (separation <= totalRadius) {\n            var cp = manifold.points[pointCount];\n            b2Math_1.b2Transform.MulTXV(xf2, cv.v, cp.localPoint);\n            cp.id.Copy(cv.id);\n            if (flip) {\n                // Swap features\n                var cf = cp.id.cf;\n                cp.id.cf.indexA = cf.indexB;\n                cp.id.cf.indexB = cf.indexA;\n                cp.id.cf.typeA = cf.typeB;\n                cp.id.cf.typeB = cf.typeA;\n            }\n            ++pointCount;\n        }\n    }\n    manifold.pointCount = pointCount;\n}\nexports.b2CollidePolygons = b2CollidePolygons;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2CollidePolygon.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2Collision.ts":
/*!********************************************!*\
  !*** ./src/Box2D/Collision/b2Collision.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Distance_1 = __webpack_require__(/*! ./b2Distance */ \"./src/Box2D/Collision/b2Distance.ts\");\n/// @file\n/// Structures and functions used for computing contact points, distance\n/// queries, and TOI queries.\nvar b2ContactFeatureType;\n(function (b2ContactFeatureType) {\n    b2ContactFeatureType[b2ContactFeatureType[\"e_vertex\"] = 0] = \"e_vertex\";\n    b2ContactFeatureType[b2ContactFeatureType[\"e_face\"] = 1] = \"e_face\";\n})(b2ContactFeatureType = exports.b2ContactFeatureType || (exports.b2ContactFeatureType = {}));\n/// The features that intersect to form the contact point\n/// This must be 4 bytes or less.\nvar b2ContactFeature = /** @class */ (function () {\n    function b2ContactFeature() {\n        this._key = 0;\n        this._key_invalid = false;\n        this._indexA = 0;\n        this._indexB = 0;\n        this._typeA = 0;\n        this._typeB = 0;\n    }\n    Object.defineProperty(b2ContactFeature.prototype, \"key\", {\n        get: function () {\n            if (this._key_invalid) {\n                this._key_invalid = false;\n                this._key = this._indexA | (this._indexB << 8) | (this._typeA << 16) | (this._typeB << 24);\n            }\n            return this._key;\n        },\n        set: function (value) {\n            this._key = value;\n            this._key_invalid = false;\n            this._indexA = this._key & 0xff;\n            this._indexB = (this._key >> 8) & 0xff;\n            this._typeA = (this._key >> 16) & 0xff;\n            this._typeB = (this._key >> 24) & 0xff;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(b2ContactFeature.prototype, \"indexA\", {\n        get: function () {\n            return this._indexA;\n        },\n        set: function (value) {\n            this._indexA = value;\n            this._key_invalid = true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(b2ContactFeature.prototype, \"indexB\", {\n        get: function () {\n            return this._indexB;\n        },\n        set: function (value) {\n            this._indexB = value;\n            this._key_invalid = true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(b2ContactFeature.prototype, \"typeA\", {\n        get: function () {\n            return this._typeA;\n        },\n        set: function (value) {\n            this._typeA = value;\n            this._key_invalid = true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(b2ContactFeature.prototype, \"typeB\", {\n        get: function () {\n            return this._typeB;\n        },\n        set: function (value) {\n            this._typeB = value;\n            this._key_invalid = true;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return b2ContactFeature;\n}());\nexports.b2ContactFeature = b2ContactFeature;\n/// Contact ids to facilitate warm starting.\nvar b2ContactID = /** @class */ (function () {\n    function b2ContactID() {\n        this.cf = new b2ContactFeature();\n    }\n    b2ContactID.prototype.Copy = function (o) {\n        this.key = o.key;\n        return this;\n    };\n    b2ContactID.prototype.Clone = function () {\n        return new b2ContactID().Copy(this);\n    };\n    Object.defineProperty(b2ContactID.prototype, \"key\", {\n        get: function () {\n            return this.cf.key;\n        },\n        set: function (value) {\n            this.cf.key = value;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return b2ContactID;\n}());\nexports.b2ContactID = b2ContactID;\n/// A manifold point is a contact point belonging to a contact\n/// manifold. It holds details related to the geometry and dynamics\n/// of the contact points.\n/// The local point usage depends on the manifold type:\n/// -e_circles: the local center of circleB\n/// -e_faceA: the local center of cirlceB or the clip point of polygonB\n/// -e_faceB: the clip point of polygonA\n/// This structure is stored across time steps, so we keep it small.\n/// Note: the impulses are used for internal caching and may not\n/// provide reliable contact forces, especially for high speed collisions.\nvar b2ManifoldPoint = /** @class */ (function () {\n    function b2ManifoldPoint() {\n        this.localPoint = new b2Math_1.b2Vec2(); /// < usage depends on manifold type\n        this.normalImpulse = 0; /// < the non-penetration impulse\n        this.tangentImpulse = 0; /// < the friction impulse\n        this.id = new b2ContactID(); /// < uniquely identifies a contact point between two shapes\n    }\n    b2ManifoldPoint.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2ManifoldPoint(); });\n    };\n    b2ManifoldPoint.prototype.Reset = function () {\n        this.localPoint.SetZero();\n        this.normalImpulse = 0;\n        this.tangentImpulse = 0;\n        this.id.key = 0;\n    };\n    b2ManifoldPoint.prototype.Copy = function (o) {\n        this.localPoint.Copy(o.localPoint);\n        this.normalImpulse = o.normalImpulse;\n        this.tangentImpulse = o.tangentImpulse;\n        this.id.Copy(o.id);\n        return this;\n    };\n    return b2ManifoldPoint;\n}());\nexports.b2ManifoldPoint = b2ManifoldPoint;\nvar b2ManifoldType;\n(function (b2ManifoldType) {\n    b2ManifoldType[b2ManifoldType[\"e_unknown\"] = -1] = \"e_unknown\";\n    b2ManifoldType[b2ManifoldType[\"e_circles\"] = 0] = \"e_circles\";\n    b2ManifoldType[b2ManifoldType[\"e_faceA\"] = 1] = \"e_faceA\";\n    b2ManifoldType[b2ManifoldType[\"e_faceB\"] = 2] = \"e_faceB\";\n})(b2ManifoldType = exports.b2ManifoldType || (exports.b2ManifoldType = {}));\n/// A manifold for two touching convex shapes.\n/// Box2D supports multiple types of contact:\n/// - clip point versus plane with radius\n/// - point versus point with radius (circles)\n/// The local point usage depends on the manifold type:\n/// -e_circles: the local center of circleA\n/// -e_faceA: the center of faceA\n/// -e_faceB: the center of faceB\n/// Similarly the local normal usage:\n/// -e_circles: not used\n/// -e_faceA: the normal on polygonA\n/// -e_faceB: the normal on polygonB\n/// We store contacts in this way so that position correction can\n/// account for movement, which is critical for continuous physics.\n/// All contact scenarios must be expressed in one of these types.\n/// This structure is stored across time steps, so we keep it small.\nvar b2Manifold = /** @class */ (function () {\n    function b2Manifold() {\n        this.points = b2ManifoldPoint.MakeArray(b2Settings_1.b2_maxManifoldPoints);\n        this.localNormal = new b2Math_1.b2Vec2();\n        this.localPoint = new b2Math_1.b2Vec2();\n        this.type = b2ManifoldType.e_unknown;\n        this.pointCount = 0;\n    }\n    b2Manifold.prototype.Reset = function () {\n        for (var i = 0; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n            /// b2Assert(this.points[i] instanceof b2ManifoldPoint);\n            this.points[i].Reset();\n        }\n        this.localNormal.SetZero();\n        this.localPoint.SetZero();\n        this.type = b2ManifoldType.e_unknown;\n        this.pointCount = 0;\n    };\n    b2Manifold.prototype.Copy = function (o) {\n        this.pointCount = o.pointCount;\n        for (var i = 0; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n            /// b2Assert(this.points[i] instanceof b2ManifoldPoint);\n            this.points[i].Copy(o.points[i]);\n        }\n        this.localNormal.Copy(o.localNormal);\n        this.localPoint.Copy(o.localPoint);\n        this.type = o.type;\n        return this;\n    };\n    b2Manifold.prototype.Clone = function () {\n        return new b2Manifold().Copy(this);\n    };\n    return b2Manifold;\n}());\nexports.b2Manifold = b2Manifold;\nvar b2WorldManifold = /** @class */ (function () {\n    function b2WorldManifold() {\n        this.normal = new b2Math_1.b2Vec2();\n        this.points = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxManifoldPoints);\n        this.separations = b2Settings_1.b2MakeNumberArray(b2Settings_1.b2_maxManifoldPoints);\n    }\n    b2WorldManifold.prototype.Initialize = function (manifold, xfA, radiusA, xfB, radiusB) {\n        if (manifold.pointCount === 0) {\n            return;\n        }\n        switch (manifold.type) {\n            case b2ManifoldType.e_circles:\n                {\n                    this.normal.Set(1, 0);\n                    var pointA = b2Math_1.b2Transform.MulXV(xfA, manifold.localPoint, b2WorldManifold.Initialize_s_pointA);\n                    var pointB = b2Math_1.b2Transform.MulXV(xfB, manifold.points[0].localPoint, b2WorldManifold.Initialize_s_pointB);\n                    if (b2Math_1.b2Vec2.DistanceSquaredVV(pointA, pointB) > b2Settings_1.b2_epsilon_sq) {\n                        b2Math_1.b2Vec2.SubVV(pointB, pointA, this.normal).SelfNormalize();\n                    }\n                    var cA = b2Math_1.b2Vec2.AddVMulSV(pointA, radiusA, this.normal, b2WorldManifold.Initialize_s_cA);\n                    var cB = b2Math_1.b2Vec2.SubVMulSV(pointB, radiusB, this.normal, b2WorldManifold.Initialize_s_cB);\n                    b2Math_1.b2Vec2.MidVV(cA, cB, this.points[0]);\n                    this.separations[0] = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cB, cA, b2Math_1.b2Vec2.s_t0), this.normal); // b2Dot(cB - cA, normal);\n                }\n                break;\n            case b2ManifoldType.e_faceA:\n                {\n                    b2Math_1.b2Rot.MulRV(xfA.q, manifold.localNormal, this.normal);\n                    var planePoint = b2Math_1.b2Transform.MulXV(xfA, manifold.localPoint, b2WorldManifold.Initialize_s_planePoint);\n                    for (var i = 0; i < manifold.pointCount; ++i) {\n                        var clipPoint = b2Math_1.b2Transform.MulXV(xfB, manifold.points[i].localPoint, b2WorldManifold.Initialize_s_clipPoint);\n                        var s = radiusA - b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(clipPoint, planePoint, b2Math_1.b2Vec2.s_t0), this.normal);\n                        var cA = b2Math_1.b2Vec2.AddVMulSV(clipPoint, s, this.normal, b2WorldManifold.Initialize_s_cA);\n                        var cB = b2Math_1.b2Vec2.SubVMulSV(clipPoint, radiusB, this.normal, b2WorldManifold.Initialize_s_cB);\n                        b2Math_1.b2Vec2.MidVV(cA, cB, this.points[i]);\n                        this.separations[i] = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cB, cA, b2Math_1.b2Vec2.s_t0), this.normal); // b2Dot(cB - cA, normal);\n                    }\n                }\n                break;\n            case b2ManifoldType.e_faceB:\n                {\n                    b2Math_1.b2Rot.MulRV(xfB.q, manifold.localNormal, this.normal);\n                    var planePoint = b2Math_1.b2Transform.MulXV(xfB, manifold.localPoint, b2WorldManifold.Initialize_s_planePoint);\n                    for (var i = 0; i < manifold.pointCount; ++i) {\n                        var clipPoint = b2Math_1.b2Transform.MulXV(xfA, manifold.points[i].localPoint, b2WorldManifold.Initialize_s_clipPoint);\n                        var s = radiusB - b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(clipPoint, planePoint, b2Math_1.b2Vec2.s_t0), this.normal);\n                        var cB = b2Math_1.b2Vec2.AddVMulSV(clipPoint, s, this.normal, b2WorldManifold.Initialize_s_cB);\n                        var cA = b2Math_1.b2Vec2.SubVMulSV(clipPoint, radiusA, this.normal, b2WorldManifold.Initialize_s_cA);\n                        b2Math_1.b2Vec2.MidVV(cA, cB, this.points[i]);\n                        this.separations[i] = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(cA, cB, b2Math_1.b2Vec2.s_t0), this.normal); // b2Dot(cA - cB, normal);\n                    }\n                    // Ensure normal points from A to B.\n                    this.normal.SelfNeg();\n                }\n                break;\n        }\n    };\n    b2WorldManifold.Initialize_s_pointA = new b2Math_1.b2Vec2();\n    b2WorldManifold.Initialize_s_pointB = new b2Math_1.b2Vec2();\n    b2WorldManifold.Initialize_s_cA = new b2Math_1.b2Vec2();\n    b2WorldManifold.Initialize_s_cB = new b2Math_1.b2Vec2();\n    b2WorldManifold.Initialize_s_planePoint = new b2Math_1.b2Vec2();\n    b2WorldManifold.Initialize_s_clipPoint = new b2Math_1.b2Vec2();\n    return b2WorldManifold;\n}());\nexports.b2WorldManifold = b2WorldManifold;\n/// This is used for determining the state of contact points.\nvar b2PointState;\n(function (b2PointState) {\n    b2PointState[b2PointState[\"b2_nullState\"] = 0] = \"b2_nullState\";\n    b2PointState[b2PointState[\"b2_addState\"] = 1] = \"b2_addState\";\n    b2PointState[b2PointState[\"b2_persistState\"] = 2] = \"b2_persistState\";\n    b2PointState[b2PointState[\"b2_removeState\"] = 3] = \"b2_removeState\"; /// < point was removed in the update\n})(b2PointState = exports.b2PointState || (exports.b2PointState = {}));\n/// Compute the point states given two manifolds. The states pertain to the transition from manifold1\n/// to manifold2. So state1 is either persist or remove while state2 is either add or persist.\nfunction b2GetPointStates(state1, state2, manifold1, manifold2) {\n    // Detect persists and removes.\n    var i;\n    for (i = 0; i < manifold1.pointCount; ++i) {\n        var id = manifold1.points[i].id;\n        var key = id.key;\n        state1[i] = b2PointState.b2_removeState;\n        for (var j = 0, jct = manifold2.pointCount; j < jct; ++j) {\n            if (manifold2.points[j].id.key === key) {\n                state1[i] = b2PointState.b2_persistState;\n                break;\n            }\n        }\n    }\n    for (; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n        state1[i] = b2PointState.b2_nullState;\n    }\n    // Detect persists and adds.\n    for (i = 0; i < manifold2.pointCount; ++i) {\n        var id = manifold2.points[i].id;\n        var key = id.key;\n        state2[i] = b2PointState.b2_addState;\n        for (var j = 0, jct = manifold1.pointCount; j < jct; ++j) {\n            if (manifold1.points[j].id.key === key) {\n                state2[i] = b2PointState.b2_persistState;\n                break;\n            }\n        }\n    }\n    for (; i < b2Settings_1.b2_maxManifoldPoints; ++i) {\n        state2[i] = b2PointState.b2_nullState;\n    }\n}\nexports.b2GetPointStates = b2GetPointStates;\n/// Used for computing contact manifolds.\nvar b2ClipVertex = /** @class */ (function () {\n    function b2ClipVertex() {\n        this.v = new b2Math_1.b2Vec2();\n        this.id = new b2ContactID();\n    }\n    b2ClipVertex.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2ClipVertex(); });\n    };\n    b2ClipVertex.prototype.Copy = function (other) {\n        this.v.Copy(other.v);\n        this.id.Copy(other.id);\n        return this;\n    };\n    return b2ClipVertex;\n}());\nexports.b2ClipVertex = b2ClipVertex;\n/// Ray-cast input data. The ray extends from p1 to p1 + maxFraction * (p2 - p1).\nvar b2RayCastInput = /** @class */ (function () {\n    function b2RayCastInput() {\n        this.p1 = new b2Math_1.b2Vec2();\n        this.p2 = new b2Math_1.b2Vec2();\n        this.maxFraction = 1;\n    }\n    b2RayCastInput.prototype.Copy = function (o) {\n        this.p1.Copy(o.p1);\n        this.p2.Copy(o.p2);\n        this.maxFraction = o.maxFraction;\n        return this;\n    };\n    return b2RayCastInput;\n}());\nexports.b2RayCastInput = b2RayCastInput;\n/// Ray-cast output data. The ray hits at p1 + fraction * (p2 - p1), where p1 and p2\n/// come from b2RayCastInput.\nvar b2RayCastOutput = /** @class */ (function () {\n    function b2RayCastOutput() {\n        this.normal = new b2Math_1.b2Vec2();\n        this.fraction = 0;\n    }\n    b2RayCastOutput.prototype.Copy = function (o) {\n        this.normal.Copy(o.normal);\n        this.fraction = o.fraction;\n        return this;\n    };\n    return b2RayCastOutput;\n}());\nexports.b2RayCastOutput = b2RayCastOutput;\n/// An axis aligned bounding box.\nvar b2AABB = /** @class */ (function () {\n    function b2AABB() {\n        this.lowerBound = new b2Math_1.b2Vec2(); /// < the lower vertex\n        this.upperBound = new b2Math_1.b2Vec2(); /// < the upper vertex\n        this.m_cache_center = new b2Math_1.b2Vec2(); // access using GetCenter()\n        this.m_cache_extent = new b2Math_1.b2Vec2(); // access using GetExtents()\n    }\n    b2AABB.prototype.Copy = function (o) {\n        this.lowerBound.Copy(o.lowerBound);\n        this.upperBound.Copy(o.upperBound);\n        return this;\n    };\n    /// Verify that the bounds are sorted.\n    b2AABB.prototype.IsValid = function () {\n        var d_x = this.upperBound.x - this.lowerBound.x;\n        var d_y = this.upperBound.y - this.lowerBound.y;\n        var valid = d_x >= 0 && d_y >= 0;\n        valid = valid && this.lowerBound.IsValid() && this.upperBound.IsValid();\n        return valid;\n    };\n    /// Get the center of the AABB.\n    b2AABB.prototype.GetCenter = function () {\n        return b2Math_1.b2Vec2.MidVV(this.lowerBound, this.upperBound, this.m_cache_center);\n    };\n    /// Get the extents of the AABB (half-widths).\n    b2AABB.prototype.GetExtents = function () {\n        return b2Math_1.b2Vec2.ExtVV(this.lowerBound, this.upperBound, this.m_cache_extent);\n    };\n    /// Get the perimeter length\n    b2AABB.prototype.GetPerimeter = function () {\n        var wx = this.upperBound.x - this.lowerBound.x;\n        var wy = this.upperBound.y - this.lowerBound.y;\n        return 2 * (wx + wy);\n    };\n    /// Combine an AABB into this one.\n    b2AABB.prototype.Combine1 = function (aabb) {\n        this.lowerBound.x = b2Math_1.b2Min(this.lowerBound.x, aabb.lowerBound.x);\n        this.lowerBound.y = b2Math_1.b2Min(this.lowerBound.y, aabb.lowerBound.y);\n        this.upperBound.x = b2Math_1.b2Max(this.upperBound.x, aabb.upperBound.x);\n        this.upperBound.y = b2Math_1.b2Max(this.upperBound.y, aabb.upperBound.y);\n        return this;\n    };\n    /// Combine two AABBs into this one.\n    b2AABB.prototype.Combine2 = function (aabb1, aabb2) {\n        this.lowerBound.x = b2Math_1.b2Min(aabb1.lowerBound.x, aabb2.lowerBound.x);\n        this.lowerBound.y = b2Math_1.b2Min(aabb1.lowerBound.y, aabb2.lowerBound.y);\n        this.upperBound.x = b2Math_1.b2Max(aabb1.upperBound.x, aabb2.upperBound.x);\n        this.upperBound.y = b2Math_1.b2Max(aabb1.upperBound.y, aabb2.upperBound.y);\n        return this;\n    };\n    b2AABB.Combine = function (aabb1, aabb2, out) {\n        out.Combine2(aabb1, aabb2);\n        return out;\n    };\n    /// Does this aabb contain the provided AABB.\n    b2AABB.prototype.Contains = function (aabb) {\n        var result = true;\n        result = result && this.lowerBound.x <= aabb.lowerBound.x;\n        result = result && this.lowerBound.y <= aabb.lowerBound.y;\n        result = result && aabb.upperBound.x <= this.upperBound.x;\n        result = result && aabb.upperBound.y <= this.upperBound.y;\n        return result;\n    };\n    // From Real-time Collision Detection, p179.\n    b2AABB.prototype.RayCast = function (output, input) {\n        var tmin = (-b2Settings_1.b2_maxFloat);\n        var tmax = b2Settings_1.b2_maxFloat;\n        var p_x = input.p1.x;\n        var p_y = input.p1.y;\n        var d_x = input.p2.x - input.p1.x;\n        var d_y = input.p2.y - input.p1.y;\n        var absD_x = b2Math_1.b2Abs(d_x);\n        var absD_y = b2Math_1.b2Abs(d_y);\n        var normal = output.normal;\n        if (absD_x < b2Settings_1.b2_epsilon) {\n            // Parallel.\n            if (p_x < this.lowerBound.x || this.upperBound.x < p_x) {\n                return false;\n            }\n        }\n        else {\n            var inv_d = 1 / d_x;\n            var t1 = (this.lowerBound.x - p_x) * inv_d;\n            var t2 = (this.upperBound.x - p_x) * inv_d;\n            // Sign of the normal vector.\n            var s = (-1);\n            if (t1 > t2) {\n                var t3 = t1;\n                t1 = t2;\n                t2 = t3;\n                s = 1;\n            }\n            // Push the min up\n            if (t1 > tmin) {\n                normal.x = s;\n                normal.y = 0;\n                tmin = t1;\n            }\n            // Pull the max down\n            tmax = b2Math_1.b2Min(tmax, t2);\n            if (tmin > tmax) {\n                return false;\n            }\n        }\n        if (absD_y < b2Settings_1.b2_epsilon) {\n            // Parallel.\n            if (p_y < this.lowerBound.y || this.upperBound.y < p_y) {\n                return false;\n            }\n        }\n        else {\n            var inv_d = 1 / d_y;\n            var t1 = (this.lowerBound.y - p_y) * inv_d;\n            var t2 = (this.upperBound.y - p_y) * inv_d;\n            // Sign of the normal vector.\n            var s = (-1);\n            if (t1 > t2) {\n                var t3 = t1;\n                t1 = t2;\n                t2 = t3;\n                s = 1;\n            }\n            // Push the min up\n            if (t1 > tmin) {\n                normal.x = 0;\n                normal.y = s;\n                tmin = t1;\n            }\n            // Pull the max down\n            tmax = b2Math_1.b2Min(tmax, t2);\n            if (tmin > tmax) {\n                return false;\n            }\n        }\n        // Does the ray start inside the box?\n        // Does the ray intersect beyond the max fraction?\n        if (tmin < 0 || input.maxFraction < tmin) {\n            return false;\n        }\n        // Intersection.\n        output.fraction = tmin;\n        return true;\n    };\n    b2AABB.prototype.TestOverlap = function (other) {\n        var d1_x = other.lowerBound.x - this.upperBound.x;\n        var d1_y = other.lowerBound.y - this.upperBound.y;\n        var d2_x = this.lowerBound.x - other.upperBound.x;\n        var d2_y = this.lowerBound.y - other.upperBound.y;\n        if (d1_x > 0 || d1_y > 0) {\n            return false;\n        }\n        if (d2_x > 0 || d2_y > 0) {\n            return false;\n        }\n        return true;\n    };\n    return b2AABB;\n}());\nexports.b2AABB = b2AABB;\nfunction b2TestOverlapAABB(a, b) {\n    var d1_x = b.lowerBound.x - a.upperBound.x;\n    var d1_y = b.lowerBound.y - a.upperBound.y;\n    var d2_x = a.lowerBound.x - b.upperBound.x;\n    var d2_y = a.lowerBound.y - b.upperBound.y;\n    if (d1_x > 0 || d1_y > 0) {\n        return false;\n    }\n    if (d2_x > 0 || d2_y > 0) {\n        return false;\n    }\n    return true;\n}\nexports.b2TestOverlapAABB = b2TestOverlapAABB;\n/// Clipping for contact manifolds.\nfunction b2ClipSegmentToLine(vOut, vIn, normal, offset, vertexIndexA) {\n    // Start with no output points\n    var numOut = 0;\n    var vIn0 = vIn[0];\n    var vIn1 = vIn[1];\n    // Calculate the distance of end points to the line\n    var distance0 = b2Math_1.b2Vec2.DotVV(normal, vIn0.v) - offset;\n    var distance1 = b2Math_1.b2Vec2.DotVV(normal, vIn1.v) - offset;\n    // If the points are behind the plane\n    if (distance0 <= 0) {\n        vOut[numOut++].Copy(vIn0);\n    }\n    if (distance1 <= 0) {\n        vOut[numOut++].Copy(vIn1);\n    }\n    // If the points are on different sides of the plane\n    if (distance0 * distance1 < 0) {\n        // Find intersection point of edge and plane\n        var interp = distance0 / (distance0 - distance1);\n        var v = vOut[numOut].v;\n        v.x = vIn0.v.x + interp * (vIn1.v.x - vIn0.v.x);\n        v.y = vIn0.v.y + interp * (vIn1.v.y - vIn0.v.y);\n        // VertexA is hitting edgeB.\n        var id = vOut[numOut].id;\n        id.cf.indexA = vertexIndexA;\n        id.cf.indexB = vIn0.id.cf.indexB;\n        id.cf.typeA = b2ContactFeatureType.e_vertex;\n        id.cf.typeB = b2ContactFeatureType.e_face;\n        ++numOut;\n    }\n    return numOut;\n}\nexports.b2ClipSegmentToLine = b2ClipSegmentToLine;\n/// Determine if two generic shapes overlap.\nvar b2TestOverlapShape_s_input = new b2Distance_1.b2DistanceInput();\nvar b2TestOverlapShape_s_simplexCache = new b2Distance_1.b2SimplexCache();\nvar b2TestOverlapShape_s_output = new b2Distance_1.b2DistanceOutput();\nfunction b2TestOverlapShape(shapeA, indexA, shapeB, indexB, xfA, xfB) {\n    var input = b2TestOverlapShape_s_input.Reset();\n    input.proxyA.SetShape(shapeA, indexA);\n    input.proxyB.SetShape(shapeB, indexB);\n    input.transformA.Copy(xfA);\n    input.transformB.Copy(xfB);\n    input.useRadii = true;\n    var simplexCache = b2TestOverlapShape_s_simplexCache.Reset();\n    simplexCache.count = 0;\n    var output = b2TestOverlapShape_s_output.Reset();\n    b2Distance_1.b2Distance(output, simplexCache, input);\n    return output.distance < 10 * b2Settings_1.b2_epsilon;\n}\nexports.b2TestOverlapShape = b2TestOverlapShape;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2Collision.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2Distance.ts":
/*!*******************************************!*\
  !*** ./src/Box2D/Collision/b2Distance.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n/// A distance proxy is used by the GJK algorithm.\n/// It encapsulates any shape.\nvar b2DistanceProxy = /** @class */ (function () {\n    function b2DistanceProxy() {\n        this.m_buffer = b2Math_1.b2Vec2.MakeArray(2);\n        this.m_vertices = this.m_buffer;\n        this.m_count = 0;\n        this.m_radius = 0;\n    }\n    b2DistanceProxy.prototype.Reset = function () {\n        this.m_vertices = this.m_buffer;\n        this.m_count = 0;\n        this.m_radius = 0;\n        return this;\n    };\n    b2DistanceProxy.prototype.SetShape = function (shape, index) {\n        shape.SetupDistanceProxy(this, index);\n    };\n    b2DistanceProxy.prototype.GetSupport = function (d) {\n        var bestIndex = 0;\n        var bestValue = b2Math_1.b2Vec2.DotVV(this.m_vertices[0], d);\n        for (var i = 1; i < this.m_count; ++i) {\n            var value = b2Math_1.b2Vec2.DotVV(this.m_vertices[i], d);\n            if (value > bestValue) {\n                bestIndex = i;\n                bestValue = value;\n            }\n        }\n        return bestIndex;\n    };\n    b2DistanceProxy.prototype.GetSupportVertex = function (d) {\n        var bestIndex = 0;\n        var bestValue = b2Math_1.b2Vec2.DotVV(this.m_vertices[0], d);\n        for (var i = 1; i < this.m_count; ++i) {\n            var value = b2Math_1.b2Vec2.DotVV(this.m_vertices[i], d);\n            if (value > bestValue) {\n                bestIndex = i;\n                bestValue = value;\n            }\n        }\n        return this.m_vertices[bestIndex];\n    };\n    b2DistanceProxy.prototype.GetVertexCount = function () {\n        return this.m_count;\n    };\n    b2DistanceProxy.prototype.GetVertex = function (index) {\n        /// b2Assert(0 <= index && index < this.m_count);\n        return this.m_vertices[index];\n    };\n    return b2DistanceProxy;\n}());\nexports.b2DistanceProxy = b2DistanceProxy;\nvar b2SimplexCache = /** @class */ (function () {\n    function b2SimplexCache() {\n        this.metric = 0;\n        this.count = 0;\n        this.indexA = [0, 0, 0];\n        this.indexB = [0, 0, 0];\n    }\n    b2SimplexCache.prototype.Reset = function () {\n        this.metric = 0;\n        this.count = 0;\n        return this;\n    };\n    return b2SimplexCache;\n}());\nexports.b2SimplexCache = b2SimplexCache;\nvar b2DistanceInput = /** @class */ (function () {\n    function b2DistanceInput() {\n        this.proxyA = new b2DistanceProxy();\n        this.proxyB = new b2DistanceProxy();\n        this.transformA = new b2Math_1.b2Transform();\n        this.transformB = new b2Math_1.b2Transform();\n        this.useRadii = false;\n    }\n    b2DistanceInput.prototype.Reset = function () {\n        this.proxyA.Reset();\n        this.proxyB.Reset();\n        this.transformA.SetIdentity();\n        this.transformB.SetIdentity();\n        this.useRadii = false;\n        return this;\n    };\n    return b2DistanceInput;\n}());\nexports.b2DistanceInput = b2DistanceInput;\nvar b2DistanceOutput = /** @class */ (function () {\n    function b2DistanceOutput() {\n        this.pointA = new b2Math_1.b2Vec2();\n        this.pointB = new b2Math_1.b2Vec2();\n        this.distance = 0;\n        this.iterations = 0; /// < number of GJK iterations used\n    }\n    b2DistanceOutput.prototype.Reset = function () {\n        this.pointA.SetZero();\n        this.pointB.SetZero();\n        this.distance = 0;\n        this.iterations = 0;\n        return this;\n    };\n    return b2DistanceOutput;\n}());\nexports.b2DistanceOutput = b2DistanceOutput;\nexports.b2_gjkCalls = 0;\nexports.b2_gjkIters = 0;\nexports.b2_gjkMaxIters = 0;\nfunction b2_gjk_reset() {\n    exports.b2_gjkCalls = 0;\n    exports.b2_gjkIters = 0;\n    exports.b2_gjkMaxIters = 0;\n}\nexports.b2_gjk_reset = b2_gjk_reset;\nvar b2SimplexVertex = /** @class */ (function () {\n    function b2SimplexVertex() {\n        this.wA = new b2Math_1.b2Vec2(); // support point in proxyA\n        this.wB = new b2Math_1.b2Vec2(); // support point in proxyB\n        this.w = new b2Math_1.b2Vec2(); // wB - wA\n        this.a = 0; // barycentric coordinate for closest point\n        this.indexA = 0; // wA index\n        this.indexB = 0; // wB index\n    }\n    b2SimplexVertex.prototype.Copy = function (other) {\n        this.wA.Copy(other.wA); // support point in proxyA\n        this.wB.Copy(other.wB); // support point in proxyB\n        this.w.Copy(other.w); // wB - wA\n        this.a = other.a; // barycentric coordinate for closest point\n        this.indexA = other.indexA; // wA index\n        this.indexB = other.indexB; // wB index\n        return this;\n    };\n    return b2SimplexVertex;\n}());\nexports.b2SimplexVertex = b2SimplexVertex;\nvar b2Simplex = /** @class */ (function () {\n    function b2Simplex() {\n        this.m_v1 = new b2SimplexVertex();\n        this.m_v2 = new b2SimplexVertex();\n        this.m_v3 = new b2SimplexVertex();\n        this.m_vertices = [ /*3*/];\n        this.m_count = 0;\n        this.m_vertices[0] = this.m_v1;\n        this.m_vertices[1] = this.m_v2;\n        this.m_vertices[2] = this.m_v3;\n    }\n    b2Simplex.prototype.ReadCache = function (cache, proxyA, transformA, proxyB, transformB) {\n        /// b2Assert(0 <= cache.count && cache.count <= 3);\n        // Copy data from cache.\n        this.m_count = cache.count;\n        var vertices = this.m_vertices;\n        for (var i = 0; i < this.m_count; ++i) {\n            var v = vertices[i];\n            v.indexA = cache.indexA[i];\n            v.indexB = cache.indexB[i];\n            var wALocal = proxyA.GetVertex(v.indexA);\n            var wBLocal = proxyB.GetVertex(v.indexB);\n            b2Math_1.b2Transform.MulXV(transformA, wALocal, v.wA);\n            b2Math_1.b2Transform.MulXV(transformB, wBLocal, v.wB);\n            b2Math_1.b2Vec2.SubVV(v.wB, v.wA, v.w);\n            v.a = 0;\n        }\n        // Compute the new simplex metric, if it is substantially different than\n        // old metric then flush the simplex.\n        if (this.m_count > 1) {\n            var metric1 = cache.metric;\n            var metric2 = this.GetMetric();\n            if (metric2 < 0.5 * metric1 || 2 * metric1 < metric2 || metric2 < b2Settings_1.b2_epsilon) {\n                // Reset the simplex.\n                this.m_count = 0;\n            }\n        }\n        // If the cache is empty or invalid ...\n        if (this.m_count === 0) {\n            var v = vertices[0];\n            v.indexA = 0;\n            v.indexB = 0;\n            var wALocal = proxyA.GetVertex(0);\n            var wBLocal = proxyB.GetVertex(0);\n            b2Math_1.b2Transform.MulXV(transformA, wALocal, v.wA);\n            b2Math_1.b2Transform.MulXV(transformB, wBLocal, v.wB);\n            b2Math_1.b2Vec2.SubVV(v.wB, v.wA, v.w);\n            v.a = 1;\n            this.m_count = 1;\n        }\n    };\n    b2Simplex.prototype.WriteCache = function (cache) {\n        cache.metric = this.GetMetric();\n        cache.count = this.m_count;\n        var vertices = this.m_vertices;\n        for (var i = 0; i < this.m_count; ++i) {\n            cache.indexA[i] = vertices[i].indexA;\n            cache.indexB[i] = vertices[i].indexB;\n        }\n    };\n    b2Simplex.prototype.GetSearchDirection = function (out) {\n        switch (this.m_count) {\n            case 1:\n                return b2Math_1.b2Vec2.NegV(this.m_v1.w, out);\n            case 2: {\n                var e12 = b2Math_1.b2Vec2.SubVV(this.m_v2.w, this.m_v1.w, out);\n                var sgn = b2Math_1.b2Vec2.CrossVV(e12, b2Math_1.b2Vec2.NegV(this.m_v1.w, b2Math_1.b2Vec2.s_t0));\n                if (sgn > 0) {\n                    // Origin is left of e12.\n                    return b2Math_1.b2Vec2.CrossOneV(e12, out);\n                }\n                else {\n                    // Origin is right of e12.\n                    return b2Math_1.b2Vec2.CrossVOne(e12, out);\n                }\n            }\n            default:\n                /// b2Assert(false);\n                return out.SetZero();\n        }\n    };\n    b2Simplex.prototype.GetClosestPoint = function (out) {\n        switch (this.m_count) {\n            case 0:\n                /// b2Assert(false);\n                return out.SetZero();\n            case 1:\n                return out.Copy(this.m_v1.w);\n            case 2:\n                return out.Set(this.m_v1.a * this.m_v1.w.x + this.m_v2.a * this.m_v2.w.x, this.m_v1.a * this.m_v1.w.y + this.m_v2.a * this.m_v2.w.y);\n            case 3:\n                return out.SetZero();\n            default:\n                /// b2Assert(false);\n                return out.SetZero();\n        }\n    };\n    b2Simplex.prototype.GetWitnessPoints = function (pA, pB) {\n        switch (this.m_count) {\n            case 0:\n                /// b2Assert(false);\n                break;\n            case 1:\n                pA.Copy(this.m_v1.wA);\n                pB.Copy(this.m_v1.wB);\n                break;\n            case 2:\n                pA.x = this.m_v1.a * this.m_v1.wA.x + this.m_v2.a * this.m_v2.wA.x;\n                pA.y = this.m_v1.a * this.m_v1.wA.y + this.m_v2.a * this.m_v2.wA.y;\n                pB.x = this.m_v1.a * this.m_v1.wB.x + this.m_v2.a * this.m_v2.wB.x;\n                pB.y = this.m_v1.a * this.m_v1.wB.y + this.m_v2.a * this.m_v2.wB.y;\n                break;\n            case 3:\n                pB.x = pA.x = this.m_v1.a * this.m_v1.wA.x + this.m_v2.a * this.m_v2.wA.x + this.m_v3.a * this.m_v3.wA.x;\n                pB.y = pA.y = this.m_v1.a * this.m_v1.wA.y + this.m_v2.a * this.m_v2.wA.y + this.m_v3.a * this.m_v3.wA.y;\n                break;\n            default:\n                /// b2Assert(false);\n                break;\n        }\n    };\n    b2Simplex.prototype.GetMetric = function () {\n        switch (this.m_count) {\n            case 0:\n                /// b2Assert(false);\n                return 0;\n            case 1:\n                return 0;\n            case 2:\n                return b2Math_1.b2Vec2.DistanceVV(this.m_v1.w, this.m_v2.w);\n            case 3:\n                return b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.SubVV(this.m_v2.w, this.m_v1.w, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(this.m_v3.w, this.m_v1.w, b2Math_1.b2Vec2.s_t1));\n            default:\n                /// b2Assert(false);\n                return 0;\n        }\n    };\n    b2Simplex.prototype.Solve2 = function () {\n        var w1 = this.m_v1.w;\n        var w2 = this.m_v2.w;\n        var e12 = b2Math_1.b2Vec2.SubVV(w2, w1, b2Simplex.s_e12);\n        // w1 region\n        var d12_2 = (-b2Math_1.b2Vec2.DotVV(w1, e12));\n        if (d12_2 <= 0) {\n            // a2 <= 0, so we clamp it to 0\n            this.m_v1.a = 1;\n            this.m_count = 1;\n            return;\n        }\n        // w2 region\n        var d12_1 = b2Math_1.b2Vec2.DotVV(w2, e12);\n        if (d12_1 <= 0) {\n            // a1 <= 0, so we clamp it to 0\n            this.m_v2.a = 1;\n            this.m_count = 1;\n            this.m_v1.Copy(this.m_v2);\n            return;\n        }\n        // Must be in e12 region.\n        var inv_d12 = 1 / (d12_1 + d12_2);\n        this.m_v1.a = d12_1 * inv_d12;\n        this.m_v2.a = d12_2 * inv_d12;\n        this.m_count = 2;\n    };\n    b2Simplex.prototype.Solve3 = function () {\n        var w1 = this.m_v1.w;\n        var w2 = this.m_v2.w;\n        var w3 = this.m_v3.w;\n        // Edge12\n        // [1      1     ][a1] = [1]\n        // [w1.e12 w2.e12][a2] = [0]\n        // a3 = 0\n        var e12 = b2Math_1.b2Vec2.SubVV(w2, w1, b2Simplex.s_e12);\n        var w1e12 = b2Math_1.b2Vec2.DotVV(w1, e12);\n        var w2e12 = b2Math_1.b2Vec2.DotVV(w2, e12);\n        var d12_1 = w2e12;\n        var d12_2 = (-w1e12);\n        // Edge13\n        // [1      1     ][a1] = [1]\n        // [w1.e13 w3.e13][a3] = [0]\n        // a2 = 0\n        var e13 = b2Math_1.b2Vec2.SubVV(w3, w1, b2Simplex.s_e13);\n        var w1e13 = b2Math_1.b2Vec2.DotVV(w1, e13);\n        var w3e13 = b2Math_1.b2Vec2.DotVV(w3, e13);\n        var d13_1 = w3e13;\n        var d13_2 = (-w1e13);\n        // Edge23\n        // [1      1     ][a2] = [1]\n        // [w2.e23 w3.e23][a3] = [0]\n        // a1 = 0\n        var e23 = b2Math_1.b2Vec2.SubVV(w3, w2, b2Simplex.s_e23);\n        var w2e23 = b2Math_1.b2Vec2.DotVV(w2, e23);\n        var w3e23 = b2Math_1.b2Vec2.DotVV(w3, e23);\n        var d23_1 = w3e23;\n        var d23_2 = (-w2e23);\n        // Triangle123\n        var n123 = b2Math_1.b2Vec2.CrossVV(e12, e13);\n        var d123_1 = n123 * b2Math_1.b2Vec2.CrossVV(w2, w3);\n        var d123_2 = n123 * b2Math_1.b2Vec2.CrossVV(w3, w1);\n        var d123_3 = n123 * b2Math_1.b2Vec2.CrossVV(w1, w2);\n        // w1 region\n        if (d12_2 <= 0 && d13_2 <= 0) {\n            this.m_v1.a = 1;\n            this.m_count = 1;\n            return;\n        }\n        // e12\n        if (d12_1 > 0 && d12_2 > 0 && d123_3 <= 0) {\n            var inv_d12 = 1 / (d12_1 + d12_2);\n            this.m_v1.a = d12_1 * inv_d12;\n            this.m_v2.a = d12_2 * inv_d12;\n            this.m_count = 2;\n            return;\n        }\n        // e13\n        if (d13_1 > 0 && d13_2 > 0 && d123_2 <= 0) {\n            var inv_d13 = 1 / (d13_1 + d13_2);\n            this.m_v1.a = d13_1 * inv_d13;\n            this.m_v3.a = d13_2 * inv_d13;\n            this.m_count = 2;\n            this.m_v2.Copy(this.m_v3);\n            return;\n        }\n        // w2 region\n        if (d12_1 <= 0 && d23_2 <= 0) {\n            this.m_v2.a = 1;\n            this.m_count = 1;\n            this.m_v1.Copy(this.m_v2);\n            return;\n        }\n        // w3 region\n        if (d13_1 <= 0 && d23_1 <= 0) {\n            this.m_v3.a = 1;\n            this.m_count = 1;\n            this.m_v1.Copy(this.m_v3);\n            return;\n        }\n        // e23\n        if (d23_1 > 0 && d23_2 > 0 && d123_1 <= 0) {\n            var inv_d23 = 1 / (d23_1 + d23_2);\n            this.m_v2.a = d23_1 * inv_d23;\n            this.m_v3.a = d23_2 * inv_d23;\n            this.m_count = 2;\n            this.m_v1.Copy(this.m_v3);\n            return;\n        }\n        // Must be in triangle123\n        var inv_d123 = 1 / (d123_1 + d123_2 + d123_3);\n        this.m_v1.a = d123_1 * inv_d123;\n        this.m_v2.a = d123_2 * inv_d123;\n        this.m_v3.a = d123_3 * inv_d123;\n        this.m_count = 3;\n    };\n    b2Simplex.s_e12 = new b2Math_1.b2Vec2();\n    b2Simplex.s_e13 = new b2Math_1.b2Vec2();\n    b2Simplex.s_e23 = new b2Math_1.b2Vec2();\n    return b2Simplex;\n}());\nexports.b2Simplex = b2Simplex;\nvar b2Distance_s_simplex = new b2Simplex();\nvar b2Distance_s_saveA = [0, 0, 0];\nvar b2Distance_s_saveB = [0, 0, 0];\nvar b2Distance_s_p = new b2Math_1.b2Vec2();\nvar b2Distance_s_d = new b2Math_1.b2Vec2();\nvar b2Distance_s_normal = new b2Math_1.b2Vec2();\nvar b2Distance_s_supportA = new b2Math_1.b2Vec2();\nvar b2Distance_s_supportB = new b2Math_1.b2Vec2();\nfunction b2Distance(output, cache, input) {\n    ++exports.b2_gjkCalls;\n    var proxyA = input.proxyA;\n    var proxyB = input.proxyB;\n    var transformA = input.transformA;\n    var transformB = input.transformB;\n    // Initialize the simplex.\n    var simplex = b2Distance_s_simplex;\n    simplex.ReadCache(cache, proxyA, transformA, proxyB, transformB);\n    // Get simplex vertices as an array.\n    var vertices = simplex.m_vertices;\n    var k_maxIters = 20;\n    // These store the vertices of the last simplex so that we\n    // can check for duplicates and prevent cycling.\n    var saveA = b2Distance_s_saveA;\n    var saveB = b2Distance_s_saveB;\n    var saveCount = 0;\n    var distanceSqr1 = b2Settings_1.b2_maxFloat;\n    var distanceSqr2 = distanceSqr1;\n    // Main iteration loop.\n    var iter = 0;\n    while (iter < k_maxIters) {\n        // Copy simplex so we can identify duplicates.\n        saveCount = simplex.m_count;\n        for (var i = 0; i < saveCount; ++i) {\n            saveA[i] = vertices[i].indexA;\n            saveB[i] = vertices[i].indexB;\n        }\n        switch (simplex.m_count) {\n            case 1:\n                break;\n            case 2:\n                simplex.Solve2();\n                break;\n            case 3:\n                simplex.Solve3();\n                break;\n            default:\n                /// b2Assert(false);\n                break;\n        }\n        // If we have 3 points, then the origin is in the corresponding triangle.\n        if (simplex.m_count === 3) {\n            break;\n        }\n        // Compute closest point.\n        var p = simplex.GetClosestPoint(b2Distance_s_p);\n        distanceSqr2 = p.LengthSquared();\n        // Ensure progress\n        /*\n        TODO: to fix compile warning\n        if (distanceSqr2 > distanceSqr1) {\n          //break;\n        }\n        */\n        distanceSqr1 = distanceSqr2;\n        // Get search direction.\n        var d = simplex.GetSearchDirection(b2Distance_s_d);\n        // Ensure the search direction is numerically fit.\n        if (d.LengthSquared() < b2Settings_1.b2_epsilon_sq) {\n            // The origin is probably contained by a line segment\n            // or triangle. Thus the shapes are overlapped.\n            // We can't return zero here even though there may be overlap.\n            // In case the simplex is a point, segment, or triangle it is difficult\n            // to determine if the origin is contained in the CSO or very close to it.\n            break;\n        }\n        // Compute a tentative new simplex vertex using support points.\n        var vertex = vertices[simplex.m_count];\n        vertex.indexA = proxyA.GetSupport(b2Math_1.b2Rot.MulTRV(transformA.q, b2Math_1.b2Vec2.NegV(d, b2Math_1.b2Vec2.s_t0), b2Distance_s_supportA));\n        b2Math_1.b2Transform.MulXV(transformA, proxyA.GetVertex(vertex.indexA), vertex.wA);\n        vertex.indexB = proxyB.GetSupport(b2Math_1.b2Rot.MulTRV(transformB.q, d, b2Distance_s_supportB));\n        b2Math_1.b2Transform.MulXV(transformB, proxyB.GetVertex(vertex.indexB), vertex.wB);\n        b2Math_1.b2Vec2.SubVV(vertex.wB, vertex.wA, vertex.w);\n        // Iteration count is equated to the number of support point calls.\n        ++iter;\n        ++exports.b2_gjkIters;\n        // Check for duplicate support points. This is the main termination criteria.\n        var duplicate = false;\n        for (var i = 0; i < saveCount; ++i) {\n            if (vertex.indexA === saveA[i] && vertex.indexB === saveB[i]) {\n                duplicate = true;\n                break;\n            }\n        }\n        // If we found a duplicate support point we must exit to avoid cycling.\n        if (duplicate) {\n            break;\n        }\n        // New vertex is ok and needed.\n        ++simplex.m_count;\n    }\n    exports.b2_gjkMaxIters = b2Math_1.b2Max(exports.b2_gjkMaxIters, iter);\n    // Prepare output.\n    simplex.GetWitnessPoints(output.pointA, output.pointB);\n    output.distance = b2Math_1.b2Vec2.DistanceVV(output.pointA, output.pointB);\n    output.iterations = iter;\n    // Cache the simplex.\n    simplex.WriteCache(cache);\n    // Apply radii if requested.\n    if (input.useRadii) {\n        var rA = proxyA.m_radius;\n        var rB = proxyB.m_radius;\n        if (output.distance > (rA + rB) && output.distance > b2Settings_1.b2_epsilon) {\n            // Shapes are still no overlapped.\n            // Move the witness points to the outer surface.\n            output.distance -= rA + rB;\n            var normal = b2Math_1.b2Vec2.SubVV(output.pointB, output.pointA, b2Distance_s_normal);\n            normal.Normalize();\n            output.pointA.SelfMulAdd(rA, normal);\n            output.pointB.SelfMulSub(rB, normal);\n        }\n        else {\n            // Shapes are overlapped when radii are considered.\n            // Move the witness points to the middle.\n            var p = b2Math_1.b2Vec2.MidVV(output.pointA, output.pointB, b2Distance_s_p);\n            output.pointA.Copy(p);\n            output.pointB.Copy(p);\n            output.distance = 0;\n        }\n    }\n}\nexports.b2Distance = b2Distance;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2Distance.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2DynamicTree.ts":
/*!**********************************************!*\
  !*** ./src/Box2D/Collision/b2DynamicTree.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2GrowableStack_1 = __webpack_require__(/*! ../Common/b2GrowableStack */ \"./src/Box2D/Common/b2GrowableStack.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Collision_1 = __webpack_require__(/*! ./b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nfunction verify(value) {\n    if (value === null) {\n        throw new Error();\n    }\n    return value;\n}\n/// A node in the dynamic tree. The client does not interact with this directly.\nvar b2TreeNode = /** @class */ (function () {\n    function b2TreeNode(id) {\n        if (id === void 0) { id = 0; }\n        this.m_id = 0;\n        this.aabb = new b2Collision_1.b2AABB();\n        this.userData = null;\n        this.parent = null; // or next\n        this.child1 = null;\n        this.child2 = null;\n        this.height = 0; // leaf = 0, free node = -1\n        this.m_id = id;\n    }\n    b2TreeNode.prototype.IsLeaf = function () {\n        return this.child1 === null;\n    };\n    return b2TreeNode;\n}());\nexports.b2TreeNode = b2TreeNode;\nvar b2DynamicTree = /** @class */ (function () {\n    function b2DynamicTree() {\n        this.m_root = null;\n        // b2TreeNode* public m_nodes;\n        // int32 public m_nodeCount;\n        // int32 public m_nodeCapacity;\n        this.m_freeList = null;\n        this.m_path = 0;\n        this.m_insertionCount = 0;\n    }\n    b2DynamicTree.prototype.GetUserData = function (proxy) {\n        /// b2Assert(proxy !== null);\n        return proxy.userData;\n    };\n    b2DynamicTree.prototype.GetFatAABB = function (proxy) {\n        /// b2Assert(proxy !== null);\n        return proxy.aabb;\n    };\n    b2DynamicTree.prototype.Query = function (callback, aabb) {\n        if (this.m_root === null) {\n            return;\n        }\n        var stack = b2DynamicTree.s_stack.Reset();\n        stack.Push(this.m_root);\n        while (stack.GetCount() > 0) {\n            var node = stack.Pop();\n            if (node === null) {\n                continue;\n            }\n            if (node.aabb.TestOverlap(aabb)) {\n                if (node.IsLeaf()) {\n                    var proceed = callback(node);\n                    if (!proceed) {\n                        return;\n                    }\n                }\n                else {\n                    stack.Push(node.child1);\n                    stack.Push(node.child2);\n                }\n            }\n        }\n    };\n    b2DynamicTree.prototype.RayCast = function (callback, input) {\n        if (this.m_root === null) {\n            return;\n        }\n        var p1 = input.p1;\n        var p2 = input.p2;\n        var r = b2Math_1.b2Vec2.SubVV(p2, p1, b2DynamicTree.s_r);\n        /// b2Assert(r.LengthSquared() > 0);\n        r.Normalize();\n        // v is perpendicular to the segment.\n        var v = b2Math_1.b2Vec2.CrossOneV(r, b2DynamicTree.s_v);\n        var abs_v = b2Math_1.b2Vec2.AbsV(v, b2DynamicTree.s_abs_v);\n        // Separating axis for segment (Gino, p80).\n        // |dot(v, p1 - c)| > dot(|v|, h)\n        var maxFraction = input.maxFraction;\n        // Build a bounding box for the segment.\n        var segmentAABB = b2DynamicTree.s_segmentAABB;\n        var t_x = p1.x + maxFraction * (p2.x - p1.x);\n        var t_y = p1.y + maxFraction * (p2.y - p1.y);\n        segmentAABB.lowerBound.x = b2Math_1.b2Min(p1.x, t_x);\n        segmentAABB.lowerBound.y = b2Math_1.b2Min(p1.y, t_y);\n        segmentAABB.upperBound.x = b2Math_1.b2Max(p1.x, t_x);\n        segmentAABB.upperBound.y = b2Math_1.b2Max(p1.y, t_y);\n        var stack = b2DynamicTree.s_stack.Reset();\n        stack.Push(this.m_root);\n        while (stack.GetCount() > 0) {\n            var node = stack.Pop();\n            if (node === null) {\n                continue;\n            }\n            if (!b2Collision_1.b2TestOverlapAABB(node.aabb, segmentAABB)) {\n                continue;\n            }\n            // Separating axis for segment (Gino, p80).\n            // |dot(v, p1 - c)| > dot(|v|, h)\n            var c = node.aabb.GetCenter();\n            var h = node.aabb.GetExtents();\n            var separation = b2Math_1.b2Abs(b2Math_1.b2Vec2.DotVV(v, b2Math_1.b2Vec2.SubVV(p1, c, b2Math_1.b2Vec2.s_t0))) - b2Math_1.b2Vec2.DotVV(abs_v, h);\n            if (separation > 0) {\n                continue;\n            }\n            if (node.IsLeaf()) {\n                var subInput = b2DynamicTree.s_subInput;\n                subInput.p1.Copy(input.p1);\n                subInput.p2.Copy(input.p2);\n                subInput.maxFraction = maxFraction;\n                var value = callback(subInput, node);\n                if (value === 0) {\n                    // The client has terminated the ray cast.\n                    return;\n                }\n                if (value > 0) {\n                    // Update segment bounding box.\n                    maxFraction = value;\n                    t_x = p1.x + maxFraction * (p2.x - p1.x);\n                    t_y = p1.y + maxFraction * (p2.y - p1.y);\n                    segmentAABB.lowerBound.x = b2Math_1.b2Min(p1.x, t_x);\n                    segmentAABB.lowerBound.y = b2Math_1.b2Min(p1.y, t_y);\n                    segmentAABB.upperBound.x = b2Math_1.b2Max(p1.x, t_x);\n                    segmentAABB.upperBound.y = b2Math_1.b2Max(p1.y, t_y);\n                }\n            }\n            else {\n                stack.Push(node.child1);\n                stack.Push(node.child2);\n            }\n        }\n    };\n    b2DynamicTree.prototype.AllocateNode = function () {\n        // Expand the node pool as needed.\n        if (this.m_freeList) {\n            var node = this.m_freeList;\n            this.m_freeList = node.parent; // this.m_freeList = node.next;\n            node.parent = null;\n            node.child1 = null;\n            node.child2 = null;\n            node.height = 0;\n            node.userData = null;\n            return node;\n        }\n        return new b2TreeNode(b2DynamicTree.s_node_id++);\n    };\n    b2DynamicTree.prototype.FreeNode = function (node) {\n        node.parent = this.m_freeList; // node.next = this.m_freeList;\n        node.child1 = null;\n        node.child2 = null;\n        node.height = -1;\n        node.userData = null;\n        this.m_freeList = node;\n    };\n    b2DynamicTree.prototype.CreateProxy = function (aabb, userData) {\n        var node = this.AllocateNode();\n        // Fatten the aabb.\n        var r_x = b2Settings_1.b2_aabbExtension;\n        var r_y = b2Settings_1.b2_aabbExtension;\n        node.aabb.lowerBound.x = aabb.lowerBound.x - r_x;\n        node.aabb.lowerBound.y = aabb.lowerBound.y - r_y;\n        node.aabb.upperBound.x = aabb.upperBound.x + r_x;\n        node.aabb.upperBound.y = aabb.upperBound.y + r_y;\n        node.userData = userData;\n        node.height = 0;\n        this.InsertLeaf(node);\n        return node;\n    };\n    b2DynamicTree.prototype.DestroyProxy = function (proxy) {\n        /// b2Assert(proxy.IsLeaf());\n        this.RemoveLeaf(proxy);\n        this.FreeNode(proxy);\n    };\n    b2DynamicTree.prototype.MoveProxy = function (proxy, aabb, displacement) {\n        /// b2Assert(proxy.IsLeaf());\n        if (proxy.aabb.Contains(aabb)) {\n            return false;\n        }\n        this.RemoveLeaf(proxy);\n        // Extend AABB.\n        // Predict AABB displacement.\n        var r_x = b2Settings_1.b2_aabbExtension + b2Settings_1.b2_aabbMultiplier * (displacement.x > 0 ? displacement.x : (-displacement.x));\n        var r_y = b2Settings_1.b2_aabbExtension + b2Settings_1.b2_aabbMultiplier * (displacement.y > 0 ? displacement.y : (-displacement.y));\n        proxy.aabb.lowerBound.x = aabb.lowerBound.x - r_x;\n        proxy.aabb.lowerBound.y = aabb.lowerBound.y - r_y;\n        proxy.aabb.upperBound.x = aabb.upperBound.x + r_x;\n        proxy.aabb.upperBound.y = aabb.upperBound.y + r_y;\n        this.InsertLeaf(proxy);\n        return true;\n    };\n    b2DynamicTree.prototype.InsertLeaf = function (leaf) {\n        ++this.m_insertionCount;\n        if (this.m_root === null) {\n            this.m_root = leaf;\n            this.m_root.parent = null;\n            return;\n        }\n        // Find the best sibling for this node\n        var leafAABB = leaf.aabb;\n        /// const center: b2Vec2 = leafAABB.GetCenter();\n        var index = this.m_root;\n        var child1;\n        var child2;\n        while (!index.IsLeaf()) {\n            child1 = index.child1;\n            child2 = index.child2;\n            var area = index.aabb.GetPerimeter();\n            var combinedAABB = b2DynamicTree.s_combinedAABB;\n            combinedAABB.Combine2(index.aabb, leafAABB);\n            var combinedArea = combinedAABB.GetPerimeter();\n            // Cost of creating a new parent for this node and the new leaf\n            var cost = 2 * combinedArea;\n            // Minimum cost of pushing the leaf further down the tree\n            var inheritanceCost = 2 * (combinedArea - area);\n            // Cost of descending into child1\n            var cost1 = void 0;\n            var aabb = b2DynamicTree.s_aabb;\n            var oldArea = void 0;\n            var newArea = void 0;\n            if (child1.IsLeaf()) {\n                aabb.Combine2(leafAABB, child1.aabb);\n                cost1 = aabb.GetPerimeter() + inheritanceCost;\n            }\n            else {\n                aabb.Combine2(leafAABB, child1.aabb);\n                oldArea = child1.aabb.GetPerimeter();\n                newArea = aabb.GetPerimeter();\n                cost1 = (newArea - oldArea) + inheritanceCost;\n            }\n            // Cost of descending into child2\n            var cost2 = void 0;\n            if (child2.IsLeaf()) {\n                aabb.Combine2(leafAABB, child2.aabb);\n                cost2 = aabb.GetPerimeter() + inheritanceCost;\n            }\n            else {\n                aabb.Combine2(leafAABB, child2.aabb);\n                oldArea = child2.aabb.GetPerimeter();\n                newArea = aabb.GetPerimeter();\n                cost2 = newArea - oldArea + inheritanceCost;\n            }\n            // Descend according to the minimum cost.\n            if (cost < cost1 && cost < cost2) {\n                break;\n            }\n            // Descend\n            if (cost1 < cost2) {\n                index = child1;\n            }\n            else {\n                index = child2;\n            }\n        }\n        var sibling = index;\n        // Create a parent for the siblings.\n        var oldParent = sibling.parent;\n        var newParent = this.AllocateNode();\n        newParent.parent = oldParent;\n        newParent.userData = null;\n        newParent.aabb.Combine2(leafAABB, sibling.aabb);\n        newParent.height = sibling.height + 1;\n        if (oldParent) {\n            // The sibling was not the root.\n            if (oldParent.child1 === sibling) {\n                oldParent.child1 = newParent;\n            }\n            else {\n                oldParent.child2 = newParent;\n            }\n            newParent.child1 = sibling;\n            newParent.child2 = leaf;\n            sibling.parent = newParent;\n            leaf.parent = newParent;\n        }\n        else {\n            // The sibling was the root.\n            newParent.child1 = sibling;\n            newParent.child2 = leaf;\n            sibling.parent = newParent;\n            leaf.parent = newParent;\n            this.m_root = newParent;\n        }\n        // Walk back up the tree fixing heights and AABBs\n        index = leaf.parent;\n        while (index !== null) {\n            index = this.Balance(index);\n            child1 = index.child1;\n            child2 = index.child2;\n            /// b2Assert(child1 !== null);\n            /// b2Assert(child2 !== null);\n            index.height = 1 + b2Math_1.b2Max(child1.height, child2.height);\n            index.aabb.Combine2(child1.aabb, child2.aabb);\n            index = index.parent;\n        }\n        // this.Validate();\n    };\n    b2DynamicTree.prototype.RemoveLeaf = function (leaf) {\n        if (leaf === this.m_root) {\n            this.m_root = null;\n            return;\n        }\n        var parent = leaf.parent;\n        var grandParent = parent && parent.parent;\n        var sibling;\n        if (parent.child1 === leaf) {\n            sibling = parent.child2;\n        }\n        else {\n            sibling = parent.child1;\n        }\n        if (grandParent) {\n            // Destroy parent and connect sibling to grandParent.\n            if (grandParent.child1 === parent) {\n                grandParent.child1 = sibling;\n            }\n            else {\n                grandParent.child2 = sibling;\n            }\n            sibling.parent = grandParent;\n            this.FreeNode(parent);\n            // Adjust ancestor bounds.\n            var index = grandParent;\n            while (index) {\n                index = this.Balance(index);\n                var child1 = index.child1;\n                var child2 = index.child2;\n                index.aabb.Combine2(child1.aabb, child2.aabb);\n                index.height = 1 + b2Math_1.b2Max(child1.height, child2.height);\n                index = index.parent;\n            }\n        }\n        else {\n            this.m_root = sibling;\n            sibling.parent = null;\n            this.FreeNode(parent);\n        }\n        // this.Validate();\n    };\n    b2DynamicTree.prototype.Balance = function (A) {\n        /// b2Assert(A !== null);\n        if (A.IsLeaf() || A.height < 2) {\n            return A;\n        }\n        var B = verify(A.child1);\n        var C = verify(A.child2);\n        var balance = C.height - B.height;\n        // Rotate C up\n        if (balance > 1) {\n            var F = verify(C.child1);\n            var G = verify(C.child2);\n            // Swap A and C\n            C.child1 = A;\n            C.parent = A.parent;\n            A.parent = C;\n            // A's old parent should point to C\n            if (C.parent !== null) {\n                if (C.parent.child1 === A) {\n                    C.parent.child1 = C;\n                }\n                else {\n                    /// b2Assert(C.parent.child2 === A);\n                    C.parent.child2 = C;\n                }\n            }\n            else {\n                this.m_root = C;\n            }\n            // Rotate\n            if (F.height > G.height) {\n                C.child2 = F;\n                A.child2 = G;\n                G.parent = A;\n                A.aabb.Combine2(B.aabb, G.aabb);\n                C.aabb.Combine2(A.aabb, F.aabb);\n                A.height = 1 + b2Math_1.b2Max(B.height, G.height);\n                C.height = 1 + b2Math_1.b2Max(A.height, F.height);\n            }\n            else {\n                C.child2 = G;\n                A.child2 = F;\n                F.parent = A;\n                A.aabb.Combine2(B.aabb, F.aabb);\n                C.aabb.Combine2(A.aabb, G.aabb);\n                A.height = 1 + b2Math_1.b2Max(B.height, F.height);\n                C.height = 1 + b2Math_1.b2Max(A.height, G.height);\n            }\n            return C;\n        }\n        // Rotate B up\n        if (balance < -1) {\n            var D = verify(B.child1);\n            var E = verify(B.child2);\n            // Swap A and B\n            B.child1 = A;\n            B.parent = A.parent;\n            A.parent = B;\n            // A's old parent should point to B\n            if (B.parent !== null) {\n                if (B.parent.child1 === A) {\n                    B.parent.child1 = B;\n                }\n                else {\n                    /// b2Assert(B.parent.child2 === A);\n                    B.parent.child2 = B;\n                }\n            }\n            else {\n                this.m_root = B;\n            }\n            // Rotate\n            if (D.height > E.height) {\n                B.child2 = D;\n                A.child1 = E;\n                E.parent = A;\n                A.aabb.Combine2(C.aabb, E.aabb);\n                B.aabb.Combine2(A.aabb, D.aabb);\n                A.height = 1 + b2Math_1.b2Max(C.height, E.height);\n                B.height = 1 + b2Math_1.b2Max(A.height, D.height);\n            }\n            else {\n                B.child2 = E;\n                A.child1 = D;\n                D.parent = A;\n                A.aabb.Combine2(C.aabb, D.aabb);\n                B.aabb.Combine2(A.aabb, E.aabb);\n                A.height = 1 + b2Math_1.b2Max(C.height, D.height);\n                B.height = 1 + b2Math_1.b2Max(A.height, E.height);\n            }\n            return B;\n        }\n        return A;\n    };\n    b2DynamicTree.prototype.GetHeight = function () {\n        if (this.m_root === null) {\n            return 0;\n        }\n        return this.m_root.height;\n    };\n    b2DynamicTree.GetAreaNode = function (node) {\n        if (node === null) {\n            return 0;\n        }\n        if (node.IsLeaf()) {\n            return 0;\n        }\n        var area = node.aabb.GetPerimeter();\n        area += b2DynamicTree.GetAreaNode(node.child1);\n        area += b2DynamicTree.GetAreaNode(node.child2);\n        return area;\n    };\n    b2DynamicTree.prototype.GetAreaRatio = function () {\n        if (this.m_root === null) {\n            return 0;\n        }\n        var root = this.m_root;\n        var rootArea = root.aabb.GetPerimeter();\n        var totalArea = b2DynamicTree.GetAreaNode(this.m_root);\n        /*\n        float32 totalArea = 0.0;\n        for (int32 i = 0; i < m_nodeCapacity; ++i) {\n          const b2TreeNode* node = m_nodes + i;\n          if (node.height < 0) {\n            // Free node in pool\n            continue;\n          }\n    \n          totalArea += node.aabb.GetPerimeter();\n        }\n        */\n        return totalArea / rootArea;\n    };\n    b2DynamicTree.prototype.ComputeHeightNode = function (node) {\n        if (node.IsLeaf()) {\n            return 0;\n        }\n        var height1 = this.ComputeHeightNode(node.child1);\n        var height2 = this.ComputeHeightNode(node.child2);\n        return 1 + b2Math_1.b2Max(height1, height2);\n    };\n    b2DynamicTree.prototype.ComputeHeight = function () {\n        var height = this.ComputeHeightNode(this.m_root);\n        return height;\n    };\n    b2DynamicTree.prototype.ValidateStructure = function (index) {\n        if (index === null) {\n            return;\n        }\n        if (index === this.m_root) {\n            /// b2Assert(index.parent === null);\n        }\n        var node = index;\n        var child1 = node.child1;\n        var child2 = node.child2;\n        if (node.IsLeaf()) {\n            /// b2Assert(child1 === null);\n            /// b2Assert(child2 === null);\n            /// b2Assert(node.height === 0);\n            return;\n        }\n        /// b2Assert(child1.parent === index);\n        /// b2Assert(child2.parent === index);\n        this.ValidateStructure(child1);\n        this.ValidateStructure(child2);\n    };\n    b2DynamicTree.prototype.ValidateMetrics = function (index) {\n        if (index === null) {\n            return;\n        }\n        var node = index;\n        var child1 = node.child1;\n        var child2 = node.child2;\n        if (node.IsLeaf()) {\n            /// b2Assert(child1 === null);\n            /// b2Assert(child2 === null);\n            /// b2Assert(node.height === 0);\n            return;\n        }\n        /// const height1: number = child1.height;\n        /// const height2: number = child2.height;\n        /// const height: number = 1 + b2Max(height1, height2);\n        /// b2Assert(node.height === height);\n        var aabb = b2DynamicTree.s_aabb;\n        aabb.Combine2(child1.aabb, child2.aabb);\n        /// b2Assert(aabb.lowerBound === node.aabb.lowerBound);\n        /// b2Assert(aabb.upperBound === node.aabb.upperBound);\n        this.ValidateMetrics(child1);\n        this.ValidateMetrics(child2);\n    };\n    b2DynamicTree.prototype.Validate = function () {\n        this.ValidateStructure(this.m_root);\n        this.ValidateMetrics(this.m_root);\n        // let freeCount: number = 0;\n        var freeIndex = this.m_freeList;\n        while (freeIndex !== null) {\n            freeIndex = freeIndex.parent; // freeIndex = freeIndex.next;\n            // ++freeCount;\n        }\n        /// b2Assert(this.GetHeight() === this.ComputeHeight());\n    };\n    b2DynamicTree.GetMaxBalanceNode = function (node, maxBalance) {\n        if (node === null) {\n            return maxBalance;\n        }\n        if (node.height <= 1) {\n            return maxBalance;\n        }\n        /// b2Assert(!node.IsLeaf());\n        var child1 = node.child1;\n        var child2 = node.child2;\n        var balance = b2Math_1.b2Abs(child2.height - child1.height);\n        return b2Math_1.b2Max(maxBalance, balance);\n    };\n    b2DynamicTree.prototype.GetMaxBalance = function () {\n        var maxBalance = b2DynamicTree.GetMaxBalanceNode(this.m_root, 0);\n        /*\n        int32 maxBalance = 0;\n        for (int32 i = 0; i < m_nodeCapacity; ++i) {\n          const b2TreeNode* node = m_nodes + i;\n          if (node.height <= 1) {\n            continue;\n          }\n    \n          b2Assert(!node.IsLeaf());\n    \n          int32 child1 = node.child1;\n          int32 child2 = node.child2;\n          int32 balance = b2Abs(m_nodes[child2].height - m_nodes[child1].height);\n          maxBalance = b2Max(maxBalance, balance);\n        }\n        */\n        return maxBalance;\n    };\n    b2DynamicTree.prototype.RebuildBottomUp = function () {\n        /*\n        int32* nodes = (int32*)b2Alloc(m_nodeCount * sizeof(int32));\n        int32 count = 0;\n    \n        // Build array of leaves. Free the rest.\n        for (int32 i = 0; i < m_nodeCapacity; ++i) {\n          if (m_nodes[i].height < 0) {\n            // free node in pool\n            continue;\n          }\n    \n          if (m_nodes[i].IsLeaf()) {\n            m_nodes[i].parent = b2_nullNode;\n            nodes[count] = i;\n            ++count;\n          } else {\n            FreeNode(i);\n          }\n        }\n    \n        while (count > 1) {\n          float32 minCost = b2_maxFloat;\n          int32 iMin = -1, jMin = -1;\n          for (int32 i = 0; i < count; ++i) {\n            b2AABB aabbi = m_nodes[nodes[i]].aabb;\n    \n            for (int32 j = i + 1; j < count; ++j) {\n              b2AABB aabbj = m_nodes[nodes[j]].aabb;\n              b2AABB b;\n              b.Combine(aabbi, aabbj);\n              float32 cost = b.GetPerimeter();\n              if (cost < minCost) {\n                iMin = i;\n                jMin = j;\n                minCost = cost;\n              }\n            }\n          }\n    \n          int32 index1 = nodes[iMin];\n          int32 index2 = nodes[jMin];\n          b2TreeNode* child1 = m_nodes + index1;\n          b2TreeNode* child2 = m_nodes + index2;\n    \n          int32 parentIndex = AllocateNode();\n          b2TreeNode* parent = m_nodes + parentIndex;\n          parent.child1 = index1;\n          parent.child2 = index2;\n          parent.height = 1 + b2Max(child1.height, child2.height);\n          parent.aabb.Combine(child1.aabb, child2.aabb);\n          parent.parent = b2_nullNode;\n    \n          child1.parent = parentIndex;\n          child2.parent = parentIndex;\n    \n          nodes[jMin] = nodes[count-1];\n          nodes[iMin] = parentIndex;\n          --count;\n        }\n    \n        m_root = nodes[0];\n        b2Free(nodes);\n        */\n        this.Validate();\n    };\n    b2DynamicTree.ShiftOriginNode = function (node, newOrigin) {\n        if (node === null) {\n            return;\n        }\n        if (node.height <= 1) {\n            return;\n        }\n        /// b2Assert(!node.IsLeaf());\n        var child1 = node.child1;\n        var child2 = node.child2;\n        b2DynamicTree.ShiftOriginNode(child1, newOrigin);\n        b2DynamicTree.ShiftOriginNode(child2, newOrigin);\n        node.aabb.lowerBound.SelfSub(newOrigin);\n        node.aabb.upperBound.SelfSub(newOrigin);\n    };\n    b2DynamicTree.prototype.ShiftOrigin = function (newOrigin) {\n        b2DynamicTree.ShiftOriginNode(this.m_root, newOrigin);\n        /*\n        // Build array of leaves. Free the rest.\n        for (int32 i = 0; i < m_nodeCapacity; ++i) {\n          m_nodes[i].aabb.lowerBound -= newOrigin;\n          m_nodes[i].aabb.upperBound -= newOrigin;\n        }\n        */\n    };\n    b2DynamicTree.s_stack = new b2GrowableStack_1.b2GrowableStack(256);\n    b2DynamicTree.s_r = new b2Math_1.b2Vec2();\n    b2DynamicTree.s_v = new b2Math_1.b2Vec2();\n    b2DynamicTree.s_abs_v = new b2Math_1.b2Vec2();\n    b2DynamicTree.s_segmentAABB = new b2Collision_1.b2AABB();\n    b2DynamicTree.s_subInput = new b2Collision_1.b2RayCastInput();\n    b2DynamicTree.s_combinedAABB = new b2Collision_1.b2AABB();\n    b2DynamicTree.s_aabb = new b2Collision_1.b2AABB();\n    b2DynamicTree.s_node_id = 0;\n    return b2DynamicTree;\n}());\nexports.b2DynamicTree = b2DynamicTree;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2DynamicTree.ts?");

/***/ }),

/***/ "./src/Box2D/Collision/b2TimeOfImpact.ts":
/*!***********************************************!*\
  !*** ./src/Box2D/Collision/b2TimeOfImpact.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Timer_1 = __webpack_require__(/*! ../Common/b2Timer */ \"./src/Box2D/Common/b2Timer.ts\");\nvar b2Distance_1 = __webpack_require__(/*! ./b2Distance */ \"./src/Box2D/Collision/b2Distance.ts\");\nexports.b2_toiTime = 0;\nexports.b2_toiMaxTime = 0;\nexports.b2_toiCalls = 0;\nexports.b2_toiIters = 0;\nexports.b2_toiMaxIters = 0;\nexports.b2_toiRootIters = 0;\nexports.b2_toiMaxRootIters = 0;\nfunction b2_toi_reset() {\n    exports.b2_toiTime = 0;\n    exports.b2_toiMaxTime = 0;\n    exports.b2_toiCalls = 0;\n    exports.b2_toiIters = 0;\n    exports.b2_toiMaxIters = 0;\n    exports.b2_toiRootIters = 0;\n    exports.b2_toiMaxRootIters = 0;\n}\nexports.b2_toi_reset = b2_toi_reset;\nvar b2TimeOfImpact_s_xfA = new b2Math_1.b2Transform();\nvar b2TimeOfImpact_s_xfB = new b2Math_1.b2Transform();\nvar b2TimeOfImpact_s_pointA = new b2Math_1.b2Vec2();\nvar b2TimeOfImpact_s_pointB = new b2Math_1.b2Vec2();\nvar b2TimeOfImpact_s_normal = new b2Math_1.b2Vec2();\nvar b2TimeOfImpact_s_axisA = new b2Math_1.b2Vec2();\nvar b2TimeOfImpact_s_axisB = new b2Math_1.b2Vec2();\n/// Input parameters for b2TimeOfImpact\nvar b2TOIInput = /** @class */ (function () {\n    function b2TOIInput() {\n        this.proxyA = new b2Distance_1.b2DistanceProxy();\n        this.proxyB = new b2Distance_1.b2DistanceProxy();\n        this.sweepA = new b2Math_1.b2Sweep();\n        this.sweepB = new b2Math_1.b2Sweep();\n        this.tMax = 0; // defines sweep interval [0, tMax]\n    }\n    return b2TOIInput;\n}());\nexports.b2TOIInput = b2TOIInput;\nvar b2TOIOutputState;\n(function (b2TOIOutputState) {\n    b2TOIOutputState[b2TOIOutputState[\"e_unknown\"] = 0] = \"e_unknown\";\n    b2TOIOutputState[b2TOIOutputState[\"e_failed\"] = 1] = \"e_failed\";\n    b2TOIOutputState[b2TOIOutputState[\"e_overlapped\"] = 2] = \"e_overlapped\";\n    b2TOIOutputState[b2TOIOutputState[\"e_touching\"] = 3] = \"e_touching\";\n    b2TOIOutputState[b2TOIOutputState[\"e_separated\"] = 4] = \"e_separated\";\n})(b2TOIOutputState = exports.b2TOIOutputState || (exports.b2TOIOutputState = {}));\nvar b2TOIOutput = /** @class */ (function () {\n    function b2TOIOutput() {\n        this.state = b2TOIOutputState.e_unknown;\n        this.t = 0;\n    }\n    return b2TOIOutput;\n}());\nexports.b2TOIOutput = b2TOIOutput;\nvar b2SeparationFunctionType;\n(function (b2SeparationFunctionType) {\n    b2SeparationFunctionType[b2SeparationFunctionType[\"e_unknown\"] = -1] = \"e_unknown\";\n    b2SeparationFunctionType[b2SeparationFunctionType[\"e_points\"] = 0] = \"e_points\";\n    b2SeparationFunctionType[b2SeparationFunctionType[\"e_faceA\"] = 1] = \"e_faceA\";\n    b2SeparationFunctionType[b2SeparationFunctionType[\"e_faceB\"] = 2] = \"e_faceB\";\n})(b2SeparationFunctionType = exports.b2SeparationFunctionType || (exports.b2SeparationFunctionType = {}));\nvar b2SeparationFunction = /** @class */ (function () {\n    function b2SeparationFunction() {\n        this.m_sweepA = new b2Math_1.b2Sweep();\n        this.m_sweepB = new b2Math_1.b2Sweep();\n        this.m_type = b2SeparationFunctionType.e_unknown;\n        this.m_localPoint = new b2Math_1.b2Vec2();\n        this.m_axis = new b2Math_1.b2Vec2();\n    }\n    b2SeparationFunction.prototype.Initialize = function (cache, proxyA, sweepA, proxyB, sweepB, t1) {\n        this.m_proxyA = proxyA;\n        this.m_proxyB = proxyB;\n        var count = cache.count;\n        /// b2Assert(0 < count && count < 3);\n        this.m_sweepA.Copy(sweepA);\n        this.m_sweepB.Copy(sweepB);\n        var xfA = b2TimeOfImpact_s_xfA;\n        var xfB = b2TimeOfImpact_s_xfB;\n        this.m_sweepA.GetTransform(xfA, t1);\n        this.m_sweepB.GetTransform(xfB, t1);\n        if (count === 1) {\n            this.m_type = b2SeparationFunctionType.e_points;\n            var localPointA = this.m_proxyA.GetVertex(cache.indexA[0]);\n            var localPointB = this.m_proxyB.GetVertex(cache.indexB[0]);\n            var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n            var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n            b2Math_1.b2Vec2.SubVV(pointB, pointA, this.m_axis);\n            var s = this.m_axis.Normalize();\n            // #if B2_ENABLE_PARTICLE\n            this.m_localPoint.SetZero();\n            // #endif\n            return s;\n        }\n        else if (cache.indexA[0] === cache.indexA[1]) {\n            // Two points on B and one on A.\n            this.m_type = b2SeparationFunctionType.e_faceB;\n            var localPointB1 = this.m_proxyB.GetVertex(cache.indexB[0]);\n            var localPointB2 = this.m_proxyB.GetVertex(cache.indexB[1]);\n            b2Math_1.b2Vec2.CrossVOne(b2Math_1.b2Vec2.SubVV(localPointB2, localPointB1, b2Math_1.b2Vec2.s_t0), this.m_axis).SelfNormalize();\n            var normal = b2Math_1.b2Rot.MulRV(xfB.q, this.m_axis, b2TimeOfImpact_s_normal);\n            b2Math_1.b2Vec2.MidVV(localPointB1, localPointB2, this.m_localPoint);\n            var pointB = b2Math_1.b2Transform.MulXV(xfB, this.m_localPoint, b2TimeOfImpact_s_pointB);\n            var localPointA = this.m_proxyA.GetVertex(cache.indexA[0]);\n            var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n            var s = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointA, pointB, b2Math_1.b2Vec2.s_t0), normal);\n            if (s < 0) {\n                this.m_axis.SelfNeg();\n                s = -s;\n            }\n            return s;\n        }\n        else {\n            // Two points on A and one or two points on B.\n            this.m_type = b2SeparationFunctionType.e_faceA;\n            var localPointA1 = this.m_proxyA.GetVertex(cache.indexA[0]);\n            var localPointA2 = this.m_proxyA.GetVertex(cache.indexA[1]);\n            b2Math_1.b2Vec2.CrossVOne(b2Math_1.b2Vec2.SubVV(localPointA2, localPointA1, b2Math_1.b2Vec2.s_t0), this.m_axis).SelfNormalize();\n            var normal = b2Math_1.b2Rot.MulRV(xfA.q, this.m_axis, b2TimeOfImpact_s_normal);\n            b2Math_1.b2Vec2.MidVV(localPointA1, localPointA2, this.m_localPoint);\n            var pointA = b2Math_1.b2Transform.MulXV(xfA, this.m_localPoint, b2TimeOfImpact_s_pointA);\n            var localPointB = this.m_proxyB.GetVertex(cache.indexB[0]);\n            var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n            var s = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), normal);\n            if (s < 0) {\n                this.m_axis.SelfNeg();\n                s = -s;\n            }\n            return s;\n        }\n    };\n    b2SeparationFunction.prototype.FindMinSeparation = function (indexA, indexB, t) {\n        var xfA = b2TimeOfImpact_s_xfA;\n        var xfB = b2TimeOfImpact_s_xfB;\n        this.m_sweepA.GetTransform(xfA, t);\n        this.m_sweepB.GetTransform(xfB, t);\n        switch (this.m_type) {\n            case b2SeparationFunctionType.e_points: {\n                var axisA = b2Math_1.b2Rot.MulTRV(xfA.q, this.m_axis, b2TimeOfImpact_s_axisA);\n                var axisB = b2Math_1.b2Rot.MulTRV(xfB.q, b2Math_1.b2Vec2.NegV(this.m_axis, b2Math_1.b2Vec2.s_t0), b2TimeOfImpact_s_axisB);\n                indexA[0] = this.m_proxyA.GetSupport(axisA);\n                indexB[0] = this.m_proxyB.GetSupport(axisB);\n                var localPointA = this.m_proxyA.GetVertex(indexA[0]);\n                var localPointB = this.m_proxyB.GetVertex(indexB[0]);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), this.m_axis);\n                return separation;\n            }\n            case b2SeparationFunctionType.e_faceA: {\n                var normal = b2Math_1.b2Rot.MulRV(xfA.q, this.m_axis, b2TimeOfImpact_s_normal);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, this.m_localPoint, b2TimeOfImpact_s_pointA);\n                var axisB = b2Math_1.b2Rot.MulTRV(xfB.q, b2Math_1.b2Vec2.NegV(normal, b2Math_1.b2Vec2.s_t0), b2TimeOfImpact_s_axisB);\n                indexA[0] = -1;\n                indexB[0] = this.m_proxyB.GetSupport(axisB);\n                var localPointB = this.m_proxyB.GetVertex(indexB[0]);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), normal);\n                return separation;\n            }\n            case b2SeparationFunctionType.e_faceB: {\n                var normal = b2Math_1.b2Rot.MulRV(xfB.q, this.m_axis, b2TimeOfImpact_s_normal);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, this.m_localPoint, b2TimeOfImpact_s_pointB);\n                var axisA = b2Math_1.b2Rot.MulTRV(xfA.q, b2Math_1.b2Vec2.NegV(normal, b2Math_1.b2Vec2.s_t0), b2TimeOfImpact_s_axisA);\n                indexB[0] = -1;\n                indexA[0] = this.m_proxyA.GetSupport(axisA);\n                var localPointA = this.m_proxyA.GetVertex(indexA[0]);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointA, pointB, b2Math_1.b2Vec2.s_t0), normal);\n                return separation;\n            }\n            default:\n                /// b2Assert(false);\n                indexA[0] = -1;\n                indexB[0] = -1;\n                return 0;\n        }\n    };\n    b2SeparationFunction.prototype.Evaluate = function (indexA, indexB, t) {\n        var xfA = b2TimeOfImpact_s_xfA;\n        var xfB = b2TimeOfImpact_s_xfB;\n        this.m_sweepA.GetTransform(xfA, t);\n        this.m_sweepB.GetTransform(xfB, t);\n        switch (this.m_type) {\n            case b2SeparationFunctionType.e_points: {\n                var localPointA = this.m_proxyA.GetVertex(indexA);\n                var localPointB = this.m_proxyB.GetVertex(indexB);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), this.m_axis);\n                return separation;\n            }\n            case b2SeparationFunctionType.e_faceA: {\n                var normal = b2Math_1.b2Rot.MulRV(xfA.q, this.m_axis, b2TimeOfImpact_s_normal);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, this.m_localPoint, b2TimeOfImpact_s_pointA);\n                var localPointB = this.m_proxyB.GetVertex(indexB);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, localPointB, b2TimeOfImpact_s_pointB);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), normal);\n                return separation;\n            }\n            case b2SeparationFunctionType.e_faceB: {\n                var normal = b2Math_1.b2Rot.MulRV(xfB.q, this.m_axis, b2TimeOfImpact_s_normal);\n                var pointB = b2Math_1.b2Transform.MulXV(xfB, this.m_localPoint, b2TimeOfImpact_s_pointB);\n                var localPointA = this.m_proxyA.GetVertex(indexA);\n                var pointA = b2Math_1.b2Transform.MulXV(xfA, localPointA, b2TimeOfImpact_s_pointA);\n                var separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointA, pointB, b2Math_1.b2Vec2.s_t0), normal);\n                return separation;\n            }\n            default:\n                /// b2Assert(false);\n                return 0;\n        }\n    };\n    return b2SeparationFunction;\n}());\nexports.b2SeparationFunction = b2SeparationFunction;\nvar b2TimeOfImpact_s_timer = new b2Timer_1.b2Timer();\nvar b2TimeOfImpact_s_cache = new b2Distance_1.b2SimplexCache();\nvar b2TimeOfImpact_s_distanceInput = new b2Distance_1.b2DistanceInput();\nvar b2TimeOfImpact_s_distanceOutput = new b2Distance_1.b2DistanceOutput();\nvar b2TimeOfImpact_s_fcn = new b2SeparationFunction();\nvar b2TimeOfImpact_s_indexA = [0];\nvar b2TimeOfImpact_s_indexB = [0];\nvar b2TimeOfImpact_s_sweepA = new b2Math_1.b2Sweep();\nvar b2TimeOfImpact_s_sweepB = new b2Math_1.b2Sweep();\nfunction b2TimeOfImpact(output, input) {\n    var timer = b2TimeOfImpact_s_timer.Reset();\n    ++exports.b2_toiCalls;\n    output.state = b2TOIOutputState.e_unknown;\n    output.t = input.tMax;\n    var proxyA = input.proxyA;\n    var proxyB = input.proxyB;\n    var sweepA = b2TimeOfImpact_s_sweepA.Copy(input.sweepA);\n    var sweepB = b2TimeOfImpact_s_sweepB.Copy(input.sweepB);\n    // Large rotations can make the root finder fail, so we normalize the\n    // sweep angles.\n    sweepA.Normalize();\n    sweepB.Normalize();\n    var tMax = input.tMax;\n    var totalRadius = proxyA.m_radius + proxyB.m_radius;\n    var target = b2Math_1.b2Max(b2Settings_1.b2_linearSlop, totalRadius - 3 * b2Settings_1.b2_linearSlop);\n    var tolerance = 0.25 * b2Settings_1.b2_linearSlop;\n    /// b2Assert(target > tolerance);\n    var t1 = 0;\n    var k_maxIterations = 20; // TODO_ERIN b2Settings\n    var iter = 0;\n    // Prepare input for distance query.\n    var cache = b2TimeOfImpact_s_cache;\n    cache.count = 0;\n    var distanceInput = b2TimeOfImpact_s_distanceInput;\n    distanceInput.proxyA = input.proxyA;\n    distanceInput.proxyB = input.proxyB;\n    distanceInput.useRadii = false;\n    // The outer loop progressively attempts to compute new separating axes.\n    // This loop terminates when an axis is repeated (no progress is made).\n    for (;;) {\n        var xfA = b2TimeOfImpact_s_xfA;\n        var xfB = b2TimeOfImpact_s_xfB;\n        sweepA.GetTransform(xfA, t1);\n        sweepB.GetTransform(xfB, t1);\n        // Get the distance between shapes. We can also use the results\n        // to get a separating axis.\n        distanceInput.transformA.Copy(xfA);\n        distanceInput.transformB.Copy(xfB);\n        var distanceOutput = b2TimeOfImpact_s_distanceOutput;\n        b2Distance_1.b2Distance(distanceOutput, cache, distanceInput);\n        // If the shapes are overlapped, we give up on continuous collision.\n        if (distanceOutput.distance <= 0) {\n            // Failure!\n            output.state = b2TOIOutputState.e_overlapped;\n            output.t = 0;\n            break;\n        }\n        if (distanceOutput.distance < target + tolerance) {\n            // Victory!\n            output.state = b2TOIOutputState.e_touching;\n            output.t = t1;\n            break;\n        }\n        // Initialize the separating axis.\n        var fcn = b2TimeOfImpact_s_fcn;\n        fcn.Initialize(cache, proxyA, sweepA, proxyB, sweepB, t1);\n        /*\n        #if 0\n            // Dump the curve seen by the root finder {\n              const int32 N = 100;\n              float32 dx = 1.0f / N;\n              float32 xs[N+1];\n              float32 fs[N+1];\n    \n              float32 x = 0.0f;\n    \n              for (int32 i = 0; i <= N; ++i) {\n                sweepA.GetTransform(&xfA, x);\n                sweepB.GetTransform(&xfB, x);\n                float32 f = fcn.Evaluate(xfA, xfB) - target;\n    \n                printf(\"%g %g\\n\", x, f);\n    \n                xs[i] = x;\n                fs[i] = f;\n    \n                x += dx;\n              }\n            }\n        #endif\n        */\n        // Compute the TOI on the separating axis. We do this by successively\n        // resolving the deepest point. This loop is bounded by the number of vertices.\n        var done = false;\n        var t2 = tMax;\n        var pushBackIter = 0;\n        for (;;) {\n            // Find the deepest point at t2. Store the witness point indices.\n            var indexA = b2TimeOfImpact_s_indexA;\n            var indexB = b2TimeOfImpact_s_indexB;\n            var s2 = fcn.FindMinSeparation(indexA, indexB, t2);\n            // Is the final configuration separated?\n            if (s2 > (target + tolerance)) {\n                // Victory!\n                output.state = b2TOIOutputState.e_separated;\n                output.t = tMax;\n                done = true;\n                break;\n            }\n            // Has the separation reached tolerance?\n            if (s2 > (target - tolerance)) {\n                // Advance the sweeps\n                t1 = t2;\n                break;\n            }\n            // Compute the initial separation of the witness points.\n            var s1 = fcn.Evaluate(indexA[0], indexB[0], t1);\n            // Check for initial overlap. This might happen if the root finder\n            // runs out of iterations.\n            if (s1 < (target - tolerance)) {\n                output.state = b2TOIOutputState.e_failed;\n                output.t = t1;\n                done = true;\n                break;\n            }\n            // Check for touching\n            if (s1 <= (target + tolerance)) {\n                // Victory! t1 should hold the TOI (could be 0.0).\n                output.state = b2TOIOutputState.e_touching;\n                output.t = t1;\n                done = true;\n                break;\n            }\n            // Compute 1D root of: f(x) - target = 0\n            var rootIterCount = 0;\n            var a1 = t1;\n            var a2 = t2;\n            for (;;) {\n                // Use a mix of the secant rule and bisection.\n                var t = 0;\n                if (rootIterCount & 1) {\n                    // Secant rule to improve convergence.\n                    t = a1 + (target - s1) * (a2 - a1) / (s2 - s1);\n                }\n                else {\n                    // Bisection to guarantee progress.\n                    t = 0.5 * (a1 + a2);\n                }\n                ++rootIterCount;\n                ++exports.b2_toiRootIters;\n                var s = fcn.Evaluate(indexA[0], indexB[0], t);\n                if (b2Math_1.b2Abs(s - target) < tolerance) {\n                    // t2 holds a tentative value for t1\n                    t2 = t;\n                    break;\n                }\n                // Ensure we continue to bracket the root.\n                if (s > target) {\n                    a1 = t;\n                    s1 = s;\n                }\n                else {\n                    a2 = t;\n                    s2 = s;\n                }\n                if (rootIterCount === 50) {\n                    break;\n                }\n            }\n            exports.b2_toiMaxRootIters = b2Math_1.b2Max(exports.b2_toiMaxRootIters, rootIterCount);\n            ++pushBackIter;\n            if (pushBackIter === b2Settings_1.b2_maxPolygonVertices) {\n                break;\n            }\n        }\n        ++iter;\n        ++exports.b2_toiIters;\n        if (done) {\n            break;\n        }\n        if (iter === k_maxIterations) {\n            // Root finder got stuck. Semi-victory.\n            output.state = b2TOIOutputState.e_failed;\n            output.t = t1;\n            break;\n        }\n    }\n    exports.b2_toiMaxIters = b2Math_1.b2Max(exports.b2_toiMaxIters, iter);\n    var time = timer.GetMilliseconds();\n    exports.b2_toiMaxTime = b2Math_1.b2Max(exports.b2_toiMaxTime, time);\n    exports.b2_toiTime += time;\n}\nexports.b2TimeOfImpact = b2TimeOfImpact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Collision/b2TimeOfImpact.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2BlockAllocator.ts":
/*!**********************************************!*\
  !*** ./src/Box2D/Common/b2BlockAllocator.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2BlockAllocator = /** @class */ (function () {\n    function b2BlockAllocator() {\n    }\n    return b2BlockAllocator;\n}());\nexports.b2BlockAllocator = b2BlockAllocator;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2BlockAllocator.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2Draw.ts":
/*!************************************!*\
  !*** ./src/Box2D/Common/b2Draw.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2011 Erin Catto http://box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// Color for debug drawing. Each value has the range [0,1].\nvar b2Color = /** @class */ (function () {\n    function b2Color(rr, gg, bb, aa) {\n        if (rr === void 0) { rr = 0.5; }\n        if (gg === void 0) { gg = 0.5; }\n        if (bb === void 0) { bb = 0.5; }\n        if (aa === void 0) { aa = 1.0; }\n        this.r = rr;\n        this.g = gg;\n        this.b = bb;\n        this.a = aa;\n    }\n    b2Color.prototype.Clone = function () {\n        return new b2Color().Copy(this);\n    };\n    b2Color.prototype.Copy = function (other) {\n        this.r = other.r;\n        this.g = other.g;\n        this.b = other.b;\n        this.a = other.a;\n        return this;\n    };\n    b2Color.prototype.IsEqual = function (color) {\n        return (this.r === color.r) && (this.g === color.g) && (this.b === color.b) && (this.a === color.a);\n    };\n    b2Color.prototype.IsZero = function () {\n        return (this.r === 0) && (this.g === 0) && (this.b === 0) && (this.a === 0);\n    };\n    b2Color.prototype.GetColor = function (out) {\n        out.Copy(this);\n        return out;\n    };\n    b2Color.prototype.SetColor = function (color) {\n        this.Copy(color);\n    };\n    b2Color.prototype.Set = function (a0, a1, a2, a3) {\n        if (a3 === void 0) { a3 = 1.0; }\n        if (a0 instanceof b2Color) {\n            this.Copy(a0);\n        }\n        else {\n            this.SetRGBA(a0, a1, a2, a3);\n        }\n    };\n    b2Color.prototype.SetByteRGB = function (r, g, b) {\n        this.r = r / 0xff;\n        this.g = g / 0xff;\n        this.b = b / 0xff;\n        return this;\n    };\n    b2Color.prototype.SetByteRGBA = function (r, g, b, a) {\n        this.r = r / 0xff;\n        this.g = g / 0xff;\n        this.b = b / 0xff;\n        this.a = a / 0xff;\n        return this;\n    };\n    b2Color.prototype.SetRGB = function (rr, gg, bb) {\n        this.r = rr;\n        this.g = gg;\n        this.b = bb;\n        return this;\n    };\n    b2Color.prototype.SetRGBA = function (rr, gg, bb, aa) {\n        this.r = rr;\n        this.g = gg;\n        this.b = bb;\n        this.a = aa;\n        return this;\n    };\n    b2Color.prototype.SelfAdd = function (color) {\n        this.r += color.r;\n        this.g += color.g;\n        this.b += color.b;\n        this.a += color.a;\n        return this;\n    };\n    b2Color.prototype.Add = function (color, out) {\n        out.r = this.r + color.r;\n        out.g = this.g + color.g;\n        out.b = this.b + color.b;\n        out.a = this.a + color.a;\n        return out;\n    };\n    b2Color.prototype.SelfSub = function (color) {\n        this.r -= color.r;\n        this.g -= color.g;\n        this.b -= color.b;\n        this.a -= color.a;\n        return this;\n    };\n    b2Color.prototype.Sub = function (color, out) {\n        out.r = this.r - color.r;\n        out.g = this.g - color.g;\n        out.b = this.b - color.b;\n        out.a = this.a - color.a;\n        return out;\n    };\n    b2Color.prototype.SelfMul_0_1 = function (s) {\n        this.r *= s;\n        this.g *= s;\n        this.b *= s;\n        this.a *= s;\n        return this;\n    };\n    b2Color.prototype.Mul_0_1 = function (s, out) {\n        out.r = this.r * s;\n        out.g = this.g * s;\n        out.b = this.b * s;\n        out.a = this.a * s;\n        return this;\n    };\n    b2Color.prototype.Mix = function (mixColor, strength) {\n        b2Color.MixColors(this, mixColor, strength);\n    };\n    b2Color.MixColors = function (colorA, colorB, strength) {\n        var dr = (strength * (colorB.r - colorA.r));\n        var dg = (strength * (colorB.g - colorA.g));\n        var db = (strength * (colorB.b - colorA.b));\n        var da = (strength * (colorB.a - colorA.a));\n        colorA.r += dr;\n        colorA.g += dg;\n        colorA.b += db;\n        colorA.a += da;\n        colorB.r -= dr;\n        colorB.g -= dg;\n        colorB.b -= db;\n        colorB.a -= da;\n    };\n    b2Color.prototype.MakeStyleString = function (alpha) {\n        if (alpha === void 0) { alpha = this.a; }\n        return b2Color.MakeStyleString(this.r, this.g, this.b, alpha);\n    };\n    b2Color.MakeStyleString = function (r, g, b, a) {\n        if (a === void 0) { a = 1.0; }\n        // function clamp(x: number, lo: number, hi: number) { return x < lo ? lo : hi < x ? hi : x; }\n        r *= 255; // r = clamp(r, 0, 255);\n        g *= 255; // g = clamp(g, 0, 255);\n        b *= 255; // b = clamp(b, 0, 255);\n        // a = clamp(a, 0, 1);\n        if (a < 1) {\n            return \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + a + \")\";\n        }\n        else {\n            return \"rgb(\" + r + \",\" + g + \",\" + b + \")\";\n        }\n    };\n    b2Color.RED = new b2Color(1, 0, 0);\n    b2Color.GREEN = new b2Color(0, 1, 0);\n    b2Color.BLUE = new b2Color(0, 0, 1);\n    return b2Color;\n}());\nexports.b2Color = b2Color;\nvar b2DrawFlags;\n(function (b2DrawFlags) {\n    b2DrawFlags[b2DrawFlags[\"e_none\"] = 0] = \"e_none\";\n    b2DrawFlags[b2DrawFlags[\"e_shapeBit\"] = 1] = \"e_shapeBit\";\n    b2DrawFlags[b2DrawFlags[\"e_jointBit\"] = 2] = \"e_jointBit\";\n    b2DrawFlags[b2DrawFlags[\"e_aabbBit\"] = 4] = \"e_aabbBit\";\n    b2DrawFlags[b2DrawFlags[\"e_pairBit\"] = 8] = \"e_pairBit\";\n    b2DrawFlags[b2DrawFlags[\"e_centerOfMassBit\"] = 16] = \"e_centerOfMassBit\";\n    // #if B2_ENABLE_PARTICLE\n    b2DrawFlags[b2DrawFlags[\"e_particleBit\"] = 32] = \"e_particleBit\";\n    // #endif\n    b2DrawFlags[b2DrawFlags[\"e_controllerBit\"] = 64] = \"e_controllerBit\";\n    b2DrawFlags[b2DrawFlags[\"e_all\"] = 63] = \"e_all\";\n})(b2DrawFlags = exports.b2DrawFlags || (exports.b2DrawFlags = {}));\n/// Implement and register this class with a b2World to provide debug drawing of physics\n/// entities in your game.\nvar b2Draw = /** @class */ (function () {\n    function b2Draw() {\n        this.m_drawFlags = 0;\n    }\n    b2Draw.prototype.SetFlags = function (flags) {\n        this.m_drawFlags = flags;\n    };\n    b2Draw.prototype.GetFlags = function () {\n        return this.m_drawFlags;\n    };\n    b2Draw.prototype.AppendFlags = function (flags) {\n        this.m_drawFlags |= flags;\n    };\n    b2Draw.prototype.ClearFlags = function (flags) {\n        this.m_drawFlags &= ~flags;\n    };\n    b2Draw.prototype.PushTransform = function (xf) { };\n    b2Draw.prototype.PopTransform = function (xf) { };\n    b2Draw.prototype.DrawPolygon = function (vertices, vertexCount, color) { };\n    b2Draw.prototype.DrawSolidPolygon = function (vertices, vertexCount, color) { };\n    b2Draw.prototype.DrawCircle = function (center, radius, color) { };\n    b2Draw.prototype.DrawSolidCircle = function (center, radius, axis, color) { };\n    // #if B2_ENABLE_PARTICLE\n    b2Draw.prototype.DrawParticles = function (centers, radius, colors, count) { };\n    // #endif\n    b2Draw.prototype.DrawSegment = function (p1, p2, color) { };\n    b2Draw.prototype.DrawTransform = function (xf) { };\n    return b2Draw;\n}());\nexports.b2Draw = b2Draw;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2Draw.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2GrowableStack.ts":
/*!*********************************************!*\
  !*** ./src/Box2D/Common/b2GrowableStack.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2010 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// This is a growable LIFO stack with an initial capacity of N.\n/// If the stack size exceeds the initial capacity, the heap is used\n/// to increase the size of the stack.\nvar b2GrowableStack = /** @class */ (function () {\n    function b2GrowableStack(N) {\n        this.m_stack = [];\n        this.m_count = 0;\n        this.m_stack = [ /*N*/];\n        this.m_count = 0;\n    }\n    b2GrowableStack.prototype.Reset = function () {\n        this.m_count = 0;\n        return this;\n    };\n    b2GrowableStack.prototype.Push = function (element) {\n        this.m_stack[this.m_count] = element;\n        this.m_count++;\n    };\n    b2GrowableStack.prototype.Pop = function () {\n        /// b2Assert(this.m_count > 0);\n        this.m_count--;\n        var element = this.m_stack[this.m_count];\n        this.m_stack[this.m_count] = null;\n        return element;\n    };\n    b2GrowableStack.prototype.GetCount = function () {\n        return this.m_count;\n    };\n    return b2GrowableStack;\n}());\nexports.b2GrowableStack = b2GrowableStack;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2GrowableStack.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2Math.ts":
/*!************************************!*\
  !*** ./src/Box2D/Common/b2Math.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Settings_1 = __webpack_require__(/*! ./b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nexports.b2_pi_over_180 = b2Settings_1.b2_pi / 180;\nexports.b2_180_over_pi = 180 / b2Settings_1.b2_pi;\nexports.b2_two_pi = 2 * b2Settings_1.b2_pi;\nexports.b2Abs = Math.abs;\n// export function b2Abs(n: number): number {\n//   return (n < 0) ? (-n) : (n);\n// }\nexports.b2Min = Math.min;\n// export function b2Min(a: number, b: number): number {\n//   return (a < b) ? (a) : (b);\n// }\nexports.b2Max = Math.max;\n// export function b2Max(a: number, b: number): number {\n//   return (a > b) ? (a) : (b);\n// }\nfunction b2Clamp(a, lo, hi) {\n    return (a < lo) ? (lo) : ((a > hi) ? (hi) : (a));\n}\nexports.b2Clamp = b2Clamp;\nfunction b2Swap(a, b) {\n    /// b2Assert(false);\n    var tmp = a[0];\n    a[0] = b[0];\n    b[0] = tmp;\n}\nexports.b2Swap = b2Swap;\n/// This function is used to ensure that a floating point number is\n/// not a NaN or infinity.\nfunction b2IsValid(n) {\n    return isFinite(n);\n}\nexports.b2IsValid = b2IsValid;\nfunction b2Sq(n) {\n    return n * n;\n}\nexports.b2Sq = b2Sq;\n/// This is a approximate yet fast inverse square-root.\nfunction b2InvSqrt(n) {\n    return 1 / Math.sqrt(n);\n}\nexports.b2InvSqrt = b2InvSqrt;\nexports.b2Sqrt = Math.sqrt;\n// export function b2Sqrt(n: number): number {\n//   return Math.sqrt(n);\n// }\nexports.b2Pow = Math.pow;\n// export function b2Pow(x: number, y: number): number {\n//   return Math.pow(x, y);\n// }\nfunction b2DegToRad(degrees) {\n    return degrees * exports.b2_pi_over_180;\n}\nexports.b2DegToRad = b2DegToRad;\nfunction b2RadToDeg(radians) {\n    return radians * exports.b2_180_over_pi;\n}\nexports.b2RadToDeg = b2RadToDeg;\nexports.b2Cos = Math.cos;\n// export function b2Cos(radians: number): number {\n//   return Math.cos(radians);\n// }\nexports.b2Sin = Math.sin;\n// export function b2Sin(radians: number): number {\n//   return Math.sin(radians);\n// }\nexports.b2Acos = Math.acos;\n// export function b2Acos(n: number): number {\n//   return Math.acos(n);\n// }\nexports.b2Asin = Math.asin;\n// export function b2Asin(n: number): number {\n//   return Math.asin(n);\n// }\nexports.b2Atan2 = Math.atan2;\n// export function b2Atan2(y: number, x: number): number {\n//   return Math.atan2(y, x);\n// }\nfunction b2NextPowerOfTwo(x) {\n    x |= (x >> 1) & 0x7FFFFFFF;\n    x |= (x >> 2) & 0x3FFFFFFF;\n    x |= (x >> 4) & 0x0FFFFFFF;\n    x |= (x >> 8) & 0x00FFFFFF;\n    x |= (x >> 16) & 0x0000FFFF;\n    return x + 1;\n}\nexports.b2NextPowerOfTwo = b2NextPowerOfTwo;\nfunction b2IsPowerOfTwo(x) {\n    return x > 0 && (x & (x - 1)) === 0;\n}\nexports.b2IsPowerOfTwo = b2IsPowerOfTwo;\nfunction b2Random() {\n    return Math.random() * 2 - 1;\n}\nexports.b2Random = b2Random;\nfunction b2RandomRange(lo, hi) {\n    return (hi - lo) * Math.random() + lo;\n}\nexports.b2RandomRange = b2RandomRange;\n/// A 2D column vector.\nvar b2Vec2 = /** @class */ (function () {\n    function b2Vec2(x, y) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        this.x = x;\n        this.y = y;\n    }\n    b2Vec2.prototype.Clone = function () {\n        return new b2Vec2(this.x, this.y);\n    };\n    b2Vec2.prototype.SetZero = function () {\n        this.x = 0;\n        this.y = 0;\n        return this;\n    };\n    b2Vec2.prototype.Set = function (x, y) {\n        this.x = x;\n        this.y = y;\n        return this;\n    };\n    b2Vec2.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.x = other.x;\n        this.y = other.y;\n        return this;\n    };\n    b2Vec2.prototype.SelfAdd = function (v) {\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    };\n    b2Vec2.prototype.SelfAddXY = function (x, y) {\n        this.x += x;\n        this.y += y;\n        return this;\n    };\n    b2Vec2.prototype.SelfSub = function (v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    };\n    b2Vec2.prototype.SelfSubXY = function (x, y) {\n        this.x -= x;\n        this.y -= y;\n        return this;\n    };\n    b2Vec2.prototype.SelfMul = function (s) {\n        this.x *= s;\n        this.y *= s;\n        return this;\n    };\n    b2Vec2.prototype.SelfMulAdd = function (s, v) {\n        this.x += s * v.x;\n        this.y += s * v.y;\n        return this;\n    };\n    b2Vec2.prototype.SelfMulSub = function (s, v) {\n        this.x -= s * v.x;\n        this.y -= s * v.y;\n        return this;\n    };\n    b2Vec2.prototype.Dot = function (v) {\n        return this.x * v.x + this.y * v.y;\n    };\n    b2Vec2.prototype.Cross = function (v) {\n        return this.x * v.y - this.y * v.x;\n    };\n    b2Vec2.prototype.Length = function () {\n        var x = this.x, y = this.y;\n        return Math.sqrt(x * x + y * y);\n    };\n    b2Vec2.prototype.LengthSquared = function () {\n        var x = this.x, y = this.y;\n        return (x * x + y * y);\n    };\n    b2Vec2.prototype.Normalize = function () {\n        var length = this.Length();\n        if (length >= b2Settings_1.b2_epsilon) {\n            var inv_length = 1 / length;\n            this.x *= inv_length;\n            this.y *= inv_length;\n        }\n        return length;\n    };\n    b2Vec2.prototype.SelfNormalize = function () {\n        var length = this.Length();\n        if (length >= b2Settings_1.b2_epsilon) {\n            var inv_length = 1 / length;\n            this.x *= inv_length;\n            this.y *= inv_length;\n        }\n        return this;\n    };\n    b2Vec2.prototype.SelfRotate = function (radians) {\n        var c = Math.cos(radians);\n        var s = Math.sin(radians);\n        var x = this.x;\n        this.x = c * x - s * this.y;\n        this.y = s * x + c * this.y;\n        return this;\n    };\n    b2Vec2.prototype.IsValid = function () {\n        return isFinite(this.x) && isFinite(this.y);\n    };\n    b2Vec2.prototype.SelfCrossVS = function (s) {\n        var x = this.x;\n        this.x = s * this.y;\n        this.y = -s * x;\n        return this;\n    };\n    b2Vec2.prototype.SelfCrossSV = function (s) {\n        var x = this.x;\n        this.x = -s * this.y;\n        this.y = s * x;\n        return this;\n    };\n    b2Vec2.prototype.SelfMinV = function (v) {\n        this.x = exports.b2Min(this.x, v.x);\n        this.y = exports.b2Min(this.y, v.y);\n        return this;\n    };\n    b2Vec2.prototype.SelfMaxV = function (v) {\n        this.x = exports.b2Max(this.x, v.x);\n        this.y = exports.b2Max(this.y, v.y);\n        return this;\n    };\n    b2Vec2.prototype.SelfAbs = function () {\n        this.x = exports.b2Abs(this.x);\n        this.y = exports.b2Abs(this.y);\n        return this;\n    };\n    b2Vec2.prototype.SelfNeg = function () {\n        this.x = (-this.x);\n        this.y = (-this.y);\n        return this;\n    };\n    b2Vec2.prototype.SelfSkew = function () {\n        var x = this.x;\n        this.x = -this.y;\n        this.y = x;\n        return this;\n    };\n    b2Vec2.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2Vec2(); });\n    };\n    b2Vec2.AbsV = function (v, out) { return b2AbsV(v, out); };\n    b2Vec2.MinV = function (a, b, out) { return b2MinV(a, b, out); };\n    b2Vec2.MaxV = function (a, b, out) { return b2MaxV(a, b, out); };\n    b2Vec2.ClampV = function (v, lo, hi, out) { return b2ClampV(v, lo, hi, out); };\n    b2Vec2.RotateV = function (v, radians, out) { return b2RotateV(v, radians, out); };\n    b2Vec2.DotVV = function (a, b) { return b2DotVV(a, b); };\n    b2Vec2.CrossVV = function (a, b) { return b2CrossVV(a, b); };\n    b2Vec2.CrossVS = function (v, s, out) { return b2CrossVS(v, s, out); };\n    b2Vec2.CrossVOne = function (v, out) { return b2CrossVOne(v, out); };\n    b2Vec2.CrossSV = function (s, v, out) { return b2CrossSV(s, v, out); };\n    b2Vec2.CrossOneV = function (v, out) { return b2CrossOneV(v, out); };\n    b2Vec2.AddVV = function (a, b, out) { return b2AddVV(a, b, out); };\n    b2Vec2.SubVV = function (a, b, out) { return b2SubVV(a, b, out); };\n    b2Vec2.MulSV = function (s, v, out) { return b2MulSV(s, v, out); };\n    b2Vec2.MulVS = function (v, s, out) { return b2MulVS(v, s, out); };\n    b2Vec2.AddVMulSV = function (a, s, b, out) { return b2AddVMulSV(a, s, b, out); };\n    b2Vec2.SubVMulSV = function (a, s, b, out) { return b2SubVMulSV(a, s, b, out); };\n    b2Vec2.AddVCrossSV = function (a, s, v, out) { return b2AddVCrossSV(a, s, v, out); };\n    b2Vec2.MidVV = function (a, b, out) { return b2MidVV(a, b, out); };\n    b2Vec2.ExtVV = function (a, b, out) { return b2ExtVV(a, b, out); };\n    b2Vec2.IsEqualToV = function (a, b) { return b2IsEqualToV(a, b); };\n    b2Vec2.DistanceVV = function (a, b) { return b2DistanceVV(a, b); };\n    b2Vec2.DistanceSquaredVV = function (a, b) { return b2DistanceSquaredVV(a, b); };\n    b2Vec2.NegV = function (v, out) { return b2NegV(v, out); };\n    b2Vec2.ZERO = new b2Vec2(0, 0);\n    b2Vec2.UNITX = new b2Vec2(1, 0);\n    b2Vec2.UNITY = new b2Vec2(0, 1);\n    b2Vec2.s_t0 = new b2Vec2();\n    b2Vec2.s_t1 = new b2Vec2();\n    b2Vec2.s_t2 = new b2Vec2();\n    b2Vec2.s_t3 = new b2Vec2();\n    return b2Vec2;\n}());\nexports.b2Vec2 = b2Vec2;\nexports.b2Vec2_zero = new b2Vec2(0, 0);\nfunction b2AbsV(v, out) {\n    out.x = exports.b2Abs(v.x);\n    out.y = exports.b2Abs(v.y);\n    return out;\n}\nfunction b2MinV(a, b, out) {\n    out.x = exports.b2Min(a.x, b.x);\n    out.y = exports.b2Min(a.y, b.y);\n    return out;\n}\nfunction b2MaxV(a, b, out) {\n    out.x = exports.b2Max(a.x, b.x);\n    out.y = exports.b2Max(a.y, b.y);\n    return out;\n}\nfunction b2ClampV(v, lo, hi, out) {\n    out.x = b2Clamp(v.x, lo.x, hi.x);\n    out.y = b2Clamp(v.y, lo.y, hi.y);\n    return out;\n}\nfunction b2RotateV(v, radians, out) {\n    var v_x = v.x, v_y = v.y;\n    var c = Math.cos(radians);\n    var s = Math.sin(radians);\n    out.x = c * v_x - s * v_y;\n    out.y = s * v_x + c * v_y;\n    return out;\n}\nfunction b2DotVV(a, b) {\n    return a.x * b.x + a.y * b.y;\n}\nfunction b2CrossVV(a, b) {\n    return a.x * b.y - a.y * b.x;\n}\nfunction b2CrossVS(v, s, out) {\n    var v_x = v.x;\n    out.x = s * v.y;\n    out.y = -s * v_x;\n    return out;\n}\nfunction b2CrossVOne(v, out) {\n    var v_x = v.x;\n    out.x = v.y;\n    out.y = -v_x;\n    return out;\n}\nfunction b2CrossSV(s, v, out) {\n    var v_x = v.x;\n    out.x = -s * v.y;\n    out.y = s * v_x;\n    return out;\n}\nfunction b2CrossOneV(v, out) {\n    var v_x = v.x;\n    out.x = -v.y;\n    out.y = v_x;\n    return out;\n}\nfunction b2AddVV(a, b, out) { out.x = a.x + b.x; out.y = a.y + b.y; return out; }\nfunction b2SubVV(a, b, out) { out.x = a.x - b.x; out.y = a.y - b.y; return out; }\nfunction b2MulSV(s, v, out) { out.x = v.x * s; out.y = v.y * s; return out; }\nfunction b2MulVS(v, s, out) { out.x = v.x * s; out.y = v.y * s; return out; }\nfunction b2AddVMulSV(a, s, b, out) { out.x = a.x + (s * b.x); out.y = a.y + (s * b.y); return out; }\nfunction b2SubVMulSV(a, s, b, out) { out.x = a.x - (s * b.x); out.y = a.y - (s * b.y); return out; }\nfunction b2AddVCrossSV(a, s, v, out) {\n    var v_x = v.x;\n    out.x = a.x - (s * v.y);\n    out.y = a.y + (s * v_x);\n    return out;\n}\nfunction b2MidVV(a, b, out) { out.x = (a.x + b.x) * 0.5; out.y = (a.y + b.y) * 0.5; return out; }\nfunction b2ExtVV(a, b, out) { out.x = (b.x - a.x) * 0.5; out.y = (b.y - a.y) * 0.5; return out; }\nfunction b2IsEqualToV(a, b) {\n    return a.x === b.x && a.y === b.y;\n}\nfunction b2DistanceVV(a, b) {\n    var c_x = a.x - b.x;\n    var c_y = a.y - b.y;\n    return Math.sqrt(c_x * c_x + c_y * c_y);\n}\nfunction b2DistanceSquaredVV(a, b) {\n    var c_x = a.x - b.x;\n    var c_y = a.y - b.y;\n    return (c_x * c_x + c_y * c_y);\n}\nfunction b2NegV(v, out) { out.x = -v.x; out.y = -v.y; return out; }\n/// A 2D column vector with 3 elements.\nvar b2Vec3 = /** @class */ (function () {\n    function b2Vec3(x, y, z) {\n        if (x === void 0) { x = 0; }\n        if (y === void 0) { y = 0; }\n        if (z === void 0) { z = 0; }\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n    b2Vec3.prototype.Clone = function () {\n        return new b2Vec3(this.x, this.y, this.z);\n    };\n    b2Vec3.prototype.SetZero = function () {\n        this.x = 0;\n        this.y = 0;\n        this.z = 0;\n        return this;\n    };\n    b2Vec3.prototype.SetXYZ = function (x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        return this;\n    };\n    b2Vec3.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.x = other.x;\n        this.y = other.y;\n        this.z = other.z;\n        return this;\n    };\n    b2Vec3.prototype.SelfNeg = function () {\n        this.x = (-this.x);\n        this.y = (-this.y);\n        this.z = (-this.z);\n        return this;\n    };\n    b2Vec3.prototype.SelfAdd = function (v) {\n        this.x += v.x;\n        this.y += v.y;\n        this.z += v.z;\n        return this;\n    };\n    b2Vec3.prototype.SelfAddXYZ = function (x, y, z) {\n        this.x += x;\n        this.y += y;\n        this.z += z;\n        return this;\n    };\n    b2Vec3.prototype.SelfSub = function (v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        this.z -= v.z;\n        return this;\n    };\n    b2Vec3.prototype.SelfSubXYZ = function (x, y, z) {\n        this.x -= x;\n        this.y -= y;\n        this.z -= z;\n        return this;\n    };\n    b2Vec3.prototype.SelfMul = function (s) {\n        this.x *= s;\n        this.y *= s;\n        this.z *= s;\n        return this;\n    };\n    b2Vec3.DotV3V3 = function (a, b) { return b2DotV3V3(a, b); };\n    b2Vec3.CrossV3V3 = function (a, b, out) { return b2CrossV3V3(a, b, out); };\n    b2Vec3.ZERO = new b2Vec3(0, 0, 0);\n    b2Vec3.s_t0 = new b2Vec3();\n    return b2Vec3;\n}());\nexports.b2Vec3 = b2Vec3;\nfunction b2DotV3V3(a, b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z;\n}\nfunction b2CrossV3V3(a, b, out) {\n    var a_x = a.x, a_y = a.y, a_z = a.z;\n    var b_x = b.x, b_y = b.y, b_z = b.z;\n    out.x = a_y * b_z - a_z * b_y;\n    out.y = a_z * b_x - a_x * b_z;\n    out.z = a_x * b_y - a_y * b_x;\n    return out;\n}\n/// A 2-by-2 matrix. Stored in column-major order.\nvar b2Mat22 = /** @class */ (function () {\n    function b2Mat22() {\n        this.ex = new b2Vec2(1, 0);\n        this.ey = new b2Vec2(0, 1);\n    }\n    b2Mat22.prototype.Clone = function () {\n        return new b2Mat22().Copy(this);\n    };\n    b2Mat22.FromVV = function (c1, c2) {\n        return new b2Mat22().SetVV(c1, c2);\n    };\n    b2Mat22.FromSSSS = function (r1c1, r1c2, r2c1, r2c2) {\n        return new b2Mat22().SetSSSS(r1c1, r1c2, r2c1, r2c2);\n    };\n    b2Mat22.FromAngle = function (radians) {\n        return new b2Mat22().SetAngle(radians);\n    };\n    b2Mat22.prototype.SetSSSS = function (r1c1, r1c2, r2c1, r2c2) {\n        this.ex.Set(r1c1, r2c1);\n        this.ey.Set(r1c2, r2c2);\n        return this;\n    };\n    b2Mat22.prototype.SetVV = function (c1, c2) {\n        this.ex.Copy(c1);\n        this.ey.Copy(c2);\n        return this;\n    };\n    b2Mat22.prototype.SetAngle = function (radians) {\n        var c = Math.cos(radians);\n        var s = Math.sin(radians);\n        this.ex.Set(c, s);\n        this.ey.Set(-s, c);\n        return this;\n    };\n    b2Mat22.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.ex.Copy(other.ex);\n        this.ey.Copy(other.ey);\n        return this;\n    };\n    b2Mat22.prototype.SetIdentity = function () {\n        this.ex.Set(1, 0);\n        this.ey.Set(0, 1);\n        return this;\n    };\n    b2Mat22.prototype.SetZero = function () {\n        this.ex.SetZero();\n        this.ey.SetZero();\n        return this;\n    };\n    b2Mat22.prototype.GetAngle = function () {\n        return Math.atan2(this.ex.y, this.ex.x);\n    };\n    b2Mat22.prototype.GetInverse = function (out) {\n        var a = this.ex.x;\n        var b = this.ey.x;\n        var c = this.ex.y;\n        var d = this.ey.y;\n        var det = a * d - b * c;\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        out.ex.x = det * d;\n        out.ey.x = (-det * b);\n        out.ex.y = (-det * c);\n        out.ey.y = det * a;\n        return out;\n    };\n    b2Mat22.prototype.Solve = function (b_x, b_y, out) {\n        var a11 = this.ex.x, a12 = this.ey.x;\n        var a21 = this.ex.y, a22 = this.ey.y;\n        var det = a11 * a22 - a12 * a21;\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        out.x = det * (a22 * b_x - a12 * b_y);\n        out.y = det * (a11 * b_y - a21 * b_x);\n        return out;\n    };\n    b2Mat22.prototype.SelfAbs = function () {\n        this.ex.SelfAbs();\n        this.ey.SelfAbs();\n        return this;\n    };\n    b2Mat22.prototype.SelfInv = function () {\n        return this.GetInverse(this);\n    };\n    b2Mat22.prototype.SelfAddM = function (M) {\n        this.ex.SelfAdd(M.ex);\n        this.ey.SelfAdd(M.ey);\n        return this;\n    };\n    b2Mat22.prototype.SelfSubM = function (M) {\n        this.ex.SelfSub(M.ex);\n        this.ey.SelfSub(M.ey);\n        return this;\n    };\n    b2Mat22.AbsM = function (M, out) { return b2AbsM(M, out); };\n    b2Mat22.MulMV = function (M, v, out) { return b2MulMV(M, v, out); };\n    b2Mat22.MulTMV = function (M, v, out) { return b2MulTMV(M, v, out); };\n    b2Mat22.AddMM = function (A, B, out) { return b2AddMM(A, B, out); };\n    b2Mat22.MulMM = function (A, B, out) { return b2MulMM(A, B, out); };\n    b2Mat22.MulTMM = function (A, B, out) { return b2MulTMM(A, B, out); };\n    b2Mat22.IDENTITY = new b2Mat22();\n    return b2Mat22;\n}());\nexports.b2Mat22 = b2Mat22;\nfunction b2AbsM(M, out) {\n    var M_ex = M.ex, M_ey = M.ey;\n    out.ex.x = exports.b2Abs(M_ex.x);\n    out.ex.y = exports.b2Abs(M_ex.y);\n    out.ey.x = exports.b2Abs(M_ey.x);\n    out.ey.y = exports.b2Abs(M_ey.y);\n    return out;\n}\nfunction b2MulMV(M, v, out) {\n    var M_ex = M.ex, M_ey = M.ey;\n    var v_x = v.x, v_y = v.y;\n    out.x = M_ex.x * v_x + M_ey.x * v_y;\n    out.y = M_ex.y * v_x + M_ey.y * v_y;\n    return out;\n}\nfunction b2MulTMV(M, v, out) {\n    var M_ex = M.ex, M_ey = M.ey;\n    var v_x = v.x, v_y = v.y;\n    out.x = M_ex.x * v_x + M_ex.y * v_y;\n    out.y = M_ey.x * v_x + M_ey.y * v_y;\n    return out;\n}\nfunction b2AddMM(A, B, out) {\n    var A_ex = A.ex, A_ey = A.ey;\n    var B_ex = B.ex, B_ey = B.ey;\n    out.ex.x = A_ex.x + B_ex.x;\n    out.ex.y = A_ex.y + B_ex.y;\n    out.ey.x = A_ey.x + B_ey.x;\n    out.ey.y = A_ey.y + B_ey.y;\n    return out;\n}\nfunction b2MulMM(A, B, out) {\n    var A_ex_x = A.ex.x, A_ex_y = A.ex.y;\n    var A_ey_x = A.ey.x, A_ey_y = A.ey.y;\n    var B_ex_x = B.ex.x, B_ex_y = B.ex.y;\n    var B_ey_x = B.ey.x, B_ey_y = B.ey.y;\n    out.ex.x = A_ex_x * B_ex_x + A_ey_x * B_ex_y;\n    out.ex.y = A_ex_y * B_ex_x + A_ey_y * B_ex_y;\n    out.ey.x = A_ex_x * B_ey_x + A_ey_x * B_ey_y;\n    out.ey.y = A_ex_y * B_ey_x + A_ey_y * B_ey_y;\n    return out;\n}\nfunction b2MulTMM(A, B, out) {\n    var A_ex_x = A.ex.x, A_ex_y = A.ex.y;\n    var A_ey_x = A.ey.x, A_ey_y = A.ey.y;\n    var B_ex_x = B.ex.x, B_ex_y = B.ex.y;\n    var B_ey_x = B.ey.x, B_ey_y = B.ey.y;\n    out.ex.x = A_ex_x * B_ex_x + A_ex_y * B_ex_y;\n    out.ex.y = A_ey_x * B_ex_x + A_ey_y * B_ex_y;\n    out.ey.x = A_ex_x * B_ey_x + A_ex_y * B_ey_y;\n    out.ey.y = A_ey_x * B_ey_x + A_ey_y * B_ey_y;\n    return out;\n}\n/// A 3-by-3 matrix. Stored in column-major order.\nvar b2Mat33 = /** @class */ (function () {\n    function b2Mat33() {\n        this.ex = new b2Vec3(1, 0, 0);\n        this.ey = new b2Vec3(0, 1, 0);\n        this.ez = new b2Vec3(0, 0, 1);\n    }\n    b2Mat33.prototype.Clone = function () {\n        return new b2Mat33().Copy(this);\n    };\n    b2Mat33.prototype.SetVVV = function (c1, c2, c3) {\n        this.ex.Copy(c1);\n        this.ey.Copy(c2);\n        this.ez.Copy(c3);\n        return this;\n    };\n    b2Mat33.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.ex.Copy(other.ex);\n        this.ey.Copy(other.ey);\n        this.ez.Copy(other.ez);\n        return this;\n    };\n    b2Mat33.prototype.SetIdentity = function () {\n        this.ex.SetXYZ(1, 0, 0);\n        this.ey.SetXYZ(0, 1, 0);\n        this.ez.SetXYZ(0, 0, 1);\n        return this;\n    };\n    b2Mat33.prototype.SetZero = function () {\n        this.ex.SetZero();\n        this.ey.SetZero();\n        this.ez.SetZero();\n        return this;\n    };\n    b2Mat33.prototype.SelfAddM = function (M) {\n        this.ex.SelfAdd(M.ex);\n        this.ey.SelfAdd(M.ey);\n        this.ez.SelfAdd(M.ez);\n        return this;\n    };\n    b2Mat33.prototype.Solve33 = function (b_x, b_y, b_z, out) {\n        var a11 = this.ex.x, a21 = this.ex.y, a31 = this.ex.z;\n        var a12 = this.ey.x, a22 = this.ey.y, a32 = this.ey.z;\n        var a13 = this.ez.x, a23 = this.ez.y, a33 = this.ez.z;\n        var det = a11 * (a22 * a33 - a32 * a23) + a21 * (a32 * a13 - a12 * a33) + a31 * (a12 * a23 - a22 * a13);\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        out.x = det * (b_x * (a22 * a33 - a32 * a23) + b_y * (a32 * a13 - a12 * a33) + b_z * (a12 * a23 - a22 * a13));\n        out.y = det * (a11 * (b_y * a33 - b_z * a23) + a21 * (b_z * a13 - b_x * a33) + a31 * (b_x * a23 - b_y * a13));\n        out.z = det * (a11 * (a22 * b_z - a32 * b_y) + a21 * (a32 * b_x - a12 * b_z) + a31 * (a12 * b_y - a22 * b_x));\n        return out;\n    };\n    b2Mat33.prototype.Solve22 = function (b_x, b_y, out) {\n        var a11 = this.ex.x, a12 = this.ey.x;\n        var a21 = this.ex.y, a22 = this.ey.y;\n        var det = a11 * a22 - a12 * a21;\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        out.x = det * (a22 * b_x - a12 * b_y);\n        out.y = det * (a11 * b_y - a21 * b_x);\n        return out;\n    };\n    b2Mat33.prototype.GetInverse22 = function (M) {\n        var a = this.ex.x, b = this.ey.x, c = this.ex.y, d = this.ey.y;\n        var det = a * d - b * c;\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        M.ex.x = det * d;\n        M.ey.x = -det * b;\n        M.ex.z = 0;\n        M.ex.y = -det * c;\n        M.ey.y = det * a;\n        M.ey.z = 0;\n        M.ez.x = 0;\n        M.ez.y = 0;\n        M.ez.z = 0;\n    };\n    b2Mat33.prototype.GetSymInverse33 = function (M) {\n        var det = b2DotV3V3(this.ex, b2CrossV3V3(this.ey, this.ez, b2Vec3.s_t0));\n        if (det !== 0) {\n            det = 1 / det;\n        }\n        var a11 = this.ex.x, a12 = this.ey.x, a13 = this.ez.x;\n        var a22 = this.ey.y, a23 = this.ez.y;\n        var a33 = this.ez.z;\n        M.ex.x = det * (a22 * a33 - a23 * a23);\n        M.ex.y = det * (a13 * a23 - a12 * a33);\n        M.ex.z = det * (a12 * a23 - a13 * a22);\n        M.ey.x = M.ex.y;\n        M.ey.y = det * (a11 * a33 - a13 * a13);\n        M.ey.z = det * (a13 * a12 - a11 * a23);\n        M.ez.x = M.ex.z;\n        M.ez.y = M.ey.z;\n        M.ez.z = det * (a11 * a22 - a12 * a12);\n    };\n    b2Mat33.MulM33V3 = function (A, v, out) { return b2MulM33V3(A, v, out); };\n    b2Mat33.MulM33XYZ = function (A, x, y, z, out) { return b2MulM33XYZ(A, x, y, z, out); };\n    b2Mat33.MulM33V2 = function (A, v, out) { return b2MulM33V2(A, v, out); };\n    b2Mat33.MulM33XY = function (A, x, y, out) { return b2MulM33XY(A, x, y, out); };\n    b2Mat33.IDENTITY = new b2Mat33();\n    return b2Mat33;\n}());\nexports.b2Mat33 = b2Mat33;\nfunction b2MulM33V3(A, v, out) {\n    var v_x = v.x, v_y = v.y, v_z = v.z;\n    out.x = A.ex.x * v_x + A.ey.x * v_y + A.ez.x * v_z;\n    out.y = A.ex.y * v_x + A.ey.y * v_y + A.ez.y * v_z;\n    out.z = A.ex.z * v_x + A.ey.z * v_y + A.ez.z * v_z;\n    return out;\n}\nfunction b2MulM33XYZ(A, x, y, z, out) {\n    out.x = A.ex.x * x + A.ey.x * y + A.ez.x * z;\n    out.y = A.ex.y * x + A.ey.y * y + A.ez.y * z;\n    out.z = A.ex.z * x + A.ey.z * y + A.ez.z * z;\n    return out;\n}\nfunction b2MulM33V2(A, v, out) {\n    var v_x = v.x, v_y = v.y;\n    out.x = A.ex.x * v_x + A.ey.x * v_y;\n    out.y = A.ex.y * v_x + A.ey.y * v_y;\n    return out;\n}\nfunction b2MulM33XY(A, x, y, out) {\n    out.x = A.ex.x * x + A.ey.x * y;\n    out.y = A.ex.y * x + A.ey.y * y;\n    return out;\n}\n/// Rotation\nvar b2Rot = /** @class */ (function () {\n    function b2Rot(angle) {\n        if (angle === void 0) { angle = 0; }\n        this.s = 0;\n        this.c = 1;\n        if (angle) {\n            this.s = Math.sin(angle);\n            this.c = Math.cos(angle);\n        }\n    }\n    b2Rot.prototype.Clone = function () {\n        return new b2Rot().Copy(this);\n    };\n    b2Rot.prototype.Copy = function (other) {\n        this.s = other.s;\n        this.c = other.c;\n        return this;\n    };\n    b2Rot.prototype.SetAngle = function (angle) {\n        this.s = Math.sin(angle);\n        this.c = Math.cos(angle);\n        return this;\n    };\n    b2Rot.prototype.SetIdentity = function () {\n        this.s = 0;\n        this.c = 1;\n        return this;\n    };\n    b2Rot.prototype.GetAngle = function () {\n        return Math.atan2(this.s, this.c);\n    };\n    b2Rot.prototype.GetXAxis = function (out) {\n        out.x = this.c;\n        out.y = this.s;\n        return out;\n    };\n    b2Rot.prototype.GetYAxis = function (out) {\n        out.x = -this.s;\n        out.y = this.c;\n        return out;\n    };\n    b2Rot.MulRR = function (q, r, out) { return b2MulRR(q, r, out); };\n    b2Rot.MulTRR = function (q, r, out) { return b2MulTRR(q, r, out); };\n    b2Rot.MulRV = function (q, v, out) { return b2MulRV(q, v, out); };\n    b2Rot.MulTRV = function (q, v, out) { return b2MulTRV(q, v, out); };\n    b2Rot.IDENTITY = new b2Rot();\n    return b2Rot;\n}());\nexports.b2Rot = b2Rot;\nfunction b2MulRR(q, r, out) {\n    // [qc -qs] * [rc -rs] = [qc*rc-qs*rs -qc*rs-qs*rc]\n    // [qs  qc]   [rs  rc]   [qs*rc+qc*rs -qs*rs+qc*rc]\n    // s = qs * rc + qc * rs\n    // c = qc * rc - qs * rs\n    var q_c = q.c, q_s = q.s;\n    var r_c = r.c, r_s = r.s;\n    out.s = q_s * r_c + q_c * r_s;\n    out.c = q_c * r_c - q_s * r_s;\n    return out;\n}\nfunction b2MulTRR(q, r, out) {\n    // [ qc qs] * [rc -rs] = [qc*rc+qs*rs -qc*rs+qs*rc]\n    // [-qs qc]   [rs  rc]   [-qs*rc+qc*rs qs*rs+qc*rc]\n    // s = qc * rs - qs * rc\n    // c = qc * rc + qs * rs\n    var q_c = q.c, q_s = q.s;\n    var r_c = r.c, r_s = r.s;\n    out.s = q_c * r_s - q_s * r_c;\n    out.c = q_c * r_c + q_s * r_s;\n    return out;\n}\nfunction b2MulRV(q, v, out) {\n    var q_c = q.c, q_s = q.s;\n    var v_x = v.x, v_y = v.y;\n    out.x = q_c * v_x - q_s * v_y;\n    out.y = q_s * v_x + q_c * v_y;\n    return out;\n}\nfunction b2MulTRV(q, v, out) {\n    var q_c = q.c, q_s = q.s;\n    var v_x = v.x, v_y = v.y;\n    out.x = q_c * v_x + q_s * v_y;\n    out.y = -q_s * v_x + q_c * v_y;\n    return out;\n}\n/// A transform contains translation and rotation. It is used to represent\n/// the position and orientation of rigid frames.\nvar b2Transform = /** @class */ (function () {\n    function b2Transform() {\n        this.p = new b2Vec2();\n        this.q = new b2Rot();\n    }\n    b2Transform.prototype.Clone = function () {\n        return new b2Transform().Copy(this);\n    };\n    b2Transform.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.p.Copy(other.p);\n        this.q.Copy(other.q);\n        return this;\n    };\n    b2Transform.prototype.SetIdentity = function () {\n        this.p.SetZero();\n        this.q.SetIdentity();\n        return this;\n    };\n    b2Transform.prototype.SetPositionRotation = function (position, q) {\n        this.p.Copy(position);\n        this.q.Copy(q);\n        return this;\n    };\n    b2Transform.prototype.SetPositionAngle = function (pos, a) {\n        this.p.Copy(pos);\n        this.q.SetAngle(a);\n        return this;\n    };\n    b2Transform.prototype.SetPosition = function (position) {\n        this.p.Copy(position);\n        return this;\n    };\n    b2Transform.prototype.SetPositionXY = function (x, y) {\n        this.p.Set(x, y);\n        return this;\n    };\n    b2Transform.prototype.SetRotation = function (rotation) {\n        this.q.Copy(rotation);\n        return this;\n    };\n    b2Transform.prototype.SetRotationAngle = function (radians) {\n        this.q.SetAngle(radians);\n        return this;\n    };\n    b2Transform.prototype.GetPosition = function () {\n        return this.p;\n    };\n    b2Transform.prototype.GetRotation = function () {\n        return this.q;\n    };\n    b2Transform.prototype.GetRotationAngle = function () {\n        return this.q.GetAngle();\n    };\n    b2Transform.prototype.GetAngle = function () {\n        return this.q.GetAngle();\n    };\n    b2Transform.MulXV = function (T, v, out) { return b2MulXV(T, v, out); };\n    b2Transform.MulTXV = function (T, v, out) { return b2MulTXV(T, v, out); };\n    b2Transform.MulXX = function (A, B, out) { return b2MulXX(A, B, out); };\n    b2Transform.MulTXX = function (A, B, out) { return b2MulTXX(A, B, out); };\n    b2Transform.IDENTITY = new b2Transform();\n    return b2Transform;\n}());\nexports.b2Transform = b2Transform;\nfunction b2MulXV(T, v, out) {\n    //  float32 x = (T.q.c * v.x - T.q.s * v.y) + T.p.x;\n    //  float32 y = (T.q.s * v.x + T.q.c * v.y) + T.p.y;\n    //\n    //  return b2Vec2(x, y);\n    var T_q_c = T.q.c, T_q_s = T.q.s;\n    var v_x = v.x, v_y = v.y;\n    out.x = (T_q_c * v_x - T_q_s * v_y) + T.p.x;\n    out.y = (T_q_s * v_x + T_q_c * v_y) + T.p.y;\n    return out;\n}\nfunction b2MulTXV(T, v, out) {\n    //  float32 px = v.x - T.p.x;\n    //  float32 py = v.y - T.p.y;\n    //  float32 x = (T.q.c * px + T.q.s * py);\n    //  float32 y = (-T.q.s * px + T.q.c * py);\n    //\n    //  return b2Vec2(x, y);\n    var T_q_c = T.q.c, T_q_s = T.q.s;\n    var p_x = v.x - T.p.x;\n    var p_y = v.y - T.p.y;\n    out.x = (T_q_c * p_x + T_q_s * p_y);\n    out.y = (-T_q_s * p_x + T_q_c * p_y);\n    return out;\n}\nfunction b2MulXX(A, B, out) {\n    b2MulRR(A.q, B.q, out.q);\n    b2AddVV(b2MulRV(A.q, B.p, out.p), A.p, out.p);\n    return out;\n}\nfunction b2MulTXX(A, B, out) {\n    b2MulTRR(A.q, B.q, out.q);\n    b2MulTRV(A.q, b2SubVV(B.p, A.p, out.p), out.p);\n    return out;\n}\n/// This describes the motion of a body/shape for TOI computation.\n/// Shapes are defined with respect to the body origin, which may\n/// no coincide with the center of mass. However, to support dynamics\n/// we must interpolate the center of mass position.\nvar b2Sweep = /** @class */ (function () {\n    function b2Sweep() {\n        this.localCenter = new b2Vec2();\n        this.c0 = new b2Vec2();\n        this.c = new b2Vec2();\n        this.a0 = 0;\n        this.a = 0;\n        this.alpha0 = 0;\n    }\n    b2Sweep.prototype.Clone = function () {\n        return new b2Sweep().Copy(this);\n    };\n    b2Sweep.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.localCenter.Copy(other.localCenter);\n        this.c0.Copy(other.c0);\n        this.c.Copy(other.c);\n        this.a0 = other.a0;\n        this.a = other.a;\n        this.alpha0 = other.alpha0;\n        return this;\n    };\n    b2Sweep.prototype.GetTransform = function (xf, beta) {\n        var one_minus_beta = (1 - beta);\n        xf.p.x = one_minus_beta * this.c0.x + beta * this.c.x;\n        xf.p.y = one_minus_beta * this.c0.y + beta * this.c.y;\n        var angle = one_minus_beta * this.a0 + beta * this.a;\n        xf.q.SetAngle(angle);\n        xf.p.SelfSub(b2MulRV(xf.q, this.localCenter, b2Vec2.s_t0));\n        return xf;\n    };\n    b2Sweep.prototype.Advance = function (alpha) {\n        /// b2Assert(this.alpha0 < 1);\n        var beta = (alpha - this.alpha0) / (1 - this.alpha0);\n        var one_minus_beta = (1 - beta);\n        this.c0.x = one_minus_beta * this.c0.x + beta * this.c.x;\n        this.c0.y = one_minus_beta * this.c0.y + beta * this.c.y;\n        this.a0 = one_minus_beta * this.a0 + beta * this.a;\n        this.alpha0 = alpha;\n    };\n    b2Sweep.prototype.Normalize = function () {\n        var d = exports.b2_two_pi * Math.floor(this.a0 / exports.b2_two_pi);\n        this.a0 -= d;\n        this.a -= d;\n    };\n    return b2Sweep;\n}());\nexports.b2Sweep = b2Sweep;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2Math.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2Settings.ts":
/*!****************************************!*\
  !*** ./src/Box2D/Common/b2Settings.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction b2Assert(condition) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    if (!condition) {\n        // tslint:disable-next-line:no-debugger\n        debugger;\n    }\n}\nexports.b2Assert = b2Assert;\nexports.b2_maxFloat = 1E+37; // FLT_MAX instead of Number.MAX_VALUE;\nexports.b2_epsilon = 1E-5; // FLT_EPSILON instead of Number.MIN_VALUE;\nexports.b2_epsilon_sq = (exports.b2_epsilon * exports.b2_epsilon);\nexports.b2_pi = 3.14159265359; // Math.PI;\n/// @file\n/// Global tuning constants based on meters-kilograms-seconds (MKS) units.\n///\n// Collision\n/// The maximum number of contact points between two convex shapes. Do\n/// not change this value.\nexports.b2_maxManifoldPoints = 2;\n/// The maximum number of vertices on a convex polygon. You cannot increase\n/// this too much because b2BlockAllocator has a maximum object size.\nexports.b2_maxPolygonVertices = 8;\n/// This is used to fatten AABBs in the dynamic tree. This allows proxies\n/// to move by a small amount without triggering a tree adjustment.\n/// This is in meters.\nexports.b2_aabbExtension = 0.1;\n/// This is used to fatten AABBs in the dynamic tree. This is used to predict\n/// the future position based on the current displacement.\n/// This is a dimensionless multiplier.\nexports.b2_aabbMultiplier = 2;\n/// A small length used as a collision and constraint tolerance. Usually it is\n/// chosen to be numerically significant, but visually insignificant.\nexports.b2_linearSlop = 0.008; // 0.005;\n/// A small angle used as a collision and constraint tolerance. Usually it is\n/// chosen to be numerically significant, but visually insignificant.\nexports.b2_angularSlop = 2 / 180 * exports.b2_pi;\n/// The radius of the polygon/edge shape skin. This should not be modified. Making\n/// this smaller means polygons will have an insufficient buffer for continuous collision.\n/// Making it larger may create artifacts for vertex collision.\nexports.b2_polygonRadius = 2 * exports.b2_linearSlop;\n/// Maximum number of sub-steps per contact in continuous physics simulation.\nexports.b2_maxSubSteps = 8;\n// Dynamics\n/// Maximum number of contacts to be handled to solve a TOI impact.\nexports.b2_maxTOIContacts = 32;\n/// A velocity threshold for elastic collisions. Any collision with a relative linear\n/// velocity below this threshold will be treated as inelastic.\nexports.b2_velocityThreshold = 1;\n/// The maximum linear position correction used when solving constraints. This helps to\n/// prevent overshoot.\nexports.b2_maxLinearCorrection = 0.2;\n/// The maximum angular position correction used when solving constraints. This helps to\n/// prevent overshoot.\nexports.b2_maxAngularCorrection = 8 / 180 * exports.b2_pi;\n/// The maximum linear velocity of a body. This limit is very large and is used\n/// to prevent numerical problems. You shouldn't need to adjust this.\nexports.b2_maxTranslation = 2;\nexports.b2_maxTranslationSquared = exports.b2_maxTranslation * exports.b2_maxTranslation;\n/// The maximum angular velocity of a body. This limit is very large and is used\n/// to prevent numerical problems. You shouldn't need to adjust this.\nexports.b2_maxRotation = 0.5 * exports.b2_pi;\nexports.b2_maxRotationSquared = exports.b2_maxRotation * exports.b2_maxRotation;\n/// This scale factor controls how fast overlap is resolved. Ideally this would be 1 so\n/// that overlap is removed in one time step. However using values close to 1 often lead\n/// to overshoot.\nexports.b2_baumgarte = 0.2;\nexports.b2_toiBaumgarte = 0.75;\n// #if B2_ENABLE_PARTICLE\n// Particle\n/// A symbolic constant that stands for particle allocation error.\nexports.b2_invalidParticleIndex = -1;\nexports.b2_maxParticleIndex = 0x7FFFFFFF;\n/// The default distance between particles, multiplied by the particle diameter.\nexports.b2_particleStride = 0.75;\n/// The minimum particle weight that produces pressure.\nexports.b2_minParticleWeight = 1.0;\n/// The upper limit for particle pressure.\nexports.b2_maxParticlePressure = 0.25;\n/// The upper limit for force between particles.\nexports.b2_maxParticleForce = 0.5;\n/// The maximum distance between particles in a triad, multiplied by the particle diameter.\nexports.b2_maxTriadDistance = 2.0;\nexports.b2_maxTriadDistanceSquared = (exports.b2_maxTriadDistance * exports.b2_maxTriadDistance);\n/// The initial size of particle data buffers.\nexports.b2_minParticleSystemBufferCapacity = 256;\n/// The time into the future that collisions against barrier particles will be detected.\nexports.b2_barrierCollisionTime = 2.5;\n// #endif\n// Sleep\n/// The time that a body must be still before it will go to sleep.\nexports.b2_timeToSleep = 0.5;\n/// A body cannot sleep if its linear velocity is above this tolerance.\nexports.b2_linearSleepTolerance = 0.01;\n/// A body cannot sleep if its angular velocity is above this tolerance.\nexports.b2_angularSleepTolerance = 2 / 180 * exports.b2_pi;\n// Memory Allocation\n/// Implement this function to use your own memory allocator.\nfunction b2Alloc(size) {\n    return null;\n}\nexports.b2Alloc = b2Alloc;\n/// If you implement b2Alloc, you should also implement this function.\nfunction b2Free(mem) {\n}\nexports.b2Free = b2Free;\n/// Logging function.\nfunction b2Log(message) {\n    var args = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n    }\n    // console.log(message, ...args);\n}\nexports.b2Log = b2Log;\n/// Version numbering scheme.\n/// See http://en.wikipedia.org/wiki/Software_versioning\nvar b2Version = /** @class */ (function () {\n    function b2Version(major, minor, revision) {\n        if (major === void 0) { major = 0; }\n        if (minor === void 0) { minor = 0; }\n        if (revision === void 0) { revision = 0; }\n        this.major = 0; /// < significant changes\n        this.minor = 0; /// < incremental changes\n        this.revision = 0; /// < bug fixes\n        this.major = major;\n        this.minor = minor;\n        this.revision = revision;\n    }\n    b2Version.prototype.toString = function () {\n        return this.major + \".\" + this.minor + \".\" + this.revision;\n    };\n    return b2Version;\n}());\nexports.b2Version = b2Version;\n/// Current version.\nexports.b2_version = new b2Version(2, 3, 2);\nexports.b2_changelist = 313;\nfunction b2ParseInt(v) {\n    return parseInt(v, 10);\n}\nexports.b2ParseInt = b2ParseInt;\nfunction b2ParseUInt(v) {\n    return Math.abs(parseInt(v, 10));\n}\nexports.b2ParseUInt = b2ParseUInt;\n// tslint:disable-next-line:callable-types\nfunction b2MakeArray(length, init) {\n    var a = [];\n    for (var i = 0; i < length; ++i) {\n        a.push(init(i));\n    }\n    return a;\n}\nexports.b2MakeArray = b2MakeArray;\nfunction b2MakeNullArray(length) {\n    var a = [];\n    for (var i = 0; i < length; ++i) {\n        a.push(null);\n    }\n    return a;\n}\nexports.b2MakeNullArray = b2MakeNullArray;\nfunction b2MakeNumberArray(length, init) {\n    if (init === void 0) { init = 0; }\n    var a = [];\n    for (var i = 0; i < length; ++i) {\n        a.push(init);\n    }\n    return a;\n}\nexports.b2MakeNumberArray = b2MakeNumberArray;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2Settings.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2StackAllocator.ts":
/*!**********************************************!*\
  !*** ./src/Box2D/Common/b2StackAllocator.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2StackAllocator = /** @class */ (function () {\n    function b2StackAllocator() {\n    }\n    return b2StackAllocator;\n}());\nexports.b2StackAllocator = b2StackAllocator;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2StackAllocator.ts?");

/***/ }),

/***/ "./src/Box2D/Common/b2Timer.ts":
/*!*************************************!*\
  !*** ./src/Box2D/Common/b2Timer.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2011 Erin Catto http://box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/// Timer for profiling. This has platform specific code and may\n/// not work on every platform.\nvar b2Timer = /** @class */ (function () {\n    function b2Timer() {\n        this.m_start = Date.now();\n    }\n    /// Reset the timer.\n    b2Timer.prototype.Reset = function () {\n        this.m_start = Date.now();\n        return this;\n    };\n    /// Get the time since construction or the last reset.\n    b2Timer.prototype.GetMilliseconds = function () {\n        return Date.now() - this.m_start;\n    };\n    return b2Timer;\n}());\nexports.b2Timer = b2Timer;\nvar b2Counter = /** @class */ (function () {\n    function b2Counter() {\n        this.m_count = 0;\n        this.m_min_count = 0;\n        this.m_max_count = 0;\n    }\n    b2Counter.prototype.GetCount = function () {\n        return this.m_count;\n    };\n    b2Counter.prototype.GetMinCount = function () {\n        return this.m_min_count;\n    };\n    b2Counter.prototype.GetMaxCount = function () {\n        return this.m_max_count;\n    };\n    b2Counter.prototype.ResetCount = function () {\n        var count = this.m_count;\n        this.m_count = 0;\n        return count;\n    };\n    b2Counter.prototype.ResetMinCount = function () {\n        this.m_min_count = 0;\n    };\n    b2Counter.prototype.ResetMaxCount = function () {\n        this.m_max_count = 0;\n    };\n    b2Counter.prototype.Increment = function () {\n        this.m_count++;\n        if (this.m_max_count < this.m_count) {\n            this.m_max_count = this.m_count;\n        }\n    };\n    b2Counter.prototype.Decrement = function () {\n        this.m_count--;\n        if (this.m_min_count > this.m_count) {\n            this.m_min_count = this.m_count;\n        }\n    };\n    return b2Counter;\n}());\nexports.b2Counter = b2Counter;\n\n\n//# sourceURL=webpack:///./src/Box2D/Common/b2Timer.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2ChainAndCircleContact.ts":
/*!****************************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2ChainAndCircleContact.ts ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideEdge_1 = __webpack_require__(/*! ../../Collision/b2CollideEdge */ \"./src/Box2D/Collision/b2CollideEdge.ts\");\nvar b2EdgeShape_1 = __webpack_require__(/*! ../../Collision/Shapes/b2EdgeShape */ \"./src/Box2D/Collision/Shapes/b2EdgeShape.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2ChainAndCircleContact = /** @class */ (function (_super) {\n    __extends(b2ChainAndCircleContact, _super);\n    function b2ChainAndCircleContact() {\n        return _super.call(this) || this;\n    }\n    b2ChainAndCircleContact.Create = function (allocator) {\n        return new b2ChainAndCircleContact();\n    };\n    b2ChainAndCircleContact.Destroy = function (contact, allocator) {\n    };\n    b2ChainAndCircleContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n        /// b2Assert(fixtureA.GetType() === b2ShapeType.e_chainShape);\n        /// b2Assert(fixtureB.GetType() === b2ShapeType.e_circleShape);\n    };\n    b2ChainAndCircleContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2ChainShape);\n        /// b2Assert(shapeB instanceof b2CircleShape);\n        var chain = shapeA;\n        var edge = b2ChainAndCircleContact.Evaluate_s_edge;\n        chain.GetChildEdge(edge, this.m_indexA);\n        b2CollideEdge_1.b2CollideEdgeAndCircle(manifold, edge, xfA, shapeB, xfB);\n    };\n    b2ChainAndCircleContact.Evaluate_s_edge = new b2EdgeShape_1.b2EdgeShape();\n    return b2ChainAndCircleContact;\n}(b2Contact_1.b2Contact));\nexports.b2ChainAndCircleContact = b2ChainAndCircleContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2ChainAndCircleContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2ChainAndPolygonContact.ts":
/*!*****************************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2ChainAndPolygonContact.ts ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideEdge_1 = __webpack_require__(/*! ../../Collision/b2CollideEdge */ \"./src/Box2D/Collision/b2CollideEdge.ts\");\nvar b2EdgeShape_1 = __webpack_require__(/*! ../../Collision/Shapes/b2EdgeShape */ \"./src/Box2D/Collision/Shapes/b2EdgeShape.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2ChainAndPolygonContact = /** @class */ (function (_super) {\n    __extends(b2ChainAndPolygonContact, _super);\n    function b2ChainAndPolygonContact() {\n        return _super.call(this) || this;\n    }\n    b2ChainAndPolygonContact.Create = function (allocator) {\n        return new b2ChainAndPolygonContact();\n    };\n    b2ChainAndPolygonContact.Destroy = function (contact, allocator) {\n    };\n    b2ChainAndPolygonContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n        /// b2Assert(fixtureA.GetType() === b2ShapeType.e_chainShape);\n        /// b2Assert(fixtureB.GetType() === b2ShapeType.e_polygonShape);\n    };\n    b2ChainAndPolygonContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2ChainShape);\n        /// b2Assert(shapeB instanceof b2PolygonShape);\n        var chain = shapeA;\n        var edge = b2ChainAndPolygonContact.Evaluate_s_edge;\n        chain.GetChildEdge(edge, this.m_indexA);\n        b2CollideEdge_1.b2CollideEdgeAndPolygon(manifold, edge, xfA, shapeB, xfB);\n    };\n    b2ChainAndPolygonContact.Evaluate_s_edge = new b2EdgeShape_1.b2EdgeShape();\n    return b2ChainAndPolygonContact;\n}(b2Contact_1.b2Contact));\nexports.b2ChainAndPolygonContact = b2ChainAndPolygonContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2ChainAndPolygonContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2CircleContact.ts":
/*!********************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2CircleContact.ts ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideCircle_1 = __webpack_require__(/*! ../../Collision/b2CollideCircle */ \"./src/Box2D/Collision/b2CollideCircle.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2CircleContact = /** @class */ (function (_super) {\n    __extends(b2CircleContact, _super);\n    function b2CircleContact() {\n        return _super.call(this) || this;\n    }\n    b2CircleContact.Create = function (allocator) {\n        return new b2CircleContact();\n    };\n    b2CircleContact.Destroy = function (contact, allocator) {\n    };\n    b2CircleContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n    };\n    b2CircleContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2CircleShape);\n        /// b2Assert(shapeB instanceof b2CircleShape);\n        b2CollideCircle_1.b2CollideCircles(manifold, shapeA, xfA, shapeB, xfB);\n    };\n    return b2CircleContact;\n}(b2Contact_1.b2Contact));\nexports.b2CircleContact = b2CircleContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2CircleContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2Contact.ts":
/*!**************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2Contact.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Collision_1 = __webpack_require__(/*! ../../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Collision_2 = __webpack_require__(/*! ../../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2TimeOfImpact_1 = __webpack_require__(/*! ../../Collision/b2TimeOfImpact */ \"./src/Box2D/Collision/b2TimeOfImpact.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n/// Friction mixing law. The idea is to allow either fixture to drive the restitution to zero.\n/// For example, anything slides on ice.\nfunction b2MixFriction(friction1, friction2) {\n    return b2Math_1.b2Sqrt(friction1 * friction2);\n}\nexports.b2MixFriction = b2MixFriction;\n/// Restitution mixing law. The idea is allow for anything to bounce off an inelastic surface.\n/// For example, a superball bounces on anything.\nfunction b2MixRestitution(restitution1, restitution2) {\n    return restitution1 > restitution2 ? restitution1 : restitution2;\n}\nexports.b2MixRestitution = b2MixRestitution;\nvar b2ContactEdge = /** @class */ (function () {\n    function b2ContactEdge() {\n        this.other = null; /// < provides quick access to the other body attached.\n        this.contact = null; /// < the contact\n        this.prev = null; /// < the previous contact edge in the body's contact list\n        this.next = null; /// < the next contact edge in the body's contact list\n    }\n    return b2ContactEdge;\n}());\nexports.b2ContactEdge = b2ContactEdge;\nvar b2Contact = /** @class */ (function () {\n    function b2Contact() {\n        this.m_islandFlag = false; /// Used when crawling contact graph when forming islands.\n        this.m_touchingFlag = false; /// Set when the shapes are touching.\n        this.m_enabledFlag = false; /// This contact can be disabled (by user)\n        this.m_filterFlag = false; /// This contact needs filtering because a fixture filter was changed.\n        this.m_bulletHitFlag = false; /// This bullet contact had a TOI event\n        this.m_toiFlag = false; /// This contact has a valid TOI in m_toi\n        this.m_prev = null;\n        this.m_next = null;\n        this.m_nodeA = new b2ContactEdge();\n        this.m_nodeB = new b2ContactEdge();\n        this.m_fixtureA = null;\n        this.m_fixtureB = null;\n        this.m_indexA = 0;\n        this.m_indexB = 0;\n        this.m_manifold = new b2Collision_1.b2Manifold();\n        this.m_toiCount = 0;\n        this.m_toi = 0;\n        this.m_friction = 0;\n        this.m_restitution = 0;\n        this.m_tangentSpeed = 0;\n        this.m_oldManifold = new b2Collision_1.b2Manifold();\n    }\n    b2Contact.prototype.GetManifold = function () {\n        return this.m_manifold;\n    };\n    b2Contact.prototype.GetWorldManifold = function (worldManifold) {\n        var bodyA = this.m_fixtureA.GetBody();\n        var bodyB = this.m_fixtureB.GetBody();\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        worldManifold.Initialize(this.m_manifold, bodyA.GetTransform(), shapeA.m_radius, bodyB.GetTransform(), shapeB.m_radius);\n    };\n    b2Contact.prototype.IsTouching = function () {\n        return this.m_touchingFlag;\n    };\n    b2Contact.prototype.SetEnabled = function (flag) {\n        this.m_enabledFlag = flag;\n    };\n    b2Contact.prototype.IsEnabled = function () {\n        return this.m_enabledFlag;\n    };\n    b2Contact.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    b2Contact.prototype.GetFixtureA = function () {\n        return this.m_fixtureA;\n    };\n    b2Contact.prototype.GetChildIndexA = function () {\n        return this.m_indexA;\n    };\n    b2Contact.prototype.GetFixtureB = function () {\n        return this.m_fixtureB;\n    };\n    b2Contact.prototype.GetChildIndexB = function () {\n        return this.m_indexB;\n    };\n    b2Contact.prototype.Evaluate = function (manifold, xfA, xfB) {\n    };\n    b2Contact.prototype.FlagForFiltering = function () {\n        this.m_filterFlag = true;\n    };\n    b2Contact.prototype.SetFriction = function (friction) {\n        this.m_friction = friction;\n    };\n    b2Contact.prototype.GetFriction = function () {\n        return this.m_friction;\n    };\n    b2Contact.prototype.ResetFriction = function () {\n        this.m_friction = b2MixFriction(this.m_fixtureA.m_friction, this.m_fixtureB.m_friction);\n    };\n    b2Contact.prototype.SetRestitution = function (restitution) {\n        this.m_restitution = restitution;\n    };\n    b2Contact.prototype.GetRestitution = function () {\n        return this.m_restitution;\n    };\n    b2Contact.prototype.ResetRestitution = function () {\n        this.m_restitution = b2MixRestitution(this.m_fixtureA.m_restitution, this.m_fixtureB.m_restitution);\n    };\n    b2Contact.prototype.SetTangentSpeed = function (speed) {\n        this.m_tangentSpeed = speed;\n    };\n    b2Contact.prototype.GetTangentSpeed = function () {\n        return this.m_tangentSpeed;\n    };\n    b2Contact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        this.m_islandFlag = false;\n        this.m_touchingFlag = false;\n        this.m_enabledFlag = true;\n        this.m_filterFlag = false;\n        this.m_bulletHitFlag = false;\n        this.m_toiFlag = false;\n        this.m_fixtureA = fixtureA;\n        this.m_fixtureB = fixtureB;\n        this.m_indexA = indexA;\n        this.m_indexB = indexB;\n        this.m_manifold.pointCount = 0;\n        this.m_prev = null;\n        this.m_next = null;\n        this.m_nodeA.contact = null;\n        this.m_nodeA.prev = null;\n        this.m_nodeA.next = null;\n        this.m_nodeA.other = null;\n        this.m_nodeB.contact = null;\n        this.m_nodeB.prev = null;\n        this.m_nodeB.next = null;\n        this.m_nodeB.other = null;\n        this.m_toiCount = 0;\n        this.m_friction = b2MixFriction(this.m_fixtureA.m_friction, this.m_fixtureB.m_friction);\n        this.m_restitution = b2MixRestitution(this.m_fixtureA.m_restitution, this.m_fixtureB.m_restitution);\n    };\n    b2Contact.prototype.Update = function (listener) {\n        var tManifold = this.m_oldManifold;\n        this.m_oldManifold = this.m_manifold;\n        this.m_manifold = tManifold;\n        // Re-enable this contact.\n        this.m_enabledFlag = true;\n        var touching = false;\n        var wasTouching = this.m_touchingFlag;\n        var sensorA = this.m_fixtureA.IsSensor();\n        var sensorB = this.m_fixtureB.IsSensor();\n        var sensor = sensorA || sensorB;\n        var bodyA = this.m_fixtureA.GetBody();\n        var bodyB = this.m_fixtureB.GetBody();\n        var xfA = bodyA.GetTransform();\n        var xfB = bodyB.GetTransform();\n        /// const aabbOverlap = b2TestOverlapAABB(this.m_fixtureA.GetAABB(0), this.m_fixtureB.GetAABB(0));\n        // Is this contact a sensor?\n        if (sensor) {\n            /// if (aabbOverlap)\n            /// {\n            var shapeA = this.m_fixtureA.GetShape();\n            var shapeB = this.m_fixtureB.GetShape();\n            touching = b2Collision_2.b2TestOverlapShape(shapeA, this.m_indexA, shapeB, this.m_indexB, xfA, xfB);\n            /// }\n            // Sensors don't generate manifolds.\n            this.m_manifold.pointCount = 0;\n        }\n        else {\n            /// if (aabbOverlap)\n            /// {\n            this.Evaluate(this.m_manifold, xfA, xfB);\n            touching = this.m_manifold.pointCount > 0;\n            // Match old contact ids to new contact ids and copy the\n            // stored impulses to warm start the solver.\n            for (var i = 0; i < this.m_manifold.pointCount; ++i) {\n                var mp2 = this.m_manifold.points[i];\n                mp2.normalImpulse = 0;\n                mp2.tangentImpulse = 0;\n                var id2 = mp2.id;\n                for (var j = 0; j < this.m_oldManifold.pointCount; ++j) {\n                    var mp1 = this.m_oldManifold.points[j];\n                    if (mp1.id.key === id2.key) {\n                        mp2.normalImpulse = mp1.normalImpulse;\n                        mp2.tangentImpulse = mp1.tangentImpulse;\n                        break;\n                    }\n                }\n            }\n            /// }\n            /// else\n            /// {\n            ///  this.m_manifold.pointCount = 0;\n            /// }\n            if (touching !== wasTouching) {\n                bodyA.SetAwake(true);\n                bodyB.SetAwake(true);\n            }\n        }\n        this.m_touchingFlag = touching;\n        if (!wasTouching && touching && listener) {\n            listener.BeginContact(this);\n        }\n        if (wasTouching && !touching && listener) {\n            listener.EndContact(this);\n        }\n        if (!sensor && touching && listener) {\n            listener.PreSolve(this, this.m_oldManifold);\n        }\n    };\n    b2Contact.prototype.ComputeTOI = function (sweepA, sweepB) {\n        var input = b2Contact.ComputeTOI_s_input;\n        input.proxyA.SetShape(this.m_fixtureA.GetShape(), this.m_indexA);\n        input.proxyB.SetShape(this.m_fixtureB.GetShape(), this.m_indexB);\n        input.sweepA.Copy(sweepA);\n        input.sweepB.Copy(sweepB);\n        input.tMax = b2Settings_1.b2_linearSlop;\n        var output = b2Contact.ComputeTOI_s_output;\n        b2TimeOfImpact_1.b2TimeOfImpact(output, input);\n        return output.t;\n    };\n    b2Contact.ComputeTOI_s_input = new b2TimeOfImpact_1.b2TOIInput();\n    b2Contact.ComputeTOI_s_output = new b2TimeOfImpact_1.b2TOIOutput();\n    return b2Contact;\n}());\nexports.b2Contact = b2Contact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2Contact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2ContactFactory.ts":
/*!*********************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2ContactFactory.ts ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Shape_1 = __webpack_require__(/*! ../../Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2ChainAndCircleContact_1 = __webpack_require__(/*! ./b2ChainAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2ChainAndCircleContact.ts\");\nvar b2ChainAndPolygonContact_1 = __webpack_require__(/*! ./b2ChainAndPolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2ChainAndPolygonContact.ts\");\nvar b2CircleContact_1 = __webpack_require__(/*! ./b2CircleContact */ \"./src/Box2D/Dynamics/Contacts/b2CircleContact.ts\");\nvar b2EdgeAndCircleContact_1 = __webpack_require__(/*! ./b2EdgeAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2EdgeAndCircleContact.ts\");\nvar b2EdgeAndPolygonContact_1 = __webpack_require__(/*! ./b2EdgeAndPolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2EdgeAndPolygonContact.ts\");\nvar b2PolygonAndCircleContact_1 = __webpack_require__(/*! ./b2PolygonAndCircleContact */ \"./src/Box2D/Dynamics/Contacts/b2PolygonAndCircleContact.ts\");\nvar b2PolygonContact_1 = __webpack_require__(/*! ./b2PolygonContact */ \"./src/Box2D/Dynamics/Contacts/b2PolygonContact.ts\");\nvar b2ContactRegister = /** @class */ (function () {\n    function b2ContactRegister() {\n        this.pool = null;\n        this.createFcn = null;\n        this.destroyFcn = null;\n        this.primary = false;\n    }\n    return b2ContactRegister;\n}());\nexports.b2ContactRegister = b2ContactRegister;\nvar b2ContactFactory = /** @class */ (function () {\n    function b2ContactFactory(allocator) {\n        this.m_allocator = null;\n        this.m_allocator = allocator;\n        this.InitializeRegisters();\n    }\n    b2ContactFactory.prototype.AddType = function (createFcn, destroyFcn, type1, type2) {\n        var _this = this;\n        var pool = b2Settings_1.b2MakeArray(256, function (i) { return createFcn(_this.m_allocator); }); // TODO: b2Settings\n        function poolCreateFcn(allocator) {\n            if (pool.length > 0) {\n                return pool.pop();\n            }\n            return createFcn(allocator);\n        }\n        function poolDestroyFcn(contact, allocator) {\n            pool.push(contact);\n        }\n        this.m_registers[type1][type2].pool = pool;\n        this.m_registers[type1][type2].createFcn = poolCreateFcn;\n        this.m_registers[type1][type2].destroyFcn = poolDestroyFcn;\n        this.m_registers[type1][type2].primary = true;\n        if (type1 !== type2) {\n            this.m_registers[type2][type1].pool = pool;\n            this.m_registers[type2][type1].createFcn = poolCreateFcn;\n            this.m_registers[type2][type1].destroyFcn = poolDestroyFcn;\n            this.m_registers[type2][type1].primary = false;\n        }\n        /*\n        this.m_registers[type1][type2].createFcn = createFcn;\n        this.m_registers[type1][type2].destroyFcn = destroyFcn;\n        this.m_registers[type1][type2].primary = true;\n    \n        if (type1 !== type2) {\n          this.m_registers[type2][type1].createFcn = createFcn;\n          this.m_registers[type2][type1].destroyFcn = destroyFcn;\n          this.m_registers[type2][type1].primary = false;\n        }\n        */\n    };\n    b2ContactFactory.prototype.InitializeRegisters = function () {\n        this.m_registers = [ /*b2ShapeType.e_shapeTypeCount*/];\n        for (var i = 0; i < b2Shape_1.b2ShapeType.e_shapeTypeCount; i++) {\n            this.m_registers[i] = [ /*b2ShapeType.e_shapeTypeCount*/];\n            for (var j = 0; j < b2Shape_1.b2ShapeType.e_shapeTypeCount; j++) {\n                this.m_registers[i][j] = new b2ContactRegister();\n            }\n        }\n        this.AddType(b2CircleContact_1.b2CircleContact.Create, b2CircleContact_1.b2CircleContact.Destroy, b2Shape_1.b2ShapeType.e_circleShape, b2Shape_1.b2ShapeType.e_circleShape);\n        this.AddType(b2PolygonAndCircleContact_1.b2PolygonAndCircleContact.Create, b2PolygonAndCircleContact_1.b2PolygonAndCircleContact.Destroy, b2Shape_1.b2ShapeType.e_polygonShape, b2Shape_1.b2ShapeType.e_circleShape);\n        this.AddType(b2PolygonContact_1.b2PolygonContact.Create, b2PolygonContact_1.b2PolygonContact.Destroy, b2Shape_1.b2ShapeType.e_polygonShape, b2Shape_1.b2ShapeType.e_polygonShape);\n        this.AddType(b2EdgeAndCircleContact_1.b2EdgeAndCircleContact.Create, b2EdgeAndCircleContact_1.b2EdgeAndCircleContact.Destroy, b2Shape_1.b2ShapeType.e_edgeShape, b2Shape_1.b2ShapeType.e_circleShape);\n        this.AddType(b2EdgeAndPolygonContact_1.b2EdgeAndPolygonContact.Create, b2EdgeAndPolygonContact_1.b2EdgeAndPolygonContact.Destroy, b2Shape_1.b2ShapeType.e_edgeShape, b2Shape_1.b2ShapeType.e_polygonShape);\n        this.AddType(b2ChainAndCircleContact_1.b2ChainAndCircleContact.Create, b2ChainAndCircleContact_1.b2ChainAndCircleContact.Destroy, b2Shape_1.b2ShapeType.e_chainShape, b2Shape_1.b2ShapeType.e_circleShape);\n        this.AddType(b2ChainAndPolygonContact_1.b2ChainAndPolygonContact.Create, b2ChainAndPolygonContact_1.b2ChainAndPolygonContact.Destroy, b2Shape_1.b2ShapeType.e_chainShape, b2Shape_1.b2ShapeType.e_polygonShape);\n    };\n    b2ContactFactory.prototype.Create = function (fixtureA, indexA, fixtureB, indexB) {\n        var type1 = fixtureA.GetType();\n        var type2 = fixtureB.GetType();\n        /// b2Assert(0 <= type1 && type1 < b2ShapeType.e_shapeTypeCount);\n        /// b2Assert(0 <= type2 && type2 < b2ShapeType.e_shapeTypeCount);\n        var reg = this.m_registers[type1][type2];\n        if (reg.createFcn) {\n            var c = reg.createFcn(this.m_allocator);\n            if (reg.primary) {\n                c.Reset(fixtureA, indexA, fixtureB, indexB);\n            }\n            else {\n                c.Reset(fixtureB, indexB, fixtureA, indexA);\n            }\n            return c;\n        }\n        else {\n            return null;\n        }\n    };\n    b2ContactFactory.prototype.Destroy = function (contact) {\n        var fixtureA = contact.m_fixtureA;\n        var fixtureB = contact.m_fixtureB;\n        if (contact.m_manifold.pointCount > 0 &&\n            !fixtureA.IsSensor() &&\n            !fixtureB.IsSensor()) {\n            fixtureA.GetBody().SetAwake(true);\n            fixtureB.GetBody().SetAwake(true);\n        }\n        var typeA = fixtureA.GetType();\n        var typeB = fixtureB.GetType();\n        /// b2Assert(0 <= typeA && typeB < b2ShapeType.e_shapeTypeCount);\n        /// b2Assert(0 <= typeA && typeB < b2ShapeType.e_shapeTypeCount);\n        var reg = this.m_registers[typeA][typeB];\n        reg.destroyFcn(contact, this.m_allocator);\n    };\n    return b2ContactFactory;\n}());\nexports.b2ContactFactory = b2ContactFactory;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2ContactFactory.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2ContactSolver.ts":
/*!********************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2ContactSolver.ts ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Collision_1 = __webpack_require__(/*! ../../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Collision_2 = __webpack_require__(/*! ../../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2TimeStep_1 = __webpack_require__(/*! ../b2TimeStep */ \"./src/Box2D/Dynamics/b2TimeStep.ts\");\nvar b2VelocityConstraintPoint = /** @class */ (function () {\n    function b2VelocityConstraintPoint() {\n        this.rA = new b2Math_1.b2Vec2();\n        this.rB = new b2Math_1.b2Vec2();\n        this.normalImpulse = 0;\n        this.tangentImpulse = 0;\n        this.normalMass = 0;\n        this.tangentMass = 0;\n        this.velocityBias = 0;\n    }\n    b2VelocityConstraintPoint.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2VelocityConstraintPoint(); });\n    };\n    return b2VelocityConstraintPoint;\n}());\nexports.b2VelocityConstraintPoint = b2VelocityConstraintPoint;\nvar b2ContactVelocityConstraint = /** @class */ (function () {\n    function b2ContactVelocityConstraint() {\n        this.points = b2VelocityConstraintPoint.MakeArray(b2Settings_1.b2_maxManifoldPoints);\n        this.normal = new b2Math_1.b2Vec2();\n        this.tangent = new b2Math_1.b2Vec2();\n        this.normalMass = new b2Math_1.b2Mat22();\n        this.K = new b2Math_1.b2Mat22();\n        this.indexA = 0;\n        this.indexB = 0;\n        this.invMassA = 0;\n        this.invMassB = 0;\n        this.invIA = 0;\n        this.invIB = 0;\n        this.friction = 0;\n        this.restitution = 0;\n        this.tangentSpeed = 0;\n        this.pointCount = 0;\n        this.contactIndex = 0;\n    }\n    b2ContactVelocityConstraint.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2ContactVelocityConstraint(); });\n    };\n    return b2ContactVelocityConstraint;\n}());\nexports.b2ContactVelocityConstraint = b2ContactVelocityConstraint;\nvar b2ContactPositionConstraint = /** @class */ (function () {\n    function b2ContactPositionConstraint() {\n        this.localPoints = b2Math_1.b2Vec2.MakeArray(b2Settings_1.b2_maxManifoldPoints);\n        this.localNormal = new b2Math_1.b2Vec2();\n        this.localPoint = new b2Math_1.b2Vec2();\n        this.indexA = 0;\n        this.indexB = 0;\n        this.invMassA = 0;\n        this.invMassB = 0;\n        this.localCenterA = new b2Math_1.b2Vec2();\n        this.localCenterB = new b2Math_1.b2Vec2();\n        this.invIA = 0;\n        this.invIB = 0;\n        this.type = b2Collision_1.b2ManifoldType.e_unknown;\n        this.radiusA = 0;\n        this.radiusB = 0;\n        this.pointCount = 0;\n    }\n    b2ContactPositionConstraint.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2ContactPositionConstraint(); });\n    };\n    return b2ContactPositionConstraint;\n}());\nexports.b2ContactPositionConstraint = b2ContactPositionConstraint;\nvar b2ContactSolverDef = /** @class */ (function () {\n    function b2ContactSolverDef() {\n        this.step = new b2TimeStep_1.b2TimeStep();\n        this.contacts = null;\n        this.count = 0;\n        this.positions = null;\n        this.velocities = null;\n        this.allocator = null;\n    }\n    return b2ContactSolverDef;\n}());\nexports.b2ContactSolverDef = b2ContactSolverDef;\nvar b2PositionSolverManifold = /** @class */ (function () {\n    function b2PositionSolverManifold() {\n        this.normal = new b2Math_1.b2Vec2();\n        this.point = new b2Math_1.b2Vec2();\n        this.separation = 0;\n    }\n    b2PositionSolverManifold.prototype.Initialize = function (pc, xfA, xfB, index) {\n        var pointA = b2PositionSolverManifold.Initialize_s_pointA;\n        var pointB = b2PositionSolverManifold.Initialize_s_pointB;\n        var planePoint = b2PositionSolverManifold.Initialize_s_planePoint;\n        var clipPoint = b2PositionSolverManifold.Initialize_s_clipPoint;\n        /// b2Assert(pc.pointCount > 0);\n        switch (pc.type) {\n            case b2Collision_1.b2ManifoldType.e_circles:\n                {\n                    // b2Vec2 pointA = b2Mul(xfA, pc->localPoint);\n                    b2Math_1.b2Transform.MulXV(xfA, pc.localPoint, pointA);\n                    // b2Vec2 pointB = b2Mul(xfB, pc->localPoints[0]);\n                    b2Math_1.b2Transform.MulXV(xfB, pc.localPoints[0], pointB);\n                    // normal = pointB - pointA;\n                    // normal.Normalize();\n                    b2Math_1.b2Vec2.SubVV(pointB, pointA, this.normal).SelfNormalize();\n                    // point = 0.5f * (pointA + pointB);\n                    b2Math_1.b2Vec2.MidVV(pointA, pointB, this.point);\n                    // separation = b2Dot(pointB - pointA, normal) - pc->radius;\n                    this.separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pointB, pointA, b2Math_1.b2Vec2.s_t0), this.normal) - pc.radiusA - pc.radiusB;\n                }\n                break;\n            case b2Collision_1.b2ManifoldType.e_faceA:\n                {\n                    // normal = b2Mul(xfA.q, pc->localNormal);\n                    b2Math_1.b2Rot.MulRV(xfA.q, pc.localNormal, this.normal);\n                    // b2Vec2 planePoint = b2Mul(xfA, pc->localPoint);\n                    b2Math_1.b2Transform.MulXV(xfA, pc.localPoint, planePoint);\n                    // b2Vec2 clipPoint = b2Mul(xfB, pc->localPoints[index]);\n                    b2Math_1.b2Transform.MulXV(xfB, pc.localPoints[index], clipPoint);\n                    // separation = b2Dot(clipPoint - planePoint, normal) - pc->radius;\n                    this.separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(clipPoint, planePoint, b2Math_1.b2Vec2.s_t0), this.normal) - pc.radiusA - pc.radiusB;\n                    // point = clipPoint;\n                    this.point.Copy(clipPoint);\n                }\n                break;\n            case b2Collision_1.b2ManifoldType.e_faceB:\n                {\n                    // normal = b2Mul(xfB.q, pc->localNormal);\n                    b2Math_1.b2Rot.MulRV(xfB.q, pc.localNormal, this.normal);\n                    // b2Vec2 planePoint = b2Mul(xfB, pc->localPoint);\n                    b2Math_1.b2Transform.MulXV(xfB, pc.localPoint, planePoint);\n                    // b2Vec2 clipPoint = b2Mul(xfA, pc->localPoints[index]);\n                    b2Math_1.b2Transform.MulXV(xfA, pc.localPoints[index], clipPoint);\n                    // separation = b2Dot(clipPoint - planePoint, normal) - pc->radius;\n                    this.separation = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(clipPoint, planePoint, b2Math_1.b2Vec2.s_t0), this.normal) - pc.radiusA - pc.radiusB;\n                    // point = clipPoint;\n                    this.point.Copy(clipPoint);\n                    // Ensure normal points from A to B\n                    // normal = -normal;\n                    this.normal.SelfNeg();\n                }\n                break;\n        }\n    };\n    b2PositionSolverManifold.Initialize_s_pointA = new b2Math_1.b2Vec2();\n    b2PositionSolverManifold.Initialize_s_pointB = new b2Math_1.b2Vec2();\n    b2PositionSolverManifold.Initialize_s_planePoint = new b2Math_1.b2Vec2();\n    b2PositionSolverManifold.Initialize_s_clipPoint = new b2Math_1.b2Vec2();\n    return b2PositionSolverManifold;\n}());\nexports.b2PositionSolverManifold = b2PositionSolverManifold;\nvar b2ContactSolver = /** @class */ (function () {\n    function b2ContactSolver() {\n        this.m_step = new b2TimeStep_1.b2TimeStep();\n        this.m_positions = null;\n        this.m_velocities = null;\n        this.m_allocator = null;\n        this.m_positionConstraints = b2ContactPositionConstraint.MakeArray(1024); // TODO: b2Settings\n        this.m_velocityConstraints = b2ContactVelocityConstraint.MakeArray(1024); // TODO: b2Settings\n        this.m_contacts = null;\n        this.m_count = 0;\n    }\n    b2ContactSolver.prototype.Initialize = function (def) {\n        this.m_step.Copy(def.step);\n        this.m_allocator = def.allocator;\n        this.m_count = def.count;\n        // TODO:\n        if (this.m_positionConstraints.length < this.m_count) {\n            var new_length = b2Math_1.b2Max(this.m_positionConstraints.length * 2, this.m_count);\n            while (this.m_positionConstraints.length < new_length) {\n                this.m_positionConstraints[this.m_positionConstraints.length] = new b2ContactPositionConstraint();\n            }\n        }\n        // TODO:\n        if (this.m_velocityConstraints.length < this.m_count) {\n            var new_length = b2Math_1.b2Max(this.m_velocityConstraints.length * 2, this.m_count);\n            while (this.m_velocityConstraints.length < new_length) {\n                this.m_velocityConstraints[this.m_velocityConstraints.length] = new b2ContactVelocityConstraint();\n            }\n        }\n        this.m_positions = def.positions;\n        this.m_velocities = def.velocities;\n        this.m_contacts = def.contacts;\n        // Initialize position independent portions of the constraints.\n        for (var i = 0; i < this.m_count; ++i) {\n            var contact = this.m_contacts[i];\n            var fixtureA = contact.m_fixtureA;\n            var fixtureB = contact.m_fixtureB;\n            var shapeA = fixtureA.GetShape();\n            var shapeB = fixtureB.GetShape();\n            var radiusA = shapeA.m_radius;\n            var radiusB = shapeB.m_radius;\n            var bodyA = fixtureA.GetBody();\n            var bodyB = fixtureB.GetBody();\n            var manifold = contact.GetManifold();\n            var pointCount = manifold.pointCount;\n            /// b2Assert(pointCount > 0);\n            var vc = this.m_velocityConstraints[i];\n            vc.friction = contact.m_friction;\n            vc.restitution = contact.m_restitution;\n            vc.tangentSpeed = contact.m_tangentSpeed;\n            vc.indexA = bodyA.m_islandIndex;\n            vc.indexB = bodyB.m_islandIndex;\n            vc.invMassA = bodyA.m_invMass;\n            vc.invMassB = bodyB.m_invMass;\n            vc.invIA = bodyA.m_invI;\n            vc.invIB = bodyB.m_invI;\n            vc.contactIndex = i;\n            vc.pointCount = pointCount;\n            vc.K.SetZero();\n            vc.normalMass.SetZero();\n            var pc = this.m_positionConstraints[i];\n            pc.indexA = bodyA.m_islandIndex;\n            pc.indexB = bodyB.m_islandIndex;\n            pc.invMassA = bodyA.m_invMass;\n            pc.invMassB = bodyB.m_invMass;\n            pc.localCenterA.Copy(bodyA.m_sweep.localCenter);\n            pc.localCenterB.Copy(bodyB.m_sweep.localCenter);\n            pc.invIA = bodyA.m_invI;\n            pc.invIB = bodyB.m_invI;\n            pc.localNormal.Copy(manifold.localNormal);\n            pc.localPoint.Copy(manifold.localPoint);\n            pc.pointCount = pointCount;\n            pc.radiusA = radiusA;\n            pc.radiusB = radiusB;\n            pc.type = manifold.type;\n            for (var j = 0; j < pointCount; ++j) {\n                var cp = manifold.points[j];\n                var vcp = vc.points[j];\n                if (this.m_step.warmStarting) {\n                    vcp.normalImpulse = this.m_step.dtRatio * cp.normalImpulse;\n                    vcp.tangentImpulse = this.m_step.dtRatio * cp.tangentImpulse;\n                }\n                else {\n                    vcp.normalImpulse = 0;\n                    vcp.tangentImpulse = 0;\n                }\n                vcp.rA.SetZero();\n                vcp.rB.SetZero();\n                vcp.normalMass = 0;\n                vcp.tangentMass = 0;\n                vcp.velocityBias = 0;\n                pc.localPoints[j].Copy(cp.localPoint);\n            }\n        }\n        return this;\n    };\n    b2ContactSolver.prototype.InitializeVelocityConstraints = function () {\n        var xfA = b2ContactSolver.InitializeVelocityConstraints_s_xfA;\n        var xfB = b2ContactSolver.InitializeVelocityConstraints_s_xfB;\n        var worldManifold = b2ContactSolver.InitializeVelocityConstraints_s_worldManifold;\n        var k_maxConditionNumber = 1000;\n        for (var i = 0; i < this.m_count; ++i) {\n            var vc = this.m_velocityConstraints[i];\n            var pc = this.m_positionConstraints[i];\n            var radiusA = pc.radiusA;\n            var radiusB = pc.radiusB;\n            var manifold = this.m_contacts[vc.contactIndex].GetManifold();\n            var indexA = vc.indexA;\n            var indexB = vc.indexB;\n            var mA = vc.invMassA;\n            var mB = vc.invMassB;\n            var iA = vc.invIA;\n            var iB = vc.invIB;\n            var localCenterA = pc.localCenterA;\n            var localCenterB = pc.localCenterB;\n            var cA = this.m_positions[indexA].c;\n            var aA = this.m_positions[indexA].a;\n            var vA = this.m_velocities[indexA].v;\n            var wA = this.m_velocities[indexA].w;\n            var cB = this.m_positions[indexB].c;\n            var aB = this.m_positions[indexB].a;\n            var vB = this.m_velocities[indexB].v;\n            var wB = this.m_velocities[indexB].w;\n            /// b2Assert(manifold.pointCount > 0);\n            xfA.q.SetAngle(aA);\n            xfB.q.SetAngle(aB);\n            b2Math_1.b2Vec2.SubVV(cA, b2Math_1.b2Rot.MulRV(xfA.q, localCenterA, b2Math_1.b2Vec2.s_t0), xfA.p);\n            b2Math_1.b2Vec2.SubVV(cB, b2Math_1.b2Rot.MulRV(xfB.q, localCenterB, b2Math_1.b2Vec2.s_t0), xfB.p);\n            worldManifold.Initialize(manifold, xfA, radiusA, xfB, radiusB);\n            vc.normal.Copy(worldManifold.normal);\n            b2Math_1.b2Vec2.CrossVOne(vc.normal, vc.tangent); // compute from normal\n            var pointCount = vc.pointCount;\n            for (var j = 0; j < pointCount; ++j) {\n                var vcp = vc.points[j];\n                // vcp->rA = worldManifold.points[j] - cA;\n                b2Math_1.b2Vec2.SubVV(worldManifold.points[j], cA, vcp.rA);\n                // vcp->rB = worldManifold.points[j] - cB;\n                b2Math_1.b2Vec2.SubVV(worldManifold.points[j], cB, vcp.rB);\n                var rnA = b2Math_1.b2Vec2.CrossVV(vcp.rA, vc.normal);\n                var rnB = b2Math_1.b2Vec2.CrossVV(vcp.rB, vc.normal);\n                var kNormal = mA + mB + iA * rnA * rnA + iB * rnB * rnB;\n                vcp.normalMass = kNormal > 0 ? 1 / kNormal : 0;\n                // b2Vec2 tangent = b2Cross(vc->normal, 1.0f);\n                var tangent = vc.tangent; // precomputed from normal\n                var rtA = b2Math_1.b2Vec2.CrossVV(vcp.rA, tangent);\n                var rtB = b2Math_1.b2Vec2.CrossVV(vcp.rB, tangent);\n                var kTangent = mA + mB + iA * rtA * rtA + iB * rtB * rtB;\n                vcp.tangentMass = kTangent > 0 ? 1 / kTangent : 0;\n                // Setup a velocity bias for restitution.\n                vcp.velocityBias = 0;\n                // float32 vRel = b2Dot(vc->normal, vB + b2Cross(wB, vcp->rB) - vA - b2Cross(wA, vcp->rA));\n                var vRel = b2Math_1.b2Vec2.DotVV(vc.normal, b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, vcp.rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, vcp.rA, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0));\n                if (vRel < (-b2Settings_1.b2_velocityThreshold)) {\n                    vcp.velocityBias += (-vc.restitution * vRel);\n                }\n            }\n            // If we have two points, then prepare the block solver.\n            if (vc.pointCount === 2) {\n                var vcp1 = vc.points[0];\n                var vcp2 = vc.points[1];\n                var rn1A = b2Math_1.b2Vec2.CrossVV(vcp1.rA, vc.normal);\n                var rn1B = b2Math_1.b2Vec2.CrossVV(vcp1.rB, vc.normal);\n                var rn2A = b2Math_1.b2Vec2.CrossVV(vcp2.rA, vc.normal);\n                var rn2B = b2Math_1.b2Vec2.CrossVV(vcp2.rB, vc.normal);\n                var k11 = mA + mB + iA * rn1A * rn1A + iB * rn1B * rn1B;\n                var k22 = mA + mB + iA * rn2A * rn2A + iB * rn2B * rn2B;\n                var k12 = mA + mB + iA * rn1A * rn2A + iB * rn1B * rn2B;\n                // Ensure a reasonable condition number.\n                // float32 k_maxConditionNumber = 1000.0f;\n                if (k11 * k11 < k_maxConditionNumber * (k11 * k22 - k12 * k12)) {\n                    // K is safe to invert.\n                    vc.K.ex.Set(k11, k12);\n                    vc.K.ey.Set(k12, k22);\n                    vc.K.GetInverse(vc.normalMass);\n                }\n                else {\n                    // The constraints are redundant, just use one.\n                    // TODO_ERIN use deepest?\n                    vc.pointCount = 1;\n                }\n            }\n        }\n    };\n    b2ContactSolver.prototype.WarmStart = function () {\n        var P = b2ContactSolver.WarmStart_s_P;\n        // Warm start.\n        for (var i = 0; i < this.m_count; ++i) {\n            var vc = this.m_velocityConstraints[i];\n            var indexA = vc.indexA;\n            var indexB = vc.indexB;\n            var mA = vc.invMassA;\n            var iA = vc.invIA;\n            var mB = vc.invMassB;\n            var iB = vc.invIB;\n            var pointCount = vc.pointCount;\n            var vA = this.m_velocities[indexA].v;\n            var wA = this.m_velocities[indexA].w;\n            var vB = this.m_velocities[indexB].v;\n            var wB = this.m_velocities[indexB].w;\n            var normal = vc.normal;\n            // b2Vec2 tangent = b2Cross(normal, 1.0f);\n            var tangent = vc.tangent; // precomputed from normal\n            for (var j = 0; j < pointCount; ++j) {\n                var vcp = vc.points[j];\n                // b2Vec2 P = vcp->normalImpulse * normal + vcp->tangentImpulse * tangent;\n                b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.MulSV(vcp.normalImpulse, normal, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.MulSV(vcp.tangentImpulse, tangent, b2Math_1.b2Vec2.s_t1), P);\n                // wA -= iA * b2Cross(vcp->rA, P);\n                wA -= iA * b2Math_1.b2Vec2.CrossVV(vcp.rA, P);\n                // vA -= mA * P;\n                vA.SelfMulSub(mA, P);\n                // wB += iB * b2Cross(vcp->rB, P);\n                wB += iB * b2Math_1.b2Vec2.CrossVV(vcp.rB, P);\n                // vB += mB * P;\n                vB.SelfMulAdd(mB, P);\n            }\n            // this.m_velocities[indexA].v = vA;\n            this.m_velocities[indexA].w = wA;\n            // this.m_velocities[indexB].v = vB;\n            this.m_velocities[indexB].w = wB;\n        }\n    };\n    b2ContactSolver.prototype.SolveVelocityConstraints = function () {\n        var dv = b2ContactSolver.SolveVelocityConstraints_s_dv;\n        var dv1 = b2ContactSolver.SolveVelocityConstraints_s_dv1;\n        var dv2 = b2ContactSolver.SolveVelocityConstraints_s_dv2;\n        var P = b2ContactSolver.SolveVelocityConstraints_s_P;\n        var a = b2ContactSolver.SolveVelocityConstraints_s_a;\n        var b = b2ContactSolver.SolveVelocityConstraints_s_b;\n        var x = b2ContactSolver.SolveVelocityConstraints_s_x;\n        var d = b2ContactSolver.SolveVelocityConstraints_s_d;\n        var P1 = b2ContactSolver.SolveVelocityConstraints_s_P1;\n        var P2 = b2ContactSolver.SolveVelocityConstraints_s_P2;\n        var P1P2 = b2ContactSolver.SolveVelocityConstraints_s_P1P2;\n        for (var i = 0; i < this.m_count; ++i) {\n            var vc = this.m_velocityConstraints[i];\n            var indexA = vc.indexA;\n            var indexB = vc.indexB;\n            var mA = vc.invMassA;\n            var iA = vc.invIA;\n            var mB = vc.invMassB;\n            var iB = vc.invIB;\n            var pointCount = vc.pointCount;\n            var vA = this.m_velocities[indexA].v;\n            var wA = this.m_velocities[indexA].w;\n            var vB = this.m_velocities[indexB].v;\n            var wB = this.m_velocities[indexB].w;\n            // b2Vec2 normal = vc->normal;\n            var normal = vc.normal;\n            // b2Vec2 tangent = b2Cross(normal, 1.0f);\n            var tangent = vc.tangent; // precomputed from normal\n            var friction = vc.friction;\n            /// b2Assert(pointCount === 1 || pointCount === 2);\n            // Solve tangent constraints first because non-penetration is more important\n            // than friction.\n            for (var j = 0; j < pointCount; ++j) {\n                var vcp = vc.points[j];\n                // Relative velocity at contact\n                // b2Vec2 dv = vB + b2Cross(wB, vcp->rB) - vA - b2Cross(wA, vcp->rA);\n                b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, vcp.rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, vcp.rA, b2Math_1.b2Vec2.s_t1), dv);\n                // Compute tangent force\n                // float32 vt = b2Dot(dv, tangent) - vc->tangentSpeed;\n                var vt = b2Math_1.b2Vec2.DotVV(dv, tangent) - vc.tangentSpeed;\n                var lambda = vcp.tangentMass * (-vt);\n                // b2Clamp the accumulated force\n                var maxFriction = friction * vcp.normalImpulse;\n                var newImpulse = b2Math_1.b2Clamp(vcp.tangentImpulse + lambda, (-maxFriction), maxFriction);\n                lambda = newImpulse - vcp.tangentImpulse;\n                vcp.tangentImpulse = newImpulse;\n                // Apply contact impulse\n                // b2Vec2 P = lambda * tangent;\n                b2Math_1.b2Vec2.MulSV(lambda, tangent, P);\n                // vA -= mA * P;\n                vA.SelfMulSub(mA, P);\n                // wA -= iA * b2Cross(vcp->rA, P);\n                wA -= iA * b2Math_1.b2Vec2.CrossVV(vcp.rA, P);\n                // vB += mB * P;\n                vB.SelfMulAdd(mB, P);\n                // wB += iB * b2Cross(vcp->rB, P);\n                wB += iB * b2Math_1.b2Vec2.CrossVV(vcp.rB, P);\n            }\n            // Solve normal constraints\n            if (vc.pointCount === 1) {\n                var vcp = vc.points[0];\n                // Relative velocity at contact\n                // b2Vec2 dv = vB + b2Cross(wB, vcp->rB) - vA - b2Cross(wA, vcp->rA);\n                b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, vcp.rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, vcp.rA, b2Math_1.b2Vec2.s_t1), dv);\n                // Compute normal impulse\n                // float32 vn = b2Dot(dv, normal);\n                var vn = b2Math_1.b2Vec2.DotVV(dv, normal);\n                var lambda = (-vcp.normalMass * (vn - vcp.velocityBias));\n                // b2Clamp the accumulated impulse\n                // float32 newImpulse = b2Max(vcp->normalImpulse + lambda, 0.0f);\n                var newImpulse = b2Math_1.b2Max(vcp.normalImpulse + lambda, 0);\n                lambda = newImpulse - vcp.normalImpulse;\n                vcp.normalImpulse = newImpulse;\n                // Apply contact impulse\n                // b2Vec2 P = lambda * normal;\n                b2Math_1.b2Vec2.MulSV(lambda, normal, P);\n                // vA -= mA * P;\n                vA.SelfMulSub(mA, P);\n                // wA -= iA * b2Cross(vcp->rA, P);\n                wA -= iA * b2Math_1.b2Vec2.CrossVV(vcp.rA, P);\n                // vB += mB * P;\n                vB.SelfMulAdd(mB, P);\n                // wB += iB * b2Cross(vcp->rB, P);\n                wB += iB * b2Math_1.b2Vec2.CrossVV(vcp.rB, P);\n            }\n            else {\n                // Block solver developed in collaboration with Dirk Gregorius (back in 01/07 on Box2D_Lite).\n                // Build the mini LCP for this contact patch\n                //\n                // vn = A * x + b, vn >= 0, , vn >= 0, x >= 0 and vn_i * x_i = 0 with i = 1..2\n                //\n                // A = J * W * JT and J = ( -n, -r1 x n, n, r2 x n )\n                // b = vn0 - velocityBias\n                //\n                // The system is solved using the \"Total enumeration method\" (s. Murty). The complementary constraint vn_i * x_i\n                // implies that we must have in any solution either vn_i = 0 or x_i = 0. So for the 2D contact problem the cases\n                // vn1 = 0 and vn2 = 0, x1 = 0 and x2 = 0, x1 = 0 and vn2 = 0, x2 = 0 and vn1 = 0 need to be tested. The first valid\n                // solution that satisfies the problem is chosen.\n                //\n                // In order to account of the accumulated impulse 'a' (because of the iterative nature of the solver which only requires\n                // that the accumulated impulse is clamped and not the incremental impulse) we change the impulse variable (x_i).\n                //\n                // Substitute:\n                //\n                // x = a + d\n                //\n                // a := old total impulse\n                // x := new total impulse\n                // d := incremental impulse\n                //\n                // For the current iteration we extend the formula for the incremental impulse\n                // to compute the new total impulse:\n                //\n                // vn = A * d + b\n                //    = A * (x - a) + b\n                //    = A * x + b - A * a\n                //    = A * x + b'\n                // b' = b - A * a;\n                var cp1 = vc.points[0];\n                var cp2 = vc.points[1];\n                // b2Vec2 a(cp1->normalImpulse, cp2->normalImpulse);\n                a.Set(cp1.normalImpulse, cp2.normalImpulse);\n                /// b2Assert(a.x >= 0 && a.y >= 0);\n                // Relative velocity at contact\n                // b2Vec2 dv1 = vB + b2Cross(wB, cp1->rB) - vA - b2Cross(wA, cp1->rA);\n                b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, cp1.rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, cp1.rA, b2Math_1.b2Vec2.s_t1), dv1);\n                // b2Vec2 dv2 = vB + b2Cross(wB, cp2->rB) - vA - b2Cross(wA, cp2->rA);\n                b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, cp2.rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, cp2.rA, b2Math_1.b2Vec2.s_t1), dv2);\n                // Compute normal velocity\n                // float32 vn1 = b2Dot(dv1, normal);\n                var vn1 = b2Math_1.b2Vec2.DotVV(dv1, normal);\n                // float32 vn2 = b2Dot(dv2, normal);\n                var vn2 = b2Math_1.b2Vec2.DotVV(dv2, normal);\n                // b2Vec2 b;\n                b.x = vn1 - cp1.velocityBias;\n                b.y = vn2 - cp2.velocityBias;\n                // Compute b'\n                // b -= b2Mul(vc->K, a);\n                b.SelfSub(b2Math_1.b2Mat22.MulMV(vc.K, a, b2Math_1.b2Vec2.s_t0));\n                /*\n                #if B2_DEBUG_SOLVER === 1\n                const k_errorTol: number = 0.001;\n                #endif\n                */\n                for (;;) {\n                    //\n                    // Case 1: vn = 0\n                    //\n                    // 0 = A * x + b'\n                    //\n                    // Solve for x:\n                    //\n                    // x = - inv(A) * b'\n                    //\n                    // b2Vec2 x = - b2Mul(vc->normalMass, b);\n                    b2Math_1.b2Mat22.MulMV(vc.normalMass, b, x).SelfNeg();\n                    if (x.x >= 0 && x.y >= 0) {\n                        // Get the incremental impulse\n                        // b2Vec2 d = x - a;\n                        b2Math_1.b2Vec2.SubVV(x, a, d);\n                        // Apply incremental impulse\n                        // b2Vec2 P1 = d.x * normal;\n                        b2Math_1.b2Vec2.MulSV(d.x, normal, P1);\n                        // b2Vec2 P2 = d.y * normal;\n                        b2Math_1.b2Vec2.MulSV(d.y, normal, P2);\n                        b2Math_1.b2Vec2.AddVV(P1, P2, P1P2);\n                        // vA -= mA * (P1 + P2);\n                        vA.SelfMulSub(mA, P1P2);\n                        // wA -= iA * (b2Cross(cp1->rA, P1) + b2Cross(cp2->rA, P2));\n                        wA -= iA * (b2Math_1.b2Vec2.CrossVV(cp1.rA, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rA, P2));\n                        // vB += mB * (P1 + P2);\n                        vB.SelfMulAdd(mB, P1P2);\n                        // wB += iB * (b2Cross(cp1->rB, P1) + b2Cross(cp2->rB, P2));\n                        wB += iB * (b2Math_1.b2Vec2.CrossVV(cp1.rB, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rB, P2));\n                        // Accumulate\n                        cp1.normalImpulse = x.x;\n                        cp2.normalImpulse = x.y;\n                        /*\n                        #if B2_DEBUG_SOLVER === 1\n                        // Postconditions\n                        dv1 = vB + b2Cross(wB, cp1->rB) - vA - b2Cross(wA, cp1->rA);\n                        dv2 = vB + b2Cross(wB, cp2->rB) - vA - b2Cross(wA, cp2->rA);\n            \n                        // Compute normal velocity\n                        vn1 = b2Dot(dv1, normal);\n                        vn2 = b2Dot(dv2, normal);\n            \n                        ///b2Assert(b2Abs(vn1 - cp1->velocityBias) < k_errorTol);\n                        ///b2Assert(b2Abs(vn2 - cp2->velocityBias) < k_errorTol);\n                        #endif\n                        */\n                        break;\n                    }\n                    //\n                    // Case 2: vn1 = 0 and x2 = 0\n                    //\n                    //   0 = a11 * x1 + a12 * 0 + b1'\n                    // vn2 = a21 * x1 + a22 * 0 + b2'\n                    //\n                    x.x = (-cp1.normalMass * b.x);\n                    x.y = 0;\n                    vn1 = 0;\n                    vn2 = vc.K.ex.y * x.x + b.y;\n                    if (x.x >= 0 && vn2 >= 0) {\n                        // Get the incremental impulse\n                        // b2Vec2 d = x - a;\n                        b2Math_1.b2Vec2.SubVV(x, a, d);\n                        // Apply incremental impulse\n                        // b2Vec2 P1 = d.x * normal;\n                        b2Math_1.b2Vec2.MulSV(d.x, normal, P1);\n                        // b2Vec2 P2 = d.y * normal;\n                        b2Math_1.b2Vec2.MulSV(d.y, normal, P2);\n                        b2Math_1.b2Vec2.AddVV(P1, P2, P1P2);\n                        // vA -= mA * (P1 + P2);\n                        vA.SelfMulSub(mA, P1P2);\n                        // wA -= iA * (b2Cross(cp1->rA, P1) + b2Cross(cp2->rA, P2));\n                        wA -= iA * (b2Math_1.b2Vec2.CrossVV(cp1.rA, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rA, P2));\n                        // vB += mB * (P1 + P2);\n                        vB.SelfMulAdd(mB, P1P2);\n                        // wB += iB * (b2Cross(cp1->rB, P1) + b2Cross(cp2->rB, P2));\n                        wB += iB * (b2Math_1.b2Vec2.CrossVV(cp1.rB, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rB, P2));\n                        // Accumulate\n                        cp1.normalImpulse = x.x;\n                        cp2.normalImpulse = x.y;\n                        /*\n                        #if B2_DEBUG_SOLVER === 1\n                        // Postconditions\n                        dv1 = vB + b2Cross(wB, cp1->rB) - vA - b2Cross(wA, cp1->rA);\n            \n                        // Compute normal velocity\n                        vn1 = b2Dot(dv1, normal);\n            \n                        ///b2Assert(b2Abs(vn1 - cp1->velocityBias) < k_errorTol);\n                        #endif\n                        */\n                        break;\n                    }\n                    //\n                    // Case 3: vn2 = 0 and x1 = 0\n                    //\n                    // vn1 = a11 * 0 + a12 * x2 + b1'\n                    //   0 = a21 * 0 + a22 * x2 + b2'\n                    //\n                    x.x = 0;\n                    x.y = (-cp2.normalMass * b.y);\n                    vn1 = vc.K.ey.x * x.y + b.x;\n                    vn2 = 0;\n                    if (x.y >= 0 && vn1 >= 0) {\n                        // Resubstitute for the incremental impulse\n                        // b2Vec2 d = x - a;\n                        b2Math_1.b2Vec2.SubVV(x, a, d);\n                        // Apply incremental impulse\n                        // b2Vec2 P1 = d.x * normal;\n                        b2Math_1.b2Vec2.MulSV(d.x, normal, P1);\n                        // b2Vec2 P2 = d.y * normal;\n                        b2Math_1.b2Vec2.MulSV(d.y, normal, P2);\n                        b2Math_1.b2Vec2.AddVV(P1, P2, P1P2);\n                        // vA -= mA * (P1 + P2);\n                        vA.SelfMulSub(mA, P1P2);\n                        // wA -= iA * (b2Cross(cp1->rA, P1) + b2Cross(cp2->rA, P2));\n                        wA -= iA * (b2Math_1.b2Vec2.CrossVV(cp1.rA, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rA, P2));\n                        // vB += mB * (P1 + P2);\n                        vB.SelfMulAdd(mB, P1P2);\n                        // wB += iB * (b2Cross(cp1->rB, P1) + b2Cross(cp2->rB, P2));\n                        wB += iB * (b2Math_1.b2Vec2.CrossVV(cp1.rB, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rB, P2));\n                        // Accumulate\n                        cp1.normalImpulse = x.x;\n                        cp2.normalImpulse = x.y;\n                        /*\n                        #if B2_DEBUG_SOLVER === 1\n                        // Postconditions\n                        dv2 = vB + b2Cross(wB, cp2->rB) - vA - b2Cross(wA, cp2->rA);\n            \n                        // Compute normal velocity\n                        vn2 = b2Dot(dv2, normal);\n            \n                        ///b2Assert(b2Abs(vn2 - cp2->velocityBias) < k_errorTol);\n                        #endif\n                        */\n                        break;\n                    }\n                    //\n                    // Case 4: x1 = 0 and x2 = 0\n                    //\n                    // vn1 = b1\n                    // vn2 = b2;\n                    x.x = 0;\n                    x.y = 0;\n                    vn1 = b.x;\n                    vn2 = b.y;\n                    if (vn1 >= 0 && vn2 >= 0) {\n                        // Resubstitute for the incremental impulse\n                        // b2Vec2 d = x - a;\n                        b2Math_1.b2Vec2.SubVV(x, a, d);\n                        // Apply incremental impulse\n                        // b2Vec2 P1 = d.x * normal;\n                        b2Math_1.b2Vec2.MulSV(d.x, normal, P1);\n                        // b2Vec2 P2 = d.y * normal;\n                        b2Math_1.b2Vec2.MulSV(d.y, normal, P2);\n                        b2Math_1.b2Vec2.AddVV(P1, P2, P1P2);\n                        // vA -= mA * (P1 + P2);\n                        vA.SelfMulSub(mA, P1P2);\n                        // wA -= iA * (b2Cross(cp1->rA, P1) + b2Cross(cp2->rA, P2));\n                        wA -= iA * (b2Math_1.b2Vec2.CrossVV(cp1.rA, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rA, P2));\n                        // vB += mB * (P1 + P2);\n                        vB.SelfMulAdd(mB, P1P2);\n                        // wB += iB * (b2Cross(cp1->rB, P1) + b2Cross(cp2->rB, P2));\n                        wB += iB * (b2Math_1.b2Vec2.CrossVV(cp1.rB, P1) + b2Math_1.b2Vec2.CrossVV(cp2.rB, P2));\n                        // Accumulate\n                        cp1.normalImpulse = x.x;\n                        cp2.normalImpulse = x.y;\n                        break;\n                    }\n                    // No solution, give up. This is hit sometimes, but it doesn't seem to matter.\n                    break;\n                }\n            }\n            // this.m_velocities[indexA].v = vA;\n            this.m_velocities[indexA].w = wA;\n            // this.m_velocities[indexB].v = vB;\n            this.m_velocities[indexB].w = wB;\n        }\n    };\n    b2ContactSolver.prototype.StoreImpulses = function () {\n        for (var i = 0; i < this.m_count; ++i) {\n            var vc = this.m_velocityConstraints[i];\n            var manifold = this.m_contacts[vc.contactIndex].GetManifold();\n            for (var j = 0; j < vc.pointCount; ++j) {\n                manifold.points[j].normalImpulse = vc.points[j].normalImpulse;\n                manifold.points[j].tangentImpulse = vc.points[j].tangentImpulse;\n            }\n        }\n    };\n    b2ContactSolver.prototype.SolvePositionConstraints = function () {\n        var xfA = b2ContactSolver.SolvePositionConstraints_s_xfA;\n        var xfB = b2ContactSolver.SolvePositionConstraints_s_xfB;\n        var psm = b2ContactSolver.SolvePositionConstraints_s_psm;\n        var rA = b2ContactSolver.SolvePositionConstraints_s_rA;\n        var rB = b2ContactSolver.SolvePositionConstraints_s_rB;\n        var P = b2ContactSolver.SolvePositionConstraints_s_P;\n        var minSeparation = 0;\n        for (var i = 0; i < this.m_count; ++i) {\n            var pc = this.m_positionConstraints[i];\n            var indexA = pc.indexA;\n            var indexB = pc.indexB;\n            var localCenterA = pc.localCenterA;\n            var mA = pc.invMassA;\n            var iA = pc.invIA;\n            var localCenterB = pc.localCenterB;\n            var mB = pc.invMassB;\n            var iB = pc.invIB;\n            var pointCount = pc.pointCount;\n            var cA = this.m_positions[indexA].c;\n            var aA = this.m_positions[indexA].a;\n            var cB = this.m_positions[indexB].c;\n            var aB = this.m_positions[indexB].a;\n            // Solve normal constraints\n            for (var j = 0; j < pointCount; ++j) {\n                xfA.q.SetAngle(aA);\n                xfB.q.SetAngle(aB);\n                b2Math_1.b2Vec2.SubVV(cA, b2Math_1.b2Rot.MulRV(xfA.q, localCenterA, b2Math_1.b2Vec2.s_t0), xfA.p);\n                b2Math_1.b2Vec2.SubVV(cB, b2Math_1.b2Rot.MulRV(xfB.q, localCenterB, b2Math_1.b2Vec2.s_t0), xfB.p);\n                psm.Initialize(pc, xfA, xfB, j);\n                var normal = psm.normal;\n                var point = psm.point;\n                var separation = psm.separation;\n                // b2Vec2 rA = point - cA;\n                b2Math_1.b2Vec2.SubVV(point, cA, rA);\n                // b2Vec2 rB = point - cB;\n                b2Math_1.b2Vec2.SubVV(point, cB, rB);\n                // Track max constraint error.\n                minSeparation = b2Math_1.b2Min(minSeparation, separation);\n                // Prevent large corrections and allow slop.\n                var C = b2Math_1.b2Clamp(b2Settings_1.b2_baumgarte * (separation + b2Settings_1.b2_linearSlop), (-b2Settings_1.b2_maxLinearCorrection), 0);\n                // Compute the effective mass.\n                // float32 rnA = b2Cross(rA, normal);\n                var rnA = b2Math_1.b2Vec2.CrossVV(rA, normal);\n                // float32 rnB = b2Cross(rB, normal);\n                var rnB = b2Math_1.b2Vec2.CrossVV(rB, normal);\n                // float32 K = mA + mB + iA * rnA * rnA + iB * rnB * rnB;\n                var K = mA + mB + iA * rnA * rnA + iB * rnB * rnB;\n                // Compute normal impulse\n                var impulse = K > 0 ? -C / K : 0;\n                // b2Vec2 P = impulse * normal;\n                b2Math_1.b2Vec2.MulSV(impulse, normal, P);\n                // cA -= mA * P;\n                cA.SelfMulSub(mA, P);\n                // aA -= iA * b2Cross(rA, P);\n                aA -= iA * b2Math_1.b2Vec2.CrossVV(rA, P);\n                // cB += mB * P;\n                cB.SelfMulAdd(mB, P);\n                // aB += iB * b2Cross(rB, P);\n                aB += iB * b2Math_1.b2Vec2.CrossVV(rB, P);\n            }\n            // this.m_positions[indexA].c = cA;\n            this.m_positions[indexA].a = aA;\n            // this.m_positions[indexB].c = cB;\n            this.m_positions[indexB].a = aB;\n        }\n        // We can't expect minSpeparation >= -b2_linearSlop because we don't\n        // push the separation above -b2_linearSlop.\n        return minSeparation > (-3 * b2Settings_1.b2_linearSlop);\n    };\n    b2ContactSolver.prototype.SolveTOIPositionConstraints = function (toiIndexA, toiIndexB) {\n        var xfA = b2ContactSolver.SolveTOIPositionConstraints_s_xfA;\n        var xfB = b2ContactSolver.SolveTOIPositionConstraints_s_xfB;\n        var psm = b2ContactSolver.SolveTOIPositionConstraints_s_psm;\n        var rA = b2ContactSolver.SolveTOIPositionConstraints_s_rA;\n        var rB = b2ContactSolver.SolveTOIPositionConstraints_s_rB;\n        var P = b2ContactSolver.SolveTOIPositionConstraints_s_P;\n        var minSeparation = 0;\n        for (var i = 0; i < this.m_count; ++i) {\n            var pc = this.m_positionConstraints[i];\n            var indexA = pc.indexA;\n            var indexB = pc.indexB;\n            var localCenterA = pc.localCenterA;\n            var localCenterB = pc.localCenterB;\n            var pointCount = pc.pointCount;\n            var mA = 0;\n            var iA = 0;\n            if (indexA === toiIndexA || indexA === toiIndexB) {\n                mA = pc.invMassA;\n                iA = pc.invIA;\n            }\n            var mB = 0;\n            var iB = 0;\n            if (indexB === toiIndexA || indexB === toiIndexB) {\n                mB = pc.invMassB;\n                iB = pc.invIB;\n            }\n            var cA = this.m_positions[indexA].c;\n            var aA = this.m_positions[indexA].a;\n            var cB = this.m_positions[indexB].c;\n            var aB = this.m_positions[indexB].a;\n            // Solve normal constraints\n            for (var j = 0; j < pointCount; ++j) {\n                xfA.q.SetAngle(aA);\n                xfB.q.SetAngle(aB);\n                b2Math_1.b2Vec2.SubVV(cA, b2Math_1.b2Rot.MulRV(xfA.q, localCenterA, b2Math_1.b2Vec2.s_t0), xfA.p);\n                b2Math_1.b2Vec2.SubVV(cB, b2Math_1.b2Rot.MulRV(xfB.q, localCenterB, b2Math_1.b2Vec2.s_t0), xfB.p);\n                psm.Initialize(pc, xfA, xfB, j);\n                var normal = psm.normal;\n                var point = psm.point;\n                var separation = psm.separation;\n                // b2Vec2 rA = point - cA;\n                b2Math_1.b2Vec2.SubVV(point, cA, rA);\n                // b2Vec2 rB = point - cB;\n                b2Math_1.b2Vec2.SubVV(point, cB, rB);\n                // Track max constraint error.\n                minSeparation = b2Math_1.b2Min(minSeparation, separation);\n                // Prevent large corrections and allow slop.\n                var C = b2Math_1.b2Clamp(b2Settings_1.b2_toiBaumgarte * (separation + b2Settings_1.b2_linearSlop), (-b2Settings_1.b2_maxLinearCorrection), 0);\n                // Compute the effective mass.\n                // float32 rnA = b2Cross(rA, normal);\n                var rnA = b2Math_1.b2Vec2.CrossVV(rA, normal);\n                // float32 rnB = b2Cross(rB, normal);\n                var rnB = b2Math_1.b2Vec2.CrossVV(rB, normal);\n                // float32 K = mA + mB + iA * rnA * rnA + iB * rnB * rnB;\n                var K = mA + mB + iA * rnA * rnA + iB * rnB * rnB;\n                // Compute normal impulse\n                var impulse = K > 0 ? -C / K : 0;\n                // b2Vec2 P = impulse * normal;\n                b2Math_1.b2Vec2.MulSV(impulse, normal, P);\n                // cA -= mA * P;\n                cA.SelfMulSub(mA, P);\n                // aA -= iA * b2Cross(rA, P);\n                aA -= iA * b2Math_1.b2Vec2.CrossVV(rA, P);\n                // cB += mB * P;\n                cB.SelfMulAdd(mB, P);\n                // aB += iB * b2Cross(rB, P);\n                aB += iB * b2Math_1.b2Vec2.CrossVV(rB, P);\n            }\n            // this.m_positions[indexA].c = cA;\n            this.m_positions[indexA].a = aA;\n            // this.m_positions[indexB].c = cB;\n            this.m_positions[indexB].a = aB;\n        }\n        // We can't expect minSpeparation >= -b2_linearSlop because we don't\n        // push the separation above -b2_linearSlop.\n        return minSeparation >= -1.5 * b2Settings_1.b2_linearSlop;\n    };\n    b2ContactSolver.InitializeVelocityConstraints_s_xfA = new b2Math_1.b2Transform();\n    b2ContactSolver.InitializeVelocityConstraints_s_xfB = new b2Math_1.b2Transform();\n    b2ContactSolver.InitializeVelocityConstraints_s_worldManifold = new b2Collision_2.b2WorldManifold();\n    b2ContactSolver.WarmStart_s_P = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_dv = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_dv1 = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_dv2 = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_a = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_b = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_x = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_d = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_P1 = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_P2 = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveVelocityConstraints_s_P1P2 = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolvePositionConstraints_s_xfA = new b2Math_1.b2Transform();\n    b2ContactSolver.SolvePositionConstraints_s_xfB = new b2Math_1.b2Transform();\n    b2ContactSolver.SolvePositionConstraints_s_psm = new b2PositionSolverManifold();\n    b2ContactSolver.SolvePositionConstraints_s_rA = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolvePositionConstraints_s_rB = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveTOIPositionConstraints_s_xfA = new b2Math_1.b2Transform();\n    b2ContactSolver.SolveTOIPositionConstraints_s_xfB = new b2Math_1.b2Transform();\n    b2ContactSolver.SolveTOIPositionConstraints_s_psm = new b2PositionSolverManifold();\n    b2ContactSolver.SolveTOIPositionConstraints_s_rA = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveTOIPositionConstraints_s_rB = new b2Math_1.b2Vec2();\n    b2ContactSolver.SolveTOIPositionConstraints_s_P = new b2Math_1.b2Vec2();\n    return b2ContactSolver;\n}());\nexports.b2ContactSolver = b2ContactSolver;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2ContactSolver.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2EdgeAndCircleContact.ts":
/*!***************************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2EdgeAndCircleContact.ts ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideEdge_1 = __webpack_require__(/*! ../../Collision/b2CollideEdge */ \"./src/Box2D/Collision/b2CollideEdge.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2EdgeAndCircleContact = /** @class */ (function (_super) {\n    __extends(b2EdgeAndCircleContact, _super);\n    function b2EdgeAndCircleContact() {\n        return _super.call(this) || this;\n    }\n    b2EdgeAndCircleContact.Create = function (allocator) {\n        return new b2EdgeAndCircleContact();\n    };\n    b2EdgeAndCircleContact.Destroy = function (contact, allocator) {\n    };\n    b2EdgeAndCircleContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n        /// b2Assert(fixtureA.GetType() === b2ShapeType.e_edgeShape);\n        /// b2Assert(fixtureB.GetType() === b2ShapeType.e_circleShape);\n    };\n    b2EdgeAndCircleContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2EdgeShape);\n        /// b2Assert(shapeB instanceof b2CircleShape);\n        b2CollideEdge_1.b2CollideEdgeAndCircle(manifold, shapeA, xfA, shapeB, xfB);\n    };\n    return b2EdgeAndCircleContact;\n}(b2Contact_1.b2Contact));\nexports.b2EdgeAndCircleContact = b2EdgeAndCircleContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2EdgeAndCircleContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2EdgeAndPolygonContact.ts":
/*!****************************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2EdgeAndPolygonContact.ts ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideEdge_1 = __webpack_require__(/*! ../../Collision/b2CollideEdge */ \"./src/Box2D/Collision/b2CollideEdge.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2EdgeAndPolygonContact = /** @class */ (function (_super) {\n    __extends(b2EdgeAndPolygonContact, _super);\n    function b2EdgeAndPolygonContact() {\n        return _super.call(this) || this;\n    }\n    b2EdgeAndPolygonContact.Create = function (allocator) {\n        return new b2EdgeAndPolygonContact();\n    };\n    b2EdgeAndPolygonContact.Destroy = function (contact, allocator) {\n    };\n    b2EdgeAndPolygonContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n        /// b2Assert(fixtureA.GetType() === b2ShapeType.e_edgeShape);\n        /// b2Assert(fixtureB.GetType() === b2ShapeType.e_polygonShape);\n    };\n    b2EdgeAndPolygonContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2EdgeShape);\n        /// b2Assert(shapeB instanceof b2PolygonShape);\n        b2CollideEdge_1.b2CollideEdgeAndPolygon(manifold, shapeA, xfA, shapeB, xfB);\n    };\n    return b2EdgeAndPolygonContact;\n}(b2Contact_1.b2Contact));\nexports.b2EdgeAndPolygonContact = b2EdgeAndPolygonContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2EdgeAndPolygonContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2PolygonAndCircleContact.ts":
/*!******************************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2PolygonAndCircleContact.ts ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollideCircle_1 = __webpack_require__(/*! ../../Collision/b2CollideCircle */ \"./src/Box2D/Collision/b2CollideCircle.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2PolygonAndCircleContact = /** @class */ (function (_super) {\n    __extends(b2PolygonAndCircleContact, _super);\n    function b2PolygonAndCircleContact() {\n        return _super.call(this) || this;\n    }\n    b2PolygonAndCircleContact.Create = function (allocator) {\n        return new b2PolygonAndCircleContact();\n    };\n    b2PolygonAndCircleContact.Destroy = function (contact, allocator) {\n    };\n    b2PolygonAndCircleContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n        /// b2Assert(fixtureA.GetType() === b2ShapeType.e_polygonShape);\n        /// b2Assert(fixtureB.GetType() === b2ShapeType.e_circleShape);\n    };\n    b2PolygonAndCircleContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2PolygonShape);\n        /// b2Assert(shapeB instanceof b2CircleShape);\n        b2CollideCircle_1.b2CollidePolygonAndCircle(manifold, shapeA, xfA, shapeB, xfB);\n    };\n    return b2PolygonAndCircleContact;\n}(b2Contact_1.b2Contact));\nexports.b2PolygonAndCircleContact = b2PolygonAndCircleContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2PolygonAndCircleContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Contacts/b2PolygonContact.ts":
/*!*********************************************************!*\
  !*** ./src/Box2D/Dynamics/Contacts/b2PolygonContact.ts ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2CollidePolygon_1 = __webpack_require__(/*! ../../Collision/b2CollidePolygon */ \"./src/Box2D/Collision/b2CollidePolygon.ts\");\nvar b2Contact_1 = __webpack_require__(/*! ./b2Contact */ \"./src/Box2D/Dynamics/Contacts/b2Contact.ts\");\nvar b2PolygonContact = /** @class */ (function (_super) {\n    __extends(b2PolygonContact, _super);\n    function b2PolygonContact() {\n        return _super.call(this) || this;\n    }\n    b2PolygonContact.Create = function (allocator) {\n        return new b2PolygonContact();\n    };\n    b2PolygonContact.Destroy = function (contact, allocator) {\n    };\n    b2PolygonContact.prototype.Reset = function (fixtureA, indexA, fixtureB, indexB) {\n        _super.prototype.Reset.call(this, fixtureA, indexA, fixtureB, indexB);\n    };\n    b2PolygonContact.prototype.Evaluate = function (manifold, xfA, xfB) {\n        var shapeA = this.m_fixtureA.GetShape();\n        var shapeB = this.m_fixtureB.GetShape();\n        /// b2Assert(shapeA instanceof b2PolygonShape);\n        /// b2Assert(shapeB instanceof b2PolygonShape);\n        b2CollidePolygon_1.b2CollidePolygons(manifold, shapeA, xfA, shapeB, xfB);\n    };\n    return b2PolygonContact;\n}(b2Contact_1.b2Contact));\nexports.b2PolygonContact = b2PolygonContact;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Contacts/b2PolygonContact.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2AreaJoint.ts":
/*!**************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2AreaJoint.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2DistanceJoint_1 = __webpack_require__(/*! ./b2DistanceJoint */ \"./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\nvar b2AreaJointDef = /** @class */ (function (_super) {\n    __extends(b2AreaJointDef, _super);\n    function b2AreaJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_areaJoint) || this;\n        _this.world = null;\n        _this.bodies = [];\n        _this.frequencyHz = 0;\n        _this.dampingRatio = 0;\n        return _this;\n    }\n    b2AreaJointDef.prototype.AddBody = function (body) {\n        this.bodies.push(body);\n        if (this.bodies.length === 1) {\n            this.bodyA = body;\n        }\n        else if (this.bodies.length === 2) {\n            this.bodyB = body;\n        }\n    };\n    return b2AreaJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2AreaJointDef = b2AreaJointDef;\nvar b2AreaJoint = /** @class */ (function (_super) {\n    __extends(b2AreaJoint, _super);\n    function b2AreaJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_bodies = null;\n        _this.m_frequencyHz = 0;\n        _this.m_dampingRatio = 0;\n        // Solver shared\n        _this.m_impulse = 0;\n        // Solver temp\n        _this.m_targetLengths = null;\n        _this.m_targetArea = 0;\n        _this.m_normals = null;\n        _this.m_joints = null;\n        _this.m_deltas = null;\n        _this.m_delta = null;\n        /// b2Assert(def.bodies.length >= 3, \"You cannot create an area joint with less than three bodies.\");\n        _this.m_bodies = def.bodies;\n        _this.m_frequencyHz = def.frequencyHz;\n        _this.m_dampingRatio = def.dampingRatio;\n        _this.m_targetLengths = b2Settings_1.b2MakeNumberArray(def.bodies.length);\n        _this.m_normals = b2Math_1.b2Vec2.MakeArray(def.bodies.length);\n        _this.m_joints = b2Settings_1.b2MakeNullArray(def.bodies.length);\n        _this.m_deltas = b2Math_1.b2Vec2.MakeArray(def.bodies.length);\n        _this.m_delta = new b2Math_1.b2Vec2();\n        var djd = new b2DistanceJoint_1.b2DistanceJointDef();\n        djd.frequencyHz = def.frequencyHz;\n        djd.dampingRatio = def.dampingRatio;\n        _this.m_targetArea = 0;\n        for (var i = 0; i < _this.m_bodies.length; ++i) {\n            var body = _this.m_bodies[i];\n            var next = _this.m_bodies[(i + 1) % _this.m_bodies.length];\n            var body_c = body.GetWorldCenter();\n            var next_c = next.GetWorldCenter();\n            _this.m_targetLengths[i] = b2Math_1.b2Vec2.DistanceVV(body_c, next_c);\n            _this.m_targetArea += b2Math_1.b2Vec2.CrossVV(body_c, next_c);\n            djd.Initialize(body, next, body_c, next_c);\n            _this.m_joints[i] = def.world.CreateJoint(djd);\n        }\n        _this.m_targetArea *= 0.5;\n        return _this;\n    }\n    b2AreaJoint.prototype.GetAnchorA = function (out) {\n        return out.SetZero();\n    };\n    b2AreaJoint.prototype.GetAnchorB = function (out) {\n        return out.SetZero();\n    };\n    b2AreaJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        return out.SetZero();\n    };\n    b2AreaJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    b2AreaJoint.prototype.SetFrequency = function (hz) {\n        this.m_frequencyHz = hz;\n        // tslint:disable-next-line:prefer-for-of\n        for (var i = 0; i < this.m_joints.length; ++i) {\n            this.m_joints[i].SetFrequency(hz);\n        }\n    };\n    b2AreaJoint.prototype.GetFrequency = function () {\n        return this.m_frequencyHz;\n    };\n    b2AreaJoint.prototype.SetDampingRatio = function (ratio) {\n        this.m_dampingRatio = ratio;\n        // tslint:disable-next-line:prefer-for-of\n        for (var i = 0; i < this.m_joints.length; ++i) {\n            this.m_joints[i].SetDampingRatio(ratio);\n        }\n    };\n    b2AreaJoint.prototype.GetDampingRatio = function () {\n        return this.m_dampingRatio;\n    };\n    b2AreaJoint.prototype.Dump = function (log) {\n        log(\"Area joint dumping is not supported.\\n\");\n    };\n    b2AreaJoint.prototype.InitVelocityConstraints = function (data) {\n        for (var i = 0; i < this.m_bodies.length; ++i) {\n            var prev = this.m_bodies[(i + this.m_bodies.length - 1) % this.m_bodies.length];\n            var next = this.m_bodies[(i + 1) % this.m_bodies.length];\n            var prev_c = data.positions[prev.m_islandIndex].c;\n            var next_c = data.positions[next.m_islandIndex].c;\n            var delta = this.m_deltas[i];\n            b2Math_1.b2Vec2.SubVV(next_c, prev_c, delta);\n        }\n        if (data.step.warmStarting) {\n            this.m_impulse *= data.step.dtRatio;\n            for (var i = 0; i < this.m_bodies.length; ++i) {\n                var body = this.m_bodies[i];\n                var body_v = data.velocities[body.m_islandIndex].v;\n                var delta = this.m_deltas[i];\n                body_v.x += body.m_invMass * delta.y * 0.5 * this.m_impulse;\n                body_v.y += body.m_invMass * -delta.x * 0.5 * this.m_impulse;\n            }\n        }\n        else {\n            this.m_impulse = 0;\n        }\n    };\n    b2AreaJoint.prototype.SolveVelocityConstraints = function (data) {\n        var dotMassSum = 0;\n        var crossMassSum = 0;\n        for (var i = 0; i < this.m_bodies.length; ++i) {\n            var body = this.m_bodies[i];\n            var body_v = data.velocities[body.m_islandIndex].v;\n            var delta = this.m_deltas[i];\n            dotMassSum += delta.LengthSquared() / body.GetMass();\n            crossMassSum += b2Math_1.b2Vec2.CrossVV(body_v, delta);\n        }\n        var lambda = -2 * crossMassSum / dotMassSum;\n        // lambda = b2Clamp(lambda, -b2_maxLinearCorrection, b2_maxLinearCorrection);\n        this.m_impulse += lambda;\n        for (var i = 0; i < this.m_bodies.length; ++i) {\n            var body = this.m_bodies[i];\n            var body_v = data.velocities[body.m_islandIndex].v;\n            var delta = this.m_deltas[i];\n            body_v.x += body.m_invMass * delta.y * 0.5 * lambda;\n            body_v.y += body.m_invMass * -delta.x * 0.5 * lambda;\n        }\n    };\n    b2AreaJoint.prototype.SolvePositionConstraints = function (data) {\n        var perimeter = 0;\n        var area = 0;\n        for (var i = 0; i < this.m_bodies.length; ++i) {\n            var body = this.m_bodies[i];\n            var next = this.m_bodies[(i + 1) % this.m_bodies.length];\n            var body_c = data.positions[body.m_islandIndex].c;\n            var next_c = data.positions[next.m_islandIndex].c;\n            var delta = b2Math_1.b2Vec2.SubVV(next_c, body_c, this.m_delta);\n            var dist = delta.Length();\n            if (dist < b2Settings_1.b2_epsilon) {\n                dist = 1;\n            }\n            this.m_normals[i].x = delta.y / dist;\n            this.m_normals[i].y = -delta.x / dist;\n            perimeter += dist;\n            area += b2Math_1.b2Vec2.CrossVV(body_c, next_c);\n        }\n        area *= 0.5;\n        var deltaArea = this.m_targetArea - area;\n        var toExtrude = 0.5 * deltaArea / perimeter;\n        var done = true;\n        for (var i = 0; i < this.m_bodies.length; ++i) {\n            var body = this.m_bodies[i];\n            var body_c = data.positions[body.m_islandIndex].c;\n            var next_i = (i + 1) % this.m_bodies.length;\n            var delta = b2Math_1.b2Vec2.AddVV(this.m_normals[i], this.m_normals[next_i], this.m_delta);\n            delta.SelfMul(toExtrude);\n            var norm_sq = delta.LengthSquared();\n            if (norm_sq > b2Math_1.b2Sq(b2Settings_1.b2_maxLinearCorrection)) {\n                delta.SelfMul(b2Settings_1.b2_maxLinearCorrection / b2Math_1.b2Sqrt(norm_sq));\n            }\n            if (norm_sq > b2Math_1.b2Sq(b2Settings_1.b2_linearSlop)) {\n                done = false;\n            }\n            body_c.x += delta.x;\n            body_c.y += delta.y;\n        }\n        return done;\n    };\n    return b2AreaJoint;\n}(b2Joint_1.b2Joint));\nexports.b2AreaJoint = b2AreaJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2AreaJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts":
/*!******************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2007 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Distance joint definition. This requires defining an\n/// anchor point on both bodies and the non-zero length of the\n/// distance joint. The definition uses local anchor points\n/// so that the initial configuration can violate the constraint\n/// slightly. This helps when saving and loading a game.\n/// @warning Do not use a zero or short length.\nvar b2DistanceJointDef = /** @class */ (function (_super) {\n    __extends(b2DistanceJointDef, _super);\n    function b2DistanceJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_distanceJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2();\n        _this.localAnchorB = new b2Math_1.b2Vec2();\n        _this.length = 1;\n        _this.frequencyHz = 0;\n        _this.dampingRatio = 0;\n        return _this;\n    }\n    b2DistanceJointDef.prototype.Initialize = function (b1, b2, anchor1, anchor2) {\n        this.bodyA = b1;\n        this.bodyB = b2;\n        this.bodyA.GetLocalPoint(anchor1, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor2, this.localAnchorB);\n        this.length = b2Math_1.b2Vec2.DistanceVV(anchor1, anchor2);\n        this.frequencyHz = 0;\n        this.dampingRatio = 0;\n    };\n    return b2DistanceJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2DistanceJointDef = b2DistanceJointDef;\nvar b2DistanceJoint = /** @class */ (function (_super) {\n    __extends(b2DistanceJoint, _super);\n    function b2DistanceJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_frequencyHz = 0;\n        _this.m_dampingRatio = 0;\n        _this.m_bias = 0;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_gamma = 0;\n        _this.m_impulse = 0;\n        _this.m_length = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_u = new b2Math_1.b2Vec2();\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_frequencyHz = def.frequencyHz;\n        _this.m_dampingRatio = def.dampingRatio;\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_length = def.length;\n        return _this;\n    }\n    b2DistanceJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2DistanceJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2DistanceJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        return out.Set(inv_dt * this.m_impulse * this.m_u.x, inv_dt * this.m_impulse * this.m_u.y);\n    };\n    b2DistanceJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    b2DistanceJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2DistanceJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2DistanceJoint.prototype.SetLength = function (length) {\n        this.m_length = length;\n    };\n    b2DistanceJoint.prototype.Length = function () {\n        return this.m_length;\n    };\n    b2DistanceJoint.prototype.SetFrequency = function (hz) {\n        this.m_frequencyHz = hz;\n    };\n    b2DistanceJoint.prototype.GetFrequency = function () {\n        return this.m_frequencyHz;\n    };\n    b2DistanceJoint.prototype.SetDampingRatio = function (ratio) {\n        this.m_dampingRatio = ratio;\n    };\n    b2DistanceJoint.prototype.GetDampingRatio = function () {\n        return this.m_dampingRatio;\n    };\n    b2DistanceJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2DistanceJointDef = new b2DistanceJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.length = %.15f;\\n\", this.m_length);\n        log(\"  jd.frequencyHz = %.15f;\\n\", this.m_frequencyHz);\n        log(\"  jd.dampingRatio = %.15f;\\n\", this.m_dampingRatio);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2DistanceJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // const qA: b2Rot = new b2Rot(aA), qB: b2Rot = new b2Rot(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // m_u = cB + m_rB - cA - m_rA;\n        this.m_u.x = cB.x + this.m_rB.x - cA.x - this.m_rA.x;\n        this.m_u.y = cB.y + this.m_rB.y - cA.y - this.m_rA.y;\n        // Handle singularity.\n        var length = this.m_u.Length();\n        if (length > b2Settings_1.b2_linearSlop) {\n            this.m_u.SelfMul(1 / length);\n        }\n        else {\n            this.m_u.SetZero();\n        }\n        // float32 crAu = b2Cross(m_rA, m_u);\n        var crAu = b2Math_1.b2Vec2.CrossVV(this.m_rA, this.m_u);\n        // float32 crBu = b2Cross(m_rB, m_u);\n        var crBu = b2Math_1.b2Vec2.CrossVV(this.m_rB, this.m_u);\n        // float32 invMass = m_invMassA + m_invIA * crAu * crAu + m_invMassB + m_invIB * crBu * crBu;\n        var invMass = this.m_invMassA + this.m_invIA * crAu * crAu + this.m_invMassB + this.m_invIB * crBu * crBu;\n        // Compute the effective mass matrix.\n        this.m_mass = invMass !== 0 ? 1 / invMass : 0;\n        if (this.m_frequencyHz > 0) {\n            var C = length - this.m_length;\n            // Frequency\n            var omega = 2 * b2Settings_1.b2_pi * this.m_frequencyHz;\n            // Damping coefficient\n            var d = 2 * this.m_mass * this.m_dampingRatio * omega;\n            // Spring stiffness\n            var k = this.m_mass * omega * omega;\n            // magic formulas\n            var h = data.step.dt;\n            this.m_gamma = h * (d + h * k);\n            this.m_gamma = this.m_gamma !== 0 ? 1 / this.m_gamma : 0;\n            this.m_bias = C * h * k * this.m_gamma;\n            invMass += this.m_gamma;\n            this.m_mass = invMass !== 0 ? 1 / invMass : 0;\n        }\n        else {\n            this.m_gamma = 0;\n            this.m_bias = 0;\n        }\n        if (data.step.warmStarting) {\n            // Scale the impulse to support a variable time step.\n            this.m_impulse *= data.step.dtRatio;\n            // b2Vec2 P = m_impulse * m_u;\n            var P = b2Math_1.b2Vec2.MulSV(this.m_impulse, this.m_u, b2DistanceJoint.InitVelocityConstraints_s_P);\n            // vA -= m_invMassA * P;\n            vA.SelfMulSub(this.m_invMassA, P);\n            // wA -= m_invIA * b2Cross(m_rA, P);\n            wA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, P);\n            // vB += m_invMassB * P;\n            vB.SelfMulAdd(this.m_invMassB, P);\n            // wB += m_invIB * b2Cross(m_rB, P);\n            wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, P);\n        }\n        else {\n            this.m_impulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2DistanceJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // b2Vec2 vpA = vA + b2Cross(wA, m_rA);\n        var vpA = b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2DistanceJoint.SolveVelocityConstraints_s_vpA);\n        // b2Vec2 vpB = vB + b2Cross(wB, m_rB);\n        var vpB = b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2DistanceJoint.SolveVelocityConstraints_s_vpB);\n        // float32 Cdot = b2Dot(m_u, vpB - vpA);\n        var Cdot = b2Math_1.b2Vec2.DotVV(this.m_u, b2Math_1.b2Vec2.SubVV(vpB, vpA, b2Math_1.b2Vec2.s_t0));\n        var impulse = (-this.m_mass * (Cdot + this.m_bias + this.m_gamma * this.m_impulse));\n        this.m_impulse += impulse;\n        // b2Vec2 P = impulse * m_u;\n        var P = b2Math_1.b2Vec2.MulSV(impulse, this.m_u, b2DistanceJoint.SolveVelocityConstraints_s_P);\n        // vA -= m_invMassA * P;\n        vA.SelfMulSub(this.m_invMassA, P);\n        // wA -= m_invIA * b2Cross(m_rA, P);\n        wA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, P);\n        // vB += m_invMassB * P;\n        vB.SelfMulAdd(this.m_invMassB, P);\n        // wB += m_invIB * b2Cross(m_rB, P);\n        wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, P);\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2DistanceJoint.prototype.SolvePositionConstraints = function (data) {\n        if (this.m_frequencyHz > 0) {\n            // There is no position correction for soft distance constraints.\n            return true;\n        }\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        // const qA: b2Rot = new b2Rot(aA), qB: b2Rot = new b2Rot(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        var rA = b2Math_1.b2Rot.MulRV(this.m_qA, this.m_lalcA, this.m_rA); // use m_rA\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        var rB = b2Math_1.b2Rot.MulRV(this.m_qB, this.m_lalcB, this.m_rB); // use m_rB\n        // b2Vec2 u = cB + rB - cA - rA;\n        var u = this.m_u; // use m_u\n        u.x = cB.x + rB.x - cA.x - rA.x;\n        u.y = cB.y + rB.y - cA.y - rA.y;\n        // float32 length = u.Normalize();\n        var length = this.m_u.Normalize();\n        // float32 C = length - m_length;\n        var C = length - this.m_length;\n        C = b2Math_1.b2Clamp(C, (-b2Settings_1.b2_maxLinearCorrection), b2Settings_1.b2_maxLinearCorrection);\n        var impulse = (-this.m_mass * C);\n        // b2Vec2 P = impulse * u;\n        var P = b2Math_1.b2Vec2.MulSV(impulse, u, b2DistanceJoint.SolvePositionConstraints_s_P);\n        // cA -= m_invMassA * P;\n        cA.SelfMulSub(this.m_invMassA, P);\n        // aA -= m_invIA * b2Cross(rA, P);\n        aA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(rA, P);\n        // cB += m_invMassB * P;\n        cB.SelfMulAdd(this.m_invMassB, P);\n        // aB += m_invIB * b2Cross(rB, P);\n        aB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(rB, P);\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return b2Math_1.b2Abs(C) < b2Settings_1.b2_linearSlop;\n    };\n    b2DistanceJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2DistanceJoint.SolveVelocityConstraints_s_vpA = new b2Math_1.b2Vec2();\n    b2DistanceJoint.SolveVelocityConstraints_s_vpB = new b2Math_1.b2Vec2();\n    b2DistanceJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2DistanceJoint.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    return b2DistanceJoint;\n}(b2Joint_1.b2Joint));\nexports.b2DistanceJoint = b2DistanceJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2FrictionJoint.ts":
/*!******************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2FrictionJoint.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2007 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Friction joint definition.\nvar b2FrictionJointDef = /** @class */ (function (_super) {\n    __extends(b2FrictionJointDef, _super);\n    function b2FrictionJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_frictionJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2();\n        _this.localAnchorB = new b2Math_1.b2Vec2();\n        _this.maxForce = 0;\n        _this.maxTorque = 0;\n        return _this;\n    }\n    b2FrictionJointDef.prototype.Initialize = function (bA, bB, anchor) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.bodyA.GetLocalPoint(anchor, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor, this.localAnchorB);\n    };\n    return b2FrictionJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2FrictionJointDef = b2FrictionJointDef;\nvar b2FrictionJoint = /** @class */ (function (_super) {\n    __extends(b2FrictionJoint, _super);\n    function b2FrictionJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        // Solver shared\n        _this.m_linearImpulse = new b2Math_1.b2Vec2();\n        _this.m_angularImpulse = 0;\n        _this.m_maxForce = 0;\n        _this.m_maxTorque = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_linearMass = new b2Math_1.b2Mat22();\n        _this.m_angularMass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_K = new b2Math_1.b2Mat22();\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_linearImpulse.SetZero();\n        _this.m_maxForce = def.maxForce;\n        _this.m_maxTorque = def.maxTorque;\n        _this.m_linearMass.SetZero();\n        return _this;\n    }\n    b2FrictionJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        // const cA: b2Vec2 = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        // const cB: b2Vec2 = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // const qA: b2Rot = new b2Rot(aA), qB: b2Rot = new b2Rot(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // Compute the effective mass matrix.\n        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // J = [-I -r1_skew I r2_skew]\n        //     [ 0       -1 0       1]\n        // r_skew = [-ry; rx]\n        // Matlab\n        // K = [ mA+r1y^2*iA+mB+r2y^2*iB,  -r1y*iA*r1x-r2y*iB*r2x,          -r1y*iA-r2y*iB]\n        //     [  -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB,           r1x*iA+r2x*iB]\n        //     [          -r1y*iA-r2y*iB,           r1x*iA+r2x*iB,                   iA+iB]\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var K = this.m_K; // new b2Mat22();\n        K.ex.x = mA + mB + iA * rA.y * rA.y + iB * rB.y * rB.y;\n        K.ex.y = -iA * rA.x * rA.y - iB * rB.x * rB.y;\n        K.ey.x = K.ex.y;\n        K.ey.y = mA + mB + iA * rA.x * rA.x + iB * rB.x * rB.x;\n        K.GetInverse(this.m_linearMass);\n        this.m_angularMass = iA + iB;\n        if (this.m_angularMass > 0) {\n            this.m_angularMass = 1 / this.m_angularMass;\n        }\n        if (data.step.warmStarting) {\n            // Scale impulses to support a variable time step.\n            // m_linearImpulse *= data.step.dtRatio;\n            this.m_linearImpulse.SelfMul(data.step.dtRatio);\n            this.m_angularImpulse *= data.step.dtRatio;\n            // const P: b2Vec2(m_linearImpulse.x, m_linearImpulse.y);\n            var P = this.m_linearImpulse;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            // wA -= iA * (b2Cross(m_rA, P) + m_angularImpulse);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + this.m_angularImpulse);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            // wB += iB * (b2Cross(m_rB, P) + m_angularImpulse);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + this.m_angularImpulse);\n        }\n        else {\n            this.m_linearImpulse.SetZero();\n            this.m_angularImpulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2FrictionJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var h = data.step.dt;\n        // Solve angular friction\n        {\n            var Cdot = wB - wA;\n            var impulse = (-this.m_angularMass * Cdot);\n            var oldImpulse = this.m_angularImpulse;\n            var maxImpulse = h * this.m_maxTorque;\n            this.m_angularImpulse = b2Math_1.b2Clamp(this.m_angularImpulse + impulse, (-maxImpulse), maxImpulse);\n            impulse = this.m_angularImpulse - oldImpulse;\n            wA -= iA * impulse;\n            wB += iB * impulse;\n        }\n        // Solve linear friction\n        {\n            // b2Vec2 Cdot = vB + b2Cross(wB, m_rB) - vA - b2Cross(wA, m_rA);\n            var Cdot_v2 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2Math_1.b2Vec2.s_t1), b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2);\n            // b2Vec2 impulse = -b2Mul(m_linearMass, Cdot);\n            var impulseV = b2Math_1.b2Mat22.MulMV(this.m_linearMass, Cdot_v2, b2FrictionJoint.SolveVelocityConstraints_s_impulseV).SelfNeg();\n            // b2Vec2 oldImpulse = m_linearImpulse;\n            var oldImpulseV = b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);\n            // m_linearImpulse += impulse;\n            this.m_linearImpulse.SelfAdd(impulseV);\n            var maxImpulse = h * this.m_maxForce;\n            if (this.m_linearImpulse.LengthSquared() > maxImpulse * maxImpulse) {\n                this.m_linearImpulse.Normalize();\n                this.m_linearImpulse.SelfMul(maxImpulse);\n            }\n            // impulse = m_linearImpulse - oldImpulse;\n            b2Math_1.b2Vec2.SubVV(this.m_linearImpulse, oldImpulseV, impulseV);\n            // vA -= mA * impulse;\n            vA.SelfMulSub(mA, impulseV);\n            // wA -= iA * b2Cross(m_rA, impulse);\n            wA -= iA * b2Math_1.b2Vec2.CrossVV(this.m_rA, impulseV);\n            // vB += mB * impulse;\n            vB.SelfMulAdd(mB, impulseV);\n            // wB += iB * b2Cross(m_rB, impulse);\n            wB += iB * b2Math_1.b2Vec2.CrossVV(this.m_rB, impulseV);\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2FrictionJoint.prototype.SolvePositionConstraints = function (data) {\n        return true;\n    };\n    b2FrictionJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2FrictionJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2FrictionJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        return out.Set(inv_dt * this.m_linearImpulse.x, inv_dt * this.m_linearImpulse.y);\n    };\n    b2FrictionJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_angularImpulse;\n    };\n    b2FrictionJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2FrictionJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2FrictionJoint.prototype.SetMaxForce = function (force) {\n        this.m_maxForce = force;\n    };\n    b2FrictionJoint.prototype.GetMaxForce = function () {\n        return this.m_maxForce;\n    };\n    b2FrictionJoint.prototype.SetMaxTorque = function (torque) {\n        this.m_maxTorque = torque;\n    };\n    b2FrictionJoint.prototype.GetMaxTorque = function () {\n        return this.m_maxTorque;\n    };\n    b2FrictionJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2FrictionJointDef = new b2FrictionJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.maxForce = %.15f;\\n\", this.m_maxForce);\n        log(\"  jd.maxTorque = %.15f;\\n\", this.m_maxTorque);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2FrictionJoint.SolveVelocityConstraints_s_Cdot_v2 = new b2Math_1.b2Vec2();\n    b2FrictionJoint.SolveVelocityConstraints_s_impulseV = new b2Math_1.b2Vec2();\n    b2FrictionJoint.SolveVelocityConstraints_s_oldImpulseV = new b2Math_1.b2Vec2();\n    return b2FrictionJoint;\n}(b2Joint_1.b2Joint));\nexports.b2FrictionJoint = b2FrictionJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2FrictionJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2GearJoint.ts":
/*!**************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2GearJoint.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Gear joint definition. This definition requires two existing\n/// revolute or prismatic joints (any combination will work).\nvar b2GearJointDef = /** @class */ (function (_super) {\n    __extends(b2GearJointDef, _super);\n    function b2GearJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_gearJoint) || this;\n        _this.joint1 = null;\n        _this.joint2 = null;\n        _this.ratio = 1;\n        return _this;\n    }\n    return b2GearJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2GearJointDef = b2GearJointDef;\nvar b2GearJoint = /** @class */ (function (_super) {\n    __extends(b2GearJoint, _super);\n    function b2GearJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_joint1 = null;\n        _this.m_joint2 = null;\n        _this.m_typeA = b2Joint_1.b2JointType.e_unknownJoint;\n        _this.m_typeB = b2Joint_1.b2JointType.e_unknownJoint;\n        // Body A is connected to body C\n        // Body B is connected to body D\n        _this.m_bodyC = null;\n        _this.m_bodyD = null;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_localAnchorC = new b2Math_1.b2Vec2();\n        _this.m_localAnchorD = new b2Math_1.b2Vec2();\n        _this.m_localAxisC = new b2Math_1.b2Vec2();\n        _this.m_localAxisD = new b2Math_1.b2Vec2();\n        _this.m_referenceAngleA = 0;\n        _this.m_referenceAngleB = 0;\n        _this.m_constant = 0;\n        _this.m_ratio = 0;\n        _this.m_impulse = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_indexC = 0;\n        _this.m_indexD = 0;\n        _this.m_lcA = new b2Math_1.b2Vec2();\n        _this.m_lcB = new b2Math_1.b2Vec2();\n        _this.m_lcC = new b2Math_1.b2Vec2();\n        _this.m_lcD = new b2Math_1.b2Vec2();\n        _this.m_mA = 0;\n        _this.m_mB = 0;\n        _this.m_mC = 0;\n        _this.m_mD = 0;\n        _this.m_iA = 0;\n        _this.m_iB = 0;\n        _this.m_iC = 0;\n        _this.m_iD = 0;\n        _this.m_JvAC = new b2Math_1.b2Vec2();\n        _this.m_JvBD = new b2Math_1.b2Vec2();\n        _this.m_JwA = 0;\n        _this.m_JwB = 0;\n        _this.m_JwC = 0;\n        _this.m_JwD = 0;\n        _this.m_mass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_qC = new b2Math_1.b2Rot();\n        _this.m_qD = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_lalcC = new b2Math_1.b2Vec2();\n        _this.m_lalcD = new b2Math_1.b2Vec2();\n        _this.m_joint1 = def.joint1;\n        _this.m_joint2 = def.joint2;\n        _this.m_typeA = _this.m_joint1.GetType();\n        _this.m_typeB = _this.m_joint2.GetType();\n        /// b2Assert(this.m_typeA === b2JointType.e_revoluteJoint || this.m_typeA === b2JointType.e_prismaticJoint);\n        /// b2Assert(this.m_typeB === b2JointType.e_revoluteJoint || this.m_typeB === b2JointType.e_prismaticJoint);\n        var coordinateA, coordinateB;\n        // TODO_ERIN there might be some problem with the joint edges in b2Joint.\n        _this.m_bodyC = _this.m_joint1.GetBodyA();\n        _this.m_bodyA = _this.m_joint1.GetBodyB();\n        // Get geometry of joint1\n        var xfA = _this.m_bodyA.m_xf;\n        var aA = _this.m_bodyA.m_sweep.a;\n        var xfC = _this.m_bodyC.m_xf;\n        var aC = _this.m_bodyC.m_sweep.a;\n        if (_this.m_typeA === b2Joint_1.b2JointType.e_revoluteJoint) {\n            var revolute = def.joint1;\n            _this.m_localAnchorC.Copy(revolute.m_localAnchorA);\n            _this.m_localAnchorA.Copy(revolute.m_localAnchorB);\n            _this.m_referenceAngleA = revolute.m_referenceAngle;\n            _this.m_localAxisC.SetZero();\n            coordinateA = aA - aC - _this.m_referenceAngleA;\n        }\n        else {\n            var prismatic = def.joint1;\n            _this.m_localAnchorC.Copy(prismatic.m_localAnchorA);\n            _this.m_localAnchorA.Copy(prismatic.m_localAnchorB);\n            _this.m_referenceAngleA = prismatic.m_referenceAngle;\n            _this.m_localAxisC.Copy(prismatic.m_localXAxisA);\n            // b2Vec2 pC = m_localAnchorC;\n            var pC = _this.m_localAnchorC;\n            // b2Vec2 pA = b2MulT(xfC.q, b2Mul(xfA.q, m_localAnchorA) + (xfA.p - xfC.p));\n            var pA = b2Math_1.b2Rot.MulTRV(xfC.q, b2Math_1.b2Vec2.AddVV(b2Math_1.b2Rot.MulRV(xfA.q, _this.m_localAnchorA, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(xfA.p, xfC.p, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0); // pA uses s_t0\n            // coordinateA = b2Dot(pA - pC, m_localAxisC);\n            coordinateA = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pA, pC, b2Math_1.b2Vec2.s_t0), _this.m_localAxisC);\n        }\n        _this.m_bodyD = _this.m_joint2.GetBodyA();\n        _this.m_bodyB = _this.m_joint2.GetBodyB();\n        // Get geometry of joint2\n        var xfB = _this.m_bodyB.m_xf;\n        var aB = _this.m_bodyB.m_sweep.a;\n        var xfD = _this.m_bodyD.m_xf;\n        var aD = _this.m_bodyD.m_sweep.a;\n        if (_this.m_typeB === b2Joint_1.b2JointType.e_revoluteJoint) {\n            var revolute = def.joint2;\n            _this.m_localAnchorD.Copy(revolute.m_localAnchorA);\n            _this.m_localAnchorB.Copy(revolute.m_localAnchorB);\n            _this.m_referenceAngleB = revolute.m_referenceAngle;\n            _this.m_localAxisD.SetZero();\n            coordinateB = aB - aD - _this.m_referenceAngleB;\n        }\n        else {\n            var prismatic = def.joint2;\n            _this.m_localAnchorD.Copy(prismatic.m_localAnchorA);\n            _this.m_localAnchorB.Copy(prismatic.m_localAnchorB);\n            _this.m_referenceAngleB = prismatic.m_referenceAngle;\n            _this.m_localAxisD.Copy(prismatic.m_localXAxisA);\n            // b2Vec2 pD = m_localAnchorD;\n            var pD = _this.m_localAnchorD;\n            // b2Vec2 pB = b2MulT(xfD.q, b2Mul(xfB.q, m_localAnchorB) + (xfB.p - xfD.p));\n            var pB = b2Math_1.b2Rot.MulTRV(xfD.q, b2Math_1.b2Vec2.AddVV(b2Math_1.b2Rot.MulRV(xfB.q, _this.m_localAnchorB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(xfB.p, xfD.p, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0); // pB uses s_t0\n            // coordinateB = b2Dot(pB - pD, m_localAxisD);\n            coordinateB = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pB, pD, b2Math_1.b2Vec2.s_t0), _this.m_localAxisD);\n        }\n        _this.m_ratio = def.ratio;\n        _this.m_constant = coordinateA + _this.m_ratio * coordinateB;\n        _this.m_impulse = 0;\n        return _this;\n    }\n    b2GearJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_indexC = this.m_bodyC.m_islandIndex;\n        this.m_indexD = this.m_bodyD.m_islandIndex;\n        this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter);\n        this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter);\n        this.m_mA = this.m_bodyA.m_invMass;\n        this.m_mB = this.m_bodyB.m_invMass;\n        this.m_mC = this.m_bodyC.m_invMass;\n        this.m_mD = this.m_bodyD.m_invMass;\n        this.m_iA = this.m_bodyA.m_invI;\n        this.m_iB = this.m_bodyB.m_invI;\n        this.m_iC = this.m_bodyC.m_invI;\n        this.m_iD = this.m_bodyD.m_invI;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var aC = data.positions[this.m_indexC].a;\n        var vC = data.velocities[this.m_indexC].v;\n        var wC = data.velocities[this.m_indexC].w;\n        var aD = data.positions[this.m_indexD].a;\n        var vD = data.velocities[this.m_indexD].v;\n        var wD = data.velocities[this.m_indexD].w;\n        // b2Rot qA(aA), qB(aB), qC(aC), qD(aD);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB), qC = this.m_qC.SetAngle(aC), qD = this.m_qD.SetAngle(aD);\n        this.m_mass = 0;\n        if (this.m_typeA === b2Joint_1.b2JointType.e_revoluteJoint) {\n            this.m_JvAC.SetZero();\n            this.m_JwA = 1;\n            this.m_JwC = 1;\n            this.m_mass += this.m_iA + this.m_iC;\n        }\n        else {\n            // b2Vec2 u = b2Mul(qC, m_localAxisC);\n            var u = b2Math_1.b2Rot.MulRV(qC, this.m_localAxisC, b2GearJoint.InitVelocityConstraints_s_u);\n            // b2Vec2 rC = b2Mul(qC, m_localAnchorC - m_lcC);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorC, this.m_lcC, this.m_lalcC);\n            var rC = b2Math_1.b2Rot.MulRV(qC, this.m_lalcC, b2GearJoint.InitVelocityConstraints_s_rC);\n            // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_lcA);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_lcA, this.m_lalcA);\n            var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, b2GearJoint.InitVelocityConstraints_s_rA);\n            // m_JvAC = u;\n            this.m_JvAC.Copy(u);\n            // m_JwC = b2Cross(rC, u);\n            this.m_JwC = b2Math_1.b2Vec2.CrossVV(rC, u);\n            // m_JwA = b2Cross(rA, u);\n            this.m_JwA = b2Math_1.b2Vec2.CrossVV(rA, u);\n            this.m_mass += this.m_mC + this.m_mA + this.m_iC * this.m_JwC * this.m_JwC + this.m_iA * this.m_JwA * this.m_JwA;\n        }\n        if (this.m_typeB === b2Joint_1.b2JointType.e_revoluteJoint) {\n            this.m_JvBD.SetZero();\n            this.m_JwB = this.m_ratio;\n            this.m_JwD = this.m_ratio;\n            this.m_mass += this.m_ratio * this.m_ratio * (this.m_iB + this.m_iD);\n        }\n        else {\n            // b2Vec2 u = b2Mul(qD, m_localAxisD);\n            var u = b2Math_1.b2Rot.MulRV(qD, this.m_localAxisD, b2GearJoint.InitVelocityConstraints_s_u);\n            // b2Vec2 rD = b2Mul(qD, m_localAnchorD - m_lcD);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorD, this.m_lcD, this.m_lalcD);\n            var rD = b2Math_1.b2Rot.MulRV(qD, this.m_lalcD, b2GearJoint.InitVelocityConstraints_s_rD);\n            // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_lcB);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_lcB, this.m_lalcB);\n            var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, b2GearJoint.InitVelocityConstraints_s_rB);\n            // m_JvBD = m_ratio * u;\n            b2Math_1.b2Vec2.MulSV(this.m_ratio, u, this.m_JvBD);\n            // m_JwD = m_ratio * b2Cross(rD, u);\n            this.m_JwD = this.m_ratio * b2Math_1.b2Vec2.CrossVV(rD, u);\n            // m_JwB = m_ratio * b2Cross(rB, u);\n            this.m_JwB = this.m_ratio * b2Math_1.b2Vec2.CrossVV(rB, u);\n            this.m_mass += this.m_ratio * this.m_ratio * (this.m_mD + this.m_mB) + this.m_iD * this.m_JwD * this.m_JwD + this.m_iB * this.m_JwB * this.m_JwB;\n        }\n        // Compute effective mass.\n        this.m_mass = this.m_mass > 0 ? 1 / this.m_mass : 0;\n        if (data.step.warmStarting) {\n            // vA += (m_mA * m_impulse) * m_JvAC;\n            vA.SelfMulAdd(this.m_mA * this.m_impulse, this.m_JvAC);\n            wA += this.m_iA * this.m_impulse * this.m_JwA;\n            // vB += (m_mB * m_impulse) * m_JvBD;\n            vB.SelfMulAdd(this.m_mB * this.m_impulse, this.m_JvBD);\n            wB += this.m_iB * this.m_impulse * this.m_JwB;\n            // vC -= (m_mC * m_impulse) * m_JvAC;\n            vC.SelfMulSub(this.m_mC * this.m_impulse, this.m_JvAC);\n            wC -= this.m_iC * this.m_impulse * this.m_JwC;\n            // vD -= (m_mD * m_impulse) * m_JvBD;\n            vD.SelfMulSub(this.m_mD * this.m_impulse, this.m_JvBD);\n            wD -= this.m_iD * this.m_impulse * this.m_JwD;\n        }\n        else {\n            this.m_impulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n        // data.velocities[this.m_indexC].v = vC;\n        data.velocities[this.m_indexC].w = wC;\n        // data.velocities[this.m_indexD].v = vD;\n        data.velocities[this.m_indexD].w = wD;\n    };\n    b2GearJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var vC = data.velocities[this.m_indexC].v;\n        var wC = data.velocities[this.m_indexC].w;\n        var vD = data.velocities[this.m_indexD].v;\n        var wD = data.velocities[this.m_indexD].w;\n        // float32 Cdot = b2Dot(m_JvAC, vA - vC) + b2Dot(m_JvBD, vB - vD);\n        var Cdot = b2Math_1.b2Vec2.DotVV(this.m_JvAC, b2Math_1.b2Vec2.SubVV(vA, vC, b2Math_1.b2Vec2.s_t0)) +\n            b2Math_1.b2Vec2.DotVV(this.m_JvBD, b2Math_1.b2Vec2.SubVV(vB, vD, b2Math_1.b2Vec2.s_t0));\n        Cdot += (this.m_JwA * wA - this.m_JwC * wC) + (this.m_JwB * wB - this.m_JwD * wD);\n        var impulse = -this.m_mass * Cdot;\n        this.m_impulse += impulse;\n        // vA += (m_mA * impulse) * m_JvAC;\n        vA.SelfMulAdd((this.m_mA * impulse), this.m_JvAC);\n        wA += this.m_iA * impulse * this.m_JwA;\n        // vB += (m_mB * impulse) * m_JvBD;\n        vB.SelfMulAdd((this.m_mB * impulse), this.m_JvBD);\n        wB += this.m_iB * impulse * this.m_JwB;\n        // vC -= (m_mC * impulse) * m_JvAC;\n        vC.SelfMulSub((this.m_mC * impulse), this.m_JvAC);\n        wC -= this.m_iC * impulse * this.m_JwC;\n        // vD -= (m_mD * impulse) * m_JvBD;\n        vD.SelfMulSub((this.m_mD * impulse), this.m_JvBD);\n        wD -= this.m_iD * impulse * this.m_JwD;\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n        // data.velocities[this.m_indexC].v = vC;\n        data.velocities[this.m_indexC].w = wC;\n        // data.velocities[this.m_indexD].v = vD;\n        data.velocities[this.m_indexD].w = wD;\n    };\n    b2GearJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var cC = data.positions[this.m_indexC].c;\n        var aC = data.positions[this.m_indexC].a;\n        var cD = data.positions[this.m_indexD].c;\n        var aD = data.positions[this.m_indexD].a;\n        // b2Rot qA(aA), qB(aB), qC(aC), qD(aD);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB), qC = this.m_qC.SetAngle(aC), qD = this.m_qD.SetAngle(aD);\n        var linearError = 0;\n        var coordinateA, coordinateB;\n        var JvAC = this.m_JvAC, JvBD = this.m_JvBD;\n        var JwA, JwB, JwC, JwD;\n        var mass = 0;\n        if (this.m_typeA === b2Joint_1.b2JointType.e_revoluteJoint) {\n            JvAC.SetZero();\n            JwA = 1;\n            JwC = 1;\n            mass += this.m_iA + this.m_iC;\n            coordinateA = aA - aC - this.m_referenceAngleA;\n        }\n        else {\n            // b2Vec2 u = b2Mul(qC, m_localAxisC);\n            var u = b2Math_1.b2Rot.MulRV(qC, this.m_localAxisC, b2GearJoint.SolvePositionConstraints_s_u);\n            // b2Vec2 rC = b2Mul(qC, m_localAnchorC - m_lcC);\n            var rC = b2Math_1.b2Rot.MulRV(qC, this.m_lalcC, b2GearJoint.SolvePositionConstraints_s_rC);\n            // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_lcA);\n            var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, b2GearJoint.SolvePositionConstraints_s_rA);\n            // JvAC = u;\n            JvAC.Copy(u);\n            // JwC = b2Cross(rC, u);\n            JwC = b2Math_1.b2Vec2.CrossVV(rC, u);\n            // JwA = b2Cross(rA, u);\n            JwA = b2Math_1.b2Vec2.CrossVV(rA, u);\n            mass += this.m_mC + this.m_mA + this.m_iC * JwC * JwC + this.m_iA * JwA * JwA;\n            // b2Vec2 pC = m_localAnchorC - m_lcC;\n            var pC = this.m_lalcC;\n            // b2Vec2 pA = b2MulT(qC, rA + (cA - cC));\n            var pA = b2Math_1.b2Rot.MulTRV(qC, b2Math_1.b2Vec2.AddVV(rA, b2Math_1.b2Vec2.SubVV(cA, cC, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0); // pA uses s_t0\n            // coordinateA = b2Dot(pA - pC, m_localAxisC);\n            coordinateA = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pA, pC, b2Math_1.b2Vec2.s_t0), this.m_localAxisC);\n        }\n        if (this.m_typeB === b2Joint_1.b2JointType.e_revoluteJoint) {\n            JvBD.SetZero();\n            JwB = this.m_ratio;\n            JwD = this.m_ratio;\n            mass += this.m_ratio * this.m_ratio * (this.m_iB + this.m_iD);\n            coordinateB = aB - aD - this.m_referenceAngleB;\n        }\n        else {\n            // b2Vec2 u = b2Mul(qD, m_localAxisD);\n            var u = b2Math_1.b2Rot.MulRV(qD, this.m_localAxisD, b2GearJoint.SolvePositionConstraints_s_u);\n            // b2Vec2 rD = b2Mul(qD, m_localAnchorD - m_lcD);\n            var rD = b2Math_1.b2Rot.MulRV(qD, this.m_lalcD, b2GearJoint.SolvePositionConstraints_s_rD);\n            // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_lcB);\n            var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, b2GearJoint.SolvePositionConstraints_s_rB);\n            // JvBD = m_ratio * u;\n            b2Math_1.b2Vec2.MulSV(this.m_ratio, u, JvBD);\n            // JwD = m_ratio * b2Cross(rD, u);\n            JwD = this.m_ratio * b2Math_1.b2Vec2.CrossVV(rD, u);\n            // JwB = m_ratio * b2Cross(rB, u);\n            JwB = this.m_ratio * b2Math_1.b2Vec2.CrossVV(rB, u);\n            mass += this.m_ratio * this.m_ratio * (this.m_mD + this.m_mB) + this.m_iD * JwD * JwD + this.m_iB * JwB * JwB;\n            // b2Vec2 pD = m_localAnchorD - m_lcD;\n            var pD = this.m_lalcD;\n            // b2Vec2 pB = b2MulT(qD, rB + (cB - cD));\n            var pB = b2Math_1.b2Rot.MulTRV(qD, b2Math_1.b2Vec2.AddVV(rB, b2Math_1.b2Vec2.SubVV(cB, cD, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0); // pB uses s_t0\n            // coordinateB = b2Dot(pB - pD, m_localAxisD);\n            coordinateB = b2Math_1.b2Vec2.DotVV(b2Math_1.b2Vec2.SubVV(pB, pD, b2Math_1.b2Vec2.s_t0), this.m_localAxisD);\n        }\n        var C = (coordinateA + this.m_ratio * coordinateB) - this.m_constant;\n        var impulse = 0;\n        if (mass > 0) {\n            impulse = -C / mass;\n        }\n        // cA += m_mA * impulse * JvAC;\n        cA.SelfMulAdd(this.m_mA * impulse, JvAC);\n        aA += this.m_iA * impulse * JwA;\n        // cB += m_mB * impulse * JvBD;\n        cB.SelfMulAdd(this.m_mB * impulse, JvBD);\n        aB += this.m_iB * impulse * JwB;\n        // cC -= m_mC * impulse * JvAC;\n        cC.SelfMulSub(this.m_mC * impulse, JvAC);\n        aC -= this.m_iC * impulse * JwC;\n        // cD -= m_mD * impulse * JvBD;\n        cD.SelfMulSub(this.m_mD * impulse, JvBD);\n        aD -= this.m_iD * impulse * JwD;\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        // data.positions[this.m_indexC].c = cC;\n        data.positions[this.m_indexC].a = aC;\n        // data.positions[this.m_indexD].c = cD;\n        data.positions[this.m_indexD].a = aD;\n        // TODO_ERIN not implemented\n        return linearError < b2Settings_1.b2_linearSlop;\n    };\n    b2GearJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2GearJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2GearJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // b2Vec2 P = m_impulse * m_JvAC;\n        // return inv_dt * P;\n        return b2Math_1.b2Vec2.MulSV(inv_dt * this.m_impulse, this.m_JvAC, out);\n    };\n    b2GearJoint.prototype.GetReactionTorque = function (inv_dt) {\n        // float32 L = m_impulse * m_JwA;\n        // return inv_dt * L;\n        return inv_dt * this.m_impulse * this.m_JwA;\n    };\n    b2GearJoint.prototype.GetJoint1 = function () { return this.m_joint1; };\n    b2GearJoint.prototype.GetJoint2 = function () { return this.m_joint2; };\n    b2GearJoint.prototype.GetRatio = function () {\n        return this.m_ratio;\n    };\n    b2GearJoint.prototype.SetRatio = function (ratio) {\n        /// b2Assert(b2IsValid(ratio));\n        this.m_ratio = ratio;\n    };\n    b2GearJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        var index1 = this.m_joint1.m_index;\n        var index2 = this.m_joint2.m_index;\n        log(\"  const jd: b2GearJointDef = new b2GearJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.joint1 = joints[%d];\\n\", index1);\n        log(\"  jd.joint2 = joints[%d];\\n\", index2);\n        log(\"  jd.ratio = %.15f;\\n\", this.m_ratio);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2GearJoint.InitVelocityConstraints_s_u = new b2Math_1.b2Vec2();\n    b2GearJoint.InitVelocityConstraints_s_rA = new b2Math_1.b2Vec2();\n    b2GearJoint.InitVelocityConstraints_s_rB = new b2Math_1.b2Vec2();\n    b2GearJoint.InitVelocityConstraints_s_rC = new b2Math_1.b2Vec2();\n    b2GearJoint.InitVelocityConstraints_s_rD = new b2Math_1.b2Vec2();\n    b2GearJoint.SolvePositionConstraints_s_u = new b2Math_1.b2Vec2();\n    b2GearJoint.SolvePositionConstraints_s_rA = new b2Math_1.b2Vec2();\n    b2GearJoint.SolvePositionConstraints_s_rB = new b2Math_1.b2Vec2();\n    b2GearJoint.SolvePositionConstraints_s_rC = new b2Math_1.b2Vec2();\n    b2GearJoint.SolvePositionConstraints_s_rD = new b2Math_1.b2Vec2();\n    return b2GearJoint;\n}(b2Joint_1.b2Joint));\nexports.b2GearJoint = b2GearJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2GearJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2Joint.ts":
/*!**********************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2Joint.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2007 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2JointType;\n(function (b2JointType) {\n    b2JointType[b2JointType[\"e_unknownJoint\"] = 0] = \"e_unknownJoint\";\n    b2JointType[b2JointType[\"e_revoluteJoint\"] = 1] = \"e_revoluteJoint\";\n    b2JointType[b2JointType[\"e_prismaticJoint\"] = 2] = \"e_prismaticJoint\";\n    b2JointType[b2JointType[\"e_distanceJoint\"] = 3] = \"e_distanceJoint\";\n    b2JointType[b2JointType[\"e_pulleyJoint\"] = 4] = \"e_pulleyJoint\";\n    b2JointType[b2JointType[\"e_mouseJoint\"] = 5] = \"e_mouseJoint\";\n    b2JointType[b2JointType[\"e_gearJoint\"] = 6] = \"e_gearJoint\";\n    b2JointType[b2JointType[\"e_wheelJoint\"] = 7] = \"e_wheelJoint\";\n    b2JointType[b2JointType[\"e_weldJoint\"] = 8] = \"e_weldJoint\";\n    b2JointType[b2JointType[\"e_frictionJoint\"] = 9] = \"e_frictionJoint\";\n    b2JointType[b2JointType[\"e_ropeJoint\"] = 10] = \"e_ropeJoint\";\n    b2JointType[b2JointType[\"e_motorJoint\"] = 11] = \"e_motorJoint\";\n    b2JointType[b2JointType[\"e_areaJoint\"] = 12] = \"e_areaJoint\";\n})(b2JointType = exports.b2JointType || (exports.b2JointType = {}));\nvar b2LimitState;\n(function (b2LimitState) {\n    b2LimitState[b2LimitState[\"e_inactiveLimit\"] = 0] = \"e_inactiveLimit\";\n    b2LimitState[b2LimitState[\"e_atLowerLimit\"] = 1] = \"e_atLowerLimit\";\n    b2LimitState[b2LimitState[\"e_atUpperLimit\"] = 2] = \"e_atUpperLimit\";\n    b2LimitState[b2LimitState[\"e_equalLimits\"] = 3] = \"e_equalLimits\";\n})(b2LimitState = exports.b2LimitState || (exports.b2LimitState = {}));\nvar b2Jacobian = /** @class */ (function () {\n    function b2Jacobian() {\n        this.linear = new b2Math_1.b2Vec2();\n        this.angularA = 0;\n        this.angularB = 0;\n    }\n    b2Jacobian.prototype.SetZero = function () {\n        this.linear.SetZero();\n        this.angularA = 0;\n        this.angularB = 0;\n        return this;\n    };\n    b2Jacobian.prototype.Set = function (x, a1, a2) {\n        this.linear.Copy(x);\n        this.angularA = a1;\n        this.angularB = a2;\n        return this;\n    };\n    return b2Jacobian;\n}());\nexports.b2Jacobian = b2Jacobian;\n/// A joint edge is used to connect bodies and joints together\n/// in a joint graph where each body is a node and each joint\n/// is an edge. A joint edge belongs to a doubly linked list\n/// maintained in each attached body. Each joint has two joint\n/// nodes, one for each attached body.\nvar b2JointEdge = /** @class */ (function () {\n    function b2JointEdge(joint, other) {\n        this.prev = null; /// < the previous joint edge in the body's joint list\n        this.next = null; /// < the next joint edge in the body's joint list\n        this.joint = joint;\n        this.other = other;\n    }\n    return b2JointEdge;\n}());\nexports.b2JointEdge = b2JointEdge;\n/// Joint definitions are used to construct joints.\nvar b2JointDef = /** @class */ (function () {\n    function b2JointDef(type) {\n        /// The joint type is set automatically for concrete joint types.\n        this.type = b2JointType.e_unknownJoint;\n        /// Use this to attach application specific data to your joints.\n        this.userData = null;\n        /// The first attached body.\n        this.bodyA = null;\n        /// The second attached body.\n        this.bodyB = null;\n        /// Set this flag to true if the attached bodies should collide.\n        this.collideConnected = false;\n        this.type = type;\n    }\n    return b2JointDef;\n}());\nexports.b2JointDef = b2JointDef;\n/// The base joint class. Joints are used to constraint two bodies together in\n/// various fashions. Some joints also feature limits and motors.\nvar b2Joint = /** @class */ (function () {\n    function b2Joint(def) {\n        /// b2Assert(def.bodyA !== def.bodyB);\n        this.m_type = b2JointType.e_unknownJoint;\n        this.m_prev = null;\n        this.m_next = null;\n        this.m_index = 0;\n        this.m_islandFlag = false;\n        this.m_collideConnected = false;\n        this.m_userData = null;\n        this.m_type = def.type;\n        this.m_edgeA = new b2JointEdge(this, def.bodyB);\n        this.m_edgeB = new b2JointEdge(this, def.bodyA);\n        this.m_bodyA = def.bodyA;\n        this.m_bodyB = def.bodyB;\n        this.m_collideConnected = def.collideConnected;\n        this.m_userData = def.userData;\n    }\n    /// Get the type of the concrete joint.\n    b2Joint.prototype.GetType = function () {\n        return this.m_type;\n    };\n    /// Get the first body attached to this joint.\n    b2Joint.prototype.GetBodyA = function () {\n        return this.m_bodyA;\n    };\n    /// Get the second body attached to this joint.\n    b2Joint.prototype.GetBodyB = function () {\n        return this.m_bodyB;\n    };\n    /// Get the anchor point on bodyA in world coordinates.\n    b2Joint.prototype.GetAnchorA = function (out) {\n        return out.SetZero();\n    };\n    /// Get the anchor point on bodyB in world coordinates.\n    b2Joint.prototype.GetAnchorB = function (out) {\n        return out.SetZero();\n    };\n    /// Get the reaction force on bodyB at the joint anchor in Newtons.\n    b2Joint.prototype.GetReactionForce = function (inv_dt, out) {\n        return out.SetZero();\n    };\n    /// Get the reaction torque on bodyB in N*m.\n    b2Joint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    /// Get the next joint the world joint list.\n    b2Joint.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    /// Get the user data pointer.\n    b2Joint.prototype.GetUserData = function () {\n        return this.m_userData;\n    };\n    /// Set the user data pointer.\n    b2Joint.prototype.SetUserData = function (data) {\n        this.m_userData = data;\n    };\n    /// Short-cut function to determine if either body is inactive.\n    b2Joint.prototype.IsActive = function () {\n        return this.m_bodyA.IsActive() && this.m_bodyB.IsActive();\n    };\n    /// Get collide connected.\n    /// Note: modifying the collide connect flag won't work correctly because\n    /// the flag is only checked when fixture AABBs begin to overlap.\n    b2Joint.prototype.GetCollideConnected = function () {\n        return this.m_collideConnected;\n    };\n    /// Dump this joint to the log file.\n    b2Joint.prototype.Dump = function (log) {\n        log(\"// Dump is not supported for this joint type.\\n\");\n    };\n    /// Shift the origin for any points stored in world coordinates.\n    b2Joint.prototype.ShiftOrigin = function (newOrigin) {\n    };\n    b2Joint.prototype.InitVelocityConstraints = function (data) {\n    };\n    b2Joint.prototype.SolveVelocityConstraints = function (data) {\n    };\n    // This returns true if the position errors are within tolerance.\n    b2Joint.prototype.SolvePositionConstraints = function (data) {\n        return false;\n    };\n    return b2Joint;\n}());\nexports.b2Joint = b2Joint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2Joint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2JointFactory.ts":
/*!*****************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2JointFactory.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2AreaJoint_1 = __webpack_require__(/*! ./b2AreaJoint */ \"./src/Box2D/Dynamics/Joints/b2AreaJoint.ts\");\nvar b2DistanceJoint_1 = __webpack_require__(/*! ./b2DistanceJoint */ \"./src/Box2D/Dynamics/Joints/b2DistanceJoint.ts\");\nvar b2FrictionJoint_1 = __webpack_require__(/*! ./b2FrictionJoint */ \"./src/Box2D/Dynamics/Joints/b2FrictionJoint.ts\");\nvar b2GearJoint_1 = __webpack_require__(/*! ./b2GearJoint */ \"./src/Box2D/Dynamics/Joints/b2GearJoint.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\nvar b2MotorJoint_1 = __webpack_require__(/*! ./b2MotorJoint */ \"./src/Box2D/Dynamics/Joints/b2MotorJoint.ts\");\nvar b2MouseJoint_1 = __webpack_require__(/*! ./b2MouseJoint */ \"./src/Box2D/Dynamics/Joints/b2MouseJoint.ts\");\nvar b2PrismaticJoint_1 = __webpack_require__(/*! ./b2PrismaticJoint */ \"./src/Box2D/Dynamics/Joints/b2PrismaticJoint.ts\");\nvar b2PulleyJoint_1 = __webpack_require__(/*! ./b2PulleyJoint */ \"./src/Box2D/Dynamics/Joints/b2PulleyJoint.ts\");\nvar b2RevoluteJoint_1 = __webpack_require__(/*! ./b2RevoluteJoint */ \"./src/Box2D/Dynamics/Joints/b2RevoluteJoint.ts\");\nvar b2RopeJoint_1 = __webpack_require__(/*! ./b2RopeJoint */ \"./src/Box2D/Dynamics/Joints/b2RopeJoint.ts\");\nvar b2WeldJoint_1 = __webpack_require__(/*! ./b2WeldJoint */ \"./src/Box2D/Dynamics/Joints/b2WeldJoint.ts\");\nvar b2WheelJoint_1 = __webpack_require__(/*! ./b2WheelJoint */ \"./src/Box2D/Dynamics/Joints/b2WheelJoint.ts\");\nvar b2JointFactory = /** @class */ (function () {\n    function b2JointFactory() {\n    }\n    b2JointFactory.Create = function (def, allocator) {\n        var joint = null;\n        switch (def.type) {\n            case b2Joint_1.b2JointType.e_distanceJoint:\n                joint = new b2DistanceJoint_1.b2DistanceJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_mouseJoint:\n                joint = new b2MouseJoint_1.b2MouseJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_prismaticJoint:\n                joint = new b2PrismaticJoint_1.b2PrismaticJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_revoluteJoint:\n                joint = new b2RevoluteJoint_1.b2RevoluteJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_pulleyJoint:\n                joint = new b2PulleyJoint_1.b2PulleyJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_gearJoint:\n                joint = new b2GearJoint_1.b2GearJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_wheelJoint:\n                joint = new b2WheelJoint_1.b2WheelJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_weldJoint:\n                joint = new b2WeldJoint_1.b2WeldJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_frictionJoint:\n                joint = new b2FrictionJoint_1.b2FrictionJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_ropeJoint:\n                joint = new b2RopeJoint_1.b2RopeJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_motorJoint:\n                joint = new b2MotorJoint_1.b2MotorJoint(def);\n                break;\n            case b2Joint_1.b2JointType.e_areaJoint:\n                joint = new b2AreaJoint_1.b2AreaJoint(def);\n                break;\n            default:\n                /// b2Assert(false);\n                break;\n        }\n        return joint;\n    };\n    b2JointFactory.Destroy = function (joint, allocator) {\n    };\n    return b2JointFactory;\n}());\nexports.b2JointFactory = b2JointFactory;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2JointFactory.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2MotorJoint.ts":
/*!***************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2MotorJoint.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2012 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n// Point-to-point constraint\n// Cdot = v2 - v1\n//      = v2 + cross(w2, r2) - v1 - cross(w1, r1)\n// J = [-I -r1_skew I r2_skew ]\n// Identity used:\n// w k % (rx i + ry j) = w * (-ry i + rx j)\n//\n// r1 = offset - c1\n// r2 = -c2\n// Angle constraint\n// Cdot = w2 - w1\n// J = [0 0 -1 0 0 1]\n// K = invI1 + invI2\nvar b2MotorJointDef = /** @class */ (function (_super) {\n    __extends(b2MotorJointDef, _super);\n    function b2MotorJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_motorJoint) || this;\n        _this.linearOffset = new b2Math_1.b2Vec2(0, 0);\n        _this.angularOffset = 0;\n        _this.maxForce = 1;\n        _this.maxTorque = 1;\n        _this.correctionFactor = 0.3;\n        return _this;\n    }\n    b2MotorJointDef.prototype.Initialize = function (bA, bB) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        // b2Vec2 xB = bodyB->GetPosition();\n        // linearOffset = bodyA->GetLocalPoint(xB);\n        this.bodyA.GetLocalPoint(this.bodyB.GetPosition(), this.linearOffset);\n        var angleA = this.bodyA.GetAngle();\n        var angleB = this.bodyB.GetAngle();\n        this.angularOffset = angleB - angleA;\n    };\n    return b2MotorJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2MotorJointDef = b2MotorJointDef;\nvar b2MotorJoint = /** @class */ (function (_super) {\n    __extends(b2MotorJoint, _super);\n    function b2MotorJoint(def) {\n        var _this = _super.call(this, def) || this;\n        // Solver shared\n        _this.m_linearOffset = new b2Math_1.b2Vec2();\n        _this.m_angularOffset = 0;\n        _this.m_linearImpulse = new b2Math_1.b2Vec2();\n        _this.m_angularImpulse = 0;\n        _this.m_maxForce = 0;\n        _this.m_maxTorque = 0;\n        _this.m_correctionFactor = 0.3;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_linearError = new b2Math_1.b2Vec2();\n        _this.m_angularError = 0;\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_linearMass = new b2Math_1.b2Mat22();\n        _this.m_angularMass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_K = new b2Math_1.b2Mat22();\n        _this.m_linearOffset.Copy(def.linearOffset);\n        _this.m_linearImpulse.SetZero();\n        _this.m_maxForce = def.maxForce;\n        _this.m_maxTorque = def.maxTorque;\n        _this.m_correctionFactor = def.correctionFactor;\n        return _this;\n    }\n    b2MotorJoint.prototype.GetAnchorA = function () {\n        return this.m_bodyA.GetPosition();\n    };\n    b2MotorJoint.prototype.GetAnchorB = function () {\n        return this.m_bodyB.GetPosition();\n    };\n    b2MotorJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // return inv_dt * m_linearImpulse;\n        return b2Math_1.b2Vec2.MulSV(inv_dt, this.m_linearImpulse, out);\n    };\n    b2MotorJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_angularImpulse;\n    };\n    b2MotorJoint.prototype.SetLinearOffset = function (linearOffset) {\n        if (!b2Math_1.b2Vec2.IsEqualToV(linearOffset, this.m_linearOffset)) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_linearOffset.Copy(linearOffset);\n        }\n    };\n    b2MotorJoint.prototype.GetLinearOffset = function () {\n        return this.m_linearOffset;\n    };\n    b2MotorJoint.prototype.SetAngularOffset = function (angularOffset) {\n        if (angularOffset !== this.m_angularOffset) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_angularOffset = angularOffset;\n        }\n    };\n    b2MotorJoint.prototype.GetAngularOffset = function () {\n        return this.m_angularOffset;\n    };\n    b2MotorJoint.prototype.SetMaxForce = function (force) {\n        /// b2Assert(b2IsValid(force) && force >= 0);\n        this.m_maxForce = force;\n    };\n    b2MotorJoint.prototype.GetMaxForce = function () {\n        return this.m_maxForce;\n    };\n    b2MotorJoint.prototype.SetMaxTorque = function (torque) {\n        /// b2Assert(b2IsValid(torque) && torque >= 0);\n        this.m_maxTorque = torque;\n    };\n    b2MotorJoint.prototype.GetMaxTorque = function () {\n        return this.m_maxTorque;\n    };\n    b2MotorJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // Compute the effective mass matrix.\n        // this.m_rA = b2Mul(qA, m_linearOffset - this.m_localCenterA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, b2Math_1.b2Vec2.SubVV(this.m_linearOffset, this.m_localCenterA, b2Math_1.b2Vec2.s_t0), this.m_rA);\n        // this.m_rB = b2Mul(qB, -this.m_localCenterB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, b2Math_1.b2Vec2.NegV(this.m_localCenterB, b2Math_1.b2Vec2.s_t0), this.m_rB);\n        // J = [-I -r1_skew I r2_skew]\n        // r_skew = [-ry; rx]\n        // Matlab\n        // K = [ mA+r1y^2*iA+mB+r2y^2*iB,  -r1y*iA*r1x-r2y*iB*r2x,          -r1y*iA-r2y*iB]\n        //     [  -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB,           r1x*iA+r2x*iB]\n        //     [          -r1y*iA-r2y*iB,           r1x*iA+r2x*iB,                   iA+iB]\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        // Upper 2 by 2 of K for point to point\n        var K = this.m_K;\n        K.ex.x = mA + mB + iA * rA.y * rA.y + iB * rB.y * rB.y;\n        K.ex.y = -iA * rA.x * rA.y - iB * rB.x * rB.y;\n        K.ey.x = K.ex.y;\n        K.ey.y = mA + mB + iA * rA.x * rA.x + iB * rB.x * rB.x;\n        // this.m_linearMass = K.GetInverse();\n        K.GetInverse(this.m_linearMass);\n        this.m_angularMass = iA + iB;\n        if (this.m_angularMass > 0) {\n            this.m_angularMass = 1 / this.m_angularMass;\n        }\n        // this.m_linearError = cB + rB - cA - rA;\n        b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), this.m_linearError);\n        this.m_angularError = aB - aA - this.m_angularOffset;\n        if (data.step.warmStarting) {\n            // Scale impulses to support a variable time step.\n            // this.m_linearImpulse *= data.step.dtRatio;\n            this.m_linearImpulse.SelfMul(data.step.dtRatio);\n            this.m_angularImpulse *= data.step.dtRatio;\n            // b2Vec2 P(this.m_linearImpulse.x, this.m_linearImpulse.y);\n            var P = this.m_linearImpulse;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(rA, P) + this.m_angularImpulse);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(rB, P) + this.m_angularImpulse);\n        }\n        else {\n            this.m_linearImpulse.SetZero();\n            this.m_angularImpulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA; // vA is a reference\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB; // vB is a reference\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2MotorJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var h = data.step.dt;\n        var inv_h = data.step.inv_dt;\n        // Solve angular friction\n        {\n            var Cdot = wB - wA + inv_h * this.m_correctionFactor * this.m_angularError;\n            var impulse = -this.m_angularMass * Cdot;\n            var oldImpulse = this.m_angularImpulse;\n            var maxImpulse = h * this.m_maxTorque;\n            this.m_angularImpulse = b2Math_1.b2Clamp(this.m_angularImpulse + impulse, -maxImpulse, maxImpulse);\n            impulse = this.m_angularImpulse - oldImpulse;\n            wA -= iA * impulse;\n            wB += iB * impulse;\n        }\n        // Solve linear friction\n        {\n            var rA = this.m_rA;\n            var rB = this.m_rB;\n            // b2Vec2 Cdot = vB + b2Vec2.CrossSV(wB, rB) - vA - b2Vec2.CrossSV(wA, rA) + inv_h * this.m_correctionFactor * this.m_linearError;\n            var Cdot_v2 = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(vB, b2Math_1.b2Vec2.CrossSV(wB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(vA, b2Math_1.b2Vec2.CrossSV(wA, rA, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t2), b2Math_1.b2Vec2.MulSV(inv_h * this.m_correctionFactor, this.m_linearError, b2Math_1.b2Vec2.s_t3), b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2);\n            // b2Vec2 impulse = -b2Mul(this.m_linearMass, Cdot);\n            var impulse_v2 = b2Math_1.b2Mat22.MulMV(this.m_linearMass, Cdot_v2, b2MotorJoint.SolveVelocityConstraints_s_impulse_v2).SelfNeg();\n            // b2Vec2 oldImpulse = this.m_linearImpulse;\n            var oldImpulse_v2 = b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);\n            // this.m_linearImpulse += impulse;\n            this.m_linearImpulse.SelfAdd(impulse_v2);\n            var maxImpulse = h * this.m_maxForce;\n            if (this.m_linearImpulse.LengthSquared() > maxImpulse * maxImpulse) {\n                this.m_linearImpulse.Normalize();\n                // this.m_linearImpulse *= maxImpulse;\n                this.m_linearImpulse.SelfMul(maxImpulse);\n            }\n            // impulse = this.m_linearImpulse - oldImpulse;\n            b2Math_1.b2Vec2.SubVV(this.m_linearImpulse, oldImpulse_v2, impulse_v2);\n            // vA -= mA * impulse;\n            vA.SelfMulSub(mA, impulse_v2);\n            // wA -= iA * b2Vec2.CrossVV(rA, impulse);\n            wA -= iA * b2Math_1.b2Vec2.CrossVV(rA, impulse_v2);\n            // vB += mB * impulse;\n            vB.SelfMulAdd(mB, impulse_v2);\n            // wB += iB * b2Vec2.CrossVV(rB, impulse);\n            wB += iB * b2Math_1.b2Vec2.CrossVV(rB, impulse_v2);\n        }\n        // data.velocities[this.m_indexA].v = vA; // vA is a reference\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB; // vB is a reference\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2MotorJoint.prototype.SolvePositionConstraints = function (data) {\n        return true;\n    };\n    b2MotorJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2MotorJointDef = new b2MotorJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.linearOffset.Set(%.15f, %.15f);\\n\", this.m_linearOffset.x, this.m_linearOffset.y);\n        log(\"  jd.angularOffset = %.15f;\\n\", this.m_angularOffset);\n        log(\"  jd.maxForce = %.15f;\\n\", this.m_maxForce);\n        log(\"  jd.maxTorque = %.15f;\\n\", this.m_maxTorque);\n        log(\"  jd.correctionFactor = %.15f;\\n\", this.m_correctionFactor);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2MotorJoint.SolveVelocityConstraints_s_Cdot_v2 = new b2Math_1.b2Vec2();\n    b2MotorJoint.SolveVelocityConstraints_s_impulse_v2 = new b2Math_1.b2Vec2();\n    b2MotorJoint.SolveVelocityConstraints_s_oldImpulse_v2 = new b2Math_1.b2Vec2();\n    return b2MotorJoint;\n}(b2Joint_1.b2Joint));\nexports.b2MotorJoint = b2MotorJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2MotorJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2MouseJoint.ts":
/*!***************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2MouseJoint.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2007 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Mouse joint definition. This requires a world target point,\n/// tuning parameters, and the time step.\nvar b2MouseJointDef = /** @class */ (function (_super) {\n    __extends(b2MouseJointDef, _super);\n    function b2MouseJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_mouseJoint) || this;\n        _this.target = new b2Math_1.b2Vec2();\n        _this.maxForce = 0;\n        _this.frequencyHz = 5;\n        _this.dampingRatio = 0.7;\n        return _this;\n    }\n    return b2MouseJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2MouseJointDef = b2MouseJointDef;\nvar b2MouseJoint = /** @class */ (function (_super) {\n    __extends(b2MouseJoint, _super);\n    function b2MouseJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_localAnchorB = null;\n        _this.m_targetA = null;\n        _this.m_frequencyHz = 0;\n        _this.m_dampingRatio = 0;\n        _this.m_beta = 0;\n        // Solver shared\n        _this.m_impulse = null;\n        _this.m_maxForce = 0;\n        _this.m_gamma = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_rB = null;\n        _this.m_localCenterB = null;\n        _this.m_invMassB = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = null;\n        _this.m_C = null;\n        _this.m_qB = null;\n        _this.m_lalcB = null;\n        _this.m_K = null;\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_targetA = new b2Math_1.b2Vec2();\n        _this.m_impulse = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_mass = new b2Math_1.b2Mat22();\n        _this.m_C = new b2Math_1.b2Vec2();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_K = new b2Math_1.b2Mat22();\n        /// b2Assert(def.target.IsValid());\n        /// b2Assert(b2IsValid(def.maxForce) && def.maxForce >= 0);\n        /// b2Assert(b2IsValid(def.frequencyHz) && def.frequencyHz >= 0);\n        /// b2Assert(b2IsValid(def.dampingRatio) && def.dampingRatio >= 0);\n        _this.m_targetA.Copy(def.target);\n        b2Math_1.b2Transform.MulTXV(_this.m_bodyB.GetTransform(), _this.m_targetA, _this.m_localAnchorB);\n        _this.m_maxForce = def.maxForce;\n        _this.m_impulse.SetZero();\n        _this.m_frequencyHz = def.frequencyHz;\n        _this.m_dampingRatio = def.dampingRatio;\n        _this.m_beta = 0;\n        _this.m_gamma = 0;\n        return _this;\n    }\n    b2MouseJoint.prototype.SetTarget = function (target) {\n        if (!this.m_bodyB.IsAwake()) {\n            this.m_bodyB.SetAwake(true);\n        }\n        this.m_targetA.Copy(target);\n    };\n    b2MouseJoint.prototype.GetTarget = function () {\n        return this.m_targetA;\n    };\n    b2MouseJoint.prototype.SetMaxForce = function (maxForce) {\n        this.m_maxForce = maxForce;\n    };\n    b2MouseJoint.prototype.GetMaxForce = function () {\n        return this.m_maxForce;\n    };\n    b2MouseJoint.prototype.SetFrequency = function (hz) {\n        this.m_frequencyHz = hz;\n    };\n    b2MouseJoint.prototype.GetFrequency = function () {\n        return this.m_frequencyHz;\n    };\n    b2MouseJoint.prototype.SetDampingRatio = function (ratio) {\n        this.m_dampingRatio = ratio;\n    };\n    b2MouseJoint.prototype.GetDampingRatio = function () {\n        return this.m_dampingRatio;\n    };\n    b2MouseJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qB = this.m_qB.SetAngle(aB);\n        var mass = this.m_bodyB.GetMass();\n        // Frequency\n        var omega = 2 * b2Settings_1.b2_pi * this.m_frequencyHz;\n        // Damping coefficient\n        var d = 2 * mass * this.m_dampingRatio * omega;\n        // Spring stiffness\n        var k = mass * (omega * omega);\n        // magic formulas\n        // gamma has units of inverse mass.\n        // beta has units of inverse time.\n        var h = data.step.dt;\n        /// b2Assert(d + h * k > b2_epsilon);\n        this.m_gamma = h * (d + h * k);\n        if (this.m_gamma !== 0) {\n            this.m_gamma = 1 / this.m_gamma;\n        }\n        this.m_beta = h * k * this.m_gamma;\n        // Compute the effective mass matrix.\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // K    = [(1/m1 + 1/m2) * eye(2) - skew(r1) * invI1 * skew(r1) - skew(r2) * invI2 * skew(r2)]\n        //      = [1/m1+1/m2     0    ] + invI1 * [r1.y*r1.y -r1.x*r1.y] + invI2 * [r1.y*r1.y -r1.x*r1.y]\n        //        [    0     1/m1+1/m2]           [-r1.x*r1.y r1.x*r1.x]           [-r1.x*r1.y r1.x*r1.x]\n        var K = this.m_K;\n        K.ex.x = this.m_invMassB + this.m_invIB * this.m_rB.y * this.m_rB.y + this.m_gamma;\n        K.ex.y = -this.m_invIB * this.m_rB.x * this.m_rB.y;\n        K.ey.x = K.ex.y;\n        K.ey.y = this.m_invMassB + this.m_invIB * this.m_rB.x * this.m_rB.x + this.m_gamma;\n        K.GetInverse(this.m_mass);\n        // m_C = cB + m_rB - m_targetA;\n        this.m_C.x = cB.x + this.m_rB.x - this.m_targetA.x;\n        this.m_C.y = cB.y + this.m_rB.y - this.m_targetA.y;\n        // m_C *= m_beta;\n        this.m_C.SelfMul(this.m_beta);\n        // Cheat with some damping\n        wB *= 0.98;\n        if (data.step.warmStarting) {\n            this.m_impulse.SelfMul(data.step.dtRatio);\n            // vB += m_invMassB * m_impulse;\n            vB.x += this.m_invMassB * this.m_impulse.x;\n            vB.y += this.m_invMassB * this.m_impulse.y;\n            wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, this.m_impulse);\n        }\n        else {\n            this.m_impulse.SetZero();\n        }\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2MouseJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // Cdot = v + cross(w, r)\n        // b2Vec2 Cdot = vB + b2Cross(wB, m_rB);\n        var Cdot = b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2MouseJoint.SolveVelocityConstraints_s_Cdot);\n        //  b2Vec2 impulse = b2Mul(m_mass, -(Cdot + m_C + m_gamma * m_impulse));\n        var impulse = b2Math_1.b2Mat22.MulMV(this.m_mass, b2Math_1.b2Vec2.AddVV(Cdot, b2Math_1.b2Vec2.AddVV(this.m_C, b2Math_1.b2Vec2.MulSV(this.m_gamma, this.m_impulse, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0).SelfNeg(), b2MouseJoint.SolveVelocityConstraints_s_impulse);\n        // b2Vec2 oldImpulse = m_impulse;\n        var oldImpulse = b2MouseJoint.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);\n        // m_impulse += impulse;\n        this.m_impulse.SelfAdd(impulse);\n        var maxImpulse = data.step.dt * this.m_maxForce;\n        if (this.m_impulse.LengthSquared() > maxImpulse * maxImpulse) {\n            this.m_impulse.SelfMul(maxImpulse / this.m_impulse.Length());\n        }\n        // impulse = m_impulse - oldImpulse;\n        b2Math_1.b2Vec2.SubVV(this.m_impulse, oldImpulse, impulse);\n        // vB += m_invMassB * impulse;\n        vB.SelfMulAdd(this.m_invMassB, impulse);\n        wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, impulse);\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2MouseJoint.prototype.SolvePositionConstraints = function (data) {\n        return true;\n    };\n    b2MouseJoint.prototype.GetAnchorA = function (out) {\n        return out.Copy(this.m_targetA);\n    };\n    b2MouseJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2MouseJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        return b2Math_1.b2Vec2.MulSV(inv_dt, this.m_impulse, out);\n    };\n    b2MouseJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    b2MouseJoint.prototype.Dump = function (log) {\n        log(\"Mouse joint dumping is not supported.\\n\");\n    };\n    b2MouseJoint.prototype.ShiftOrigin = function (newOrigin) {\n        this.m_targetA.SelfSub(newOrigin);\n    };\n    b2MouseJoint.SolveVelocityConstraints_s_Cdot = new b2Math_1.b2Vec2();\n    b2MouseJoint.SolveVelocityConstraints_s_impulse = new b2Math_1.b2Vec2();\n    b2MouseJoint.SolveVelocityConstraints_s_oldImpulse = new b2Math_1.b2Vec2();\n    return b2MouseJoint;\n}(b2Joint_1.b2Joint));\nexports.b2MouseJoint = b2MouseJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2MouseJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2PrismaticJoint.ts":
/*!*******************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2PrismaticJoint.ts ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Prismatic joint definition. This requires defining a line of\n/// motion using an axis and an anchor point. The definition uses local\n/// anchor points and a local axis so that the initial configuration\n/// can violate the constraint slightly. The joint translation is zero\n/// when the local anchor points coincide in world space. Using local\n/// anchors and a local axis helps when saving and loading a game.\nvar b2PrismaticJointDef = /** @class */ (function (_super) {\n    __extends(b2PrismaticJointDef, _super);\n    function b2PrismaticJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_prismaticJoint) || this;\n        _this.localAnchorA = null;\n        _this.localAnchorB = null;\n        _this.localAxisA = null;\n        _this.referenceAngle = 0;\n        _this.enableLimit = false;\n        _this.lowerTranslation = 0;\n        _this.upperTranslation = 0;\n        _this.enableMotor = false;\n        _this.maxMotorForce = 0;\n        _this.motorSpeed = 0;\n        _this.localAnchorA = new b2Math_1.b2Vec2();\n        _this.localAnchorB = new b2Math_1.b2Vec2();\n        _this.localAxisA = new b2Math_1.b2Vec2(1, 0);\n        return _this;\n    }\n    b2PrismaticJointDef.prototype.Initialize = function (bA, bB, anchor, axis) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.bodyA.GetLocalPoint(anchor, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor, this.localAnchorB);\n        this.bodyA.GetLocalVector(axis, this.localAxisA);\n        this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();\n    };\n    return b2PrismaticJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2PrismaticJointDef = b2PrismaticJointDef;\nvar b2PrismaticJoint = /** @class */ (function (_super) {\n    __extends(b2PrismaticJoint, _super);\n    function b2PrismaticJoint(def) {\n        var _this = _super.call(this, def) || this;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_localXAxisA = new b2Math_1.b2Vec2();\n        _this.m_localYAxisA = new b2Math_1.b2Vec2();\n        _this.m_referenceAngle = 0;\n        _this.m_impulse = new b2Math_1.b2Vec3(0, 0, 0);\n        _this.m_motorImpulse = 0;\n        _this.m_lowerTranslation = 0;\n        _this.m_upperTranslation = 0;\n        _this.m_maxMotorForce = 0;\n        _this.m_motorSpeed = 0;\n        _this.m_enableLimit = false;\n        _this.m_enableMotor = false;\n        _this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_axis = new b2Math_1.b2Vec2(0, 0);\n        _this.m_perp = new b2Math_1.b2Vec2(0, 0);\n        _this.m_s1 = 0;\n        _this.m_s2 = 0;\n        _this.m_a1 = 0;\n        _this.m_a2 = 0;\n        _this.m_K = new b2Math_1.b2Mat33();\n        _this.m_K3 = new b2Math_1.b2Mat33();\n        _this.m_K2 = new b2Math_1.b2Mat22();\n        _this.m_motorMass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_localXAxisA.Copy(def.localAxisA).SelfNormalize();\n        b2Math_1.b2Vec2.CrossOneV(_this.m_localXAxisA, _this.m_localYAxisA);\n        _this.m_referenceAngle = def.referenceAngle;\n        _this.m_lowerTranslation = def.lowerTranslation;\n        _this.m_upperTranslation = def.upperTranslation;\n        _this.m_maxMotorForce = def.maxMotorForce;\n        _this.m_motorSpeed = def.motorSpeed;\n        _this.m_enableLimit = def.enableLimit;\n        _this.m_enableMotor = def.enableMotor;\n        return _this;\n    }\n    b2PrismaticJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // Compute the effective masses.\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // b2Vec2 d = (cB - cA) + rB - rA;\n        var d = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.SubVV(cB, cA, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(rB, rA, b2Math_1.b2Vec2.s_t1), b2PrismaticJoint.InitVelocityConstraints_s_d);\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        // Compute motor Jacobian and effective mass.\n        {\n            // m_axis = b2Mul(qA, m_localXAxisA);\n            b2Math_1.b2Rot.MulRV(qA, this.m_localXAxisA, this.m_axis);\n            // m_a1 = b2Cross(d + rA, m_axis);\n            this.m_a1 = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), this.m_axis);\n            // m_a2 = b2Cross(rB, m_axis);\n            this.m_a2 = b2Math_1.b2Vec2.CrossVV(rB, this.m_axis);\n            this.m_motorMass = mA + mB + iA * this.m_a1 * this.m_a1 + iB * this.m_a2 * this.m_a2;\n            if (this.m_motorMass > 0) {\n                this.m_motorMass = 1 / this.m_motorMass;\n            }\n        }\n        // Prismatic constraint.\n        {\n            // m_perp = b2Mul(qA, m_localYAxisA);\n            b2Math_1.b2Rot.MulRV(qA, this.m_localYAxisA, this.m_perp);\n            // m_s1 = b2Cross(d + rA, m_perp);\n            this.m_s1 = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), this.m_perp);\n            // m_s2 = b2Cross(rB, m_perp);\n            this.m_s2 = b2Math_1.b2Vec2.CrossVV(rB, this.m_perp);\n            // float32 k11 = mA + mB + iA * m_s1 * m_s1 + iB * m_s2 * m_s2;\n            this.m_K.ex.x = mA + mB + iA * this.m_s1 * this.m_s1 + iB * this.m_s2 * this.m_s2;\n            // float32 k12 = iA * m_s1 + iB * m_s2;\n            this.m_K.ex.y = iA * this.m_s1 + iB * this.m_s2;\n            // float32 k13 = iA * m_s1 * m_a1 + iB * m_s2 * m_a2;\n            this.m_K.ex.z = iA * this.m_s1 * this.m_a1 + iB * this.m_s2 * this.m_a2;\n            this.m_K.ey.x = this.m_K.ex.y;\n            // float32 k22 = iA + iB;\n            this.m_K.ey.y = iA + iB;\n            if (this.m_K.ey.y === 0) {\n                // For bodies with fixed rotation.\n                this.m_K.ey.y = 1;\n            }\n            // float32 k23 = iA * m_a1 + iB * m_a2;\n            this.m_K.ey.z = iA * this.m_a1 + iB * this.m_a2;\n            this.m_K.ez.x = this.m_K.ex.z;\n            this.m_K.ez.y = this.m_K.ey.z;\n            // float32 k33 = mA + mB + iA * m_a1 * m_a1 + iB * m_a2 * m_a2;\n            this.m_K.ez.z = mA + mB + iA * this.m_a1 * this.m_a1 + iB * this.m_a2 * this.m_a2;\n            // m_K.ex.Set(k11, k12, k13);\n            // m_K.ey.Set(k12, k22, k23);\n            // m_K.ez.Set(k13, k23, k33);\n        }\n        // Compute motor and limit terms.\n        if (this.m_enableLimit) {\n            // float32 jointTranslation = b2Dot(m_axis, d);\n            var jointTranslation = b2Math_1.b2Vec2.DotVV(this.m_axis, d);\n            if (b2Math_1.b2Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * b2Settings_1.b2_linearSlop) {\n                this.m_limitState = b2Joint_1.b2LimitState.e_equalLimits;\n            }\n            else if (jointTranslation <= this.m_lowerTranslation) {\n                if (this.m_limitState !== b2Joint_1.b2LimitState.e_atLowerLimit) {\n                    this.m_limitState = b2Joint_1.b2LimitState.e_atLowerLimit;\n                    this.m_impulse.z = 0;\n                }\n            }\n            else if (jointTranslation >= this.m_upperTranslation) {\n                if (this.m_limitState !== b2Joint_1.b2LimitState.e_atUpperLimit) {\n                    this.m_limitState = b2Joint_1.b2LimitState.e_atUpperLimit;\n                    this.m_impulse.z = 0;\n                }\n            }\n            else {\n                this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n                this.m_impulse.z = 0;\n            }\n        }\n        else {\n            this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n            this.m_impulse.z = 0;\n        }\n        if (!this.m_enableMotor) {\n            this.m_motorImpulse = 0;\n        }\n        if (data.step.warmStarting) {\n            // Account for variable time step.\n            // m_impulse *= data.step.dtRatio;\n            this.m_impulse.SelfMul(data.step.dtRatio);\n            this.m_motorImpulse *= data.step.dtRatio;\n            // b2Vec2 P = m_impulse.x * m_perp + (m_motorImpulse + m_impulse.z) * m_axis;\n            var P = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.MulSV(this.m_impulse.x, this.m_perp, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.MulSV((this.m_motorImpulse + this.m_impulse.z), this.m_axis, b2Math_1.b2Vec2.s_t1), b2PrismaticJoint.InitVelocityConstraints_s_P);\n            // float32 LA = m_impulse.x * m_s1 + m_impulse.y + (m_motorImpulse + m_impulse.z) * m_a1;\n            var LA = this.m_impulse.x * this.m_s1 + this.m_impulse.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_a1;\n            // float32 LB = m_impulse.x * m_s2 + m_impulse.y + (m_motorImpulse + m_impulse.z) * m_a2;\n            var LB = this.m_impulse.x * this.m_s2 + this.m_impulse.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_a2;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        else {\n            this.m_impulse.SetZero();\n            this.m_motorImpulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2PrismaticJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        // Solve linear motor constraint.\n        if (this.m_enableMotor && this.m_limitState !== b2Joint_1.b2LimitState.e_equalLimits) {\n            // float32 Cdot = b2Dot(m_axis, vB - vA) + m_a2 * wB - m_a1 * wA;\n            var Cdot = b2Math_1.b2Vec2.DotVV(this.m_axis, b2Math_1.b2Vec2.SubVV(vB, vA, b2Math_1.b2Vec2.s_t0)) + this.m_a2 * wB - this.m_a1 * wA;\n            var impulse = this.m_motorMass * (this.m_motorSpeed - Cdot);\n            var oldImpulse = this.m_motorImpulse;\n            var maxImpulse = data.step.dt * this.m_maxMotorForce;\n            this.m_motorImpulse = b2Math_1.b2Clamp(this.m_motorImpulse + impulse, (-maxImpulse), maxImpulse);\n            impulse = this.m_motorImpulse - oldImpulse;\n            // b2Vec2 P = impulse * m_axis;\n            var P = b2Math_1.b2Vec2.MulSV(impulse, this.m_axis, b2PrismaticJoint.SolveVelocityConstraints_s_P);\n            var LA = impulse * this.m_a1;\n            var LB = impulse * this.m_a2;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        // b2Vec2 Cdot1;\n        // Cdot1.x = b2Dot(m_perp, vB - vA) + m_s2 * wB - m_s1 * wA;\n        var Cdot1_x = b2Math_1.b2Vec2.DotVV(this.m_perp, b2Math_1.b2Vec2.SubVV(vB, vA, b2Math_1.b2Vec2.s_t0)) + this.m_s2 * wB - this.m_s1 * wA;\n        // Cdot1.y = wB - wA;\n        var Cdot1_y = wB - wA;\n        if (this.m_enableLimit && this.m_limitState !== b2Joint_1.b2LimitState.e_inactiveLimit) {\n            // Solve prismatic and limit constraint in block form.\n            // float32 Cdot2;\n            // Cdot2 = b2Dot(m_axis, vB - vA) + m_a2 * wB - m_a1 * wA;\n            var Cdot2 = b2Math_1.b2Vec2.DotVV(this.m_axis, b2Math_1.b2Vec2.SubVV(vB, vA, b2Math_1.b2Vec2.s_t0)) + this.m_a2 * wB - this.m_a1 * wA;\n            // b2Vec3 Cdot(Cdot1.x, Cdot1.y, Cdot2);\n            // b2Vec3 f1 = m_impulse;\n            var f1 = b2PrismaticJoint.SolveVelocityConstraints_s_f1.Copy(this.m_impulse);\n            // b2Vec3 df =  m_K.Solve33(-Cdot);\n            var df3 = this.m_K.Solve33((-Cdot1_x), (-Cdot1_y), (-Cdot2), b2PrismaticJoint.SolveVelocityConstraints_s_df3);\n            // m_impulse += df;\n            this.m_impulse.SelfAdd(df3);\n            if (this.m_limitState === b2Joint_1.b2LimitState.e_atLowerLimit) {\n                this.m_impulse.z = b2Math_1.b2Max(this.m_impulse.z, 0);\n            }\n            else if (this.m_limitState === b2Joint_1.b2LimitState.e_atUpperLimit) {\n                this.m_impulse.z = b2Math_1.b2Min(this.m_impulse.z, 0);\n            }\n            // f2(1:2) = invK(1:2,1:2) * (-Cdot(1:2) - K(1:2,3) * (f2(3) - f1(3))) + f1(1:2)\n            // b2Vec2 b = -Cdot1 - (m_impulse.z - f1.z) * b2Vec2(m_K.ez.x, m_K.ez.y);\n            var b_x = (-Cdot1_x) - (this.m_impulse.z - f1.z) * this.m_K.ez.x;\n            var b_y = (-Cdot1_y) - (this.m_impulse.z - f1.z) * this.m_K.ez.y;\n            // b2Vec2 f2r = m_K.Solve22(b) + b2Vec2(f1.x, f1.y);\n            var f2r = this.m_K.Solve22(b_x, b_y, b2PrismaticJoint.SolveVelocityConstraints_s_f2r);\n            f2r.x += f1.x;\n            f2r.y += f1.y;\n            // m_impulse.x = f2r.x;\n            this.m_impulse.x = f2r.x;\n            // m_impulse.y = f2r.y;\n            this.m_impulse.y = f2r.y;\n            // df = m_impulse - f1;\n            df3.x = this.m_impulse.x - f1.x;\n            df3.y = this.m_impulse.y - f1.y;\n            df3.z = this.m_impulse.z - f1.z;\n            // b2Vec2 P = df.x * m_perp + df.z * m_axis;\n            var P = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.MulSV(df3.x, this.m_perp, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.MulSV(df3.z, this.m_axis, b2Math_1.b2Vec2.s_t1), b2PrismaticJoint.SolveVelocityConstraints_s_P);\n            // float32 LA = df.x * m_s1 + df.y + df.z * m_a1;\n            var LA = df3.x * this.m_s1 + df3.y + df3.z * this.m_a1;\n            // float32 LB = df.x * m_s2 + df.y + df.z * m_a2;\n            var LB = df3.x * this.m_s2 + df3.y + df3.z * this.m_a2;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        else {\n            // Limit is inactive, just solve the prismatic constraint in block form.\n            // b2Vec2 df = m_K.Solve22(-Cdot1);\n            var df2 = this.m_K.Solve22((-Cdot1_x), (-Cdot1_y), b2PrismaticJoint.SolveVelocityConstraints_s_df2);\n            this.m_impulse.x += df2.x;\n            this.m_impulse.y += df2.y;\n            // b2Vec2 P = df.x * m_perp;\n            var P = b2Math_1.b2Vec2.MulSV(df2.x, this.m_perp, b2PrismaticJoint.SolveVelocityConstraints_s_P);\n            // float32 LA = df.x * m_s1 + df.y;\n            var LA = df2.x * this.m_s1 + df2.y;\n            // float32 LB = df.x * m_s2 + df.y;\n            var LB = df2.x * this.m_s2 + df2.y;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2PrismaticJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // b2Vec2 d = cB + rB - cA - rA;\n        var d = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), b2PrismaticJoint.SolvePositionConstraints_s_d);\n        // b2Vec2 axis = b2Mul(qA, m_localXAxisA);\n        var axis = b2Math_1.b2Rot.MulRV(qA, this.m_localXAxisA, this.m_axis);\n        // float32 a1 = b2Cross(d + rA, axis);\n        var a1 = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), axis);\n        // float32 a2 = b2Cross(rB, axis);\n        var a2 = b2Math_1.b2Vec2.CrossVV(rB, axis);\n        // b2Vec2 perp = b2Mul(qA, m_localYAxisA);\n        var perp = b2Math_1.b2Rot.MulRV(qA, this.m_localYAxisA, this.m_perp);\n        // float32 s1 = b2Cross(d + rA, perp);\n        var s1 = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), perp);\n        // float32 s2 = b2Cross(rB, perp);\n        var s2 = b2Math_1.b2Vec2.CrossVV(rB, perp);\n        // b2Vec3 impulse;\n        var impulse = b2PrismaticJoint.SolvePositionConstraints_s_impulse;\n        // b2Vec2 C1;\n        // C1.x = b2Dot(perp, d);\n        var C1_x = b2Math_1.b2Vec2.DotVV(perp, d);\n        // C1.y = aB - aA - m_referenceAngle;\n        var C1_y = aB - aA - this.m_referenceAngle;\n        var linearError = b2Math_1.b2Abs(C1_x);\n        var angularError = b2Math_1.b2Abs(C1_y);\n        var active = false;\n        var C2 = 0;\n        if (this.m_enableLimit) {\n            // float32 translation = b2Dot(axis, d);\n            var translation = b2Math_1.b2Vec2.DotVV(axis, d);\n            if (b2Math_1.b2Abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * b2Settings_1.b2_linearSlop) {\n                // Prevent large angular corrections\n                C2 = b2Math_1.b2Clamp(translation, (-b2Settings_1.b2_maxLinearCorrection), b2Settings_1.b2_maxLinearCorrection);\n                linearError = b2Math_1.b2Max(linearError, b2Math_1.b2Abs(translation));\n                active = true;\n            }\n            else if (translation <= this.m_lowerTranslation) {\n                // Prevent large linear corrections and allow some slop.\n                C2 = b2Math_1.b2Clamp(translation - this.m_lowerTranslation + b2Settings_1.b2_linearSlop, (-b2Settings_1.b2_maxLinearCorrection), 0);\n                linearError = b2Math_1.b2Max(linearError, this.m_lowerTranslation - translation);\n                active = true;\n            }\n            else if (translation >= this.m_upperTranslation) {\n                // Prevent large linear corrections and allow some slop.\n                C2 = b2Math_1.b2Clamp(translation - this.m_upperTranslation - b2Settings_1.b2_linearSlop, 0, b2Settings_1.b2_maxLinearCorrection);\n                linearError = b2Math_1.b2Max(linearError, translation - this.m_upperTranslation);\n                active = true;\n            }\n        }\n        if (active) {\n            // float32 k11 = mA + mB + iA * s1 * s1 + iB * s2 * s2;\n            var k11 = mA + mB + iA * s1 * s1 + iB * s2 * s2;\n            // float32 k12 = iA * s1 + iB * s2;\n            var k12 = iA * s1 + iB * s2;\n            // float32 k13 = iA * s1 * a1 + iB * s2 * a2;\n            var k13 = iA * s1 * a1 + iB * s2 * a2;\n            // float32 k22 = iA + iB;\n            var k22 = iA + iB;\n            if (k22 === 0) {\n                // For fixed rotation\n                k22 = 1;\n            }\n            // float32 k23 = iA * a1 + iB * a2;\n            var k23 = iA * a1 + iB * a2;\n            // float32 k33 = mA + mB + iA * a1 * a1 + iB * a2 * a2;\n            var k33 = mA + mB + iA * a1 * a1 + iB * a2 * a2;\n            // b2Mat33 K;\n            var K = this.m_K3;\n            // K.ex.Set(k11, k12, k13);\n            K.ex.SetXYZ(k11, k12, k13);\n            // K.ey.Set(k12, k22, k23);\n            K.ey.SetXYZ(k12, k22, k23);\n            // K.ez.Set(k13, k23, k33);\n            K.ez.SetXYZ(k13, k23, k33);\n            // b2Vec3 C;\n            // C.x = C1.x;\n            // C.y = C1.y;\n            // C.z = C2;\n            // impulse = K.Solve33(-C);\n            impulse = K.Solve33((-C1_x), (-C1_y), (-C2), impulse);\n        }\n        else {\n            // float32 k11 = mA + mB + iA * s1 * s1 + iB * s2 * s2;\n            var k11 = mA + mB + iA * s1 * s1 + iB * s2 * s2;\n            // float32 k12 = iA * s1 + iB * s2;\n            var k12 = iA * s1 + iB * s2;\n            // float32 k22 = iA + iB;\n            var k22 = iA + iB;\n            if (k22 === 0) {\n                k22 = 1;\n            }\n            // b2Mat22 K;\n            var K2 = this.m_K2;\n            // K.ex.Set(k11, k12);\n            K2.ex.Set(k11, k12);\n            // K.ey.Set(k12, k22);\n            K2.ey.Set(k12, k22);\n            // b2Vec2 impulse1 = K.Solve(-C1);\n            var impulse1 = K2.Solve((-C1_x), (-C1_y), b2PrismaticJoint.SolvePositionConstraints_s_impulse1);\n            impulse.x = impulse1.x;\n            impulse.y = impulse1.y;\n            impulse.z = 0;\n        }\n        // b2Vec2 P = impulse.x * perp + impulse.z * axis;\n        var P = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.MulSV(impulse.x, perp, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.MulSV(impulse.z, axis, b2Math_1.b2Vec2.s_t1), b2PrismaticJoint.SolvePositionConstraints_s_P);\n        // float32 LA = impulse.x * s1 + impulse.y + impulse.z * a1;\n        var LA = impulse.x * s1 + impulse.y + impulse.z * a1;\n        // float32 LB = impulse.x * s2 + impulse.y + impulse.z * a2;\n        var LB = impulse.x * s2 + impulse.y + impulse.z * a2;\n        // cA -= mA * P;\n        cA.SelfMulSub(mA, P);\n        aA -= iA * LA;\n        // cB += mB * P;\n        cB.SelfMulAdd(mB, P);\n        aB += iB * LB;\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return linearError <= b2Settings_1.b2_linearSlop && angularError <= b2Settings_1.b2_angularSlop;\n    };\n    b2PrismaticJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2PrismaticJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2PrismaticJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // return inv_dt * (m_impulse.x * m_perp + (m_motorImpulse + m_impulse.z) * m_axis);\n        return out.Set(inv_dt * (this.m_impulse.x * this.m_perp.x + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.x), inv_dt * (this.m_impulse.x * this.m_perp.y + (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.y));\n    };\n    b2PrismaticJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_impulse.y;\n    };\n    b2PrismaticJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2PrismaticJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2PrismaticJoint.prototype.GetLocalAxisA = function () { return this.m_localXAxisA; };\n    b2PrismaticJoint.prototype.GetReferenceAngle = function () { return this.m_referenceAngle; };\n    b2PrismaticJoint.prototype.GetJointTranslation = function () {\n        // b2Vec2 pA = m_bodyA.GetWorldPoint(m_localAnchorA);\n        var pA = this.m_bodyA.GetWorldPoint(this.m_localAnchorA, b2PrismaticJoint.GetJointTranslation_s_pA);\n        // b2Vec2 pB = m_bodyB.GetWorldPoint(m_localAnchorB);\n        var pB = this.m_bodyB.GetWorldPoint(this.m_localAnchorB, b2PrismaticJoint.GetJointTranslation_s_pB);\n        // b2Vec2 d = pB - pA;\n        var d = b2Math_1.b2Vec2.SubVV(pB, pA, b2PrismaticJoint.GetJointTranslation_s_d);\n        // b2Vec2 axis = m_bodyA.GetWorldVector(m_localXAxisA);\n        var axis = this.m_bodyA.GetWorldVector(this.m_localXAxisA, b2PrismaticJoint.GetJointTranslation_s_axis);\n        // float32 translation = b2Dot(d, axis);\n        var translation = b2Math_1.b2Vec2.DotVV(d, axis);\n        return translation;\n    };\n    b2PrismaticJoint.prototype.GetJointSpeed = function () {\n        var bA = this.m_bodyA;\n        var bB = this.m_bodyB;\n        // b2Vec2 rA = b2Mul(bA->m_xf.q, m_localAnchorA - bA->m_sweep.localCenter);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, bA.m_sweep.localCenter, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(bA.m_xf.q, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(bB->m_xf.q, m_localAnchorB - bB->m_sweep.localCenter);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, bB.m_sweep.localCenter, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(bB.m_xf.q, this.m_lalcB, this.m_rB);\n        // b2Vec2 pA = bA->m_sweep.c + rA;\n        var pA = b2Math_1.b2Vec2.AddVV(bA.m_sweep.c, rA, b2Math_1.b2Vec2.s_t0); // pA uses s_t0\n        // b2Vec2 pB = bB->m_sweep.c + rB;\n        var pB = b2Math_1.b2Vec2.AddVV(bB.m_sweep.c, rB, b2Math_1.b2Vec2.s_t1); // pB uses s_t1\n        // b2Vec2 d = pB - pA;\n        var d = b2Math_1.b2Vec2.SubVV(pB, pA, b2Math_1.b2Vec2.s_t2); // d uses s_t2\n        // b2Vec2 axis = b2Mul(bA.m_xf.q, m_localXAxisA);\n        var axis = bA.GetWorldVector(this.m_localXAxisA, this.m_axis);\n        var vA = bA.m_linearVelocity;\n        var vB = bB.m_linearVelocity;\n        var wA = bA.m_angularVelocity;\n        var wB = bB.m_angularVelocity;\n        // float32 speed = b2Dot(d, b2Cross(wA, axis)) + b2Dot(axis, vB + b2Cross(wB, rB) - vA - b2Cross(wA, rA));\n        var speed = b2Math_1.b2Vec2.DotVV(d, b2Math_1.b2Vec2.CrossSV(wA, axis, b2Math_1.b2Vec2.s_t0)) +\n            b2Math_1.b2Vec2.DotVV(axis, b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, rA, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0));\n        return speed;\n    };\n    b2PrismaticJoint.prototype.IsLimitEnabled = function () {\n        return this.m_enableLimit;\n    };\n    b2PrismaticJoint.prototype.EnableLimit = function (flag) {\n        if (flag !== this.m_enableLimit) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_enableLimit = flag;\n            this.m_impulse.z = 0;\n        }\n    };\n    b2PrismaticJoint.prototype.GetLowerLimit = function () {\n        return this.m_lowerTranslation;\n    };\n    b2PrismaticJoint.prototype.GetUpperLimit = function () {\n        return this.m_upperTranslation;\n    };\n    b2PrismaticJoint.prototype.SetLimits = function (lower, upper) {\n        if (lower !== this.m_lowerTranslation || upper !== this.m_upperTranslation) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_lowerTranslation = lower;\n            this.m_upperTranslation = upper;\n            this.m_impulse.z = 0;\n        }\n    };\n    b2PrismaticJoint.prototype.IsMotorEnabled = function () {\n        return this.m_enableMotor;\n    };\n    b2PrismaticJoint.prototype.EnableMotor = function (flag) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_enableMotor = flag;\n    };\n    b2PrismaticJoint.prototype.SetMotorSpeed = function (speed) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_motorSpeed = speed;\n    };\n    b2PrismaticJoint.prototype.GetMotorSpeed = function () {\n        return this.m_motorSpeed;\n    };\n    b2PrismaticJoint.prototype.SetMaxMotorForce = function (force) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_maxMotorForce = force;\n    };\n    b2PrismaticJoint.prototype.GetMaxMotorForce = function () { return this.m_maxMotorForce; };\n    b2PrismaticJoint.prototype.GetMotorForce = function (inv_dt) {\n        return inv_dt * this.m_motorImpulse;\n    };\n    b2PrismaticJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.localAxisA.Set(%.15f, %.15f);\\n\", this.m_localXAxisA.x, this.m_localXAxisA.y);\n        log(\"  jd.referenceAngle = %.15f;\\n\", this.m_referenceAngle);\n        log(\"  jd.enableLimit = %s;\\n\", (this.m_enableLimit) ? (\"true\") : (\"false\"));\n        log(\"  jd.lowerTranslation = %.15f;\\n\", this.m_lowerTranslation);\n        log(\"  jd.upperTranslation = %.15f;\\n\", this.m_upperTranslation);\n        log(\"  jd.enableMotor = %s;\\n\", (this.m_enableMotor) ? (\"true\") : (\"false\"));\n        log(\"  jd.motorSpeed = %.15f;\\n\", this.m_motorSpeed);\n        log(\"  jd.maxMotorForce = %.15f;\\n\", this.m_maxMotorForce);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2PrismaticJoint.InitVelocityConstraints_s_d = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolveVelocityConstraints_s_f2r = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolveVelocityConstraints_s_f1 = new b2Math_1.b2Vec3();\n    b2PrismaticJoint.SolveVelocityConstraints_s_df3 = new b2Math_1.b2Vec3();\n    b2PrismaticJoint.SolveVelocityConstraints_s_df2 = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolvePositionConstraints_s_d = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolvePositionConstraints_s_impulse = new b2Math_1.b2Vec3();\n    b2PrismaticJoint.SolvePositionConstraints_s_impulse1 = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.GetJointTranslation_s_pA = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.GetJointTranslation_s_pB = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.GetJointTranslation_s_d = new b2Math_1.b2Vec2();\n    b2PrismaticJoint.GetJointTranslation_s_axis = new b2Math_1.b2Vec2();\n    return b2PrismaticJoint;\n}(b2Joint_1.b2Joint));\nexports.b2PrismaticJoint = b2PrismaticJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2PrismaticJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2PulleyJoint.ts":
/*!****************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2PulleyJoint.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\nexports.b2_minPulleyLength = 2;\n/// Pulley joint definition. This requires two ground anchors,\n/// two dynamic body anchor points, and a pulley ratio.\nvar b2PulleyJointDef = /** @class */ (function (_super) {\n    __extends(b2PulleyJointDef, _super);\n    function b2PulleyJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_pulleyJoint) || this;\n        _this.groundAnchorA = new b2Math_1.b2Vec2(-1, 1);\n        _this.groundAnchorB = new b2Math_1.b2Vec2(1, 1);\n        _this.localAnchorA = new b2Math_1.b2Vec2(-1, 0);\n        _this.localAnchorB = new b2Math_1.b2Vec2(1, 0);\n        _this.lengthA = 0;\n        _this.lengthB = 0;\n        _this.ratio = 1;\n        _this.collideConnected = true;\n        return _this;\n    }\n    b2PulleyJointDef.prototype.Initialize = function (bA, bB, groundA, groundB, anchorA, anchorB, r) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.groundAnchorA.Copy(groundA);\n        this.groundAnchorB.Copy(groundB);\n        this.bodyA.GetLocalPoint(anchorA, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchorB, this.localAnchorB);\n        this.lengthA = b2Math_1.b2Vec2.DistanceVV(anchorA, groundA);\n        this.lengthB = b2Math_1.b2Vec2.DistanceVV(anchorB, groundB);\n        this.ratio = r;\n        /// b2Assert(this.ratio > b2_epsilon);\n    };\n    return b2PulleyJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2PulleyJointDef = b2PulleyJointDef;\nvar b2PulleyJoint = /** @class */ (function (_super) {\n    __extends(b2PulleyJoint, _super);\n    function b2PulleyJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_groundAnchorA = new b2Math_1.b2Vec2();\n        _this.m_groundAnchorB = new b2Math_1.b2Vec2();\n        _this.m_lengthA = 0;\n        _this.m_lengthB = 0;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_constant = 0;\n        _this.m_ratio = 0;\n        _this.m_impulse = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_uA = new b2Math_1.b2Vec2();\n        _this.m_uB = new b2Math_1.b2Vec2();\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_groundAnchorA.Copy(def.groundAnchorA);\n        _this.m_groundAnchorB.Copy(def.groundAnchorB);\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_lengthA = def.lengthA;\n        _this.m_lengthB = def.lengthB;\n        /// b2Assert(def.ratio !== 0);\n        _this.m_ratio = def.ratio;\n        _this.m_constant = def.lengthA + _this.m_ratio * def.lengthB;\n        _this.m_impulse = 0;\n        return _this;\n    }\n    b2PulleyJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // b2Rot qA(aA), qB(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // Get the pulley axes.\n        // m_uA = cA + m_rA - m_groundAnchorA;\n        this.m_uA.Copy(cA).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA);\n        // m_uB = cB + m_rB - m_groundAnchorB;\n        this.m_uB.Copy(cB).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);\n        var lengthA = this.m_uA.Length();\n        var lengthB = this.m_uB.Length();\n        if (lengthA > 10 * b2Settings_1.b2_linearSlop) {\n            this.m_uA.SelfMul(1 / lengthA);\n        }\n        else {\n            this.m_uA.SetZero();\n        }\n        if (lengthB > 10 * b2Settings_1.b2_linearSlop) {\n            this.m_uB.SelfMul(1 / lengthB);\n        }\n        else {\n            this.m_uB.SetZero();\n        }\n        // Compute effective mass.\n        var ruA = b2Math_1.b2Vec2.CrossVV(this.m_rA, this.m_uA);\n        var ruB = b2Math_1.b2Vec2.CrossVV(this.m_rB, this.m_uB);\n        var mA = this.m_invMassA + this.m_invIA * ruA * ruA;\n        var mB = this.m_invMassB + this.m_invIB * ruB * ruB;\n        this.m_mass = mA + this.m_ratio * this.m_ratio * mB;\n        if (this.m_mass > 0) {\n            this.m_mass = 1 / this.m_mass;\n        }\n        if (data.step.warmStarting) {\n            // Scale impulses to support variable time steps.\n            this.m_impulse *= data.step.dtRatio;\n            // Warm starting.\n            // b2Vec2 PA = -(m_impulse) * m_uA;\n            var PA = b2Math_1.b2Vec2.MulSV(-(this.m_impulse), this.m_uA, b2PulleyJoint.InitVelocityConstraints_s_PA);\n            // b2Vec2 PB = (-m_ratio * m_impulse) * m_uB;\n            var PB = b2Math_1.b2Vec2.MulSV((-this.m_ratio * this.m_impulse), this.m_uB, b2PulleyJoint.InitVelocityConstraints_s_PB);\n            // vA += m_invMassA * PA;\n            vA.SelfMulAdd(this.m_invMassA, PA);\n            wA += this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, PA);\n            // vB += m_invMassB * PB;\n            vB.SelfMulAdd(this.m_invMassB, PB);\n            wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, PB);\n        }\n        else {\n            this.m_impulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2PulleyJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // b2Vec2 vpA = vA + b2Cross(wA, m_rA);\n        var vpA = b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2PulleyJoint.SolveVelocityConstraints_s_vpA);\n        // b2Vec2 vpB = vB + b2Cross(wB, m_rB);\n        var vpB = b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2PulleyJoint.SolveVelocityConstraints_s_vpB);\n        var Cdot = -b2Math_1.b2Vec2.DotVV(this.m_uA, vpA) - this.m_ratio * b2Math_1.b2Vec2.DotVV(this.m_uB, vpB);\n        var impulse = -this.m_mass * Cdot;\n        this.m_impulse += impulse;\n        // b2Vec2 PA = -impulse * m_uA;\n        var PA = b2Math_1.b2Vec2.MulSV(-impulse, this.m_uA, b2PulleyJoint.SolveVelocityConstraints_s_PA);\n        // b2Vec2 PB = -m_ratio * impulse * m_uB;\n        var PB = b2Math_1.b2Vec2.MulSV(-this.m_ratio * impulse, this.m_uB, b2PulleyJoint.SolveVelocityConstraints_s_PB);\n        // vA += m_invMassA * PA;\n        vA.SelfMulAdd(this.m_invMassA, PA);\n        wA += this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, PA);\n        // vB += m_invMassB * PB;\n        vB.SelfMulAdd(this.m_invMassB, PB);\n        wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, PB);\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2PulleyJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        // b2Rot qA(aA), qB(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // Get the pulley axes.\n        // b2Vec2 uA = cA + rA - m_groundAnchorA;\n        var uA = this.m_uA.Copy(cA).SelfAdd(rA).SelfSub(this.m_groundAnchorA);\n        // b2Vec2 uB = cB + rB - m_groundAnchorB;\n        var uB = this.m_uB.Copy(cB).SelfAdd(rB).SelfSub(this.m_groundAnchorB);\n        var lengthA = uA.Length();\n        var lengthB = uB.Length();\n        if (lengthA > 10 * b2Settings_1.b2_linearSlop) {\n            uA.SelfMul(1 / lengthA);\n        }\n        else {\n            uA.SetZero();\n        }\n        if (lengthB > 10 * b2Settings_1.b2_linearSlop) {\n            uB.SelfMul(1 / lengthB);\n        }\n        else {\n            uB.SetZero();\n        }\n        // Compute effective mass.\n        var ruA = b2Math_1.b2Vec2.CrossVV(rA, uA);\n        var ruB = b2Math_1.b2Vec2.CrossVV(rB, uB);\n        var mA = this.m_invMassA + this.m_invIA * ruA * ruA;\n        var mB = this.m_invMassB + this.m_invIB * ruB * ruB;\n        var mass = mA + this.m_ratio * this.m_ratio * mB;\n        if (mass > 0) {\n            mass = 1 / mass;\n        }\n        var C = this.m_constant - lengthA - this.m_ratio * lengthB;\n        var linearError = b2Math_1.b2Abs(C);\n        var impulse = -mass * C;\n        // b2Vec2 PA = -impulse * uA;\n        var PA = b2Math_1.b2Vec2.MulSV(-impulse, uA, b2PulleyJoint.SolvePositionConstraints_s_PA);\n        // b2Vec2 PB = -m_ratio * impulse * uB;\n        var PB = b2Math_1.b2Vec2.MulSV(-this.m_ratio * impulse, uB, b2PulleyJoint.SolvePositionConstraints_s_PB);\n        // cA += m_invMassA * PA;\n        cA.SelfMulAdd(this.m_invMassA, PA);\n        aA += this.m_invIA * b2Math_1.b2Vec2.CrossVV(rA, PA);\n        // cB += m_invMassB * PB;\n        cB.SelfMulAdd(this.m_invMassB, PB);\n        aB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(rB, PB);\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return linearError < b2Settings_1.b2_linearSlop;\n    };\n    b2PulleyJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2PulleyJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2PulleyJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // b2Vec2 P = m_impulse * m_uB;\n        // return inv_dt * P;\n        return out.Set(inv_dt * this.m_impulse * this.m_uB.x, inv_dt * this.m_impulse * this.m_uB.y);\n    };\n    b2PulleyJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    b2PulleyJoint.prototype.GetGroundAnchorA = function () {\n        return this.m_groundAnchorA;\n    };\n    b2PulleyJoint.prototype.GetGroundAnchorB = function () {\n        return this.m_groundAnchorB;\n    };\n    b2PulleyJoint.prototype.GetLengthA = function () {\n        return this.m_lengthA;\n    };\n    b2PulleyJoint.prototype.GetLengthB = function () {\n        return this.m_lengthB;\n    };\n    b2PulleyJoint.prototype.GetRatio = function () {\n        return this.m_ratio;\n    };\n    b2PulleyJoint.prototype.GetCurrentLengthA = function () {\n        // b2Vec2 p = m_bodyA->GetWorldPoint(m_localAnchorA);\n        // b2Vec2 s = m_groundAnchorA;\n        // b2Vec2 d = p - s;\n        // return d.Length();\n        var p = this.m_bodyA.GetWorldPoint(this.m_localAnchorA, b2PulleyJoint.GetCurrentLengthA_s_p);\n        var s = this.m_groundAnchorA;\n        return b2Math_1.b2Vec2.DistanceVV(p, s);\n    };\n    b2PulleyJoint.prototype.GetCurrentLengthB = function () {\n        // b2Vec2 p = m_bodyB->GetWorldPoint(m_localAnchorB);\n        // b2Vec2 s = m_groundAnchorB;\n        // b2Vec2 d = p - s;\n        // return d.Length();\n        var p = this.m_bodyB.GetWorldPoint(this.m_localAnchorB, b2PulleyJoint.GetCurrentLengthB_s_p);\n        var s = this.m_groundAnchorB;\n        return b2Math_1.b2Vec2.DistanceVV(p, s);\n    };\n    b2PulleyJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2PulleyJointDef = new b2PulleyJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.groundAnchorA.Set(%.15f, %.15f);\\n\", this.m_groundAnchorA.x, this.m_groundAnchorA.y);\n        log(\"  jd.groundAnchorB.Set(%.15f, %.15f);\\n\", this.m_groundAnchorB.x, this.m_groundAnchorB.y);\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.lengthA = %.15f;\\n\", this.m_lengthA);\n        log(\"  jd.lengthB = %.15f;\\n\", this.m_lengthB);\n        log(\"  jd.ratio = %.15f;\\n\", this.m_ratio);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2PulleyJoint.prototype.ShiftOrigin = function (newOrigin) {\n        this.m_groundAnchorA.SelfSub(newOrigin);\n        this.m_groundAnchorB.SelfSub(newOrigin);\n    };\n    b2PulleyJoint.InitVelocityConstraints_s_PA = new b2Math_1.b2Vec2();\n    b2PulleyJoint.InitVelocityConstraints_s_PB = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolveVelocityConstraints_s_vpA = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolveVelocityConstraints_s_vpB = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolveVelocityConstraints_s_PA = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolveVelocityConstraints_s_PB = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolvePositionConstraints_s_PA = new b2Math_1.b2Vec2();\n    b2PulleyJoint.SolvePositionConstraints_s_PB = new b2Math_1.b2Vec2();\n    b2PulleyJoint.GetCurrentLengthA_s_p = new b2Math_1.b2Vec2();\n    b2PulleyJoint.GetCurrentLengthB_s_p = new b2Math_1.b2Vec2();\n    return b2PulleyJoint;\n}(b2Joint_1.b2Joint));\nexports.b2PulleyJoint = b2PulleyJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2PulleyJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2RevoluteJoint.ts":
/*!******************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2RevoluteJoint.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Revolute joint definition. This requires defining an\n/// anchor point where the bodies are joined. The definition\n/// uses local anchor points so that the initial configuration\n/// can violate the constraint slightly. You also need to\n/// specify the initial relative angle for joint limits. This\n/// helps when saving and loading a game.\n/// The local anchor points are measured from the body's origin\n/// rather than the center of mass because:\n/// 1. you might not know where the center of mass will be.\n/// 2. if you add/remove shapes from a body and recompute the mass,\n///    the joints will be broken.\nvar b2RevoluteJointDef = /** @class */ (function (_super) {\n    __extends(b2RevoluteJointDef, _super);\n    function b2RevoluteJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_revoluteJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2(0, 0);\n        _this.localAnchorB = new b2Math_1.b2Vec2(0, 0);\n        _this.referenceAngle = 0;\n        _this.enableLimit = false;\n        _this.lowerAngle = 0;\n        _this.upperAngle = 0;\n        _this.enableMotor = false;\n        _this.motorSpeed = 0;\n        _this.maxMotorTorque = 0;\n        return _this;\n    }\n    b2RevoluteJointDef.prototype.Initialize = function (bA, bB, anchor) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.bodyA.GetLocalPoint(anchor, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor, this.localAnchorB);\n        this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();\n    };\n    return b2RevoluteJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2RevoluteJointDef = b2RevoluteJointDef;\nvar b2RevoluteJoint = /** @class */ (function (_super) {\n    __extends(b2RevoluteJoint, _super);\n    function b2RevoluteJoint(def) {\n        var _this = _super.call(this, def) || this;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_impulse = new b2Math_1.b2Vec3();\n        _this.m_motorImpulse = 0;\n        _this.m_enableMotor = false;\n        _this.m_maxMotorTorque = 0;\n        _this.m_motorSpeed = 0;\n        _this.m_enableLimit = false;\n        _this.m_referenceAngle = 0;\n        _this.m_lowerAngle = 0;\n        _this.m_upperAngle = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = new b2Math_1.b2Mat33(); // effective mass for point-to-point constraint.\n        _this.m_motorMass = 0; // effective mass for motor/limit angular constraint.\n        _this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_K = new b2Math_1.b2Mat22();\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_referenceAngle = def.referenceAngle;\n        _this.m_impulse.SetZero();\n        _this.m_motorImpulse = 0;\n        _this.m_lowerAngle = def.lowerAngle;\n        _this.m_upperAngle = def.upperAngle;\n        _this.m_maxMotorTorque = def.maxMotorTorque;\n        _this.m_motorSpeed = def.motorSpeed;\n        _this.m_enableLimit = def.enableLimit;\n        _this.m_enableMotor = def.enableMotor;\n        _this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n        return _this;\n    }\n    b2RevoluteJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // b2Rot qA(aA), qB(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // J = [-I -r1_skew I r2_skew]\n        //     [ 0       -1 0       1]\n        // r_skew = [-ry; rx]\n        // Matlab\n        // K = [ mA+r1y^2*iA+mB+r2y^2*iB,  -r1y*iA*r1x-r2y*iB*r2x,          -r1y*iA-r2y*iB]\n        //     [  -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB,           r1x*iA+r2x*iB]\n        //     [          -r1y*iA-r2y*iB,           r1x*iA+r2x*iB,                   iA+iB]\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var fixedRotation = (iA + iB === 0);\n        this.m_mass.ex.x = mA + mB + this.m_rA.y * this.m_rA.y * iA + this.m_rB.y * this.m_rB.y * iB;\n        this.m_mass.ey.x = -this.m_rA.y * this.m_rA.x * iA - this.m_rB.y * this.m_rB.x * iB;\n        this.m_mass.ez.x = -this.m_rA.y * iA - this.m_rB.y * iB;\n        this.m_mass.ex.y = this.m_mass.ey.x;\n        this.m_mass.ey.y = mA + mB + this.m_rA.x * this.m_rA.x * iA + this.m_rB.x * this.m_rB.x * iB;\n        this.m_mass.ez.y = this.m_rA.x * iA + this.m_rB.x * iB;\n        this.m_mass.ex.z = this.m_mass.ez.x;\n        this.m_mass.ey.z = this.m_mass.ez.y;\n        this.m_mass.ez.z = iA + iB;\n        this.m_motorMass = iA + iB;\n        if (this.m_motorMass > 0) {\n            this.m_motorMass = 1 / this.m_motorMass;\n        }\n        if (!this.m_enableMotor || fixedRotation) {\n            this.m_motorImpulse = 0;\n        }\n        if (this.m_enableLimit && !fixedRotation) {\n            var jointAngle = aB - aA - this.m_referenceAngle;\n            if (b2Math_1.b2Abs(this.m_upperAngle - this.m_lowerAngle) < 2 * b2Settings_1.b2_angularSlop) {\n                this.m_limitState = b2Joint_1.b2LimitState.e_equalLimits;\n            }\n            else if (jointAngle <= this.m_lowerAngle) {\n                if (this.m_limitState !== b2Joint_1.b2LimitState.e_atLowerLimit) {\n                    this.m_impulse.z = 0;\n                }\n                this.m_limitState = b2Joint_1.b2LimitState.e_atLowerLimit;\n            }\n            else if (jointAngle >= this.m_upperAngle) {\n                if (this.m_limitState !== b2Joint_1.b2LimitState.e_atUpperLimit) {\n                    this.m_impulse.z = 0;\n                }\n                this.m_limitState = b2Joint_1.b2LimitState.e_atUpperLimit;\n            }\n            else {\n                this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n                this.m_impulse.z = 0;\n            }\n        }\n        else {\n            this.m_limitState = b2Joint_1.b2LimitState.e_inactiveLimit;\n        }\n        if (data.step.warmStarting) {\n            // Scale impulses to support a variable time step.\n            this.m_impulse.SelfMul(data.step.dtRatio);\n            this.m_motorImpulse *= data.step.dtRatio;\n            // b2Vec2 P(m_impulse.x, m_impulse.y);\n            var P = b2RevoluteJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x, this.m_impulse.y);\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + this.m_motorImpulse + this.m_impulse.z);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + this.m_motorImpulse + this.m_impulse.z);\n        }\n        else {\n            this.m_impulse.SetZero();\n            this.m_motorImpulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2RevoluteJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var fixedRotation = (iA + iB === 0);\n        // Solve motor constraint.\n        if (this.m_enableMotor && this.m_limitState !== b2Joint_1.b2LimitState.e_equalLimits && !fixedRotation) {\n            var Cdot = wB - wA - this.m_motorSpeed;\n            var impulse = -this.m_motorMass * Cdot;\n            var oldImpulse = this.m_motorImpulse;\n            var maxImpulse = data.step.dt * this.m_maxMotorTorque;\n            this.m_motorImpulse = b2Math_1.b2Clamp(this.m_motorImpulse + impulse, -maxImpulse, maxImpulse);\n            impulse = this.m_motorImpulse - oldImpulse;\n            wA -= iA * impulse;\n            wB += iB * impulse;\n        }\n        // Solve limit constraint.\n        if (this.m_enableLimit && this.m_limitState !== b2Joint_1.b2LimitState.e_inactiveLimit && !fixedRotation) {\n            // b2Vec2 Cdot1 = vB + b2Cross(wB, m_rB) - vA - b2Cross(wA, m_rA);\n            var Cdot1 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2Math_1.b2Vec2.s_t1), b2RevoluteJoint.SolveVelocityConstraints_s_Cdot1);\n            var Cdot2 = wB - wA;\n            // b2Vec3 Cdot(Cdot1.x, Cdot1.y, Cdot2);\n            // b2Vec3 impulse = -this.m_mass.Solve33(Cdot);\n            var impulse_v3 = this.m_mass.Solve33(Cdot1.x, Cdot1.y, Cdot2, b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v3).SelfNeg();\n            if (this.m_limitState === b2Joint_1.b2LimitState.e_equalLimits) {\n                this.m_impulse.SelfAdd(impulse_v3);\n            }\n            else if (this.m_limitState === b2Joint_1.b2LimitState.e_atLowerLimit) {\n                var newImpulse = this.m_impulse.z + impulse_v3.z;\n                if (newImpulse < 0) {\n                    // b2Vec2 rhs = -Cdot1 + m_impulse.z * b2Vec2(m_mass.ez.x, m_mass.ez.y);\n                    var rhs_x = -Cdot1.x + this.m_impulse.z * this.m_mass.ez.x;\n                    var rhs_y = -Cdot1.y + this.m_impulse.z * this.m_mass.ez.y;\n                    var reduced_v2 = this.m_mass.Solve22(rhs_x, rhs_y, b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2);\n                    impulse_v3.x = reduced_v2.x;\n                    impulse_v3.y = reduced_v2.y;\n                    impulse_v3.z = -this.m_impulse.z;\n                    this.m_impulse.x += reduced_v2.x;\n                    this.m_impulse.y += reduced_v2.y;\n                    this.m_impulse.z = 0;\n                }\n                else {\n                    this.m_impulse.SelfAdd(impulse_v3);\n                }\n            }\n            else if (this.m_limitState === b2Joint_1.b2LimitState.e_atUpperLimit) {\n                var newImpulse = this.m_impulse.z + impulse_v3.z;\n                if (newImpulse > 0) {\n                    // b2Vec2 rhs = -Cdot1 + m_impulse.z * b2Vec2(m_mass.ez.x, m_mass.ez.y);\n                    var rhs_x = -Cdot1.x + this.m_impulse.z * this.m_mass.ez.x;\n                    var rhs_y = -Cdot1.y + this.m_impulse.z * this.m_mass.ez.y;\n                    var reduced_v2 = this.m_mass.Solve22(rhs_x, rhs_y, b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2);\n                    impulse_v3.x = reduced_v2.x;\n                    impulse_v3.y = reduced_v2.y;\n                    impulse_v3.z = -this.m_impulse.z;\n                    this.m_impulse.x += reduced_v2.x;\n                    this.m_impulse.y += reduced_v2.y;\n                    this.m_impulse.z = 0;\n                }\n                else {\n                    this.m_impulse.SelfAdd(impulse_v3);\n                }\n            }\n            // b2Vec2 P(impulse.x, impulse.y);\n            var P = b2RevoluteJoint.SolveVelocityConstraints_s_P.Set(impulse_v3.x, impulse_v3.y);\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + impulse_v3.z);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + impulse_v3.z);\n        }\n        else {\n            // Solve point-to-point constraint\n            // b2Vec2 Cdot = vB + b2Cross(wB, m_rB) - vA - b2Cross(wA, m_rA);\n            var Cdot_v2 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2Math_1.b2Vec2.s_t1), b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2);\n            // b2Vec2 impulse = m_mass.Solve22(-Cdot);\n            var impulse_v2 = this.m_mass.Solve22(-Cdot_v2.x, -Cdot_v2.y, b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2);\n            this.m_impulse.x += impulse_v2.x;\n            this.m_impulse.y += impulse_v2.y;\n            // vA -= mA * impulse;\n            vA.SelfMulSub(mA, impulse_v2);\n            wA -= iA * b2Math_1.b2Vec2.CrossVV(this.m_rA, impulse_v2);\n            // vB += mB * impulse;\n            vB.SelfMulAdd(mB, impulse_v2);\n            wB += iB * b2Math_1.b2Vec2.CrossVV(this.m_rB, impulse_v2);\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2RevoluteJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        // b2Rot qA(aA), qB(aB);\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        var angularError = 0;\n        var positionError = 0;\n        var fixedRotation = (this.m_invIA + this.m_invIB === 0);\n        // Solve angular limit constraint.\n        if (this.m_enableLimit && this.m_limitState !== b2Joint_1.b2LimitState.e_inactiveLimit && !fixedRotation) {\n            var angle = aB - aA - this.m_referenceAngle;\n            var limitImpulse = 0;\n            if (this.m_limitState === b2Joint_1.b2LimitState.e_equalLimits) {\n                // Prevent large angular corrections\n                var C = b2Math_1.b2Clamp(angle - this.m_lowerAngle, -b2Settings_1.b2_maxAngularCorrection, b2Settings_1.b2_maxAngularCorrection);\n                limitImpulse = -this.m_motorMass * C;\n                angularError = b2Math_1.b2Abs(C);\n            }\n            else if (this.m_limitState === b2Joint_1.b2LimitState.e_atLowerLimit) {\n                var C = angle - this.m_lowerAngle;\n                angularError = -C;\n                // Prevent large angular corrections and allow some slop.\n                C = b2Math_1.b2Clamp(C + b2Settings_1.b2_angularSlop, -b2Settings_1.b2_maxAngularCorrection, 0);\n                limitImpulse = -this.m_motorMass * C;\n            }\n            else if (this.m_limitState === b2Joint_1.b2LimitState.e_atUpperLimit) {\n                var C = angle - this.m_upperAngle;\n                angularError = C;\n                // Prevent large angular corrections and allow some slop.\n                C = b2Math_1.b2Clamp(C - b2Settings_1.b2_angularSlop, 0, b2Settings_1.b2_maxAngularCorrection);\n                limitImpulse = -this.m_motorMass * C;\n            }\n            aA -= this.m_invIA * limitImpulse;\n            aB += this.m_invIB * limitImpulse;\n        }\n        // Solve point-to-point constraint.\n        {\n            qA.SetAngle(aA);\n            qB.SetAngle(aB);\n            // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n            var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n            // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n            b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n            var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n            // b2Vec2 C = cB + rB - cA - rA;\n            var C_v2 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), b2RevoluteJoint.SolvePositionConstraints_s_C_v2);\n            // positionError = C.Length();\n            positionError = C_v2.Length();\n            var mA = this.m_invMassA, mB = this.m_invMassB;\n            var iA = this.m_invIA, iB = this.m_invIB;\n            var K = this.m_K;\n            K.ex.x = mA + mB + iA * rA.y * rA.y + iB * rB.y * rB.y;\n            K.ex.y = -iA * rA.x * rA.y - iB * rB.x * rB.y;\n            K.ey.x = K.ex.y;\n            K.ey.y = mA + mB + iA * rA.x * rA.x + iB * rB.x * rB.x;\n            // b2Vec2 impulse = -K.Solve(C);\n            var impulse = K.Solve(C_v2.x, C_v2.y, b2RevoluteJoint.SolvePositionConstraints_s_impulse).SelfNeg();\n            // cA -= mA * impulse;\n            cA.SelfMulSub(mA, impulse);\n            aA -= iA * b2Math_1.b2Vec2.CrossVV(rA, impulse);\n            // cB += mB * impulse;\n            cB.SelfMulAdd(mB, impulse);\n            aB += iB * b2Math_1.b2Vec2.CrossVV(rB, impulse);\n        }\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return positionError <= b2Settings_1.b2_linearSlop && angularError <= b2Settings_1.b2_angularSlop;\n    };\n    b2RevoluteJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2RevoluteJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2RevoluteJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // b2Vec2 P(this.m_impulse.x, this.m_impulse.y);\n        // return inv_dt * P;\n        return out.Set(inv_dt * this.m_impulse.x, inv_dt * this.m_impulse.y);\n    };\n    b2RevoluteJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_impulse.z;\n    };\n    b2RevoluteJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2RevoluteJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2RevoluteJoint.prototype.GetReferenceAngle = function () { return this.m_referenceAngle; };\n    b2RevoluteJoint.prototype.GetJointAngle = function () {\n        // b2Body* bA = this.m_bodyA;\n        // b2Body* bB = this.m_bodyB;\n        // return bB->this.m_sweep.a - bA->this.m_sweep.a - this.m_referenceAngle;\n        return this.m_bodyB.m_sweep.a - this.m_bodyA.m_sweep.a - this.m_referenceAngle;\n    };\n    b2RevoluteJoint.prototype.GetJointSpeed = function () {\n        // b2Body* bA = this.m_bodyA;\n        // b2Body* bB = this.m_bodyB;\n        // return bB->this.m_angularVelocity - bA->this.m_angularVelocity;\n        return this.m_bodyB.m_angularVelocity - this.m_bodyA.m_angularVelocity;\n    };\n    b2RevoluteJoint.prototype.IsMotorEnabled = function () {\n        return this.m_enableMotor;\n    };\n    b2RevoluteJoint.prototype.EnableMotor = function (flag) {\n        if (this.m_enableMotor !== flag) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_enableMotor = flag;\n        }\n    };\n    b2RevoluteJoint.prototype.GetMotorTorque = function (inv_dt) {\n        return inv_dt * this.m_motorImpulse;\n    };\n    b2RevoluteJoint.prototype.GetMotorSpeed = function () {\n        return this.m_motorSpeed;\n    };\n    b2RevoluteJoint.prototype.SetMaxMotorTorque = function (torque) {\n        this.m_maxMotorTorque = torque;\n    };\n    b2RevoluteJoint.prototype.GetMaxMotorTorque = function () { return this.m_maxMotorTorque; };\n    b2RevoluteJoint.prototype.IsLimitEnabled = function () {\n        return this.m_enableLimit;\n    };\n    b2RevoluteJoint.prototype.EnableLimit = function (flag) {\n        if (flag !== this.m_enableLimit) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_enableLimit = flag;\n            this.m_impulse.z = 0;\n        }\n    };\n    b2RevoluteJoint.prototype.GetLowerLimit = function () {\n        return this.m_lowerAngle;\n    };\n    b2RevoluteJoint.prototype.GetUpperLimit = function () {\n        return this.m_upperAngle;\n    };\n    b2RevoluteJoint.prototype.SetLimits = function (lower, upper) {\n        if (lower !== this.m_lowerAngle || upper !== this.m_upperAngle) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_impulse.z = 0;\n            this.m_lowerAngle = lower;\n            this.m_upperAngle = upper;\n        }\n    };\n    b2RevoluteJoint.prototype.SetMotorSpeed = function (speed) {\n        if (this.m_motorSpeed !== speed) {\n            this.m_bodyA.SetAwake(true);\n            this.m_bodyB.SetAwake(true);\n            this.m_motorSpeed = speed;\n        }\n    };\n    b2RevoluteJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.referenceAngle = %.15f;\\n\", this.m_referenceAngle);\n        log(\"  jd.enableLimit = %s;\\n\", (this.m_enableLimit) ? (\"true\") : (\"false\"));\n        log(\"  jd.lowerAngle = %.15f;\\n\", this.m_lowerAngle);\n        log(\"  jd.upperAngle = %.15f;\\n\", this.m_upperAngle);\n        log(\"  jd.enableMotor = %s;\\n\", (this.m_enableMotor) ? (\"true\") : (\"false\"));\n        log(\"  jd.motorSpeed = %.15f;\\n\", this.m_motorSpeed);\n        log(\"  jd.maxMotorTorque = %.15f;\\n\", this.m_maxMotorTorque);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2RevoluteJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolveVelocityConstraints_s_Cdot_v2 = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolveVelocityConstraints_s_Cdot1 = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v3 = new b2Math_1.b2Vec3();\n    b2RevoluteJoint.SolveVelocityConstraints_s_reduced_v2 = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolveVelocityConstraints_s_impulse_v2 = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolvePositionConstraints_s_C_v2 = new b2Math_1.b2Vec2();\n    b2RevoluteJoint.SolvePositionConstraints_s_impulse = new b2Math_1.b2Vec2();\n    return b2RevoluteJoint;\n}(b2Joint_1.b2Joint));\nexports.b2RevoluteJoint = b2RevoluteJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2RevoluteJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2RopeJoint.ts":
/*!**************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2RopeJoint.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Rope joint definition. This requires two body anchor points and\n/// a maximum lengths.\n/// Note: by default the connected objects will not collide.\n/// see collideConnected in b2JointDef.\nvar b2RopeJointDef = /** @class */ (function (_super) {\n    __extends(b2RopeJointDef, _super);\n    function b2RopeJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_ropeJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2(-1, 0);\n        _this.localAnchorB = new b2Math_1.b2Vec2(1, 0);\n        _this.maxLength = 0;\n        return _this;\n    }\n    return b2RopeJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2RopeJointDef = b2RopeJointDef;\nvar b2RopeJoint = /** @class */ (function (_super) {\n    __extends(b2RopeJoint, _super);\n    function b2RopeJoint(def) {\n        var _this = _super.call(this, def) || this;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_maxLength = 0;\n        _this.m_length = 0;\n        _this.m_impulse = 0;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_u = new b2Math_1.b2Vec2();\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = 0;\n        _this.m_state = b2Joint_1.b2LimitState.e_inactiveLimit;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_maxLength = def.maxLength;\n        return _this;\n    }\n    b2RopeJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // this.m_rA = b2Mul(qA, this.m_localAnchorA - this.m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // this.m_rB = b2Mul(qB, this.m_localAnchorB - this.m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // this.m_u = cB + this.m_rB - cA - this.m_rA;\n        this.m_u.Copy(cB).SelfAdd(this.m_rB).SelfSub(cA).SelfSub(this.m_rA);\n        this.m_length = this.m_u.Length();\n        var C = this.m_length - this.m_maxLength;\n        if (C > 0) {\n            this.m_state = b2Joint_1.b2LimitState.e_atUpperLimit;\n        }\n        else {\n            this.m_state = b2Joint_1.b2LimitState.e_inactiveLimit;\n        }\n        if (this.m_length > b2Settings_1.b2_linearSlop) {\n            this.m_u.SelfMul(1 / this.m_length);\n        }\n        else {\n            this.m_u.SetZero();\n            this.m_mass = 0;\n            this.m_impulse = 0;\n            return;\n        }\n        // Compute effective mass.\n        var crA = b2Math_1.b2Vec2.CrossVV(this.m_rA, this.m_u);\n        var crB = b2Math_1.b2Vec2.CrossVV(this.m_rB, this.m_u);\n        var invMass = this.m_invMassA + this.m_invIA * crA * crA + this.m_invMassB + this.m_invIB * crB * crB;\n        this.m_mass = invMass !== 0 ? 1 / invMass : 0;\n        if (data.step.warmStarting) {\n            // Scale the impulse to support a variable time step.\n            this.m_impulse *= data.step.dtRatio;\n            // b2Vec2 P = m_impulse * m_u;\n            var P = b2Math_1.b2Vec2.MulSV(this.m_impulse, this.m_u, b2RopeJoint.InitVelocityConstraints_s_P);\n            // vA -= m_invMassA * P;\n            vA.SelfMulSub(this.m_invMassA, P);\n            wA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, P);\n            // vB += m_invMassB * P;\n            vB.SelfMulAdd(this.m_invMassB, P);\n            wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, P);\n        }\n        else {\n            this.m_impulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2RopeJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // Cdot = dot(u, v + cross(w, r))\n        // b2Vec2 vpA = vA + b2Cross(wA, m_rA);\n        var vpA = b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2RopeJoint.SolveVelocityConstraints_s_vpA);\n        // b2Vec2 vpB = vB + b2Cross(wB, m_rB);\n        var vpB = b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2RopeJoint.SolveVelocityConstraints_s_vpB);\n        // float32 C = m_length - m_maxLength;\n        var C = this.m_length - this.m_maxLength;\n        // float32 Cdot = b2Dot(m_u, vpB - vpA);\n        var Cdot = b2Math_1.b2Vec2.DotVV(this.m_u, b2Math_1.b2Vec2.SubVV(vpB, vpA, b2Math_1.b2Vec2.s_t0));\n        // Predictive constraint.\n        if (C < 0) {\n            Cdot += data.step.inv_dt * C;\n        }\n        var impulse = -this.m_mass * Cdot;\n        var oldImpulse = this.m_impulse;\n        this.m_impulse = b2Math_1.b2Min(0, this.m_impulse + impulse);\n        impulse = this.m_impulse - oldImpulse;\n        // b2Vec2 P = impulse * m_u;\n        var P = b2Math_1.b2Vec2.MulSV(impulse, this.m_u, b2RopeJoint.SolveVelocityConstraints_s_P);\n        // vA -= m_invMassA * P;\n        vA.SelfMulSub(this.m_invMassA, P);\n        wA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(this.m_rA, P);\n        // vB += m_invMassB * P;\n        vB.SelfMulAdd(this.m_invMassB, P);\n        wB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(this.m_rB, P);\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2RopeJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // b2Vec2 rA = b2Mul(qA, this.m_localAnchorA - this.m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, this.m_localAnchorB - this.m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // b2Vec2 u = cB + rB - cA - rA;\n        var u = this.m_u.Copy(cB).SelfAdd(rB).SelfSub(cA).SelfSub(rA);\n        var length = u.Normalize();\n        var C = length - this.m_maxLength;\n        C = b2Math_1.b2Clamp(C, 0, b2Settings_1.b2_maxLinearCorrection);\n        var impulse = -this.m_mass * C;\n        // b2Vec2 P = impulse * u;\n        var P = b2Math_1.b2Vec2.MulSV(impulse, u, b2RopeJoint.SolvePositionConstraints_s_P);\n        // cA -= m_invMassA * P;\n        cA.SelfMulSub(this.m_invMassA, P);\n        aA -= this.m_invIA * b2Math_1.b2Vec2.CrossVV(rA, P);\n        // cB += m_invMassB * P;\n        cB.SelfMulAdd(this.m_invMassB, P);\n        aB += this.m_invIB * b2Math_1.b2Vec2.CrossVV(rB, P);\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return length - this.m_maxLength < b2Settings_1.b2_linearSlop;\n    };\n    b2RopeJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2RopeJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2RopeJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        var F = b2Math_1.b2Vec2.MulSV((inv_dt * this.m_impulse), this.m_u, out);\n        return F;\n        // return out.Set(inv_dt * this.m_linearImpulse.x, inv_dt * this.m_linearImpulse.y);\n    };\n    b2RopeJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return 0;\n    };\n    b2RopeJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2RopeJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2RopeJoint.prototype.SetMaxLength = function (length) { this.m_maxLength = length; };\n    b2RopeJoint.prototype.GetMaxLength = function () {\n        return this.m_maxLength;\n    };\n    b2RopeJoint.prototype.GetLimitState = function () {\n        return this.m_state;\n    };\n    b2RopeJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2RopeJointDef = new b2RopeJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.maxLength = %.15f;\\n\", this.m_maxLength);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2RopeJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2RopeJoint.SolveVelocityConstraints_s_vpA = new b2Math_1.b2Vec2();\n    b2RopeJoint.SolveVelocityConstraints_s_vpB = new b2Math_1.b2Vec2();\n    b2RopeJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2RopeJoint.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    return b2RopeJoint;\n}(b2Joint_1.b2Joint));\nexports.b2RopeJoint = b2RopeJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2RopeJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2WeldJoint.ts":
/*!**************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2WeldJoint.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Weld joint definition. You need to specify local anchor points\n/// where they are attached and the relative body angle. The position\n/// of the anchor points is important for computing the reaction torque.\nvar b2WeldJointDef = /** @class */ (function (_super) {\n    __extends(b2WeldJointDef, _super);\n    function b2WeldJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_weldJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2();\n        _this.localAnchorB = new b2Math_1.b2Vec2();\n        _this.referenceAngle = 0;\n        _this.frequencyHz = 0;\n        _this.dampingRatio = 0;\n        return _this;\n    }\n    b2WeldJointDef.prototype.Initialize = function (bA, bB, anchor) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.bodyA.GetLocalPoint(anchor, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor, this.localAnchorB);\n        this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle();\n    };\n    return b2WeldJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2WeldJointDef = b2WeldJointDef;\nvar b2WeldJoint = /** @class */ (function (_super) {\n    __extends(b2WeldJoint, _super);\n    function b2WeldJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_frequencyHz = 0;\n        _this.m_dampingRatio = 0;\n        _this.m_bias = 0;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_referenceAngle = 0;\n        _this.m_gamma = 0;\n        _this.m_impulse = new b2Math_1.b2Vec3(0, 0, 0);\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_mass = new b2Math_1.b2Mat33();\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_K = new b2Math_1.b2Mat33();\n        _this.m_frequencyHz = def.frequencyHz;\n        _this.m_dampingRatio = def.dampingRatio;\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_referenceAngle = def.referenceAngle;\n        _this.m_impulse.SetZero();\n        return _this;\n    }\n    b2WeldJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // m_rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // m_rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // J = [-I -r1_skew I r2_skew]\n        //     [ 0       -1 0       1]\n        // r_skew = [-ry; rx]\n        // Matlab\n        // K = [ mA+r1y^2*iA+mB+r2y^2*iB,  -r1y*iA*r1x-r2y*iB*r2x,          -r1y*iA-r2y*iB]\n        //     [  -r1y*iA*r1x-r2y*iB*r2x, mA+r1x^2*iA+mB+r2x^2*iB,           r1x*iA+r2x*iB]\n        //     [          -r1y*iA-r2y*iB,           r1x*iA+r2x*iB,                   iA+iB]\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var K = this.m_K;\n        K.ex.x = mA + mB + this.m_rA.y * this.m_rA.y * iA + this.m_rB.y * this.m_rB.y * iB;\n        K.ey.x = -this.m_rA.y * this.m_rA.x * iA - this.m_rB.y * this.m_rB.x * iB;\n        K.ez.x = -this.m_rA.y * iA - this.m_rB.y * iB;\n        K.ex.y = K.ey.x;\n        K.ey.y = mA + mB + this.m_rA.x * this.m_rA.x * iA + this.m_rB.x * this.m_rB.x * iB;\n        K.ez.y = this.m_rA.x * iA + this.m_rB.x * iB;\n        K.ex.z = K.ez.x;\n        K.ey.z = K.ez.y;\n        K.ez.z = iA + iB;\n        if (this.m_frequencyHz > 0) {\n            K.GetInverse22(this.m_mass);\n            var invM = iA + iB;\n            var m = invM > 0 ? 1 / invM : 0;\n            var C = aB - aA - this.m_referenceAngle;\n            // Frequency\n            var omega = 2 * b2Settings_1.b2_pi * this.m_frequencyHz;\n            // Damping coefficient\n            var d = 2 * m * this.m_dampingRatio * omega;\n            // Spring stiffness\n            var k = m * omega * omega;\n            // magic formulas\n            var h = data.step.dt;\n            this.m_gamma = h * (d + h * k);\n            this.m_gamma = this.m_gamma !== 0 ? 1 / this.m_gamma : 0;\n            this.m_bias = C * h * k * this.m_gamma;\n            invM += this.m_gamma;\n            this.m_mass.ez.z = invM !== 0 ? 1 / invM : 0;\n        }\n        else {\n            K.GetSymInverse33(this.m_mass);\n            this.m_gamma = 0;\n            this.m_bias = 0;\n        }\n        if (data.step.warmStarting) {\n            // Scale impulses to support a variable time step.\n            this.m_impulse.SelfMul(data.step.dtRatio);\n            // b2Vec2 P(m_impulse.x, m_impulse.y);\n            var P = b2WeldJoint.InitVelocityConstraints_s_P.Set(this.m_impulse.x, this.m_impulse.y);\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + this.m_impulse.z);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + this.m_impulse.z);\n        }\n        else {\n            this.m_impulse.SetZero();\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2WeldJoint.prototype.SolveVelocityConstraints = function (data) {\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        if (this.m_frequencyHz > 0) {\n            var Cdot2 = wB - wA;\n            var impulse2 = -this.m_mass.ez.z * (Cdot2 + this.m_bias + this.m_gamma * this.m_impulse.z);\n            this.m_impulse.z += impulse2;\n            wA -= iA * impulse2;\n            wB += iB * impulse2;\n            // b2Vec2 Cdot1 = vB + b2Vec2.CrossSV(wB, this.m_rB) - vA - b2Vec2.CrossSV(wA, this.m_rA);\n            var Cdot1 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2Math_1.b2Vec2.s_t1), b2WeldJoint.SolveVelocityConstraints_s_Cdot1);\n            // b2Vec2 impulse1 = -b2Mul22(m_mass, Cdot1);\n            var impulse1 = b2Math_1.b2Mat33.MulM33XY(this.m_mass, Cdot1.x, Cdot1.y, b2WeldJoint.SolveVelocityConstraints_s_impulse1).SelfNeg();\n            this.m_impulse.x += impulse1.x;\n            this.m_impulse.y += impulse1.y;\n            // b2Vec2 P = impulse1;\n            var P = impulse1;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            // wA -= iA * b2Cross(m_rA, P);\n            wA -= iA * b2Math_1.b2Vec2.CrossVV(this.m_rA, P);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            // wB += iB * b2Cross(m_rB, P);\n            wB += iB * b2Math_1.b2Vec2.CrossVV(this.m_rB, P);\n        }\n        else {\n            // b2Vec2 Cdot1 = vB + b2Cross(wB, this.m_rB) - vA - b2Cross(wA, this.m_rA);\n            var Cdot1 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, this.m_rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, this.m_rA, b2Math_1.b2Vec2.s_t1), b2WeldJoint.SolveVelocityConstraints_s_Cdot1);\n            var Cdot2 = wB - wA;\n            // b2Vec3 const Cdot(Cdot1.x, Cdot1.y, Cdot2);\n            // b2Vec3 impulse = -b2Mul(m_mass, Cdot);\n            var impulse = b2Math_1.b2Mat33.MulM33XYZ(this.m_mass, Cdot1.x, Cdot1.y, Cdot2, b2WeldJoint.SolveVelocityConstraints_s_impulse).SelfNeg();\n            this.m_impulse.SelfAdd(impulse);\n            // b2Vec2 P(impulse.x, impulse.y);\n            var P = b2WeldJoint.SolveVelocityConstraints_s_P.Set(impulse.x, impulse.y);\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + impulse.z);\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + impulse.z);\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2WeldJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        var positionError, angularError;\n        var K = this.m_K;\n        K.ex.x = mA + mB + rA.y * rA.y * iA + rB.y * rB.y * iB;\n        K.ey.x = -rA.y * rA.x * iA - rB.y * rB.x * iB;\n        K.ez.x = -rA.y * iA - rB.y * iB;\n        K.ex.y = K.ey.x;\n        K.ey.y = mA + mB + rA.x * rA.x * iA + rB.x * rB.x * iB;\n        K.ez.y = rA.x * iA + rB.x * iB;\n        K.ex.z = K.ez.x;\n        K.ey.z = K.ez.y;\n        K.ez.z = iA + iB;\n        if (this.m_frequencyHz > 0) {\n            // b2Vec2 C1 =  cB + rB - cA - rA;\n            var C1 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), b2WeldJoint.SolvePositionConstraints_s_C1);\n            positionError = C1.Length();\n            angularError = 0;\n            // b2Vec2 P = -K.Solve22(C1);\n            var P = K.Solve22(C1.x, C1.y, b2WeldJoint.SolvePositionConstraints_s_P).SelfNeg();\n            // cA -= mA * P;\n            cA.SelfMulSub(mA, P);\n            aA -= iA * b2Math_1.b2Vec2.CrossVV(rA, P);\n            // cB += mB * P;\n            cB.SelfMulAdd(mB, P);\n            aB += iB * b2Math_1.b2Vec2.CrossVV(rB, P);\n        }\n        else {\n            // b2Vec2 C1 =  cB + rB - cA - rA;\n            var C1 = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), b2WeldJoint.SolvePositionConstraints_s_C1);\n            var C2 = aB - aA - this.m_referenceAngle;\n            positionError = C1.Length();\n            angularError = b2Math_1.b2Abs(C2);\n            // b2Vec3 C(C1.x, C1.y, C2);\n            // b2Vec3 impulse = -K.Solve33(C);\n            var impulse = K.Solve33(C1.x, C1.y, C2, b2WeldJoint.SolvePositionConstraints_s_impulse).SelfNeg();\n            // b2Vec2 P(impulse.x, impulse.y);\n            var P = b2WeldJoint.SolvePositionConstraints_s_P.Set(impulse.x, impulse.y);\n            // cA -= mA * P;\n            cA.SelfMulSub(mA, P);\n            aA -= iA * (b2Math_1.b2Vec2.CrossVV(this.m_rA, P) + impulse.z);\n            // cB += mB * P;\n            cB.SelfMulAdd(mB, P);\n            aB += iB * (b2Math_1.b2Vec2.CrossVV(this.m_rB, P) + impulse.z);\n        }\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return positionError <= b2Settings_1.b2_linearSlop && angularError <= b2Settings_1.b2_angularSlop;\n    };\n    b2WeldJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2WeldJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2WeldJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // b2Vec2 P(this.m_impulse.x, this.m_impulse.y);\n        // return inv_dt * P;\n        return out.Set(inv_dt * this.m_impulse.x, inv_dt * this.m_impulse.y);\n    };\n    b2WeldJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_impulse.z;\n    };\n    b2WeldJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2WeldJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2WeldJoint.prototype.GetReferenceAngle = function () { return this.m_referenceAngle; };\n    b2WeldJoint.prototype.SetFrequency = function (hz) { this.m_frequencyHz = hz; };\n    b2WeldJoint.prototype.GetFrequency = function () { return this.m_frequencyHz; };\n    b2WeldJoint.prototype.SetDampingRatio = function (ratio) { this.m_dampingRatio = ratio; };\n    b2WeldJoint.prototype.GetDampingRatio = function () { return this.m_dampingRatio; };\n    b2WeldJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2WeldJointDef = new b2WeldJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.referenceAngle = %.15f;\\n\", this.m_referenceAngle);\n        log(\"  jd.frequencyHz = %.15f;\\n\", this.m_frequencyHz);\n        log(\"  jd.dampingRatio = %.15f;\\n\", this.m_dampingRatio);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2WeldJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolveVelocityConstraints_s_Cdot1 = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolveVelocityConstraints_s_impulse1 = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolveVelocityConstraints_s_impulse = new b2Math_1.b2Vec3();\n    b2WeldJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolvePositionConstraints_s_C1 = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    b2WeldJoint.SolvePositionConstraints_s_impulse = new b2Math_1.b2Vec3();\n    return b2WeldJoint;\n}(b2Joint_1.b2Joint));\nexports.b2WeldJoint = b2WeldJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2WeldJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/Joints/b2WheelJoint.ts":
/*!***************************************************!*\
  !*** ./src/Box2D/Dynamics/Joints/b2WheelJoint.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\n/// Wheel joint definition. This requires defining a line of\n/// motion using an axis and an anchor point. The definition uses local\n/// anchor points and a local axis so that the initial configuration\n/// can violate the constraint slightly. The joint translation is zero\n/// when the local anchor points coincide in world space. Using local\n/// anchors and a local axis helps when saving and loading a game.\nvar b2WheelJointDef = /** @class */ (function (_super) {\n    __extends(b2WheelJointDef, _super);\n    function b2WheelJointDef() {\n        var _this = _super.call(this, b2Joint_1.b2JointType.e_wheelJoint) || this;\n        _this.localAnchorA = new b2Math_1.b2Vec2(0, 0);\n        _this.localAnchorB = new b2Math_1.b2Vec2(0, 0);\n        _this.localAxisA = new b2Math_1.b2Vec2(1, 0);\n        _this.enableMotor = false;\n        _this.maxMotorTorque = 0;\n        _this.motorSpeed = 0;\n        _this.frequencyHz = 2;\n        _this.dampingRatio = 0.7;\n        return _this;\n    }\n    b2WheelJointDef.prototype.Initialize = function (bA, bB, anchor, axis) {\n        this.bodyA = bA;\n        this.bodyB = bB;\n        this.bodyA.GetLocalPoint(anchor, this.localAnchorA);\n        this.bodyB.GetLocalPoint(anchor, this.localAnchorB);\n        this.bodyA.GetLocalVector(axis, this.localAxisA);\n    };\n    return b2WheelJointDef;\n}(b2Joint_1.b2JointDef));\nexports.b2WheelJointDef = b2WheelJointDef;\nvar b2WheelJoint = /** @class */ (function (_super) {\n    __extends(b2WheelJoint, _super);\n    function b2WheelJoint(def) {\n        var _this = _super.call(this, def) || this;\n        _this.m_frequencyHz = 0;\n        _this.m_dampingRatio = 0;\n        // Solver shared\n        _this.m_localAnchorA = new b2Math_1.b2Vec2();\n        _this.m_localAnchorB = new b2Math_1.b2Vec2();\n        _this.m_localXAxisA = new b2Math_1.b2Vec2();\n        _this.m_localYAxisA = new b2Math_1.b2Vec2();\n        _this.m_impulse = 0;\n        _this.m_motorImpulse = 0;\n        _this.m_springImpulse = 0;\n        _this.m_maxMotorTorque = 0;\n        _this.m_motorSpeed = 0;\n        _this.m_enableMotor = false;\n        // Solver temp\n        _this.m_indexA = 0;\n        _this.m_indexB = 0;\n        _this.m_localCenterA = new b2Math_1.b2Vec2();\n        _this.m_localCenterB = new b2Math_1.b2Vec2();\n        _this.m_invMassA = 0;\n        _this.m_invMassB = 0;\n        _this.m_invIA = 0;\n        _this.m_invIB = 0;\n        _this.m_ax = new b2Math_1.b2Vec2();\n        _this.m_ay = new b2Math_1.b2Vec2();\n        _this.m_sAx = 0;\n        _this.m_sBx = 0;\n        _this.m_sAy = 0;\n        _this.m_sBy = 0;\n        _this.m_mass = 0;\n        _this.m_motorMass = 0;\n        _this.m_springMass = 0;\n        _this.m_bias = 0;\n        _this.m_gamma = 0;\n        _this.m_qA = new b2Math_1.b2Rot();\n        _this.m_qB = new b2Math_1.b2Rot();\n        _this.m_lalcA = new b2Math_1.b2Vec2();\n        _this.m_lalcB = new b2Math_1.b2Vec2();\n        _this.m_rA = new b2Math_1.b2Vec2();\n        _this.m_rB = new b2Math_1.b2Vec2();\n        _this.m_frequencyHz = def.frequencyHz;\n        _this.m_dampingRatio = def.dampingRatio;\n        _this.m_localAnchorA.Copy(def.localAnchorA);\n        _this.m_localAnchorB.Copy(def.localAnchorB);\n        _this.m_localXAxisA.Copy(def.localAxisA);\n        b2Math_1.b2Vec2.CrossOneV(_this.m_localXAxisA, _this.m_localYAxisA);\n        _this.m_maxMotorTorque = def.maxMotorTorque;\n        _this.m_motorSpeed = def.motorSpeed;\n        _this.m_enableMotor = def.enableMotor;\n        _this.m_ax.SetZero();\n        _this.m_ay.SetZero();\n        return _this;\n    }\n    b2WheelJoint.prototype.GetMotorSpeed = function () {\n        return this.m_motorSpeed;\n    };\n    b2WheelJoint.prototype.GetMaxMotorTorque = function () {\n        return this.m_maxMotorTorque;\n    };\n    b2WheelJoint.prototype.SetSpringFrequencyHz = function (hz) {\n        this.m_frequencyHz = hz;\n    };\n    b2WheelJoint.prototype.GetSpringFrequencyHz = function () {\n        return this.m_frequencyHz;\n    };\n    b2WheelJoint.prototype.SetSpringDampingRatio = function (ratio) {\n        this.m_dampingRatio = ratio;\n    };\n    b2WheelJoint.prototype.GetSpringDampingRatio = function () {\n        return this.m_dampingRatio;\n    };\n    b2WheelJoint.prototype.InitVelocityConstraints = function (data) {\n        this.m_indexA = this.m_bodyA.m_islandIndex;\n        this.m_indexB = this.m_bodyB.m_islandIndex;\n        this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);\n        this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);\n        this.m_invMassA = this.m_bodyA.m_invMass;\n        this.m_invMassB = this.m_bodyB.m_invMass;\n        this.m_invIA = this.m_bodyA.m_invI;\n        this.m_invIB = this.m_bodyB.m_invI;\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // Compute the effective masses.\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // b2Vec2 d = cB + rB - cA - rA;\n        var d = b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVV(cB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVV(cA, rA, b2Math_1.b2Vec2.s_t1), b2WheelJoint.InitVelocityConstraints_s_d);\n        // Point to line constraint\n        {\n            // m_ay = b2Mul(qA, m_localYAxisA);\n            b2Math_1.b2Rot.MulRV(qA, this.m_localYAxisA, this.m_ay);\n            // m_sAy = b2Cross(d + rA, m_ay);\n            this.m_sAy = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), this.m_ay);\n            // m_sBy = b2Cross(rB, m_ay);\n            this.m_sBy = b2Math_1.b2Vec2.CrossVV(rB, this.m_ay);\n            this.m_mass = mA + mB + iA * this.m_sAy * this.m_sAy + iB * this.m_sBy * this.m_sBy;\n            if (this.m_mass > 0) {\n                this.m_mass = 1 / this.m_mass;\n            }\n        }\n        // Spring constraint\n        this.m_springMass = 0;\n        this.m_bias = 0;\n        this.m_gamma = 0;\n        if (this.m_frequencyHz > 0) {\n            // m_ax = b2Mul(qA, m_localXAxisA);\n            b2Math_1.b2Rot.MulRV(qA, this.m_localXAxisA, this.m_ax);\n            // m_sAx = b2Cross(d + rA, m_ax);\n            this.m_sAx = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), this.m_ax);\n            // m_sBx = b2Cross(rB, m_ax);\n            this.m_sBx = b2Math_1.b2Vec2.CrossVV(rB, this.m_ax);\n            var invMass = mA + mB + iA * this.m_sAx * this.m_sAx + iB * this.m_sBx * this.m_sBx;\n            if (invMass > 0) {\n                this.m_springMass = 1 / invMass;\n                var C = b2Math_1.b2Vec2.DotVV(d, this.m_ax);\n                // Frequency\n                var omega = 2 * b2Settings_1.b2_pi * this.m_frequencyHz;\n                // Damping coefficient\n                var dc = 2 * this.m_springMass * this.m_dampingRatio * omega;\n                // Spring stiffness\n                var k = this.m_springMass * omega * omega;\n                // magic formulas\n                var h = data.step.dt;\n                this.m_gamma = h * (dc + h * k);\n                if (this.m_gamma > 0) {\n                    this.m_gamma = 1 / this.m_gamma;\n                }\n                this.m_bias = C * h * k * this.m_gamma;\n                this.m_springMass = invMass + this.m_gamma;\n                if (this.m_springMass > 0) {\n                    this.m_springMass = 1 / this.m_springMass;\n                }\n            }\n        }\n        else {\n            this.m_springImpulse = 0;\n        }\n        // Rotational motor\n        if (this.m_enableMotor) {\n            this.m_motorMass = iA + iB;\n            if (this.m_motorMass > 0) {\n                this.m_motorMass = 1 / this.m_motorMass;\n            }\n        }\n        else {\n            this.m_motorMass = 0;\n            this.m_motorImpulse = 0;\n        }\n        if (data.step.warmStarting) {\n            // Account for variable time step.\n            this.m_impulse *= data.step.dtRatio;\n            this.m_springImpulse *= data.step.dtRatio;\n            this.m_motorImpulse *= data.step.dtRatio;\n            // b2Vec2 P = m_impulse * m_ay + m_springImpulse * m_ax;\n            var P = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.MulSV(this.m_impulse, this.m_ay, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.MulSV(this.m_springImpulse, this.m_ax, b2Math_1.b2Vec2.s_t1), b2WheelJoint.InitVelocityConstraints_s_P);\n            // float32 LA = m_impulse * m_sAy + m_springImpulse * m_sAx + m_motorImpulse;\n            var LA = this.m_impulse * this.m_sAy + this.m_springImpulse * this.m_sAx + this.m_motorImpulse;\n            // float32 LB = m_impulse * m_sBy + m_springImpulse * m_sBx + m_motorImpulse;\n            var LB = this.m_impulse * this.m_sBy + this.m_springImpulse * this.m_sBx + this.m_motorImpulse;\n            // vA -= m_invMassA * P;\n            vA.SelfMulSub(this.m_invMassA, P);\n            wA -= this.m_invIA * LA;\n            // vB += m_invMassB * P;\n            vB.SelfMulAdd(this.m_invMassB, P);\n            wB += this.m_invIB * LB;\n        }\n        else {\n            this.m_impulse = 0;\n            this.m_springImpulse = 0;\n            this.m_motorImpulse = 0;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2WheelJoint.prototype.SolveVelocityConstraints = function (data) {\n        var mA = this.m_invMassA, mB = this.m_invMassB;\n        var iA = this.m_invIA, iB = this.m_invIB;\n        var vA = data.velocities[this.m_indexA].v;\n        var wA = data.velocities[this.m_indexA].w;\n        var vB = data.velocities[this.m_indexB].v;\n        var wB = data.velocities[this.m_indexB].w;\n        // Solve spring constraint\n        {\n            var Cdot = b2Math_1.b2Vec2.DotVV(this.m_ax, b2Math_1.b2Vec2.SubVV(vB, vA, b2Math_1.b2Vec2.s_t0)) + this.m_sBx * wB - this.m_sAx * wA;\n            var impulse = -this.m_springMass * (Cdot + this.m_bias + this.m_gamma * this.m_springImpulse);\n            this.m_springImpulse += impulse;\n            // b2Vec2 P = impulse * m_ax;\n            var P = b2Math_1.b2Vec2.MulSV(impulse, this.m_ax, b2WheelJoint.SolveVelocityConstraints_s_P);\n            var LA = impulse * this.m_sAx;\n            var LB = impulse * this.m_sBx;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        // Solve rotational motor constraint\n        {\n            var Cdot = wB - wA - this.m_motorSpeed;\n            var impulse = -this.m_motorMass * Cdot;\n            var oldImpulse = this.m_motorImpulse;\n            var maxImpulse = data.step.dt * this.m_maxMotorTorque;\n            this.m_motorImpulse = b2Math_1.b2Clamp(this.m_motorImpulse + impulse, -maxImpulse, maxImpulse);\n            impulse = this.m_motorImpulse - oldImpulse;\n            wA -= iA * impulse;\n            wB += iB * impulse;\n        }\n        // Solve point to line constraint\n        {\n            var Cdot = b2Math_1.b2Vec2.DotVV(this.m_ay, b2Math_1.b2Vec2.SubVV(vB, vA, b2Math_1.b2Vec2.s_t0)) + this.m_sBy * wB - this.m_sAy * wA;\n            var impulse = -this.m_mass * Cdot;\n            this.m_impulse += impulse;\n            // b2Vec2 P = impulse * m_ay;\n            var P = b2Math_1.b2Vec2.MulSV(impulse, this.m_ay, b2WheelJoint.SolveVelocityConstraints_s_P);\n            var LA = impulse * this.m_sAy;\n            var LB = impulse * this.m_sBy;\n            // vA -= mA * P;\n            vA.SelfMulSub(mA, P);\n            wA -= iA * LA;\n            // vB += mB * P;\n            vB.SelfMulAdd(mB, P);\n            wB += iB * LB;\n        }\n        // data.velocities[this.m_indexA].v = vA;\n        data.velocities[this.m_indexA].w = wA;\n        // data.velocities[this.m_indexB].v = vB;\n        data.velocities[this.m_indexB].w = wB;\n    };\n    b2WheelJoint.prototype.SolvePositionConstraints = function (data) {\n        var cA = data.positions[this.m_indexA].c;\n        var aA = data.positions[this.m_indexA].a;\n        var cB = data.positions[this.m_indexB].c;\n        var aB = data.positions[this.m_indexB].a;\n        var qA = this.m_qA.SetAngle(aA), qB = this.m_qB.SetAngle(aB);\n        // b2Vec2 rA = b2Mul(qA, m_localAnchorA - m_localCenterA);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, this.m_localCenterA, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(qA, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(qB, m_localAnchorB - m_localCenterB);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, this.m_localCenterB, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(qB, this.m_lalcB, this.m_rB);\n        // b2Vec2 d = (cB - cA) + rB - rA;\n        var d = b2Math_1.b2Vec2.AddVV(b2Math_1.b2Vec2.SubVV(cB, cA, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.SubVV(rB, rA, b2Math_1.b2Vec2.s_t1), b2WheelJoint.SolvePositionConstraints_s_d);\n        // b2Vec2 ay = b2Mul(qA, m_localYAxisA);\n        var ay = b2Math_1.b2Rot.MulRV(qA, this.m_localYAxisA, this.m_ay);\n        // float32 sAy = b2Cross(d + rA, ay);\n        var sAy = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.AddVV(d, rA, b2Math_1.b2Vec2.s_t0), ay);\n        // float32 sBy = b2Cross(rB, ay);\n        var sBy = b2Math_1.b2Vec2.CrossVV(rB, ay);\n        // float32 C = b2Dot(d, ay);\n        var C = b2Math_1.b2Vec2.DotVV(d, this.m_ay);\n        var k = this.m_invMassA + this.m_invMassB + this.m_invIA * this.m_sAy * this.m_sAy + this.m_invIB * this.m_sBy * this.m_sBy;\n        var impulse;\n        if (k !== 0) {\n            impulse = -C / k;\n        }\n        else {\n            impulse = 0;\n        }\n        // b2Vec2 P = impulse * ay;\n        var P = b2Math_1.b2Vec2.MulSV(impulse, ay, b2WheelJoint.SolvePositionConstraints_s_P);\n        var LA = impulse * sAy;\n        var LB = impulse * sBy;\n        // cA -= m_invMassA * P;\n        cA.SelfMulSub(this.m_invMassA, P);\n        aA -= this.m_invIA * LA;\n        // cB += m_invMassB * P;\n        cB.SelfMulAdd(this.m_invMassB, P);\n        aB += this.m_invIB * LB;\n        // data.positions[this.m_indexA].c = cA;\n        data.positions[this.m_indexA].a = aA;\n        // data.positions[this.m_indexB].c = cB;\n        data.positions[this.m_indexB].a = aB;\n        return b2Math_1.b2Abs(C) <= b2Settings_1.b2_linearSlop;\n    };\n    b2WheelJoint.prototype.GetDefinition = function (def) {\n        /// b2Assert(false); // TODO\n        return def;\n    };\n    b2WheelJoint.prototype.GetAnchorA = function (out) {\n        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA, out);\n    };\n    b2WheelJoint.prototype.GetAnchorB = function (out) {\n        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB, out);\n    };\n    b2WheelJoint.prototype.GetReactionForce = function (inv_dt, out) {\n        // return inv_dt * (m_impulse * m_ay + m_springImpulse * m_ax);\n        out.x = inv_dt * (this.m_impulse * this.m_ay.x + this.m_springImpulse * this.m_ax.x);\n        out.y = inv_dt * (this.m_impulse * this.m_ay.y + this.m_springImpulse * this.m_ax.y);\n        return out;\n    };\n    b2WheelJoint.prototype.GetReactionTorque = function (inv_dt) {\n        return inv_dt * this.m_motorImpulse;\n    };\n    b2WheelJoint.prototype.GetLocalAnchorA = function () { return this.m_localAnchorA; };\n    b2WheelJoint.prototype.GetLocalAnchorB = function () { return this.m_localAnchorB; };\n    b2WheelJoint.prototype.GetLocalAxisA = function () { return this.m_localXAxisA; };\n    b2WheelJoint.prototype.GetJointTranslation = function () {\n        return this.GetPrismaticJointTranslation();\n    };\n    b2WheelJoint.prototype.GetJointSpeed = function () {\n        return this.GetRevoluteJointSpeed();\n    };\n    b2WheelJoint.prototype.GetPrismaticJointTranslation = function () {\n        var bA = this.m_bodyA;\n        var bB = this.m_bodyB;\n        var pA = bA.GetWorldPoint(this.m_localAnchorA, new b2Math_1.b2Vec2());\n        var pB = bB.GetWorldPoint(this.m_localAnchorB, new b2Math_1.b2Vec2());\n        var d = b2Math_1.b2Vec2.SubVV(pB, pA, new b2Math_1.b2Vec2());\n        var axis = bA.GetWorldVector(this.m_localXAxisA, new b2Math_1.b2Vec2());\n        var translation = b2Math_1.b2Vec2.DotVV(d, axis);\n        return translation;\n    };\n    b2WheelJoint.prototype.GetPrismaticJointSpeed = function () {\n        var bA = this.m_bodyA;\n        var bB = this.m_bodyB;\n        // b2Vec2 rA = b2Mul(bA->m_xf.q, m_localAnchorA - bA->m_sweep.localCenter);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorA, bA.m_sweep.localCenter, this.m_lalcA);\n        var rA = b2Math_1.b2Rot.MulRV(bA.m_xf.q, this.m_lalcA, this.m_rA);\n        // b2Vec2 rB = b2Mul(bB->m_xf.q, m_localAnchorB - bB->m_sweep.localCenter);\n        b2Math_1.b2Vec2.SubVV(this.m_localAnchorB, bB.m_sweep.localCenter, this.m_lalcB);\n        var rB = b2Math_1.b2Rot.MulRV(bB.m_xf.q, this.m_lalcB, this.m_rB);\n        // b2Vec2 pA = bA->m_sweep.c + rA;\n        var pA = b2Math_1.b2Vec2.AddVV(bA.m_sweep.c, rA, b2Math_1.b2Vec2.s_t0); // pA uses s_t0\n        // b2Vec2 pB = bB->m_sweep.c + rB;\n        var pB = b2Math_1.b2Vec2.AddVV(bB.m_sweep.c, rB, b2Math_1.b2Vec2.s_t1); // pB uses s_t1\n        // b2Vec2 d = pB - pA;\n        var d = b2Math_1.b2Vec2.SubVV(pB, pA, b2Math_1.b2Vec2.s_t2); // d uses s_t2\n        // b2Vec2 axis = b2Mul(bA.m_xf.q, m_localXAxisA);\n        var axis = bA.GetWorldVector(this.m_localXAxisA, new b2Math_1.b2Vec2());\n        var vA = bA.m_linearVelocity;\n        var vB = bB.m_linearVelocity;\n        var wA = bA.m_angularVelocity;\n        var wB = bB.m_angularVelocity;\n        // float32 speed = b2Dot(d, b2Cross(wA, axis)) + b2Dot(axis, vB + b2Cross(wB, rB) - vA - b2Cross(wA, rA));\n        var speed = b2Math_1.b2Vec2.DotVV(d, b2Math_1.b2Vec2.CrossSV(wA, axis, b2Math_1.b2Vec2.s_t0)) +\n            b2Math_1.b2Vec2.DotVV(axis, b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.AddVCrossSV(vB, wB, rB, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.AddVCrossSV(vA, wA, rA, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0));\n        return speed;\n    };\n    b2WheelJoint.prototype.GetRevoluteJointAngle = function () {\n        // b2Body* bA = this.m_bodyA;\n        // b2Body* bB = this.m_bodyB;\n        // return bB->this.m_sweep.a - bA->this.m_sweep.a;\n        return this.m_bodyB.m_sweep.a - this.m_bodyA.m_sweep.a;\n    };\n    b2WheelJoint.prototype.GetRevoluteJointSpeed = function () {\n        var wA = this.m_bodyA.m_angularVelocity;\n        var wB = this.m_bodyB.m_angularVelocity;\n        return wB - wA;\n    };\n    b2WheelJoint.prototype.IsMotorEnabled = function () {\n        return this.m_enableMotor;\n    };\n    b2WheelJoint.prototype.EnableMotor = function (flag) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_enableMotor = flag;\n    };\n    b2WheelJoint.prototype.SetMotorSpeed = function (speed) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_motorSpeed = speed;\n    };\n    b2WheelJoint.prototype.SetMaxMotorTorque = function (force) {\n        this.m_bodyA.SetAwake(true);\n        this.m_bodyB.SetAwake(true);\n        this.m_maxMotorTorque = force;\n    };\n    b2WheelJoint.prototype.GetMotorTorque = function (inv_dt) {\n        return inv_dt * this.m_motorImpulse;\n    };\n    b2WheelJoint.prototype.Dump = function (log) {\n        var indexA = this.m_bodyA.m_islandIndex;\n        var indexB = this.m_bodyB.m_islandIndex;\n        log(\"  const jd: b2WheelJointDef = new b2WheelJointDef();\\n\");\n        log(\"  jd.bodyA = bodies[%d];\\n\", indexA);\n        log(\"  jd.bodyB = bodies[%d];\\n\", indexB);\n        log(\"  jd.collideConnected = %s;\\n\", (this.m_collideConnected) ? (\"true\") : (\"false\"));\n        log(\"  jd.localAnchorA.Set(%.15f, %.15f);\\n\", this.m_localAnchorA.x, this.m_localAnchorA.y);\n        log(\"  jd.localAnchorB.Set(%.15f, %.15f);\\n\", this.m_localAnchorB.x, this.m_localAnchorB.y);\n        log(\"  jd.localAxisA.Set(%.15f, %.15f);\\n\", this.m_localXAxisA.x, this.m_localXAxisA.y);\n        log(\"  jd.enableMotor = %s;\\n\", (this.m_enableMotor) ? (\"true\") : (\"false\"));\n        log(\"  jd.motorSpeed = %.15f;\\n\", this.m_motorSpeed);\n        log(\"  jd.maxMotorTorque = %.15f;\\n\", this.m_maxMotorTorque);\n        log(\"  jd.frequencyHz = %.15f;\\n\", this.m_frequencyHz);\n        log(\"  jd.dampingRatio = %.15f;\\n\", this.m_dampingRatio);\n        log(\"  joints[%d] = this.m_world.CreateJoint(jd);\\n\", this.m_index);\n    };\n    b2WheelJoint.InitVelocityConstraints_s_d = new b2Math_1.b2Vec2();\n    b2WheelJoint.InitVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2WheelJoint.SolveVelocityConstraints_s_P = new b2Math_1.b2Vec2();\n    b2WheelJoint.SolvePositionConstraints_s_d = new b2Math_1.b2Vec2();\n    b2WheelJoint.SolvePositionConstraints_s_P = new b2Math_1.b2Vec2();\n    return b2WheelJoint;\n}(b2Joint_1.b2Joint));\nexports.b2WheelJoint = b2WheelJoint;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/Joints/b2WheelJoint.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2Body.ts":
/*!**************************************!*\
  !*** ./src/Box2D/Dynamics/b2Body.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Shape_1 = __webpack_require__(/*! ../Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Fixture_1 = __webpack_require__(/*! ./b2Fixture */ \"./src/Box2D/Dynamics/b2Fixture.ts\");\n// #endif\n/// The body type.\n/// static: zero mass, zero velocity, may be manually moved\n/// kinematic: zero mass, non-zero velocity set by user, moved by solver\n/// dynamic: positive mass, non-zero velocity determined by forces, moved by solver\nvar b2BodyType;\n(function (b2BodyType) {\n    b2BodyType[b2BodyType[\"b2_unknown\"] = -1] = \"b2_unknown\";\n    b2BodyType[b2BodyType[\"b2_staticBody\"] = 0] = \"b2_staticBody\";\n    b2BodyType[b2BodyType[\"b2_kinematicBody\"] = 1] = \"b2_kinematicBody\";\n    b2BodyType[b2BodyType[\"b2_dynamicBody\"] = 2] = \"b2_dynamicBody\";\n    // TODO_ERIN\n    // b2_bulletBody = 3\n})(b2BodyType = exports.b2BodyType || (exports.b2BodyType = {}));\n/// A body definition holds all the data needed to construct a rigid body.\n/// You can safely re-use body definitions. Shapes are added to a body after construction.\nvar b2BodyDef = /** @class */ (function () {\n    function b2BodyDef() {\n        /// The body type: static, kinematic, or dynamic.\n        /// Note: if a dynamic body would have zero mass, the mass is set to one.\n        this.type = b2BodyType.b2_staticBody;\n        /// The world position of the body. Avoid creating bodies at the origin\n        /// since this can lead to many overlapping shapes.\n        this.position = new b2Math_1.b2Vec2(0, 0);\n        /// The world angle of the body in radians.\n        this.angle = 0;\n        /// The linear velocity of the body's origin in world co-ordinates.\n        this.linearVelocity = new b2Math_1.b2Vec2(0, 0);\n        /// The angular velocity of the body.\n        this.angularVelocity = 0;\n        /// Linear damping is use to reduce the linear velocity. The damping parameter\n        /// can be larger than 1.0f but the damping effect becomes sensitive to the\n        /// time step when the damping parameter is large.\n        this.linearDamping = 0;\n        /// Angular damping is use to reduce the angular velocity. The damping parameter\n        /// can be larger than 1.0f but the damping effect becomes sensitive to the\n        /// time step when the damping parameter is large.\n        this.angularDamping = 0;\n        /// Set this flag to false if this body should never fall asleep. Note that\n        /// this increases CPU usage.\n        this.allowSleep = true;\n        /// Is this body initially awake or sleeping?\n        this.awake = true;\n        /// Should this body be prevented from rotating? Useful for characters.\n        this.fixedRotation = false;\n        /// Is this a fast moving body that should be prevented from tunneling through\n        /// other moving bodies? Note that all bodies are prevented from tunneling through\n        /// kinematic and static bodies. This setting is only considered on dynamic bodies.\n        /// @warning You should use this flag sparingly since it increases processing time.\n        this.bullet = false;\n        /// Does this body start out active?\n        this.active = true;\n        /// Use this to store application specific body data.\n        this.userData = null;\n        /// Scale the gravity applied to this body.\n        this.gravityScale = 1;\n    }\n    return b2BodyDef;\n}());\nexports.b2BodyDef = b2BodyDef;\n/// A rigid body. These are created via b2World::CreateBody.\nvar b2Body = /** @class */ (function () {\n    // #endif\n    function b2Body(bd, world) {\n        /// b2Assert(bd.position.IsValid());\n        /// b2Assert(bd.linearVelocity.IsValid());\n        /// b2Assert(b2IsValid(bd.angle));\n        /// b2Assert(b2IsValid(bd.angularVelocity));\n        /// b2Assert(b2IsValid(bd.gravityScale) && bd.gravityScale >= 0);\n        /// b2Assert(b2IsValid(bd.angularDamping) && bd.angularDamping >= 0);\n        /// b2Assert(b2IsValid(bd.linearDamping) && bd.linearDamping >= 0);\n        this.m_type = b2BodyType.b2_staticBody;\n        this.m_islandFlag = false;\n        this.m_awakeFlag = false;\n        this.m_autoSleepFlag = false;\n        this.m_bulletFlag = false;\n        this.m_fixedRotationFlag = false;\n        this.m_activeFlag = false;\n        this.m_toiFlag = false;\n        this.m_islandIndex = 0;\n        this.m_xf = new b2Math_1.b2Transform(); // the body origin transform\n        // #if B2_ENABLE_PARTICLE\n        this.m_xf0 = new b2Math_1.b2Transform();\n        // #endif\n        this.m_sweep = new b2Math_1.b2Sweep(); // the swept motion for CCD\n        this.m_linearVelocity = new b2Math_1.b2Vec2();\n        this.m_angularVelocity = 0;\n        this.m_force = new b2Math_1.b2Vec2();\n        this.m_torque = 0;\n        this.m_prev = null;\n        this.m_next = null;\n        this.m_fixtureList = null;\n        this.m_fixtureCount = 0;\n        this.m_jointList = null;\n        this.m_contactList = null;\n        this.m_mass = 1;\n        this.m_invMass = 1;\n        // Rotational inertia about the center of mass.\n        this.m_I = 0;\n        this.m_invI = 0;\n        this.m_linearDamping = 0;\n        this.m_angularDamping = 0;\n        this.m_gravityScale = 1;\n        this.m_sleepTime = 0;\n        this.m_userData = null;\n        // #if B2_ENABLE_CONTROLLER\n        this.m_controllerList = null;\n        this.m_controllerCount = 0;\n        if (bd.bullet) {\n            this.m_bulletFlag = true;\n        }\n        if (bd.fixedRotation) {\n            this.m_fixedRotationFlag = true;\n        }\n        if (bd.allowSleep) {\n            this.m_autoSleepFlag = true;\n        }\n        if (bd.awake) {\n            this.m_awakeFlag = true;\n        }\n        if (bd.active) {\n            this.m_activeFlag = true;\n        }\n        this.m_world = world;\n        this.m_xf.p.Copy(bd.position);\n        this.m_xf.q.SetAngle(bd.angle);\n        // #if B2_ENABLE_PARTICLE\n        this.m_xf0.Copy(this.m_xf);\n        // #endif\n        this.m_sweep.localCenter.SetZero();\n        this.m_sweep.c0.Copy(this.m_xf.p);\n        this.m_sweep.c.Copy(this.m_xf.p);\n        this.m_sweep.a0 = bd.angle;\n        this.m_sweep.a = bd.angle;\n        this.m_sweep.alpha0 = 0;\n        this.m_linearVelocity.Copy(bd.linearVelocity);\n        this.m_angularVelocity = bd.angularVelocity;\n        this.m_linearDamping = bd.linearDamping;\n        this.m_angularDamping = bd.angularDamping;\n        this.m_gravityScale = bd.gravityScale;\n        this.m_force.SetZero();\n        this.m_torque = 0;\n        this.m_sleepTime = 0;\n        this.m_type = bd.type;\n        if (bd.type === b2BodyType.b2_dynamicBody) {\n            this.m_mass = 1;\n            this.m_invMass = 1;\n        }\n        else {\n            this.m_mass = 0;\n            this.m_invMass = 0;\n        }\n        this.m_I = 0;\n        this.m_invI = 0;\n        this.m_userData = bd.userData;\n        this.m_fixtureList = null;\n        this.m_fixtureCount = 0;\n        // #if B2_ENABLE_CONTROLLER\n        this.m_controllerList = null;\n        this.m_controllerCount = 0;\n        // #endif\n    }\n    b2Body.prototype.CreateFixture = function (a, b) {\n        if (a instanceof b2Fixture_1.b2FixtureDef) {\n            return this.CreateFixtureDef(a);\n        }\n        else if ((a instanceof b2Shape_1.b2Shape) && (typeof (b) === \"number\")) {\n            return this.CreateFixtureShapeDensity(a, b);\n        }\n        else {\n            throw new Error();\n        }\n    };\n    /// Creates a fixture and attach it to this body. Use this function if you need\n    /// to set some fixture parameters, like friction. Otherwise you can create the\n    /// fixture directly from a shape.\n    /// If the density is non-zero, this function automatically updates the mass of the body.\n    /// Contacts are not created until the next time step.\n    /// @param def the fixture definition.\n    /// @warning This function is locked during callbacks.\n    b2Body.prototype.CreateFixtureDef = function (def) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (this.m_world.IsLocked()) {\n            return null;\n        }\n        var fixture = new b2Fixture_1.b2Fixture(def, this);\n        fixture.Create(/*this,*/ def);\n        if (this.m_activeFlag) {\n            var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n            fixture.CreateProxies(broadPhase, this.m_xf);\n        }\n        fixture.m_next = this.m_fixtureList;\n        this.m_fixtureList = fixture;\n        ++this.m_fixtureCount;\n        // fixture.m_body = this;\n        // Adjust mass properties if needed.\n        if (fixture.m_density > 0) {\n            this.ResetMassData();\n        }\n        // Let the world know we have a new fixture. This will cause new contacts\n        // to be created at the beginning of the next time step.\n        this.m_world.m_newFixture = true;\n        return fixture;\n    };\n    b2Body.prototype.CreateFixtureShapeDensity = function (shape, density) {\n        if (density === void 0) { density = 0; }\n        var def = b2Body.CreateFixtureShapeDensity_s_def;\n        def.shape = shape;\n        def.density = density;\n        return this.CreateFixtureDef(def);\n    };\n    /// Destroy a fixture. This removes the fixture from the broad-phase and\n    /// destroys all contacts associated with this fixture. This will\n    /// automatically adjust the mass of the body if the body is dynamic and the\n    /// fixture has positive density.\n    /// All fixtures attached to a body are implicitly destroyed when the body is destroyed.\n    /// @param fixture the fixture to be removed.\n    /// @warning This function is locked during callbacks.\n    b2Body.prototype.DestroyFixture = function (fixture) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (this.m_world.IsLocked()) {\n            return;\n        }\n        /// b2Assert(fixture.m_body === this);\n        // Remove the fixture from this body's singly linked list.\n        /// b2Assert(this.m_fixtureCount > 0);\n        var node = this.m_fixtureList;\n        var ppF = null;\n        // let found: boolean = false;\n        while (node !== null) {\n            if (node === fixture) {\n                if (ppF) {\n                    ppF.m_next = fixture.m_next;\n                }\n                else {\n                    this.m_fixtureList = fixture.m_next;\n                }\n                // found = true;\n                break;\n            }\n            ppF = node;\n            node = node.m_next;\n        }\n        // You tried to remove a shape that is not attached to this body.\n        /// b2Assert(found);\n        // Destroy any contacts associated with the fixture.\n        var edge = this.m_contactList;\n        while (edge) {\n            var c = edge.contact;\n            edge = edge.next;\n            var fixtureA = c.GetFixtureA();\n            var fixtureB = c.GetFixtureB();\n            if (fixture === fixtureA || fixture === fixtureB) {\n                // This destroys the contact and removes it from\n                // this body's contact list.\n                this.m_world.m_contactManager.Destroy(c);\n            }\n        }\n        if (this.m_activeFlag) {\n            var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n            fixture.DestroyProxies(broadPhase);\n        }\n        fixture.Destroy();\n        // fixture.m_body = null;\n        fixture.m_next = null;\n        --this.m_fixtureCount;\n        // Reset the mass data.\n        this.ResetMassData();\n    };\n    /// Set the position of the body's origin and rotation.\n    /// This breaks any contacts and wakes the other bodies.\n    /// Manipulating a body's transform may cause non-physical behavior.\n    /// @param position the world position of the body's local origin.\n    /// @param angle the world rotation in radians.\n    b2Body.prototype.SetTransformVec = function (position, angle) {\n        this.SetTransformXY(position.x, position.y, angle);\n    };\n    b2Body.prototype.SetTransformXY = function (x, y, angle) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (this.m_world.IsLocked()) {\n            return;\n        }\n        this.m_xf.q.SetAngle(angle);\n        this.m_xf.p.Set(x, y);\n        // #if B2_ENABLE_PARTICLE\n        this.m_xf0.Copy(this.m_xf);\n        // #endif\n        b2Math_1.b2Transform.MulXV(this.m_xf, this.m_sweep.localCenter, this.m_sweep.c);\n        this.m_sweep.a = angle;\n        this.m_sweep.c0.Copy(this.m_sweep.c);\n        this.m_sweep.a0 = angle;\n        var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n        for (var f = this.m_fixtureList; f; f = f.m_next) {\n            f.Synchronize(broadPhase, this.m_xf, this.m_xf);\n        }\n        this.m_world.m_contactManager.FindNewContacts();\n    };\n    b2Body.prototype.SetTransform = function (xf) {\n        this.SetTransformVec(xf.p, xf.GetAngle());\n    };\n    /// Get the body transform for the body's origin.\n    /// @return the world transform of the body's origin.\n    b2Body.prototype.GetTransform = function () {\n        return this.m_xf;\n    };\n    /// Get the world body origin position.\n    /// @return the world position of the body's origin.\n    b2Body.prototype.GetPosition = function () {\n        return this.m_xf.p;\n    };\n    b2Body.prototype.SetPosition = function (position) {\n        this.SetTransformVec(position, this.GetAngle());\n    };\n    b2Body.prototype.SetPositionXY = function (x, y) {\n        this.SetTransformXY(x, y, this.GetAngle());\n    };\n    /// Get the angle in radians.\n    /// @return the current world rotation angle in radians.\n    b2Body.prototype.GetAngle = function () {\n        return this.m_sweep.a;\n    };\n    b2Body.prototype.SetAngle = function (angle) {\n        this.SetTransformVec(this.GetPosition(), angle);\n    };\n    /// Get the world position of the center of mass.\n    b2Body.prototype.GetWorldCenter = function () {\n        return this.m_sweep.c;\n    };\n    /// Get the local position of the center of mass.\n    b2Body.prototype.GetLocalCenter = function () {\n        return this.m_sweep.localCenter;\n    };\n    /// Set the linear velocity of the center of mass.\n    /// @param v the new linear velocity of the center of mass.\n    b2Body.prototype.SetLinearVelocity = function (v) {\n        if (this.m_type === b2BodyType.b2_staticBody) {\n            return;\n        }\n        if (b2Math_1.b2Vec2.DotVV(v, v) > 0) {\n            this.SetAwake(true);\n        }\n        this.m_linearVelocity.Copy(v);\n    };\n    /// Get the linear velocity of the center of mass.\n    /// @return the linear velocity of the center of mass.\n    b2Body.prototype.GetLinearVelocity = function () {\n        return this.m_linearVelocity;\n    };\n    /// Set the angular velocity.\n    /// @param omega the new angular velocity in radians/second.\n    b2Body.prototype.SetAngularVelocity = function (w) {\n        if (this.m_type === b2BodyType.b2_staticBody) {\n            return;\n        }\n        if (w * w > 0) {\n            this.SetAwake(true);\n        }\n        this.m_angularVelocity = w;\n    };\n    /// Get the angular velocity.\n    /// @return the angular velocity in radians/second.\n    b2Body.prototype.GetAngularVelocity = function () {\n        return this.m_angularVelocity;\n    };\n    b2Body.prototype.GetDefinition = function (bd) {\n        bd.type = this.GetType();\n        bd.allowSleep = this.m_autoSleepFlag;\n        bd.angle = this.GetAngle();\n        bd.angularDamping = this.m_angularDamping;\n        bd.gravityScale = this.m_gravityScale;\n        bd.angularVelocity = this.m_angularVelocity;\n        bd.fixedRotation = this.m_fixedRotationFlag;\n        bd.bullet = this.m_bulletFlag;\n        bd.awake = this.m_awakeFlag;\n        bd.linearDamping = this.m_linearDamping;\n        bd.linearVelocity.Copy(this.GetLinearVelocity());\n        bd.position.Copy(this.GetPosition());\n        bd.userData = this.GetUserData();\n        return bd;\n    };\n    /// Apply a force at a world point. If the force is not\n    /// applied at the center of mass, it will generate a torque and\n    /// affect the angular velocity. This wakes up the body.\n    /// @param force the world force vector, usually in Newtons (N).\n    /// @param point the world position of the point of application.\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyForce = function (force, point, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_force.x += force.x;\n            this.m_force.y += force.y;\n            this.m_torque += ((point.x - this.m_sweep.c.x) * force.y - (point.y - this.m_sweep.c.y) * force.x);\n        }\n    };\n    /// Apply a force to the center of mass. This wakes up the body.\n    /// @param force the world force vector, usually in Newtons (N).\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyForceToCenter = function (force, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_force.x += force.x;\n            this.m_force.y += force.y;\n        }\n    };\n    /// Apply a torque. This affects the angular velocity\n    /// without affecting the linear velocity of the center of mass.\n    /// This wakes up the body.\n    /// @param torque about the z-axis (out of the screen), usually in N-m.\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyTorque = function (torque, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_torque += torque;\n        }\n    };\n    /// Apply an impulse at a point. This immediately modifies the velocity.\n    /// It also modifies the angular velocity if the point of application\n    /// is not at the center of mass. This wakes up the body.\n    /// @param impulse the world impulse vector, usually in N-seconds or kg-m/s.\n    /// @param point the world position of the point of application.\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyLinearImpulse = function (impulse, point, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_linearVelocity.x += this.m_invMass * impulse.x;\n            this.m_linearVelocity.y += this.m_invMass * impulse.y;\n            this.m_angularVelocity += this.m_invI * ((point.x - this.m_sweep.c.x) * impulse.y - (point.y - this.m_sweep.c.y) * impulse.x);\n        }\n    };\n    /// Apply an impulse at the center of gravity. This immediately modifies the velocity.\n    /// @param impulse the world impulse vector, usually in N-seconds or kg-m/s.\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyLinearImpulseToCenter = function (impulse, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_linearVelocity.x += this.m_invMass * impulse.x;\n            this.m_linearVelocity.y += this.m_invMass * impulse.y;\n        }\n    };\n    /// Apply an angular impulse.\n    /// @param impulse the angular impulse in units of kg*m*m/s\n    /// @param wake also wake up the body\n    b2Body.prototype.ApplyAngularImpulse = function (impulse, wake) {\n        if (wake === void 0) { wake = true; }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        if (wake && !this.m_awakeFlag) {\n            this.SetAwake(true);\n        }\n        // Don't accumulate a force if the body is sleeping.\n        if (this.m_awakeFlag) {\n            this.m_angularVelocity += this.m_invI * impulse;\n        }\n    };\n    /// Get the total mass of the body.\n    /// @return the mass, usually in kilograms (kg).\n    b2Body.prototype.GetMass = function () {\n        return this.m_mass;\n    };\n    /// Get the rotational inertia of the body about the local origin.\n    /// @return the rotational inertia, usually in kg-m^2.\n    b2Body.prototype.GetInertia = function () {\n        return this.m_I + this.m_mass * b2Math_1.b2Vec2.DotVV(this.m_sweep.localCenter, this.m_sweep.localCenter);\n    };\n    /// Get the mass data of the body.\n    /// @return a struct containing the mass, inertia and center of the body.\n    b2Body.prototype.GetMassData = function (data) {\n        data.mass = this.m_mass;\n        data.I = this.m_I + this.m_mass * b2Math_1.b2Vec2.DotVV(this.m_sweep.localCenter, this.m_sweep.localCenter);\n        data.center.Copy(this.m_sweep.localCenter);\n        return data;\n    };\n    b2Body.prototype.SetMassData = function (massData) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (this.m_world.IsLocked()) {\n            return;\n        }\n        if (this.m_type !== b2BodyType.b2_dynamicBody) {\n            return;\n        }\n        this.m_invMass = 0;\n        this.m_I = 0;\n        this.m_invI = 0;\n        this.m_mass = massData.mass;\n        if (this.m_mass <= 0) {\n            this.m_mass = 1;\n        }\n        this.m_invMass = 1 / this.m_mass;\n        if (massData.I > 0 && !this.m_fixedRotationFlag) {\n            this.m_I = massData.I - this.m_mass * b2Math_1.b2Vec2.DotVV(massData.center, massData.center);\n            /// b2Assert(this.m_I > 0);\n            this.m_invI = 1 / this.m_I;\n        }\n        // Move center of mass.\n        var oldCenter = b2Body.SetMassData_s_oldCenter.Copy(this.m_sweep.c);\n        this.m_sweep.localCenter.Copy(massData.center);\n        b2Math_1.b2Transform.MulXV(this.m_xf, this.m_sweep.localCenter, this.m_sweep.c);\n        this.m_sweep.c0.Copy(this.m_sweep.c);\n        // Update center of mass velocity.\n        b2Math_1.b2Vec2.AddVCrossSV(this.m_linearVelocity, this.m_angularVelocity, b2Math_1.b2Vec2.SubVV(this.m_sweep.c, oldCenter, b2Math_1.b2Vec2.s_t0), this.m_linearVelocity);\n    };\n    b2Body.prototype.ResetMassData = function () {\n        // Compute mass data from shapes. Each shape has its own density.\n        this.m_mass = 0;\n        this.m_invMass = 0;\n        this.m_I = 0;\n        this.m_invI = 0;\n        this.m_sweep.localCenter.SetZero();\n        // Static and kinematic bodies have zero mass.\n        if (this.m_type === b2BodyType.b2_staticBody || this.m_type === b2BodyType.b2_kinematicBody) {\n            this.m_sweep.c0.Copy(this.m_xf.p);\n            this.m_sweep.c.Copy(this.m_xf.p);\n            this.m_sweep.a0 = this.m_sweep.a;\n            return;\n        }\n        /// b2Assert(this.m_type === b2BodyType.b2_dynamicBody);\n        // Accumulate mass over all fixtures.\n        var localCenter = b2Body.ResetMassData_s_localCenter.SetZero();\n        for (var f = this.m_fixtureList; f; f = f.m_next) {\n            if (f.m_density === 0) {\n                continue;\n            }\n            var massData = f.GetMassData(b2Body.ResetMassData_s_massData);\n            this.m_mass += massData.mass;\n            localCenter.x += massData.center.x * massData.mass;\n            localCenter.y += massData.center.y * massData.mass;\n            this.m_I += massData.I;\n        }\n        // Compute center of mass.\n        if (this.m_mass > 0) {\n            this.m_invMass = 1 / this.m_mass;\n            localCenter.x *= this.m_invMass;\n            localCenter.y *= this.m_invMass;\n        }\n        else {\n            // Force all dynamic bodies to have a positive mass.\n            this.m_mass = 1;\n            this.m_invMass = 1;\n        }\n        if (this.m_I > 0 && !this.m_fixedRotationFlag) {\n            // Center the inertia about the center of mass.\n            this.m_I -= this.m_mass * b2Math_1.b2Vec2.DotVV(localCenter, localCenter);\n            /// b2Assert(this.m_I > 0);\n            this.m_invI = 1 / this.m_I;\n        }\n        else {\n            this.m_I = 0;\n            this.m_invI = 0;\n        }\n        // Move center of mass.\n        var oldCenter = b2Body.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);\n        this.m_sweep.localCenter.Copy(localCenter);\n        b2Math_1.b2Transform.MulXV(this.m_xf, this.m_sweep.localCenter, this.m_sweep.c);\n        this.m_sweep.c0.Copy(this.m_sweep.c);\n        // Update center of mass velocity.\n        b2Math_1.b2Vec2.AddVCrossSV(this.m_linearVelocity, this.m_angularVelocity, b2Math_1.b2Vec2.SubVV(this.m_sweep.c, oldCenter, b2Math_1.b2Vec2.s_t0), this.m_linearVelocity);\n    };\n    /// Get the world coordinates of a point given the local coordinates.\n    /// @param localPoint a point on the body measured relative the the body's origin.\n    /// @return the same point expressed in world coordinates.\n    b2Body.prototype.GetWorldPoint = function (localPoint, out) {\n        return b2Math_1.b2Transform.MulXV(this.m_xf, localPoint, out);\n    };\n    /// Get the world coordinates of a vector given the local coordinates.\n    /// @param localVector a vector fixed in the body.\n    /// @return the same vector expressed in world coordinates.\n    b2Body.prototype.GetWorldVector = function (localVector, out) {\n        return b2Math_1.b2Rot.MulRV(this.m_xf.q, localVector, out);\n    };\n    /// Gets a local point relative to the body's origin given a world point.\n    /// @param a point in world coordinates.\n    /// @return the corresponding local point relative to the body's origin.\n    b2Body.prototype.GetLocalPoint = function (worldPoint, out) {\n        return b2Math_1.b2Transform.MulTXV(this.m_xf, worldPoint, out);\n    };\n    /// Gets a local vector given a world vector.\n    /// @param a vector in world coordinates.\n    /// @return the corresponding local vector.\n    b2Body.prototype.GetLocalVector = function (worldVector, out) {\n        return b2Math_1.b2Rot.MulTRV(this.m_xf.q, worldVector, out);\n    };\n    /// Get the world linear velocity of a world point attached to this body.\n    /// @param a point in world coordinates.\n    /// @return the world velocity of a point.\n    b2Body.prototype.GetLinearVelocityFromWorldPoint = function (worldPoint, out) {\n        return b2Math_1.b2Vec2.AddVCrossSV(this.m_linearVelocity, this.m_angularVelocity, b2Math_1.b2Vec2.SubVV(worldPoint, this.m_sweep.c, b2Math_1.b2Vec2.s_t0), out);\n    };\n    /// Get the world velocity of a local point.\n    /// @param a point in local coordinates.\n    /// @return the world velocity of a point.\n    b2Body.prototype.GetLinearVelocityFromLocalPoint = function (localPoint, out) {\n        return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(localPoint, out), out);\n    };\n    /// Get the linear damping of the body.\n    b2Body.prototype.GetLinearDamping = function () {\n        return this.m_linearDamping;\n    };\n    /// Set the linear damping of the body.\n    b2Body.prototype.SetLinearDamping = function (linearDamping) {\n        this.m_linearDamping = linearDamping;\n    };\n    /// Get the angular damping of the body.\n    b2Body.prototype.GetAngularDamping = function () {\n        return this.m_angularDamping;\n    };\n    /// Set the angular damping of the body.\n    b2Body.prototype.SetAngularDamping = function (angularDamping) {\n        this.m_angularDamping = angularDamping;\n    };\n    /// Get the gravity scale of the body.\n    b2Body.prototype.GetGravityScale = function () {\n        return this.m_gravityScale;\n    };\n    /// Set the gravity scale of the body.\n    b2Body.prototype.SetGravityScale = function (scale) {\n        this.m_gravityScale = scale;\n    };\n    /// Set the type of this body. This may alter the mass and velocity.\n    b2Body.prototype.SetType = function (type) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (this.m_world.IsLocked()) {\n            return;\n        }\n        if (this.m_type === type) {\n            return;\n        }\n        this.m_type = type;\n        this.ResetMassData();\n        if (this.m_type === b2BodyType.b2_staticBody) {\n            this.m_linearVelocity.SetZero();\n            this.m_angularVelocity = 0;\n            this.m_sweep.a0 = this.m_sweep.a;\n            this.m_sweep.c0.Copy(this.m_sweep.c);\n            this.SynchronizeFixtures();\n        }\n        this.SetAwake(true);\n        this.m_force.SetZero();\n        this.m_torque = 0;\n        // Delete the attached contacts.\n        var ce = this.m_contactList;\n        while (ce) {\n            var ce0 = ce;\n            ce = ce.next;\n            this.m_world.m_contactManager.Destroy(ce0.contact);\n        }\n        this.m_contactList = null;\n        // Touch the proxies so that new contacts will be created (when appropriate)\n        var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n        for (var f = this.m_fixtureList; f; f = f.m_next) {\n            var proxyCount = f.m_proxyCount;\n            for (var i = 0; i < proxyCount; ++i) {\n                broadPhase.TouchProxy(f.m_proxies[i].treeNode);\n            }\n        }\n    };\n    /// Get the type of this body.\n    b2Body.prototype.GetType = function () {\n        return this.m_type;\n    };\n    /// Should this body be treated like a bullet for continuous collision detection?\n    b2Body.prototype.SetBullet = function (flag) {\n        this.m_bulletFlag = flag;\n    };\n    /// Is this body treated like a bullet for continuous collision detection?\n    b2Body.prototype.IsBullet = function () {\n        return this.m_bulletFlag;\n    };\n    /// You can disable sleeping on this body. If you disable sleeping, the\n    /// body will be woken.\n    b2Body.prototype.SetSleepingAllowed = function (flag) {\n        this.m_autoSleepFlag = flag;\n        if (!flag) {\n            this.SetAwake(true);\n        }\n    };\n    /// Is this body allowed to sleep\n    b2Body.prototype.IsSleepingAllowed = function () {\n        return this.m_autoSleepFlag;\n    };\n    /// Set the sleep state of the body. A sleeping body has very\n    /// low CPU cost.\n    /// @param flag set to true to wake the body, false to put it to sleep.\n    b2Body.prototype.SetAwake = function (flag) {\n        if (flag) {\n            if (!this.m_awakeFlag) {\n                this.m_awakeFlag = true;\n                this.m_sleepTime = 0;\n            }\n        }\n        else {\n            this.m_awakeFlag = false;\n            this.m_sleepTime = 0;\n            this.m_linearVelocity.SetZero();\n            this.m_angularVelocity = 0;\n            this.m_force.SetZero();\n            this.m_torque = 0;\n        }\n    };\n    /// Get the sleeping state of this body.\n    /// @return true if the body is sleeping.\n    b2Body.prototype.IsAwake = function () {\n        return this.m_awakeFlag;\n    };\n    /// Set the active state of the body. An inactive body is not\n    /// simulated and cannot be collided with or woken up.\n    /// If you pass a flag of true, all fixtures will be added to the\n    /// broad-phase.\n    /// If you pass a flag of false, all fixtures will be removed from\n    /// the broad-phase and all contacts will be destroyed.\n    /// Fixtures and joints are otherwise unaffected. You may continue\n    /// to create/destroy fixtures and joints on inactive bodies.\n    /// Fixtures on an inactive body are implicitly inactive and will\n    /// not participate in collisions, ray-casts, or queries.\n    /// Joints connected to an inactive body are implicitly inactive.\n    /// An inactive body is still owned by a b2World object and remains\n    /// in the body list.\n    b2Body.prototype.SetActive = function (flag) {\n        /// b2Assert(!this.m_world.IsLocked());\n        if (flag === this.IsActive()) {\n            return;\n        }\n        this.m_activeFlag = flag;\n        if (flag) {\n            // Create all proxies.\n            var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n            for (var f = this.m_fixtureList; f; f = f.m_next) {\n                f.CreateProxies(broadPhase, this.m_xf);\n            }\n            // Contacts are created the next time step.\n        }\n        else {\n            // Destroy all proxies.\n            var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n            for (var f = this.m_fixtureList; f; f = f.m_next) {\n                f.DestroyProxies(broadPhase);\n            }\n            // Destroy the attached contacts.\n            var ce = this.m_contactList;\n            while (ce) {\n                var ce0 = ce;\n                ce = ce.next;\n                this.m_world.m_contactManager.Destroy(ce0.contact);\n            }\n            this.m_contactList = null;\n        }\n    };\n    /// Get the active state of the body.\n    b2Body.prototype.IsActive = function () {\n        return this.m_activeFlag;\n    };\n    /// Set this body to have fixed rotation. This causes the mass\n    /// to be reset.\n    b2Body.prototype.SetFixedRotation = function (flag) {\n        if (this.m_fixedRotationFlag === flag) {\n            return;\n        }\n        this.m_fixedRotationFlag = flag;\n        this.m_angularVelocity = 0;\n        this.ResetMassData();\n    };\n    /// Does this body have fixed rotation?\n    b2Body.prototype.IsFixedRotation = function () {\n        return this.m_fixedRotationFlag;\n    };\n    /// Get the list of all fixtures attached to this body.\n    b2Body.prototype.GetFixtureList = function () {\n        return this.m_fixtureList;\n    };\n    /// Get the list of all joints attached to this body.\n    b2Body.prototype.GetJointList = function () {\n        return this.m_jointList;\n    };\n    /// Get the list of all contacts attached to this body.\n    /// @warning this list changes during the time step and you may\n    /// miss some collisions if you don't use b2ContactListener.\n    b2Body.prototype.GetContactList = function () {\n        return this.m_contactList;\n    };\n    /// Get the next body in the world's body list.\n    b2Body.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    /// Get the user data pointer that was provided in the body definition.\n    b2Body.prototype.GetUserData = function () {\n        return this.m_userData;\n    };\n    /// Set the user data. Use this to store your application specific data.\n    b2Body.prototype.SetUserData = function (data) {\n        this.m_userData = data;\n    };\n    /// Get the parent world of this body.\n    b2Body.prototype.GetWorld = function () {\n        return this.m_world;\n    };\n    /// Dump this body to a log file\n    b2Body.prototype.Dump = function (log) {\n        var bodyIndex = this.m_islandIndex;\n        log(\"{\\n\");\n        log(\"  const bd: b2BodyDef = new b2BodyDef();\\n\");\n        var type_str = \"\";\n        switch (this.m_type) {\n            case b2BodyType.b2_staticBody:\n                type_str = \"b2BodyType.b2_staticBody\";\n                break;\n            case b2BodyType.b2_kinematicBody:\n                type_str = \"b2BodyType.b2_kinematicBody\";\n                break;\n            case b2BodyType.b2_dynamicBody:\n                type_str = \"b2BodyType.b2_dynamicBody\";\n                break;\n            default:\n                /// b2Assert(false);\n                break;\n        }\n        log(\"  bd.type = %s;\\n\", type_str);\n        log(\"  bd.position.Set(%.15f, %.15f);\\n\", this.m_xf.p.x, this.m_xf.p.y);\n        log(\"  bd.angle = %.15f;\\n\", this.m_sweep.a);\n        log(\"  bd.linearVelocity.Set(%.15f, %.15f);\\n\", this.m_linearVelocity.x, this.m_linearVelocity.y);\n        log(\"  bd.angularVelocity = %.15f;\\n\", this.m_angularVelocity);\n        log(\"  bd.linearDamping = %.15f;\\n\", this.m_linearDamping);\n        log(\"  bd.angularDamping = %.15f;\\n\", this.m_angularDamping);\n        log(\"  bd.allowSleep = %s;\\n\", (this.m_autoSleepFlag) ? (\"true\") : (\"false\"));\n        log(\"  bd.awake = %s;\\n\", (this.m_awakeFlag) ? (\"true\") : (\"false\"));\n        log(\"  bd.fixedRotation = %s;\\n\", (this.m_fixedRotationFlag) ? (\"true\") : (\"false\"));\n        log(\"  bd.bullet = %s;\\n\", (this.m_bulletFlag) ? (\"true\") : (\"false\"));\n        log(\"  bd.active = %s;\\n\", (this.m_activeFlag) ? (\"true\") : (\"false\"));\n        log(\"  bd.gravityScale = %.15f;\\n\", this.m_gravityScale);\n        log(\"\\n\");\n        log(\"  bodies[%d] = this.m_world.CreateBody(bd);\\n\", this.m_islandIndex);\n        log(\"\\n\");\n        for (var f = this.m_fixtureList; f; f = f.m_next) {\n            log(\"  {\\n\");\n            f.Dump(log, bodyIndex);\n            log(\"  }\\n\");\n        }\n        log(\"}\\n\");\n    };\n    b2Body.prototype.SynchronizeFixtures = function () {\n        var xf1 = b2Body.SynchronizeFixtures_s_xf1;\n        xf1.q.SetAngle(this.m_sweep.a0);\n        b2Math_1.b2Rot.MulRV(xf1.q, this.m_sweep.localCenter, xf1.p);\n        b2Math_1.b2Vec2.SubVV(this.m_sweep.c0, xf1.p, xf1.p);\n        var broadPhase = this.m_world.m_contactManager.m_broadPhase;\n        for (var f = this.m_fixtureList; f; f = f.m_next) {\n            f.Synchronize(broadPhase, xf1, this.m_xf);\n        }\n    };\n    b2Body.prototype.SynchronizeTransform = function () {\n        this.m_xf.q.SetAngle(this.m_sweep.a);\n        b2Math_1.b2Rot.MulRV(this.m_xf.q, this.m_sweep.localCenter, this.m_xf.p);\n        b2Math_1.b2Vec2.SubVV(this.m_sweep.c, this.m_xf.p, this.m_xf.p);\n    };\n    // This is used to prevent connected bodies from colliding.\n    // It may lie, depending on the collideConnected flag.\n    b2Body.prototype.ShouldCollide = function (other) {\n        // At least one body should be dynamic or kinematic.\n        if (this.m_type === b2BodyType.b2_staticBody && other.m_type === b2BodyType.b2_staticBody) {\n            return false;\n        }\n        return this.ShouldCollideConnected(other);\n    };\n    b2Body.prototype.ShouldCollideConnected = function (other) {\n        // Does a joint prevent collision?\n        for (var jn = this.m_jointList; jn; jn = jn.next) {\n            if (jn.other === other) {\n                if (!jn.joint.m_collideConnected) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    };\n    b2Body.prototype.Advance = function (alpha) {\n        // Advance to the new safe time. This doesn't sync the broad-phase.\n        this.m_sweep.Advance(alpha);\n        this.m_sweep.c.Copy(this.m_sweep.c0);\n        this.m_sweep.a = this.m_sweep.a0;\n        this.m_xf.q.SetAngle(this.m_sweep.a);\n        b2Math_1.b2Rot.MulRV(this.m_xf.q, this.m_sweep.localCenter, this.m_xf.p);\n        b2Math_1.b2Vec2.SubVV(this.m_sweep.c, this.m_xf.p, this.m_xf.p);\n    };\n    // #if B2_ENABLE_CONTROLLER\n    b2Body.prototype.GetControllerList = function () {\n        return this.m_controllerList;\n    };\n    b2Body.prototype.GetControllerCount = function () {\n        return this.m_controllerCount;\n    };\n    /// Creates a fixture from a shape and attach it to this body.\n    /// This is a convenience function. Use b2FixtureDef if you need to set parameters\n    /// like friction, restitution, user data, or filtering.\n    /// If the density is non-zero, this function automatically updates the mass of the body.\n    /// @param shape the shape to be cloned.\n    /// @param density the shape density (set to zero for static bodies).\n    /// @warning This function is locked during callbacks.\n    b2Body.CreateFixtureShapeDensity_s_def = new b2Fixture_1.b2FixtureDef();\n    /// Set the mass properties to override the mass properties of the fixtures.\n    /// Note that this changes the center of mass position.\n    /// Note that creating or destroying fixtures can also alter the mass.\n    /// This function has no effect if the body isn't dynamic.\n    /// @param massData the mass properties.\n    b2Body.SetMassData_s_oldCenter = new b2Math_1.b2Vec2();\n    /// This resets the mass properties to the sum of the mass properties of the fixtures.\n    /// This normally does not need to be called unless you called SetMassData to override\n    /// the mass and you later want to reset the mass.\n    b2Body.ResetMassData_s_localCenter = new b2Math_1.b2Vec2();\n    b2Body.ResetMassData_s_oldCenter = new b2Math_1.b2Vec2();\n    b2Body.ResetMassData_s_massData = new b2Shape_1.b2MassData();\n    b2Body.SynchronizeFixtures_s_xf1 = new b2Math_1.b2Transform();\n    return b2Body;\n}());\nexports.b2Body = b2Body;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2Body.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2ContactManager.ts":
/*!************************************************!*\
  !*** ./src/Box2D/Dynamics/b2ContactManager.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2BroadPhase_1 = __webpack_require__(/*! ../Collision/b2BroadPhase */ \"./src/Box2D/Collision/b2BroadPhase.ts\");\nvar b2Body_1 = __webpack_require__(/*! ./b2Body */ \"./src/Box2D/Dynamics/b2Body.ts\");\nvar b2WorldCallbacks_1 = __webpack_require__(/*! ./b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\");\nvar b2ContactFactory_1 = __webpack_require__(/*! ./Contacts/b2ContactFactory */ \"./src/Box2D/Dynamics/Contacts/b2ContactFactory.ts\");\n// Delegate of b2World.\nvar b2ContactManager = /** @class */ (function () {\n    function b2ContactManager() {\n        this.m_broadPhase = new b2BroadPhase_1.b2BroadPhase();\n        this.m_contactList = null;\n        this.m_contactCount = 0;\n        this.m_contactFilter = b2WorldCallbacks_1.b2ContactFilter.b2_defaultFilter;\n        this.m_contactListener = b2WorldCallbacks_1.b2ContactListener.b2_defaultListener;\n        this.m_allocator = null;\n        this.m_contactFactory = null;\n        this.m_contactFactory = new b2ContactFactory_1.b2ContactFactory(this.m_allocator);\n    }\n    // Broad-phase callback.\n    b2ContactManager.prototype.AddPair = function (proxyA, proxyB) {\n        /// b2Assert(proxyA instanceof b2FixtureProxy);\n        /// b2Assert(proxyB instanceof b2FixtureProxy);\n        var fixtureA = proxyA.fixture;\n        var fixtureB = proxyB.fixture;\n        var indexA = proxyA.childIndex;\n        var indexB = proxyB.childIndex;\n        var bodyA = fixtureA.GetBody();\n        var bodyB = fixtureB.GetBody();\n        // Are the fixtures on the same body?\n        if (bodyA === bodyB) {\n            return;\n        }\n        // TODO_ERIN use a hash table to remove a potential bottleneck when both\n        // bodies have a lot of contacts.\n        // Does a contact already exist?\n        var edge = bodyB.GetContactList();\n        while (edge) {\n            if (edge.other === bodyA) {\n                var fA = edge.contact.GetFixtureA();\n                var fB = edge.contact.GetFixtureB();\n                var iA = edge.contact.GetChildIndexA();\n                var iB = edge.contact.GetChildIndexB();\n                if (fA === fixtureA && fB === fixtureB && iA === indexA && iB === indexB) {\n                    // A contact already exists.\n                    return;\n                }\n                if (fA === fixtureB && fB === fixtureA && iA === indexB && iB === indexA) {\n                    // A contact already exists.\n                    return;\n                }\n            }\n            edge = edge.next;\n        }\n        // Check user filtering.\n        if (this.m_contactFilter && !this.m_contactFilter.ShouldCollide(fixtureA, fixtureB)) {\n            return;\n        }\n        // Call the factory.\n        var c = this.m_contactFactory.Create(fixtureA, indexA, fixtureB, indexB);\n        if (c === null) {\n            return;\n        }\n        // Contact creation may swap fixtures.\n        fixtureA = c.GetFixtureA();\n        fixtureB = c.GetFixtureB();\n        indexA = c.GetChildIndexA();\n        indexB = c.GetChildIndexB();\n        bodyA = fixtureA.m_body;\n        bodyB = fixtureB.m_body;\n        // Insert into the world.\n        c.m_prev = null;\n        c.m_next = this.m_contactList;\n        if (this.m_contactList !== null) {\n            this.m_contactList.m_prev = c;\n        }\n        this.m_contactList = c;\n        // Connect to island graph.\n        // Connect to body A\n        c.m_nodeA.contact = c;\n        c.m_nodeA.other = bodyB;\n        c.m_nodeA.prev = null;\n        c.m_nodeA.next = bodyA.m_contactList;\n        if (bodyA.m_contactList !== null) {\n            bodyA.m_contactList.prev = c.m_nodeA;\n        }\n        bodyA.m_contactList = c.m_nodeA;\n        // Connect to body B\n        c.m_nodeB.contact = c;\n        c.m_nodeB.other = bodyA;\n        c.m_nodeB.prev = null;\n        c.m_nodeB.next = bodyB.m_contactList;\n        if (bodyB.m_contactList !== null) {\n            bodyB.m_contactList.prev = c.m_nodeB;\n        }\n        bodyB.m_contactList = c.m_nodeB;\n        // Wake up the bodies\n        if (!fixtureA.IsSensor() && !fixtureB.IsSensor()) {\n            bodyA.SetAwake(true);\n            bodyB.SetAwake(true);\n        }\n        ++this.m_contactCount;\n    };\n    b2ContactManager.prototype.FindNewContacts = function () {\n        this.m_broadPhase.UpdatePairs(this);\n    };\n    b2ContactManager.prototype.Destroy = function (c) {\n        var fixtureA = c.GetFixtureA();\n        var fixtureB = c.GetFixtureB();\n        var bodyA = fixtureA.GetBody();\n        var bodyB = fixtureB.GetBody();\n        if (this.m_contactListener && c.IsTouching()) {\n            this.m_contactListener.EndContact(c);\n        }\n        // Remove from the world.\n        if (c.m_prev) {\n            c.m_prev.m_next = c.m_next;\n        }\n        if (c.m_next) {\n            c.m_next.m_prev = c.m_prev;\n        }\n        if (c === this.m_contactList) {\n            this.m_contactList = c.m_next;\n        }\n        // Remove from body 1\n        if (c.m_nodeA.prev) {\n            c.m_nodeA.prev.next = c.m_nodeA.next;\n        }\n        if (c.m_nodeA.next) {\n            c.m_nodeA.next.prev = c.m_nodeA.prev;\n        }\n        if (c.m_nodeA === bodyA.m_contactList) {\n            bodyA.m_contactList = c.m_nodeA.next;\n        }\n        // Remove from body 2\n        if (c.m_nodeB.prev) {\n            c.m_nodeB.prev.next = c.m_nodeB.next;\n        }\n        if (c.m_nodeB.next) {\n            c.m_nodeB.next.prev = c.m_nodeB.prev;\n        }\n        if (c.m_nodeB === bodyB.m_contactList) {\n            bodyB.m_contactList = c.m_nodeB.next;\n        }\n        // Call the factory.\n        this.m_contactFactory.Destroy(c);\n        --this.m_contactCount;\n    };\n    // This is the top level collision call for the time step. Here\n    // all the narrow phase collision is processed for the world\n    // contact list.\n    b2ContactManager.prototype.Collide = function () {\n        // Update awake contacts.\n        var c = this.m_contactList;\n        while (c) {\n            var fixtureA = c.GetFixtureA();\n            var fixtureB = c.GetFixtureB();\n            var indexA = c.GetChildIndexA();\n            var indexB = c.GetChildIndexB();\n            var bodyA = fixtureA.GetBody();\n            var bodyB = fixtureB.GetBody();\n            // Is this contact flagged for filtering?\n            if (c.m_filterFlag) {\n                // Check user filtering.\n                if (this.m_contactFilter && !this.m_contactFilter.ShouldCollide(fixtureA, fixtureB)) {\n                    var cNuke = c;\n                    c = cNuke.m_next;\n                    this.Destroy(cNuke);\n                    continue;\n                }\n                // Clear the filtering flag.\n                c.m_filterFlag = false;\n            }\n            var activeA = bodyA.IsAwake() && bodyA.m_type !== b2Body_1.b2BodyType.b2_staticBody;\n            var activeB = bodyB.IsAwake() && bodyB.m_type !== b2Body_1.b2BodyType.b2_staticBody;\n            // At least one body must be awake and it must be dynamic or kinematic.\n            if (!activeA && !activeB) {\n                c = c.m_next;\n                continue;\n            }\n            var proxyA = fixtureA.m_proxies[indexA].treeNode;\n            var proxyB = fixtureB.m_proxies[indexB].treeNode;\n            var overlap = this.m_broadPhase.TestOverlap(proxyA, proxyB);\n            // Here we destroy contacts that cease to overlap in the broad-phase.\n            if (!overlap) {\n                var cNuke = c;\n                c = cNuke.m_next;\n                this.Destroy(cNuke);\n                continue;\n            }\n            // The contact persists.\n            c.Update(this.m_contactListener);\n            c = c.m_next;\n        }\n    };\n    return b2ContactManager;\n}());\nexports.b2ContactManager = b2ContactManager;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2ContactManager.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2Fixture.ts":
/*!*****************************************!*\
  !*** ./src/Box2D/Dynamics/b2Fixture.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Collision_1 = __webpack_require__(/*! ../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ../Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n/// This holds contact filtering data.\nvar b2Filter = /** @class */ (function () {\n    function b2Filter() {\n        /// The collision category bits. Normally you would just set one bit.\n        this.categoryBits = 0x0001;\n        /// The collision mask bits. This states the categories that this\n        /// shape would accept for collision.\n        this.maskBits = 0xFFFF;\n        /// Collision groups allow a certain group of objects to never collide (negative)\n        /// or always collide (positive). Zero means no collision group. Non-zero group\n        /// filtering always wins against the mask bits.\n        this.groupIndex = 0;\n    }\n    b2Filter.prototype.Clone = function () {\n        return new b2Filter().Copy(this);\n    };\n    b2Filter.prototype.Copy = function (other) {\n        /// b2Assert(this !== other);\n        this.categoryBits = other.categoryBits;\n        this.maskBits = other.maskBits;\n        this.groupIndex = other.groupIndex;\n        return this;\n    };\n    return b2Filter;\n}());\nexports.b2Filter = b2Filter;\n/// A fixture definition is used to create a fixture. This class defines an\n/// abstract fixture definition. You can reuse fixture definitions safely.\nvar b2FixtureDef = /** @class */ (function () {\n    function b2FixtureDef() {\n        /// The shape, this must be set. The shape will be cloned, so you\n        /// can create the shape on the stack.\n        this.shape = null;\n        /// Use this to store application specific fixture data.\n        this.userData = null;\n        /// The friction coefficient, usually in the range [0,1].\n        this.friction = 0.2;\n        /// The restitution (elasticity) usually in the range [0,1].\n        this.restitution = 0;\n        /// The density, usually in kg/m^2.\n        this.density = 0;\n        /// A sensor shape collects contact information but never generates a collision\n        /// response.\n        this.isSensor = false;\n        /// Contact filtering data.\n        this.filter = new b2Filter();\n    }\n    return b2FixtureDef;\n}());\nexports.b2FixtureDef = b2FixtureDef;\n/// This proxy is used internally to connect fixtures to the broad-phase.\nvar b2FixtureProxy = /** @class */ (function () {\n    // public static MakeArray(length: number): b2FixtureProxy[] {\n    //   return b2MakeArray(length, (i) => new b2FixtureProxy());\n    // }\n    function b2FixtureProxy(fixture) {\n        this.aabb = new b2Collision_1.b2AABB();\n        this.childIndex = 0;\n        this.treeNode = null;\n        this.fixture = fixture;\n    }\n    return b2FixtureProxy;\n}());\nexports.b2FixtureProxy = b2FixtureProxy;\n/// A fixture is used to attach a shape to a body for collision detection. A fixture\n/// inherits its transform from its parent. Fixtures hold additional non-geometric data\n/// such as friction, collision filters, etc.\n/// Fixtures are created via b2Body::CreateFixture.\n/// @warning you cannot reuse fixtures.\nvar b2Fixture = /** @class */ (function () {\n    function b2Fixture(def, body) {\n        this.m_density = 0;\n        this.m_next = null;\n        this.m_friction = 0;\n        this.m_restitution = 0;\n        this.m_proxies = null;\n        this.m_proxyCount = 0;\n        this.m_filter = new b2Filter();\n        this.m_isSensor = false;\n        this.m_userData = null;\n        this.m_body = body;\n        this.m_shape = def.shape.Clone();\n    }\n    /// Get the type of the child shape. You can use this to down cast to the concrete shape.\n    /// @return the shape type.\n    b2Fixture.prototype.GetType = function () {\n        return this.m_shape.GetType();\n    };\n    /// Get the child shape. You can modify the child shape, however you should not change the\n    /// number of vertices because this will crash some collision caching mechanisms.\n    /// Manipulating the shape may lead to non-physical behavior.\n    b2Fixture.prototype.GetShape = function () {\n        return this.m_shape;\n    };\n    /// Set if this fixture is a sensor.\n    b2Fixture.prototype.SetSensor = function (sensor) {\n        if (sensor !== this.m_isSensor) {\n            this.m_body.SetAwake(true);\n            this.m_isSensor = sensor;\n        }\n    };\n    /// Is this fixture a sensor (non-solid)?\n    /// @return the true if the shape is a sensor.\n    b2Fixture.prototype.IsSensor = function () {\n        return this.m_isSensor;\n    };\n    /// Set the contact filtering data. This will not update contacts until the next time\n    /// step when either parent body is active and awake.\n    /// This automatically calls Refilter.\n    b2Fixture.prototype.SetFilterData = function (filter) {\n        this.m_filter.Copy(filter);\n        this.Refilter();\n    };\n    /// Get the contact filtering data.\n    b2Fixture.prototype.GetFilterData = function () {\n        return this.m_filter;\n    };\n    /// Call this if you want to establish collision that was previously disabled by b2ContactFilter::ShouldCollide.\n    b2Fixture.prototype.Refilter = function () {\n        if (this.m_body) {\n            return;\n        }\n        // Flag associated contacts for filtering.\n        var edge = this.m_body.GetContactList();\n        while (edge) {\n            var contact = edge.contact;\n            var fixtureA = contact.GetFixtureA();\n            var fixtureB = contact.GetFixtureB();\n            if (fixtureA === this || fixtureB === this) {\n                contact.FlagForFiltering();\n            }\n            edge = edge.next;\n        }\n        var world = this.m_body.GetWorld();\n        if (world === null) {\n            return;\n        }\n        // Touch each proxy so that new pairs may be created\n        var broadPhase = world.m_contactManager.m_broadPhase;\n        for (var i = 0; i < this.m_proxyCount; ++i) {\n            broadPhase.TouchProxy(this.m_proxies[i].treeNode);\n        }\n    };\n    /// Get the parent body of this fixture. This is NULL if the fixture is not attached.\n    /// @return the parent body.\n    b2Fixture.prototype.GetBody = function () {\n        return this.m_body;\n    };\n    /// Get the next fixture in the parent body's fixture list.\n    /// @return the next shape.\n    b2Fixture.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    /// Get the user data that was assigned in the fixture definition. Use this to\n    /// store your application specific data.\n    b2Fixture.prototype.GetUserData = function () {\n        return this.m_userData;\n    };\n    /// Set the user data. Use this to store your application specific data.\n    b2Fixture.prototype.SetUserData = function (data) {\n        this.m_userData = data;\n    };\n    /// Test a point for containment in this fixture.\n    /// @param p a point in world coordinates.\n    b2Fixture.prototype.TestPoint = function (p) {\n        return this.m_shape.TestPoint(this.m_body.GetTransform(), p);\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2Fixture.prototype.ComputeDistance = function (p, normal, childIndex) {\n        return this.m_shape.ComputeDistance(this.m_body.GetTransform(), p, normal, childIndex);\n    };\n    // #endif\n    /// Cast a ray against this shape.\n    /// @param output the ray-cast results.\n    /// @param input the ray-cast input parameters.\n    b2Fixture.prototype.RayCast = function (output, input, childIndex) {\n        return this.m_shape.RayCast(output, input, this.m_body.GetTransform(), childIndex);\n    };\n    /// Get the mass data for this fixture. The mass data is based on the density and\n    /// the shape. The rotational inertia is about the shape's origin. This operation\n    /// may be expensive.\n    b2Fixture.prototype.GetMassData = function (massData) {\n        if (massData === void 0) { massData = new b2Shape_1.b2MassData(); }\n        this.m_shape.ComputeMass(massData, this.m_density);\n        return massData;\n    };\n    /// Set the density of this fixture. This will _not_ automatically adjust the mass\n    /// of the body. You must call b2Body::ResetMassData to update the body's mass.\n    b2Fixture.prototype.SetDensity = function (density) {\n        this.m_density = density;\n    };\n    /// Get the density of this fixture.\n    b2Fixture.prototype.GetDensity = function () {\n        return this.m_density;\n    };\n    /// Get the coefficient of friction.\n    b2Fixture.prototype.GetFriction = function () {\n        return this.m_friction;\n    };\n    /// Set the coefficient of friction. This will _not_ change the friction of\n    /// existing contacts.\n    b2Fixture.prototype.SetFriction = function (friction) {\n        this.m_friction = friction;\n    };\n    /// Get the coefficient of restitution.\n    b2Fixture.prototype.GetRestitution = function () {\n        return this.m_restitution;\n    };\n    /// Set the coefficient of restitution. This will _not_ change the restitution of\n    /// existing contacts.\n    b2Fixture.prototype.SetRestitution = function (restitution) {\n        this.m_restitution = restitution;\n    };\n    /// Get the fixture's AABB. This AABB may be enlarge and/or stale.\n    /// If you need a more accurate AABB, compute it using the shape and\n    /// the body transform.\n    b2Fixture.prototype.GetAABB = function (childIndex) {\n        /// b2Assert(0 <= childIndex && childIndex < this.m_proxyCount);\n        return this.m_proxies[childIndex].aabb;\n    };\n    /// Dump this fixture to the log file.\n    b2Fixture.prototype.Dump = function (log, bodyIndex) {\n        log(\"    const fd: b2FixtureDef = new b2FixtureDef();\\n\");\n        log(\"    fd.friction = %.15f;\\n\", this.m_friction);\n        log(\"    fd.restitution = %.15f;\\n\", this.m_restitution);\n        log(\"    fd.density = %.15f;\\n\", this.m_density);\n        log(\"    fd.isSensor = %s;\\n\", (this.m_isSensor) ? (\"true\") : (\"false\"));\n        log(\"    fd.filter.categoryBits = %d;\\n\", this.m_filter.categoryBits);\n        log(\"    fd.filter.maskBits = %d;\\n\", this.m_filter.maskBits);\n        log(\"    fd.filter.groupIndex = %d;\\n\", this.m_filter.groupIndex);\n        this.m_shape.Dump(log);\n        log(\"\\n\");\n        log(\"    fd.shape = shape;\\n\");\n        log(\"\\n\");\n        log(\"    bodies[%d].CreateFixture(fd);\\n\", bodyIndex);\n    };\n    // We need separation create/destroy functions from the constructor/destructor because\n    // the destructor cannot access the allocator (no destructor arguments allowed by C++).\n    b2Fixture.prototype.Create = function (/*body: b2Body,*/ def) {\n        var _this = this;\n        this.m_userData = def.userData;\n        this.m_friction = def.friction;\n        this.m_restitution = def.restitution;\n        // this.m_body = body;\n        this.m_next = null;\n        this.m_filter.Copy(def.filter);\n        this.m_isSensor = def.isSensor;\n        // this.m_shape = def.shape.Clone();\n        // Reserve proxy space\n        // const childCount = m_shape->GetChildCount();\n        // m_proxies = (b2FixtureProxy*)allocator->Allocate(childCount * sizeof(b2FixtureProxy));\n        // for (int32 i = 0; i < childCount; ++i)\n        // {\n        //   m_proxies[i].fixture = NULL;\n        //   m_proxies[i].proxyId = b2BroadPhase::e_nullProxy;\n        // }\n        // this.m_proxies = b2FixtureProxy.MakeArray(this.m_shape.GetChildCount());\n        this.m_proxies = b2Settings_1.b2MakeArray(this.m_shape.GetChildCount(), function (i) { return new b2FixtureProxy(_this); });\n        this.m_proxyCount = 0;\n        this.m_density = def.density;\n    };\n    b2Fixture.prototype.Destroy = function () {\n        // The proxies must be destroyed before calling this.\n        /// b2Assert(this.m_proxyCount === 0);\n        // Free the proxy array.\n        // int32 childCount = m_shape->GetChildCount();\n        // allocator->Free(m_proxies, childCount * sizeof(b2FixtureProxy));\n        // m_proxies = NULL;\n        // this.m_shape = null;\n    };\n    // These support body activation/deactivation.\n    b2Fixture.prototype.CreateProxies = function (broadPhase, xf) {\n        /// b2Assert(this.m_proxyCount === 0);\n        // Create proxies in the broad-phase.\n        this.m_proxyCount = this.m_shape.GetChildCount();\n        for (var i = 0; i < this.m_proxyCount; ++i) {\n            var proxy = this.m_proxies[i] = new b2FixtureProxy(this);\n            this.m_shape.ComputeAABB(proxy.aabb, xf, i);\n            proxy.treeNode = broadPhase.CreateProxy(proxy.aabb, proxy);\n            // proxy.fixture = this;\n            proxy.childIndex = i;\n        }\n    };\n    b2Fixture.prototype.DestroyProxies = function (broadPhase) {\n        // Destroy proxies in the broad-phase.\n        for (var i = 0; i < this.m_proxyCount; ++i) {\n            var proxy = this.m_proxies[i];\n            proxy.treeNode.userData = null;\n            broadPhase.DestroyProxy(proxy.treeNode);\n            proxy.treeNode = null;\n        }\n        this.m_proxyCount = 0;\n    };\n    b2Fixture.prototype.Synchronize = function (broadPhase, transform1, transform2) {\n        if (this.m_proxyCount === 0) {\n            return;\n        }\n        for (var i = 0; i < this.m_proxyCount; ++i) {\n            var proxy = this.m_proxies[i];\n            // Compute an AABB that covers the swept shape (may miss some rotation effect).\n            var aabb1 = b2Fixture.Synchronize_s_aabb1;\n            var aabb2 = b2Fixture.Synchronize_s_aabb2;\n            this.m_shape.ComputeAABB(aabb1, transform1, i);\n            this.m_shape.ComputeAABB(aabb2, transform2, i);\n            proxy.aabb.Combine2(aabb1, aabb2);\n            var displacement = b2Math_1.b2Vec2.SubVV(transform2.p, transform1.p, b2Fixture.Synchronize_s_displacement);\n            broadPhase.MoveProxy(proxy.treeNode, proxy.aabb, displacement);\n        }\n    };\n    b2Fixture.Synchronize_s_aabb1 = new b2Collision_1.b2AABB();\n    b2Fixture.Synchronize_s_aabb2 = new b2Collision_1.b2AABB();\n    b2Fixture.Synchronize_s_displacement = new b2Math_1.b2Vec2();\n    return b2Fixture;\n}());\nexports.b2Fixture = b2Fixture;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2Fixture.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2Island.ts":
/*!****************************************!*\
  !*** ./src/Box2D/Dynamics/b2Island.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Settings_2 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Settings_3 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Settings_4 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Timer_1 = __webpack_require__(/*! ../Common/b2Timer */ \"./src/Box2D/Common/b2Timer.ts\");\nvar b2Body_1 = __webpack_require__(/*! ./b2Body */ \"./src/Box2D/Dynamics/b2Body.ts\");\nvar b2TimeStep_1 = __webpack_require__(/*! ./b2TimeStep */ \"./src/Box2D/Dynamics/b2TimeStep.ts\");\nvar b2WorldCallbacks_1 = __webpack_require__(/*! ./b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\");\nvar b2ContactSolver_1 = __webpack_require__(/*! ./Contacts/b2ContactSolver */ \"./src/Box2D/Dynamics/Contacts/b2ContactSolver.ts\");\n/*\nPosition Correction Notes\n=========================\nI tried the several algorithms for position correction of the 2D revolute joint.\nI looked at these systems:\n- simple pendulum (1m diameter sphere on massless 5m stick) with initial angular velocity of 100 rad/s.\n- suspension bridge with 30 1m long planks of length 1m.\n- multi-link chain with 30 1m long links.\n\nHere are the algorithms:\n\nBaumgarte - A fraction of the position error is added to the velocity error. There is no\nseparate position solver.\n\nPseudo Velocities - After the velocity solver and position integration,\nthe position error, Jacobian, and effective mass are recomputed. Then\nthe velocity constraints are solved with pseudo velocities and a fraction\nof the position error is added to the pseudo velocity error. The pseudo\nvelocities are initialized to zero and there is no warm-starting. After\nthe position solver, the pseudo velocities are added to the positions.\nThis is also called the First Order World method or the Position LCP method.\n\nModified Nonlinear Gauss-Seidel (NGS) - Like Pseudo Velocities except the\nposition error is re-computed for each constraint and the positions are updated\nafter the constraint is solved. The radius vectors (aka Jacobians) are\nre-computed too (otherwise the algorithm has horrible instability). The pseudo\nvelocity states are not needed because they are effectively zero at the beginning\nof each iteration. Since we have the current position error, we allow the\niterations to terminate early if the error becomes smaller than b2_linearSlop.\n\nFull NGS or just NGS - Like Modified NGS except the effective mass are re-computed\neach time a constraint is solved.\n\nHere are the results:\nBaumgarte - this is the cheapest algorithm but it has some stability problems,\nespecially with the bridge. The chain links separate easily close to the root\nand they jitter as they struggle to pull together. This is one of the most common\nmethods in the field. The big drawback is that the position correction artificially\naffects the momentum, thus leading to instabilities and false bounce. I used a\nbias factor of 0.2. A larger bias factor makes the bridge less stable, a smaller\nfactor makes joints and contacts more spongy.\n\nPseudo Velocities - the is more stable than the Baumgarte method. The bridge is\nstable. However, joints still separate with large angular velocities. Drag the\nsimple pendulum in a circle quickly and the joint will separate. The chain separates\neasily and does not recover. I used a bias factor of 0.2. A larger value lead to\nthe bridge collapsing when a heavy cube drops on it.\n\nModified NGS - this algorithm is better in some ways than Baumgarte and Pseudo\nVelocities, but in other ways it is worse. The bridge and chain are much more\nstable, but the simple pendulum goes unstable at high angular velocities.\n\nFull NGS - stable in all tests. The joints display good stiffness. The bridge\nstill sags, but this is better than infinite forces.\n\nRecommendations\nPseudo Velocities are not really worthwhile because the bridge and chain cannot\nrecover from joint separation. In other cases the benefit over Baumgarte is small.\n\nModified NGS is not a robust method for the revolute joint due to the violent\ninstability seen in the simple pendulum. Perhaps it is viable with other constraint\ntypes, especially scalar constraints where the effective mass is a scalar.\n\nThis leaves Baumgarte and Full NGS. Baumgarte has small, but manageable instabilities\nand is very fast. I don't think we can escape Baumgarte, especially in highly\ndemanding cases where high constraint fidelity is not needed.\n\nFull NGS is robust and easy on the eyes. I recommend this as an option for\nhigher fidelity simulation and certainly for suspension bridges and long chains.\nFull NGS might be a good choice for ragdolls, especially motorized ragdolls where\njoint separation can be problematic. The number of NGS iterations can be reduced\nfor better performance without harming robustness much.\n\nEach joint in a can be handled differently in the position solver. So I recommend\na system where the user can select the algorithm on a per joint basis. I would\nprobably default to the slower Full NGS and let the user select the faster\nBaumgarte method in performance critical scenarios.\n*/\n/*\nCache Performance\n\nThe Box2D solvers are dominated by cache misses. Data structures are designed\nto increase the number of cache hits. Much of misses are due to random access\nto body data. The constraint structures are iterated over linearly, which leads\nto few cache misses.\n\nThe bodies are not accessed during iteration. Instead read only data, such as\nthe mass values are stored with the constraints. The mutable data are the constraint\nimpulses and the bodies velocities/positions. The impulses are held inside the\nconstraint structures. The body velocities/positions are held in compact, temporary\narrays to increase the number of cache hits. Linear and angular velocity are\nstored in a single array since multiple arrays lead to multiple misses.\n*/\n/*\n2D Rotation\n\nR = [cos(theta) -sin(theta)]\n    [sin(theta) cos(theta) ]\n\nthetaDot = omega\n\nLet q1 = cos(theta), q2 = sin(theta).\nR = [q1 -q2]\n    [q2  q1]\n\nq1Dot = -thetaDot * q2\nq2Dot = thetaDot * q1\n\nq1_new = q1_old - dt * w * q2\nq2_new = q2_old + dt * w * q1\nthen normalize.\n\nThis might be faster than computing sin+cos.\nHowever, we can compute sin+cos of the same angle fast.\n*/\nvar b2Island = /** @class */ (function () {\n    function b2Island() {\n        this.m_allocator = null;\n        this.m_listener = null;\n        this.m_bodies = [ /*1024*/]; // TODO: b2Settings\n        this.m_contacts = [ /*1024*/]; // TODO: b2Settings\n        this.m_joints = [ /*1024*/]; // TODO: b2Settings\n        this.m_positions = b2TimeStep_1.b2Position.MakeArray(1024); // TODO: b2Settings\n        this.m_velocities = b2TimeStep_1.b2Velocity.MakeArray(1024); // TODO: b2Settings\n        this.m_bodyCount = 0;\n        this.m_jointCount = 0;\n        this.m_contactCount = 0;\n        this.m_bodyCapacity = 0;\n        this.m_contactCapacity = 0;\n        this.m_jointCapacity = 0;\n    }\n    b2Island.prototype.Initialize = function (bodyCapacity, contactCapacity, jointCapacity, allocator, listener) {\n        this.m_bodyCapacity = bodyCapacity;\n        this.m_contactCapacity = contactCapacity;\n        this.m_jointCapacity = jointCapacity;\n        this.m_bodyCount = 0;\n        this.m_contactCount = 0;\n        this.m_jointCount = 0;\n        this.m_allocator = allocator;\n        this.m_listener = listener;\n        // TODO:\n        while (this.m_bodies.length < bodyCapacity) {\n            this.m_bodies[this.m_bodies.length] = null;\n        }\n        // TODO:\n        while (this.m_contacts.length < contactCapacity) {\n            this.m_contacts[this.m_contacts.length] = null;\n        }\n        // TODO:\n        while (this.m_joints.length < jointCapacity) {\n            this.m_joints[this.m_joints.length] = null;\n        }\n        // TODO:\n        if (this.m_positions.length < bodyCapacity) {\n            var new_length = b2Math_1.b2Max(this.m_positions.length * 2, bodyCapacity);\n            while (this.m_positions.length < new_length) {\n                this.m_positions[this.m_positions.length] = new b2TimeStep_1.b2Position();\n            }\n        }\n        // TODO:\n        if (this.m_velocities.length < bodyCapacity) {\n            var new_length = b2Math_1.b2Max(this.m_velocities.length * 2, bodyCapacity);\n            while (this.m_velocities.length < new_length) {\n                this.m_velocities[this.m_velocities.length] = new b2TimeStep_1.b2Velocity();\n            }\n        }\n    };\n    b2Island.prototype.Clear = function () {\n        this.m_bodyCount = 0;\n        this.m_contactCount = 0;\n        this.m_jointCount = 0;\n    };\n    b2Island.prototype.AddBody = function (body) {\n        /// b2Assert(this.m_bodyCount < this.m_bodyCapacity);\n        body.m_islandIndex = this.m_bodyCount;\n        this.m_bodies[this.m_bodyCount++] = body;\n    };\n    b2Island.prototype.AddContact = function (contact) {\n        /// b2Assert(this.m_contactCount < this.m_contactCapacity);\n        this.m_contacts[this.m_contactCount++] = contact;\n    };\n    b2Island.prototype.AddJoint = function (joint) {\n        /// b2Assert(this.m_jointCount < this.m_jointCapacity);\n        this.m_joints[this.m_jointCount++] = joint;\n    };\n    b2Island.prototype.Solve = function (profile, step, gravity, allowSleep) {\n        var timer = b2Island.s_timer.Reset();\n        var h = step.dt;\n        // Integrate velocities and apply damping. Initialize the body state.\n        for (var i = 0; i < this.m_bodyCount; ++i) {\n            var b = this.m_bodies[i];\n            /*const c: b2Vec2 =*/\n            this.m_positions[i].c.Copy(b.m_sweep.c);\n            var a = b.m_sweep.a;\n            var v = this.m_velocities[i].v.Copy(b.m_linearVelocity);\n            var w = b.m_angularVelocity;\n            // Store positions for continuous collision.\n            b.m_sweep.c0.Copy(b.m_sweep.c);\n            b.m_sweep.a0 = b.m_sweep.a;\n            if (b.m_type === b2Body_1.b2BodyType.b2_dynamicBody) {\n                // Integrate velocities.\n                v.x += h * (b.m_gravityScale * gravity.x + b.m_invMass * b.m_force.x);\n                v.y += h * (b.m_gravityScale * gravity.y + b.m_invMass * b.m_force.y);\n                w += h * b.m_invI * b.m_torque;\n                // Apply damping.\n                // ODE: dv/dt + c * v = 0\n                // Solution: v(t) = v0 * exp(-c * t)\n                // Time step: v(t + dt) = v0 * exp(-c * (t + dt)) = v0 * exp(-c * t) * exp(-c * dt) = v * exp(-c * dt)\n                // v2 = exp(-c * dt) * v1\n                // Pade approximation:\n                // v2 = v1 * 1 / (1 + c * dt)\n                v.SelfMul(1.0 / (1.0 + h * b.m_linearDamping));\n                w *= 1.0 / (1.0 + h * b.m_angularDamping);\n            }\n            // this.m_positions[i].c = c;\n            this.m_positions[i].a = a;\n            // this.m_velocities[i].v = v;\n            this.m_velocities[i].w = w;\n        }\n        timer.Reset();\n        // Solver data\n        var solverData = b2Island.s_solverData;\n        solverData.step.Copy(step);\n        solverData.positions = this.m_positions;\n        solverData.velocities = this.m_velocities;\n        // Initialize velocity constraints.\n        var contactSolverDef = b2Island.s_contactSolverDef;\n        contactSolverDef.step.Copy(step);\n        contactSolverDef.contacts = this.m_contacts;\n        contactSolverDef.count = this.m_contactCount;\n        contactSolverDef.positions = this.m_positions;\n        contactSolverDef.velocities = this.m_velocities;\n        contactSolverDef.allocator = this.m_allocator;\n        var contactSolver = b2Island.s_contactSolver.Initialize(contactSolverDef);\n        contactSolver.InitializeVelocityConstraints();\n        if (step.warmStarting) {\n            contactSolver.WarmStart();\n        }\n        for (var i = 0; i < this.m_jointCount; ++i) {\n            this.m_joints[i].InitVelocityConstraints(solverData);\n        }\n        profile.solveInit = timer.GetMilliseconds();\n        // Solve velocity constraints.\n        timer.Reset();\n        for (var i = 0; i < step.velocityIterations; ++i) {\n            for (var j = 0; j < this.m_jointCount; ++j) {\n                this.m_joints[j].SolveVelocityConstraints(solverData);\n            }\n            contactSolver.SolveVelocityConstraints();\n        }\n        // Store impulses for warm starting\n        contactSolver.StoreImpulses();\n        profile.solveVelocity = timer.GetMilliseconds();\n        // Integrate positions.\n        for (var i = 0; i < this.m_bodyCount; ++i) {\n            var c = this.m_positions[i].c;\n            var a = this.m_positions[i].a;\n            var v = this.m_velocities[i].v;\n            var w = this.m_velocities[i].w;\n            // Check for large velocities\n            var translation = b2Math_1.b2Vec2.MulSV(h, v, b2Island.s_translation);\n            if (b2Math_1.b2Vec2.DotVV(translation, translation) > b2Settings_4.b2_maxTranslationSquared) {\n                var ratio = b2Settings_4.b2_maxTranslation / translation.Length();\n                v.SelfMul(ratio);\n            }\n            var rotation = h * w;\n            if (rotation * rotation > b2Settings_2.b2_maxRotationSquared) {\n                var ratio = b2Settings_2.b2_maxRotation / b2Math_1.b2Abs(rotation);\n                w *= ratio;\n            }\n            // Integrate\n            c.x += h * v.x;\n            c.y += h * v.y;\n            a += h * w;\n            // this.m_positions[i].c = c;\n            this.m_positions[i].a = a;\n            // this.m_velocities[i].v = v;\n            this.m_velocities[i].w = w;\n        }\n        // Solve position constraints\n        timer.Reset();\n        var positionSolved = false;\n        for (var i = 0; i < step.positionIterations; ++i) {\n            var contactsOkay = contactSolver.SolvePositionConstraints();\n            var jointsOkay = true;\n            for (var j = 0; j < this.m_jointCount; ++j) {\n                var jointOkay = this.m_joints[j].SolvePositionConstraints(solverData);\n                jointsOkay = jointsOkay && jointOkay;\n            }\n            if (contactsOkay && jointsOkay) {\n                // Exit early if the position errors are small.\n                positionSolved = true;\n                break;\n            }\n        }\n        // Copy state buffers back to the bodies\n        for (var i = 0; i < this.m_bodyCount; ++i) {\n            var body = this.m_bodies[i];\n            body.m_sweep.c.Copy(this.m_positions[i].c);\n            body.m_sweep.a = this.m_positions[i].a;\n            body.m_linearVelocity.Copy(this.m_velocities[i].v);\n            body.m_angularVelocity = this.m_velocities[i].w;\n            body.SynchronizeTransform();\n        }\n        profile.solvePosition = timer.GetMilliseconds();\n        this.Report(contactSolver.m_velocityConstraints);\n        if (allowSleep) {\n            var minSleepTime = b2Settings_1.b2_maxFloat;\n            var linTolSqr = b2Settings_3.b2_linearSleepTolerance * b2Settings_3.b2_linearSleepTolerance;\n            var angTolSqr = b2Settings_3.b2_angularSleepTolerance * b2Settings_3.b2_angularSleepTolerance;\n            for (var i = 0; i < this.m_bodyCount; ++i) {\n                var b = this.m_bodies[i];\n                if (b.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                    continue;\n                }\n                if (!b.m_autoSleepFlag ||\n                    b.m_angularVelocity * b.m_angularVelocity > angTolSqr ||\n                    b2Math_1.b2Vec2.DotVV(b.m_linearVelocity, b.m_linearVelocity) > linTolSqr) {\n                    b.m_sleepTime = 0;\n                    minSleepTime = 0;\n                }\n                else {\n                    b.m_sleepTime += h;\n                    minSleepTime = b2Math_1.b2Min(minSleepTime, b.m_sleepTime);\n                }\n            }\n            if (minSleepTime >= b2Settings_1.b2_timeToSleep && positionSolved) {\n                for (var i = 0; i < this.m_bodyCount; ++i) {\n                    var b = this.m_bodies[i];\n                    b.SetAwake(false);\n                }\n            }\n        }\n    };\n    b2Island.prototype.SolveTOI = function (subStep, toiIndexA, toiIndexB) {\n        /// b2Assert(toiIndexA < this.m_bodyCount);\n        /// b2Assert(toiIndexB < this.m_bodyCount);\n        // Initialize the body state.\n        for (var i = 0; i < this.m_bodyCount; ++i) {\n            var b = this.m_bodies[i];\n            this.m_positions[i].c.Copy(b.m_sweep.c);\n            this.m_positions[i].a = b.m_sweep.a;\n            this.m_velocities[i].v.Copy(b.m_linearVelocity);\n            this.m_velocities[i].w = b.m_angularVelocity;\n        }\n        var contactSolverDef = b2Island.s_contactSolverDef;\n        contactSolverDef.contacts = this.m_contacts;\n        contactSolverDef.count = this.m_contactCount;\n        contactSolverDef.allocator = this.m_allocator;\n        contactSolverDef.step.Copy(subStep);\n        contactSolverDef.positions = this.m_positions;\n        contactSolverDef.velocities = this.m_velocities;\n        var contactSolver = b2Island.s_contactSolver.Initialize(contactSolverDef);\n        // Solve position constraints.\n        for (var i = 0; i < subStep.positionIterations; ++i) {\n            var contactsOkay = contactSolver.SolveTOIPositionConstraints(toiIndexA, toiIndexB);\n            if (contactsOkay) {\n                break;\n            }\n        }\n        /*\n        #if 0\n          // Is the new position really safe?\n          for (int32 i = 0; i < this.m_contactCount; ++i) {\n            b2Contact* c = this.m_contacts[i];\n            b2Fixture* fA = c.GetFixtureA();\n            b2Fixture* fB = c.GetFixtureB();\n    \n            b2Body* bA = fA.GetBody();\n            b2Body* bB = fB.GetBody();\n    \n            int32 indexA = c.GetChildIndexA();\n            int32 indexB = c.GetChildIndexB();\n    \n            b2DistanceInput input;\n            input.proxyA.Set(fA.GetShape(), indexA);\n            input.proxyB.Set(fB.GetShape(), indexB);\n            input.transformA = bA.GetTransform();\n            input.transformB = bB.GetTransform();\n            input.useRadii = false;\n    \n            b2DistanceOutput output;\n            b2SimplexCache cache;\n            cache.count = 0;\n            b2Distance(&output, &cache, &input);\n    \n            if (output.distance === 0 || cache.count === 3) {\n              cache.count += 0;\n            }\n          }\n        #endif\n        */\n        // Leap of faith to new safe state.\n        this.m_bodies[toiIndexA].m_sweep.c0.Copy(this.m_positions[toiIndexA].c);\n        this.m_bodies[toiIndexA].m_sweep.a0 = this.m_positions[toiIndexA].a;\n        this.m_bodies[toiIndexB].m_sweep.c0.Copy(this.m_positions[toiIndexB].c);\n        this.m_bodies[toiIndexB].m_sweep.a0 = this.m_positions[toiIndexB].a;\n        // No warm starting is needed for TOI events because warm\n        // starting impulses were applied in the discrete solver.\n        contactSolver.InitializeVelocityConstraints();\n        // Solve velocity constraints.\n        for (var i = 0; i < subStep.velocityIterations; ++i) {\n            contactSolver.SolveVelocityConstraints();\n        }\n        // Don't store the TOI contact forces for warm starting\n        // because they can be quite large.\n        var h = subStep.dt;\n        // Integrate positions\n        for (var i = 0; i < this.m_bodyCount; ++i) {\n            var c = this.m_positions[i].c;\n            var a = this.m_positions[i].a;\n            var v = this.m_velocities[i].v;\n            var w = this.m_velocities[i].w;\n            // Check for large velocities\n            var translation = b2Math_1.b2Vec2.MulSV(h, v, b2Island.s_translation);\n            if (b2Math_1.b2Vec2.DotVV(translation, translation) > b2Settings_4.b2_maxTranslationSquared) {\n                var ratio = b2Settings_4.b2_maxTranslation / translation.Length();\n                v.SelfMul(ratio);\n            }\n            var rotation = h * w;\n            if (rotation * rotation > b2Settings_2.b2_maxRotationSquared) {\n                var ratio = b2Settings_2.b2_maxRotation / b2Math_1.b2Abs(rotation);\n                w *= ratio;\n            }\n            // Integrate\n            c.SelfMulAdd(h, v);\n            a += h * w;\n            // this.m_positions[i].c = c;\n            this.m_positions[i].a = a;\n            // this.m_velocities[i].v = v;\n            this.m_velocities[i].w = w;\n            // Sync bodies\n            var body = this.m_bodies[i];\n            body.m_sweep.c.Copy(c);\n            body.m_sweep.a = a;\n            body.m_linearVelocity.Copy(v);\n            body.m_angularVelocity = w;\n            body.SynchronizeTransform();\n        }\n        this.Report(contactSolver.m_velocityConstraints);\n    };\n    b2Island.prototype.Report = function (constraints) {\n        if (this.m_listener === null) {\n            return;\n        }\n        for (var i = 0; i < this.m_contactCount; ++i) {\n            var c = this.m_contacts[i];\n            if (!c) {\n                continue;\n            }\n            var vc = constraints[i];\n            var impulse = b2Island.s_impulse;\n            impulse.count = vc.pointCount;\n            for (var j = 0; j < vc.pointCount; ++j) {\n                impulse.normalImpulses[j] = vc.points[j].normalImpulse;\n                impulse.tangentImpulses[j] = vc.points[j].tangentImpulse;\n            }\n            this.m_listener.PostSolve(c, impulse);\n        }\n    };\n    b2Island.s_timer = new b2Timer_1.b2Timer();\n    b2Island.s_solverData = new b2TimeStep_1.b2SolverData();\n    b2Island.s_contactSolverDef = new b2ContactSolver_1.b2ContactSolverDef();\n    b2Island.s_contactSolver = new b2ContactSolver_1.b2ContactSolver();\n    b2Island.s_translation = new b2Math_1.b2Vec2();\n    b2Island.s_impulse = new b2WorldCallbacks_1.b2ContactImpulse();\n    return b2Island;\n}());\nexports.b2Island = b2Island;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2Island.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2TimeStep.ts":
/*!******************************************!*\
  !*** ./src/Box2D/Dynamics/b2TimeStep.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n/// Profiling data. Times are in milliseconds.\nvar b2Profile = /** @class */ (function () {\n    function b2Profile() {\n        this.step = 0;\n        this.collide = 0;\n        this.solve = 0;\n        this.solveInit = 0;\n        this.solveVelocity = 0;\n        this.solvePosition = 0;\n        this.broadphase = 0;\n        this.solveTOI = 0;\n    }\n    b2Profile.prototype.Reset = function () {\n        this.step = 0;\n        this.collide = 0;\n        this.solve = 0;\n        this.solveInit = 0;\n        this.solveVelocity = 0;\n        this.solvePosition = 0;\n        this.broadphase = 0;\n        this.solveTOI = 0;\n        return this;\n    };\n    return b2Profile;\n}());\nexports.b2Profile = b2Profile;\n/// This is an internal structure.\nvar b2TimeStep = /** @class */ (function () {\n    function b2TimeStep() {\n        this.dt = 0; // time step\n        this.inv_dt = 0; // inverse time step (0 if dt == 0).\n        this.dtRatio = 0; // dt * inv_dt0\n        this.velocityIterations = 0;\n        this.positionIterations = 0;\n        // #if B2_ENABLE_PARTICLE\n        this.particleIterations = 0;\n        // #endif\n        this.warmStarting = false;\n    }\n    b2TimeStep.prototype.Copy = function (step) {\n        this.dt = step.dt;\n        this.inv_dt = step.inv_dt;\n        this.dtRatio = step.dtRatio;\n        this.positionIterations = step.positionIterations;\n        this.velocityIterations = step.velocityIterations;\n        // #if B2_ENABLE_PARTICLE\n        this.particleIterations = step.particleIterations;\n        // #endif\n        this.warmStarting = step.warmStarting;\n        return this;\n    };\n    return b2TimeStep;\n}());\nexports.b2TimeStep = b2TimeStep;\nvar b2Position = /** @class */ (function () {\n    function b2Position() {\n        this.c = new b2Math_1.b2Vec2();\n        this.a = 0;\n    }\n    b2Position.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2Position(); });\n    };\n    return b2Position;\n}());\nexports.b2Position = b2Position;\nvar b2Velocity = /** @class */ (function () {\n    function b2Velocity() {\n        this.v = new b2Math_1.b2Vec2();\n        this.w = 0;\n    }\n    b2Velocity.MakeArray = function (length) {\n        return b2Settings_1.b2MakeArray(length, function (i) { return new b2Velocity(); });\n    };\n    return b2Velocity;\n}());\nexports.b2Velocity = b2Velocity;\nvar b2SolverData = /** @class */ (function () {\n    function b2SolverData() {\n        this.step = new b2TimeStep();\n        this.positions = null;\n        this.velocities = null;\n    }\n    return b2SolverData;\n}());\nexports.b2SolverData = b2SolverData;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2TimeStep.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2World.ts":
/*!***************************************!*\
  !*** ./src/Box2D/Dynamics/b2World.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Collision_1 = __webpack_require__(/*! ../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2TimeOfImpact_1 = __webpack_require__(/*! ../Collision/b2TimeOfImpact */ \"./src/Box2D/Collision/b2TimeOfImpact.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ../Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Draw_1 = __webpack_require__(/*! ../Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\n// #if B2_ENABLE_PARTICLE\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Settings_2 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Timer_1 = __webpack_require__(/*! ../Common/b2Timer */ \"./src/Box2D/Common/b2Timer.ts\");\nvar b2Particle_1 = __webpack_require__(/*! ../Particle/b2Particle */ \"./src/Box2D/Particle/b2Particle.ts\");\nvar b2ParticleSystem_1 = __webpack_require__(/*! ../Particle/b2ParticleSystem */ \"./src/Box2D/Particle/b2ParticleSystem.ts\");\nvar b2Body_1 = __webpack_require__(/*! ./b2Body */ \"./src/Box2D/Dynamics/b2Body.ts\");\nvar b2ContactManager_1 = __webpack_require__(/*! ./b2ContactManager */ \"./src/Box2D/Dynamics/b2ContactManager.ts\");\nvar b2Island_1 = __webpack_require__(/*! ./b2Island */ \"./src/Box2D/Dynamics/b2Island.ts\");\nvar b2TimeStep_1 = __webpack_require__(/*! ./b2TimeStep */ \"./src/Box2D/Dynamics/b2TimeStep.ts\");\nvar b2WorldCallbacks_1 = __webpack_require__(/*! ./b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\");\nvar b2WorldCallbacks_2 = __webpack_require__(/*! ./b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\");\nvar b2Joint_1 = __webpack_require__(/*! ./Joints/b2Joint */ \"./src/Box2D/Dynamics/Joints/b2Joint.ts\");\nvar b2JointFactory_1 = __webpack_require__(/*! ./Joints/b2JointFactory */ \"./src/Box2D/Dynamics/Joints/b2JointFactory.ts\");\n// #endif\n/// The world class manages all physics entities, dynamic simulation,\n/// and asynchronous queries. The world also contains efficient memory\n/// management facilities.\nvar b2World = /** @class */ (function () {\n    // #endif\n    /// Construct a world object.\n    /// @param gravity the world gravity vector.\n    function b2World(gravity) {\n        // b2BlockAllocator m_blockAllocator;\n        // b2StackAllocator m_stackAllocator;\n        this.m_newFixture = false;\n        this.m_locked = false;\n        this.m_clearForces = true;\n        this.m_contactManager = new b2ContactManager_1.b2ContactManager();\n        this.m_bodyList = null;\n        this.m_jointList = null;\n        // #if B2_ENABLE_PARTICLE\n        this.m_particleSystemList = null;\n        // #endif\n        this.m_bodyCount = 0;\n        this.m_jointCount = 0;\n        this.m_gravity = new b2Math_1.b2Vec2();\n        this.m_allowSleep = true;\n        this.m_destructionListener = null;\n        this.m_debugDraw = null;\n        // This is used to compute the time step ratio to\n        // support a variable time step.\n        this.m_inv_dt0 = 0;\n        // These are for debugging the solver.\n        this.m_warmStarting = true;\n        this.m_continuousPhysics = true;\n        this.m_subStepping = false;\n        this.m_stepComplete = true;\n        this.m_profile = new b2TimeStep_1.b2Profile();\n        this.m_island = new b2Island_1.b2Island();\n        this.s_stack = [];\n        // #if B2_ENABLE_CONTROLLER\n        this.m_controllerList = null;\n        this.m_controllerCount = 0;\n        this.m_gravity.Copy(gravity);\n    }\n    /// Register a destruction listener. The listener is owned by you and must\n    /// remain in scope.\n    b2World.prototype.SetDestructionListener = function (listener) {\n        this.m_destructionListener = listener;\n    };\n    /// Register a contact filter to provide specific control over collision.\n    /// Otherwise the default filter is used (b2_defaultFilter). The listener is\n    /// owned by you and must remain in scope.\n    b2World.prototype.SetContactFilter = function (filter) {\n        this.m_contactManager.m_contactFilter = filter;\n    };\n    /// Register a contact event listener. The listener is owned by you and must\n    /// remain in scope.\n    b2World.prototype.SetContactListener = function (listener) {\n        this.m_contactManager.m_contactListener = listener;\n    };\n    /// Register a routine for debug drawing. The debug draw functions are called\n    /// inside with b2World::DrawDebugData method. The debug draw object is owned\n    /// by you and must remain in scope.\n    b2World.prototype.SetDebugDraw = function (debugDraw) {\n        this.m_debugDraw = debugDraw;\n    };\n    /// Create a rigid body given a definition. No reference to the definition\n    /// is retained.\n    /// @warning This function is locked during callbacks.\n    b2World.prototype.CreateBody = function (def) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return null;\n        }\n        var b = new b2Body_1.b2Body(def, this);\n        // Add to world doubly linked list.\n        b.m_prev = null;\n        b.m_next = this.m_bodyList;\n        if (this.m_bodyList) {\n            this.m_bodyList.m_prev = b;\n        }\n        this.m_bodyList = b;\n        ++this.m_bodyCount;\n        return b;\n    };\n    /// Destroy a rigid body given a definition. No reference to the definition\n    /// is retained. This function is locked during callbacks.\n    /// @warning This automatically deletes all associated shapes and joints.\n    /// @warning This function is locked during callbacks.\n    b2World.prototype.DestroyBody = function (b) {\n        /// b2Assert(this.m_bodyCount > 0);\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return;\n        }\n        // Delete the attached joints.\n        var je = b.m_jointList;\n        while (je) {\n            var je0 = je;\n            je = je.next;\n            if (this.m_destructionListener) {\n                this.m_destructionListener.SayGoodbyeJoint(je0.joint);\n            }\n            this.DestroyJoint(je0.joint);\n            b.m_jointList = je;\n        }\n        b.m_jointList = null;\n        // #if B2_ENABLE_CONTROLLER\n        // @see b2Controller list\n        var coe = b.m_controllerList;\n        while (coe) {\n            var coe0 = coe;\n            coe = coe.nextController;\n            coe0.controller.RemoveBody(b);\n        }\n        // #endif\n        // Delete the attached contacts.\n        var ce = b.m_contactList;\n        while (ce) {\n            var ce0 = ce;\n            ce = ce.next;\n            this.m_contactManager.Destroy(ce0.contact);\n        }\n        b.m_contactList = null;\n        // Delete the attached fixtures. This destroys broad-phase proxies.\n        var f = b.m_fixtureList;\n        while (f) {\n            var f0 = f;\n            f = f.m_next;\n            if (this.m_destructionListener) {\n                this.m_destructionListener.SayGoodbyeFixture(f0);\n            }\n            f0.DestroyProxies(this.m_contactManager.m_broadPhase);\n            f0.Destroy();\n            b.m_fixtureList = f;\n            b.m_fixtureCount -= 1;\n        }\n        b.m_fixtureList = null;\n        b.m_fixtureCount = 0;\n        // Remove world body list.\n        if (b.m_prev) {\n            b.m_prev.m_next = b.m_next;\n        }\n        if (b.m_next) {\n            b.m_next.m_prev = b.m_prev;\n        }\n        if (b === this.m_bodyList) {\n            this.m_bodyList = b.m_next;\n        }\n        --this.m_bodyCount;\n    };\n    /// Create a joint to constrain bodies together. No reference to the definition\n    /// is retained. This may cause the connected bodies to cease colliding.\n    /// @warning This function is locked during callbacks.\n    b2World.prototype.CreateJoint = function (def) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return null;\n        }\n        var j = b2JointFactory_1.b2JointFactory.Create(def, null);\n        // Connect to the world list.\n        j.m_prev = null;\n        j.m_next = this.m_jointList;\n        if (this.m_jointList) {\n            this.m_jointList.m_prev = j;\n        }\n        this.m_jointList = j;\n        ++this.m_jointCount;\n        // Connect to the bodies' doubly linked lists.\n        // j.m_edgeA.joint = j;\n        // j.m_edgeA.other = j.m_bodyB;\n        j.m_edgeA.prev = null;\n        j.m_edgeA.next = j.m_bodyA.m_jointList;\n        if (j.m_bodyA.m_jointList) {\n            j.m_bodyA.m_jointList.prev = j.m_edgeA;\n        }\n        j.m_bodyA.m_jointList = j.m_edgeA;\n        // j.m_edgeB.joint = j;\n        // j.m_edgeB.other = j.m_bodyA;\n        j.m_edgeB.prev = null;\n        j.m_edgeB.next = j.m_bodyB.m_jointList;\n        if (j.m_bodyB.m_jointList) {\n            j.m_bodyB.m_jointList.prev = j.m_edgeB;\n        }\n        j.m_bodyB.m_jointList = j.m_edgeB;\n        var bodyA = def.bodyA;\n        var bodyB = def.bodyB;\n        // If the joint prevents collisions, then flag any contacts for filtering.\n        if (!def.collideConnected) {\n            var edge = bodyB.GetContactList();\n            while (edge) {\n                if (edge.other === bodyA) {\n                    // Flag the contact for filtering at the next time step (where either\n                    // body is awake).\n                    edge.contact.FlagForFiltering();\n                }\n                edge = edge.next;\n            }\n        }\n        // Note: creating a joint doesn't wake the bodies.\n        return j;\n    };\n    /// Destroy a joint. This may cause the connected bodies to begin colliding.\n    /// @warning This function is locked during callbacks.\n    b2World.prototype.DestroyJoint = function (j) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return;\n        }\n        var collideConnected = j.m_collideConnected;\n        // Remove from the doubly linked list.\n        if (j.m_prev) {\n            j.m_prev.m_next = j.m_next;\n        }\n        if (j.m_next) {\n            j.m_next.m_prev = j.m_prev;\n        }\n        if (j === this.m_jointList) {\n            this.m_jointList = j.m_next;\n        }\n        // Disconnect from island graph.\n        var bodyA = j.m_bodyA;\n        var bodyB = j.m_bodyB;\n        // Wake up connected bodies.\n        bodyA.SetAwake(true);\n        bodyB.SetAwake(true);\n        // Remove from body 1.\n        if (j.m_edgeA.prev) {\n            j.m_edgeA.prev.next = j.m_edgeA.next;\n        }\n        if (j.m_edgeA.next) {\n            j.m_edgeA.next.prev = j.m_edgeA.prev;\n        }\n        if (j.m_edgeA === bodyA.m_jointList) {\n            bodyA.m_jointList = j.m_edgeA.next;\n        }\n        j.m_edgeA.prev = null;\n        j.m_edgeA.next = null;\n        // Remove from body 2\n        if (j.m_edgeB.prev) {\n            j.m_edgeB.prev.next = j.m_edgeB.next;\n        }\n        if (j.m_edgeB.next) {\n            j.m_edgeB.next.prev = j.m_edgeB.prev;\n        }\n        if (j.m_edgeB === bodyB.m_jointList) {\n            bodyB.m_jointList = j.m_edgeB.next;\n        }\n        j.m_edgeB.prev = null;\n        j.m_edgeB.next = null;\n        b2JointFactory_1.b2JointFactory.Destroy(j, null);\n        /// b2Assert(this.m_jointCount > 0);\n        --this.m_jointCount;\n        // If the joint prevents collisions, then flag any contacts for filtering.\n        if (!collideConnected) {\n            var edge = bodyB.GetContactList();\n            while (edge) {\n                if (edge.other === bodyA) {\n                    // Flag the contact for filtering at the next time step (where either\n                    // body is awake).\n                    edge.contact.FlagForFiltering();\n                }\n                edge = edge.next;\n            }\n        }\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2World.prototype.CreateParticleSystem = function (def) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return null;\n        }\n        var p = new b2ParticleSystem_1.b2ParticleSystem(def, this);\n        // Add to world doubly linked list.\n        p.m_prev = null;\n        p.m_next = this.m_particleSystemList;\n        if (this.m_particleSystemList) {\n            this.m_particleSystemList.m_prev = p;\n        }\n        this.m_particleSystemList = p;\n        return p;\n    };\n    b2World.prototype.DestroyParticleSystem = function (p) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return;\n        }\n        // Remove world particleSystem list.\n        if (p.m_prev) {\n            p.m_prev.m_next = p.m_next;\n        }\n        if (p.m_next) {\n            p.m_next.m_prev = p.m_prev;\n        }\n        if (p === this.m_particleSystemList) {\n            this.m_particleSystemList = p.m_next;\n        }\n    };\n    b2World.prototype.CalculateReasonableParticleIterations = function (timeStep) {\n        if (this.m_particleSystemList === null) {\n            return 1;\n        }\n        function GetSmallestRadius(world) {\n            var smallestRadius = b2Settings_1.b2_maxFloat;\n            for (var system = world.GetParticleSystemList(); system !== null; system = system.m_next) {\n                smallestRadius = b2Math_1.b2Min(smallestRadius, system.GetRadius());\n            }\n            return smallestRadius;\n        }\n        // Use the smallest radius, since that represents the worst-case.\n        return b2Particle_1.b2CalculateParticleIterations(this.m_gravity.Length(), GetSmallestRadius(this), timeStep);\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2World.prototype.Step = function (dt, velocityIterations, positionIterations, particleIterations) {\n        if (particleIterations === void 0) { particleIterations = this.CalculateReasonableParticleIterations(dt); }\n        // #else\n        // public Step(dt: number, velocityIterations: number, positionIterations: number): void {\n        // #endif\n        var stepTimer = b2World.Step_s_stepTimer.Reset();\n        // If new fixtures were added, we need to find the new contacts.\n        if (this.m_newFixture) {\n            this.m_contactManager.FindNewContacts();\n            this.m_newFixture = false;\n        }\n        this.m_locked = true;\n        var step = b2World.Step_s_step;\n        step.dt = dt;\n        step.velocityIterations = velocityIterations;\n        step.positionIterations = positionIterations;\n        // #if B2_ENABLE_PARTICLE\n        step.particleIterations = particleIterations;\n        // #endif\n        if (dt > 0) {\n            step.inv_dt = 1 / dt;\n        }\n        else {\n            step.inv_dt = 0;\n        }\n        step.dtRatio = this.m_inv_dt0 * dt;\n        step.warmStarting = this.m_warmStarting;\n        // Update contacts. This is where some contacts are destroyed.\n        var timer = b2World.Step_s_timer.Reset();\n        this.m_contactManager.Collide();\n        this.m_profile.collide = timer.GetMilliseconds();\n        // Integrate velocities, solve velocity constraints, and integrate positions.\n        if (this.m_stepComplete && step.dt > 0) {\n            // tslint:disable-next-line:no-shadowed-variable\n            var timer_1 = b2World.Step_s_timer.Reset();\n            // #if B2_ENABLE_PARTICLE\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                p.Solve(step); // Particle Simulation\n            }\n            // #endif\n            this.Solve(step);\n            this.m_profile.solve = timer_1.GetMilliseconds();\n        }\n        // Handle TOI events.\n        if (this.m_continuousPhysics && step.dt > 0) {\n            // tslint:disable-next-line:no-shadowed-variable\n            var timer_2 = b2World.Step_s_timer.Reset();\n            this.SolveTOI(step);\n            this.m_profile.solveTOI = timer_2.GetMilliseconds();\n        }\n        if (step.dt > 0) {\n            this.m_inv_dt0 = step.inv_dt;\n        }\n        if (this.m_clearForces) {\n            this.ClearForces();\n        }\n        this.m_locked = false;\n        this.m_profile.step = stepTimer.GetMilliseconds();\n    };\n    /// Manually clear the force buffer on all bodies. By default, forces are cleared automatically\n    /// after each call to Step. The default behavior is modified by calling SetAutoClearForces.\n    /// The purpose of this function is to support sub-stepping. Sub-stepping is often used to maintain\n    /// a fixed sized time step under a variable frame-rate.\n    /// When you perform sub-stepping you will disable auto clearing of forces and instead call\n    /// ClearForces after all sub-steps are complete in one pass of your game loop.\n    /// @see SetAutoClearForces\n    b2World.prototype.ClearForces = function () {\n        for (var body = this.m_bodyList; body; body = body.m_next) {\n            body.m_force.SetZero();\n            body.m_torque = 0;\n        }\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2World.prototype.DrawParticleSystem = function (system) {\n        var particleCount = system.GetParticleCount();\n        if (particleCount) {\n            var radius = system.GetRadius();\n            var positionBuffer = system.GetPositionBuffer();\n            if (system.m_colorBuffer.data) {\n                var colorBuffer = system.GetColorBuffer();\n                this.m_debugDraw.DrawParticles(positionBuffer, radius, colorBuffer, particleCount);\n            }\n            else {\n                this.m_debugDraw.DrawParticles(positionBuffer, radius, null, particleCount);\n            }\n        }\n    };\n    b2World.prototype.DrawDebugData = function () {\n        if (this.m_debugDraw === null) {\n            return;\n        }\n        var flags = this.m_debugDraw.GetFlags();\n        var color = b2World.DrawDebugData_s_color.SetRGB(0, 0, 0);\n        if (flags & b2Draw_1.b2DrawFlags.e_shapeBit) {\n            for (var b = this.m_bodyList; b; b = b.m_next) {\n                var xf = b.m_xf;\n                this.m_debugDraw.PushTransform(xf);\n                for (var f = b.GetFixtureList(); f; f = f.m_next) {\n                    if (!b.IsActive()) {\n                        color.SetRGB(0.5, 0.5, 0.3);\n                        this.DrawShape(f, color);\n                    }\n                    else if (b.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                        color.SetRGB(0.5, 0.9, 0.5);\n                        this.DrawShape(f, color);\n                    }\n                    else if (b.GetType() === b2Body_1.b2BodyType.b2_kinematicBody) {\n                        color.SetRGB(0.5, 0.5, 0.9);\n                        this.DrawShape(f, color);\n                    }\n                    else if (!b.IsAwake()) {\n                        color.SetRGB(0.6, 0.6, 0.6);\n                        this.DrawShape(f, color);\n                    }\n                    else {\n                        color.SetRGB(0.9, 0.7, 0.7);\n                        this.DrawShape(f, color);\n                    }\n                }\n                this.m_debugDraw.PopTransform(xf);\n            }\n        }\n        // #if B2_ENABLE_PARTICLE\n        if (flags & b2Draw_1.b2DrawFlags.e_particleBit) {\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                this.DrawParticleSystem(p);\n            }\n        }\n        // #endif\n        if (flags & b2Draw_1.b2DrawFlags.e_jointBit) {\n            for (var j = this.m_jointList; j; j = j.m_next) {\n                this.DrawJoint(j);\n            }\n        }\n        /*\n        if (flags & b2DrawFlags.e_pairBit) {\n          color.SetRGB(0.3, 0.9, 0.9);\n          for (let contact = this.m_contactManager.m_contactList; contact; contact = contact.m_next) {\n            const fixtureA = contact.GetFixtureA();\n            const fixtureB = contact.GetFixtureB();\n    \n            const cA = fixtureA.GetAABB().GetCenter();\n            const cB = fixtureB.GetAABB().GetCenter();\n    \n            this.m_debugDraw.DrawSegment(cA, cB, color);\n          }\n        }\n        */\n        if (flags & b2Draw_1.b2DrawFlags.e_aabbBit) {\n            color.SetRGB(0.9, 0.3, 0.9);\n            var bp = this.m_contactManager.m_broadPhase;\n            var vs = b2World.DrawDebugData_s_vs;\n            for (var b = this.m_bodyList; b; b = b.m_next) {\n                if (!b.IsActive()) {\n                    continue;\n                }\n                for (var f = b.GetFixtureList(); f; f = f.m_next) {\n                    for (var i = 0; i < f.m_proxyCount; ++i) {\n                        var proxy = f.m_proxies[i];\n                        var aabb = bp.GetFatAABB(proxy.treeNode);\n                        vs[0].Set(aabb.lowerBound.x, aabb.lowerBound.y);\n                        vs[1].Set(aabb.upperBound.x, aabb.lowerBound.y);\n                        vs[2].Set(aabb.upperBound.x, aabb.upperBound.y);\n                        vs[3].Set(aabb.lowerBound.x, aabb.upperBound.y);\n                        this.m_debugDraw.DrawPolygon(vs, 4, color);\n                    }\n                }\n            }\n        }\n        if (flags & b2Draw_1.b2DrawFlags.e_centerOfMassBit) {\n            for (var b = this.m_bodyList; b; b = b.m_next) {\n                var xf = b2World.DrawDebugData_s_xf;\n                xf.q.Copy(b.m_xf.q);\n                xf.p.Copy(b.GetWorldCenter());\n                this.m_debugDraw.DrawTransform(xf);\n            }\n        }\n        // #if B2_ENABLE_CONTROLLER\n        // @see b2Controller list\n        if (flags & b2Draw_1.b2DrawFlags.e_controllerBit) {\n            for (var c = this.m_controllerList; c; c = c.m_next) {\n                c.Draw(this.m_debugDraw);\n            }\n        }\n        // #endif\n    };\n    /// Query the world for all fixtures that potentially overlap the\n    /// provided AABB.\n    /// @param callback a user implemented callback class.\n    /// @param aabb the query box.\n    b2World.prototype.QueryAABB = function (callback, aabb) {\n        var broadPhase = this.m_contactManager.m_broadPhase;\n        function WorldQueryWrapper(proxy) {\n            var fixture_proxy = broadPhase.GetUserData(proxy);\n            /// b2Assert(fixture_proxy instanceof b2FixtureProxy);\n            var fixture = fixture_proxy.fixture;\n            /// const index: number = fixture_proxy.childIndex;\n            if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n                return callback.ReportFixture(fixture);\n            }\n            else /* if (typeof(callback) === 'function') */ {\n                return callback(fixture);\n            }\n        }\n        broadPhase.Query(WorldQueryWrapper, aabb);\n        // #if B2_ENABLE_PARTICLE\n        if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                if (callback.ShouldQueryParticleSystem(p)) {\n                    p.QueryAABB(callback, aabb);\n                }\n            }\n        }\n        // #endif\n    };\n    b2World.prototype.QueryShape = function (callback, shape, transform) {\n        var broadPhase = this.m_contactManager.m_broadPhase;\n        function WorldQueryWrapper(proxy) {\n            var fixture_proxy = broadPhase.GetUserData(proxy);\n            /// b2Assert(fixture_proxy instanceof b2FixtureProxy);\n            var fixture = fixture_proxy.fixture;\n            /// const index: number = fixture_proxy.childIndex;\n            if (b2Collision_1.b2TestOverlapShape(shape, 0, fixture.GetShape(), 0, transform, fixture.GetBody().GetTransform())) {\n                if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n                    return callback.ReportFixture(fixture);\n                }\n                else /* if (typeof(callback) === 'function') */ {\n                    return callback(fixture);\n                }\n            }\n            return true;\n        }\n        var aabb = b2World.QueryShape_s_aabb;\n        shape.ComputeAABB(aabb, transform, 0); // TODO\n        broadPhase.Query(WorldQueryWrapper, aabb);\n        // #if B2_ENABLE_PARTICLE\n        if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                if (callback.ShouldQueryParticleSystem(p)) {\n                    p.QueryAABB(callback, aabb);\n                }\n            }\n        }\n        // #endif\n    };\n    b2World.prototype.QueryPoint = function (callback, point) {\n        var broadPhase = this.m_contactManager.m_broadPhase;\n        function WorldQueryWrapper(proxy) {\n            var fixture_proxy = broadPhase.GetUserData(proxy);\n            /// b2Assert(fixture_proxy instanceof b2FixtureProxy);\n            var fixture = fixture_proxy.fixture;\n            /// const index: number = fixture_proxy.childIndex;\n            if (fixture.TestPoint(point)) {\n                if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n                    return callback.ReportFixture(fixture);\n                }\n                else /* if (typeof(callback) === 'function') */ {\n                    return callback(fixture);\n                }\n            }\n            return true;\n        }\n        var aabb = b2World.QueryPoint_s_aabb;\n        aabb.lowerBound.Set(point.x - b2Settings_2.b2_linearSlop, point.y - b2Settings_2.b2_linearSlop);\n        aabb.upperBound.Set(point.x + b2Settings_2.b2_linearSlop, point.y + b2Settings_2.b2_linearSlop);\n        broadPhase.Query(WorldQueryWrapper, aabb);\n        // #if B2_ENABLE_PARTICLE\n        if (callback instanceof b2WorldCallbacks_1.b2QueryCallback) {\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                if (callback.ShouldQueryParticleSystem(p)) {\n                    p.QueryAABB(callback, aabb);\n                }\n            }\n        }\n        // #endif\n    };\n    b2World.prototype.RayCast = function (callback, point1, point2) {\n        var broadPhase = this.m_contactManager.m_broadPhase;\n        // tslint:disable-next-line:no-shadowed-variable\n        function WorldRayCastWrapper(input, proxy) {\n            var fixture_proxy = broadPhase.GetUserData(proxy);\n            /// b2Assert(fixture_proxy instanceof b2FixtureProxy);\n            var fixture = fixture_proxy.fixture;\n            var index = fixture_proxy.childIndex;\n            var output = b2World.RayCast_s_output;\n            var hit = fixture.RayCast(output, input, index);\n            if (hit) {\n                var fraction = output.fraction;\n                var point = b2World.RayCast_s_point;\n                point.Set((1 - fraction) * point1.x + fraction * point2.x, (1 - fraction) * point1.y + fraction * point2.y);\n                if (callback instanceof b2WorldCallbacks_2.b2RayCastCallback) {\n                    return callback.ReportFixture(fixture, point, output.normal, fraction);\n                }\n                else /* if (typeof(callback) === 'function') */ {\n                    return callback(fixture, point, output.normal, fraction);\n                }\n            }\n            return input.maxFraction;\n        }\n        var input = b2World.RayCast_s_input;\n        input.maxFraction = 1;\n        input.p1.Copy(point1);\n        input.p2.Copy(point2);\n        broadPhase.RayCast(WorldRayCastWrapper, input);\n        // #if B2_ENABLE_PARTICLE\n        if (callback instanceof b2WorldCallbacks_2.b2RayCastCallback) {\n            for (var p = this.m_particleSystemList; p; p = p.m_next) {\n                if (callback.ShouldQueryParticleSystem(p)) {\n                    p.RayCast(callback, point1, point2);\n                }\n            }\n        }\n        // #endif\n    };\n    b2World.prototype.RayCastOne = function (point1, point2) {\n        var result = null;\n        var min_fraction = 1;\n        function WorldRayCastOneWrapper(fixture, point, normal, fraction) {\n            if (fraction < min_fraction) {\n                min_fraction = fraction;\n                result = fixture;\n            }\n            return min_fraction;\n        }\n        this.RayCast(WorldRayCastOneWrapper, point1, point2);\n        return result;\n    };\n    b2World.prototype.RayCastAll = function (point1, point2, out) {\n        if (out === void 0) { out = []; }\n        function WorldRayCastAllWrapper(fixture, point, normal, fraction) {\n            out.push(fixture);\n            return 1;\n        }\n        this.RayCast(WorldRayCastAllWrapper, point1, point2);\n        return out;\n    };\n    /// Get the world body list. With the returned body, use b2Body::GetNext to get\n    /// the next body in the world list. A NULL body indicates the end of the list.\n    /// @return the head of the world body list.\n    b2World.prototype.GetBodyList = function () {\n        return this.m_bodyList;\n    };\n    /// Get the world joint list. With the returned joint, use b2Joint::GetNext to get\n    /// the next joint in the world list. A NULL joint indicates the end of the list.\n    /// @return the head of the world joint list.\n    b2World.prototype.GetJointList = function () {\n        return this.m_jointList;\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2World.prototype.GetParticleSystemList = function () {\n        return this.m_particleSystemList;\n    };\n    // #endif\n    /// Get the world contact list. With the returned contact, use b2Contact::GetNext to get\n    /// the next contact in the world list. A NULL contact indicates the end of the list.\n    /// @return the head of the world contact list.\n    /// @warning contacts are created and destroyed in the middle of a time step.\n    /// Use b2ContactListener to avoid missing contacts.\n    b2World.prototype.GetContactList = function () {\n        return this.m_contactManager.m_contactList;\n    };\n    /// Enable/disable sleep.\n    b2World.prototype.SetAllowSleeping = function (flag) {\n        if (flag === this.m_allowSleep) {\n            return;\n        }\n        this.m_allowSleep = flag;\n        if (!this.m_allowSleep) {\n            for (var b = this.m_bodyList; b; b = b.m_next) {\n                b.SetAwake(true);\n            }\n        }\n    };\n    b2World.prototype.GetAllowSleeping = function () {\n        return this.m_allowSleep;\n    };\n    /// Enable/disable warm starting. For testing.\n    b2World.prototype.SetWarmStarting = function (flag) {\n        this.m_warmStarting = flag;\n    };\n    b2World.prototype.GetWarmStarting = function () {\n        return this.m_warmStarting;\n    };\n    /// Enable/disable continuous physics. For testing.\n    b2World.prototype.SetContinuousPhysics = function (flag) {\n        this.m_continuousPhysics = flag;\n    };\n    b2World.prototype.GetContinuousPhysics = function () {\n        return this.m_continuousPhysics;\n    };\n    /// Enable/disable single stepped continuous physics. For testing.\n    b2World.prototype.SetSubStepping = function (flag) {\n        this.m_subStepping = flag;\n    };\n    b2World.prototype.GetSubStepping = function () {\n        return this.m_subStepping;\n    };\n    /// Get the number of broad-phase proxies.\n    b2World.prototype.GetProxyCount = function () {\n        return this.m_contactManager.m_broadPhase.GetProxyCount();\n    };\n    /// Get the number of bodies.\n    b2World.prototype.GetBodyCount = function () {\n        return this.m_bodyCount;\n    };\n    /// Get the number of joints.\n    b2World.prototype.GetJointCount = function () {\n        return this.m_jointCount;\n    };\n    /// Get the number of contacts (each may have 0 or more contact points).\n    b2World.prototype.GetContactCount = function () {\n        return this.m_contactManager.m_contactCount;\n    };\n    /// Get the height of the dynamic tree.\n    b2World.prototype.GetTreeHeight = function () {\n        return this.m_contactManager.m_broadPhase.GetTreeHeight();\n    };\n    /// Get the balance of the dynamic tree.\n    b2World.prototype.GetTreeBalance = function () {\n        return this.m_contactManager.m_broadPhase.GetTreeBalance();\n    };\n    /// Get the quality metric of the dynamic tree. The smaller the better.\n    /// The minimum is 1.\n    b2World.prototype.GetTreeQuality = function () {\n        return this.m_contactManager.m_broadPhase.GetTreeQuality();\n    };\n    /// Change the global gravity vector.\n    b2World.prototype.SetGravity = function (gravity, wake) {\n        if (wake === void 0) { wake = true; }\n        if (!b2Math_1.b2Vec2.IsEqualToV(this.m_gravity, gravity)) {\n            this.m_gravity.Copy(gravity);\n            if (wake) {\n                for (var b = this.m_bodyList; b; b = b.m_next) {\n                    b.SetAwake(true);\n                }\n            }\n        }\n    };\n    /// Get the global gravity vector.\n    b2World.prototype.GetGravity = function () {\n        return this.m_gravity;\n    };\n    /// Is the world locked (in the middle of a time step).\n    b2World.prototype.IsLocked = function () {\n        return this.m_locked;\n    };\n    /// Set flag to control automatic clearing of forces after each time step.\n    b2World.prototype.SetAutoClearForces = function (flag) {\n        this.m_clearForces = flag;\n    };\n    /// Get the flag that controls automatic clearing of forces after each time step.\n    b2World.prototype.GetAutoClearForces = function () {\n        return this.m_clearForces;\n    };\n    /// Shift the world origin. Useful for large worlds.\n    /// The body shift formula is: position -= newOrigin\n    /// @param newOrigin the new origin with respect to the old origin\n    b2World.prototype.ShiftOrigin = function (newOrigin) {\n        /// b2Assert(!this.IsLocked());\n        if (this.IsLocked()) {\n            return;\n        }\n        for (var b = this.m_bodyList; b; b = b.m_next) {\n            b.m_xf.p.SelfSub(newOrigin);\n            b.m_sweep.c0.SelfSub(newOrigin);\n            b.m_sweep.c.SelfSub(newOrigin);\n        }\n        for (var j = this.m_jointList; j; j = j.m_next) {\n            j.ShiftOrigin(newOrigin);\n        }\n        this.m_contactManager.m_broadPhase.ShiftOrigin(newOrigin);\n    };\n    /// Get the contact manager for testing.\n    b2World.prototype.GetContactManager = function () {\n        return this.m_contactManager;\n    };\n    /// Get the current profile.\n    b2World.prototype.GetProfile = function () {\n        return this.m_profile;\n    };\n    /// Dump the world into the log file.\n    /// @warning this should be called outside of a time step.\n    b2World.prototype.Dump = function (log) {\n        if (this.m_locked) {\n            return;\n        }\n        log(\"const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\\n\", this.m_gravity.x, this.m_gravity.y);\n        log(\"this.m_world.SetGravity(g);\\n\");\n        log(\"const bodies: b2Body[] = [];\\n\");\n        log(\"const joints: b2Joint[] = [];\\n\");\n        var i = 0;\n        for (var b = this.m_bodyList; b; b = b.m_next) {\n            b.m_islandIndex = i;\n            b.Dump(log);\n            ++i;\n        }\n        i = 0;\n        for (var j = this.m_jointList; j; j = j.m_next) {\n            j.m_index = i;\n            ++i;\n        }\n        // First pass on joints, skip gear joints.\n        for (var j = this.m_jointList; j; j = j.m_next) {\n            if (j.m_type === b2Joint_1.b2JointType.e_gearJoint) {\n                continue;\n            }\n            log(\"{\\n\");\n            j.Dump(log);\n            log(\"}\\n\");\n        }\n        // Second pass on joints, only gear joints.\n        for (var j = this.m_jointList; j; j = j.m_next) {\n            if (j.m_type !== b2Joint_1.b2JointType.e_gearJoint) {\n                continue;\n            }\n            log(\"{\\n\");\n            j.Dump(log);\n            log(\"}\\n\");\n        }\n    };\n    b2World.prototype.DrawJoint = function (joint) {\n        var bodyA = joint.GetBodyA();\n        var bodyB = joint.GetBodyB();\n        var xf1 = bodyA.m_xf;\n        var xf2 = bodyB.m_xf;\n        var x1 = xf1.p;\n        var x2 = xf2.p;\n        var p1 = joint.GetAnchorA(b2World.DrawJoint_s_p1);\n        var p2 = joint.GetAnchorB(b2World.DrawJoint_s_p2);\n        var color = b2World.DrawJoint_s_color.SetRGB(0.5, 0.8, 0.8);\n        switch (joint.m_type) {\n            case b2Joint_1.b2JointType.e_distanceJoint:\n                this.m_debugDraw.DrawSegment(p1, p2, color);\n                break;\n            case b2Joint_1.b2JointType.e_pulleyJoint:\n                {\n                    var pulley = joint;\n                    var s1 = pulley.GetGroundAnchorA();\n                    var s2 = pulley.GetGroundAnchorB();\n                    this.m_debugDraw.DrawSegment(s1, p1, color);\n                    this.m_debugDraw.DrawSegment(s2, p2, color);\n                    this.m_debugDraw.DrawSegment(s1, s2, color);\n                }\n                break;\n            case b2Joint_1.b2JointType.e_mouseJoint:\n                // don't draw this\n                this.m_debugDraw.DrawSegment(p1, p2, color);\n                break;\n            default:\n                this.m_debugDraw.DrawSegment(x1, p1, color);\n                this.m_debugDraw.DrawSegment(p1, p2, color);\n                this.m_debugDraw.DrawSegment(x2, p2, color);\n        }\n    };\n    b2World.prototype.DrawShape = function (fixture, color) {\n        var shape = fixture.GetShape();\n        switch (shape.m_type) {\n            case b2Shape_1.b2ShapeType.e_circleShape:\n                {\n                    var circle = shape;\n                    var center = circle.m_p;\n                    var radius = circle.m_radius;\n                    var axis = b2Math_1.b2Vec2.UNITX;\n                    this.m_debugDraw.DrawSolidCircle(center, radius, axis, color);\n                }\n                break;\n            case b2Shape_1.b2ShapeType.e_edgeShape:\n                {\n                    var edge = shape;\n                    var v1 = edge.m_vertex1;\n                    var v2 = edge.m_vertex2;\n                    this.m_debugDraw.DrawSegment(v1, v2, color);\n                }\n                break;\n            case b2Shape_1.b2ShapeType.e_chainShape:\n                {\n                    var chain = shape;\n                    var count = chain.m_count;\n                    var vertices = chain.m_vertices;\n                    var v1 = vertices[0];\n                    this.m_debugDraw.DrawCircle(v1, 0.05, color);\n                    for (var i = 1; i < count; ++i) {\n                        var v2 = vertices[i];\n                        this.m_debugDraw.DrawSegment(v1, v2, color);\n                        this.m_debugDraw.DrawCircle(v2, 0.05, color);\n                        v1 = v2;\n                    }\n                }\n                break;\n            case b2Shape_1.b2ShapeType.e_polygonShape:\n                {\n                    var poly = shape;\n                    var vertexCount = poly.m_count;\n                    var vertices = poly.m_vertices;\n                    this.m_debugDraw.DrawSolidPolygon(vertices, vertexCount, color);\n                }\n                break;\n        }\n    };\n    b2World.prototype.Solve = function (step) {\n        // #if B2_ENABLE_PARTICLE\n        // update previous transforms\n        for (var b = this.m_bodyList; b; b = b.m_next) {\n            b.m_xf0.Copy(b.m_xf);\n        }\n        // #endif\n        // #if B2_ENABLE_CONTROLLER\n        // @see b2Controller list\n        for (var controller = this.m_controllerList; controller; controller = controller.m_next) {\n            controller.Step(step);\n        }\n        // #endif\n        this.m_profile.solveInit = 0;\n        this.m_profile.solveVelocity = 0;\n        this.m_profile.solvePosition = 0;\n        // Size the island for the worst case.\n        var island = this.m_island;\n        island.Initialize(this.m_bodyCount, this.m_contactManager.m_contactCount, this.m_jointCount, null, // this.m_stackAllocator,\n        this.m_contactManager.m_contactListener);\n        // Clear all the island flags.\n        for (var b = this.m_bodyList; b; b = b.m_next) {\n            b.m_islandFlag = false;\n        }\n        for (var c = this.m_contactManager.m_contactList; c; c = c.m_next) {\n            c.m_islandFlag = false;\n        }\n        for (var j = this.m_jointList; j; j = j.m_next) {\n            j.m_islandFlag = false;\n        }\n        // Build and simulate all awake islands.\n        /// const stackSize: number = this.m_bodyCount;\n        var stack = this.s_stack;\n        for (var seed = this.m_bodyList; seed; seed = seed.m_next) {\n            if (seed.m_islandFlag) {\n                continue;\n            }\n            if (!seed.IsAwake() || !seed.IsActive()) {\n                continue;\n            }\n            // The seed can be dynamic or kinematic.\n            if (seed.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                continue;\n            }\n            // Reset island and stack.\n            island.Clear();\n            var stackCount = 0;\n            stack[stackCount++] = seed;\n            seed.m_islandFlag = true;\n            // Perform a depth first search (DFS) on the constraint graph.\n            while (stackCount > 0) {\n                // Grab the next body off the stack and add it to the island.\n                var b = stack[--stackCount];\n                /// b2Assert(b.IsActive());\n                island.AddBody(b);\n                // Make sure the body is awake.\n                b.SetAwake(true);\n                // To keep islands as small as possible, we don't\n                // propagate islands across static bodies.\n                if (b.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                    continue;\n                }\n                // Search all contacts connected to this body.\n                for (var ce = b.m_contactList; ce; ce = ce.next) {\n                    var contact = ce.contact;\n                    // Has this contact already been added to an island?\n                    if (contact.m_islandFlag) {\n                        continue;\n                    }\n                    // Is this contact solid and touching?\n                    if (!contact.IsEnabled() || !contact.IsTouching()) {\n                        continue;\n                    }\n                    // Skip sensors.\n                    var sensorA = contact.m_fixtureA.m_isSensor;\n                    var sensorB = contact.m_fixtureB.m_isSensor;\n                    if (sensorA || sensorB) {\n                        continue;\n                    }\n                    island.AddContact(contact);\n                    contact.m_islandFlag = true;\n                    var other = ce.other;\n                    // Was the other body already added to this island?\n                    if (other.m_islandFlag) {\n                        continue;\n                    }\n                    /// b2Assert(stackCount < stackSize);\n                    stack[stackCount++] = other;\n                    other.m_islandFlag = true;\n                }\n                // Search all joints connect to this body.\n                for (var je = b.m_jointList; je; je = je.next) {\n                    if (je.joint.m_islandFlag) {\n                        continue;\n                    }\n                    var other = je.other;\n                    // Don't simulate joints connected to inactive bodies.\n                    if (!other.IsActive()) {\n                        continue;\n                    }\n                    island.AddJoint(je.joint);\n                    je.joint.m_islandFlag = true;\n                    if (other.m_islandFlag) {\n                        continue;\n                    }\n                    /// b2Assert(stackCount < stackSize);\n                    stack[stackCount++] = other;\n                    other.m_islandFlag = true;\n                }\n            }\n            var profile = new b2TimeStep_1.b2Profile();\n            island.Solve(profile, step, this.m_gravity, this.m_allowSleep);\n            this.m_profile.solveInit += profile.solveInit;\n            this.m_profile.solveVelocity += profile.solveVelocity;\n            this.m_profile.solvePosition += profile.solvePosition;\n            // Post solve cleanup.\n            for (var i = 0; i < island.m_bodyCount; ++i) {\n                // Allow static bodies to participate in other islands.\n                var b = island.m_bodies[i];\n                if (b.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                    b.m_islandFlag = false;\n                }\n            }\n        }\n        for (var i = 0; i < stack.length; ++i) {\n            if (!stack[i]) {\n                break;\n            }\n            stack[i] = null;\n        }\n        var timer = new b2Timer_1.b2Timer();\n        // Synchronize fixtures, check for out of range bodies.\n        for (var b = this.m_bodyList; b; b = b.m_next) {\n            // If a body was not in an island then it did not move.\n            if (!b.m_islandFlag) {\n                continue;\n            }\n            if (b.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n                continue;\n            }\n            // Update fixtures (for broad-phase).\n            b.SynchronizeFixtures();\n        }\n        // Look for new contacts.\n        this.m_contactManager.FindNewContacts();\n        this.m_profile.broadphase = timer.GetMilliseconds();\n    };\n    b2World.prototype.SolveTOI = function (step) {\n        // b2Island island(2 * b2_maxTOIContacts, b2_maxTOIContacts, 0, &m_stackAllocator, m_contactManager.m_contactListener);\n        var island = this.m_island;\n        island.Initialize(2 * b2Settings_2.b2_maxTOIContacts, b2Settings_2.b2_maxTOIContacts, 0, null, this.m_contactManager.m_contactListener);\n        if (this.m_stepComplete) {\n            for (var b = this.m_bodyList; b; b = b.m_next) {\n                b.m_islandFlag = false;\n                b.m_sweep.alpha0 = 0;\n            }\n            for (var c = this.m_contactManager.m_contactList; c; c = c.m_next) {\n                // Invalidate TOI\n                c.m_toiFlag = false;\n                c.m_islandFlag = false;\n                c.m_toiCount = 0;\n                c.m_toi = 1;\n            }\n        }\n        // Find TOI events and solve them.\n        for (;;) {\n            // Find the first TOI.\n            var minContact = null;\n            var minAlpha = 1;\n            for (var c = this.m_contactManager.m_contactList; c; c = c.m_next) {\n                // Is this contact disabled?\n                if (!c.IsEnabled()) {\n                    continue;\n                }\n                // Prevent excessive sub-stepping.\n                if (c.m_toiCount > b2Settings_2.b2_maxSubSteps) {\n                    continue;\n                }\n                var alpha = 1;\n                if (c.m_toiFlag) {\n                    // This contact has a valid cached TOI.\n                    alpha = c.m_toi;\n                }\n                else {\n                    // tslint:disable-next-line:no-shadowed-variable\n                    var fA_1 = c.GetFixtureA();\n                    // tslint:disable-next-line:no-shadowed-variable\n                    var fB_1 = c.GetFixtureB();\n                    // Is there a sensor?\n                    if (fA_1.IsSensor() || fB_1.IsSensor()) {\n                        continue;\n                    }\n                    // tslint:disable-next-line:no-shadowed-variable\n                    var bA_1 = fA_1.GetBody();\n                    // tslint:disable-next-line:no-shadowed-variable\n                    var bB_1 = fB_1.GetBody();\n                    var typeA = bA_1.m_type;\n                    var typeB = bB_1.m_type;\n                    /// b2Assert(typeA !== b2BodyType.b2_staticBody || typeB !== b2BodyType.b2_staticBody);\n                    var activeA = bA_1.IsAwake() && typeA !== b2Body_1.b2BodyType.b2_staticBody;\n                    var activeB = bB_1.IsAwake() && typeB !== b2Body_1.b2BodyType.b2_staticBody;\n                    // Is at least one body active (awake and dynamic or kinematic)?\n                    if (!activeA && !activeB) {\n                        continue;\n                    }\n                    var collideA = bA_1.IsBullet() || typeA !== b2Body_1.b2BodyType.b2_dynamicBody;\n                    var collideB = bB_1.IsBullet() || typeB !== b2Body_1.b2BodyType.b2_dynamicBody;\n                    // Are these two non-bullet dynamic bodies?\n                    if (!collideA && !collideB) {\n                        continue;\n                    }\n                    // Compute the TOI for this contact.\n                    // Put the sweeps onto the same time interval.\n                    var alpha0 = bA_1.m_sweep.alpha0;\n                    if (bA_1.m_sweep.alpha0 < bB_1.m_sweep.alpha0) {\n                        alpha0 = bB_1.m_sweep.alpha0;\n                        bA_1.m_sweep.Advance(alpha0);\n                    }\n                    else if (bB_1.m_sweep.alpha0 < bA_1.m_sweep.alpha0) {\n                        alpha0 = bA_1.m_sweep.alpha0;\n                        bB_1.m_sweep.Advance(alpha0);\n                    }\n                    /// b2Assert(alpha0 < 1);\n                    var indexA = c.GetChildIndexA();\n                    var indexB = c.GetChildIndexB();\n                    // Compute the time of impact in interval [0, minTOI]\n                    var input = b2World.SolveTOI_s_toi_input;\n                    input.proxyA.SetShape(fA_1.GetShape(), indexA);\n                    input.proxyB.SetShape(fB_1.GetShape(), indexB);\n                    input.sweepA.Copy(bA_1.m_sweep);\n                    input.sweepB.Copy(bB_1.m_sweep);\n                    input.tMax = 1;\n                    var output = b2World.SolveTOI_s_toi_output;\n                    b2TimeOfImpact_1.b2TimeOfImpact(output, input);\n                    // Beta is the fraction of the remaining portion of the .\n                    var beta = output.t;\n                    if (output.state === b2TimeOfImpact_1.b2TOIOutputState.e_touching) {\n                        alpha = b2Math_1.b2Min(alpha0 + (1 - alpha0) * beta, 1);\n                    }\n                    else {\n                        alpha = 1;\n                    }\n                    c.m_toi = alpha;\n                    c.m_toiFlag = true;\n                }\n                if (alpha < minAlpha) {\n                    // This is the minimum TOI found so far.\n                    minContact = c;\n                    minAlpha = alpha;\n                }\n            }\n            if (minContact === null || 1 - 10 * b2Settings_2.b2_epsilon < minAlpha) {\n                // No more TOI events. Done!\n                this.m_stepComplete = true;\n                break;\n            }\n            // Advance the bodies to the TOI.\n            var fA = minContact.GetFixtureA();\n            var fB = minContact.GetFixtureB();\n            var bA = fA.GetBody();\n            var bB = fB.GetBody();\n            var backup1 = b2World.SolveTOI_s_backup1.Copy(bA.m_sweep);\n            var backup2 = b2World.SolveTOI_s_backup2.Copy(bB.m_sweep);\n            bA.Advance(minAlpha);\n            bB.Advance(minAlpha);\n            // The TOI contact likely has some new contact points.\n            minContact.Update(this.m_contactManager.m_contactListener);\n            minContact.m_toiFlag = false;\n            ++minContact.m_toiCount;\n            // Is the contact solid?\n            if (!minContact.IsEnabled() || !minContact.IsTouching()) {\n                // Restore the sweeps.\n                minContact.SetEnabled(false);\n                bA.m_sweep.Copy(backup1);\n                bB.m_sweep.Copy(backup2);\n                bA.SynchronizeTransform();\n                bB.SynchronizeTransform();\n                continue;\n            }\n            bA.SetAwake(true);\n            bB.SetAwake(true);\n            // Build the island\n            island.Clear();\n            island.AddBody(bA);\n            island.AddBody(bB);\n            island.AddContact(minContact);\n            bA.m_islandFlag = true;\n            bB.m_islandFlag = true;\n            minContact.m_islandFlag = true;\n            // Get contacts on bodyA and bodyB.\n            // const bodies: b2Body[] = [bA, bB];\n            for (var i = 0; i < 2; ++i) {\n                var body = (i === 0) ? (bA) : (bB); // bodies[i];\n                if (body.m_type === b2Body_1.b2BodyType.b2_dynamicBody) {\n                    for (var ce = body.m_contactList; ce; ce = ce.next) {\n                        if (island.m_bodyCount === island.m_bodyCapacity) {\n                            break;\n                        }\n                        if (island.m_contactCount === island.m_contactCapacity) {\n                            break;\n                        }\n                        var contact = ce.contact;\n                        // Has this contact already been added to the island?\n                        if (contact.m_islandFlag) {\n                            continue;\n                        }\n                        // Only add static, kinematic, or bullet bodies.\n                        var other = ce.other;\n                        if (other.m_type === b2Body_1.b2BodyType.b2_dynamicBody &&\n                            !body.IsBullet() && !other.IsBullet()) {\n                            continue;\n                        }\n                        // Skip sensors.\n                        var sensorA = contact.m_fixtureA.m_isSensor;\n                        var sensorB = contact.m_fixtureB.m_isSensor;\n                        if (sensorA || sensorB) {\n                            continue;\n                        }\n                        // Tentatively advance the body to the TOI.\n                        var backup = b2World.SolveTOI_s_backup.Copy(other.m_sweep);\n                        if (!other.m_islandFlag) {\n                            other.Advance(minAlpha);\n                        }\n                        // Update the contact points\n                        contact.Update(this.m_contactManager.m_contactListener);\n                        // Was the contact disabled by the user?\n                        if (!contact.IsEnabled()) {\n                            other.m_sweep.Copy(backup);\n                            other.SynchronizeTransform();\n                            continue;\n                        }\n                        // Are there contact points?\n                        if (!contact.IsTouching()) {\n                            other.m_sweep.Copy(backup);\n                            other.SynchronizeTransform();\n                            continue;\n                        }\n                        // Add the contact to the island\n                        contact.m_islandFlag = true;\n                        island.AddContact(contact);\n                        // Has the other body already been added to the island?\n                        if (other.m_islandFlag) {\n                            continue;\n                        }\n                        // Add the other body to the island.\n                        other.m_islandFlag = true;\n                        if (other.m_type !== b2Body_1.b2BodyType.b2_staticBody) {\n                            other.SetAwake(true);\n                        }\n                        island.AddBody(other);\n                    }\n                }\n            }\n            var subStep = b2World.SolveTOI_s_subStep;\n            subStep.dt = (1 - minAlpha) * step.dt;\n            subStep.inv_dt = 1 / subStep.dt;\n            subStep.dtRatio = 1;\n            subStep.positionIterations = 20;\n            subStep.velocityIterations = step.velocityIterations;\n            // #if B2_ENABLE_PARTICLE\n            subStep.particleIterations = step.particleIterations;\n            // #endif\n            subStep.warmStarting = false;\n            island.SolveTOI(subStep, bA.m_islandIndex, bB.m_islandIndex);\n            // Reset island flags and synchronize broad-phase proxies.\n            for (var i = 0; i < island.m_bodyCount; ++i) {\n                var body = island.m_bodies[i];\n                body.m_islandFlag = false;\n                if (body.m_type !== b2Body_1.b2BodyType.b2_dynamicBody) {\n                    continue;\n                }\n                body.SynchronizeFixtures();\n                // Invalidate all contact TOIs on this displaced body.\n                for (var ce = body.m_contactList; ce; ce = ce.next) {\n                    ce.contact.m_toiFlag = false;\n                    ce.contact.m_islandFlag = false;\n                }\n            }\n            // Commit fixture proxy movements to the broad-phase so that new contacts are created.\n            // Also, some contacts can be destroyed.\n            this.m_contactManager.FindNewContacts();\n            if (this.m_subStepping) {\n                this.m_stepComplete = false;\n                break;\n            }\n        }\n    };\n    // #if B2_ENABLE_CONTROLLER\n    b2World.prototype.AddController = function (controller) {\n        /// b2Assert(controller.m_world === null, \"Controller can only be a member of one world\");\n        controller.m_world = this;\n        controller.m_next = this.m_controllerList;\n        controller.m_prev = null;\n        if (this.m_controllerList) {\n            this.m_controllerList.m_prev = controller;\n        }\n        this.m_controllerList = controller;\n        ++this.m_controllerCount;\n        return controller;\n    };\n    b2World.prototype.RemoveController = function (controller) {\n        /// b2Assert(controller.m_world === this, \"Controller is not a member of this world\");\n        if (controller.m_prev) {\n            controller.m_prev.m_next = controller.m_next;\n        }\n        if (controller.m_next) {\n            controller.m_next.m_prev = controller.m_prev;\n        }\n        if (this.m_controllerList === controller) {\n            this.m_controllerList = controller.m_next;\n        }\n        --this.m_controllerCount;\n        controller.m_prev = null;\n        controller.m_next = null;\n        controller.m_world = null;\n        return controller;\n    };\n    // #endif\n    /// Take a time step. This performs collision detection, integration,\n    /// and constraint solution.\n    /// @param timeStep the amount of time to simulate, this should not vary.\n    /// @param velocityIterations for the velocity constraint solver.\n    /// @param positionIterations for the position constraint solver.\n    b2World.Step_s_step = new b2TimeStep_1.b2TimeStep();\n    b2World.Step_s_stepTimer = new b2Timer_1.b2Timer();\n    b2World.Step_s_timer = new b2Timer_1.b2Timer();\n    // #endif\n    /// Call this to draw shapes and other debug draw data.\n    b2World.DrawDebugData_s_color = new b2Draw_1.b2Color(0, 0, 0);\n    b2World.DrawDebugData_s_vs = b2Math_1.b2Vec2.MakeArray(4);\n    b2World.DrawDebugData_s_xf = new b2Math_1.b2Transform();\n    b2World.QueryShape_s_aabb = new b2Collision_1.b2AABB();\n    b2World.QueryPoint_s_aabb = new b2Collision_1.b2AABB();\n    /// Ray-cast the world for all fixtures in the path of the ray. Your callback\n    /// controls whether you get the closest point, any point, or n-points.\n    /// The ray-cast ignores shapes that contain the starting point.\n    /// @param callback a user implemented callback class.\n    /// @param point1 the ray starting point\n    /// @param point2 the ray ending point\n    b2World.RayCast_s_input = new b2Collision_1.b2RayCastInput();\n    b2World.RayCast_s_output = new b2Collision_1.b2RayCastOutput();\n    b2World.RayCast_s_point = new b2Math_1.b2Vec2();\n    b2World.DrawJoint_s_p1 = new b2Math_1.b2Vec2();\n    b2World.DrawJoint_s_p2 = new b2Math_1.b2Vec2();\n    b2World.DrawJoint_s_color = new b2Draw_1.b2Color(0.5, 0.8, 0.8);\n    b2World.SolveTOI_s_subStep = new b2TimeStep_1.b2TimeStep();\n    b2World.SolveTOI_s_backup = new b2Math_1.b2Sweep();\n    b2World.SolveTOI_s_backup1 = new b2Math_1.b2Sweep();\n    b2World.SolveTOI_s_backup2 = new b2Math_1.b2Sweep();\n    b2World.SolveTOI_s_toi_input = new b2TimeOfImpact_1.b2TOIInput();\n    b2World.SolveTOI_s_toi_output = new b2TimeOfImpact_1.b2TOIOutput();\n    return b2World;\n}());\nexports.b2World = b2World;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2World.ts?");

/***/ }),

/***/ "./src/Box2D/Dynamics/b2WorldCallbacks.ts":
/*!************************************************!*\
  !*** ./src/Box2D/Dynamics/b2WorldCallbacks.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2006-2009 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Body_1 = __webpack_require__(/*! ./b2Body */ \"./src/Box2D/Dynamics/b2Body.ts\");\n// #endif\n/// Joints and fixtures are destroyed when their associated\n/// body is destroyed. Implement this listener so that you\n/// may nullify references to these joints and shapes.\nvar b2DestructionListener = /** @class */ (function () {\n    function b2DestructionListener() {\n    }\n    /// Called when any joint is about to be destroyed due\n    /// to the destruction of one of its attached bodies.\n    b2DestructionListener.prototype.SayGoodbyeJoint = function (joint) { };\n    /// Called when any fixture is about to be destroyed due\n    /// to the destruction of its parent body.\n    b2DestructionListener.prototype.SayGoodbyeFixture = function (fixture) { };\n    // #if B2_ENABLE_PARTICLE\n    /// Called when any particle group is about to be destroyed.\n    b2DestructionListener.prototype.SayGoodbyeParticleGroup = function (group) { };\n    /// Called when a particle is about to be destroyed.\n    /// The index can be used in conjunction with\n    /// b2ParticleSystem::GetUserDataBuffer() or\n    /// b2ParticleSystem::GetParticleHandleFromIndex() to determine which\n    /// particle has been destroyed.\n    b2DestructionListener.prototype.SayGoodbyeParticle = function (system, index) { };\n    return b2DestructionListener;\n}());\nexports.b2DestructionListener = b2DestructionListener;\n/// Implement this class to provide collision filtering. In other words, you can implement\n/// this class if you want finer control over contact creation.\nvar b2ContactFilter = /** @class */ (function () {\n    function b2ContactFilter() {\n    }\n    /// Return true if contact calculations should be performed between these two shapes.\n    /// @warning for performance reasons this is only called when the AABBs begin to overlap.\n    b2ContactFilter.prototype.ShouldCollide = function (fixtureA, fixtureB) {\n        var bodyA = fixtureA.GetBody();\n        var bodyB = fixtureB.GetBody();\n        // At least one body should be dynamic or kinematic.\n        if (bodyB.GetType() === b2Body_1.b2BodyType.b2_staticBody && bodyA.GetType() === b2Body_1.b2BodyType.b2_staticBody) {\n            return false;\n        }\n        // Does a joint prevent collision?\n        if (!bodyB.ShouldCollideConnected(bodyA)) {\n            return false;\n        }\n        var filter1 = fixtureA.GetFilterData();\n        var filter2 = fixtureB.GetFilterData();\n        if (filter1.groupIndex === filter2.groupIndex && filter1.groupIndex !== 0) {\n            return (filter1.groupIndex > 0);\n        }\n        var collide = (((filter1.maskBits & filter2.categoryBits) !== 0) && ((filter1.categoryBits & filter2.maskBits) !== 0));\n        return collide;\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2ContactFilter.prototype.ShouldCollideFixtureParticle = function (fixture, system, index) {\n        return true;\n    };\n    b2ContactFilter.prototype.ShouldCollideParticleParticle = function (system, indexA, indexB) {\n        return true;\n    };\n    // #endif\n    b2ContactFilter.b2_defaultFilter = new b2ContactFilter();\n    return b2ContactFilter;\n}());\nexports.b2ContactFilter = b2ContactFilter;\n/// Contact impulses for reporting. Impulses are used instead of forces because\n/// sub-step forces may approach infinity for rigid body collisions. These\n/// match up one-to-one with the contact points in b2Manifold.\nvar b2ContactImpulse = /** @class */ (function () {\n    function b2ContactImpulse() {\n        this.normalImpulses = b2Settings_1.b2MakeNumberArray(b2Settings_1.b2_maxManifoldPoints);\n        this.tangentImpulses = b2Settings_1.b2MakeNumberArray(b2Settings_1.b2_maxManifoldPoints);\n        this.count = 0;\n    }\n    return b2ContactImpulse;\n}());\nexports.b2ContactImpulse = b2ContactImpulse;\n/// Implement this class to get contact information. You can use these results for\n/// things like sounds and game logic. You can also get contact results by\n/// traversing the contact lists after the time step. However, you might miss\n/// some contacts because continuous physics leads to sub-stepping.\n/// Additionally you may receive multiple callbacks for the same contact in a\n/// single time step.\n/// You should strive to make your callbacks efficient because there may be\n/// many callbacks per time step.\n/// @warning You cannot create/destroy Box2D entities inside these callbacks.\nvar b2ContactListener = /** @class */ (function () {\n    function b2ContactListener() {\n    }\n    /// Called when two fixtures begin to touch.\n    b2ContactListener.prototype.BeginContact = function (contact) { };\n    /// Called when two fixtures cease to touch.\n    b2ContactListener.prototype.EndContact = function (contact) { };\n    // #if B2_ENABLE_PARTICLE\n    b2ContactListener.prototype.BeginContactFixtureParticle = function (system, contact) { };\n    b2ContactListener.prototype.EndContactFixtureParticle = function (system, contact) { };\n    b2ContactListener.prototype.BeginContactParticleParticle = function (system, contact) { };\n    b2ContactListener.prototype.EndContactParticleParticle = function (system, contact) { };\n    // #endif\n    /// This is called after a contact is updated. This allows you to inspect a\n    /// contact before it goes to the solver. If you are careful, you can modify the\n    /// contact manifold (e.g. disable contact).\n    /// A copy of the old manifold is provided so that you can detect changes.\n    /// Note: this is called only for awake bodies.\n    /// Note: this is called even when the number of contact points is zero.\n    /// Note: this is not called for sensors.\n    /// Note: if you set the number of contact points to zero, you will not\n    /// get an EndContact callback. However, you may get a BeginContact callback\n    /// the next step.\n    b2ContactListener.prototype.PreSolve = function (contact, oldManifold) { };\n    /// This lets you inspect a contact after the solver is finished. This is useful\n    /// for inspecting impulses.\n    /// Note: the contact manifold does not include time of impact impulses, which can be\n    /// arbitrarily large if the sub-step is small. Hence the impulse is provided explicitly\n    /// in a separate data structure.\n    /// Note: this is only called for contacts that are touching, solid, and awake.\n    b2ContactListener.prototype.PostSolve = function (contact, impulse) { };\n    b2ContactListener.b2_defaultListener = new b2ContactListener();\n    return b2ContactListener;\n}());\nexports.b2ContactListener = b2ContactListener;\n/// Callback class for AABB queries.\n/// See b2World::Query\nvar b2QueryCallback = /** @class */ (function () {\n    function b2QueryCallback() {\n    }\n    /// Called for each fixture found in the query AABB.\n    /// @return false to terminate the query.\n    b2QueryCallback.prototype.ReportFixture = function (fixture) {\n        return true;\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2QueryCallback.prototype.ReportParticle = function (system, index) {\n        return false;\n    };\n    b2QueryCallback.prototype.ShouldQueryParticleSystem = function (system) {\n        return true;\n    };\n    return b2QueryCallback;\n}());\nexports.b2QueryCallback = b2QueryCallback;\n/// Callback class for ray casts.\n/// See b2World::RayCast\nvar b2RayCastCallback = /** @class */ (function () {\n    function b2RayCastCallback() {\n    }\n    /// Called for each fixture found in the query. You control how the ray cast\n    /// proceeds by returning a float:\n    /// return -1: ignore this fixture and continue\n    /// return 0: terminate the ray cast\n    /// return fraction: clip the ray to this point\n    /// return 1: don't clip the ray and continue\n    /// @param fixture the fixture hit by the ray\n    /// @param point the point of initial intersection\n    /// @param normal the normal vector at the point of intersection\n    /// @return -1 to filter, 0 to terminate, fraction to clip the ray for\n    /// closest hit, 1 to continue\n    b2RayCastCallback.prototype.ReportFixture = function (fixture, point, normal, fraction) {\n        return fraction;\n    };\n    // #if B2_ENABLE_PARTICLE\n    b2RayCastCallback.prototype.ReportParticle = function (system, index, point, normal, fraction) {\n        return 0;\n    };\n    b2RayCastCallback.prototype.ShouldQueryParticleSystem = function (system) {\n        return true;\n    };\n    return b2RayCastCallback;\n}());\nexports.b2RayCastCallback = b2RayCastCallback;\n\n\n//# sourceURL=webpack:///./src/Box2D/Dynamics/b2WorldCallbacks.ts?");

/***/ }),

/***/ "./src/Box2D/Particle/b2Particle.ts":
/*!******************************************!*\
  !*** ./src/Box2D/Particle/b2Particle.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n * Copyright (c) 2013 Google, Inc.\n *\n * This software is provided 'as-is', without any express or implied\n * warranty.  In no event will the authors be held liable for any damages\n * arising from the use of this software.\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n * 1. The origin of this software must not be misrepresented; you must not\n * claim that you wrote the original software. If you use this software\n * in a product, an acknowledgment in the product documentation would be\n * appreciated but is not required.\n * 2. Altered source versions must be plainly marked as such, and must not be\n * misrepresented as being the original software.\n * 3. This notice may not be removed or altered from any source distribution.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// #if B2_ENABLE_PARTICLE\nvar b2Draw_1 = __webpack_require__(/*! ../Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n/**\n * The particle type. Can be combined with the | operator.\n */\nvar b2ParticleFlag;\n(function (b2ParticleFlag) {\n    /// Water particle.\n    b2ParticleFlag[b2ParticleFlag[\"b2_waterParticle\"] = 0] = \"b2_waterParticle\";\n    /// Removed after next simulation step.\n    b2ParticleFlag[b2ParticleFlag[\"b2_zombieParticle\"] = 2] = \"b2_zombieParticle\";\n    /// Zero velocity.\n    b2ParticleFlag[b2ParticleFlag[\"b2_wallParticle\"] = 4] = \"b2_wallParticle\";\n    /// With restitution from stretching.\n    b2ParticleFlag[b2ParticleFlag[\"b2_springParticle\"] = 8] = \"b2_springParticle\";\n    /// With restitution from deformation.\n    b2ParticleFlag[b2ParticleFlag[\"b2_elasticParticle\"] = 16] = \"b2_elasticParticle\";\n    /// With viscosity.\n    b2ParticleFlag[b2ParticleFlag[\"b2_viscousParticle\"] = 32] = \"b2_viscousParticle\";\n    /// Without isotropic pressure.\n    b2ParticleFlag[b2ParticleFlag[\"b2_powderParticle\"] = 64] = \"b2_powderParticle\";\n    /// With surface tension.\n    b2ParticleFlag[b2ParticleFlag[\"b2_tensileParticle\"] = 128] = \"b2_tensileParticle\";\n    /// Mix color between contacting particles.\n    b2ParticleFlag[b2ParticleFlag[\"b2_colorMixingParticle\"] = 256] = \"b2_colorMixingParticle\";\n    /// Call b2DestructionListener on destruction.\n    b2ParticleFlag[b2ParticleFlag[\"b2_destructionListenerParticle\"] = 512] = \"b2_destructionListenerParticle\";\n    /// Prevents other particles from leaking.\n    b2ParticleFlag[b2ParticleFlag[\"b2_barrierParticle\"] = 1024] = \"b2_barrierParticle\";\n    /// Less compressibility.\n    b2ParticleFlag[b2ParticleFlag[\"b2_staticPressureParticle\"] = 2048] = \"b2_staticPressureParticle\";\n    /// Makes pairs or triads with other particles.\n    b2ParticleFlag[b2ParticleFlag[\"b2_reactiveParticle\"] = 4096] = \"b2_reactiveParticle\";\n    /// With high repulsive force.\n    b2ParticleFlag[b2ParticleFlag[\"b2_repulsiveParticle\"] = 8192] = \"b2_repulsiveParticle\";\n    /// Call b2ContactListener when this particle is about to interact with\n    /// a rigid body or stops interacting with a rigid body.\n    /// This results in an expensive operation compared to using\n    /// b2_fixtureContactFilterParticle to detect collisions between\n    /// particles.\n    b2ParticleFlag[b2ParticleFlag[\"b2_fixtureContactListenerParticle\"] = 16384] = \"b2_fixtureContactListenerParticle\";\n    /// Call b2ContactListener when this particle is about to interact with\n    /// another particle or stops interacting with another particle.\n    /// This results in an expensive operation compared to using\n    /// b2_particleContactFilterParticle to detect collisions between\n    /// particles.\n    b2ParticleFlag[b2ParticleFlag[\"b2_particleContactListenerParticle\"] = 32768] = \"b2_particleContactListenerParticle\";\n    /// Call b2ContactFilter when this particle interacts with rigid bodies.\n    b2ParticleFlag[b2ParticleFlag[\"b2_fixtureContactFilterParticle\"] = 65536] = \"b2_fixtureContactFilterParticle\";\n    /// Call b2ContactFilter when this particle interacts with other\n    /// particles.\n    b2ParticleFlag[b2ParticleFlag[\"b2_particleContactFilterParticle\"] = 131072] = \"b2_particleContactFilterParticle\";\n})(b2ParticleFlag = exports.b2ParticleFlag || (exports.b2ParticleFlag = {}));\nvar b2ParticleDef = /** @class */ (function () {\n    function b2ParticleDef() {\n        this.flags = 0;\n        this.position = new b2Math_1.b2Vec2();\n        this.velocity = new b2Math_1.b2Vec2();\n        this.color = new b2Draw_1.b2Color();\n        this.lifetime = 0.0;\n        this.userData = null;\n        this.group = null;\n    }\n    return b2ParticleDef;\n}());\nexports.b2ParticleDef = b2ParticleDef;\nfunction b2CalculateParticleIterations(gravity, radius, timeStep) {\n    // In some situations you may want more particle iterations than this,\n    // but to avoid excessive cycle cost, don't recommend more than this.\n    var B2_MAX_RECOMMENDED_PARTICLE_ITERATIONS = 8;\n    var B2_RADIUS_THRESHOLD = 0.01;\n    var iterations = Math.ceil(Math.sqrt(gravity / (B2_RADIUS_THRESHOLD * radius)) * timeStep);\n    return b2Math_1.b2Clamp(iterations, 1, B2_MAX_RECOMMENDED_PARTICLE_ITERATIONS);\n}\nexports.b2CalculateParticleIterations = b2CalculateParticleIterations;\nvar b2ParticleHandle = /** @class */ (function () {\n    function b2ParticleHandle() {\n        this.m_index = b2Settings_1.b2_invalidParticleIndex;\n    }\n    b2ParticleHandle.prototype.GetIndex = function () { return this.m_index; };\n    b2ParticleHandle.prototype.SetIndex = function (index) { this.m_index = index; };\n    return b2ParticleHandle;\n}());\nexports.b2ParticleHandle = b2ParticleHandle;\n// #endif\n\n\n//# sourceURL=webpack:///./src/Box2D/Particle/b2Particle.ts?");

/***/ }),

/***/ "./src/Box2D/Particle/b2ParticleGroup.ts":
/*!***********************************************!*\
  !*** ./src/Box2D/Particle/b2ParticleGroup.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n * Copyright (c) 2013 Google, Inc.\n *\n * This software is provided 'as-is', without any express or implied\n * warranty.  In no event will the authors be held liable for any damages\n * arising from the use of this software.\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n * 1. The origin of this software must not be misrepresented; you must not\n * claim that you wrote the original software. If you use this software\n * in a product, an acknowledgment in the product documentation would be\n * appreciated but is not required.\n * 2. Altered source versions must be plainly marked as such, and must not be\n * misrepresented as being the original software.\n * 3. This notice may not be removed or altered from any source distribution.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Draw_1 = __webpack_require__(/*! ../Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2ParticleGroupFlag;\n(function (b2ParticleGroupFlag) {\n    /// Prevents overlapping or leaking.\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_solidParticleGroup\"] = 1] = \"b2_solidParticleGroup\";\n    /// Keeps its shape.\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_rigidParticleGroup\"] = 2] = \"b2_rigidParticleGroup\";\n    /// Won't be destroyed if it gets empty.\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_particleGroupCanBeEmpty\"] = 4] = \"b2_particleGroupCanBeEmpty\";\n    /// Will be destroyed on next simulation step.\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_particleGroupWillBeDestroyed\"] = 8] = \"b2_particleGroupWillBeDestroyed\";\n    /// Updates depth data on next simulation step.\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_particleGroupNeedsUpdateDepth\"] = 16] = \"b2_particleGroupNeedsUpdateDepth\";\n    b2ParticleGroupFlag[b2ParticleGroupFlag[\"b2_particleGroupInternalMask\"] = 24] = \"b2_particleGroupInternalMask\";\n})(b2ParticleGroupFlag = exports.b2ParticleGroupFlag || (exports.b2ParticleGroupFlag = {}));\nvar b2ParticleGroupDef = /** @class */ (function () {\n    function b2ParticleGroupDef() {\n        this.flags = 0;\n        this.groupFlags = 0;\n        this.position = new b2Math_1.b2Vec2();\n        this.angle = 0.0;\n        this.linearVelocity = new b2Math_1.b2Vec2();\n        this.angularVelocity = 0.0;\n        this.color = new b2Draw_1.b2Color();\n        this.strength = 1.0;\n        this.shape = null;\n        this.shapes = null;\n        this.shapeCount = 0;\n        this.stride = 0;\n        this.particleCount = 0;\n        this.positionData = null;\n        this.lifetime = 0;\n        this.userData = null;\n        this.group = null;\n    }\n    return b2ParticleGroupDef;\n}());\nexports.b2ParticleGroupDef = b2ParticleGroupDef;\nvar b2ParticleGroup = /** @class */ (function () {\n    function b2ParticleGroup(system) {\n        this.m_system = null;\n        this.m_firstIndex = 0;\n        this.m_lastIndex = 0;\n        this.m_groupFlags = 0;\n        this.m_strength = 1.0;\n        this.m_prev = null;\n        this.m_next = null;\n        this.m_timestamp = -1;\n        this.m_mass = 0.0;\n        this.m_inertia = 0.0;\n        this.m_center = new b2Math_1.b2Vec2();\n        this.m_linearVelocity = new b2Math_1.b2Vec2();\n        this.m_angularVelocity = 0.0;\n        this.m_transform = new b2Math_1.b2Transform();\n        /// m_transform.SetIdentity();\n        this.m_userData = null;\n        this.m_system = system;\n    }\n    b2ParticleGroup.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    b2ParticleGroup.prototype.GetParticleSystem = function () {\n        return this.m_system;\n    };\n    b2ParticleGroup.prototype.GetParticleCount = function () {\n        return this.m_lastIndex - this.m_firstIndex;\n    };\n    b2ParticleGroup.prototype.GetBufferIndex = function () {\n        return this.m_firstIndex;\n    };\n    b2ParticleGroup.prototype.ContainsParticle = function (index) {\n        return this.m_firstIndex <= index && index < this.m_lastIndex;\n    };\n    b2ParticleGroup.prototype.GetAllParticleFlags = function () {\n        var flags = 0;\n        for (var i = this.m_firstIndex; i < this.m_lastIndex; i++) {\n            flags |= this.m_system.m_flagsBuffer.data[i];\n        }\n        return flags;\n    };\n    b2ParticleGroup.prototype.GetGroupFlags = function () {\n        return this.m_groupFlags;\n    };\n    b2ParticleGroup.prototype.SetGroupFlags = function (flags) {\n        /// b2Assert((flags & b2ParticleGroupFlag.b2_particleGroupInternalMask) === 0);\n        flags |= this.m_groupFlags & b2ParticleGroupFlag.b2_particleGroupInternalMask;\n        this.m_system.SetGroupFlags(this, flags);\n    };\n    b2ParticleGroup.prototype.GetMass = function () {\n        this.UpdateStatistics();\n        return this.m_mass;\n    };\n    b2ParticleGroup.prototype.GetInertia = function () {\n        this.UpdateStatistics();\n        return this.m_inertia;\n    };\n    b2ParticleGroup.prototype.GetCenter = function () {\n        this.UpdateStatistics();\n        return this.m_center;\n    };\n    b2ParticleGroup.prototype.GetLinearVelocity = function () {\n        this.UpdateStatistics();\n        return this.m_linearVelocity;\n    };\n    b2ParticleGroup.prototype.GetAngularVelocity = function () {\n        this.UpdateStatistics();\n        return this.m_angularVelocity;\n    };\n    b2ParticleGroup.prototype.GetTransform = function () {\n        return this.m_transform;\n    };\n    b2ParticleGroup.prototype.GetPosition = function () {\n        return this.m_transform.p;\n    };\n    b2ParticleGroup.prototype.GetAngle = function () {\n        return this.m_transform.q.GetAngle();\n    };\n    b2ParticleGroup.prototype.GetLinearVelocityFromWorldPoint = function (worldPoint, out) {\n        var s_t0 = b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0;\n        this.UpdateStatistics();\n        ///  return m_linearVelocity + b2Cross(m_angularVelocity, worldPoint - m_center);\n        return b2Math_1.b2Vec2.AddVCrossSV(this.m_linearVelocity, this.m_angularVelocity, b2Math_1.b2Vec2.SubVV(worldPoint, this.m_center, s_t0), out);\n    };\n    b2ParticleGroup.prototype.GetUserData = function () {\n        return this.m_userData;\n    };\n    b2ParticleGroup.prototype.SetUserData = function (data) {\n        this.m_userData = data;\n    };\n    b2ParticleGroup.prototype.ApplyForce = function (force) {\n        this.m_system.ApplyForce(this.m_firstIndex, this.m_lastIndex, force);\n    };\n    b2ParticleGroup.prototype.ApplyLinearImpulse = function (impulse) {\n        this.m_system.ApplyLinearImpulse(this.m_firstIndex, this.m_lastIndex, impulse);\n    };\n    b2ParticleGroup.prototype.DestroyParticles = function (callDestructionListener) {\n        /// b2Assert(this.m_system.m_world.IsLocked() === false);\n        if (this.m_system.m_world.IsLocked()) {\n            return;\n        }\n        for (var i = this.m_firstIndex; i < this.m_lastIndex; i++) {\n            this.m_system.DestroyParticle(i, callDestructionListener);\n        }\n    };\n    b2ParticleGroup.prototype.UpdateStatistics = function () {\n        var p = new b2Math_1.b2Vec2();\n        var v = new b2Math_1.b2Vec2();\n        if (this.m_timestamp !== this.m_system.m_timestamp) {\n            var m = this.m_system.GetParticleMass();\n            ///  this.m_mass = 0;\n            this.m_mass = m * (this.m_lastIndex - this.m_firstIndex);\n            this.m_center.SetZero();\n            this.m_linearVelocity.SetZero();\n            for (var i = this.m_firstIndex; i < this.m_lastIndex; i++) {\n                ///  this.m_mass += m;\n                ///  this.m_center += m * this.m_system.m_positionBuffer.data[i];\n                this.m_center.SelfMulAdd(m, this.m_system.m_positionBuffer.data[i]);\n                ///  this.m_linearVelocity += m * this.m_system.m_velocityBuffer.data[i];\n                this.m_linearVelocity.SelfMulAdd(m, this.m_system.m_velocityBuffer.data[i]);\n            }\n            if (this.m_mass > 0) {\n                var inv_mass = 1 / this.m_mass;\n                /// this.m_center *= 1 / this.m_mass;\n                this.m_center.SelfMul(inv_mass);\n                /// this.m_linearVelocity *= 1 / this.m_mass;\n                this.m_linearVelocity.SelfMul(inv_mass);\n            }\n            this.m_inertia = 0;\n            this.m_angularVelocity = 0;\n            for (var i = this.m_firstIndex; i < this.m_lastIndex; i++) {\n                /// b2Vec2 p = this.m_system.m_positionBuffer.data[i] - this.m_center;\n                b2Math_1.b2Vec2.SubVV(this.m_system.m_positionBuffer.data[i], this.m_center, p);\n                /// b2Vec2 v = this.m_system.m_velocityBuffer.data[i] - this.m_linearVelocity;\n                b2Math_1.b2Vec2.SubVV(this.m_system.m_velocityBuffer.data[i], this.m_linearVelocity, v);\n                this.m_inertia += m * b2Math_1.b2Vec2.DotVV(p, p);\n                this.m_angularVelocity += m * b2Math_1.b2Vec2.CrossVV(p, v);\n            }\n            if (this.m_inertia > 0) {\n                this.m_angularVelocity *= 1 / this.m_inertia;\n            }\n            this.m_timestamp = this.m_system.m_timestamp;\n        }\n    };\n    b2ParticleGroup.GetLinearVelocityFromWorldPoint_s_t0 = new b2Math_1.b2Vec2();\n    return b2ParticleGroup;\n}());\nexports.b2ParticleGroup = b2ParticleGroup;\n// #endif\n\n\n//# sourceURL=webpack:///./src/Box2D/Particle/b2ParticleGroup.ts?");

/***/ }),

/***/ "./src/Box2D/Particle/b2ParticleSystem.ts":
/*!************************************************!*\
  !*** ./src/Box2D/Particle/b2ParticleSystem.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n * Copyright (c) 2013 Google, Inc.\n *\n * This software is provided 'as-is', without any express or implied\n * warranty.  In no event will the authors be held liable for any damages\n * arising from the use of this software.\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n * 1. The origin of this software must not be misrepresented; you must not\n * claim that you wrote the original software. If you use this software\n * in a product, an acknowledgment in the product documentation would be\n * appreciated but is not required.\n * 2. Altered source versions must be plainly marked as such, and must not be\n * misrepresented as being the original software.\n * 3. This notice may not be removed or altered from any source distribution.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// #if B2_ENABLE_PARTICLE\nvar b2Collision_1 = __webpack_require__(/*! ../Collision/b2Collision */ \"./src/Box2D/Collision/b2Collision.ts\");\nvar b2EdgeShape_1 = __webpack_require__(/*! ../Collision/Shapes/b2EdgeShape */ \"./src/Box2D/Collision/Shapes/b2EdgeShape.ts\");\nvar b2Shape_1 = __webpack_require__(/*! ../Collision/Shapes/b2Shape */ \"./src/Box2D/Collision/Shapes/b2Shape.ts\");\nvar b2Draw_1 = __webpack_require__(/*! ../Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2Settings_2 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2TimeStep_1 = __webpack_require__(/*! ../Dynamics/b2TimeStep */ \"./src/Box2D/Dynamics/b2TimeStep.ts\");\nvar b2WorldCallbacks_1 = __webpack_require__(/*! ../Dynamics/b2WorldCallbacks */ \"./src/Box2D/Dynamics/b2WorldCallbacks.ts\");\nvar b2Particle_1 = __webpack_require__(/*! ./b2Particle */ \"./src/Box2D/Particle/b2Particle.ts\");\nvar b2ParticleGroup_1 = __webpack_require__(/*! ./b2ParticleGroup */ \"./src/Box2D/Particle/b2ParticleGroup.ts\");\nvar b2VoronoiDiagram_1 = __webpack_require__(/*! ./b2VoronoiDiagram */ \"./src/Box2D/Particle/b2VoronoiDiagram.ts\");\nfunction b2Assert(condition) { }\nfunction std_iter_swap(array, a, b) {\n    var tmp = array[a];\n    array[a] = array[b];\n    array[b] = tmp;\n}\nfunction default_compare(a, b) { return a < b; }\nfunction std_sort(array, first, len, cmp) {\n    if (first === void 0) { first = 0; }\n    if (len === void 0) { len = array.length - first; }\n    if (cmp === void 0) { cmp = default_compare; }\n    var left = first;\n    var stack = [];\n    var pos = 0;\n    for (;;) { /* outer loop */\n        for (; left + 1 < len; len++) { /* sort left to len-1 */\n            var pivot = array[left + Math.floor(Math.random() * (len - left))]; /* pick random pivot */\n            stack[pos++] = len; /* sort right part later */\n            for (var right = left - 1;;) { /* inner loop: partitioning */\n                while (cmp(array[++right], pivot)) { } /* look for greater element */\n                while (cmp(pivot, array[--len])) { } /* look for smaller element */\n                if (right >= len) {\n                    break;\n                } /* partition point found? */\n                std_iter_swap(array, right, len); /* the only swap */\n            } /* partitioned, continue left part */\n        }\n        if (pos === 0) {\n            break;\n        } /* stack empty? */\n        left = len; /* left to right is sorted */\n        len = stack[--pos]; /* get next range to sort */\n    }\n    return array;\n}\n;\nfunction std_stable_sort(array, first, len, cmp) {\n    if (first === void 0) { first = 0; }\n    if (len === void 0) { len = array.length - first; }\n    if (cmp === void 0) { cmp = default_compare; }\n    return std_sort(array, first, len, cmp);\n}\n;\nfunction std_remove_if(array, predicate, length) {\n    if (length === void 0) { length = array.length; }\n    var l = 0;\n    for (var c = 0; c < length; ++c) {\n        // if we can be collapsed, keep l where it is.\n        if (predicate(array[c])) {\n            continue;\n        }\n        // this node can't be collapsed; push it back as far as we can.\n        if (c === l) {\n            ++l;\n            continue; // quick exit if we're already in the right spot\n        }\n        // array[l++] = array[c];\n        std_iter_swap(array, l++, c);\n    }\n    return l;\n}\n;\nfunction std_lower_bound(array, first, last, val, cmp) {\n    if (cmp === void 0) { cmp = default_compare; }\n    var count = last - first;\n    while (count > 0) {\n        var step = Math.floor(count / 2);\n        var it = first + step;\n        if (cmp(array[it], val)) {\n            first = ++it;\n            count -= step + 1;\n        }\n        else {\n            count = step;\n        }\n    }\n    return first;\n}\n;\nfunction std_upper_bound(array, first, last, val, cmp) {\n    if (cmp === void 0) { cmp = default_compare; }\n    var count = last - first;\n    while (count > 0) {\n        var step = Math.floor(count / 2);\n        var it = first + step;\n        if (!cmp(val, array[it])) {\n            first = ++it;\n            count -= step + 1;\n        }\n        else {\n            count = step;\n        }\n    }\n    return first;\n}\n;\nfunction std_rotate(array, first, n_first, last) {\n    var next = n_first;\n    while (first !== next) {\n        std_iter_swap(array, first++, next++);\n        if (next === last) {\n            next = n_first;\n        }\n        else if (first === n_first) {\n            n_first = next;\n        }\n    }\n}\nfunction std_unique(array, first, last, cmp) {\n    if (first === last) {\n        return last;\n    }\n    var result = first;\n    while (++first !== last) {\n        if (!cmp(array[result], array[first])) {\n            /// array[++result] = array[first];\n            std_iter_swap(array, ++result, first);\n        }\n    }\n    return ++result;\n}\nvar b2GrowableBuffer = /** @class */ (function () {\n    function b2GrowableBuffer(allocator) {\n        this.data = [];\n        this.count = 0;\n        this.capacity = 0;\n        this.allocator = allocator;\n    }\n    b2GrowableBuffer.prototype.Append = function () {\n        if (this.count >= this.capacity) {\n            this.Grow();\n        }\n        return this.count++;\n    };\n    b2GrowableBuffer.prototype.Reserve = function (newCapacity) {\n        if (this.capacity >= newCapacity) {\n            return;\n        }\n        b2Assert(this.capacity === this.data.length);\n        for (var i = this.capacity; i < newCapacity; ++i) {\n            this.data[i] = this.allocator();\n        }\n        this.capacity = newCapacity;\n    };\n    b2GrowableBuffer.prototype.Grow = function () {\n        // Double the capacity.\n        var newCapacity = this.capacity ? 2 * this.capacity : b2Settings_1.b2_minParticleSystemBufferCapacity;\n        b2Assert(newCapacity > this.capacity);\n        this.Reserve(newCapacity);\n    };\n    b2GrowableBuffer.prototype.Free = function () {\n        if (this.data.length === 0) {\n            return;\n        }\n        this.data = [];\n        this.capacity = 0;\n        this.count = 0;\n    };\n    b2GrowableBuffer.prototype.Shorten = function (newEnd) {\n        b2Assert(false);\n    };\n    b2GrowableBuffer.prototype.Data = function () {\n        return this.data;\n    };\n    b2GrowableBuffer.prototype.GetCount = function () {\n        return this.count;\n    };\n    b2GrowableBuffer.prototype.SetCount = function (newCount) {\n        /// b2Assert(0 <= newCount && newCount <= this.capacity);\n        this.count = newCount;\n    };\n    b2GrowableBuffer.prototype.GetCapacity = function () {\n        return this.capacity;\n    };\n    b2GrowableBuffer.prototype.RemoveIf = function (pred) {\n        var count = 0;\n        for (var i = 0; i < this.count; ++i) {\n            if (!pred(this.data[i])) {\n                count++;\n            }\n        }\n        this.count = std_remove_if(this.data, pred, this.count);\n        b2Assert(count === this.count);\n    };\n    b2GrowableBuffer.prototype.Unique = function (pred) {\n        this.count = std_unique(this.data, 0, this.count, pred);\n    };\n    return b2GrowableBuffer;\n}());\nexports.b2GrowableBuffer = b2GrowableBuffer;\nvar b2FixtureParticleQueryCallback = /** @class */ (function (_super) {\n    __extends(b2FixtureParticleQueryCallback, _super);\n    function b2FixtureParticleQueryCallback(system) {\n        var _this = _super.call(this) || this;\n        _this.m_system = system;\n        return _this;\n    }\n    b2FixtureParticleQueryCallback.prototype.ShouldQueryParticleSystem = function (system) {\n        // Skip reporting particles.\n        return false;\n    };\n    b2FixtureParticleQueryCallback.prototype.ReportFixture = function (fixture) {\n        if (fixture.IsSensor()) {\n            return true;\n        }\n        var shape = fixture.GetShape();\n        var childCount = shape.GetChildCount();\n        for (var childIndex = 0; childIndex < childCount; childIndex++) {\n            var aabb = fixture.GetAABB(childIndex);\n            var enumerator = this.m_system.GetInsideBoundsEnumerator(aabb);\n            var index = void 0;\n            // tslint:disable-next-line:no-conditional-assignment\n            while ((index = enumerator.GetNext()) >= 0) {\n                this.ReportFixtureAndParticle(fixture, childIndex, index);\n            }\n        }\n        return true;\n    };\n    b2FixtureParticleQueryCallback.prototype.ReportParticle = function (system, index) {\n        return false;\n    };\n    b2FixtureParticleQueryCallback.prototype.ReportFixtureAndParticle = function (fixture, childIndex, index) {\n        b2Assert(false); // pure virtual\n    };\n    return b2FixtureParticleQueryCallback;\n}(b2WorldCallbacks_1.b2QueryCallback));\nexports.b2FixtureParticleQueryCallback = b2FixtureParticleQueryCallback;\nvar b2ParticleContact = /** @class */ (function () {\n    function b2ParticleContact() {\n        this.indexA = 0;\n        this.indexB = 0;\n        this.weight = 0;\n        this.normal = new b2Math_1.b2Vec2();\n        this.flags = 0;\n    }\n    b2ParticleContact.prototype.SetIndices = function (a, b) {\n        b2Assert(a <= b2Settings_1.b2_maxParticleIndex && b <= b2Settings_1.b2_maxParticleIndex);\n        this.indexA = a;\n        this.indexB = b;\n    };\n    b2ParticleContact.prototype.SetWeight = function (w) {\n        this.weight = w;\n    };\n    b2ParticleContact.prototype.SetNormal = function (n) {\n        this.normal.Copy(n);\n    };\n    b2ParticleContact.prototype.SetFlags = function (f) {\n        this.flags = f;\n    };\n    b2ParticleContact.prototype.GetIndexA = function () {\n        return this.indexA;\n    };\n    b2ParticleContact.prototype.GetIndexB = function () {\n        return this.indexB;\n    };\n    b2ParticleContact.prototype.GetWeight = function () {\n        return this.weight;\n    };\n    b2ParticleContact.prototype.GetNormal = function () {\n        return this.normal;\n    };\n    b2ParticleContact.prototype.GetFlags = function () {\n        return this.flags;\n    };\n    b2ParticleContact.prototype.IsEqual = function (rhs) {\n        return this.indexA === rhs.indexA && this.indexB === rhs.indexB && this.flags === rhs.flags && this.weight === rhs.weight && this.normal.x === rhs.normal.x && this.normal.y === rhs.normal.y;\n    };\n    b2ParticleContact.prototype.IsNotEqual = function (rhs) {\n        return !this.IsEqual(rhs);\n    };\n    b2ParticleContact.prototype.ApproximatelyEqual = function (rhs) {\n        var MAX_WEIGHT_DIFF = 0.01; // Weight 0 ~ 1, so about 1%\n        var MAX_NORMAL_DIFF_SQ = 0.01 * 0.01; // Normal length = 1, so 1%\n        return this.indexA === rhs.indexA && this.indexB === rhs.indexB && this.flags === rhs.flags && b2Math_1.b2Abs(this.weight - rhs.weight) < MAX_WEIGHT_DIFF && b2Math_1.b2Vec2.DistanceSquaredVV(this.normal, rhs.normal) < MAX_NORMAL_DIFF_SQ;\n    };\n    return b2ParticleContact;\n}());\nexports.b2ParticleContact = b2ParticleContact;\nvar b2ParticleBodyContact = /** @class */ (function () {\n    function b2ParticleBodyContact() {\n        this.index = 0; // Index of the particle making contact.\n        this.body = null; // The body making contact.\n        this.fixture = null; // The specific fixture making contact\n        this.weight = 0.0; // Weight of the contact. A value between 0.0f and 1.0f.\n        this.normal = new b2Math_1.b2Vec2(); // The normalized direction from the particle to the body.\n        this.mass = 0.0; // The effective mass used in calculating force.\n    }\n    return b2ParticleBodyContact;\n}());\nexports.b2ParticleBodyContact = b2ParticleBodyContact;\nvar b2ParticlePair = /** @class */ (function () {\n    function b2ParticlePair() {\n        this.indexA = 0; // Indices of the respective particles making pair.\n        this.indexB = 0;\n        this.flags = 0; // The logical sum of the particle flags. See the b2ParticleFlag enum.\n        this.strength = 0.0; // The strength of cohesion among the particles.\n        this.distance = 0.0; // The initial distance of the particles.\n    }\n    return b2ParticlePair;\n}());\nexports.b2ParticlePair = b2ParticlePair;\nvar b2ParticleTriad = /** @class */ (function () {\n    function b2ParticleTriad() {\n        this.indexA = 0; // Indices of the respective particles making triad.\n        this.indexB = 0;\n        this.indexC = 0;\n        this.flags = 0; // The logical sum of the particle flags. See the b2ParticleFlag enum.\n        this.strength = 0.0; // The strength of cohesion among the particles.\n        this.pa = new b2Math_1.b2Vec2(0.0, 0.0); // Values used for calculation.\n        this.pb = new b2Math_1.b2Vec2(0.0, 0.0);\n        this.pc = new b2Math_1.b2Vec2(0.0, 0.0);\n        this.ka = 0.0;\n        this.kb = 0.0;\n        this.kc = 0.0;\n        this.s = 0.0;\n    }\n    return b2ParticleTriad;\n}());\nexports.b2ParticleTriad = b2ParticleTriad;\nvar b2ParticleSystemDef = /** @class */ (function () {\n    function b2ParticleSystemDef() {\n        // Initialize physical coefficients to the maximum values that\n        // maintain numerical stability.\n        /**\n         * Enable strict Particle/Body contact check.\n         * See SetStrictContactCheck for details.\n         */\n        this.strictContactCheck = false;\n        /**\n         * Set the particle density.\n         * See SetDensity for details.\n         */\n        this.density = 1.0;\n        /**\n         * Change the particle gravity scale. Adjusts the effect of the\n         * global gravity vector on particles. Default value is 1.0f.\n         */\n        this.gravityScale = 1.0;\n        /**\n         * Particles behave as circles with this radius. In Box2D units.\n         */\n        this.radius = 1.0;\n        /**\n         * Set the maximum number of particles.\n         * By default, there is no maximum. The particle buffers can\n         * continue to grow while b2World's block allocator still has\n         * memory.\n         * See SetMaxParticleCount for details.\n         */\n        this.maxCount = 0;\n        /**\n         * Increases pressure in response to compression\n         * Smaller values allow more compression\n         */\n        this.pressureStrength = 0.005;\n        /**\n         * Reduces velocity along the collision normal\n         * Smaller value reduces less\n         */\n        this.dampingStrength = 1.0;\n        /**\n         * Restores shape of elastic particle groups\n         * Larger values increase elastic particle velocity\n         */\n        this.elasticStrength = 0.25;\n        /**\n         * Restores length of spring particle groups\n         * Larger values increase spring particle velocity\n         */\n        this.springStrength = 0.25;\n        /**\n         * Reduces relative velocity of viscous particles\n         * Larger values slow down viscous particles more\n         */\n        this.viscousStrength = 0.25;\n        /**\n         * Produces pressure on tensile particles\n         * 0~0.2. Larger values increase the amount of surface tension.\n         */\n        this.surfaceTensionPressureStrength = 0.2;\n        /**\n         * Smoothes outline of tensile particles\n         * 0~0.2. Larger values result in rounder, smoother,\n         * water-drop-like clusters of particles.\n         */\n        this.surfaceTensionNormalStrength = 0.2;\n        /**\n         * Produces additional pressure on repulsive particles\n         * Larger values repulse more\n         * Negative values mean attraction. The range where particles\n         * behave stably is about -0.2 to 2.0.\n         */\n        this.repulsiveStrength = 1.0;\n        /**\n         * Produces repulsion between powder particles\n         * Larger values repulse more\n         */\n        this.powderStrength = 0.5;\n        /**\n         * Pushes particles out of solid particle group\n         * Larger values repulse more\n         */\n        this.ejectionStrength = 0.5;\n        /**\n         * Produces static pressure\n         * Larger values increase the pressure on neighboring partilces\n         * For a description of static pressure, see\n         * http://en.wikipedia.org/wiki/Static_pressure#Static_pressure_in_fluid_dynamics\n         */\n        this.staticPressureStrength = 0.2;\n        /**\n         * Reduces instability in static pressure calculation\n         * Larger values make stabilize static pressure with fewer\n         * iterations\n         */\n        this.staticPressureRelaxation = 0.2;\n        /**\n         * Computes static pressure more precisely\n         * See SetStaticPressureIterations for details\n         */\n        this.staticPressureIterations = 8;\n        /**\n         * Determines how fast colors are mixed\n         * 1.0f ==> mixed immediately\n         * 0.5f ==> mixed half way each simulation step (see\n         * b2World::Step())\n         */\n        this.colorMixingStrength = 0.5;\n        /**\n         * Whether to destroy particles by age when no more particles\n         * can be created.  See #b2ParticleSystem::SetDestructionByAge()\n         * for more information.\n         */\n        this.destroyByAge = true;\n        /**\n         * Granularity of particle lifetimes in seconds.  By default\n         * this is set to (1.0f / 60.0f) seconds.  b2ParticleSystem uses\n         * a 32-bit signed value to track particle lifetimes so the\n         * maximum lifetime of a particle is (2^32 - 1) / (1.0f /\n         * lifetimeGranularity) seconds. With the value set to 1/60 the\n         * maximum lifetime or age of a particle is 2.27 years.\n         */\n        this.lifetimeGranularity = 1.0 / 60.0;\n    }\n    b2ParticleSystemDef.prototype.Copy = function (def) {\n        this.strictContactCheck = def.strictContactCheck;\n        this.density = def.density;\n        this.gravityScale = def.gravityScale;\n        this.radius = def.radius;\n        this.maxCount = def.maxCount;\n        this.pressureStrength = def.pressureStrength;\n        this.dampingStrength = def.dampingStrength;\n        this.elasticStrength = def.elasticStrength;\n        this.springStrength = def.springStrength;\n        this.viscousStrength = def.viscousStrength;\n        this.surfaceTensionPressureStrength = def.surfaceTensionPressureStrength;\n        this.surfaceTensionNormalStrength = def.surfaceTensionNormalStrength;\n        this.repulsiveStrength = def.repulsiveStrength;\n        this.powderStrength = def.powderStrength;\n        this.ejectionStrength = def.ejectionStrength;\n        this.staticPressureStrength = def.staticPressureStrength;\n        this.staticPressureRelaxation = def.staticPressureRelaxation;\n        this.staticPressureIterations = def.staticPressureIterations;\n        this.colorMixingStrength = def.colorMixingStrength;\n        this.destroyByAge = def.destroyByAge;\n        this.lifetimeGranularity = def.lifetimeGranularity;\n        return this;\n    };\n    b2ParticleSystemDef.prototype.Clone = function () {\n        return new b2ParticleSystemDef().Copy(this);\n    };\n    return b2ParticleSystemDef;\n}());\nexports.b2ParticleSystemDef = b2ParticleSystemDef;\nvar b2ParticleSystem = /** @class */ (function () {\n    function b2ParticleSystem(def, world) {\n        this.m_paused = false;\n        this.m_timestamp = 0;\n        this.m_allParticleFlags = 0;\n        this.m_needsUpdateAllParticleFlags = false;\n        this.m_allGroupFlags = 0;\n        this.m_needsUpdateAllGroupFlags = false;\n        this.m_hasForce = false;\n        this.m_iterationIndex = 0;\n        this.m_inverseDensity = 0.0;\n        this.m_particleDiameter = 0.0;\n        this.m_inverseDiameter = 0.0;\n        this.m_squaredDiameter = 0.0;\n        this.m_count = 0;\n        this.m_internalAllocatedCapacity = 0;\n        /**\n         * Allocator for b2ParticleHandle instances.\n         */\n        /// m_handleAllocator: any = null;\n        /**\n         * Maps particle indicies to handles.\n         */\n        this.m_handleIndexBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_flagsBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_positionBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_velocityBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_forceBuffer = [];\n        /**\n         * this.m_weightBuffer is populated in ComputeWeight and used in\n         * ComputeDepth(), SolveStaticPressure() and SolvePressure().\n         */\n        this.m_weightBuffer = [];\n        /**\n         * When any particles have the flag b2_staticPressureParticle,\n         * this.m_staticPressureBuffer is first allocated and used in\n         * SolveStaticPressure() and SolvePressure().  It will be\n         * reallocated on subsequent CreateParticle() calls.\n         */\n        this.m_staticPressureBuffer = [];\n        /**\n         * this.m_accumulationBuffer is used in many functions as a temporary\n         * buffer for scalar values.\n         */\n        this.m_accumulationBuffer = [];\n        /**\n         * When any particles have the flag b2_tensileParticle,\n         * this.m_accumulation2Buffer is first allocated and used in\n         * SolveTensile() as a temporary buffer for vector values.  It\n         * will be reallocated on subsequent CreateParticle() calls.\n         */\n        this.m_accumulation2Buffer = [];\n        /**\n         * When any particle groups have the flag b2_solidParticleGroup,\n         * this.m_depthBuffer is first allocated and populated in\n         * ComputeDepth() and used in SolveSolid(). It will be\n         * reallocated on subsequent CreateParticle() calls.\n         */\n        this.m_depthBuffer = [];\n        this.m_colorBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_groupBuffer = [];\n        this.m_userDataBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        /**\n         * Stuck particle detection parameters and record keeping\n         */\n        this.m_stuckThreshold = 0;\n        this.m_lastBodyContactStepBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_bodyContactCountBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_consecutiveContactStepsBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        this.m_stuckParticleBuffer = new b2GrowableBuffer(function () { return 0; });\n        this.m_proxyBuffer = new b2GrowableBuffer(function () { return new b2ParticleSystem.Proxy(); });\n        this.m_contactBuffer = new b2GrowableBuffer(function () { return new b2ParticleContact(); });\n        this.m_bodyContactBuffer = new b2GrowableBuffer(function () { return new b2ParticleBodyContact(); });\n        this.m_pairBuffer = new b2GrowableBuffer(function () { return new b2ParticlePair(); });\n        this.m_triadBuffer = new b2GrowableBuffer(function () { return new b2ParticleTriad(); });\n        /**\n         * Time each particle should be destroyed relative to the last\n         * time this.m_timeElapsed was initialized.  Each unit of time\n         * corresponds to b2ParticleSystemDef::lifetimeGranularity\n         * seconds.\n         */\n        this.m_expirationTimeBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        /**\n         * List of particle indices sorted by expiration time.\n         */\n        this.m_indexByExpirationTimeBuffer = new b2ParticleSystem.UserOverridableBuffer();\n        /**\n         * Time elapsed in 32:32 fixed point.  Each non-fractional unit\n         * of time corresponds to\n         * b2ParticleSystemDef::lifetimeGranularity seconds.\n         */\n        this.m_timeElapsed = 0;\n        /**\n         * Whether the expiration time buffer has been modified and\n         * needs to be resorted.\n         */\n        this.m_expirationTimeBufferRequiresSorting = false;\n        this.m_groupCount = 0;\n        this.m_groupList = null;\n        this.m_def = new b2ParticleSystemDef();\n        this.m_prev = null;\n        this.m_next = null;\n        this.SetStrictContactCheck(def.strictContactCheck);\n        this.SetDensity(def.density);\n        this.SetGravityScale(def.gravityScale);\n        this.SetRadius(def.radius);\n        this.SetMaxParticleCount(def.maxCount);\n        b2Assert(def.lifetimeGranularity > 0.0);\n        this.m_def = def.Clone();\n        this.m_world = world;\n        this.SetDestructionByAge(this.m_def.destroyByAge);\n    }\n    b2ParticleSystem.computeTag = function (x, y) {\n        /// return ((uint32)(y + yOffset) << yShift) + (uint32)(xScale * x + xOffset);\n        return ((((y + b2ParticleSystem.yOffset) >>> 0) << b2ParticleSystem.yShift) + ((b2ParticleSystem.xScale * x + b2ParticleSystem.xOffset) >>> 0)) >>> 0;\n    };\n    b2ParticleSystem.computeRelativeTag = function (tag, x, y) {\n        /// return tag + (y << yShift) + (x << xShift);\n        return (tag + (y << b2ParticleSystem.yShift) + (x << b2ParticleSystem.xShift)) >>> 0;\n    };\n    b2ParticleSystem.prototype.Drop = function () {\n        while (this.m_groupList) {\n            this.DestroyParticleGroup(this.m_groupList);\n        }\n        this.FreeUserOverridableBuffer(this.m_handleIndexBuffer);\n        this.FreeUserOverridableBuffer(this.m_flagsBuffer);\n        this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer);\n        this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer);\n        this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer);\n        this.FreeUserOverridableBuffer(this.m_positionBuffer);\n        this.FreeUserOverridableBuffer(this.m_velocityBuffer);\n        this.FreeUserOverridableBuffer(this.m_colorBuffer);\n        this.FreeUserOverridableBuffer(this.m_userDataBuffer);\n        this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer);\n        this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer);\n        this.FreeBuffer(this.m_forceBuffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_weightBuffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_staticPressureBuffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_accumulationBuffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_accumulation2Buffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_depthBuffer, this.m_internalAllocatedCapacity);\n        this.FreeBuffer(this.m_groupBuffer, this.m_internalAllocatedCapacity);\n    };\n    /**\n     * Create a particle whose properties have been defined.\n     *\n     * No reference to the definition is retained.\n     *\n     * A simulation step must occur before it's possible to interact\n     * with a newly created particle.  For example,\n     * DestroyParticleInShape() will not destroy a particle until\n     * b2World::Step() has been called.\n     *\n     * warning: This function is locked during callbacks.\n     */\n    b2ParticleSystem.prototype.CreateParticle = function (def) {\n        b2Assert(this.m_world.IsLocked() === false);\n        if (this.m_world.IsLocked()) {\n            return 0;\n        }\n        if (this.m_count >= this.m_internalAllocatedCapacity) {\n            // Double the particle capacity.\n            var capacity = this.m_count ? 2 * this.m_count : b2Settings_1.b2_minParticleSystemBufferCapacity;\n            this.ReallocateInternalAllocatedBuffers(capacity);\n        }\n        if (this.m_count >= this.m_internalAllocatedCapacity) {\n            // If the oldest particle should be destroyed...\n            if (this.m_def.destroyByAge) {\n                this.DestroyOldestParticle(0, false);\n                // Need to destroy this particle *now* so that it's possible to\n                // create a new particle.\n                this.SolveZombie();\n            }\n            else {\n                return b2Settings_1.b2_invalidParticleIndex;\n            }\n        }\n        var index = this.m_count++;\n        this.m_flagsBuffer.data[index] = 0;\n        if (this.m_lastBodyContactStepBuffer.data) {\n            this.m_lastBodyContactStepBuffer.data[index] = 0;\n        }\n        if (this.m_bodyContactCountBuffer.data) {\n            this.m_bodyContactCountBuffer.data[index] = 0;\n        }\n        if (this.m_consecutiveContactStepsBuffer.data) {\n            this.m_consecutiveContactStepsBuffer.data[index] = 0;\n        }\n        this.m_positionBuffer.data[index] = (this.m_positionBuffer.data[index] || new b2Math_1.b2Vec2()).Copy(def.position);\n        this.m_velocityBuffer.data[index] = (this.m_velocityBuffer.data[index] || new b2Math_1.b2Vec2()).Copy(def.velocity);\n        this.m_weightBuffer[index] = 0;\n        this.m_forceBuffer[index] = (this.m_forceBuffer[index] || new b2Math_1.b2Vec2()).SetZero();\n        if (this.m_staticPressureBuffer) {\n            this.m_staticPressureBuffer[index] = 0;\n        }\n        if (this.m_depthBuffer) {\n            this.m_depthBuffer[index] = 0;\n        }\n        if (this.m_colorBuffer.data || !def.color.IsZero()) {\n            this.m_colorBuffer.data = this.RequestBuffer(this.m_colorBuffer.data);\n            this.m_colorBuffer.data[index] = (this.m_colorBuffer.data[index] || new b2Draw_1.b2Color()).Copy(def.color);\n        }\n        if (this.m_userDataBuffer.data || def.userData) {\n            this.m_userDataBuffer.data = this.RequestBuffer(this.m_userDataBuffer.data);\n            this.m_userDataBuffer.data[index] = def.userData;\n        }\n        if (this.m_handleIndexBuffer.data) {\n            this.m_handleIndexBuffer.data[index] = null;\n        }\n        /// Proxy& proxy = m_proxyBuffer.Append();\n        var proxy = this.m_proxyBuffer.data[this.m_proxyBuffer.Append()];\n        // If particle lifetimes are enabled or the lifetime is set in the particle\n        // definition, initialize the lifetime.\n        var finiteLifetime = def.lifetime > 0.0;\n        if (this.m_expirationTimeBuffer.data || finiteLifetime) {\n            this.SetParticleLifetime(index, finiteLifetime ? def.lifetime :\n                this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed()));\n            // Add a reference to the newly added particle to the end of the\n            // queue.\n            this.m_indexByExpirationTimeBuffer.data[index] = index;\n        }\n        proxy.index = index;\n        var group = def.group;\n        this.m_groupBuffer[index] = group;\n        if (group) {\n            if (group.m_firstIndex < group.m_lastIndex) {\n                // Move particles in the group just before the new particle.\n                this.RotateBuffer(group.m_firstIndex, group.m_lastIndex, index);\n                b2Assert(group.m_lastIndex === index);\n                // Update the index range of the group to contain the new particle.\n                group.m_lastIndex = index + 1;\n            }\n            else {\n                // If the group is empty, reset the index range to contain only the\n                // new particle.\n                group.m_firstIndex = index;\n                group.m_lastIndex = index + 1;\n            }\n        }\n        this.SetParticleFlags(index, def.flags);\n        return index;\n    };\n    /**\n     * Retrieve a handle to the particle at the specified index.\n     *\n     * Please see #b2ParticleHandle for why you might want a handle.\n     */\n    b2ParticleSystem.prototype.GetParticleHandleFromIndex = function (index) {\n        b2Assert(index >= 0 && index < this.GetParticleCount() && index !== b2Settings_1.b2_invalidParticleIndex);\n        this.m_handleIndexBuffer.data = this.RequestBuffer(this.m_handleIndexBuffer.data);\n        var handle = this.m_handleIndexBuffer.data[index];\n        if (handle) {\n            return handle;\n        }\n        // Create a handle.\n        /// handle = m_handleAllocator.Allocate();\n        handle = new b2Particle_1.b2ParticleHandle();\n        b2Assert(handle !== null);\n        handle.SetIndex(index);\n        this.m_handleIndexBuffer.data[index] = handle;\n        return handle;\n    };\n    /**\n     * Destroy a particle.\n     *\n     * The particle is removed after the next simulation step (see\n     * b2World::Step()).\n     *\n     * @param index Index of the particle to destroy.\n     * @param callDestructionListener Whether to call the\n     *      destruction listener just before the particle is\n     *      destroyed.\n     */\n    b2ParticleSystem.prototype.DestroyParticle = function (index, callDestructionListener) {\n        if (callDestructionListener === void 0) { callDestructionListener = false; }\n        var flags = b2Particle_1.b2ParticleFlag.b2_zombieParticle;\n        if (callDestructionListener) {\n            flags |= b2Particle_1.b2ParticleFlag.b2_destructionListenerParticle;\n        }\n        this.SetParticleFlags(index, this.m_flagsBuffer.data[index] | flags);\n    };\n    /**\n     * Destroy the Nth oldest particle in the system.\n     *\n     * The particle is removed after the next b2World::Step().\n     *\n     * @param index Index of the Nth oldest particle to\n     *      destroy, 0 will destroy the oldest particle in the\n     *      system, 1 will destroy the next oldest particle etc.\n     * @param callDestructionListener Whether to call the\n     *      destruction listener just before the particle is\n     *      destroyed.\n     */\n    b2ParticleSystem.prototype.DestroyOldestParticle = function (index, callDestructionListener) {\n        if (callDestructionListener === void 0) { callDestructionListener = false; }\n        var particleCount = this.GetParticleCount();\n        b2Assert(index >= 0 && index < particleCount);\n        // Make sure particle lifetime tracking is enabled.\n        b2Assert(this.m_indexByExpirationTimeBuffer.data !== null);\n        // Destroy the oldest particle (preferring to destroy finite\n        // lifetime particles first) to free a slot in the buffer.\n        var oldestFiniteLifetimeParticle = this.m_indexByExpirationTimeBuffer.data[particleCount - (index + 1)];\n        var oldestInfiniteLifetimeParticle = this.m_indexByExpirationTimeBuffer.data[index];\n        this.DestroyParticle(this.m_expirationTimeBuffer.data[oldestFiniteLifetimeParticle] > 0.0 ?\n            oldestFiniteLifetimeParticle : oldestInfiniteLifetimeParticle, callDestructionListener);\n    };\n    /**\n     * Destroy particles inside a shape.\n     *\n     * warning: This function is locked during callbacks.\n     *\n     * In addition, this function immediately destroys particles in\n     * the shape in constrast to DestroyParticle() which defers the\n     * destruction until the next simulation step.\n     *\n     * @return Number of particles destroyed.\n     * @param shape Shape which encloses particles\n     *      that should be destroyed.\n     * @param xf Transform applied to the shape.\n     * @param callDestructionListener Whether to call the\n     *      world b2DestructionListener for each particle\n     *      destroyed.\n     */\n    b2ParticleSystem.prototype.DestroyParticlesInShape = function (shape, xf, callDestructionListener) {\n        if (callDestructionListener === void 0) { callDestructionListener = false; }\n        var s_aabb = b2ParticleSystem.DestroyParticlesInShape_s_aabb;\n        b2Assert(this.m_world.IsLocked() === false);\n        if (this.m_world.IsLocked()) {\n            return 0;\n        }\n        var callback = new b2ParticleSystem.DestroyParticlesInShapeCallback(this, shape, xf, callDestructionListener);\n        var aabb = s_aabb;\n        shape.ComputeAABB(aabb, xf, 0);\n        this.m_world.QueryAABB(callback, aabb);\n        return callback.Destroyed();\n    };\n    /**\n     * Create a particle group whose properties have been defined.\n     *\n     * No reference to the definition is retained.\n     *\n     * warning: This function is locked during callbacks.\n     */\n    b2ParticleSystem.prototype.CreateParticleGroup = function (groupDef) {\n        var s_transform = b2ParticleSystem.CreateParticleGroup_s_transform;\n        b2Assert(this.m_world.IsLocked() === false);\n        if (this.m_world.IsLocked()) {\n            return null;\n        }\n        var transform = s_transform;\n        transform.SetPositionAngle(groupDef.position, groupDef.angle);\n        var firstIndex = this.m_count;\n        if (groupDef.shape) {\n            this.CreateParticlesWithShapeForGroup(groupDef.shape, groupDef, transform);\n        }\n        if (groupDef.shapes) {\n            this.CreateParticlesWithShapesForGroup(groupDef.shapes, groupDef.shapeCount, groupDef, transform);\n        }\n        if (groupDef.particleCount) {\n            b2Assert(groupDef.positionData !== null);\n            for (var i = 0; i < groupDef.particleCount; i++) {\n                var p = groupDef.positionData[i];\n                this.CreateParticleForGroup(groupDef, transform, p);\n            }\n        }\n        var lastIndex = this.m_count;\n        var group = new b2ParticleGroup_1.b2ParticleGroup(this);\n        group.m_firstIndex = firstIndex;\n        group.m_lastIndex = lastIndex;\n        group.m_strength = groupDef.strength;\n        group.m_userData = groupDef.userData;\n        group.m_transform.Copy(transform);\n        group.m_prev = null;\n        group.m_next = this.m_groupList;\n        if (this.m_groupList) {\n            this.m_groupList.m_prev = group;\n        }\n        this.m_groupList = group;\n        ++this.m_groupCount;\n        for (var i = firstIndex; i < lastIndex; i++) {\n            this.m_groupBuffer[i] = group;\n        }\n        this.SetGroupFlags(group, groupDef.groupFlags);\n        // Create pairs and triads between particles in the group.\n        var filter = new b2ParticleSystem.ConnectionFilter();\n        this.UpdateContacts(true);\n        this.UpdatePairsAndTriads(firstIndex, lastIndex, filter);\n        if (groupDef.group) {\n            this.JoinParticleGroups(groupDef.group, group);\n            group = groupDef.group;\n        }\n        return group;\n    };\n    /**\n     * Join two particle groups.\n     *\n     * warning: This function is locked during callbacks.\n     *\n     * @param groupA the first group. Expands to encompass the second group.\n     * @param groupB the second group. It is destroyed.\n     */\n    b2ParticleSystem.prototype.JoinParticleGroups = function (groupA, groupB) {\n        b2Assert(this.m_world.IsLocked() === false);\n        if (this.m_world.IsLocked()) {\n            return;\n        }\n        b2Assert(groupA !== groupB);\n        this.RotateBuffer(groupB.m_firstIndex, groupB.m_lastIndex, this.m_count);\n        b2Assert(groupB.m_lastIndex === this.m_count);\n        this.RotateBuffer(groupA.m_firstIndex, groupA.m_lastIndex, groupB.m_firstIndex);\n        b2Assert(groupA.m_lastIndex === groupB.m_firstIndex);\n        // Create pairs and triads connecting groupA and groupB.\n        var filter = new b2ParticleSystem.JoinParticleGroupsFilter(groupB.m_firstIndex);\n        this.UpdateContacts(true);\n        this.UpdatePairsAndTriads(groupA.m_firstIndex, groupB.m_lastIndex, filter);\n        for (var i = groupB.m_firstIndex; i < groupB.m_lastIndex; i++) {\n            this.m_groupBuffer[i] = groupA;\n        }\n        var groupFlags = groupA.m_groupFlags | groupB.m_groupFlags;\n        this.SetGroupFlags(groupA, groupFlags);\n        groupA.m_lastIndex = groupB.m_lastIndex;\n        groupB.m_firstIndex = groupB.m_lastIndex;\n        this.DestroyParticleGroup(groupB);\n    };\n    /**\n     * Split particle group into multiple disconnected groups.\n     *\n     * warning: This function is locked during callbacks.\n     *\n     * @param group the group to be split.\n     */\n    b2ParticleSystem.prototype.SplitParticleGroup = function (group) {\n        this.UpdateContacts(true);\n        var particleCount = group.GetParticleCount();\n        // We create several linked lists. Each list represents a set of connected particles.\n        /// ParticleListNode* nodeBuffer = (ParticleListNode*) m_world.m_stackAllocator.Allocate(sizeof(ParticleListNode) * particleCount);\n        var nodeBuffer = b2Settings_1.b2MakeArray(particleCount, function (index) { return new b2ParticleSystem.ParticleListNode(); });\n        b2ParticleSystem.InitializeParticleLists(group, nodeBuffer);\n        this.MergeParticleListsInContact(group, nodeBuffer);\n        var survivingList = b2ParticleSystem.FindLongestParticleList(group, nodeBuffer);\n        this.MergeZombieParticleListNodes(group, nodeBuffer, survivingList);\n        this.CreateParticleGroupsFromParticleList(group, nodeBuffer, survivingList);\n        this.UpdatePairsAndTriadsWithParticleList(group, nodeBuffer);\n        /// this.m_world.m_stackAllocator.Free(nodeBuffer);\n    };\n    /**\n     * Get the world particle group list. With the returned group,\n     * use b2ParticleGroup::GetNext to get the next group in the\n     * world list.\n     *\n     * A null group indicates the end of the list.\n     *\n     * @return the head of the world particle group list.\n     */\n    b2ParticleSystem.prototype.GetParticleGroupList = function () {\n        return this.m_groupList;\n    };\n    /**\n     * Get the number of particle groups.\n     */\n    b2ParticleSystem.prototype.GetParticleGroupCount = function () {\n        return this.m_groupCount;\n    };\n    /**\n     * Get the number of particles.\n     */\n    b2ParticleSystem.prototype.GetParticleCount = function () {\n        return this.m_count;\n    };\n    /**\n     * Get the maximum number of particles.\n     */\n    b2ParticleSystem.prototype.GetMaxParticleCount = function () {\n        return this.m_def.maxCount;\n    };\n    /**\n     * Set the maximum number of particles.\n     *\n     * A value of 0 means there is no maximum. The particle buffers\n     * can continue to grow while b2World's block allocator still\n     * has memory.\n     *\n     * Note: If you try to CreateParticle() with more than this\n     * count, b2_invalidParticleIndex is returned unless\n     * SetDestructionByAge() is used to enable the destruction of\n     * the oldest particles in the system.\n     */\n    b2ParticleSystem.prototype.SetMaxParticleCount = function (count) {\n        b2Assert(this.m_count <= count);\n        this.m_def.maxCount = count;\n    };\n    /**\n     * Get all existing particle flags.\n     */\n    b2ParticleSystem.prototype.GetAllParticleFlags = function () {\n        return this.m_allParticleFlags;\n    };\n    /**\n     * Get all existing particle group flags.\n     */\n    b2ParticleSystem.prototype.GetAllGroupFlags = function () {\n        return this.m_allGroupFlags;\n    };\n    /**\n     * Pause or unpause the particle system. When paused,\n     * b2World::Step() skips over this particle system. All\n     * b2ParticleSystem function calls still work.\n     *\n     * @param paused paused is true to pause, false to un-pause.\n     */\n    b2ParticleSystem.prototype.SetPaused = function (paused) {\n        this.m_paused = paused;\n    };\n    /**\n     * Initially, true, then, the last value passed into\n     * SetPaused().\n     *\n     * @return true if the particle system is being updated in b2World::Step().\n     */\n    b2ParticleSystem.prototype.GetPaused = function () {\n        return this.m_paused;\n    };\n    /**\n     * Change the particle density.\n     *\n     * Particle density affects the mass of the particles, which in\n     * turn affects how the particles interact with b2Bodies. Note\n     * that the density does not affect how the particles interact\n     * with each other.\n     */\n    b2ParticleSystem.prototype.SetDensity = function (density) {\n        this.m_def.density = density;\n        this.m_inverseDensity = 1 / this.m_def.density;\n    };\n    /**\n     * Get the particle density.\n     */\n    b2ParticleSystem.prototype.GetDensity = function () {\n        return this.m_def.density;\n    };\n    /**\n     * Change the particle gravity scale. Adjusts the effect of the\n     * global gravity vector on particles.\n     */\n    b2ParticleSystem.prototype.SetGravityScale = function (gravityScale) {\n        this.m_def.gravityScale = gravityScale;\n    };\n    /**\n     * Get the particle gravity scale.\n     */\n    b2ParticleSystem.prototype.GetGravityScale = function () {\n        return this.m_def.gravityScale;\n    };\n    /**\n     * Damping is used to reduce the velocity of particles. The\n     * damping parameter can be larger than 1.0f but the damping\n     * effect becomes sensitive to the time step when the damping\n     * parameter is large.\n     */\n    b2ParticleSystem.prototype.SetDamping = function (damping) {\n        this.m_def.dampingStrength = damping;\n    };\n    /**\n     * Get damping for particles\n     */\n    b2ParticleSystem.prototype.GetDamping = function () {\n        return this.m_def.dampingStrength;\n    };\n    /**\n     * Change the number of iterations when calculating the static\n     * pressure of particles. By default, 8 iterations. You can\n     * reduce the number of iterations down to 1 in some situations,\n     * but this may cause instabilities when many particles come\n     * together. If you see particles popping away from each other\n     * like popcorn, you may have to increase the number of\n     * iterations.\n     *\n     * For a description of static pressure, see\n     * http://en.wikipedia.org/wiki/Static_pressure#Static_pressure_in_fluid_dynamics\n     */\n    b2ParticleSystem.prototype.SetStaticPressureIterations = function (iterations) {\n        this.m_def.staticPressureIterations = iterations;\n    };\n    /**\n     * Get the number of iterations for static pressure of\n     * particles.\n     */\n    b2ParticleSystem.prototype.GetStaticPressureIterations = function () {\n        return this.m_def.staticPressureIterations;\n    };\n    /**\n     * Change the particle radius.\n     *\n     * You should set this only once, on world start.\n     * If you change the radius during execution, existing particles\n     * may explode, shrink, or behave unexpectedly.\n     */\n    b2ParticleSystem.prototype.SetRadius = function (radius) {\n        this.m_particleDiameter = 2 * radius;\n        this.m_squaredDiameter = this.m_particleDiameter * this.m_particleDiameter;\n        this.m_inverseDiameter = 1 / this.m_particleDiameter;\n    };\n    /**\n     * Get the particle radius.\n     */\n    b2ParticleSystem.prototype.GetRadius = function () {\n        return this.m_particleDiameter / 2;\n    };\n    /**\n     * Get the position of each particle\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle positions array.\n     */\n    b2ParticleSystem.prototype.GetPositionBuffer = function () {\n        return this.m_positionBuffer.data;\n    };\n    /**\n     * Get the velocity of each particle\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle velocities array.\n     */\n    b2ParticleSystem.prototype.GetVelocityBuffer = function () {\n        return this.m_velocityBuffer.data;\n    };\n    /**\n     * Get the color of each particle\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle colors array.\n     */\n    b2ParticleSystem.prototype.GetColorBuffer = function () {\n        this.m_colorBuffer.data = this.RequestBuffer(this.m_colorBuffer.data);\n        return this.m_colorBuffer.data;\n    };\n    /**\n     * Get the particle-group of each particle.\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle group array.\n     */\n    b2ParticleSystem.prototype.GetGroupBuffer = function () {\n        return this.m_groupBuffer;\n    };\n    /**\n     * Get the weight of each particle\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle positions array.\n     */\n    b2ParticleSystem.prototype.GetWeightBuffer = function () {\n        return this.m_weightBuffer;\n    };\n    /**\n     * Get the user-specified data of each particle.\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle user-data array.\n     */\n    b2ParticleSystem.prototype.GetUserDataBuffer = function () {\n        this.m_userDataBuffer.data = this.RequestBuffer(this.m_userDataBuffer.data);\n        return this.m_userDataBuffer.data;\n    };\n    /**\n     * Get the flags for each particle. See the b2ParticleFlag enum.\n     *\n     * Array is length GetParticleCount()\n     *\n     * @return the pointer to the head of the particle-flags array.\n     */\n    b2ParticleSystem.prototype.GetFlagsBuffer = function () {\n        return this.m_flagsBuffer.data;\n    };\n    /**\n     * Set flags for a particle. See the b2ParticleFlag enum.\n     */\n    b2ParticleSystem.prototype.SetParticleFlags = function (index, newFlags) {\n        var oldFlags = this.m_flagsBuffer.data[index];\n        if (oldFlags & ~newFlags) {\n            // If any flags might be removed\n            this.m_needsUpdateAllParticleFlags = true;\n        }\n        if (~this.m_allParticleFlags & newFlags) {\n            // If any flags were added\n            if (newFlags & b2Particle_1.b2ParticleFlag.b2_tensileParticle) {\n                this.m_accumulation2Buffer = this.RequestBuffer(this.m_accumulation2Buffer);\n            }\n            if (newFlags & b2Particle_1.b2ParticleFlag.b2_colorMixingParticle) {\n                this.m_colorBuffer.data = this.RequestBuffer(this.m_colorBuffer.data);\n            }\n            this.m_allParticleFlags |= newFlags;\n        }\n        this.m_flagsBuffer.data[index] = newFlags;\n    };\n    /**\n     * Get flags for a particle. See the b2ParticleFlag enum.\n     */\n    b2ParticleSystem.prototype.GetParticleFlags = function (index) {\n        return this.m_flagsBuffer.data[index];\n    };\n    /**\n     * Set an external buffer for particle data.\n     *\n     * Normally, the b2World's block allocator is used for particle\n     * data. However, sometimes you may have an OpenGL or Java\n     * buffer for particle data. To avoid data duplication, you may\n     * supply this external buffer.\n     *\n     * Note that, when b2World's block allocator is used, the\n     * particle data buffers can grow as required. However, when\n     * external buffers are used, the maximum number of particles is\n     * clamped to the size of the smallest external buffer.\n     *\n     * @param buffer a pointer to a block of memory.\n     * @param capacity the number of values in the block.\n     */\n    b2ParticleSystem.prototype.SetFlagsBuffer = function (buffer, capacity) {\n        this.SetUserOverridableBuffer(this.m_flagsBuffer, buffer, capacity);\n    };\n    b2ParticleSystem.prototype.SetPositionBuffer = function (buffer, capacity) {\n        /// if (buffer instanceof Float32Array) {\n        /// let array = [];\n        /// for (let i = 0; i < capacity; ++i) {\n        ///  array[i] = new b2Vec2(buffer.subarray(i * 2, i * 2 + 2));\n        /// }\n        /// this.SetUserOverridableBuffer(this.m_positionBuffer, array, capacity);\n        /// } else {\n        this.SetUserOverridableBuffer(this.m_positionBuffer, buffer, capacity);\n        /// }\n    };\n    b2ParticleSystem.prototype.SetVelocityBuffer = function (buffer, capacity) {\n        /// if (buffer instanceof Float32Array) {\n        /// let array = [];\n        /// for (let i = 0; i < capacity; ++i) {\n        ///  array[i] = new b2Vec2(buffer.subarray(i * 2, i * 2 + 2));\n        /// }\n        /// this.SetUserOverridableBuffer(this.m_velocityBuffer, array, capacity);\n        /// } else {\n        this.SetUserOverridableBuffer(this.m_velocityBuffer, buffer, capacity);\n        /// }\n    };\n    b2ParticleSystem.prototype.SetColorBuffer = function (buffer, capacity) {\n        /// if (buffer instanceof Uint8Array) {\n        /// let array: b2Color[] = [];\n        /// for (let i = 0; i < capacity; ++i) {\n        ///  array[i] = new b2Color(buffer.subarray(i * 4, i * 4 + 4));\n        /// }\n        /// this.SetUserOverridableBuffer(this.m_colorBuffer, array, capacity);\n        /// } else {\n        this.SetUserOverridableBuffer(this.m_colorBuffer, buffer, capacity);\n        /// }\n    };\n    b2ParticleSystem.prototype.SetUserDataBuffer = function (buffer, capacity) {\n        this.SetUserOverridableBuffer(this.m_userDataBuffer, buffer, capacity);\n    };\n    /**\n     * Get contacts between particles\n     * Contact data can be used for many reasons, for example to\n     * trigger rendering or audio effects.\n     */\n    b2ParticleSystem.prototype.GetContacts = function () {\n        return this.m_contactBuffer.data;\n    };\n    b2ParticleSystem.prototype.GetContactCount = function () {\n        return this.m_contactBuffer.count;\n    };\n    /**\n     * Get contacts between particles and bodies\n     *\n     * Contact data can be used for many reasons, for example to\n     * trigger rendering or audio effects.\n     */\n    b2ParticleSystem.prototype.GetBodyContacts = function () {\n        return this.m_bodyContactBuffer.data;\n    };\n    b2ParticleSystem.prototype.GetBodyContactCount = function () {\n        return this.m_bodyContactBuffer.count;\n    };\n    /**\n     * Get array of particle pairs. The particles in a pair:\n     *   (1) are contacting,\n     *   (2) are in the same particle group,\n     *   (3) are part of a rigid particle group, or are spring, elastic,\n     *       or wall particles.\n     *   (4) have at least one particle that is a spring or barrier\n     *       particle (i.e. one of the types in k_pairFlags),\n     *   (5) have at least one particle that returns true for\n     *       ConnectionFilter::IsNecessary,\n     *   (6) are not zombie particles.\n     *\n     * Essentially, this is an array of spring or barrier particles\n     * that are interacting. The array is sorted by b2ParticlePair's\n     * indexA, and then indexB. There are no duplicate entries.\n     */\n    b2ParticleSystem.prototype.GetPairs = function () {\n        return this.m_pairBuffer.data;\n    };\n    b2ParticleSystem.prototype.GetPairCount = function () {\n        return this.m_pairBuffer.count;\n    };\n    /**\n     * Get array of particle triads. The particles in a triad:\n     *   (1) are in the same particle group,\n     *   (2) are in a Voronoi triangle together,\n     *   (3) are within b2_maxTriadDistance particle diameters of each\n     *       other,\n     *   (4) return true for ConnectionFilter::ShouldCreateTriad\n     *   (5) have at least one particle of type elastic (i.e. one of the\n     *       types in k_triadFlags),\n     *   (6) are part of a rigid particle group, or are spring, elastic,\n     *       or wall particles.\n     *   (7) are not zombie particles.\n     *\n     * Essentially, this is an array of elastic particles that are\n     * interacting. The array is sorted by b2ParticleTriad's indexA,\n     * then indexB, then indexC. There are no duplicate entries.\n     */\n    b2ParticleSystem.prototype.GetTriads = function () {\n        return this.m_triadBuffer.data;\n    };\n    b2ParticleSystem.prototype.GetTriadCount = function () {\n        return this.m_triadBuffer.count;\n    };\n    /**\n     * Set an optional threshold for the maximum number of\n     * consecutive particle iterations that a particle may contact\n     * multiple bodies before it is considered a candidate for being\n     * \"stuck\". Setting to zero or less disables.\n     */\n    b2ParticleSystem.prototype.SetStuckThreshold = function (steps) {\n        this.m_stuckThreshold = steps;\n        if (steps > 0) {\n            this.m_lastBodyContactStepBuffer.data = this.RequestBuffer(this.m_lastBodyContactStepBuffer.data);\n            this.m_bodyContactCountBuffer.data = this.RequestBuffer(this.m_bodyContactCountBuffer.data);\n            this.m_consecutiveContactStepsBuffer.data = this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data);\n        }\n    };\n    /**\n     * Get potentially stuck particles from the last step; the user\n     * must decide if they are stuck or not, and if so, delete or\n     * move them\n     */\n    b2ParticleSystem.prototype.GetStuckCandidates = function () {\n        /// return m_stuckParticleBuffer.Data();\n        return this.m_stuckParticleBuffer.Data();\n    };\n    /**\n     * Get the number of stuck particle candidates from the last\n     * step.\n     */\n    b2ParticleSystem.prototype.GetStuckCandidateCount = function () {\n        /// return m_stuckParticleBuffer.GetCount();\n        return this.m_stuckParticleBuffer.GetCount();\n    };\n    /**\n     * Compute the kinetic energy that can be lost by damping force\n     */\n    b2ParticleSystem.prototype.ComputeCollisionEnergy = function () {\n        var s_v = b2ParticleSystem.ComputeCollisionEnergy_s_v;\n        var vel_data = this.m_velocityBuffer.data;\n        var sum_v2 = 0;\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var n = contact.normal;\n            /// b2Vec2 v = m_velocityBuffer.data[b] - m_velocityBuffer.data[a];\n            var v = b2Math_1.b2Vec2.SubVV(vel_data[b], vel_data[a], s_v);\n            var vn = b2Math_1.b2Vec2.DotVV(v, n);\n            if (vn < 0) {\n                sum_v2 += vn * vn;\n            }\n        }\n        return 0.5 * this.GetParticleMass() * sum_v2;\n    };\n    /**\n     * Set strict Particle/Body contact check.\n     *\n     * This is an option that will help ensure correct behavior if\n     * there are corners in the world model where Particle/Body\n     * contact is ambiguous. This option scales at n*log(n) of the\n     * number of Particle/Body contacts, so it is best to only\n     * enable if it is necessary for your geometry. Enable if you\n     * see strange particle behavior around b2Body intersections.\n     */\n    b2ParticleSystem.prototype.SetStrictContactCheck = function (enabled) {\n        this.m_def.strictContactCheck = enabled;\n    };\n    /**\n     * Get the status of the strict contact check.\n     */\n    b2ParticleSystem.prototype.GetStrictContactCheck = function () {\n        return this.m_def.strictContactCheck;\n    };\n    /**\n     * Set the lifetime (in seconds) of a particle relative to the\n     * current time.  A lifetime of less than or equal to 0.0f\n     * results in the particle living forever until it's manually\n     * destroyed by the application.\n     */\n    b2ParticleSystem.prototype.SetParticleLifetime = function (index, lifetime) {\n        b2Assert(this.ValidateParticleIndex(index));\n        var initializeExpirationTimes = this.m_indexByExpirationTimeBuffer.data === null;\n        this.m_expirationTimeBuffer.data = this.RequestBuffer(this.m_expirationTimeBuffer.data);\n        this.m_indexByExpirationTimeBuffer.data = this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data);\n        // Initialize the inverse mapping buffer.\n        if (initializeExpirationTimes) {\n            var particleCount = this.GetParticleCount();\n            for (var i = 0; i < particleCount; ++i) {\n                this.m_indexByExpirationTimeBuffer.data[i] = i;\n            }\n        }\n        /// const int32 quantizedLifetime = (int32)(lifetime / m_def.lifetimeGranularity);\n        var quantizedLifetime = lifetime / this.m_def.lifetimeGranularity;\n        // Use a negative lifetime so that it's possible to track which\n        // of the infinite lifetime particles are older.\n        var newExpirationTime = quantizedLifetime > 0.0 ? this.GetQuantizedTimeElapsed() + quantizedLifetime : quantizedLifetime;\n        if (newExpirationTime !== this.m_expirationTimeBuffer.data[index]) {\n            this.m_expirationTimeBuffer.data[index] = newExpirationTime;\n            this.m_expirationTimeBufferRequiresSorting = true;\n        }\n    };\n    /**\n     * Get the lifetime (in seconds) of a particle relative to the\n     * current time.  A value > 0.0f is returned if the particle is\n     * scheduled to be destroyed in the future, values <= 0.0f\n     * indicate the particle has an infinite lifetime.\n     */\n    b2ParticleSystem.prototype.GetParticleLifetime = function (index) {\n        b2Assert(this.ValidateParticleIndex(index));\n        return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[index]);\n    };\n    /**\n     * Enable / disable destruction of particles in CreateParticle()\n     * when no more particles can be created due to a prior call to\n     * SetMaxParticleCount().  When this is enabled, the oldest\n     * particle is destroyed in CreateParticle() favoring the\n     * destruction of particles with a finite lifetime over\n     * particles with infinite lifetimes. This feature is enabled by\n     * default when particle lifetimes are tracked.  Explicitly\n     * enabling this feature using this function enables particle\n     * lifetime tracking.\n     */\n    b2ParticleSystem.prototype.SetDestructionByAge = function (enable) {\n        if (enable) {\n            this.GetExpirationTimeBuffer();\n        }\n        this.m_def.destroyByAge = enable;\n    };\n    /**\n     * Get whether the oldest particle will be destroyed in\n     * CreateParticle() when the maximum number of particles are\n     * present in the system.\n     */\n    b2ParticleSystem.prototype.GetDestructionByAge = function () {\n        return this.m_def.destroyByAge;\n    };\n    /**\n     * Get the array of particle expiration times indexed by\n     * particle index.\n     *\n     * GetParticleCount() items are in the returned array.\n     */\n    b2ParticleSystem.prototype.GetExpirationTimeBuffer = function () {\n        this.m_expirationTimeBuffer.data = this.RequestBuffer(this.m_expirationTimeBuffer.data);\n        return this.m_expirationTimeBuffer.data;\n    };\n    /**\n     * Convert a expiration time value in returned by\n     * GetExpirationTimeBuffer() to a time in seconds relative to\n     * the current simulation time.\n     */\n    b2ParticleSystem.prototype.ExpirationTimeToLifetime = function (expirationTime) {\n        return (expirationTime > 0 ?\n            expirationTime - this.GetQuantizedTimeElapsed() :\n            expirationTime) * this.m_def.lifetimeGranularity;\n    };\n    /**\n     * Get the array of particle indices ordered by reverse\n     * lifetime. The oldest particle indexes are at the end of the\n     * array with the newest at the start.  Particles with infinite\n     * lifetimes (i.e expiration times less than or equal to 0) are\n     * placed at the start of the array.\n     * ExpirationTimeToLifetime(GetExpirationTimeBuffer()[index]) is\n     * equivalent to GetParticleLifetime(index).\n     *\n     * GetParticleCount() items are in the returned array.\n     */\n    b2ParticleSystem.prototype.GetIndexByExpirationTimeBuffer = function () {\n        // If particles are present, initialize / reinitialize the lifetime buffer.\n        if (this.GetParticleCount()) {\n            this.SetParticleLifetime(0, this.GetParticleLifetime(0));\n        }\n        else {\n            this.m_indexByExpirationTimeBuffer.data = this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data);\n        }\n        return this.m_indexByExpirationTimeBuffer.data;\n    };\n    /**\n     * Apply an impulse to one particle. This immediately modifies\n     * the velocity. Similar to b2Body::ApplyLinearImpulse.\n     *\n     * @param index the particle that will be modified.\n     * @param impulse impulse the world impulse vector, usually in N-seconds or kg-m/s.\n     */\n    b2ParticleSystem.prototype.ParticleApplyLinearImpulse = function (index, impulse) {\n        this.ApplyLinearImpulse(index, index + 1, impulse);\n    };\n    /**\n     * Apply an impulse to all particles between 'firstIndex' and\n     * 'lastIndex'. This immediately modifies the velocity. Note\n     * that the impulse is applied to the total mass of all\n     * particles. So, calling ParticleApplyLinearImpulse(0, impulse)\n     * and ParticleApplyLinearImpulse(1, impulse) will impart twice\n     * as much velocity as calling just ApplyLinearImpulse(0, 1,\n     * impulse).\n     *\n     * @param firstIndex the first particle to be modified.\n     * @param lastIndex the last particle to be modified.\n     * @param impulse the world impulse vector, usually in N-seconds or kg-m/s.\n     */\n    b2ParticleSystem.prototype.ApplyLinearImpulse = function (firstIndex, lastIndex, impulse) {\n        var vel_data = this.m_velocityBuffer.data;\n        var numParticles = (lastIndex - firstIndex);\n        var totalMass = numParticles * this.GetParticleMass();\n        /// const b2Vec2 velocityDelta = impulse / totalMass;\n        var velocityDelta = impulse.Clone().SelfMul(1 / totalMass);\n        for (var i = firstIndex; i < lastIndex; i++) {\n            /// m_velocityBuffer.data[i] += velocityDelta;\n            vel_data[i].SelfAdd(velocityDelta);\n        }\n    };\n    b2ParticleSystem.IsSignificantForce = function (force) {\n        return force.x !== 0 || force.y !== 0;\n    };\n    /**\n     * Apply a force to the center of a particle.\n     *\n     * @param index the particle that will be modified.\n     * @param force the world force vector, usually in Newtons (N).\n     */\n    b2ParticleSystem.prototype.ParticleApplyForce = function (index, force) {\n        if (b2ParticleSystem.IsSignificantForce(force) &&\n            this.ForceCanBeApplied(this.m_flagsBuffer.data[index])) {\n            this.PrepareForceBuffer();\n            /// m_forceBuffer[index] += force;\n            this.m_forceBuffer[index].SelfAdd(force);\n        }\n    };\n    /**\n     * Distribute a force across several particles. The particles\n     * must not be wall particles. Note that the force is\n     * distributed across all the particles, so calling this\n     * function for indices 0..N is not the same as calling\n     * ParticleApplyForce(i, force) for i in 0..N.\n     *\n     * @param firstIndex the first particle to be modified.\n     * @param lastIndex the last particle to be modified.\n     * @param force the world force vector, usually in Newtons (N).\n     */\n    b2ParticleSystem.prototype.ApplyForce = function (firstIndex, lastIndex, force) {\n        // Ensure we're not trying to apply force to particles that can't move,\n        // such as wall particles.\n        // #if B2_ASSERT_ENABLED\n        /// let flags = 0;\n        /// for (let i = firstIndex; i < lastIndex; i++) {\n        /// flags |= this.m_flagsBuffer.data[i];\n        /// }\n        /// b2Assert(this.ForceCanBeApplied(flags));\n        // #endif\n        // Early out if force does nothing (optimization).\n        /// const b2Vec2 distributedForce = force / (float32)(lastIndex - firstIndex);\n        var distributedForce = force.Clone().SelfMul(1 / (lastIndex - firstIndex));\n        if (b2ParticleSystem.IsSignificantForce(distributedForce)) {\n            this.PrepareForceBuffer();\n            // Distribute the force over all the particles.\n            for (var i = firstIndex; i < lastIndex; i++) {\n                /// m_forceBuffer[i] += distributedForce;\n                this.m_forceBuffer[i].SelfAdd(distributedForce);\n            }\n        }\n    };\n    /**\n     * Get the next particle-system in the world's particle-system\n     * list.\n     */\n    b2ParticleSystem.prototype.GetNext = function () {\n        return this.m_next;\n    };\n    /**\n     * Query the particle system for all particles that potentially\n     * overlap the provided AABB.\n     * b2QueryCallback::ShouldQueryParticleSystem is ignored.\n     *\n     * @param callback a user implemented callback class.\n     * @param aabb the query box.\n     */\n    b2ParticleSystem.prototype.QueryAABB = function (callback, aabb) {\n        if (this.m_proxyBuffer.count === 0) {\n            return;\n        }\n        var beginProxy = 0;\n        var endProxy = this.m_proxyBuffer.count;\n        var firstProxy = std_lower_bound(this.m_proxyBuffer.data, beginProxy, endProxy, b2ParticleSystem.computeTag(this.m_inverseDiameter * aabb.lowerBound.x, this.m_inverseDiameter * aabb.lowerBound.y), b2ParticleSystem.Proxy.CompareProxyTag);\n        var lastProxy = std_upper_bound(this.m_proxyBuffer.data, firstProxy, endProxy, b2ParticleSystem.computeTag(this.m_inverseDiameter * aabb.upperBound.x, this.m_inverseDiameter * aabb.upperBound.y), b2ParticleSystem.Proxy.CompareTagProxy);\n        var pos_data = this.m_positionBuffer.data;\n        for (var k = firstProxy; k < lastProxy; ++k) {\n            var proxy = this.m_proxyBuffer.data[k];\n            var i = proxy.index;\n            var p = pos_data[i];\n            if (aabb.lowerBound.x < p.x && p.x < aabb.upperBound.x &&\n                aabb.lowerBound.y < p.y && p.y < aabb.upperBound.y) {\n                if (!callback.ReportParticle(this, i)) {\n                    break;\n                }\n            }\n        }\n    };\n    /**\n     * Query the particle system for all particles that potentially\n     * overlap the provided shape's AABB. Calls QueryAABB\n     * internally. b2QueryCallback::ShouldQueryParticleSystem is\n     * ignored.\n     *\n     * @param callback a user implemented callback class.\n     * @param shape the query shape\n     * @param xf the transform of the AABB\n     * @param childIndex\n     */\n    b2ParticleSystem.prototype.QueryShapeAABB = function (callback, shape, xf, childIndex) {\n        if (childIndex === void 0) { childIndex = 0; }\n        var s_aabb = b2ParticleSystem.QueryShapeAABB_s_aabb;\n        var aabb = s_aabb;\n        shape.ComputeAABB(aabb, xf, childIndex);\n        this.QueryAABB(callback, aabb);\n    };\n    b2ParticleSystem.prototype.QueryPointAABB = function (callback, point, slop) {\n        if (slop === void 0) { slop = b2Settings_1.b2_linearSlop; }\n        var s_aabb = b2ParticleSystem.QueryPointAABB_s_aabb;\n        var aabb = s_aabb;\n        aabb.lowerBound.Set(point.x - slop, point.y - slop);\n        aabb.upperBound.Set(point.x + slop, point.y + slop);\n        this.QueryAABB(callback, aabb);\n    };\n    /**\n     * Ray-cast the particle system for all particles in the path of\n     * the ray. Your callback controls whether you get the closest\n     * point, any point, or n-points. The ray-cast ignores particles\n     * that contain the starting point.\n     * b2RayCastCallback::ShouldQueryParticleSystem is ignored.\n     *\n     * @param callback a user implemented callback class.\n     * @param point1 the ray starting point\n     * @param point2 the ray ending point\n     */\n    b2ParticleSystem.prototype.RayCast = function (callback, point1, point2) {\n        var s_aabb = b2ParticleSystem.RayCast_s_aabb;\n        var s_p = b2ParticleSystem.RayCast_s_p;\n        var s_v = b2ParticleSystem.RayCast_s_v;\n        var s_n = b2ParticleSystem.RayCast_s_n;\n        var s_point = b2ParticleSystem.RayCast_s_point;\n        if (this.m_proxyBuffer.count === 0) {\n            return;\n        }\n        var pos_data = this.m_positionBuffer.data;\n        var aabb = s_aabb;\n        b2Math_1.b2Vec2.MinV(point1, point2, aabb.lowerBound);\n        b2Math_1.b2Vec2.MaxV(point1, point2, aabb.upperBound);\n        var fraction = 1;\n        // solving the following equation:\n        // ((1-t)*point1+t*point2-position)^2=diameter^2\n        // where t is a potential fraction\n        /// b2Vec2 v = point2 - point1;\n        var v = b2Math_1.b2Vec2.SubVV(point2, point1, s_v);\n        var v2 = b2Math_1.b2Vec2.DotVV(v, v);\n        var enumerator = this.GetInsideBoundsEnumerator(aabb);\n        var i;\n        // tslint:disable-next-line:no-conditional-assignment\n        while ((i = enumerator.GetNext()) >= 0) {\n            /// b2Vec2 p = point1 - m_positionBuffer.data[i];\n            var p = b2Math_1.b2Vec2.SubVV(point1, pos_data[i], s_p);\n            var pv = b2Math_1.b2Vec2.DotVV(p, v);\n            var p2 = b2Math_1.b2Vec2.DotVV(p, p);\n            var determinant = pv * pv - v2 * (p2 - this.m_squaredDiameter);\n            if (determinant >= 0) {\n                var sqrtDeterminant = b2Math_1.b2Sqrt(determinant);\n                // find a solution between 0 and fraction\n                var t = (-pv - sqrtDeterminant) / v2;\n                if (t > fraction) {\n                    continue;\n                }\n                if (t < 0) {\n                    t = (-pv + sqrtDeterminant) / v2;\n                    if (t < 0 || t > fraction) {\n                        continue;\n                    }\n                }\n                /// b2Vec2 n = p + t * v;\n                var n = b2Math_1.b2Vec2.AddVMulSV(p, t, v, s_n);\n                n.Normalize();\n                /// float32 f = callback.ReportParticle(this, i, point1 + t * v, n, t);\n                var f = callback.ReportParticle(this, i, b2Math_1.b2Vec2.AddVMulSV(point1, t, v, s_point), n, t);\n                fraction = b2Math_1.b2Min(fraction, f);\n                if (fraction <= 0) {\n                    break;\n                }\n            }\n        }\n    };\n    /**\n     * Compute the axis-aligned bounding box for all particles\n     * contained within this particle system.\n     * @param aabb Returns the axis-aligned bounding box of the system.\n     */\n    b2ParticleSystem.prototype.ComputeAABB = function (aabb) {\n        var particleCount = this.GetParticleCount();\n        b2Assert(aabb !== null);\n        aabb.lowerBound.x = +b2Settings_1.b2_maxFloat;\n        aabb.lowerBound.y = +b2Settings_1.b2_maxFloat;\n        aabb.upperBound.x = -b2Settings_1.b2_maxFloat;\n        aabb.upperBound.y = -b2Settings_1.b2_maxFloat;\n        var pos_data = this.m_positionBuffer.data;\n        for (var i = 0; i < particleCount; i++) {\n            var p = pos_data[i];\n            b2Math_1.b2Vec2.MinV(aabb.lowerBound, p, aabb.lowerBound);\n            b2Math_1.b2Vec2.MaxV(aabb.upperBound, p, aabb.upperBound);\n        }\n        aabb.lowerBound.x -= this.m_particleDiameter;\n        aabb.lowerBound.y -= this.m_particleDiameter;\n        aabb.upperBound.x += this.m_particleDiameter;\n        aabb.upperBound.y += this.m_particleDiameter;\n    };\n    b2ParticleSystem.prototype.FreeBuffer = function (b, capacity) {\n        if (b === null) {\n            return;\n        }\n        b.length = 0;\n    };\n    b2ParticleSystem.prototype.FreeUserOverridableBuffer = function (b) {\n        if (b.userSuppliedCapacity === 0) {\n            this.FreeBuffer(b.data, this.m_internalAllocatedCapacity);\n        }\n    };\n    /**\n     * Reallocate a buffer\n     */\n    b2ParticleSystem.prototype.ReallocateBuffer3 = function (oldBuffer, oldCapacity, newCapacity) {\n        b2Assert(newCapacity > oldCapacity);\n        var newBuffer = (oldBuffer) ? oldBuffer.slice() : [];\n        newBuffer.length = newCapacity;\n        return newBuffer;\n    };\n    /**\n     * Reallocate a buffer\n     */\n    b2ParticleSystem.prototype.ReallocateBuffer5 = function (buffer, userSuppliedCapacity, oldCapacity, newCapacity, deferred) {\n        b2Assert(newCapacity > oldCapacity);\n        // A 'deferred' buffer is reallocated only if it is not NULL.\n        // If 'userSuppliedCapacity' is not zero, buffer is user supplied and must\n        // be kept.\n        b2Assert(!userSuppliedCapacity || newCapacity <= userSuppliedCapacity);\n        if ((!deferred || buffer) && !userSuppliedCapacity) {\n            buffer = this.ReallocateBuffer3(buffer, oldCapacity, newCapacity);\n        }\n        return buffer;\n    };\n    /**\n     * Reallocate a buffer\n     */\n    b2ParticleSystem.prototype.ReallocateBuffer4 = function (buffer, oldCapacity, newCapacity, deferred) {\n        b2Assert(newCapacity > oldCapacity);\n        return this.ReallocateBuffer5(buffer.data, buffer.userSuppliedCapacity, oldCapacity, newCapacity, deferred);\n    };\n    b2ParticleSystem.prototype.RequestBuffer = function (buffer) {\n        if (!buffer) {\n            if (this.m_internalAllocatedCapacity === 0) {\n                this.ReallocateInternalAllocatedBuffers(b2Settings_1.b2_minParticleSystemBufferCapacity);\n            }\n            buffer = [];\n            buffer.length = this.m_internalAllocatedCapacity;\n        }\n        return buffer;\n    };\n    /**\n     * Reallocate the handle / index map and schedule the allocation\n     * of a new pool for handle allocation.\n     */\n    b2ParticleSystem.prototype.ReallocateHandleBuffers = function (newCapacity) {\n        b2Assert(newCapacity > this.m_internalAllocatedCapacity);\n        // Reallocate a new handle / index map buffer, copying old handle pointers\n        // is fine since they're kept around.\n        this.m_handleIndexBuffer.data = this.ReallocateBuffer4(this.m_handleIndexBuffer, this.m_internalAllocatedCapacity, newCapacity, true);\n        // Set the size of the next handle allocation.\n        /// this.m_handleAllocator.SetItemsPerSlab(newCapacity - this.m_internalAllocatedCapacity);\n    };\n    b2ParticleSystem.prototype.ReallocateInternalAllocatedBuffers = function (capacity) {\n        // tslint:disable-next-line:no-shadowed-variable\n        function LimitCapacity(capacity, maxCount) {\n            return maxCount && capacity > maxCount ? maxCount : capacity;\n        }\n        // Don't increase capacity beyond the smallest user-supplied buffer size.\n        capacity = LimitCapacity(capacity, this.m_def.maxCount);\n        capacity = LimitCapacity(capacity, this.m_flagsBuffer.userSuppliedCapacity);\n        capacity = LimitCapacity(capacity, this.m_positionBuffer.userSuppliedCapacity);\n        capacity = LimitCapacity(capacity, this.m_velocityBuffer.userSuppliedCapacity);\n        capacity = LimitCapacity(capacity, this.m_colorBuffer.userSuppliedCapacity);\n        capacity = LimitCapacity(capacity, this.m_userDataBuffer.userSuppliedCapacity);\n        if (this.m_internalAllocatedCapacity < capacity) {\n            this.ReallocateHandleBuffers(capacity);\n            this.m_flagsBuffer.data = this.ReallocateBuffer4(this.m_flagsBuffer, this.m_internalAllocatedCapacity, capacity, false);\n            // Conditionally defer these as they are optional if the feature is\n            // not enabled.\n            var stuck = this.m_stuckThreshold > 0;\n            this.m_lastBodyContactStepBuffer.data = this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer, this.m_internalAllocatedCapacity, capacity, stuck);\n            this.m_bodyContactCountBuffer.data = this.ReallocateBuffer4(this.m_bodyContactCountBuffer, this.m_internalAllocatedCapacity, capacity, stuck);\n            this.m_consecutiveContactStepsBuffer.data = this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer, this.m_internalAllocatedCapacity, capacity, stuck);\n            this.m_positionBuffer.data = this.ReallocateBuffer4(this.m_positionBuffer, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_velocityBuffer.data = this.ReallocateBuffer4(this.m_velocityBuffer, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_forceBuffer = this.ReallocateBuffer5(this.m_forceBuffer, 0, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_weightBuffer = this.ReallocateBuffer5(this.m_weightBuffer, 0, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_staticPressureBuffer = this.ReallocateBuffer5(this.m_staticPressureBuffer, 0, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_accumulationBuffer = this.ReallocateBuffer5(this.m_accumulationBuffer, 0, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_accumulation2Buffer = this.ReallocateBuffer5(this.m_accumulation2Buffer, 0, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_depthBuffer = this.ReallocateBuffer5(this.m_depthBuffer, 0, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_colorBuffer.data = this.ReallocateBuffer4(this.m_colorBuffer, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_groupBuffer = this.ReallocateBuffer5(this.m_groupBuffer, 0, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_userDataBuffer.data = this.ReallocateBuffer4(this.m_userDataBuffer, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_expirationTimeBuffer.data = this.ReallocateBuffer4(this.m_expirationTimeBuffer, this.m_internalAllocatedCapacity, capacity, true);\n            this.m_indexByExpirationTimeBuffer.data = this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer, this.m_internalAllocatedCapacity, capacity, false);\n            this.m_internalAllocatedCapacity = capacity;\n        }\n    };\n    b2ParticleSystem.prototype.CreateParticleForGroup = function (groupDef, xf, p) {\n        var particleDef = new b2Particle_1.b2ParticleDef();\n        particleDef.flags = groupDef.flags;\n        /// particleDef.position = b2Mul(xf, p);\n        b2Math_1.b2Transform.MulXV(xf, p, particleDef.position);\n        /// particleDef.velocity =\n        ///  groupDef.linearVelocity +\n        ///  b2Cross(groupDef.angularVelocity,\n        ///      particleDef.position - groupDef.position);\n        b2Math_1.b2Vec2.AddVV(groupDef.linearVelocity, b2Math_1.b2Vec2.CrossSV(groupDef.angularVelocity, b2Math_1.b2Vec2.SubVV(particleDef.position, groupDef.position, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Vec2.s_t0), particleDef.velocity);\n        particleDef.color.Copy(groupDef.color);\n        particleDef.lifetime = groupDef.lifetime;\n        particleDef.userData = groupDef.userData;\n        this.CreateParticle(particleDef);\n    };\n    b2ParticleSystem.prototype.CreateParticlesStrokeShapeForGroup = function (shape, groupDef, xf) {\n        var s_edge = b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge;\n        var s_d = b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d;\n        var s_p = b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p;\n        var stride = groupDef.stride;\n        if (stride === 0) {\n            stride = this.GetParticleStride();\n        }\n        var positionOnEdge = 0;\n        var childCount = shape.GetChildCount();\n        for (var childIndex = 0; childIndex < childCount; childIndex++) {\n            var edge = null;\n            if (shape.GetType() === b2Shape_1.b2ShapeType.e_edgeShape) {\n                edge = shape;\n            }\n            else {\n                b2Assert(shape.GetType() === b2Shape_1.b2ShapeType.e_chainShape);\n                edge = s_edge;\n                shape.GetChildEdge(edge, childIndex);\n            }\n            var d = b2Math_1.b2Vec2.SubVV(edge.m_vertex2, edge.m_vertex1, s_d);\n            var edgeLength = d.Length();\n            while (positionOnEdge < edgeLength) {\n                /// b2Vec2 p = edge.m_vertex1 + positionOnEdge / edgeLength * d;\n                var p = b2Math_1.b2Vec2.AddVMulSV(edge.m_vertex1, positionOnEdge / edgeLength, d, s_p);\n                this.CreateParticleForGroup(groupDef, xf, p);\n                positionOnEdge += stride;\n            }\n            positionOnEdge -= edgeLength;\n        }\n    };\n    b2ParticleSystem.prototype.CreateParticlesFillShapeForGroup = function (shape, groupDef, xf) {\n        var s_aabb = b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb;\n        var s_p = b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p;\n        var stride = groupDef.stride;\n        if (stride === 0) {\n            stride = this.GetParticleStride();\n        }\n        /// b2Transform identity;\n        /// identity.SetIdentity();\n        var identity = b2Math_1.b2Transform.IDENTITY;\n        var aabb = s_aabb;\n        b2Assert(shape.GetChildCount() === 1);\n        shape.ComputeAABB(aabb, identity, 0);\n        for (var y = Math.floor(aabb.lowerBound.y / stride) * stride; y < aabb.upperBound.y; y += stride) {\n            for (var x = Math.floor(aabb.lowerBound.x / stride) * stride; x < aabb.upperBound.x; x += stride) {\n                var p = s_p.Set(x, y);\n                if (shape.TestPoint(identity, p)) {\n                    this.CreateParticleForGroup(groupDef, xf, p);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.CreateParticlesWithShapeForGroup = function (shape, groupDef, xf) {\n        switch (shape.GetType()) {\n            case b2Shape_1.b2ShapeType.e_edgeShape:\n            case b2Shape_1.b2ShapeType.e_chainShape:\n                this.CreateParticlesStrokeShapeForGroup(shape, groupDef, xf);\n                break;\n            case b2Shape_1.b2ShapeType.e_polygonShape:\n            case b2Shape_1.b2ShapeType.e_circleShape:\n                this.CreateParticlesFillShapeForGroup(shape, groupDef, xf);\n                break;\n            default:\n                b2Assert(false);\n                break;\n        }\n    };\n    b2ParticleSystem.prototype.CreateParticlesWithShapesForGroup = function (shapes, shapeCount, groupDef, xf) {\n        var compositeShape = new b2ParticleSystem.CompositeShape(shapes, shapeCount);\n        this.CreateParticlesFillShapeForGroup(compositeShape, groupDef, xf);\n    };\n    b2ParticleSystem.prototype.CloneParticle = function (oldIndex, group) {\n        var def = new b2Particle_1.b2ParticleDef();\n        def.flags = this.m_flagsBuffer.data[oldIndex];\n        def.position.Copy(this.m_positionBuffer.data[oldIndex]);\n        def.velocity.Copy(this.m_velocityBuffer.data[oldIndex]);\n        if (this.m_colorBuffer.data) {\n            def.color.Copy(this.m_colorBuffer.data[oldIndex]);\n        }\n        if (this.m_userDataBuffer.data) {\n            def.userData = this.m_userDataBuffer.data[oldIndex];\n        }\n        def.group = group;\n        var newIndex = this.CreateParticle(def);\n        if (this.m_handleIndexBuffer.data) {\n            var handle = this.m_handleIndexBuffer.data[oldIndex];\n            if (handle) {\n                handle.SetIndex(newIndex);\n            }\n            this.m_handleIndexBuffer.data[newIndex] = handle;\n            this.m_handleIndexBuffer.data[oldIndex] = null;\n        }\n        if (this.m_lastBodyContactStepBuffer.data) {\n            this.m_lastBodyContactStepBuffer.data[newIndex] =\n                this.m_lastBodyContactStepBuffer.data[oldIndex];\n        }\n        if (this.m_bodyContactCountBuffer.data) {\n            this.m_bodyContactCountBuffer.data[newIndex] =\n                this.m_bodyContactCountBuffer.data[oldIndex];\n        }\n        if (this.m_consecutiveContactStepsBuffer.data) {\n            this.m_consecutiveContactStepsBuffer.data[newIndex] =\n                this.m_consecutiveContactStepsBuffer.data[oldIndex];\n        }\n        if (this.m_hasForce) {\n            this.m_forceBuffer[newIndex].Copy(this.m_forceBuffer[oldIndex]);\n        }\n        if (this.m_staticPressureBuffer) {\n            this.m_staticPressureBuffer[newIndex] = this.m_staticPressureBuffer[oldIndex];\n        }\n        if (this.m_depthBuffer) {\n            this.m_depthBuffer[newIndex] = this.m_depthBuffer[oldIndex];\n        }\n        if (this.m_expirationTimeBuffer.data) {\n            this.m_expirationTimeBuffer.data[newIndex] =\n                this.m_expirationTimeBuffer.data[oldIndex];\n        }\n        return newIndex;\n    };\n    b2ParticleSystem.prototype.DestroyParticlesInGroup = function (group, callDestructionListener) {\n        if (callDestructionListener === void 0) { callDestructionListener = false; }\n        for (var i = group.m_firstIndex; i < group.m_lastIndex; i++) {\n            this.DestroyParticle(i, callDestructionListener);\n        }\n    };\n    b2ParticleSystem.prototype.DestroyParticleGroup = function (group) {\n        b2Assert(this.m_groupCount > 0);\n        b2Assert(group !== null);\n        if (this.m_world.m_destructionListener) {\n            this.m_world.m_destructionListener.SayGoodbyeParticleGroup(group);\n        }\n        this.SetGroupFlags(group, 0);\n        for (var i = group.m_firstIndex; i < group.m_lastIndex; i++) {\n            this.m_groupBuffer[i] = null;\n        }\n        if (group.m_prev) {\n            group.m_prev.m_next = group.m_next;\n        }\n        if (group.m_next) {\n            group.m_next.m_prev = group.m_prev;\n        }\n        if (group === this.m_groupList) {\n            this.m_groupList = group.m_next;\n        }\n        --this.m_groupCount;\n    };\n    b2ParticleSystem.ParticleCanBeConnected = function (flags, group) {\n        return ((flags & (b2Particle_1.b2ParticleFlag.b2_wallParticle | b2Particle_1.b2ParticleFlag.b2_springParticle | b2Particle_1.b2ParticleFlag.b2_elasticParticle)) !== 0) ||\n            ((group !== null) && ((group.GetGroupFlags() & b2ParticleGroup_1.b2ParticleGroupFlag.b2_rigidParticleGroup) !== 0));\n    };\n    b2ParticleSystem.prototype.UpdatePairsAndTriads = function (firstIndex, lastIndex, filter) {\n        var s_dab = b2ParticleSystem.UpdatePairsAndTriads_s_dab;\n        var s_dbc = b2ParticleSystem.UpdatePairsAndTriads_s_dbc;\n        var s_dca = b2ParticleSystem.UpdatePairsAndTriads_s_dca;\n        var pos_data = this.m_positionBuffer.data;\n        // Create pairs or triads.\n        // All particles in each pair/triad should satisfy the following:\n        // * firstIndex <= index < lastIndex\n        // * don't have b2_zombieParticle\n        // * ParticleCanBeConnected returns true\n        // * ShouldCreatePair/ShouldCreateTriad returns true\n        // Any particles in each pair/triad should satisfy the following:\n        // * filter.IsNeeded returns true\n        // * have one of k_pairFlags/k_triadsFlags\n        b2Assert(firstIndex <= lastIndex);\n        var particleFlags = 0;\n        for (var i = firstIndex; i < lastIndex; i++) {\n            particleFlags |= this.m_flagsBuffer.data[i];\n        }\n        if (particleFlags & b2ParticleSystem.k_pairFlags) {\n            for (var k = 0; k < this.m_contactBuffer.count; k++) {\n                var contact = this.m_contactBuffer.data[k];\n                var a = contact.indexA;\n                var b = contact.indexB;\n                var af = this.m_flagsBuffer.data[a];\n                var bf = this.m_flagsBuffer.data[b];\n                var groupA = this.m_groupBuffer[a];\n                var groupB = this.m_groupBuffer[b];\n                if (a >= firstIndex && a < lastIndex &&\n                    b >= firstIndex && b < lastIndex &&\n                    !((af | bf) & b2Particle_1.b2ParticleFlag.b2_zombieParticle) &&\n                    ((af | bf) & b2ParticleSystem.k_pairFlags) &&\n                    (filter.IsNecessary(a) || filter.IsNecessary(b)) &&\n                    b2ParticleSystem.ParticleCanBeConnected(af, groupA) &&\n                    b2ParticleSystem.ParticleCanBeConnected(bf, groupB) &&\n                    filter.ShouldCreatePair(a, b)) {\n                    /// b2ParticlePair& pair = m_pairBuffer.Append();\n                    var pair = this.m_pairBuffer.data[this.m_pairBuffer.Append()];\n                    pair.indexA = a;\n                    pair.indexB = b;\n                    pair.flags = contact.flags;\n                    pair.strength = b2Math_1.b2Min(groupA ? groupA.m_strength : 1, groupB ? groupB.m_strength : 1);\n                    /// pair.distance = b2Distance(pos_data[a], pos_data[b]); // TODO: this was wrong!\n                    pair.distance = b2Math_1.b2Vec2.DistanceVV(pos_data[a], pos_data[b]);\n                }\n                /// std::stable_sort(m_pairBuffer.Begin(), m_pairBuffer.End(), ComparePairIndices);\n                std_stable_sort(this.m_pairBuffer.data, 0, this.m_pairBuffer.count, b2ParticleSystem.ComparePairIndices);\n                /// m_pairBuffer.Unique(MatchPairIndices);\n                this.m_pairBuffer.Unique(b2ParticleSystem.MatchPairIndices);\n            }\n        }\n        if (particleFlags & b2ParticleSystem.k_triadFlags) {\n            var diagram = new b2VoronoiDiagram_1.b2VoronoiDiagram(lastIndex - firstIndex);\n            /// let necessary_count = 0;\n            for (var i = firstIndex; i < lastIndex; i++) {\n                var flags = this.m_flagsBuffer.data[i];\n                var group = this.m_groupBuffer[i];\n                if (!(flags & b2Particle_1.b2ParticleFlag.b2_zombieParticle) &&\n                    b2ParticleSystem.ParticleCanBeConnected(flags, group)) {\n                    /// if (filter.IsNecessary(i)) {\n                    /// ++necessary_count;\n                    /// }\n                    diagram.AddGenerator(pos_data[i], i, filter.IsNecessary(i));\n                }\n            }\n            /// if (necessary_count === 0) {\n            ///// debugger;\n            /// for (let i = firstIndex; i < lastIndex; i++) {\n            ///  filter.IsNecessary(i);\n            /// }\n            /// }\n            var stride = this.GetParticleStride();\n            diagram.Generate(stride / 2, stride * 2);\n            var system_1 = this;\n            var callback = /*UpdateTriadsCallback*/ function (a, b, c) {\n                var af = system_1.m_flagsBuffer.data[a];\n                var bf = system_1.m_flagsBuffer.data[b];\n                var cf = system_1.m_flagsBuffer.data[c];\n                if (((af | bf | cf) & b2ParticleSystem.k_triadFlags) &&\n                    filter.ShouldCreateTriad(a, b, c)) {\n                    var pa = pos_data[a];\n                    var pb = pos_data[b];\n                    var pc = pos_data[c];\n                    var dab = b2Math_1.b2Vec2.SubVV(pa, pb, s_dab);\n                    var dbc = b2Math_1.b2Vec2.SubVV(pb, pc, s_dbc);\n                    var dca = b2Math_1.b2Vec2.SubVV(pc, pa, s_dca);\n                    var maxDistanceSquared = b2Settings_1.b2_maxTriadDistanceSquared * system_1.m_squaredDiameter;\n                    if (b2Math_1.b2Vec2.DotVV(dab, dab) > maxDistanceSquared ||\n                        b2Math_1.b2Vec2.DotVV(dbc, dbc) > maxDistanceSquared ||\n                        b2Math_1.b2Vec2.DotVV(dca, dca) > maxDistanceSquared) {\n                        return;\n                    }\n                    var groupA = system_1.m_groupBuffer[a];\n                    var groupB = system_1.m_groupBuffer[b];\n                    var groupC = system_1.m_groupBuffer[c];\n                    /// b2ParticleTriad& triad = m_system.m_triadBuffer.Append();\n                    var triad = system_1.m_triadBuffer.data[system_1.m_triadBuffer.Append()];\n                    triad.indexA = a;\n                    triad.indexB = b;\n                    triad.indexC = c;\n                    triad.flags = af | bf | cf;\n                    triad.strength = b2Math_1.b2Min(b2Math_1.b2Min(groupA ? groupA.m_strength : 1, groupB ? groupB.m_strength : 1), groupC ? groupC.m_strength : 1);\n                    /// let midPoint = b2Vec2.MulSV(1.0 / 3.0, b2Vec2.AddVV(pa, b2Vec2.AddVV(pb, pc, new b2Vec2()), new b2Vec2()), new b2Vec2());\n                    var midPoint_x = (pa.x + pb.x + pc.x) / 3.0;\n                    var midPoint_y = (pa.y + pb.y + pc.y) / 3.0;\n                    /// triad.pa = b2Vec2.SubVV(pa, midPoint, new b2Vec2());\n                    triad.pa.x = pa.x - midPoint_x;\n                    triad.pa.y = pa.y - midPoint_y;\n                    /// triad.pb = b2Vec2.SubVV(pb, midPoint, new b2Vec2());\n                    triad.pb.x = pb.x - midPoint_x;\n                    triad.pb.y = pb.y - midPoint_y;\n                    /// triad.pc = b2Vec2.SubVV(pc, midPoint, new b2Vec2());\n                    triad.pc.x = pc.x - midPoint_x;\n                    triad.pc.y = pc.y - midPoint_y;\n                    triad.ka = -b2Math_1.b2Vec2.DotVV(dca, dab);\n                    triad.kb = -b2Math_1.b2Vec2.DotVV(dab, dbc);\n                    triad.kc = -b2Math_1.b2Vec2.DotVV(dbc, dca);\n                    triad.s = b2Math_1.b2Vec2.CrossVV(pa, pb) + b2Math_1.b2Vec2.CrossVV(pb, pc) + b2Math_1.b2Vec2.CrossVV(pc, pa);\n                }\n            };\n            diagram.GetNodes(callback);\n            /// std::stable_sort(m_triadBuffer.Begin(), m_triadBuffer.End(), CompareTriadIndices);\n            std_stable_sort(this.m_triadBuffer.data, 0, this.m_triadBuffer.count, b2ParticleSystem.CompareTriadIndices);\n            /// m_triadBuffer.Unique(MatchTriadIndices);\n            this.m_triadBuffer.Unique(b2ParticleSystem.MatchTriadIndices);\n        }\n    };\n    b2ParticleSystem.prototype.UpdatePairsAndTriadsWithReactiveParticles = function () {\n        var filter = new b2ParticleSystem.ReactiveFilter(this.m_flagsBuffer);\n        this.UpdatePairsAndTriads(0, this.m_count, filter);\n        for (var i = 0; i < this.m_count; i++) {\n            this.m_flagsBuffer.data[i] &= ~b2Particle_1.b2ParticleFlag.b2_reactiveParticle;\n        }\n        this.m_allParticleFlags &= ~b2Particle_1.b2ParticleFlag.b2_reactiveParticle;\n    };\n    b2ParticleSystem.ComparePairIndices = function (a, b) {\n        var diffA = a.indexA - b.indexA;\n        if (diffA !== 0) {\n            return diffA < 0;\n        }\n        return a.indexB < b.indexB;\n    };\n    b2ParticleSystem.MatchPairIndices = function (a, b) {\n        return a.indexA === b.indexA && a.indexB === b.indexB;\n    };\n    b2ParticleSystem.CompareTriadIndices = function (a, b) {\n        var diffA = a.indexA - b.indexA;\n        if (diffA !== 0) {\n            return diffA < 0;\n        }\n        var diffB = a.indexB - b.indexB;\n        if (diffB !== 0) {\n            return diffB < 0;\n        }\n        return a.indexC < b.indexC;\n    };\n    b2ParticleSystem.MatchTriadIndices = function (a, b) {\n        return a.indexA === b.indexA && a.indexB === b.indexB && a.indexC === b.indexC;\n    };\n    b2ParticleSystem.InitializeParticleLists = function (group, nodeBuffer) {\n        var bufferIndex = group.GetBufferIndex();\n        var particleCount = group.GetParticleCount();\n        for (var i = 0; i < particleCount; i++) {\n            var node = nodeBuffer[i];\n            node.list = node;\n            node.next = null;\n            node.count = 1;\n            node.index = i + bufferIndex;\n        }\n    };\n    b2ParticleSystem.prototype.MergeParticleListsInContact = function (group, nodeBuffer) {\n        var bufferIndex = group.GetBufferIndex();\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            /*const b2ParticleContact&*/\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            if (!group.ContainsParticle(a) || !group.ContainsParticle(b)) {\n                continue;\n            }\n            var listA = nodeBuffer[a - bufferIndex].list;\n            var listB = nodeBuffer[b - bufferIndex].list;\n            if (listA === listB) {\n                continue;\n            }\n            // To minimize the cost of insertion, make sure listA is longer than\n            // listB.\n            if (listA.count < listB.count) {\n                var _tmp = listA;\n                listA = listB;\n                listB = _tmp; /// b2Swap(listA, listB);\n            }\n            b2Assert(listA.count >= listB.count);\n            b2ParticleSystem.MergeParticleLists(listA, listB);\n        }\n    };\n    b2ParticleSystem.MergeParticleLists = function (listA, listB) {\n        // Insert listB between index 0 and 1 of listA\n        // Example:\n        //     listA => a1 => a2 => a3 => null\n        //     listB => b1 => b2 => null\n        // to\n        //     listA => listB => b1 => b2 => a1 => a2 => a3 => null\n        b2Assert(listA !== listB);\n        for (var b = listB;;) {\n            b.list = listA;\n            var nextB = b.next;\n            if (nextB) {\n                b = nextB;\n            }\n            else {\n                b.next = listA.next;\n                break;\n            }\n        }\n        listA.next = listB;\n        listA.count += listB.count;\n        listB.count = 0;\n    };\n    b2ParticleSystem.FindLongestParticleList = function (group, nodeBuffer) {\n        var particleCount = group.GetParticleCount();\n        var result = nodeBuffer[0];\n        for (var i = 0; i < particleCount; i++) {\n            var node = nodeBuffer[i];\n            if (result.count < node.count) {\n                result = node;\n            }\n        }\n        return result;\n    };\n    b2ParticleSystem.prototype.MergeZombieParticleListNodes = function (group, nodeBuffer, survivingList) {\n        var particleCount = group.GetParticleCount();\n        for (var i = 0; i < particleCount; i++) {\n            var node = nodeBuffer[i];\n            if (node !== survivingList &&\n                (this.m_flagsBuffer.data[node.index] & b2Particle_1.b2ParticleFlag.b2_zombieParticle)) {\n                b2ParticleSystem.MergeParticleListAndNode(survivingList, node);\n            }\n        }\n    };\n    b2ParticleSystem.MergeParticleListAndNode = function (list, node) {\n        // Insert node between index 0 and 1 of list\n        // Example:\n        //     list => a1 => a2 => a3 => null\n        //     node => null\n        // to\n        //     list => node => a1 => a2 => a3 => null\n        b2Assert(node !== list);\n        b2Assert(node.list === node);\n        b2Assert(node.count === 1);\n        node.list = list;\n        node.next = list.next;\n        list.next = node;\n        list.count++;\n        node.count = 0;\n    };\n    b2ParticleSystem.prototype.CreateParticleGroupsFromParticleList = function (group, nodeBuffer, survivingList) {\n        var particleCount = group.GetParticleCount();\n        var def = new b2ParticleGroup_1.b2ParticleGroupDef();\n        def.groupFlags = group.GetGroupFlags();\n        def.userData = group.GetUserData();\n        for (var i = 0; i < particleCount; i++) {\n            var list = nodeBuffer[i];\n            if (!list.count || list === survivingList) {\n                continue;\n            }\n            b2Assert(list.list === list);\n            var newGroup = this.CreateParticleGroup(def);\n            for (var node = list; node; node = node.next) {\n                var oldIndex = node.index;\n                var flags = this.m_flagsBuffer.data[oldIndex];\n                b2Assert(!(flags & b2Particle_1.b2ParticleFlag.b2_zombieParticle));\n                var newIndex = this.CloneParticle(oldIndex, newGroup);\n                this.m_flagsBuffer.data[oldIndex] |= b2Particle_1.b2ParticleFlag.b2_zombieParticle;\n                node.index = newIndex;\n            }\n        }\n    };\n    b2ParticleSystem.prototype.UpdatePairsAndTriadsWithParticleList = function (group, nodeBuffer) {\n        var bufferIndex = group.GetBufferIndex();\n        // Update indices in pairs and triads. If an index belongs to the group,\n        // replace it with the corresponding value in nodeBuffer.\n        // Note that nodeBuffer is allocated only for the group and the index should\n        // be shifted by bufferIndex.\n        for (var k = 0; k < this.m_pairBuffer.count; k++) {\n            var pair = this.m_pairBuffer.data[k];\n            var a = pair.indexA;\n            var b = pair.indexB;\n            if (group.ContainsParticle(a)) {\n                pair.indexA = nodeBuffer[a - bufferIndex].index;\n            }\n            if (group.ContainsParticle(b)) {\n                pair.indexB = nodeBuffer[b - bufferIndex].index;\n            }\n        }\n        for (var k = 0; k < this.m_triadBuffer.count; k++) {\n            var triad = this.m_triadBuffer.data[k];\n            var a = triad.indexA;\n            var b = triad.indexB;\n            var c = triad.indexC;\n            if (group.ContainsParticle(a)) {\n                triad.indexA = nodeBuffer[a - bufferIndex].index;\n            }\n            if (group.ContainsParticle(b)) {\n                triad.indexB = nodeBuffer[b - bufferIndex].index;\n            }\n            if (group.ContainsParticle(c)) {\n                triad.indexC = nodeBuffer[c - bufferIndex].index;\n            }\n        }\n    };\n    b2ParticleSystem.prototype.ComputeDepth = function () {\n        /// b2ParticleContact* contactGroups = (b2ParticleContact*) this.m_world.m_stackAllocator.Allocate(sizeof(b2ParticleContact) * this.m_contactBuffer.GetCount());\n        var contactGroups = []; // TODO: static\n        var contactGroupsCount = 0;\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var groupA = this.m_groupBuffer[a];\n            var groupB = this.m_groupBuffer[b];\n            if (groupA && groupA === groupB &&\n                (groupA.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)) {\n                contactGroups[contactGroupsCount++] = contact;\n            }\n        }\n        /// b2ParticleGroup** groupsToUpdate = (b2ParticleGroup**) this.m_world.m_stackAllocator.Allocate(sizeof(b2ParticleGroup*) * this.m_groupCount);\n        var groupsToUpdate = []; // TODO: static\n        var groupsToUpdateCount = 0;\n        for (var group = this.m_groupList; group; group = group.GetNext()) {\n            if (group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth) {\n                groupsToUpdate[groupsToUpdateCount++] = group;\n                this.SetGroupFlags(group, group.m_groupFlags &\n                    ~b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);\n                for (var i = group.m_firstIndex; i < group.m_lastIndex; i++) {\n                    this.m_accumulationBuffer[i] = 0;\n                }\n            }\n        }\n        // Compute sum of weight of contacts except between different groups.\n        for (var k = 0; k < contactGroupsCount; k++) {\n            var contact = contactGroups[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var w = contact.weight;\n            this.m_accumulationBuffer[a] += w;\n            this.m_accumulationBuffer[b] += w;\n        }\n        b2Assert(this.m_depthBuffer !== null);\n        for (var i = 0; i < groupsToUpdateCount; i++) {\n            var group = groupsToUpdate[i];\n            // tslint:disable-next-line:no-shadowed-variable\n            for (var i_1 = group.m_firstIndex; i_1 < group.m_lastIndex; i_1++) {\n                var w = this.m_accumulationBuffer[i_1];\n                this.m_depthBuffer[i_1] = w < 0.8 ? 0 : b2Settings_1.b2_maxFloat;\n            }\n        }\n        // The number of iterations is equal to particle number from the deepest\n        // particle to the nearest surface particle, and in general it is smaller\n        // than sqrt of total particle number.\n        /// int32 iterationCount = (int32)b2Sqrt((float)m_count);\n        var iterationCount = b2Math_1.b2Sqrt(this.m_count) >> 0;\n        for (var t = 0; t < iterationCount; t++) {\n            var updated = false;\n            for (var k = 0; k < contactGroupsCount; k++) {\n                var contact = contactGroups[k];\n                var a = contact.indexA;\n                var b = contact.indexB;\n                var r = 1 - contact.weight;\n                /// float32& ap0 = m_depthBuffer[a];\n                var ap0 = this.m_depthBuffer[a];\n                /// float32& bp0 = m_depthBuffer[b];\n                var bp0 = this.m_depthBuffer[b];\n                var ap1 = bp0 + r;\n                var bp1 = ap0 + r;\n                if (ap0 > ap1) {\n                    /// ap0 = ap1;\n                    this.m_depthBuffer[a] = ap1;\n                    updated = true;\n                }\n                if (bp0 > bp1) {\n                    /// bp0 = bp1;\n                    this.m_depthBuffer[b] = bp1;\n                    updated = true;\n                }\n            }\n            if (!updated) {\n                break;\n            }\n        }\n        for (var i = 0; i < groupsToUpdateCount; i++) {\n            var group = groupsToUpdate[i];\n            // tslint:disable-next-line:no-shadowed-variable\n            for (var i_2 = group.m_firstIndex; i_2 < group.m_lastIndex; i_2++) {\n                if (this.m_depthBuffer[i_2] < b2Settings_1.b2_maxFloat) {\n                    this.m_depthBuffer[i_2] *= this.m_particleDiameter;\n                }\n                else {\n                    this.m_depthBuffer[i_2] = 0;\n                }\n            }\n        }\n        /// this.m_world.m_stackAllocator.Free(groupsToUpdate);\n        /// this.m_world.m_stackAllocator.Free(contactGroups);\n    };\n    b2ParticleSystem.prototype.GetInsideBoundsEnumerator = function (aabb) {\n        var lowerTag = b2ParticleSystem.computeTag(this.m_inverseDiameter * aabb.lowerBound.x - 1, this.m_inverseDiameter * aabb.lowerBound.y - 1);\n        var upperTag = b2ParticleSystem.computeTag(this.m_inverseDiameter * aabb.upperBound.x + 1, this.m_inverseDiameter * aabb.upperBound.y + 1);\n        /// const Proxy* beginProxy = m_proxyBuffer.Begin();\n        var beginProxy = 0;\n        /// const Proxy* endProxy = m_proxyBuffer.End();\n        var endProxy = this.m_proxyBuffer.count;\n        /// const Proxy* firstProxy = std::lower_bound(beginProxy, endProxy, lowerTag);\n        var firstProxy = std_lower_bound(this.m_proxyBuffer.data, beginProxy, endProxy, lowerTag, b2ParticleSystem.Proxy.CompareProxyTag);\n        /// const Proxy* lastProxy = std::upper_bound(firstProxy, endProxy, upperTag);\n        var lastProxy = std_upper_bound(this.m_proxyBuffer.data, beginProxy, endProxy, upperTag, b2ParticleSystem.Proxy.CompareTagProxy);\n        b2Assert(beginProxy <= firstProxy);\n        b2Assert(firstProxy <= lastProxy);\n        b2Assert(lastProxy <= endProxy);\n        return new b2ParticleSystem.InsideBoundsEnumerator(this, lowerTag, upperTag, firstProxy, lastProxy);\n    };\n    b2ParticleSystem.prototype.UpdateAllParticleFlags = function () {\n        this.m_allParticleFlags = 0;\n        for (var i = 0; i < this.m_count; i++) {\n            this.m_allParticleFlags |= this.m_flagsBuffer.data[i];\n        }\n        this.m_needsUpdateAllParticleFlags = false;\n    };\n    b2ParticleSystem.prototype.UpdateAllGroupFlags = function () {\n        this.m_allGroupFlags = 0;\n        for (var group = this.m_groupList; group; group = group.GetNext()) {\n            this.m_allGroupFlags |= group.m_groupFlags;\n        }\n        this.m_needsUpdateAllGroupFlags = false;\n    };\n    b2ParticleSystem.prototype.AddContact = function (a, b, contacts) {\n        var s_d = b2ParticleSystem.AddContact_s_d;\n        var pos_data = this.m_positionBuffer.data;\n        b2Assert(contacts === this.m_contactBuffer);\n        /// b2Vec2 d = m_positionBuffer.data[b] - m_positionBuffer.data[a];\n        var d = b2Math_1.b2Vec2.SubVV(pos_data[b], pos_data[a], s_d);\n        var distBtParticlesSq = b2Math_1.b2Vec2.DotVV(d, d);\n        if (distBtParticlesSq < this.m_squaredDiameter) {\n            var invD = b2Math_1.b2InvSqrt(distBtParticlesSq);\n            if (!isFinite(invD)) {\n                invD = 1.98177537e+019;\n            }\n            /// b2ParticleContact& contact = contacts.Append();\n            var contact = this.m_contactBuffer.data[this.m_contactBuffer.Append()];\n            contact.indexA = a;\n            contact.indexB = b;\n            contact.flags = this.m_flagsBuffer.data[a] | this.m_flagsBuffer.data[b];\n            contact.weight = 1 - distBtParticlesSq * invD * this.m_inverseDiameter;\n            /// contact.SetNormal(invD * d);\n            b2Math_1.b2Vec2.MulSV(invD, d, contact.normal);\n        }\n    };\n    b2ParticleSystem.prototype.FindContacts_Reference = function (contacts) {\n        b2Assert(contacts === this.m_contactBuffer);\n        var beginProxy = 0;\n        var endProxy = this.m_proxyBuffer.count;\n        this.m_contactBuffer.count = 0;\n        for (var a = beginProxy, c = beginProxy; a < endProxy; a++) {\n            var rightTag = b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[a].tag, 1, 0);\n            for (var b = a + 1; b < endProxy; b++) {\n                if (rightTag < this.m_proxyBuffer.data[b].tag) {\n                    break;\n                }\n                this.AddContact(this.m_proxyBuffer.data[a].index, this.m_proxyBuffer.data[b].index, this.m_contactBuffer);\n            }\n            var bottomLeftTag = b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[a].tag, -1, 1);\n            for (; c < endProxy; c++) {\n                if (bottomLeftTag <= this.m_proxyBuffer.data[c].tag) {\n                    break;\n                }\n            }\n            var bottomRightTag = b2ParticleSystem.computeRelativeTag(this.m_proxyBuffer.data[a].tag, 1, 1);\n            for (var b = c; b < endProxy; b++) {\n                if (bottomRightTag < this.m_proxyBuffer.data[b].tag) {\n                    break;\n                }\n                this.AddContact(this.m_proxyBuffer.data[a].index, this.m_proxyBuffer.data[b].index, this.m_contactBuffer);\n            }\n        }\n    };\n    /// void ReorderForFindContact(FindContactInput* reordered, int alignedCount) const;\n    /// void GatherChecksOneParticle(const uint32 bound, const int startIndex, const int particleIndex, int* nextUncheckedIndex, b2GrowableBuffer<FindContactCheck>& checks) const;\n    /// void GatherChecks(b2GrowableBuffer<FindContactCheck>& checks) const;\n    /// void FindContacts_Simd(b2GrowableBuffer<b2ParticleContact>& contacts) const;\n    b2ParticleSystem.prototype.FindContacts = function (contacts) {\n        this.FindContacts_Reference(contacts);\n    };\n    /// static void UpdateProxyTags(const uint32* const tags, b2GrowableBuffer<Proxy>& proxies);\n    /// static bool ProxyBufferHasIndex(int32 index, const Proxy* const a, int count);\n    /// static int NumProxiesWithSameTag(const Proxy* const a, const Proxy* const b, int count);\n    /// static bool AreProxyBuffersTheSame(const b2GrowableBuffer<Proxy>& a, const b2GrowableBuffer<Proxy>& b);\n    b2ParticleSystem.prototype.UpdateProxies_Reference = function (proxies) {\n        b2Assert(proxies === this.m_proxyBuffer);\n        var pos_data = this.m_positionBuffer.data;\n        var inv_diam = this.m_inverseDiameter;\n        for (var k = 0; k < this.m_proxyBuffer.count; ++k) {\n            var proxy = this.m_proxyBuffer.data[k];\n            var i = proxy.index;\n            var p = pos_data[i];\n            proxy.tag = b2ParticleSystem.computeTag(inv_diam * p.x, inv_diam * p.y);\n        }\n    };\n    /// void UpdateProxies_Simd(b2GrowableBuffer<Proxy>& proxies) const;\n    b2ParticleSystem.prototype.UpdateProxies = function (proxies) {\n        this.UpdateProxies_Reference(proxies);\n    };\n    b2ParticleSystem.prototype.SortProxies = function (proxies) {\n        b2Assert(proxies === this.m_proxyBuffer);\n        /// std::sort(proxies.Begin(), proxies.End());\n        std_sort(this.m_proxyBuffer.data, 0, this.m_proxyBuffer.count, b2ParticleSystem.Proxy.CompareProxyProxy);\n    };\n    b2ParticleSystem.prototype.FilterContacts = function (contacts) {\n        // Optionally filter the contact.\n        var contactFilter = this.GetParticleContactFilter();\n        if (contactFilter === null) {\n            return;\n        }\n        /// contacts.RemoveIf(b2ParticleContactRemovePredicate(this, contactFilter));\n        b2Assert(contacts === this.m_contactBuffer);\n        var system = this;\n        var predicate = function (contact) {\n            return (contact.flags & b2Particle_1.b2ParticleFlag.b2_particleContactFilterParticle) && !contactFilter.ShouldCollideParticleParticle(system, contact.indexA, contact.indexB);\n        };\n        this.m_contactBuffer.RemoveIf(predicate);\n    };\n    b2ParticleSystem.prototype.NotifyContactListenerPreContact = function (particlePairs) {\n        var contactListener = this.GetParticleContactListener();\n        if (contactListener === null) {\n            return;\n        }\n        /// particlePairs.Initialize(m_contactBuffer.Begin(), m_contactBuffer.GetCount(), GetFlagsBuffer());\n        particlePairs.Initialize(this.m_contactBuffer, this.m_flagsBuffer);\n        throw new Error(); // TODO: notify\n    };\n    b2ParticleSystem.prototype.NotifyContactListenerPostContact = function (particlePairs) {\n        var contactListener = this.GetParticleContactListener();\n        if (contactListener === null) {\n            return;\n        }\n        // Loop through all new contacts, reporting any new ones, and\n        // \"invalidating\" the ones that still exist.\n        /// const b2ParticleContact* const endContact = m_contactBuffer.End();\n        /// for (b2ParticleContact* contact = m_contactBuffer.Begin(); contact < endContact; ++contact)\n        for (var k = 0; k < this.m_contactBuffer.count; ++k) {\n            var contact = this.m_contactBuffer.data[k];\n            /// ParticlePair pair;\n            /// pair.first = contact.GetIndexA();\n            /// pair.second = contact.GetIndexB();\n            /// const int32 itemIndex = particlePairs.Find(pair);\n            var itemIndex = -1; // TODO\n            if (itemIndex >= 0) {\n                // Already touching, ignore this contact.\n                particlePairs.Invalidate(itemIndex);\n            }\n            else {\n                // Just started touching, inform the listener.\n                contactListener.BeginContactParticleParticle(this, contact);\n            }\n        }\n        // Report particles that are no longer touching.\n        // That is, any pairs that were not invalidated above.\n        /// const int32 pairCount = particlePairs.GetCount();\n        /// const ParticlePair* const pairs = particlePairs.GetBuffer();\n        /// const int8* const valid = particlePairs.GetValidBuffer();\n        /// for (int32 i = 0; i < pairCount; ++i)\n        /// {\n        ///  if (valid[i])\n        ///  {\n        ///    contactListener.EndContactParticleParticle(this, pairs[i].first, pairs[i].second);\n        ///  }\n        /// }\n        throw new Error(); // TODO: notify\n    };\n    b2ParticleSystem.b2ParticleContactIsZombie = function (contact) {\n        return (contact.flags & b2Particle_1.b2ParticleFlag.b2_zombieParticle) === b2Particle_1.b2ParticleFlag.b2_zombieParticle;\n    };\n    b2ParticleSystem.prototype.UpdateContacts = function (exceptZombie) {\n        this.UpdateProxies(this.m_proxyBuffer);\n        this.SortProxies(this.m_proxyBuffer);\n        /// b2ParticlePairSet particlePairs(&this.m_world.m_stackAllocator);\n        var particlePairs = new b2ParticleSystem.b2ParticlePairSet(); // TODO: static\n        this.NotifyContactListenerPreContact(particlePairs);\n        this.FindContacts(this.m_contactBuffer);\n        this.FilterContacts(this.m_contactBuffer);\n        this.NotifyContactListenerPostContact(particlePairs);\n        if (exceptZombie) {\n            this.m_contactBuffer.RemoveIf(b2ParticleSystem.b2ParticleContactIsZombie);\n        }\n    };\n    b2ParticleSystem.prototype.NotifyBodyContactListenerPreContact = function (fixtureSet) {\n        var contactListener = this.GetFixtureContactListener();\n        if (contactListener === null) {\n            return;\n        }\n        /// fixtureSet.Initialize(m_bodyContactBuffer.Begin(), m_bodyContactBuffer.GetCount(), GetFlagsBuffer());\n        fixtureSet.Initialize(this.m_bodyContactBuffer, this.m_flagsBuffer);\n        throw new Error(); // TODO: notify\n    };\n    b2ParticleSystem.prototype.NotifyBodyContactListenerPostContact = function (fixtureSet) {\n        var contactListener = this.GetFixtureContactListener();\n        if (contactListener === null) {\n            return;\n        }\n        // Loop through all new contacts, reporting any new ones, and\n        // \"invalidating\" the ones that still exist.\n        /// for (b2ParticleBodyContact* contact = m_bodyContactBuffer.Begin(); contact !== m_bodyContactBuffer.End(); ++contact)\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            b2Assert(contact !== null);\n            /// FixtureParticle fixtureParticleToFind;\n            /// fixtureParticleToFind.first = contact.fixture;\n            /// fixtureParticleToFind.second = contact.index;\n            /// const int32 index = fixtureSet.Find(fixtureParticleToFind);\n            var index = -1; // TODO\n            if (index >= 0) {\n                // Already touching remove this from the set.\n                fixtureSet.Invalidate(index);\n            }\n            else {\n                // Just started touching, report it!\n                contactListener.BeginContactFixtureParticle(this, contact);\n            }\n        }\n        // If the contact listener is enabled, report all fixtures that are no\n        // longer in contact with particles.\n        /// const FixtureParticle* const fixtureParticles = fixtureSet.GetBuffer();\n        /// const int8* const fixtureParticlesValid = fixtureSet.GetValidBuffer();\n        /// const int32 fixtureParticleCount = fixtureSet.GetCount();\n        /// for (int32 i = 0; i < fixtureParticleCount; ++i)\n        /// {\n        ///  if (fixtureParticlesValid[i])\n        ///  {\n        ///    const FixtureParticle* const fixtureParticle = &fixtureParticles[i];\n        ///    contactListener.EndContactFixtureParticle(fixtureParticle.first, this, fixtureParticle.second);\n        ///  }\n        /// }\n        throw new Error(); // TODO: notify\n    };\n    b2ParticleSystem.prototype.UpdateBodyContacts = function () {\n        var s_aabb = b2ParticleSystem.UpdateBodyContacts_s_aabb;\n        // If the particle contact listener is enabled, generate a set of\n        // fixture / particle contacts.\n        /// FixtureParticleSet fixtureSet(&m_world.m_stackAllocator);\n        var fixtureSet = new b2ParticleSystem.FixtureParticleSet(); // TODO: static\n        this.NotifyBodyContactListenerPreContact(fixtureSet);\n        if (this.m_stuckThreshold > 0) {\n            var particleCount = this.GetParticleCount();\n            for (var i = 0; i < particleCount; i++) {\n                // Detect stuck particles, see comment in\n                // b2ParticleSystem::DetectStuckParticle()\n                this.m_bodyContactCountBuffer.data[i] = 0;\n                if (this.m_timestamp > (this.m_lastBodyContactStepBuffer.data[i] + 1)) {\n                    this.m_consecutiveContactStepsBuffer.data[i] = 0;\n                }\n            }\n        }\n        this.m_bodyContactBuffer.SetCount(0);\n        this.m_stuckParticleBuffer.SetCount(0);\n        var aabb = s_aabb;\n        this.ComputeAABB(aabb);\n        var callback = new b2ParticleSystem.UpdateBodyContactsCallback(this, this.GetFixtureContactFilter());\n        this.m_world.QueryAABB(callback, aabb);\n        if (this.m_def.strictContactCheck) {\n            this.RemoveSpuriousBodyContacts();\n        }\n        this.NotifyBodyContactListenerPostContact(fixtureSet);\n    };\n    b2ParticleSystem.prototype.Solve = function (step) {\n        var s_subStep = b2ParticleSystem.Solve_s_subStep;\n        if (this.m_count === 0) {\n            return;\n        }\n        // If particle lifetimes are enabled, destroy particles that are too old.\n        if (this.m_expirationTimeBuffer.data) {\n            this.SolveLifetimes(step);\n        }\n        if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_zombieParticle) {\n            this.SolveZombie();\n        }\n        if (this.m_needsUpdateAllParticleFlags) {\n            this.UpdateAllParticleFlags();\n        }\n        if (this.m_needsUpdateAllGroupFlags) {\n            this.UpdateAllGroupFlags();\n        }\n        if (this.m_paused) {\n            return;\n        }\n        for (this.m_iterationIndex = 0; this.m_iterationIndex < step.particleIterations; this.m_iterationIndex++) {\n            ++this.m_timestamp;\n            var subStep = s_subStep.Copy(step);\n            subStep.dt /= step.particleIterations;\n            subStep.inv_dt *= step.particleIterations;\n            this.UpdateContacts(false);\n            this.UpdateBodyContacts();\n            this.ComputeWeight();\n            if (this.m_allGroupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth) {\n                this.ComputeDepth();\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_reactiveParticle) {\n                this.UpdatePairsAndTriadsWithReactiveParticles();\n            }\n            if (this.m_hasForce) {\n                this.SolveForce(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_viscousParticle) {\n                this.SolveViscous();\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_repulsiveParticle) {\n                this.SolveRepulsive(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_powderParticle) {\n                this.SolvePowder(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_tensileParticle) {\n                this.SolveTensile(subStep);\n            }\n            if (this.m_allGroupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_solidParticleGroup) {\n                this.SolveSolid(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_colorMixingParticle) {\n                this.SolveColorMixing();\n            }\n            this.SolveGravity(subStep);\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_staticPressureParticle) {\n                this.SolveStaticPressure(subStep);\n            }\n            this.SolvePressure(subStep);\n            this.SolveDamping(subStep);\n            if (this.m_allParticleFlags & b2ParticleSystem.k_extraDampingFlags) {\n                this.SolveExtraDamping();\n            }\n            // SolveElastic and SolveSpring refer the current velocities for\n            // numerical stability, they should be called as late as possible.\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_elasticParticle) {\n                this.SolveElastic(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_springParticle) {\n                this.SolveSpring(subStep);\n            }\n            this.LimitVelocity(subStep);\n            if (this.m_allGroupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_rigidParticleGroup) {\n                this.SolveRigidDamping();\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_barrierParticle) {\n                this.SolveBarrier(subStep);\n            }\n            // SolveCollision, SolveRigid and SolveWall should be called after\n            // other force functions because they may require particles to have\n            // specific velocities.\n            this.SolveCollision(subStep);\n            if (this.m_allGroupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_rigidParticleGroup) {\n                this.SolveRigid(subStep);\n            }\n            if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_wallParticle) {\n                this.SolveWall();\n            }\n            // The particle positions can be updated only at the end of substep.\n            for (var i = 0; i < this.m_count; i++) {\n                /// m_positionBuffer.data[i] += subStep.dt * m_velocityBuffer.data[i];\n                this.m_positionBuffer.data[i].SelfMulAdd(subStep.dt, this.m_velocityBuffer.data[i]);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveCollision = function (step) {\n        var s_aabb = b2ParticleSystem.SolveCollision_s_aabb;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        // This function detects particles which are crossing boundary of bodies\n        // and modifies velocities of them so that they will move just in front of\n        // boundary. This function function also applies the reaction force to\n        // bodies as precisely as the numerical stability is kept.\n        var aabb = s_aabb;\n        aabb.lowerBound.x = +b2Settings_1.b2_maxFloat;\n        aabb.lowerBound.y = +b2Settings_1.b2_maxFloat;\n        aabb.upperBound.x = -b2Settings_1.b2_maxFloat;\n        aabb.upperBound.y = -b2Settings_1.b2_maxFloat;\n        for (var i = 0; i < this.m_count; i++) {\n            var v = vel_data[i];\n            var p1 = pos_data[i];\n            /// let p2 = p1 + step.dt * v;\n            var p2_x = p1.x + step.dt * v.x;\n            var p2_y = p1.y + step.dt * v.y;\n            /// aabb.lowerBound = b2Min(aabb.lowerBound, b2Min(p1, p2));\n            aabb.lowerBound.x = b2Math_1.b2Min(aabb.lowerBound.x, b2Math_1.b2Min(p1.x, p2_x));\n            aabb.lowerBound.y = b2Math_1.b2Min(aabb.lowerBound.y, b2Math_1.b2Min(p1.y, p2_y));\n            /// aabb.upperBound = b2Max(aabb.upperBound, b2Max(p1, p2));\n            aabb.upperBound.x = b2Math_1.b2Max(aabb.upperBound.x, b2Math_1.b2Max(p1.x, p2_x));\n            aabb.upperBound.y = b2Math_1.b2Max(aabb.upperBound.y, b2Math_1.b2Max(p1.y, p2_y));\n        }\n        var callback = new b2ParticleSystem.SolveCollisionCallback(this, step);\n        this.m_world.QueryAABB(callback, aabb);\n    };\n    b2ParticleSystem.prototype.LimitVelocity = function (step) {\n        var vel_data = this.m_velocityBuffer.data;\n        var criticalVelocitySquared = this.GetCriticalVelocitySquared(step);\n        for (var i = 0; i < this.m_count; i++) {\n            var v = vel_data[i];\n            var v2 = b2Math_1.b2Vec2.DotVV(v, v);\n            if (v2 > criticalVelocitySquared) {\n                /// v *= b2Sqrt(criticalVelocitySquared / v2);\n                v.SelfMul(b2Math_1.b2Sqrt(criticalVelocitySquared / v2));\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveGravity = function (step) {\n        var s_gravity = b2ParticleSystem.SolveGravity_s_gravity;\n        var vel_data = this.m_velocityBuffer.data;\n        /// b2Vec2 gravity = step.dt * m_def.gravityScale * m_world.GetGravity();\n        var gravity = b2Math_1.b2Vec2.MulSV(step.dt * this.m_def.gravityScale, this.m_world.GetGravity(), s_gravity);\n        for (var i = 0; i < this.m_count; i++) {\n            vel_data[i].SelfAdd(gravity);\n        }\n    };\n    b2ParticleSystem.prototype.SolveBarrier = function (step) {\n        var s_aabb = b2ParticleSystem.SolveBarrier_s_aabb;\n        var s_va = b2ParticleSystem.SolveBarrier_s_va;\n        var s_vb = b2ParticleSystem.SolveBarrier_s_vb;\n        var s_pba = b2ParticleSystem.SolveBarrier_s_pba;\n        var s_vba = b2ParticleSystem.SolveBarrier_s_vba;\n        var s_vc = b2ParticleSystem.SolveBarrier_s_vc;\n        var s_pca = b2ParticleSystem.SolveBarrier_s_pca;\n        var s_vca = b2ParticleSystem.SolveBarrier_s_vca;\n        var s_qba = b2ParticleSystem.SolveBarrier_s_qba;\n        var s_qca = b2ParticleSystem.SolveBarrier_s_qca;\n        var s_dv = b2ParticleSystem.SolveBarrier_s_dv;\n        var s_f = b2ParticleSystem.SolveBarrier_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        // If a particle is passing between paired barrier particles,\n        // its velocity will be decelerated to avoid passing.\n        for (var i = 0; i < this.m_count; i++) {\n            var flags = this.m_flagsBuffer.data[i];\n            /// if ((flags & b2ParticleSystem.k_barrierWallFlags) === b2ParticleSystem.k_barrierWallFlags)\n            if ((flags & b2ParticleSystem.k_barrierWallFlags) !== 0) {\n                vel_data[i].SetZero();\n            }\n        }\n        var tmax = b2Settings_1.b2_barrierCollisionTime * step.dt;\n        var mass = this.GetParticleMass();\n        for (var k = 0; k < this.m_pairBuffer.count; k++) {\n            var pair = this.m_pairBuffer.data[k];\n            if (pair.flags & b2Particle_1.b2ParticleFlag.b2_barrierParticle) {\n                var a = pair.indexA;\n                var b = pair.indexB;\n                var pa = pos_data[a];\n                var pb = pos_data[b];\n                /// b2AABB aabb;\n                var aabb = s_aabb;\n                /// aabb.lowerBound = b2Min(pa, pb);\n                b2Math_1.b2Vec2.MinV(pa, pb, aabb.lowerBound);\n                /// aabb.upperBound = b2Max(pa, pb);\n                b2Math_1.b2Vec2.MaxV(pa, pb, aabb.upperBound);\n                var aGroup = this.m_groupBuffer[a];\n                var bGroup = this.m_groupBuffer[b];\n                /// b2Vec2 va = GetLinearVelocity(aGroup, a, pa);\n                var va = this.GetLinearVelocity(aGroup, a, pa, s_va);\n                /// b2Vec2 vb = GetLinearVelocity(bGroup, b, pb);\n                var vb = this.GetLinearVelocity(bGroup, b, pb, s_vb);\n                /// b2Vec2 pba = pb - pa;\n                var pba = b2Math_1.b2Vec2.SubVV(pb, pa, s_pba);\n                /// b2Vec2 vba = vb - va;\n                var vba = b2Math_1.b2Vec2.SubVV(vb, va, s_vba);\n                /// InsideBoundsEnumerator enumerator = GetInsideBoundsEnumerator(aabb);\n                var enumerator = this.GetInsideBoundsEnumerator(aabb);\n                var c = void 0;\n                // tslint:disable-next-line:no-conditional-assignment\n                while ((c = enumerator.GetNext()) >= 0) {\n                    var pc = pos_data[c];\n                    var cGroup = this.m_groupBuffer[c];\n                    if (aGroup !== cGroup && bGroup !== cGroup) {\n                        /// b2Vec2 vc = GetLinearVelocity(cGroup, c, pc);\n                        var vc = this.GetLinearVelocity(cGroup, c, pc, s_vc);\n                        // Solve the equation below:\n                        //   (1-s)*(pa+t*va)+s*(pb+t*vb) = pc+t*vc\n                        // which expresses that the particle c will pass a line\n                        // connecting the particles a and b at the time of t.\n                        // if s is between 0 and 1, c will pass between a and b.\n                        /// b2Vec2 pca = pc - pa;\n                        var pca = b2Math_1.b2Vec2.SubVV(pc, pa, s_pca);\n                        /// b2Vec2 vca = vc - va;\n                        var vca = b2Math_1.b2Vec2.SubVV(vc, va, s_vca);\n                        var e2 = b2Math_1.b2Vec2.CrossVV(vba, vca);\n                        var e1 = b2Math_1.b2Vec2.CrossVV(pba, vca) - b2Math_1.b2Vec2.CrossVV(pca, vba);\n                        var e0 = b2Math_1.b2Vec2.CrossVV(pba, pca);\n                        var s = void 0, t = void 0;\n                        /// b2Vec2 qba, qca;\n                        var qba = s_qba, qca = s_qca;\n                        if (e2 === 0) {\n                            if (e1 === 0) {\n                                continue;\n                            }\n                            t = -e0 / e1;\n                            if (!(t >= 0 && t < tmax)) {\n                                continue;\n                            }\n                            /// qba = pba + t * vba;\n                            b2Math_1.b2Vec2.AddVMulSV(pba, t, vba, qba);\n                            /// qca = pca + t * vca;\n                            b2Math_1.b2Vec2.AddVMulSV(pca, t, vca, qca);\n                            s = b2Math_1.b2Vec2.DotVV(qba, qca) / b2Math_1.b2Vec2.DotVV(qba, qba);\n                            if (!(s >= 0 && s <= 1)) {\n                                continue;\n                            }\n                        }\n                        else {\n                            var det = e1 * e1 - 4 * e0 * e2;\n                            if (det < 0) {\n                                continue;\n                            }\n                            var sqrtDet = b2Math_1.b2Sqrt(det);\n                            var t1 = (-e1 - sqrtDet) / (2 * e2);\n                            var t2 = (-e1 + sqrtDet) / (2 * e2);\n                            /// if (t1 > t2) b2Swap(t1, t2);\n                            if (t1 > t2) {\n                                var tmp = t1;\n                                t1 = t2;\n                                t2 = tmp;\n                            }\n                            t = t1;\n                            /// qba = pba + t * vba;\n                            b2Math_1.b2Vec2.AddVMulSV(pba, t, vba, qba);\n                            /// qca = pca + t * vca;\n                            b2Math_1.b2Vec2.AddVMulSV(pca, t, vca, qca);\n                            /// s = b2Dot(qba, qca) / b2Dot(qba, qba);\n                            s = b2Math_1.b2Vec2.DotVV(qba, qca) / b2Math_1.b2Vec2.DotVV(qba, qba);\n                            if (!(t >= 0 && t < tmax && s >= 0 && s <= 1)) {\n                                t = t2;\n                                if (!(t >= 0 && t < tmax)) {\n                                    continue;\n                                }\n                                /// qba = pba + t * vba;\n                                b2Math_1.b2Vec2.AddVMulSV(pba, t, vba, qba);\n                                /// qca = pca + t * vca;\n                                b2Math_1.b2Vec2.AddVMulSV(pca, t, vca, qca);\n                                /// s = b2Dot(qba, qca) / b2Dot(qba, qba);\n                                s = b2Math_1.b2Vec2.DotVV(qba, qca) / b2Math_1.b2Vec2.DotVV(qba, qba);\n                                if (!(s >= 0 && s <= 1)) {\n                                    continue;\n                                }\n                            }\n                        }\n                        // Apply a force to particle c so that it will have the\n                        // interpolated velocity at the collision point on line ab.\n                        /// b2Vec2 dv = va + s * vba - vc;\n                        var dv = s_dv;\n                        dv.x = va.x + s * vba.x - vc.x;\n                        dv.y = va.y + s * vba.y - vc.y;\n                        /// b2Vec2 f = GetParticleMass() * dv;\n                        var f = b2Math_1.b2Vec2.MulSV(mass, dv, s_f);\n                        if (this.IsRigidGroup(cGroup)) {\n                            // If c belongs to a rigid group, the force will be\n                            // distributed in the group.\n                            // tslint:disable-next-line:no-shadowed-variable\n                            var mass_1 = cGroup.GetMass();\n                            var inertia = cGroup.GetInertia();\n                            if (mass_1 > 0) {\n                                /// cGroup.m_linearVelocity += 1 / mass * f;\n                                cGroup.m_linearVelocity.SelfMulAdd(1 / mass_1, f);\n                            }\n                            if (inertia > 0) {\n                                /// cGroup.m_angularVelocity += b2Cross(pc - cGroup.GetCenter(), f) / inertia;\n                                cGroup.m_angularVelocity += b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.SubVV(pc, cGroup.GetCenter(), b2Math_1.b2Vec2.s_t0), f) / inertia;\n                            }\n                        }\n                        else {\n                            /// m_velocityBuffer.data[c] += dv;\n                            vel_data[c].SelfAdd(dv);\n                        }\n                        // Apply a reversed force to particle c after particle\n                        // movement so that momentum will be preserved.\n                        /// ParticleApplyForce(c, -step.inv_dt * f);\n                        this.ParticleApplyForce(c, f.SelfMul(-step.inv_dt));\n                    }\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveStaticPressure = function (step) {\n        this.m_staticPressureBuffer = this.RequestBuffer(this.m_staticPressureBuffer);\n        var criticalPressure = this.GetCriticalPressure(step);\n        var pressurePerWeight = this.m_def.staticPressureStrength * criticalPressure;\n        var maxPressure = b2Settings_2.b2_maxParticlePressure * criticalPressure;\n        var relaxation = this.m_def.staticPressureRelaxation;\n        /// Compute pressure satisfying the modified Poisson equation:\n        ///   Sum_for_j((p_i - p_j) * w_ij) + relaxation * p_i =\n        ///   pressurePerWeight * (w_i - b2_minParticleWeight)\n        /// by iterating the calculation:\n        ///   p_i = (Sum_for_j(p_j * w_ij) + pressurePerWeight *\n        ///         (w_i - b2_minParticleWeight)) / (w_i + relaxation)\n        /// where\n        ///   p_i and p_j are static pressure of particle i and j\n        ///   w_ij is contact weight between particle i and j\n        ///   w_i is sum of contact weight of particle i\n        for (var t = 0; t < this.m_def.staticPressureIterations; t++) {\n            /// memset(m_accumulationBuffer, 0, sizeof(*m_accumulationBuffer) * m_count);\n            for (var i = 0; i < this.m_count; i++) {\n                this.m_accumulationBuffer[i] = 0;\n            }\n            for (var k = 0; k < this.m_contactBuffer.count; k++) {\n                var contact = this.m_contactBuffer.data[k];\n                if (contact.flags & b2Particle_1.b2ParticleFlag.b2_staticPressureParticle) {\n                    var a = contact.indexA;\n                    var b = contact.indexB;\n                    var w = contact.weight;\n                    this.m_accumulationBuffer[a] += w * this.m_staticPressureBuffer[b]; // a <- b\n                    this.m_accumulationBuffer[b] += w * this.m_staticPressureBuffer[a]; // b <- a\n                }\n            }\n            for (var i = 0; i < this.m_count; i++) {\n                var w = this.m_weightBuffer[i];\n                if (this.m_flagsBuffer.data[i] & b2Particle_1.b2ParticleFlag.b2_staticPressureParticle) {\n                    var wh = this.m_accumulationBuffer[i];\n                    var h = (wh + pressurePerWeight * (w - b2Settings_2.b2_minParticleWeight)) /\n                        (w + relaxation);\n                    this.m_staticPressureBuffer[i] = b2Math_1.b2Clamp(h, 0.0, maxPressure);\n                }\n                else {\n                    this.m_staticPressureBuffer[i] = 0;\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.ComputeWeight = function () {\n        // calculates the sum of contact-weights for each particle\n        // that means dimensionless density\n        /// memset(m_weightBuffer, 0, sizeof(*m_weightBuffer) * m_count);\n        for (var k = 0; k < this.m_count; k++) {\n            this.m_weightBuffer[k] = 0;\n        }\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            var w = contact.weight;\n            this.m_weightBuffer[a] += w;\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var w = contact.weight;\n            this.m_weightBuffer[a] += w;\n            this.m_weightBuffer[b] += w;\n        }\n    };\n    b2ParticleSystem.prototype.SolvePressure = function (step) {\n        var s_f = b2ParticleSystem.SolvePressure_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        // calculates pressure as a linear function of density\n        var criticalPressure = this.GetCriticalPressure(step);\n        var pressurePerWeight = this.m_def.pressureStrength * criticalPressure;\n        var maxPressure = b2Settings_2.b2_maxParticlePressure * criticalPressure;\n        for (var i = 0; i < this.m_count; i++) {\n            var w = this.m_weightBuffer[i];\n            var h = pressurePerWeight * b2Math_1.b2Max(0.0, w - b2Settings_2.b2_minParticleWeight);\n            this.m_accumulationBuffer[i] = b2Math_1.b2Min(h, maxPressure);\n        }\n        // ignores particles which have their own repulsive force\n        if (this.m_allParticleFlags & b2ParticleSystem.k_noPressureFlags) {\n            for (var i = 0; i < this.m_count; i++) {\n                if (this.m_flagsBuffer.data[i] & b2ParticleSystem.k_noPressureFlags) {\n                    this.m_accumulationBuffer[i] = 0;\n                }\n            }\n        }\n        // static pressure\n        if (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_staticPressureParticle) {\n            b2Assert(this.m_staticPressureBuffer !== null);\n            for (var i = 0; i < this.m_count; i++) {\n                if (this.m_flagsBuffer.data[i] & b2Particle_1.b2ParticleFlag.b2_staticPressureParticle) {\n                    this.m_accumulationBuffer[i] += this.m_staticPressureBuffer[i];\n                }\n            }\n        }\n        // applies pressure between each particles in contact\n        var velocityPerPressure = step.dt / (this.m_def.density * this.m_particleDiameter);\n        var inv_mass = this.GetParticleInvMass();\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            var b = contact.body;\n            var w = contact.weight;\n            var m = contact.mass;\n            var n = contact.normal;\n            var p = pos_data[a];\n            var h = this.m_accumulationBuffer[a] + pressurePerWeight * w;\n            /// b2Vec2 f = velocityPerPressure * w * m * h * n;\n            var f = b2Math_1.b2Vec2.MulSV(velocityPerPressure * w * m * h, n, s_f);\n            /// m_velocityBuffer.data[a] -= GetParticleInvMass() * f;\n            vel_data[a].SelfMulSub(inv_mass, f);\n            b.ApplyLinearImpulse(f, p, true);\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var w = contact.weight;\n            var n = contact.normal;\n            var h = this.m_accumulationBuffer[a] + this.m_accumulationBuffer[b];\n            /// b2Vec2 f = velocityPerPressure * w * h * n;\n            var f = b2Math_1.b2Vec2.MulSV(velocityPerPressure * w * h, n, s_f);\n            /// m_velocityBuffer.data[a] -= f;\n            vel_data[a].SelfSub(f);\n            /// m_velocityBuffer.data[b] += f;\n            vel_data[b].SelfAdd(f);\n        }\n    };\n    b2ParticleSystem.prototype.SolveDamping = function (step) {\n        var s_v = b2ParticleSystem.SolveDamping_s_v;\n        var s_f = b2ParticleSystem.SolveDamping_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        // reduces normal velocity of each contact\n        var linearDamping = this.m_def.dampingStrength;\n        var quadraticDamping = 1 / this.GetCriticalVelocity(step);\n        var inv_mass = this.GetParticleInvMass();\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            var b = contact.body;\n            var w = contact.weight;\n            var m = contact.mass;\n            var n = contact.normal;\n            var p = pos_data[a];\n            /// b2Vec2 v = b.GetLinearVelocityFromWorldPoint(p) - m_velocityBuffer.data[a];\n            var v = b2Math_1.b2Vec2.SubVV(b.GetLinearVelocityFromWorldPoint(p, b2Math_1.b2Vec2.s_t0), vel_data[a], s_v);\n            var vn = b2Math_1.b2Vec2.DotVV(v, n);\n            if (vn < 0) {\n                var damping = b2Math_1.b2Max(linearDamping * w, b2Math_1.b2Min(-quadraticDamping * vn, 0.5));\n                /// b2Vec2 f = damping * m * vn * n;\n                var f = b2Math_1.b2Vec2.MulSV(damping * m * vn, n, s_f);\n                /// m_velocityBuffer.data[a] += GetParticleInvMass() * f;\n                vel_data[a].SelfMulAdd(inv_mass, f);\n                /// b.ApplyLinearImpulse(-f, p, true);\n                b.ApplyLinearImpulse(f.SelfNeg(), p, true);\n            }\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var w = contact.weight;\n            var n = contact.normal;\n            /// b2Vec2 v = m_velocityBuffer.data[b] - m_velocityBuffer.data[a];\n            var v = b2Math_1.b2Vec2.SubVV(vel_data[b], vel_data[a], s_v);\n            var vn = b2Math_1.b2Vec2.DotVV(v, n);\n            if (vn < 0) {\n                /// float32 damping = b2Max(linearDamping * w, b2Min(- quadraticDamping * vn, 0.5f));\n                var damping = b2Math_1.b2Max(linearDamping * w, b2Math_1.b2Min(-quadraticDamping * vn, 0.5));\n                /// b2Vec2 f = damping * vn * n;\n                var f = b2Math_1.b2Vec2.MulSV(damping * vn, n, s_f);\n                /// this.m_velocityBuffer.data[a] += f;\n                vel_data[a].SelfAdd(f);\n                /// this.m_velocityBuffer.data[b] -= f;\n                vel_data[b].SelfSub(f);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveRigidDamping = function () {\n        var s_t0 = b2ParticleSystem.SolveRigidDamping_s_t0;\n        var s_t1 = b2ParticleSystem.SolveRigidDamping_s_t1;\n        var s_p = b2ParticleSystem.SolveRigidDamping_s_p;\n        var s_v = b2ParticleSystem.SolveRigidDamping_s_v;\n        var invMassA = [0.0], invInertiaA = [0.0], tangentDistanceA = [0.0]; // TODO: static\n        var invMassB = [0.0], invInertiaB = [0.0], tangentDistanceB = [0.0]; // TODO: static\n        // Apply impulse to rigid particle groups colliding with other objects\n        // to reduce relative velocity at the colliding point.\n        var pos_data = this.m_positionBuffer.data;\n        var damping = this.m_def.dampingStrength;\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            var aGroup = this.m_groupBuffer[a];\n            if (this.IsRigidGroup(aGroup)) {\n                var b = contact.body;\n                var n = contact.normal;\n                var w = contact.weight;\n                var p = pos_data[a];\n                /// b2Vec2 v = b.GetLinearVelocityFromWorldPoint(p) - aGroup.GetLinearVelocityFromWorldPoint(p);\n                var v = b2Math_1.b2Vec2.SubVV(b.GetLinearVelocityFromWorldPoint(p, s_t0), aGroup.GetLinearVelocityFromWorldPoint(p, s_t1), s_v);\n                var vn = b2Math_1.b2Vec2.DotVV(v, n);\n                if (vn < 0) {\n                    // The group's average velocity at particle position 'p' is pushing\n                    // the particle into the body.\n                    /// this.InitDampingParameterWithRigidGroupOrParticle(&invMassA, &invInertiaA, &tangentDistanceA, true, aGroup, a, p, n);\n                    this.InitDampingParameterWithRigidGroupOrParticle(invMassA, invInertiaA, tangentDistanceA, true, aGroup, a, p, n);\n                    // Calculate b.m_I from public functions of b2Body.\n                    /// this.InitDampingParameter(&invMassB, &invInertiaB, &tangentDistanceB, b.GetMass(), b.GetInertia() - b.GetMass() * b.GetLocalCenter().LengthSquared(), b.GetWorldCenter(), p, n);\n                    this.InitDampingParameter(invMassB, invInertiaB, tangentDistanceB, b.GetMass(), b.GetInertia() - b.GetMass() * b.GetLocalCenter().LengthSquared(), b.GetWorldCenter(), p, n);\n                    /// float32 f = damping * b2Min(w, 1.0) * this.ComputeDampingImpulse(invMassA, invInertiaA, tangentDistanceA, invMassB, invInertiaB, tangentDistanceB, vn);\n                    var f = damping * b2Math_1.b2Min(w, 1.0) * this.ComputeDampingImpulse(invMassA[0], invInertiaA[0], tangentDistanceA[0], invMassB[0], invInertiaB[0], tangentDistanceB[0], vn);\n                    /// this.ApplyDamping(invMassA, invInertiaA, tangentDistanceA, true, aGroup, a, f, n);\n                    this.ApplyDamping(invMassA[0], invInertiaA[0], tangentDistanceA[0], true, aGroup, a, f, n);\n                    /// b.ApplyLinearImpulse(-f * n, p, true);\n                    b.ApplyLinearImpulse(b2Math_1.b2Vec2.MulSV(-f, n, b2Math_1.b2Vec2.s_t0), p, true);\n                }\n            }\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            var n = contact.normal;\n            var w = contact.weight;\n            var aGroup = this.m_groupBuffer[a];\n            var bGroup = this.m_groupBuffer[b];\n            var aRigid = this.IsRigidGroup(aGroup);\n            var bRigid = this.IsRigidGroup(bGroup);\n            if (aGroup !== bGroup && (aRigid || bRigid)) {\n                /// b2Vec2 p = 0.5f * (this.m_positionBuffer.data[a] + this.m_positionBuffer.data[b]);\n                var p = b2Math_1.b2Vec2.MidVV(pos_data[a], pos_data[b], s_p);\n                /// b2Vec2 v = GetLinearVelocity(bGroup, b, p) - GetLinearVelocity(aGroup, a, p);\n                var v = b2Math_1.b2Vec2.SubVV(this.GetLinearVelocity(bGroup, b, p, s_t0), this.GetLinearVelocity(aGroup, a, p, s_t1), s_v);\n                var vn = b2Math_1.b2Vec2.DotVV(v, n);\n                if (vn < 0) {\n                    /// this.InitDampingParameterWithRigidGroupOrParticle(&invMassA, &invInertiaA, &tangentDistanceA, aRigid, aGroup, a, p, n);\n                    this.InitDampingParameterWithRigidGroupOrParticle(invMassA, invInertiaA, tangentDistanceA, aRigid, aGroup, a, p, n);\n                    /// this.InitDampingParameterWithRigidGroupOrParticle(&invMassB, &invInertiaB, &tangentDistanceB, bRigid, bGroup, b, p, n);\n                    this.InitDampingParameterWithRigidGroupOrParticle(invMassB, invInertiaB, tangentDistanceB, bRigid, bGroup, b, p, n);\n                    /// float32 f = damping * w * this.ComputeDampingImpulse(invMassA, invInertiaA, tangentDistanceA, invMassB, invInertiaB, tangentDistanceB, vn);\n                    var f = damping * w * this.ComputeDampingImpulse(invMassA[0], invInertiaA[0], tangentDistanceA[0], invMassB[0], invInertiaB[0], tangentDistanceB[0], vn);\n                    /// this.ApplyDamping(invMassA, invInertiaA, tangentDistanceA, aRigid, aGroup, a, f, n);\n                    this.ApplyDamping(invMassA[0], invInertiaA[0], tangentDistanceA[0], aRigid, aGroup, a, f, n);\n                    /// this.ApplyDamping(invMassB, invInertiaB, tangentDistanceB, bRigid, bGroup, b, -f, n);\n                    this.ApplyDamping(invMassB[0], invInertiaB[0], tangentDistanceB[0], bRigid, bGroup, b, -f, n);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveExtraDamping = function () {\n        var s_v = b2ParticleSystem.SolveExtraDamping_s_v;\n        var s_f = b2ParticleSystem.SolveExtraDamping_s_f;\n        var vel_data = this.m_velocityBuffer.data;\n        // Applies additional damping force between bodies and particles which can\n        // produce strong repulsive force. Applying damping force multiple times\n        // is effective in suppressing vibration.\n        var pos_data = this.m_positionBuffer.data;\n        var inv_mass = this.GetParticleInvMass();\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            if (this.m_flagsBuffer.data[a] & b2ParticleSystem.k_extraDampingFlags) {\n                var b = contact.body;\n                var m = contact.mass;\n                var n = contact.normal;\n                var p = pos_data[a];\n                /// b2Vec2 v = b.GetLinearVelocityFromWorldPoint(p) - m_velocityBuffer.data[a];\n                var v = b2Math_1.b2Vec2.SubVV(b.GetLinearVelocityFromWorldPoint(p, b2Math_1.b2Vec2.s_t0), vel_data[a], s_v);\n                /// float32 vn = b2Dot(v, n);\n                var vn = b2Math_1.b2Vec2.DotVV(v, n);\n                if (vn < 0) {\n                    /// b2Vec2 f = 0.5f * m * vn * n;\n                    var f = b2Math_1.b2Vec2.MulSV(0.5 * m * vn, n, s_f);\n                    /// m_velocityBuffer.data[a] += GetParticleInvMass() * f;\n                    vel_data[a].SelfMulAdd(inv_mass, f);\n                    /// b.ApplyLinearImpulse(-f, p, true);\n                    b.ApplyLinearImpulse(f.SelfNeg(), p, true);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveWall = function () {\n        var vel_data = this.m_velocityBuffer.data;\n        for (var i = 0; i < this.m_count; i++) {\n            if (this.m_flagsBuffer.data[i] & b2Particle_1.b2ParticleFlag.b2_wallParticle) {\n                vel_data[i].SetZero();\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveRigid = function (step) {\n        var s_position = b2ParticleSystem.SolveRigid_s_position;\n        var s_rotation = b2ParticleSystem.SolveRigid_s_rotation;\n        var s_transform = b2ParticleSystem.SolveRigid_s_transform;\n        var s_velocityTransform = b2ParticleSystem.SolveRigid_s_velocityTransform;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        for (var group = this.m_groupList; group; group = group.GetNext()) {\n            if (group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_rigidParticleGroup) {\n                group.UpdateStatistics();\n                /// b2Rot rotation(step.dt * group.m_angularVelocity);\n                var rotation = s_rotation;\n                rotation.SetAngle(step.dt * group.m_angularVelocity);\n                /// b2Transform transform(group.m_center + step.dt * group.m_linearVelocity - b2Mul(rotation, group.m_center), rotation);\n                var position = b2Math_1.b2Vec2.AddVV(group.m_center, b2Math_1.b2Vec2.SubVV(b2Math_1.b2Vec2.MulSV(step.dt, group.m_linearVelocity, b2Math_1.b2Vec2.s_t0), b2Math_1.b2Rot.MulRV(rotation, group.m_center, b2Math_1.b2Vec2.s_t1), b2Math_1.b2Vec2.s_t0), s_position);\n                var transform = s_transform;\n                transform.SetPositionRotation(position, rotation);\n                /// group.m_transform = b2Mul(transform, group.m_transform);\n                b2Math_1.b2Transform.MulXX(transform, group.m_transform, group.m_transform);\n                var velocityTransform = s_velocityTransform;\n                velocityTransform.p.x = step.inv_dt * transform.p.x;\n                velocityTransform.p.y = step.inv_dt * transform.p.y;\n                velocityTransform.q.s = step.inv_dt * transform.q.s;\n                velocityTransform.q.c = step.inv_dt * (transform.q.c - 1);\n                for (var i = group.m_firstIndex; i < group.m_lastIndex; i++) {\n                    /// m_velocityBuffer.data[i] = b2Mul(velocityTransform, m_positionBuffer.data[i]);\n                    b2Math_1.b2Transform.MulXV(velocityTransform, pos_data[i], vel_data[i]);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveElastic = function (step) {\n        var s_pa = b2ParticleSystem.SolveElastic_s_pa;\n        var s_pb = b2ParticleSystem.SolveElastic_s_pb;\n        var s_pc = b2ParticleSystem.SolveElastic_s_pc;\n        var s_r = b2ParticleSystem.SolveElastic_s_r;\n        var s_t0 = b2ParticleSystem.SolveElastic_s_t0;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        var elasticStrength = step.inv_dt * this.m_def.elasticStrength;\n        for (var k = 0; k < this.m_triadBuffer.count; k++) {\n            var triad = this.m_triadBuffer.data[k];\n            if (triad.flags & b2Particle_1.b2ParticleFlag.b2_elasticParticle) {\n                var a = triad.indexA;\n                var b = triad.indexB;\n                var c = triad.indexC;\n                var oa = triad.pa;\n                var ob = triad.pb;\n                var oc = triad.pc;\n                /// b2Vec2 pa = m_positionBuffer.data[a];\n                var pa = s_pa.Copy(pos_data[a]);\n                /// b2Vec2 pb = m_positionBuffer.data[b];\n                var pb = s_pb.Copy(pos_data[b]);\n                /// b2Vec2 pc = m_positionBuffer.data[c];\n                var pc = s_pc.Copy(pos_data[c]);\n                var va = vel_data[a];\n                var vb = vel_data[b];\n                var vc = vel_data[c];\n                /// pa += step.dt * va;\n                pa.SelfMulAdd(step.dt, va);\n                /// pb += step.dt * vb;\n                pb.SelfMulAdd(step.dt, vb);\n                /// pc += step.dt * vc;\n                pc.SelfMulAdd(step.dt, vc);\n                /// b2Vec2 midPoint = (float32) 1 / 3 * (pa + pb + pc);\n                var midPoint_x = (pa.x + pb.x + pc.x) / 3.0;\n                var midPoint_y = (pa.y + pb.y + pc.y) / 3.0;\n                /// pa -= midPoint;\n                pa.x -= midPoint_x;\n                pa.y -= midPoint_y;\n                /// pb -= midPoint;\n                pb.x -= midPoint_x;\n                pb.y -= midPoint_y;\n                /// pc -= midPoint;\n                pc.x -= midPoint_x;\n                pc.y -= midPoint_y;\n                /// b2Rot r;\n                var r = s_r;\n                r.s = b2Math_1.b2Vec2.CrossVV(oa, pa) + b2Math_1.b2Vec2.CrossVV(ob, pb) + b2Math_1.b2Vec2.CrossVV(oc, pc);\n                r.c = b2Math_1.b2Vec2.DotVV(oa, pa) + b2Math_1.b2Vec2.DotVV(ob, pb) + b2Math_1.b2Vec2.DotVV(oc, pc);\n                var r2 = r.s * r.s + r.c * r.c;\n                var invR = b2Math_1.b2InvSqrt(r2);\n                if (!isFinite(invR)) {\n                    invR = 1.98177537e+019;\n                }\n                r.s *= invR;\n                r.c *= invR;\n                /// r.angle = Math.atan2(r.s, r.c); // TODO: optimize\n                var strength = elasticStrength * triad.strength;\n                /// va += strength * (b2Mul(r, oa) - pa);\n                b2Math_1.b2Rot.MulRV(r, oa, s_t0);\n                b2Math_1.b2Vec2.SubVV(s_t0, pa, s_t0);\n                b2Math_1.b2Vec2.MulSV(strength, s_t0, s_t0);\n                va.SelfAdd(s_t0);\n                /// vb += strength * (b2Mul(r, ob) - pb);\n                b2Math_1.b2Rot.MulRV(r, ob, s_t0);\n                b2Math_1.b2Vec2.SubVV(s_t0, pb, s_t0);\n                b2Math_1.b2Vec2.MulSV(strength, s_t0, s_t0);\n                vb.SelfAdd(s_t0);\n                /// vc += strength * (b2Mul(r, oc) - pc);\n                b2Math_1.b2Rot.MulRV(r, oc, s_t0);\n                b2Math_1.b2Vec2.SubVV(s_t0, pc, s_t0);\n                b2Math_1.b2Vec2.MulSV(strength, s_t0, s_t0);\n                vc.SelfAdd(s_t0);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveSpring = function (step) {\n        var s_pa = b2ParticleSystem.SolveSpring_s_pa;\n        var s_pb = b2ParticleSystem.SolveSpring_s_pb;\n        var s_d = b2ParticleSystem.SolveSpring_s_d;\n        var s_f = b2ParticleSystem.SolveSpring_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        var springStrength = step.inv_dt * this.m_def.springStrength;\n        for (var k = 0; k < this.m_pairBuffer.count; k++) {\n            var pair = this.m_pairBuffer.data[k];\n            if (pair.flags & b2Particle_1.b2ParticleFlag.b2_springParticle) {\n                /// int32 a = pair.indexA;\n                var a = pair.indexA;\n                /// int32 b = pair.indexB;\n                var b = pair.indexB;\n                /// b2Vec2 pa = m_positionBuffer.data[a];\n                var pa = s_pa.Copy(pos_data[a]);\n                /// b2Vec2 pb = m_positionBuffer.data[b];\n                var pb = s_pb.Copy(pos_data[b]);\n                /// b2Vec2& va = m_velocityBuffer.data[a];\n                var va = vel_data[a];\n                /// b2Vec2& vb = m_velocityBuffer.data[b];\n                var vb = vel_data[b];\n                /// pa += step.dt * va;\n                pa.SelfMulAdd(step.dt, va);\n                /// pb += step.dt * vb;\n                pb.SelfMulAdd(step.dt, vb);\n                /// b2Vec2 d = pb - pa;\n                var d = b2Math_1.b2Vec2.SubVV(pb, pa, s_d);\n                /// float32 r0 = pair.distance;\n                var r0 = pair.distance;\n                /// float32 r1 = d.Length();\n                var r1 = d.Length();\n                /// float32 strength = springStrength * pair.strength;\n                var strength = springStrength * pair.strength;\n                /// b2Vec2 f = strength * (r0 - r1) / r1 * d;\n                var f = b2Math_1.b2Vec2.MulSV(strength * (r0 - r1) / r1, d, s_f);\n                /// va -= f;\n                va.SelfSub(f);\n                /// vb += f;\n                vb.SelfAdd(f);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveTensile = function (step) {\n        var s_weightedNormal = b2ParticleSystem.SolveTensile_s_weightedNormal;\n        var s_s = b2ParticleSystem.SolveTensile_s_s;\n        var s_f = b2ParticleSystem.SolveTensile_s_f;\n        var vel_data = this.m_velocityBuffer.data;\n        b2Assert(this.m_accumulation2Buffer !== null);\n        for (var i = 0; i < this.m_count; i++) {\n            this.m_accumulation2Buffer[i] = new b2Math_1.b2Vec2();\n            this.m_accumulation2Buffer[i].SetZero();\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            if (contact.flags & b2Particle_1.b2ParticleFlag.b2_tensileParticle) {\n                var a = contact.indexA;\n                var b = contact.indexB;\n                var w = contact.weight;\n                var n = contact.normal;\n                /// b2Vec2 weightedNormal = (1 - w) * w * n;\n                var weightedNormal = b2Math_1.b2Vec2.MulSV((1 - w) * w, n, s_weightedNormal);\n                /// m_accumulation2Buffer[a] -= weightedNormal;\n                this.m_accumulation2Buffer[a].SelfSub(weightedNormal);\n                /// m_accumulation2Buffer[b] += weightedNormal;\n                this.m_accumulation2Buffer[b].SelfAdd(weightedNormal);\n            }\n        }\n        var criticalVelocity = this.GetCriticalVelocity(step);\n        var pressureStrength = this.m_def.surfaceTensionPressureStrength * criticalVelocity;\n        var normalStrength = this.m_def.surfaceTensionNormalStrength * criticalVelocity;\n        var maxVelocityVariation = b2Settings_2.b2_maxParticleForce * criticalVelocity;\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            if (contact.flags & b2Particle_1.b2ParticleFlag.b2_tensileParticle) {\n                var a = contact.indexA;\n                var b = contact.indexB;\n                var w = contact.weight;\n                var n = contact.normal;\n                var h = this.m_weightBuffer[a] + this.m_weightBuffer[b];\n                /// b2Vec2 s = m_accumulation2Buffer[b] - m_accumulation2Buffer[a];\n                var s = b2Math_1.b2Vec2.SubVV(this.m_accumulation2Buffer[b], this.m_accumulation2Buffer[a], s_s);\n                var fn = b2Math_1.b2Min(pressureStrength * (h - 2) + normalStrength * b2Math_1.b2Vec2.DotVV(s, n), maxVelocityVariation) * w;\n                /// b2Vec2 f = fn * n;\n                var f = b2Math_1.b2Vec2.MulSV(fn, n, s_f);\n                /// m_velocityBuffer.data[a] -= f;\n                vel_data[a].SelfSub(f);\n                /// m_velocityBuffer.data[b] += f;\n                vel_data[b].SelfAdd(f);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveViscous = function () {\n        var s_v = b2ParticleSystem.SolveViscous_s_v;\n        var s_f = b2ParticleSystem.SolveViscous_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        var viscousStrength = this.m_def.viscousStrength;\n        var inv_mass = this.GetParticleInvMass();\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            if (this.m_flagsBuffer.data[a] & b2Particle_1.b2ParticleFlag.b2_viscousParticle) {\n                var b = contact.body;\n                var w = contact.weight;\n                var m = contact.mass;\n                var p = pos_data[a];\n                /// b2Vec2 v = b.GetLinearVelocityFromWorldPoint(p) - m_velocityBuffer.data[a];\n                var v = b2Math_1.b2Vec2.SubVV(b.GetLinearVelocityFromWorldPoint(p, b2Math_1.b2Vec2.s_t0), vel_data[a], s_v);\n                /// b2Vec2 f = viscousStrength * m * w * v;\n                var f = b2Math_1.b2Vec2.MulSV(viscousStrength * m * w, v, s_f);\n                /// m_velocityBuffer.data[a] += GetParticleInvMass() * f;\n                vel_data[a].SelfMulAdd(inv_mass, f);\n                /// b.ApplyLinearImpulse(-f, p, true);\n                b.ApplyLinearImpulse(f.SelfNeg(), p, true);\n            }\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            if (contact.flags & b2Particle_1.b2ParticleFlag.b2_viscousParticle) {\n                var a = contact.indexA;\n                var b = contact.indexB;\n                var w = contact.weight;\n                /// b2Vec2 v = m_velocityBuffer.data[b] - m_velocityBuffer.data[a];\n                var v = b2Math_1.b2Vec2.SubVV(vel_data[b], vel_data[a], s_v);\n                /// b2Vec2 f = viscousStrength * w * v;\n                var f = b2Math_1.b2Vec2.MulSV(viscousStrength * w, v, s_f);\n                /// m_velocityBuffer.data[a] += f;\n                vel_data[a].SelfAdd(f);\n                /// m_velocityBuffer.data[b] -= f;\n                vel_data[b].SelfSub(f);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveRepulsive = function (step) {\n        var s_f = b2ParticleSystem.SolveRepulsive_s_f;\n        var vel_data = this.m_velocityBuffer.data;\n        var repulsiveStrength = this.m_def.repulsiveStrength * this.GetCriticalVelocity(step);\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            if (contact.flags & b2Particle_1.b2ParticleFlag.b2_repulsiveParticle) {\n                var a = contact.indexA;\n                var b = contact.indexB;\n                if (this.m_groupBuffer[a] !== this.m_groupBuffer[b]) {\n                    var w = contact.weight;\n                    var n = contact.normal;\n                    /// b2Vec2 f = repulsiveStrength * w * n;\n                    var f = b2Math_1.b2Vec2.MulSV(repulsiveStrength * w, n, s_f);\n                    /// m_velocityBuffer.data[a] -= f;\n                    vel_data[a].SelfSub(f);\n                    /// m_velocityBuffer.data[b] += f;\n                    vel_data[b].SelfAdd(f);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolvePowder = function (step) {\n        var s_f = b2ParticleSystem.SolvePowder_s_f;\n        var pos_data = this.m_positionBuffer.data;\n        var vel_data = this.m_velocityBuffer.data;\n        var powderStrength = this.m_def.powderStrength * this.GetCriticalVelocity(step);\n        var minWeight = 1.0 - b2Settings_2.b2_particleStride;\n        var inv_mass = this.GetParticleInvMass();\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            var a = contact.index;\n            if (this.m_flagsBuffer.data[a] & b2Particle_1.b2ParticleFlag.b2_powderParticle) {\n                var w = contact.weight;\n                if (w > minWeight) {\n                    var b = contact.body;\n                    var m = contact.mass;\n                    var p = pos_data[a];\n                    var n = contact.normal;\n                    var f = b2Math_1.b2Vec2.MulSV(powderStrength * m * (w - minWeight), n, s_f);\n                    vel_data[a].SelfMulSub(inv_mass, f);\n                    b.ApplyLinearImpulse(f, p, true);\n                }\n            }\n        }\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            if (contact.flags & b2Particle_1.b2ParticleFlag.b2_powderParticle) {\n                var w = contact.weight;\n                if (w > minWeight) {\n                    var a = contact.indexA;\n                    var b = contact.indexB;\n                    var n = contact.normal;\n                    var f = b2Math_1.b2Vec2.MulSV(powderStrength * (w - minWeight), n, s_f);\n                    vel_data[a].SelfSub(f);\n                    vel_data[b].SelfAdd(f);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveSolid = function (step) {\n        var s_f = b2ParticleSystem.SolveSolid_s_f;\n        var vel_data = this.m_velocityBuffer.data;\n        // applies extra repulsive force from solid particle groups\n        this.m_depthBuffer = this.RequestBuffer(this.m_depthBuffer);\n        var ejectionStrength = step.inv_dt * this.m_def.ejectionStrength;\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            var a = contact.indexA;\n            var b = contact.indexB;\n            if (this.m_groupBuffer[a] !== this.m_groupBuffer[b]) {\n                var w = contact.weight;\n                var n = contact.normal;\n                var h = this.m_depthBuffer[a] + this.m_depthBuffer[b];\n                var f = b2Math_1.b2Vec2.MulSV(ejectionStrength * h * w, n, s_f);\n                vel_data[a].SelfSub(f);\n                vel_data[b].SelfAdd(f);\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveForce = function (step) {\n        var vel_data = this.m_velocityBuffer.data;\n        var velocityPerForce = step.dt * this.GetParticleInvMass();\n        for (var i = 0; i < this.m_count; i++) {\n            /// m_velocityBuffer.data[i] += velocityPerForce * m_forceBuffer[i];\n            vel_data[i].SelfMulAdd(velocityPerForce, this.m_forceBuffer[i]);\n        }\n        this.m_hasForce = false;\n    };\n    b2ParticleSystem.prototype.SolveColorMixing = function () {\n        // mixes color between contacting particles\n        b2Assert(this.m_colorBuffer.data !== null);\n        var colorMixing = 0.5 * this.m_def.colorMixingStrength;\n        if (colorMixing) {\n            for (var k = 0; k < this.m_contactBuffer.count; k++) {\n                var contact = this.m_contactBuffer.data[k];\n                var a = contact.indexA;\n                var b = contact.indexB;\n                if (this.m_flagsBuffer.data[a] & this.m_flagsBuffer.data[b] &\n                    b2Particle_1.b2ParticleFlag.b2_colorMixingParticle) {\n                    var colorA = this.m_colorBuffer.data[a];\n                    var colorB = this.m_colorBuffer.data[b];\n                    // Use the static method to ensure certain compilers inline\n                    // this correctly.\n                    b2Draw_1.b2Color.MixColors(colorA, colorB, colorMixing);\n                }\n            }\n        }\n    };\n    b2ParticleSystem.prototype.SolveZombie = function () {\n        // removes particles with zombie flag\n        var newCount = 0;\n        /// int32* newIndices = (int32*) this.m_world.m_stackAllocator.Allocate(sizeof(int32) * this.m_count);\n        var newIndices = []; // TODO: static\n        for (var i = 0; i < this.m_count; i++) {\n            newIndices[i] = b2Settings_1.b2_invalidParticleIndex;\n        }\n        b2Assert(newIndices.length === this.m_count);\n        var allParticleFlags = 0;\n        for (var i = 0; i < this.m_count; i++) {\n            var flags = this.m_flagsBuffer.data[i];\n            if (flags & b2Particle_1.b2ParticleFlag.b2_zombieParticle) {\n                var destructionListener = this.m_world.m_destructionListener;\n                if ((flags & b2Particle_1.b2ParticleFlag.b2_destructionListenerParticle) && destructionListener) {\n                    destructionListener.SayGoodbyeParticle(this, i);\n                }\n                // Destroy particle handle.\n                if (this.m_handleIndexBuffer.data) {\n                    var handle = this.m_handleIndexBuffer.data[i];\n                    if (handle) {\n                        handle.SetIndex(b2Settings_1.b2_invalidParticleIndex);\n                        this.m_handleIndexBuffer.data[i] = null;\n                        /// m_handleAllocator.Free(handle);\n                    }\n                }\n                newIndices[i] = b2Settings_1.b2_invalidParticleIndex;\n            }\n            else {\n                newIndices[i] = newCount;\n                if (i !== newCount) {\n                    // Update handle to reference new particle index.\n                    if (this.m_handleIndexBuffer.data) {\n                        var handle = this.m_handleIndexBuffer.data[i];\n                        if (handle) {\n                            handle.SetIndex(newCount);\n                        }\n                        this.m_handleIndexBuffer.data[newCount] = handle;\n                    }\n                    this.m_flagsBuffer.data[newCount] = this.m_flagsBuffer.data[i];\n                    if (this.m_lastBodyContactStepBuffer.data) {\n                        this.m_lastBodyContactStepBuffer.data[newCount] = this.m_lastBodyContactStepBuffer.data[i];\n                    }\n                    if (this.m_bodyContactCountBuffer.data) {\n                        this.m_bodyContactCountBuffer.data[newCount] = this.m_bodyContactCountBuffer.data[i];\n                    }\n                    if (this.m_consecutiveContactStepsBuffer.data) {\n                        this.m_consecutiveContactStepsBuffer.data[newCount] = this.m_consecutiveContactStepsBuffer.data[i];\n                    }\n                    this.m_positionBuffer.data[newCount].Copy(this.m_positionBuffer.data[i]);\n                    this.m_velocityBuffer.data[newCount].Copy(this.m_velocityBuffer.data[i]);\n                    this.m_groupBuffer[newCount] = this.m_groupBuffer[i];\n                    if (this.m_hasForce) {\n                        this.m_forceBuffer[newCount].Copy(this.m_forceBuffer[i]);\n                    }\n                    if (this.m_staticPressureBuffer) {\n                        this.m_staticPressureBuffer[newCount] = this.m_staticPressureBuffer[i];\n                    }\n                    if (this.m_depthBuffer) {\n                        this.m_depthBuffer[newCount] = this.m_depthBuffer[i];\n                    }\n                    if (this.m_colorBuffer.data) {\n                        this.m_colorBuffer.data[newCount].Copy(this.m_colorBuffer.data[i]);\n                    }\n                    if (this.m_userDataBuffer.data) {\n                        this.m_userDataBuffer.data[newCount] = this.m_userDataBuffer.data[i];\n                    }\n                    if (this.m_expirationTimeBuffer.data) {\n                        this.m_expirationTimeBuffer.data[newCount] = this.m_expirationTimeBuffer.data[i];\n                    }\n                }\n                newCount++;\n                allParticleFlags |= flags;\n            }\n        }\n        // predicate functions\n        var Test = {\n            /// static bool IsProxyInvalid(const Proxy& proxy)\n            IsProxyInvalid: function (proxy) {\n                return proxy.index < 0;\n            },\n            /// static bool IsContactInvalid(const b2ParticleContact& contact)\n            IsContactInvalid: function (contact) {\n                return contact.indexA < 0 || contact.indexB < 0;\n            },\n            /// static bool IsBodyContactInvalid(const b2ParticleBodyContact& contact)\n            IsBodyContactInvalid: function (contact) {\n                return contact.index < 0;\n            },\n            /// static bool IsPairInvalid(const b2ParticlePair& pair)\n            IsPairInvalid: function (pair) {\n                return pair.indexA < 0 || pair.indexB < 0;\n            },\n            /// static bool IsTriadInvalid(const b2ParticleTriad& triad)\n            IsTriadInvalid: function (triad) {\n                return triad.indexA < 0 || triad.indexB < 0 || triad.indexC < 0;\n            }\n        };\n        // update proxies\n        for (var k = 0; k < this.m_proxyBuffer.count; k++) {\n            var proxy = this.m_proxyBuffer.data[k];\n            proxy.index = newIndices[proxy.index];\n        }\n        this.m_proxyBuffer.RemoveIf(Test.IsProxyInvalid);\n        // update contacts\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            contact.indexA = newIndices[contact.indexA];\n            contact.indexB = newIndices[contact.indexB];\n        }\n        this.m_contactBuffer.RemoveIf(Test.IsContactInvalid);\n        // update particle-body contacts\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            contact.index = newIndices[contact.index];\n        }\n        this.m_bodyContactBuffer.RemoveIf(Test.IsBodyContactInvalid);\n        // update pairs\n        for (var k = 0; k < this.m_pairBuffer.count; k++) {\n            var pair = this.m_pairBuffer.data[k];\n            pair.indexA = newIndices[pair.indexA];\n            pair.indexB = newIndices[pair.indexB];\n        }\n        this.m_pairBuffer.RemoveIf(Test.IsPairInvalid);\n        // update triads\n        for (var k = 0; k < this.m_triadBuffer.count; k++) {\n            var triad = this.m_triadBuffer.data[k];\n            triad.indexA = newIndices[triad.indexA];\n            triad.indexB = newIndices[triad.indexB];\n            triad.indexC = newIndices[triad.indexC];\n        }\n        this.m_triadBuffer.RemoveIf(Test.IsTriadInvalid);\n        // Update lifetime indices.\n        if (this.m_indexByExpirationTimeBuffer.data) {\n            var writeOffset = 0;\n            for (var readOffset = 0; readOffset < this.m_count; readOffset++) {\n                var newIndex = newIndices[this.m_indexByExpirationTimeBuffer.data[readOffset]];\n                if (newIndex !== b2Settings_1.b2_invalidParticleIndex) {\n                    this.m_indexByExpirationTimeBuffer.data[writeOffset++] = newIndex;\n                }\n            }\n        }\n        // update groups\n        for (var group = this.m_groupList; group; group = group.GetNext()) {\n            var firstIndex = newCount;\n            var lastIndex = 0;\n            var modified = false;\n            for (var i = group.m_firstIndex; i < group.m_lastIndex; i++) {\n                var j = newIndices[i];\n                if (j >= 0) {\n                    firstIndex = b2Math_1.b2Min(firstIndex, j);\n                    lastIndex = b2Math_1.b2Max(lastIndex, j + 1);\n                }\n                else {\n                    modified = true;\n                }\n            }\n            if (firstIndex < lastIndex) {\n                group.m_firstIndex = firstIndex;\n                group.m_lastIndex = lastIndex;\n                if (modified) {\n                    if (group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_solidParticleGroup) {\n                        this.SetGroupFlags(group, group.m_groupFlags | b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);\n                    }\n                }\n            }\n            else {\n                group.m_firstIndex = 0;\n                group.m_lastIndex = 0;\n                if (!(group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty)) {\n                    this.SetGroupFlags(group, group.m_groupFlags | b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed);\n                }\n            }\n        }\n        // update particle count\n        this.m_count = newCount;\n        /// m_world.m_stackAllocator.Free(newIndices);\n        this.m_allParticleFlags = allParticleFlags;\n        this.m_needsUpdateAllParticleFlags = false;\n        // destroy bodies with no particles\n        for (var group = this.m_groupList; group;) {\n            var next = group.GetNext();\n            if (group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed) {\n                this.DestroyParticleGroup(group);\n            }\n            group = next;\n        }\n    };\n    /**\n     * Destroy all particles which have outlived their lifetimes set\n     * by SetParticleLifetime().\n     */\n    b2ParticleSystem.prototype.SolveLifetimes = function (step) {\n        b2Assert(this.m_expirationTimeBuffer.data !== null);\n        b2Assert(this.m_indexByExpirationTimeBuffer.data !== null);\n        // Update the time elapsed.\n        this.m_timeElapsed = this.LifetimeToExpirationTime(step.dt);\n        // Get the floor (non-fractional component) of the elapsed time.\n        var quantizedTimeElapsed = this.GetQuantizedTimeElapsed();\n        var expirationTimes = this.m_expirationTimeBuffer.data;\n        var expirationTimeIndices = this.m_indexByExpirationTimeBuffer.data;\n        var particleCount = this.GetParticleCount();\n        // Sort the lifetime buffer if it's required.\n        if (this.m_expirationTimeBufferRequiresSorting) {\n            /// const ExpirationTimeComparator expirationTimeComparator(expirationTimes);\n            /// std::sort(expirationTimeIndices, expirationTimeIndices + particleCount, expirationTimeComparator);\n            /**\n             * Compare the lifetime of particleIndexA and particleIndexB\n             * returning true if the lifetime of A is greater than B for\n             * particles that will expire.  If either particle's lifetime is\n             * infinite (<= 0.0f) this function return true if the lifetime\n             * of A is lesser than B. When used with std::sort() this\n             * results in an array of particle indicies sorted in reverse\n             * order by particle lifetime.\n             *\n             * For example, the set of lifetimes\n             * (1.0, 0.7, 0.3, 0.0, -1.0, 2.0)\n             * would be sorted as\n             * (0.0, 1.0, -2.0, 1.0, 0.7, 0.3)\n             */\n            var ExpirationTimeComparator = function (particleIndexA, particleIndexB) {\n                var expirationTimeA = expirationTimes[particleIndexA];\n                var expirationTimeB = expirationTimes[particleIndexB];\n                var infiniteExpirationTimeA = expirationTimeA <= 0.0;\n                var infiniteExpirationTimeB = expirationTimeB <= 0.0;\n                return infiniteExpirationTimeA === infiniteExpirationTimeB ?\n                    expirationTimeA > expirationTimeB : infiniteExpirationTimeA;\n            };\n            std_sort(expirationTimeIndices, 0, particleCount, ExpirationTimeComparator);\n            this.m_expirationTimeBufferRequiresSorting = false;\n        }\n        // Destroy particles which have expired.\n        for (var i = particleCount - 1; i >= 0; --i) {\n            var particleIndex = expirationTimeIndices[i];\n            var expirationTime = expirationTimes[particleIndex];\n            // If no particles need to be destroyed, skip this.\n            if (quantizedTimeElapsed < expirationTime || expirationTime <= 0) {\n                break;\n            }\n            // Destroy this particle.\n            this.DestroyParticle(particleIndex);\n        }\n    };\n    b2ParticleSystem.prototype.RotateBuffer = function (start, mid, end) {\n        // move the particles assigned to the given group toward the end of array\n        if (start === mid || mid === end) {\n            return;\n        }\n        b2Assert(mid >= start && mid <= end);\n        function newIndices(i) {\n            if (i < start) {\n                return i;\n            }\n            else if (i < mid) {\n                return i + end - mid;\n            }\n            else if (i < end) {\n                return i + start - mid;\n            }\n            else {\n                return i;\n            }\n        }\n        /// std::rotate(m_flagsBuffer.data + start, m_flagsBuffer.data + mid, m_flagsBuffer.data + end);\n        std_rotate(this.m_flagsBuffer.data, start, mid, end);\n        if (this.m_lastBodyContactStepBuffer.data) {\n            /// std::rotate(m_lastBodyContactStepBuffer.data + start, m_lastBodyContactStepBuffer.data + mid, m_lastBodyContactStepBuffer.data + end);\n            std_rotate(this.m_lastBodyContactStepBuffer.data, start, mid, end);\n        }\n        if (this.m_bodyContactCountBuffer.data) {\n            /// std::rotate(m_bodyContactCountBuffer.data + start, m_bodyContactCountBuffer.data + mid, m_bodyContactCountBuffer.data + end);\n            std_rotate(this.m_bodyContactCountBuffer.data, start, mid, end);\n        }\n        if (this.m_consecutiveContactStepsBuffer.data) {\n            /// std::rotate(m_consecutiveContactStepsBuffer.data + start, m_consecutiveContactStepsBuffer.data + mid, m_consecutiveContactStepsBuffer.data + end);\n            std_rotate(this.m_consecutiveContactStepsBuffer.data, start, mid, end);\n        }\n        /// std::rotate(m_positionBuffer.data + start, m_positionBuffer.data + mid, m_positionBuffer.data + end);\n        std_rotate(this.m_positionBuffer.data, start, mid, end);\n        /// std::rotate(m_velocityBuffer.data + start, m_velocityBuffer.data + mid, m_velocityBuffer.data + end);\n        std_rotate(this.m_velocityBuffer.data, start, mid, end);\n        /// std::rotate(m_groupBuffer + start, m_groupBuffer + mid, m_groupBuffer + end);\n        std_rotate(this.m_groupBuffer, start, mid, end);\n        if (this.m_hasForce) {\n            /// std::rotate(m_forceBuffer + start, m_forceBuffer + mid, m_forceBuffer + end);\n            std_rotate(this.m_forceBuffer, start, mid, end);\n        }\n        if (this.m_staticPressureBuffer) {\n            /// std::rotate(m_staticPressureBuffer + start, m_staticPressureBuffer + mid, m_staticPressureBuffer + end);\n            std_rotate(this.m_staticPressureBuffer, start, mid, end);\n        }\n        if (this.m_depthBuffer) {\n            /// std::rotate(m_depthBuffer + start, m_depthBuffer + mid, m_depthBuffer + end);\n            std_rotate(this.m_depthBuffer, start, mid, end);\n        }\n        if (this.m_colorBuffer.data) {\n            /// std::rotate(m_colorBuffer.data + start, m_colorBuffer.data + mid, m_colorBuffer.data + end);\n            std_rotate(this.m_colorBuffer.data, start, mid, end);\n        }\n        if (this.m_userDataBuffer.data) {\n            /// std::rotate(m_userDataBuffer.data + start, m_userDataBuffer.data + mid, m_userDataBuffer.data + end);\n            std_rotate(this.m_userDataBuffer.data, start, mid, end);\n        }\n        // Update handle indices.\n        if (this.m_handleIndexBuffer.data) {\n            /// std::rotate(m_handleIndexBuffer.data + start, m_handleIndexBuffer.data + mid, m_handleIndexBuffer.data + end);\n            std_rotate(this.m_handleIndexBuffer.data, start, mid, end);\n            for (var i = start; i < end; ++i) {\n                var handle = this.m_handleIndexBuffer.data[i];\n                if (handle) {\n                    handle.SetIndex(newIndices(handle.GetIndex()));\n                }\n            }\n        }\n        if (this.m_expirationTimeBuffer.data) {\n            /// std::rotate(m_expirationTimeBuffer.data + start, m_expirationTimeBuffer.data + mid, m_expirationTimeBuffer.data + end);\n            std_rotate(this.m_expirationTimeBuffer.data, start, mid, end);\n            // Update expiration time buffer indices.\n            var particleCount = this.GetParticleCount();\n            var indexByExpirationTime = this.m_indexByExpirationTimeBuffer.data;\n            for (var i = 0; i < particleCount; ++i) {\n                indexByExpirationTime[i] = newIndices(indexByExpirationTime[i]);\n            }\n        }\n        // update proxies\n        for (var k = 0; k < this.m_proxyBuffer.count; k++) {\n            var proxy = this.m_proxyBuffer.data[k];\n            proxy.index = newIndices(proxy.index);\n        }\n        // update contacts\n        for (var k = 0; k < this.m_contactBuffer.count; k++) {\n            var contact = this.m_contactBuffer.data[k];\n            contact.indexA = newIndices(contact.indexA);\n            contact.indexB = newIndices(contact.indexB);\n        }\n        // update particle-body contacts\n        for (var k = 0; k < this.m_bodyContactBuffer.count; k++) {\n            var contact = this.m_bodyContactBuffer.data[k];\n            contact.index = newIndices(contact.index);\n        }\n        // update pairs\n        for (var k = 0; k < this.m_pairBuffer.count; k++) {\n            var pair = this.m_pairBuffer.data[k];\n            pair.indexA = newIndices(pair.indexA);\n            pair.indexB = newIndices(pair.indexB);\n        }\n        // update triads\n        for (var k = 0; k < this.m_triadBuffer.count; k++) {\n            var triad = this.m_triadBuffer.data[k];\n            triad.indexA = newIndices(triad.indexA);\n            triad.indexB = newIndices(triad.indexB);\n            triad.indexC = newIndices(triad.indexC);\n        }\n        // update groups\n        for (var group = this.m_groupList; group; group = group.GetNext()) {\n            group.m_firstIndex = newIndices(group.m_firstIndex);\n            group.m_lastIndex = newIndices(group.m_lastIndex - 1) + 1;\n        }\n    };\n    b2ParticleSystem.prototype.GetCriticalVelocity = function (step) {\n        return this.m_particleDiameter * step.inv_dt;\n    };\n    b2ParticleSystem.prototype.GetCriticalVelocitySquared = function (step) {\n        var velocity = this.GetCriticalVelocity(step);\n        return velocity * velocity;\n    };\n    b2ParticleSystem.prototype.GetCriticalPressure = function (step) {\n        return this.m_def.density * this.GetCriticalVelocitySquared(step);\n    };\n    b2ParticleSystem.prototype.GetParticleStride = function () {\n        return b2Settings_2.b2_particleStride * this.m_particleDiameter;\n    };\n    b2ParticleSystem.prototype.GetParticleMass = function () {\n        var stride = this.GetParticleStride();\n        return this.m_def.density * stride * stride;\n    };\n    b2ParticleSystem.prototype.GetParticleInvMass = function () {\n        /// return 1.777777 * this.m_inverseDensity * this.m_inverseDiameter * this.m_inverseDiameter;\n        // mass = density * stride^2, so we take the inverse of this.\n        var inverseStride = this.m_inverseDiameter * (1.0 / b2Settings_2.b2_particleStride);\n        return this.m_inverseDensity * inverseStride * inverseStride;\n    };\n    /**\n     * Get the world's contact filter if any particles with the\n     * b2_contactFilterParticle flag are present in the system.\n     */\n    b2ParticleSystem.prototype.GetFixtureContactFilter = function () {\n        return (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_fixtureContactFilterParticle) ?\n            this.m_world.m_contactManager.m_contactFilter : null;\n    };\n    /**\n     * Get the world's contact filter if any particles with the\n     * b2_particleContactFilterParticle flag are present in the\n     * system.\n     */\n    b2ParticleSystem.prototype.GetParticleContactFilter = function () {\n        return (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_particleContactFilterParticle) ?\n            this.m_world.m_contactManager.m_contactFilter : null;\n    };\n    /**\n     * Get the world's contact listener if any particles with the\n     * b2_fixtureContactListenerParticle flag are present in the\n     * system.\n     */\n    b2ParticleSystem.prototype.GetFixtureContactListener = function () {\n        return (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_fixtureContactListenerParticle) ?\n            this.m_world.m_contactManager.m_contactListener : null;\n    };\n    /**\n     * Get the world's contact listener if any particles with the\n     * b2_particleContactListenerParticle flag are present in the\n     * system.\n     */\n    b2ParticleSystem.prototype.GetParticleContactListener = function () {\n        return (this.m_allParticleFlags & b2Particle_1.b2ParticleFlag.b2_particleContactListenerParticle) ?\n            this.m_world.m_contactManager.m_contactListener : null;\n    };\n    b2ParticleSystem.prototype.SetUserOverridableBuffer = function (buffer, newData, newCapacity) {\n        b2Assert(((newData !== null) && (newCapacity > 0)) || ((newData === null) && (newCapacity === 0)));\n        /// if (!buffer.userSuppliedCapacity)\n        /// {\n        /// this.m_world.m_blockAllocator.Free(buffer.data, sizeof(T) * m_internalAllocatedCapacity);\n        /// }\n        buffer.data = newData;\n        buffer.userSuppliedCapacity = newCapacity;\n    };\n    b2ParticleSystem.prototype.SetGroupFlags = function (group, newFlags) {\n        var oldFlags = group.m_groupFlags;\n        if ((oldFlags ^ newFlags) & b2ParticleGroup_1.b2ParticleGroupFlag.b2_solidParticleGroup) {\n            // If the b2_solidParticleGroup flag changed schedule depth update.\n            newFlags |= b2ParticleGroup_1.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth;\n        }\n        if (oldFlags & ~newFlags) {\n            // If any flags might be removed\n            this.m_needsUpdateAllGroupFlags = true;\n        }\n        if (~this.m_allGroupFlags & newFlags) {\n            // If any flags were added\n            if (newFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_solidParticleGroup) {\n                this.m_depthBuffer = this.RequestBuffer(this.m_depthBuffer);\n            }\n            this.m_allGroupFlags |= newFlags;\n        }\n        group.m_groupFlags = newFlags;\n    };\n    b2ParticleSystem.BodyContactCompare = function (lhs, rhs) {\n        if (lhs.index === rhs.index) {\n            // Subsort by weight, decreasing.\n            return lhs.weight > rhs.weight;\n        }\n        return lhs.index < rhs.index;\n    };\n    b2ParticleSystem.prototype.RemoveSpuriousBodyContacts = function () {\n        // At this point we have a list of contact candidates based on AABB\n        // overlap.The AABB query that  generated this returns all collidable\n        // fixtures overlapping particle bounding boxes.  This breaks down around\n        // vertices where two shapes intersect, such as a \"ground\" surface made\n        // of multiple b2PolygonShapes; it potentially applies a lot of spurious\n        // impulses from normals that should not actually contribute.  See the\n        // Ramp example in Testbed.\n        //\n        // To correct for this, we apply this algorithm:\n        //   * sort contacts by particle and subsort by weight (nearest to farthest)\n        //   * for each contact per particle:\n        //      - project a point at the contact distance along the inverse of the\n        //        contact normal\n        //      - if this intersects the fixture that generated the contact, apply\n        //         it, otherwise discard as impossible\n        //      - repeat for up to n nearest contacts, currently we get good results\n        //        from n=3.\n        /// std::sort(m_bodyContactBuffer.Begin(), m_bodyContactBuffer.End(), b2ParticleSystem::BodyContactCompare);\n        std_sort(this.m_bodyContactBuffer.data, 0, this.m_bodyContactBuffer.count, b2ParticleSystem.BodyContactCompare);\n        /// int32 discarded = 0;\n        /// std::remove_if(m_bodyContactBuffer.Begin(), m_bodyContactBuffer.End(), b2ParticleBodyContactRemovePredicate(this, &discarded));\n        ///\n        /// m_bodyContactBuffer.SetCount(m_bodyContactBuffer.GetCount() - discarded);\n        var s_n = b2ParticleSystem.RemoveSpuriousBodyContacts_s_n;\n        var s_pos = b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos;\n        var s_normal = b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal;\n        // Max number of contacts processed per particle, from nearest to farthest.\n        // This must be at least 2 for correctness with concave shapes; 3 was\n        // experimentally arrived at as looking reasonable.\n        var k_maxContactsPerPoint = 3;\n        var system = this;\n        // Index of last particle processed.\n        var lastIndex = -1;\n        // Number of contacts processed for the current particle.\n        var currentContacts = 0;\n        // Output the number of discarded contacts.\n        // let discarded = 0;\n        var b2ParticleBodyContactRemovePredicate = function (contact) {\n            // This implements the selection criteria described in\n            // RemoveSpuriousBodyContacts().\n            // This functor is iterating through a list of Body contacts per\n            // Particle, ordered from near to far.  For up to the maximum number of\n            // contacts we allow per point per step, we verify that the contact\n            // normal of the Body that genenerated the contact makes physical sense\n            // by projecting a point back along that normal and seeing if it\n            // intersects the fixture generating the contact.\n            if (contact.index !== lastIndex) {\n                currentContacts = 0;\n                lastIndex = contact.index;\n            }\n            if (currentContacts++ > k_maxContactsPerPoint) {\n                // ++discarded;\n                return true;\n            }\n            // Project along inverse normal (as returned in the contact) to get the\n            // point to check.\n            /// b2Vec2 n = contact.normal;\n            var n = s_n.Copy(contact.normal);\n            // weight is 1-(inv(diameter) * distance)\n            /// n *= system.m_particleDiameter * (1 - contact.weight);\n            n.SelfMul(system.m_particleDiameter * (1 - contact.weight));\n            /// b2Vec2 pos = system.m_positionBuffer.data[contact.index] + n;\n            var pos = b2Math_1.b2Vec2.AddVV(system.m_positionBuffer.data[contact.index], n, s_pos);\n            // pos is now a point projected back along the contact normal to the\n            // contact distance. If the surface makes sense for a contact, pos will\n            // now lie on or in the fixture generating\n            if (!contact.fixture.TestPoint(pos)) {\n                var childCount = contact.fixture.GetShape().GetChildCount();\n                for (var childIndex = 0; childIndex < childCount; childIndex++) {\n                    var normal = s_normal;\n                    var distance = contact.fixture.ComputeDistance(pos, normal, childIndex);\n                    if (distance < b2Settings_1.b2_linearSlop) {\n                        return false;\n                    }\n                }\n                // ++discarded;\n                return true;\n            }\n            return false;\n        };\n        this.m_bodyContactBuffer.count = std_remove_if(this.m_bodyContactBuffer.data, b2ParticleBodyContactRemovePredicate, this.m_bodyContactBuffer.count);\n    };\n    b2ParticleSystem.prototype.DetectStuckParticle = function (particle) {\n        // Detect stuck particles\n        //\n        // The basic algorithm is to allow the user to specify an optional\n        // threshold where we detect whenever a particle is contacting\n        // more than one fixture for more than threshold consecutive\n        // steps. This is considered to be \"stuck\", and these are put\n        // in a list the user can query per step, if enabled, to deal with\n        // such particles.\n        if (this.m_stuckThreshold <= 0) {\n            return;\n        }\n        // Get the state variables for this particle.\n        /// int32 * const consecutiveCount = &m_consecutiveContactStepsBuffer.data[particle];\n        /// int32 * const lastStep = &m_lastBodyContactStepBuffer.data[particle];\n        /// int32 * const bodyCount = &m_bodyContactCountBuffer.data[particle];\n        // This is only called when there is a body contact for this particle.\n        /// ++(*bodyCount);\n        ++this.m_bodyContactCountBuffer.data[particle];\n        // We want to only trigger detection once per step, the first time we\n        // contact more than one fixture in a step for a given particle.\n        /// if (*bodyCount === 2)\n        if (this.m_bodyContactCountBuffer.data[particle] === 2) {\n            /// ++(*consecutiveCount);\n            ++this.m_consecutiveContactStepsBuffer.data[particle];\n            /// if (*consecutiveCount > m_stuckThreshold)\n            if (this.m_consecutiveContactStepsBuffer.data[particle] > this.m_stuckThreshold) {\n                /// int32& newStuckParticle = m_stuckParticleBuffer.Append();\n                /// newStuckParticle = particle;\n                this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()] = particle;\n            }\n        }\n        /// *lastStep = m_timestamp;\n        this.m_lastBodyContactStepBuffer.data[particle] = this.m_timestamp;\n    };\n    /**\n     * Determine whether a particle index is valid.\n     */\n    b2ParticleSystem.prototype.ValidateParticleIndex = function (index) {\n        return index >= 0 && index < this.GetParticleCount() &&\n            index !== b2Settings_1.b2_invalidParticleIndex;\n    };\n    /**\n     * Get the time elapsed in\n     * b2ParticleSystemDef::lifetimeGranularity.\n     */\n    b2ParticleSystem.prototype.GetQuantizedTimeElapsed = function () {\n        /// return (int32)(m_timeElapsed >> 32);\n        return Math.floor(this.m_timeElapsed / 0x100000000);\n    };\n    /**\n     * Convert a lifetime in seconds to an expiration time.\n     */\n    b2ParticleSystem.prototype.LifetimeToExpirationTime = function (lifetime) {\n        /// return m_timeElapsed + (int64)((lifetime / m_def.lifetimeGranularity) * (float32)(1LL << 32));\n        return this.m_timeElapsed + Math.floor(((lifetime / this.m_def.lifetimeGranularity) * 0x100000000));\n    };\n    b2ParticleSystem.prototype.ForceCanBeApplied = function (flags) {\n        return !(flags & b2Particle_1.b2ParticleFlag.b2_wallParticle);\n    };\n    b2ParticleSystem.prototype.PrepareForceBuffer = function () {\n        if (!this.m_hasForce) {\n            /// memset(m_forceBuffer, 0, sizeof(*m_forceBuffer) * m_count);\n            for (var i = 0; i < this.m_count; i++) {\n                this.m_forceBuffer[i].SetZero();\n            }\n            this.m_hasForce = true;\n        }\n    };\n    b2ParticleSystem.prototype.IsRigidGroup = function (group) {\n        return (group !== null) && ((group.m_groupFlags & b2ParticleGroup_1.b2ParticleGroupFlag.b2_rigidParticleGroup) !== 0);\n    };\n    b2ParticleSystem.prototype.GetLinearVelocity = function (group, particleIndex, point, out) {\n        if (this.IsRigidGroup(group)) {\n            return group.GetLinearVelocityFromWorldPoint(point, out);\n        }\n        else {\n            /// return m_velocityBuffer.data[particleIndex];\n            return out.Copy(this.m_velocityBuffer.data[particleIndex]);\n        }\n    };\n    b2ParticleSystem.prototype.InitDampingParameter = function (invMass, invInertia, tangentDistance, mass, inertia, center, point, normal) {\n        /// *invMass = mass > 0 ? 1 / mass : 0;\n        invMass[0] = mass > 0 ? 1 / mass : 0;\n        /// *invInertia = inertia > 0 ? 1 / inertia : 0;\n        invInertia[0] = inertia > 0 ? 1 / inertia : 0;\n        /// *tangentDistance = b2Cross(point - center, normal);\n        tangentDistance[0] = b2Math_1.b2Vec2.CrossVV(b2Math_1.b2Vec2.SubVV(point, center, b2Math_1.b2Vec2.s_t0), normal);\n    };\n    b2ParticleSystem.prototype.InitDampingParameterWithRigidGroupOrParticle = function (invMass, invInertia, tangentDistance, isRigidGroup, group, particleIndex, point, normal) {\n        if (isRigidGroup) {\n            this.InitDampingParameter(invMass, invInertia, tangentDistance, group.GetMass(), group.GetInertia(), group.GetCenter(), point, normal);\n        }\n        else {\n            var flags = this.m_flagsBuffer.data[particleIndex];\n            this.InitDampingParameter(invMass, invInertia, tangentDistance, flags & b2Particle_1.b2ParticleFlag.b2_wallParticle ? 0 : this.GetParticleMass(), 0, point, point, normal);\n        }\n    };\n    b2ParticleSystem.prototype.ComputeDampingImpulse = function (invMassA, invInertiaA, tangentDistanceA, invMassB, invInertiaB, tangentDistanceB, normalVelocity) {\n        var invMass = invMassA + invInertiaA * tangentDistanceA * tangentDistanceA +\n            invMassB + invInertiaB * tangentDistanceB * tangentDistanceB;\n        return invMass > 0 ? normalVelocity / invMass : 0;\n    };\n    b2ParticleSystem.prototype.ApplyDamping = function (invMass, invInertia, tangentDistance, isRigidGroup, group, particleIndex, impulse, normal) {\n        if (isRigidGroup) {\n            /// group.m_linearVelocity += impulse * invMass * normal;\n            group.m_linearVelocity.SelfMulAdd(impulse * invMass, normal);\n            /// group.m_angularVelocity += impulse * tangentDistance * invInertia;\n            group.m_angularVelocity += impulse * tangentDistance * invInertia;\n        }\n        else {\n            /// m_velocityBuffer.data[particleIndex] += impulse * invMass * normal;\n            this.m_velocityBuffer.data[particleIndex].SelfMulAdd(impulse * invMass, normal);\n        }\n    };\n    b2ParticleSystem.xTruncBits = 12;\n    b2ParticleSystem.yTruncBits = 12;\n    b2ParticleSystem.tagBits = 8 * 4; // 8u * sizeof(uint32);\n    b2ParticleSystem.yOffset = 1 << (b2ParticleSystem.yTruncBits - 1);\n    b2ParticleSystem.yShift = b2ParticleSystem.tagBits - b2ParticleSystem.yTruncBits;\n    b2ParticleSystem.xShift = b2ParticleSystem.tagBits - b2ParticleSystem.yTruncBits - b2ParticleSystem.xTruncBits;\n    b2ParticleSystem.xScale = 1 << b2ParticleSystem.xShift;\n    b2ParticleSystem.xOffset = b2ParticleSystem.xScale * (1 << (b2ParticleSystem.xTruncBits - 1));\n    b2ParticleSystem.yMask = ((1 << b2ParticleSystem.yTruncBits) - 1) << b2ParticleSystem.yShift;\n    b2ParticleSystem.xMask = ~b2ParticleSystem.yMask;\n    b2ParticleSystem.DestroyParticlesInShape_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.CreateParticleGroup_s_transform = new b2Math_1.b2Transform();\n    b2ParticleSystem.ComputeCollisionEnergy_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.QueryShapeAABB_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.QueryPointAABB_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.RayCast_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.RayCast_s_p = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RayCast_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RayCast_s_n = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RayCast_s_point = new b2Math_1.b2Vec2();\n    /**\n     * All particle types that require creating pairs\n     */\n    b2ParticleSystem.k_pairFlags = b2Particle_1.b2ParticleFlag.b2_springParticle;\n    /**\n     * All particle types that require creating triads\n     */\n    b2ParticleSystem.k_triadFlags = b2Particle_1.b2ParticleFlag.b2_elasticParticle;\n    /**\n     * All particle types that do not produce dynamic pressure\n     */\n    b2ParticleSystem.k_noPressureFlags = b2Particle_1.b2ParticleFlag.b2_powderParticle | b2Particle_1.b2ParticleFlag.b2_tensileParticle;\n    /**\n     * All particle types that apply extra damping force with bodies\n     */\n    b2ParticleSystem.k_extraDampingFlags = b2Particle_1.b2ParticleFlag.b2_staticPressureParticle;\n    b2ParticleSystem.k_barrierWallFlags = b2Particle_1.b2ParticleFlag.b2_barrierParticle | b2Particle_1.b2ParticleFlag.b2_wallParticle;\n    b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_edge = new b2EdgeShape_1.b2EdgeShape();\n    b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_d = new b2Math_1.b2Vec2();\n    b2ParticleSystem.CreateParticlesStrokeShapeForGroup_s_p = new b2Math_1.b2Vec2();\n    b2ParticleSystem.CreateParticlesFillShapeForGroup_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.CreateParticlesFillShapeForGroup_s_p = new b2Math_1.b2Vec2();\n    b2ParticleSystem.UpdatePairsAndTriads_s_dab = new b2Math_1.b2Vec2();\n    b2ParticleSystem.UpdatePairsAndTriads_s_dbc = new b2Math_1.b2Vec2();\n    b2ParticleSystem.UpdatePairsAndTriads_s_dca = new b2Math_1.b2Vec2();\n    b2ParticleSystem.AddContact_s_d = new b2Math_1.b2Vec2();\n    b2ParticleSystem.UpdateBodyContacts_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.Solve_s_subStep = new b2TimeStep_1.b2TimeStep();\n    b2ParticleSystem.SolveCollision_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.SolveGravity_s_gravity = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_aabb = new b2Collision_1.b2AABB();\n    b2ParticleSystem.SolveBarrier_s_va = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_vb = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_pba = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_vba = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_vc = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_pca = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_vca = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_qba = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_qca = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_dv = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveBarrier_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolvePressure_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveDamping_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveDamping_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigidDamping_s_t0 = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigidDamping_s_t1 = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigidDamping_s_p = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigidDamping_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveExtraDamping_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveExtraDamping_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigid_s_position = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRigid_s_rotation = new b2Math_1.b2Rot();\n    b2ParticleSystem.SolveRigid_s_transform = new b2Math_1.b2Transform();\n    b2ParticleSystem.SolveRigid_s_velocityTransform = new b2Math_1.b2Transform();\n    b2ParticleSystem.SolveElastic_s_pa = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveElastic_s_pb = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveElastic_s_pc = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveElastic_s_r = new b2Math_1.b2Rot();\n    b2ParticleSystem.SolveElastic_s_t0 = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveSpring_s_pa = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveSpring_s_pb = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveSpring_s_d = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveSpring_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveTensile_s_weightedNormal = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveTensile_s_s = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveTensile_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveViscous_s_v = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveViscous_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveRepulsive_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolvePowder_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.SolveSolid_s_f = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RemoveSpuriousBodyContacts_s_n = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RemoveSpuriousBodyContacts_s_pos = new b2Math_1.b2Vec2();\n    b2ParticleSystem.RemoveSpuriousBodyContacts_s_normal = new b2Math_1.b2Vec2();\n    return b2ParticleSystem;\n}());\nexports.b2ParticleSystem = b2ParticleSystem;\n(function (b2ParticleSystem) {\n    var UserOverridableBuffer = /** @class */ (function () {\n        function UserOverridableBuffer() {\n            this.data = null;\n            this.userSuppliedCapacity = 0;\n        }\n        return UserOverridableBuffer;\n    }());\n    b2ParticleSystem.UserOverridableBuffer = UserOverridableBuffer;\n    var Proxy = /** @class */ (function () {\n        function Proxy() {\n            this.index = b2Settings_1.b2_invalidParticleIndex;\n            this.tag = 0;\n        }\n        Proxy.CompareProxyProxy = function (a, b) {\n            return a.tag < b.tag;\n        };\n        Proxy.CompareTagProxy = function (a, b) {\n            return a < b.tag;\n        };\n        Proxy.CompareProxyTag = function (a, b) {\n            return a.tag < b;\n        };\n        return Proxy;\n    }());\n    b2ParticleSystem.Proxy = Proxy;\n    var InsideBoundsEnumerator = /** @class */ (function () {\n        /**\n         * InsideBoundsEnumerator enumerates all particles inside the\n         * given bounds.\n         *\n         * Construct an enumerator with bounds of tags and a range of\n         * proxies.\n         */\n        function InsideBoundsEnumerator(system, lower, upper, first, last) {\n            this.m_system = system;\n            this.m_xLower = (lower & b2ParticleSystem.xMask) >>> 0;\n            this.m_xUpper = (upper & b2ParticleSystem.xMask) >>> 0;\n            this.m_yLower = (lower & b2ParticleSystem.yMask) >>> 0;\n            this.m_yUpper = (upper & b2ParticleSystem.yMask) >>> 0;\n            this.m_first = first;\n            this.m_last = last;\n            b2Assert(this.m_first <= this.m_last);\n        }\n        /**\n         * Get index of the next particle. Returns\n         * b2_invalidParticleIndex if there are no more particles.\n         */\n        InsideBoundsEnumerator.prototype.GetNext = function () {\n            while (this.m_first < this.m_last) {\n                var xTag = (this.m_system.m_proxyBuffer.data[this.m_first].tag & b2ParticleSystem.xMask) >>> 0;\n                // #if B2_ASSERT_ENABLED\n                /// let yTag = (this.m_system.m_proxyBuffer.data[this.m_first].tag & b2ParticleSystem.yMask) >>> 0;\n                /// b2Assert(yTag >= this.m_yLower);\n                /// b2Assert(yTag <= this.m_yUpper);\n                // #endif\n                if (xTag >= this.m_xLower && xTag <= this.m_xUpper) {\n                    return (this.m_system.m_proxyBuffer.data[this.m_first++]).index;\n                }\n                this.m_first++;\n            }\n            return b2Settings_1.b2_invalidParticleIndex;\n        };\n        return InsideBoundsEnumerator;\n    }());\n    b2ParticleSystem.InsideBoundsEnumerator = InsideBoundsEnumerator;\n    var ParticleListNode = /** @class */ (function () {\n        function ParticleListNode() {\n            /**\n             * The head of the list.\n             */\n            this.list = null;\n            /**\n             * The next node in the list.\n             */\n            this.next = null;\n            /**\n             * Number of entries in the list. Valid only for the node at the\n             * head of the list.\n             */\n            this.count = 0;\n            /**\n             * Particle index.\n             */\n            this.index = 0;\n        }\n        return ParticleListNode;\n    }());\n    b2ParticleSystem.ParticleListNode = ParticleListNode;\n    /**\n     * @constructor\n     */\n    var FixedSetAllocator = /** @class */ (function () {\n        function FixedSetAllocator() {\n        }\n        FixedSetAllocator.prototype.Allocate = function (itemSize, count) {\n            // TODO\n            return count;\n        };\n        FixedSetAllocator.prototype.Clear = function () {\n            // TODO\n        };\n        FixedSetAllocator.prototype.GetCount = function () {\n            // TODO\n            return 0;\n        };\n        FixedSetAllocator.prototype.Invalidate = function (itemIndex) {\n            // TODO\n        };\n        FixedSetAllocator.prototype.GetValidBuffer = function () {\n            // TODO\n            return [];\n        };\n        FixedSetAllocator.prototype.GetBuffer = function () {\n            // TODO\n            return [];\n        };\n        FixedSetAllocator.prototype.SetCount = function (count) {\n            // TODO\n        };\n        return FixedSetAllocator;\n    }());\n    b2ParticleSystem.FixedSetAllocator = FixedSetAllocator;\n    var FixtureParticle = /** @class */ (function () {\n        function FixtureParticle(fixture, particle) {\n            this.second = b2Settings_1.b2_invalidParticleIndex;\n            this.first = fixture;\n            this.second = particle;\n        }\n        return FixtureParticle;\n    }());\n    b2ParticleSystem.FixtureParticle = FixtureParticle;\n    var FixtureParticleSet = /** @class */ (function (_super) {\n        __extends(FixtureParticleSet, _super);\n        function FixtureParticleSet() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        FixtureParticleSet.prototype.Initialize = function (bodyContactBuffer, flagsBuffer) {\n            // TODO\n        };\n        FixtureParticleSet.prototype.Find = function (pair) {\n            // TODO\n            return b2Settings_1.b2_invalidParticleIndex;\n        };\n        return FixtureParticleSet;\n    }(b2ParticleSystem.FixedSetAllocator));\n    b2ParticleSystem.FixtureParticleSet = FixtureParticleSet;\n    var ParticlePair = /** @class */ (function () {\n        function ParticlePair(particleA, particleB) {\n            this.first = b2Settings_1.b2_invalidParticleIndex;\n            this.second = b2Settings_1.b2_invalidParticleIndex;\n            this.first = particleA;\n            this.second = particleB;\n        }\n        return ParticlePair;\n    }());\n    b2ParticleSystem.ParticlePair = ParticlePair;\n    var b2ParticlePairSet = /** @class */ (function (_super) {\n        __extends(b2ParticlePairSet, _super);\n        function b2ParticlePairSet() {\n            return _super !== null && _super.apply(this, arguments) || this;\n        }\n        b2ParticlePairSet.prototype.Initialize = function (contactBuffer, flagsBuffer) {\n            // TODO\n        };\n        b2ParticlePairSet.prototype.Find = function (pair) {\n            // TODO\n            return b2Settings_1.b2_invalidParticleIndex;\n        };\n        return b2ParticlePairSet;\n    }(b2ParticleSystem.FixedSetAllocator));\n    b2ParticleSystem.b2ParticlePairSet = b2ParticlePairSet;\n    var ConnectionFilter = /** @class */ (function () {\n        function ConnectionFilter() {\n        }\n        /**\n         * Is the particle necessary for connection?\n         * A pair or a triad should contain at least one 'necessary'\n         * particle.\n         */\n        ConnectionFilter.prototype.IsNecessary = function (index) {\n            return true;\n        };\n        /**\n         * An additional condition for creating a pair.\n         */\n        ConnectionFilter.prototype.ShouldCreatePair = function (a, b) {\n            return true;\n        };\n        /**\n         * An additional condition for creating a triad.\n         */\n        ConnectionFilter.prototype.ShouldCreateTriad = function (a, b, c) {\n            return true;\n        };\n        return ConnectionFilter;\n    }());\n    b2ParticleSystem.ConnectionFilter = ConnectionFilter;\n    var DestroyParticlesInShapeCallback = /** @class */ (function (_super) {\n        __extends(DestroyParticlesInShapeCallback, _super);\n        function DestroyParticlesInShapeCallback(system, shape, xf, callDestructionListener) {\n            var _this = _super.call(this) || this;\n            _this.m_callDestructionListener = false;\n            _this.m_destroyed = 0;\n            _this.m_system = system;\n            _this.m_shape = shape;\n            _this.m_xf = xf;\n            _this.m_callDestructionListener = callDestructionListener;\n            _this.m_destroyed = 0;\n            return _this;\n        }\n        DestroyParticlesInShapeCallback.prototype.ReportFixture = function (fixture) {\n            return false;\n        };\n        DestroyParticlesInShapeCallback.prototype.ReportParticle = function (particleSystem, index) {\n            if (particleSystem !== this.m_system) {\n                return false;\n            }\n            b2Assert(index >= 0 && index < this.m_system.m_count);\n            if (this.m_shape.TestPoint(this.m_xf, this.m_system.m_positionBuffer.data[index])) {\n                this.m_system.DestroyParticle(index, this.m_callDestructionListener);\n                this.m_destroyed++;\n            }\n            return true;\n        };\n        DestroyParticlesInShapeCallback.prototype.Destroyed = function () {\n            return this.m_destroyed;\n        };\n        return DestroyParticlesInShapeCallback;\n    }(b2WorldCallbacks_1.b2QueryCallback));\n    b2ParticleSystem.DestroyParticlesInShapeCallback = DestroyParticlesInShapeCallback;\n    var JoinParticleGroupsFilter = /** @class */ (function (_super) {\n        __extends(JoinParticleGroupsFilter, _super);\n        function JoinParticleGroupsFilter(threshold) {\n            var _this = _super.call(this) || this;\n            _this.m_threshold = 0;\n            _this.m_threshold = threshold;\n            return _this;\n        }\n        /**\n         * An additional condition for creating a pair.\n         */\n        JoinParticleGroupsFilter.prototype.ShouldCreatePair = function (a, b) {\n            return (a < this.m_threshold && this.m_threshold <= b) ||\n                (b < this.m_threshold && this.m_threshold <= a);\n        };\n        /**\n         * An additional condition for creating a triad.\n         */\n        JoinParticleGroupsFilter.prototype.ShouldCreateTriad = function (a, b, c) {\n            return (a < this.m_threshold || b < this.m_threshold || c < this.m_threshold) &&\n                (this.m_threshold <= a || this.m_threshold <= b || this.m_threshold <= c);\n        };\n        return JoinParticleGroupsFilter;\n    }(b2ParticleSystem.ConnectionFilter));\n    b2ParticleSystem.JoinParticleGroupsFilter = JoinParticleGroupsFilter;\n    var CompositeShape = /** @class */ (function (_super) {\n        __extends(CompositeShape, _super);\n        function CompositeShape(shapes, shapeCount) {\n            if (shapeCount === void 0) { shapeCount = shapes.length; }\n            var _this = _super.call(this, b2Shape_1.b2ShapeType.e_unknown, 0) || this;\n            _this.m_shapeCount = 0;\n            _this.m_shapes = shapes;\n            _this.m_shapeCount = shapeCount;\n            return _this;\n        }\n        CompositeShape.prototype.Clone = function () {\n            b2Assert(false);\n            throw new Error();\n        };\n        CompositeShape.prototype.GetChildCount = function () {\n            return 1;\n        };\n        /**\n         * @see b2Shape::TestPoint\n         */\n        CompositeShape.prototype.TestPoint = function (xf, p) {\n            for (var i = 0; i < this.m_shapeCount; i++) {\n                if (this.m_shapes[i].TestPoint(xf, p)) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        /**\n         * @see b2Shape::ComputeDistance\n         */\n        CompositeShape.prototype.ComputeDistance = function (xf, p, normal, childIndex) {\n            b2Assert(false);\n            return 0;\n        };\n        /**\n         * Implement b2Shape.\n         */\n        CompositeShape.prototype.RayCast = function (output, input, xf, childIndex) {\n            b2Assert(false);\n            return false;\n        };\n        /**\n         * @see b2Shape::ComputeAABB\n         */\n        CompositeShape.prototype.ComputeAABB = function (aabb, xf, childIndex) {\n            var s_subaabb = new b2Collision_1.b2AABB();\n            aabb.lowerBound.x = +b2Settings_1.b2_maxFloat;\n            aabb.lowerBound.y = +b2Settings_1.b2_maxFloat;\n            aabb.upperBound.x = -b2Settings_1.b2_maxFloat;\n            aabb.upperBound.y = -b2Settings_1.b2_maxFloat;\n            b2Assert(childIndex === 0);\n            for (var i = 0; i < this.m_shapeCount; i++) {\n                var childCount = this.m_shapes[i].GetChildCount();\n                for (var j = 0; j < childCount; j++) {\n                    var subaabb = s_subaabb;\n                    this.m_shapes[i].ComputeAABB(subaabb, xf, j);\n                    aabb.Combine1(subaabb);\n                }\n            }\n        };\n        /**\n         * @see b2Shape::ComputeMass\n         */\n        CompositeShape.prototype.ComputeMass = function (massData, density) {\n            b2Assert(false);\n        };\n        CompositeShape.prototype.SetupDistanceProxy = function (proxy, index) {\n            b2Assert(false);\n        };\n        CompositeShape.prototype.ComputeSubmergedArea = function (normal, offset, xf, c) {\n            b2Assert(false);\n            return 0;\n        };\n        CompositeShape.prototype.Dump = function (log) {\n            b2Assert(false);\n        };\n        return CompositeShape;\n    }(b2Shape_1.b2Shape));\n    b2ParticleSystem.CompositeShape = CompositeShape;\n    var ReactiveFilter = /** @class */ (function (_super) {\n        __extends(ReactiveFilter, _super);\n        function ReactiveFilter(flagsBuffer) {\n            var _this = _super.call(this) || this;\n            _this.m_flagsBuffer = flagsBuffer;\n            return _this;\n        }\n        ReactiveFilter.prototype.IsNecessary = function (index) {\n            return (this.m_flagsBuffer.data[index] & b2Particle_1.b2ParticleFlag.b2_reactiveParticle) !== 0;\n        };\n        return ReactiveFilter;\n    }(b2ParticleSystem.ConnectionFilter));\n    b2ParticleSystem.ReactiveFilter = ReactiveFilter;\n    var UpdateBodyContactsCallback = /** @class */ (function (_super) {\n        __extends(UpdateBodyContactsCallback, _super);\n        function UpdateBodyContactsCallback(system, contactFilter) {\n            var _this = _super.call(this, system) || this;\n            _this.m_contactFilter = contactFilter;\n            return _this;\n        }\n        UpdateBodyContactsCallback.prototype.ShouldCollideFixtureParticle = function (fixture, particleSystem, particleIndex) {\n            // Call the contact filter if it's set, to determine whether to\n            // filter this contact.  Returns true if contact calculations should\n            // be performed, false otherwise.\n            if (this.m_contactFilter) {\n                var flags = this.m_system.GetFlagsBuffer();\n                if (flags[particleIndex] & b2Particle_1.b2ParticleFlag.b2_fixtureContactFilterParticle) {\n                    return this.m_contactFilter.ShouldCollideFixtureParticle(fixture, this.m_system, particleIndex);\n                }\n            }\n            return true;\n        };\n        UpdateBodyContactsCallback.prototype.ReportFixtureAndParticle = function (fixture, childIndex, a) {\n            var s_n = b2ParticleSystem.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n;\n            var s_rp = b2ParticleSystem.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;\n            var ap = this.m_system.m_positionBuffer.data[a];\n            var n = s_n;\n            var d = fixture.ComputeDistance(ap, n, childIndex);\n            if (d < this.m_system.m_particleDiameter && this.ShouldCollideFixtureParticle(fixture, this.m_system, a)) {\n                var b = fixture.GetBody();\n                var bp = b.GetWorldCenter();\n                var bm = b.GetMass();\n                var bI = b.GetInertia() - bm * b.GetLocalCenter().LengthSquared();\n                var invBm = bm > 0 ? 1 / bm : 0;\n                var invBI = bI > 0 ? 1 / bI : 0;\n                var invAm = this.m_system.m_flagsBuffer.data[a] &\n                    b2Particle_1.b2ParticleFlag.b2_wallParticle ? 0 : this.m_system.GetParticleInvMass();\n                /// b2Vec2 rp = ap - bp;\n                var rp = b2Math_1.b2Vec2.SubVV(ap, bp, s_rp);\n                var rpn = b2Math_1.b2Vec2.CrossVV(rp, n);\n                var invM = invAm + invBm + invBI * rpn * rpn;\n                /// b2ParticleBodyContact& contact = m_system.m_bodyContactBuffer.Append();\n                var contact = this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];\n                contact.index = a;\n                contact.body = b;\n                contact.fixture = fixture;\n                contact.weight = 1 - d * this.m_system.m_inverseDiameter;\n                /// contact.normal = -n;\n                contact.normal.Copy(n.SelfNeg());\n                contact.mass = invM > 0 ? 1 / invM : 0;\n                this.m_system.DetectStuckParticle(a);\n            }\n        };\n        UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n = new b2Math_1.b2Vec2();\n        UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp = new b2Math_1.b2Vec2();\n        return UpdateBodyContactsCallback;\n    }(b2FixtureParticleQueryCallback));\n    b2ParticleSystem.UpdateBodyContactsCallback = UpdateBodyContactsCallback;\n    var SolveCollisionCallback = /** @class */ (function (_super) {\n        __extends(SolveCollisionCallback, _super);\n        function SolveCollisionCallback(system, step) {\n            var _this = _super.call(this, system) || this;\n            _this.m_step = step;\n            return _this;\n        }\n        SolveCollisionCallback.prototype.ReportFixtureAndParticle = function (fixture, childIndex, a) {\n            var s_p1 = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_p1;\n            var s_output = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_output;\n            var s_input = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_input;\n            var s_p = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_p;\n            var s_v = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_v;\n            var s_f = b2ParticleSystem.SolveCollisionCallback.ReportFixtureAndParticle_s_f;\n            var body = fixture.GetBody();\n            var ap = this.m_system.m_positionBuffer.data[a];\n            var av = this.m_system.m_velocityBuffer.data[a];\n            var output = s_output;\n            var input = s_input;\n            if (this.m_system.m_iterationIndex === 0) {\n                // Put 'ap' in the local space of the previous frame\n                /// b2Vec2 p1 = b2MulT(body.m_xf0, ap);\n                var p1 = b2Math_1.b2Transform.MulTXV(body.m_xf0, ap, s_p1);\n                if (fixture.GetShape().GetType() === b2Shape_1.b2ShapeType.e_circleShape) {\n                    // Make relative to the center of the circle\n                    /// p1 -= body.GetLocalCenter();\n                    p1.SelfSub(body.GetLocalCenter());\n                    // Re-apply rotation about the center of the circle\n                    /// p1 = b2Mul(body.m_xf0.q, p1);\n                    b2Math_1.b2Rot.MulRV(body.m_xf0.q, p1, p1);\n                    // Subtract rotation of the current frame\n                    /// p1 = b2MulT(body.m_xf.q, p1);\n                    b2Math_1.b2Rot.MulTRV(body.m_xf.q, p1, p1);\n                    // Return to local space\n                    /// p1 += body.GetLocalCenter();\n                    p1.SelfAdd(body.GetLocalCenter());\n                }\n                // Return to global space and apply rotation of current frame\n                /// input.p1 = b2Mul(body.m_xf, p1);\n                b2Math_1.b2Transform.MulXV(body.m_xf, p1, input.p1);\n            }\n            else {\n                /// input.p1 = ap;\n                input.p1.Copy(ap);\n            }\n            /// input.p2 = ap + m_step.dt * av;\n            b2Math_1.b2Vec2.AddVMulSV(ap, this.m_step.dt, av, input.p2);\n            input.maxFraction = 1;\n            if (fixture.RayCast(output, input, childIndex)) {\n                var n = output.normal;\n                /// b2Vec2 p = (1 - output.fraction) * input.p1 + output.fraction * input.p2 + b2_linearSlop * n;\n                var p = s_p;\n                p.x = (1 - output.fraction) * input.p1.x + output.fraction * input.p2.x + b2Settings_1.b2_linearSlop * n.x;\n                p.y = (1 - output.fraction) * input.p1.y + output.fraction * input.p2.y + b2Settings_1.b2_linearSlop * n.y;\n                /// b2Vec2 v = m_step.inv_dt * (p - ap);\n                var v = s_v;\n                v.x = this.m_step.inv_dt * (p.x - ap.x);\n                v.y = this.m_step.inv_dt * (p.y - ap.y);\n                /// m_system.m_velocityBuffer.data[a] = v;\n                this.m_system.m_velocityBuffer.data[a].Copy(v);\n                /// b2Vec2 f = m_step.inv_dt * m_system.GetParticleMass() * (av - v);\n                var f = s_f;\n                f.x = this.m_step.inv_dt * this.m_system.GetParticleMass() * (av.x - v.x);\n                f.y = this.m_step.inv_dt * this.m_system.GetParticleMass() * (av.y - v.y);\n                this.m_system.ParticleApplyForce(a, f);\n            }\n        };\n        SolveCollisionCallback.prototype.ReportParticle = function (system, index) {\n            return false;\n        };\n        SolveCollisionCallback.ReportFixtureAndParticle_s_p1 = new b2Math_1.b2Vec2();\n        SolveCollisionCallback.ReportFixtureAndParticle_s_output = new b2Collision_1.b2RayCastOutput();\n        SolveCollisionCallback.ReportFixtureAndParticle_s_input = new b2Collision_1.b2RayCastInput();\n        SolveCollisionCallback.ReportFixtureAndParticle_s_p = new b2Math_1.b2Vec2();\n        SolveCollisionCallback.ReportFixtureAndParticle_s_v = new b2Math_1.b2Vec2();\n        SolveCollisionCallback.ReportFixtureAndParticle_s_f = new b2Math_1.b2Vec2();\n        return SolveCollisionCallback;\n    }(b2FixtureParticleQueryCallback));\n    b2ParticleSystem.SolveCollisionCallback = SolveCollisionCallback;\n})(b2ParticleSystem = exports.b2ParticleSystem || (exports.b2ParticleSystem = {}));\nexports.b2ParticleSystem = b2ParticleSystem;\n// #endif\n\n\n//# sourceURL=webpack:///./src/Box2D/Particle/b2ParticleSystem.ts?");

/***/ }),

/***/ "./src/Box2D/Particle/b2StackQueue.ts":
/*!********************************************!*\
  !*** ./src/Box2D/Particle/b2StackQueue.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n * Copyright (c) 2013 Google, Inc.\n *\n * This software is provided 'as-is', without any express or implied\n * warranty.  In no event will the authors be held liable for any damages\n * arising from the use of this software.\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n * 1. The origin of this software must not be misrepresented; you must not\n * claim that you wrote the original software. If you use this software\n * in a product, an acknowledgment in the product documentation would be\n * appreciated but is not required.\n * 2. Altered source versions must be plainly marked as such, and must not be\n * misrepresented as being the original software.\n * 3. This notice may not be removed or altered from any source distribution.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// #if B2_ENABLE_PARTICLE\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nfunction b2Assert(condition) { }\nvar b2StackQueue = /** @class */ (function () {\n    function b2StackQueue(capacity) {\n        this.m_front = 0;\n        this.m_back = 0;\n        this.m_capacity = 0;\n        this.m_buffer = b2Settings_1.b2MakeArray(capacity, function (index) { return null; });\n        /// this.m_end = capacity; // TODO: this was wrong!\n        this.m_capacity = capacity;\n    }\n    b2StackQueue.prototype.Push = function (item) {\n        if (this.m_back >= this.m_capacity) {\n            for (var i = this.m_front; i < this.m_back; i++) {\n                this.m_buffer[i - this.m_front] = this.m_buffer[i];\n            }\n            this.m_back -= this.m_front;\n            this.m_front = 0;\n            if (this.m_back >= this.m_capacity) {\n                if (this.m_capacity > 0) {\n                    this.m_buffer.concat(b2Settings_1.b2MakeArray(this.m_capacity, function (index) { return null; }));\n                    this.m_capacity *= 2;\n                }\n                else {\n                    this.m_buffer.concat(b2Settings_1.b2MakeArray(1, function (index) { return null; }));\n                    this.m_capacity = 1;\n                }\n                /// m_buffer = (T*) m_allocator->Reallocate(m_buffer, sizeof(T) * m_capacity);\n            }\n        }\n        this.m_buffer[this.m_back] = item;\n        this.m_back++;\n    };\n    b2StackQueue.prototype.Pop = function () {\n        b2Assert(this.m_front < this.m_back);\n        delete this.m_buffer[this.m_front];\n        this.m_front++;\n    };\n    b2StackQueue.prototype.Empty = function () {\n        b2Assert(this.m_front <= this.m_back);\n        return this.m_front === this.m_back;\n    };\n    b2StackQueue.prototype.Front = function () {\n        return this.m_buffer[this.m_front];\n    };\n    return b2StackQueue;\n}());\nexports.b2StackQueue = b2StackQueue;\n// #endif\n\n\n//# sourceURL=webpack:///./src/Box2D/Particle/b2StackQueue.ts?");

/***/ }),

/***/ "./src/Box2D/Particle/b2VoronoiDiagram.ts":
/*!************************************************!*\
  !*** ./src/Box2D/Particle/b2VoronoiDiagram.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n * Copyright (c) 2013 Google, Inc.\n *\n * This software is provided 'as-is', without any express or implied\n * warranty.  In no event will the authors be held liable for any damages\n * arising from the use of this software.\n * Permission is granted to anyone to use this software for any purpose,\n * including commercial applications, and to alter it and redistribute it\n * freely, subject to the following restrictions:\n * 1. The origin of this software must not be misrepresented; you must not\n * claim that you wrote the original software. If you use this software\n * in a product, an acknowledgment in the product documentation would be\n * appreciated but is not required.\n * 2. Altered source versions must be plainly marked as such, and must not be\n * misrepresented as being the original software.\n * 3. This notice may not be removed or altered from any source distribution.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// #if B2_ENABLE_PARTICLE\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\nvar b2StackQueue_1 = __webpack_require__(/*! ./b2StackQueue */ \"./src/Box2D/Particle/b2StackQueue.ts\");\nfunction b2Assert(condition) { }\n/**\n * A field representing the nearest generator from each point.\n */\nvar b2VoronoiDiagram = /** @class */ (function () {\n    function b2VoronoiDiagram(generatorCapacity) {\n        this.m_generatorBuffer = null;\n        this.m_generatorCapacity = 0;\n        this.m_generatorCount = 0;\n        this.m_countX = 0;\n        this.m_countY = 0;\n        this.m_diagram = null;\n        this.m_generatorBuffer = b2Settings_1.b2MakeArray(generatorCapacity, function (index) { return new b2VoronoiDiagram.Generator(); });\n        this.m_generatorCapacity = generatorCapacity;\n    }\n    /**\n     * Add a generator.\n     *\n     * @param center the position of the generator.\n     * @param tag a tag used to identify the generator in callback functions.\n     * @param necessary whether to callback for nodes associated with the generator.\n     */\n    b2VoronoiDiagram.prototype.AddGenerator = function (center, tag, necessary) {\n        b2Assert(this.m_generatorCount < this.m_generatorCapacity);\n        var g = this.m_generatorBuffer[this.m_generatorCount++];\n        g.center.Copy(center);\n        g.tag = tag;\n        g.necessary = necessary;\n    };\n    /**\n     * Generate the Voronoi diagram. It is rasterized with a given\n     * interval in the same range as the necessary generators exist.\n     *\n     * @param radius the interval of the diagram.\n     * @param margin margin for which the range of the diagram is extended.\n     */\n    b2VoronoiDiagram.prototype.Generate = function (radius, margin) {\n        b2Assert(this.m_diagram === null);\n        var inverseRadius = 1 / radius;\n        var lower = new b2Math_1.b2Vec2(+b2Settings_1.b2_maxFloat, +b2Settings_1.b2_maxFloat);\n        var upper = new b2Math_1.b2Vec2(-b2Settings_1.b2_maxFloat, -b2Settings_1.b2_maxFloat);\n        var necessary_count = 0;\n        for (var k = 0; k < this.m_generatorCount; k++) {\n            var g = this.m_generatorBuffer[k];\n            if (g.necessary) {\n                b2Math_1.b2Vec2.MinV(lower, g.center, lower);\n                b2Math_1.b2Vec2.MaxV(upper, g.center, upper);\n                ++necessary_count;\n            }\n        }\n        if (necessary_count === 0) {\n            /// debugger;\n            this.m_countX = 0;\n            this.m_countY = 0;\n            return;\n        }\n        lower.x -= margin;\n        lower.y -= margin;\n        upper.x += margin;\n        upper.y += margin;\n        this.m_countX = 1 + Math.floor(inverseRadius * (upper.x - lower.x));\n        this.m_countY = 1 + Math.floor(inverseRadius * (upper.y - lower.y));\n        ///  m_diagram = (Generator**) m_allocator->Allocate(sizeof(Generator*) * m_countX * m_countY);\n        ///  for (int32 i = 0; i < m_countX * m_countY; i++)\n        ///  {\n        ///    m_diagram[i] = NULL;\n        ///  }\n        this.m_diagram = b2Settings_1.b2MakeArray(this.m_countX * this.m_countY, function (index) { return null; });\n        // (4 * m_countX * m_countY) is the queue capacity that is experimentally\n        // known to be necessary and sufficient for general particle distributions.\n        var queue = new b2StackQueue_1.b2StackQueue(4 * this.m_countX * this.m_countY);\n        for (var k = 0; k < this.m_generatorCount; k++) {\n            var g = this.m_generatorBuffer[k];\n            ///  g.center = inverseRadius * (g.center - lower);\n            g.center.SelfSub(lower).SelfMul(inverseRadius);\n            var x = Math.floor(g.center.x);\n            var y = Math.floor(g.center.y);\n            if (x >= 0 && y >= 0 && x < this.m_countX && y < this.m_countY) {\n                queue.Push(new b2VoronoiDiagram.Task(x, y, x + y * this.m_countX, g));\n            }\n        }\n        while (!queue.Empty()) {\n            var task = queue.Front();\n            var x = task.m_x;\n            var y = task.m_y;\n            var i = task.m_i;\n            var g = task.m_generator;\n            queue.Pop();\n            if (!this.m_diagram[i]) {\n                this.m_diagram[i] = g;\n                if (x > 0) {\n                    queue.Push(new b2VoronoiDiagram.Task(x - 1, y, i - 1, g));\n                }\n                if (y > 0) {\n                    queue.Push(new b2VoronoiDiagram.Task(x, y - 1, i - this.m_countX, g));\n                }\n                if (x < this.m_countX - 1) {\n                    queue.Push(new b2VoronoiDiagram.Task(x + 1, y, i + 1, g));\n                }\n                if (y < this.m_countY - 1) {\n                    queue.Push(new b2VoronoiDiagram.Task(x, y + 1, i + this.m_countX, g));\n                }\n            }\n        }\n        for (var y = 0; y < this.m_countY; y++) {\n            for (var x = 0; x < this.m_countX - 1; x++) {\n                var i = x + y * this.m_countX;\n                var a = this.m_diagram[i];\n                var b = this.m_diagram[i + 1];\n                if (a !== b) {\n                    queue.Push(new b2VoronoiDiagram.Task(x, y, i, b));\n                    queue.Push(new b2VoronoiDiagram.Task(x + 1, y, i + 1, a));\n                }\n            }\n        }\n        for (var y = 0; y < this.m_countY - 1; y++) {\n            for (var x = 0; x < this.m_countX; x++) {\n                var i = x + y * this.m_countX;\n                var a = this.m_diagram[i];\n                var b = this.m_diagram[i + this.m_countX];\n                if (a !== b) {\n                    queue.Push(new b2VoronoiDiagram.Task(x, y, i, b));\n                    queue.Push(new b2VoronoiDiagram.Task(x, y + 1, i + this.m_countX, a));\n                }\n            }\n        }\n        while (!queue.Empty()) {\n            var task = queue.Front();\n            var x = task.m_x;\n            var y = task.m_y;\n            var i = task.m_i;\n            var k = task.m_generator;\n            queue.Pop();\n            var a = this.m_diagram[i];\n            var b = k;\n            if (a !== b) {\n                var ax = a.center.x - x;\n                var ay = a.center.y - y;\n                var bx = b.center.x - x;\n                var by = b.center.y - y;\n                var a2 = ax * ax + ay * ay;\n                var b2 = bx * bx + by * by;\n                if (a2 > b2) {\n                    this.m_diagram[i] = b;\n                    if (x > 0) {\n                        queue.Push(new b2VoronoiDiagram.Task(x - 1, y, i - 1, b));\n                    }\n                    if (y > 0) {\n                        queue.Push(new b2VoronoiDiagram.Task(x, y - 1, i - this.m_countX, b));\n                    }\n                    if (x < this.m_countX - 1) {\n                        queue.Push(new b2VoronoiDiagram.Task(x + 1, y, i + 1, b));\n                    }\n                    if (y < this.m_countY - 1) {\n                        queue.Push(new b2VoronoiDiagram.Task(x, y + 1, i + this.m_countX, b));\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * Enumerate all nodes that contain at least one necessary\n     * generator.\n     */\n    b2VoronoiDiagram.prototype.GetNodes = function (callback) {\n        for (var y = 0; y < this.m_countY - 1; y++) {\n            for (var x = 0; x < this.m_countX - 1; x++) {\n                var i = x + y * this.m_countX;\n                var a = this.m_diagram[i];\n                var b = this.m_diagram[i + 1];\n                var c = this.m_diagram[i + this.m_countX];\n                var d = this.m_diagram[i + 1 + this.m_countX];\n                if (b !== c) {\n                    if (a !== b && a !== c &&\n                        (a.necessary || b.necessary || c.necessary)) {\n                        callback(a.tag, b.tag, c.tag);\n                    }\n                    if (d !== b && d !== c &&\n                        (a.necessary || b.necessary || c.necessary)) {\n                        callback(b.tag, d.tag, c.tag);\n                    }\n                }\n            }\n        }\n    };\n    return b2VoronoiDiagram;\n}());\nexports.b2VoronoiDiagram = b2VoronoiDiagram;\n(function (b2VoronoiDiagram) {\n    var Generator = /** @class */ (function () {\n        function Generator() {\n            this.center = new b2Math_1.b2Vec2();\n            this.tag = 0;\n            this.necessary = false;\n        }\n        return Generator;\n    }());\n    b2VoronoiDiagram.Generator = Generator;\n    var Task = /** @class */ (function () {\n        function Task(x, y, i, g) {\n            this.m_x = 0;\n            this.m_y = 0;\n            this.m_i = 0;\n            this.m_generator = null;\n            this.m_x = x;\n            this.m_y = y;\n            this.m_i = i;\n            this.m_generator = g;\n        }\n        return Task;\n    }());\n    b2VoronoiDiagram.Task = Task;\n})(b2VoronoiDiagram = exports.b2VoronoiDiagram || (exports.b2VoronoiDiagram = {})); // namespace b2VoronoiDiagram\nexports.b2VoronoiDiagram = b2VoronoiDiagram;\n// #endif\n\n\n//# sourceURL=webpack:///./src/Box2D/Particle/b2VoronoiDiagram.ts?");

/***/ }),

/***/ "./src/Box2D/Rope/b2Rope.ts":
/*!**********************************!*\
  !*** ./src/Box2D/Rope/b2Rope.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n/*\n* Copyright (c) 2011 Erin Catto http://www.box2d.org\n*\n* This software is provided 'as-is', without any express or implied\n* warranty.  In no event will the authors be held liable for any damages\n* arising from the use of this software.\n* Permission is granted to anyone to use this software for any purpose,\n* including commercial applications, and to alter it and redistribute it\n* freely, subject to the following restrictions:\n* 1. The origin of this software must not be misrepresented; you must not\n* claim that you wrote the original software. If you use this software\n* in a product, an acknowledgment in the product documentation would be\n* appreciated but is not required.\n* 2. Altered source versions must be plainly marked as such, and must not be\n* misrepresented as being the original software.\n* 3. This notice may not be removed or altered from any source distribution.\n*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar b2Draw_1 = __webpack_require__(/*! ../Common/b2Draw */ \"./src/Box2D/Common/b2Draw.ts\");\nvar b2Math_1 = __webpack_require__(/*! ../Common/b2Math */ \"./src/Box2D/Common/b2Math.ts\");\nvar b2Settings_1 = __webpack_require__(/*! ../Common/b2Settings */ \"./src/Box2D/Common/b2Settings.ts\");\n///\nvar b2RopeDef = /** @class */ (function () {\n    function b2RopeDef() {\n        ///\n        this.vertices = [];\n        ///\n        this.count = 0;\n        ///\n        this.masses = [];\n        ///\n        this.gravity = new b2Math_1.b2Vec2(0, 0);\n        ///\n        this.damping = 0.1;\n        /// Stretching stiffness\n        this.k2 = 0.9;\n        /// Bending stiffness. Values above 0.5 can make the simulation blow up.\n        this.k3 = 0.1;\n    }\n    return b2RopeDef;\n}());\nexports.b2RopeDef = b2RopeDef;\n///\nvar b2Rope = /** @class */ (function () {\n    function b2Rope() {\n        this.m_count = 0;\n        this.m_ps = null;\n        this.m_p0s = null;\n        this.m_vs = null;\n        this.m_ims = null;\n        this.m_Ls = null;\n        this.m_as = null;\n        this.m_gravity = new b2Math_1.b2Vec2();\n        this.m_damping = 0;\n        this.m_k2 = 1;\n        this.m_k3 = 0.1;\n    }\n    b2Rope.prototype.GetVertexCount = function () {\n        return this.m_count;\n    };\n    b2Rope.prototype.GetVertices = function () {\n        return this.m_ps;\n    };\n    ///\n    b2Rope.prototype.Initialize = function (def) {\n        /// b2Assert(def.count >= 3);\n        this.m_count = def.count;\n        // this.m_ps = (b2Vec2*)b2Alloc(this.m_count * sizeof(b2Vec2));\n        this.m_ps = b2Math_1.b2Vec2.MakeArray(this.m_count);\n        // this.m_p0s = (b2Vec2*)b2Alloc(this.m_count * sizeof(b2Vec2));\n        this.m_p0s = b2Math_1.b2Vec2.MakeArray(this.m_count);\n        // this.m_vs = (b2Vec2*)b2Alloc(this.m_count * sizeof(b2Vec2));\n        this.m_vs = b2Math_1.b2Vec2.MakeArray(this.m_count);\n        // this.m_ims = (float32*)b2Alloc(this.m_count * sizeof(float32));\n        this.m_ims = b2Settings_1.b2MakeNumberArray(this.m_count);\n        for (var i = 0; i < this.m_count; ++i) {\n            this.m_ps[i].Copy(def.vertices[i]);\n            this.m_p0s[i].Copy(def.vertices[i]);\n            this.m_vs[i].SetZero();\n            var m = def.masses[i];\n            if (m > 0) {\n                this.m_ims[i] = 1 / m;\n            }\n            else {\n                this.m_ims[i] = 0;\n            }\n        }\n        var count2 = this.m_count - 1;\n        var count3 = this.m_count - 2;\n        // this.m_Ls = (float32*)be2Alloc(count2 * sizeof(float32));\n        this.m_Ls = b2Settings_1.b2MakeNumberArray(count2);\n        // this.m_as = (float32*)b2Alloc(count3 * sizeof(float32));\n        this.m_as = b2Settings_1.b2MakeNumberArray(count3);\n        for (var i = 0; i < count2; ++i) {\n            var p1 = this.m_ps[i];\n            var p2 = this.m_ps[i + 1];\n            this.m_Ls[i] = b2Math_1.b2Vec2.DistanceVV(p1, p2);\n        }\n        for (var i = 0; i < count3; ++i) {\n            var p1 = this.m_ps[i];\n            var p2 = this.m_ps[i + 1];\n            var p3 = this.m_ps[i + 2];\n            var d1 = b2Math_1.b2Vec2.SubVV(p2, p1, b2Math_1.b2Vec2.s_t0);\n            var d2 = b2Math_1.b2Vec2.SubVV(p3, p2, b2Math_1.b2Vec2.s_t1);\n            var a = b2Math_1.b2Vec2.CrossVV(d1, d2);\n            var b = b2Math_1.b2Vec2.DotVV(d1, d2);\n            this.m_as[i] = b2Math_1.b2Atan2(a, b);\n        }\n        this.m_gravity.Copy(def.gravity);\n        this.m_damping = def.damping;\n        this.m_k2 = def.k2;\n        this.m_k3 = def.k3;\n    };\n    ///\n    b2Rope.prototype.Step = function (h, iterations) {\n        if (h === 0) {\n            return;\n        }\n        var d = Math.exp(-h * this.m_damping);\n        for (var i = 0; i < this.m_count; ++i) {\n            this.m_p0s[i].Copy(this.m_ps[i]);\n            if (this.m_ims[i] > 0) {\n                this.m_vs[i].SelfMulAdd(h, this.m_gravity);\n            }\n            this.m_vs[i].SelfMul(d);\n            this.m_ps[i].SelfMulAdd(h, this.m_vs[i]);\n        }\n        for (var i = 0; i < iterations; ++i) {\n            this.SolveC2();\n            this.SolveC3();\n            this.SolveC2();\n        }\n        var inv_h = 1 / h;\n        for (var i = 0; i < this.m_count; ++i) {\n            b2Math_1.b2Vec2.MulSV(inv_h, b2Math_1.b2Vec2.SubVV(this.m_ps[i], this.m_p0s[i], b2Math_1.b2Vec2.s_t0), this.m_vs[i]);\n        }\n    };\n    b2Rope.prototype.SolveC2 = function () {\n        var count2 = this.m_count - 1;\n        for (var i = 0; i < count2; ++i) {\n            var p1 = this.m_ps[i];\n            var p2 = this.m_ps[i + 1];\n            var d = b2Math_1.b2Vec2.SubVV(p2, p1, b2Rope.s_d);\n            var L = d.Normalize();\n            var im1 = this.m_ims[i];\n            var im2 = this.m_ims[i + 1];\n            if (im1 + im2 === 0) {\n                continue;\n            }\n            var s1 = im1 / (im1 + im2);\n            var s2 = im2 / (im1 + im2);\n            p1.SelfMulSub(this.m_k2 * s1 * (this.m_Ls[i] - L), d);\n            p2.SelfMulAdd(this.m_k2 * s2 * (this.m_Ls[i] - L), d);\n            // this.m_ps[i] = p1;\n            // this.m_ps[i + 1] = p2;\n        }\n    };\n    b2Rope.prototype.SetAngle = function (angle) {\n        var count3 = this.m_count - 2;\n        for (var i = 0; i < count3; ++i) {\n            this.m_as[i] = angle;\n        }\n    };\n    b2Rope.prototype.SolveC3 = function () {\n        var count3 = this.m_count - 2;\n        for (var i = 0; i < count3; ++i) {\n            var p1 = this.m_ps[i];\n            var p2 = this.m_ps[i + 1];\n            var p3 = this.m_ps[i + 2];\n            var m1 = this.m_ims[i];\n            var m2 = this.m_ims[i + 1];\n            var m3 = this.m_ims[i + 2];\n            var d1 = b2Math_1.b2Vec2.SubVV(p2, p1, b2Rope.s_d1);\n            var d2 = b2Math_1.b2Vec2.SubVV(p3, p2, b2Rope.s_d2);\n            var L1sqr = d1.LengthSquared();\n            var L2sqr = d2.LengthSquared();\n            if (L1sqr * L2sqr === 0) {\n                continue;\n            }\n            var a = b2Math_1.b2Vec2.CrossVV(d1, d2);\n            var b = b2Math_1.b2Vec2.DotVV(d1, d2);\n            var angle = b2Math_1.b2Atan2(a, b);\n            var Jd1 = b2Math_1.b2Vec2.MulSV((-1 / L1sqr), d1.SelfSkew(), b2Rope.s_Jd1);\n            var Jd2 = b2Math_1.b2Vec2.MulSV((1 / L2sqr), d2.SelfSkew(), b2Rope.s_Jd2);\n            var J1 = b2Math_1.b2Vec2.NegV(Jd1, b2Rope.s_J1);\n            var J2 = b2Math_1.b2Vec2.SubVV(Jd1, Jd2, b2Rope.s_J2);\n            var J3 = Jd2;\n            var mass = m1 * b2Math_1.b2Vec2.DotVV(J1, J1) + m2 * b2Math_1.b2Vec2.DotVV(J2, J2) + m3 * b2Math_1.b2Vec2.DotVV(J3, J3);\n            if (mass === 0) {\n                continue;\n            }\n            mass = 1 / mass;\n            var C = angle - this.m_as[i];\n            while (C > b2Settings_1.b2_pi) {\n                angle -= 2 * b2Settings_1.b2_pi;\n                C = angle - this.m_as[i];\n            }\n            while (C < -b2Settings_1.b2_pi) {\n                angle += 2 * b2Settings_1.b2_pi;\n                C = angle - this.m_as[i];\n            }\n            var impulse = -this.m_k3 * mass * C;\n            p1.SelfMulAdd((m1 * impulse), J1);\n            p2.SelfMulAdd((m2 * impulse), J2);\n            p3.SelfMulAdd((m3 * impulse), J3);\n            // this.m_ps[i] = p1;\n            // this.m_ps[i + 1] = p2;\n            // this.m_ps[i + 2] = p3;\n        }\n    };\n    b2Rope.prototype.Draw = function (draw) {\n        var c = new b2Draw_1.b2Color(0.4, 0.5, 0.7);\n        for (var i = 0; i < this.m_count - 1; ++i) {\n            draw.DrawSegment(this.m_ps[i], this.m_ps[i + 1], c);\n        }\n    };\n    ///\n    b2Rope.s_d = new b2Math_1.b2Vec2();\n    b2Rope.s_d1 = new b2Math_1.b2Vec2();\n    b2Rope.s_d2 = new b2Math_1.b2Vec2();\n    b2Rope.s_Jd1 = new b2Math_1.b2Vec2();\n    b2Rope.s_Jd2 = new b2Math_1.b2Vec2();\n    b2Rope.s_J1 = new b2Math_1.b2Vec2();\n    b2Rope.s_J2 = new b2Math_1.b2Vec2();\n    return b2Rope;\n}());\nexports.b2Rope = b2Rope;\n\n\n//# sourceURL=webpack:///./src/Box2D/Rope/b2Rope.ts?");

/***/ }),

/***/ "./src/Brick.ts":
/*!**********************!*\
  !*** ./src/Brick.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Laya_1 = __webpack_require__(/*! Laya */ \"./bin/libs/laya.core.js-exposed\");\nvar Box2D_1 = __webpack_require__(/*! ./Box2D/Box2D */ \"./src/Box2D/Box2D.ts\");\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\nvar enums_1 = __webpack_require__(/*! ./enums */ \"./src/enums.ts\");\nvar RigidSprite_1 = __webpack_require__(/*! ./RigidSprite */ \"./src/RigidSprite.ts\");\nvar Brick = /** @class */ (function (_super) {\n    __extends(Brick, _super);\n    function Brick(type, bodyDef, fixDef, drawSetting) {\n        var _this = _super.call(this, bodyDef, fixDef, drawSetting) || this;\n        _this.type = type;\n        return _this;\n    }\n    Object.defineProperty(Brick.prototype, \"hp\", {\n        get: function () {\n            return this._hp;\n        },\n        set: function (val) {\n            this._hp = val;\n            this._hpText.text = this._hp + '';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // get x() { return this._sprite.x; }\n    // set x(val) {\n    //     const offset = val - this._sprite.x;\n    //     this._sprite.x = val;\n    //     Body.setPosition(this._body, {\n    //         x: this._body.position.x + offset,\n    //         y: this._body.position.y\n    //     });\n    // }\n    // get y() { return this._sprite.y; }\n    // set y(val) {\n    //     const offset = val - this._sprite.y;\n    //     this._sprite.y = val;\n    //     Body.setPosition(this._body, {\n    //         x: this._body.position.x,\n    //         y: this._body.position.y + offset\n    //     });\n    // }\n    Brick.prototype.updateHpPosition = function () {\n        switch (this.type) {\n            case enums_1.BrickType.rect:\n                this._hpText.pos((constants_1.brickSize - this._hpText.width) / 2, (constants_1.brickSize - this._hpText.height) / 2);\n                break;\n            case enums_1.BrickType.triangle:\n                var vec = this.body.m_fixtureList.m_shape.m_centroid;\n                this._hpText.pos(vec.x * constants_1.worldScale - this._hpText.width / 2, vec.y * constants_1.worldScale - this._hpText.height / 2);\n                break;\n            default:\n                this._hpText.pos((this.width - this._hpText.width) / 2, (this._height - this._hpText.height) / 2);\n                break;\n        }\n    };\n    Brick.getOrCreate = function (type, x, y) {\n        var brick = Laya_1.Pool.getItem(type);\n        if (brick) {\n            // Laya.stage.addChild(brick);\n            brick.body.SetActive(true);\n            // brick.pos(x, y);\n            switch (brick.type) {\n                case enums_1.BrickType.circle:\n                case enums_1.BrickType.pentagon:\n                    brick.body.SetPositionXY((x + constants_1.half_size) / constants_1.worldScale, (y + constants_1.half_size) / constants_1.worldScale);\n                    break;\n                default:\n                    brick.body.SetPositionXY(x / constants_1.worldScale, y / constants_1.worldScale);\n                    break;\n            }\n            brick.reviving = true;\n            // brick.visible = true;\n            return brick;\n        }\n        else {\n            return this.createBrick(type, x, y);\n        }\n    };\n    Brick.recover = function (brick) {\n        // store.destroy_list.push(brick.body);\n        // Laya.stage.removeChild(brick);\n        brick.visible = false;\n        brick.body.SetActive(false);\n        Laya_1.Pool.recover(brick.type, brick);\n    };\n    Brick.createBrick = function (type, x, y) {\n        var bodyDef = new Box2D_1.b2BodyDef();\n        bodyDef.type = Box2D_1.b2BodyType.b2_kinematicBody;\n        bodyDef.position = new Box2D_1.b2Vec2(x / constants_1.worldScale, y / constants_1.worldScale);\n        bodyDef.linearVelocity.y = constants_1.brickSpeed / constants_1.worldScale;\n        var fixDef = new Box2D_1.b2FixtureDef();\n        fixDef.userData = enums_1.ContactFilterCategory.brick;\n        fixDef.friction = 0;\n        fixDef.filter.categoryBits = enums_1.ContactFilterCategory.brick;\n        fixDef.filter.maskBits = enums_1.ContactFilterCategory.ball | enums_1.ContactFilterCategory.bottom;\n        // let pos: [number, number];\n        // const a = x + half_size;\n        // const b = y + half_size;\n        switch (type) {\n            case enums_1.BrickType.rect:\n                (fixDef.shape = new Box2D_1.b2PolygonShape()).SetAsArray(constants_1.rectPoints, constants_1.rectPoints.length);\n                break;\n            case enums_1.BrickType.triangle:\n                // 直角三角形\n                var exclude = Math.floor(Math.random() * constants_1.trianglePoints.length);\n                var points = constants_1.trianglePoints.slice();\n                points.splice(exclude, 1);\n                // const center = Vertices.centre(points.map(p => ({ x: p[0] - half_size, y: p[1] - half_size })));\n                (fixDef.shape = new Box2D_1.b2PolygonShape()).SetAsArray(points, points.length);\n                var _a = constants_1.trianglePoints[exclude], i = _a.x, j = _a.y;\n                // pos = [i ? 0 : brickSize, j ? 0 : brickSize];\n                break;\n            case enums_1.BrickType.circle:\n                bodyDef.position.SelfAddXY(constants_1.half_size / constants_1.worldScale, constants_1.half_size / constants_1.worldScale);\n                (fixDef.shape = new Box2D_1.b2CircleShape(constants_1.half_size / constants_1.worldScale));\n                break;\n            case enums_1.BrickType.pentagon:\n                // 正五邊形\n                bodyDef.position.SelfAddXY(constants_1.half_size / constants_1.worldScale, constants_1.half_size / constants_1.worldScale);\n                (fixDef.shape = new Box2D_1.b2PolygonShape()).SetAsArray(constants_1.pentagon, constants_1.pentagon.length);\n                break;\n        }\n        var brick = new Brick(type, bodyDef, fixDef, {\n            fillColor: Brick.getRandomColor()\n        });\n        brick.pos(x, y);\n        brick.visible = constants_1.showSprite;\n        Laya.stage.addChild(brick);\n        brick._hpText = new Laya_1.Text();\n        brick._hpText.align = 'center';\n        brick._hpText.fontSize = 50;\n        // numText.color = '#' + (0xffffff - (+color.replace('#', '0x')));\n        brick._hpText.color = '#ffffff';\n        brick._hpText.stroke = 5;\n        brick.addChild(brick._hpText);\n        // if (pos) {\n        //     let [i, j] = pos;\n        //     if (i) {\n        //         i -= brick._hpText.width;\n        //     }\n        //     if (j) {\n        //         j -= brick._hpText.height;\n        //     }\n        //     brick._hpText.pos(i, j);\n        // }\n        // else {\n        //     brick._hpText.pos(-half_size / 2, -half_size / 2);\n        // }\n        return brick;\n    };\n    Brick.getRandomColor = function () {\n        return '#' + Math.floor(Math.random() * 16777215).toString(16);\n    };\n    return Brick;\n}(RigidSprite_1.RigidSprite));\nexports.Brick = Brick;\n\n\n//# sourceURL=webpack:///./src/Brick.ts?");

/***/ }),

/***/ "./src/GameState.ts":
/*!**************************!*\
  !*** ./src/GameState.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Laya_1 = __webpack_require__(/*! Laya */ \"./bin/libs/laya.core.js-exposed\");\nvar Box2D_1 = __webpack_require__(/*! ./Box2D/Box2D */ \"./src/Box2D/Box2D.ts\");\nvar Brick_1 = __webpack_require__(/*! ./Brick */ \"./src/Brick.ts\");\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\nvar enums_1 = __webpack_require__(/*! ./enums */ \"./src/enums.ts\");\nvar RigidSprite_1 = __webpack_require__(/*! ./RigidSprite */ \"./src/RigidSprite.ts\");\nvar store_1 = __webpack_require__(/*! ./store */ \"./src/store.ts\");\nvar GameState = /** @class */ (function () {\n    function GameState() {\n        // const bodyDef = new b2BodyDef();\n        // bodyDef.type = b2BodyType.b2_staticBody;\n        // const fixtureDef = new b2FixtureDef();\n        // fixtureDef.shape = new b2CircleShape(5);\n        // Laya.stage.addChild(new RigidSprite(bodyDef, fixtureDef, {\n        //     fillColor: '#123456',\n        //     lineColor: '#000000',\n        //     lineWidth: 1\n        // }));\n        this.LayaRender = Laya_1.Browser.window.LayaRender;\n        this.bricks = {};\n        this.rowIndex = 0;\n        this.currentY = 0;\n        // this.initMatter();\n        this.initWorld();\n        // Laya.stage.on('resize', this, this.onResize);\n        // Laya.timer.loop(16, this, () => {\n        //     for (const child of Laya.stage._childs) {\n        //         (child as Laya.Sprite).y++;\n        //     }\n        // });\n    }\n    GameState.prototype.initMatter = function () {\n        // const gameWorld: Sprite = new Sprite();\n        // Laya.stage.addChild(gameWorld);\n        // 初始化物理引擎\n        // store.engine = Engine.create({ enableSleeping: true });\n        // store.engine.world.gravity.x = 0;\n        // store.engine.world.gravity.y = 0.01;\n        // Engine.run(store.engine);\n        // const render = this.LayaRender.create({\n        //     engine: store.engine,\n        //     container: gameWorld,\n        //     width: worldWidth,\n        //     height: worldHeight,\n        //     options: {\n        //         wireframes: showWireframe,\n        //         showAngleIndicator: false\n        //     }\n        // });\n        // this.LayaRender.run(render);\n        // this.mouseConstraint = MouseConstraint.create(this.engine, { element: Laya.Render.canvas });\n        // World.add(this.engine.world, this.mouseConstraint);\n        // render.mouse = this.mouseConstraint.mouse;\n    };\n    GameState.prototype.initWorld = function () {\n        var walls = [\n            this.createWall(0, -1, constants_1.worldWidth, 1, enums_1.ContactFilterCategory.top, enums_1.ContactFilterCategory.top),\n            this.createWall(-1, 0, 1, constants_1.worldHeight, enums_1.ContactFilterCategory.left, enums_1.ContactFilterCategory.left),\n            this.createWall(constants_1.worldWidth + 1, 0, 1, constants_1.worldHeight, enums_1.ContactFilterCategory.right, enums_1.ContactFilterCategory.right),\n            this.createWall(0, constants_1.worldHeight + 1, constants_1.worldWidth, 1, enums_1.ContactFilterCategory.bottom, enums_1.ContactFilterCategory.bottom)\n        ];\n        var bodyDef = new Box2D_1.b2BodyDef();\n        bodyDef.position = Box2D_1.b2Vec2_zero;\n        bodyDef.type = Box2D_1.b2BodyType.b2_staticBody;\n        var body = store_1.store.world.CreateBody(bodyDef);\n        for (var _i = 0, walls_1 = walls; _i < walls_1.length; _i++) {\n            var w = walls_1[_i];\n            body.CreateFixture(w);\n        }\n        // Laya.timer.loop(1000 / brickSpeed, this, this.moveBrick);\n        Laya.stage.on(Laya_1.Event.MOUSE_DOWN, this, this.onMouseDown);\n        var listener = new Box2D_1.b2ContactListener();\n        listener.BeginContact = this.onCollision.bind(this);\n        store_1.store.world.SetContactListener(listener);\n        // const cannon = new Sprite();\n        // cannon.pos((worldWidth - ball_size) / 2, worldHeight - ball_size);\n        // cannon.graphics.drawCircle(0, 0, ball_size, '0x000000');\n        // Laya.stage.addChild(cannon);\n        this.lv = new Laya_1.Text();\n        this.lv.fontSize = 100;\n        this.lv.color = '#000000';\n        this.lv.pos(20, constants_1.worldHeight - 110);\n        this.lv.text = 'lv:1';\n        Laya.stage.addChild(this.lv);\n        this.createRow(-constants_1.brickSize - constants_1.offset);\n        // this.startTime = Date.now();\n        store_1.store.otherSync = this.update.bind(this);\n    };\n    GameState.prototype.createWall = function (x, y, width, height, category, label) {\n        x /= constants_1.worldScale;\n        y /= constants_1.worldScale;\n        width /= constants_1.worldScale;\n        height /= constants_1.worldScale;\n        var fixtureDef = new Box2D_1.b2FixtureDef();\n        fixtureDef.userData = label;\n        (fixtureDef.shape = new Box2D_1.b2PolygonShape()).SetAsBox(width / 2, height / 2, new Box2D_1.b2Vec2(x + width / 2, y + height / 2));\n        fixtureDef.filter.categoryBits = category;\n        fixtureDef.filter.maskBits = enums_1.ContactFilterCategory.ball;\n        if (category === enums_1.ContactFilterCategory.bottom) {\n            fixtureDef.filter.maskBits |= enums_1.ContactFilterCategory.brick;\n        }\n        return fixtureDef;\n    };\n    GameState.prototype.createRow = function (y) {\n        var row = [];\n        var columnIndex = 0;\n        for (var x = constants_1.offset; x < constants_1.worldWidth; x += constants_1.brickSize) {\n            var brick = void 0;\n            if (Math.random() > 0) {\n                brick = Brick_1.Brick.getOrCreate(this.PickBrickType(), x, y);\n                // const color = this.getRandomColor();\n                // brick = new Sprite();\n                // brick.visible = false;\n                brick.hp = Math.ceil(Math.random() * 10) + 1;\n                brick.updateHpPosition();\n                // this.createBrick(brick, color, Math.ceil(Math.random() * 50) + 1);\n                // Laya.stage.addChild(brick);\n                brick.rowIndex = this.rowIndex;\n                brick.columnIndex = columnIndex;\n            }\n            row.push(brick);\n            columnIndex++;\n            x += constants_1.offset;\n        }\n        this.bricks[this.rowIndex] = row;\n        this.rowIndex++;\n        if (this.dummyAnchor) {\n            this.dummyAnchor.SetPositionXY(0, y / constants_1.worldScale);\n        }\n        else {\n            var bodyDef = new Box2D_1.b2BodyDef();\n            bodyDef.type = Box2D_1.b2BodyType.b2_kinematicBody;\n            bodyDef.position.y = y / constants_1.worldScale;\n            bodyDef.linearVelocity = new Box2D_1.b2Vec2(0, constants_1.brickSpeed / constants_1.worldScale);\n            this.dummyAnchor = store_1.store.world.CreateBody(bodyDef);\n        }\n    };\n    // private onResize() {\n    //     // 设置鼠标的坐标缩放\n    //     Mouse.setScale(this.mouseConstraint.mouse,\n    //         {\n    //             x: 1 / (Laya.stage.clientScaleX * Laya.stage._canvasTransform.a),\n    //             y: 1 / (Laya.stage.clientScaleY * Laya.stage._canvasTransform.d)\n    //         });\n    // }\n    GameState.prototype.onMouseDown = function (e) {\n        var _this = this;\n        Laya.timer.loop(1000 / constants_1.fireSpeed, this, this.fire, [e]);\n        Laya.stage.once(Laya_1.Event.MOUSE_UP, this, function () {\n            Laya.timer.clear(_this, _this.fire);\n        });\n    };\n    GameState.prototype.fire = function (e) {\n        var ball = Laya_1.Pool.getItem(enums_1.ContactFilterCategory.ball.toString());\n        if (!ball) {\n            var bodyDef = new Box2D_1.b2BodyDef();\n            bodyDef.type = Box2D_1.b2BodyType.b2_dynamicBody;\n            // bodyDef.position = new b2Vec2(300 / worldScale, 300 / worldScale);\n            bodyDef.position = new Box2D_1.b2Vec2((constants_1.cannon_position.x - constants_1.ball_radius / 2) / constants_1.worldScale, constants_1.cannon_position.y / constants_1.worldScale);\n            bodyDef.bullet = true;\n            var fixtureDef = new Box2D_1.b2FixtureDef();\n            fixtureDef.userData = enums_1.ContactFilterCategory.ball;\n            fixtureDef.friction = 0;\n            fixtureDef.restitution = 1;\n            fixtureDef.shape = new Box2D_1.b2CircleShape(constants_1.ball_radius / constants_1.worldScale);\n            fixtureDef.filter.categoryBits = enums_1.ContactFilterCategory.ball;\n            fixtureDef.filter.maskBits = enums_1.ContactFilterCategory.brick | enums_1.ContactFilterCategory.wall;\n            ball = new RigidSprite_1.RigidSprite(bodyDef, fixtureDef, {\n                fillColor: '#ffffff',\n                lineColor: '#000000',\n                lineWidth: 1\n            });\n            Laya.stage.addChild(ball);\n        }\n        else {\n            ball.pos(constants_1.cannon_position.x, constants_1.cannon_position.y);\n            ball.visible = true;\n            ball.body.SetActive(true);\n        }\n        var v = new Box2D_1.b2Vec2(e.stageX - constants_1.cannon_position.x, e.stageY - constants_1.cannon_position.y);\n        var vec = v.SelfNormalize().SelfMul(constants_1.ball_speed);\n        ball.body.SetLinearVelocity(vec);\n    };\n    GameState.prototype.onCollision = function (contact) {\n        // const labelA = contact.m_fixtureA.m_userData;\n        // const labelB = contact.m_fixtureB.m_userData;\n        var _a = contact.m_fixtureA, labelA = _a.m_userData, SpriteA = _a.m_body.m_userData, _b = contact.m_fixtureB, labelB = _b.m_userData, SpriteB = _b.m_body.m_userData;\n        var contactType = labelA | labelB;\n        switch (contactType) {\n            case enums_1.ContactFilterCategory.ballContactBrick:\n                var brick = (labelA === enums_1.ContactFilterCategory.brick ? SpriteA : SpriteB);\n                if (brick.hp === 1) {\n                    // target.collisionFilter.category = CollisionCategory.none;\n                    this.bricks[brick.rowIndex][brick.columnIndex] = null;\n                    Brick_1.Brick.recover(brick);\n                    // // 移除空白列\n                    // if (this.bricks[brick.rowIndex].every(b => !b)) {\n                    //     delete this.bricks[brick.rowIndex];\n                    // }\n                }\n                else {\n                    brick.hp -= 1;\n                    if (brick.hp === 9 || brick.hp === 99) {\n                        brick.updateHpPosition();\n                    }\n                }\n                break;\n            case enums_1.ContactFilterCategory.ballContactBottom:\n                var ball_1 = labelA === enums_1.ContactFilterCategory.ball ? SpriteA : SpriteB;\n                ball_1.body.m_type = Box2D_1.b2BodyType.b2_staticBody;\n                // ball.inertia = 1;\n                // Body.setVelocity(ball, { x: 1, y: 0 });\n                // Body.setVelocity(ball, { x: ball_speed * (ball.position.x > worldWidth / 2 ? -1 : 1), y: 0 });\n                // ball.y = worldHeight - ball_size;\n                // Body.setStatic(ball, true);\n                // Sleeping.set(ball, true);\n                // ball.collisionFilter.mask &= ~CollisionCategory.bottom;\n                // const ms = Math.abs(ball.position.x - worldWidth / 2) / 30;\n                Laya_1.Tween.to(ball_1.body.m_xf.p, { x: constants_1.worldWidth / constants_1.worldScale / 2 }, 100, null, Laya_1.Handler.create(this, function () {\n                    // store.destroy_list.push(sball.body);\n                    ball_1.body.SetActive(false);\n                    ball_1.visible = false;\n                    ball_1.body.m_type = Box2D_1.b2BodyType.b2_dynamicBody;\n                }));\n                break;\n            case enums_1.ContactFilterCategory.brickContactBottom:\n                Laya.timer.callLater(this, this.loseGame);\n                break;\n        }\n        // let target: b2Fixture;\n        // let ball: Brick;\n        // if (contact.m_fixtureA.m_userData === Label.ball) {\n        //     ball = contact.m_fixtureA.m_body.m_userData;\n        //     target = contact.m_fixtureB;\n        // }\n        // else if (contact.m_fixtureB.m_userData === Label.ball) {\n        //     ball = contact.m_fixtureB.m_body.m_userData;\n        //     target = contact.m_fixtureA;\n        // }\n        // if (target) {\n        //     switch (target.m_userData) {\n        //         case Label.brick:\n        //             const sprite = target.m_body.m_userData;\n        //             const brick = this.bricks[sprite.rowIndex][sprite.columnIndex];\n        //             if (brick.hp === 1) {\n        //                 // target.collisionFilter.category = CollisionCategory.none;\n        //                 this.bricks[sprite.rowIndex][sprite.columnIndex] = null;\n        //                 Brick.recover(brick);\n        //                 // 移除空白列\n        //                 if (this.bricks[sprite.rowIndex].every(b => !b)) {\n        //                     delete this.bricks[sprite.rowIndex];\n        //                 }\n        //             }\n        //             else {\n        //                 brick.hp -= 1;\n        //             }\n        //             break;\n        //         // case Label.bottom:\n        //         //     if (ball) {\n        //         //         p.isActive = false;\n        //         //         // ball.inertia = 1;\n        //         //         // Body.setVelocity(ball, { x: 1, y: 0 });\n        //         //         // Body.setVelocity(ball, { x: ball_speed * (ball.position.x > worldWidth / 2 ? -1 : 1), y: 0 });\n        //         //         ball.position.y = worldHeight - ball_size;\n        //         //         // Body.setStatic(ball, true);\n        //         //         Sleeping.set(ball, true);\n        //         //         ball.collisionFilter.mask &= ~CollisionCategory.bottom;\n        //         //         // const ms = Math.abs(ball.position.x - worldWidth / 2) / 30;\n        //         //         Tween.to(ball.position, { x: worldWidth / 2 }, 100, null, Handler.create(this, () => {\n        //         //             Pool.recover(Label.ball, ball);\n        //         //             World.remove(store.engine.world, ball);\n        //         //         }));\n        //         //     }\n        //         //     break;\n        //         // case Label.cannon:\n        //         //     p.isActive = false;\n        //         //     ball.collisionFilter.mask = CollisionCategory.none;\n        //         //     Body.setVelocity(ball, { x: 0, y: 0 });\n        //         //     ball.render.visible = false;\n        //         //     Sleeping.set(target, true);\n        //         //     break;\n        //     }\n        // }\n    };\n    // private shouldCollide(a: b2Fixture, b: b2Fixture) {\n    //     a.m_userData\n    // }\n    GameState.prototype.update = function () {\n        // const rowIndexies = Object.keys(this.bricks);\n        // if (rowIndexies.length) {\n        //     for (let i = 0; i < rowIndexies.length; i++) {\n        //         const rowIndex = +rowIndexies[i];\n        //         if (i === 0) {\n        //             // 判斷最底下那行著地了?\n        //             const firstColumn = this.bricks[rowIndex].find(b => !!b);\n        //             if (firstColumn) {\n        //                 // const body = firstColumn.body as Body;\n        //                 if (firstColumn.y + brickSize > worldHeight) {\n        //                     this.loseGame();\n        //                 }\n        //             }\n        //             else {\n        //                 delete this.bricks[rowIndex];\n        //             }\n        //         }\n        //         // for (const brick of this.bricks[rowIndex]) {\n        //         //     if (brick) {\n        //         //         brick.updateTextPosition();\n        //         //     }\n        //         // }\n        //     }\n        // }\n        var y = this.dummyAnchor.GetPosition().y;\n        if (y >= 0) {\n            this.createRow(-constants_1.brickSize - constants_1.offset + y * constants_1.worldScale);\n            this.lv.text = 'lv:' + this.rowIndex;\n        }\n        // const now = Date.now();\n        // const timeOffset = now - this.startTime - (this.rowIndex * ((brickSize - offset) / brickSpeed) * 1000);\n        // if (timeOffset >= 0) {\n        //     // 最新的那列，往下超過了一列的距確\n        //     this.createRow(-brickSize + (timeOffset * brickSpeed) / 1000);\n        //     this.lv.text = 'lv:' + this.rowIndex;\n        // }\n        // // 判斷加新的磚\n        // if (this.currentY === 0) {\n        //     this.createRow(-brickSize);\n        //     this.lv.text = 'lv:' + this.rowIndex;\n        // }\n        // this.currentY++;\n        // if (this.currentY > ) {\n        //     this.currentY = 0;\n        // }\n        // for (const row of rowIndexies) {\n        //     for (const brick of this.bricks[+row]) {\n        //         if (brick) {\n        //             // body.position.y++;\n        //             // Body.setPosition(body, { x: body.position.x, y: body.position.y + 1 });\n        //             const pos = brick.body.GetPosition();\n        //             brick.body.SetPositionXY(pos.x, pos.y + brickSpeed / worldScale);\n        //         }\n        //     }\n        // }\n    };\n    GameState.prototype.PickBrickType = function () {\n        // return BrickType.circle;\n        var rand = Math.random();\n        if (rand < .7) {\n            return enums_1.BrickType.rect;\n        }\n        else if (rand < .8) {\n            return enums_1.BrickType.circle;\n        }\n        else if (rand < .9) {\n            return enums_1.BrickType.triangle;\n        }\n        return enums_1.BrickType.pentagon;\n    };\n    GameState.prototype.loseGame = function () {\n        Laya.timer.clearAll(this);\n        store_1.store.gameOver();\n        alert('You 魯蛇');\n    };\n    return GameState;\n}());\nexports.GameState = GameState;\n\n\n//# sourceURL=webpack:///./src/GameState.ts?");

/***/ }),

/***/ "./src/RigidSprite.ts":
/*!****************************!*\
  !*** ./src/RigidSprite.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Laya_1 = __webpack_require__(/*! Laya */ \"./bin/libs/laya.core.js-exposed\");\nvar Box2D_1 = __webpack_require__(/*! ./Box2D/Box2D */ \"./src/Box2D/Box2D.ts\");\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\nvar store_1 = __webpack_require__(/*! ./store */ \"./src/store.ts\");\n/**\n * Sprite with body\n */\nvar RigidSprite = /** @class */ (function (_super) {\n    __extends(RigidSprite, _super);\n    function RigidSprite(bodyDef, fixDef, drawSetting) {\n        var _this = _super.call(this) || this;\n        _this.body = store_1.store.world.CreateBody(bodyDef);\n        _this.body.CreateFixture(fixDef);\n        _this.body.SetUserData(_this);\n        _this.pos(bodyDef.position.x * constants_1.worldScale, bodyDef.position.y * constants_1.worldScale);\n        _this.drawSprite(drawSetting);\n        return _this;\n        // this.on('REMOVED', this, this.removed);\n    }\n    RigidSprite.prototype.drawSprite = function (_a) {\n        var fillColor = _a.fillColor, lineColor = _a.lineColor, lineWidth = _a.lineWidth;\n        for (var fixture = this.body.m_fixtureList; fixture; fixture = fixture.m_next) {\n            switch (fixture.m_shape.m_type) {\n                case Box2D_1.b2ShapeType.e_circleShape:\n                    var radius = fixture.m_shape.m_radius * constants_1.worldScale;\n                    this.graphics.drawCircle(0, 0, radius, fillColor, lineColor, lineWidth);\n                    break;\n                case Box2D_1.b2ShapeType.e_polygonShape:\n                    var shape = fixture.m_shape;\n                    var v = shape.m_vertices\n                        .slice(0, shape.m_count)\n                        .reduce(function (prev, vec, i) {\n                        prev.push(vec.x * constants_1.worldScale, vec.y * constants_1.worldScale);\n                        return prev;\n                    }, []);\n                    this.graphics.drawPoly(0, 0, v, fillColor, lineColor, lineWidth);\n                    break;\n            }\n        }\n    };\n    return RigidSprite;\n}(Laya_1.Sprite));\nexports.RigidSprite = RigidSprite;\n\n\n//# sourceURL=webpack:///./src/RigidSprite.ts?");

/***/ }),

/***/ "./src/app.ts":
/*!********************!*\
  !*** ./src/app.ts ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__webpack_require__(/*! ./library */ \"./src/library.ts\");\nvar Laya_1 = __webpack_require__(/*! Laya */ \"./bin/libs/laya.core.js-exposed\");\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\n// import './debugDraw';\nvar GameState_1 = __webpack_require__(/*! ./GameState */ \"./src/GameState.ts\");\nLaya.init(constants_1.worldWidth, constants_1.worldHeight);\nif (constants_1.debug) {\n    Laya_1.DebugPanel.init(true);\n}\nLaya.stage.alignV = Laya_1.Stage.ALIGN_MIDDLE;\nLaya.stage.alignH = Laya_1.Stage.ALIGN_CENTER;\nLaya.stage.scaleMode = \"showall\";\nLaya.stage.bgColor = \"#edeced\";\nnew GameState_1.GameState();\n\n\n//# sourceURL=webpack:///./src/app.ts?");

/***/ }),

/***/ "./src/constants.ts":
/*!**************************!*\
  !*** ./src/constants.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Box2D_1 = __webpack_require__(/*! ./Box2D/Box2D */ \"./src/Box2D/Box2D.ts\");\nexports.debug = false;\n/** 一公尺 = 36 pixel */\nexports.worldScale = 36;\nexports.worldWidth = 1080;\nexports.worldHeight = 1980;\nexports.brickSize = 140;\nexports.half_size = exports.brickSize / 2;\nexports.w_num = 7;\nexports.h_num = 14;\nexports.offset = (exports.worldWidth - exports.brickSize * exports.w_num) / (exports.w_num + 1);\nexports.g_color = '#FFFFFF';\nexports.g_lineColor = '#000000';\nexports.g_border = 1;\nexports.ball_radius = 25;\nexports.cannon_position = { x: exports.worldWidth / 2, y: exports.worldHeight - exports.ball_radius };\nexports.ball_speed = 45;\n/** 秒/pixel */\nexports.brickSpeed = exports.brickSize / 5;\nexports.showWireframe = false;\nexports.showSprite = true;\n/** 秒/發 */\nexports.fireSpeed = 8;\n/** velocityInterations 是对速率的纠正程度, 越高计算量越大 */\nexports.velocityInterations = 3;\n/** velocityInterations 是对位置的纠正程度, 越高计算量越大 */\nexports.positionIterations = 2;\nexports.timeStep = 1000 / 60;\nexports.trianglePoints = [\n    Box2D_1.b2Vec2_zero,\n    new Box2D_1.b2Vec2(exports.brickSize / exports.worldScale, 0),\n    new Box2D_1.b2Vec2(exports.brickSize / exports.worldScale, exports.brickSize / exports.worldScale),\n    new Box2D_1.b2Vec2(0, exports.brickSize / exports.worldScale)\n];\nexports.rectPoints = [\n    Box2D_1.b2Vec2_zero,\n    new Box2D_1.b2Vec2(exports.brickSize / exports.worldScale, 0),\n    new Box2D_1.b2Vec2(exports.brickSize / exports.worldScale, exports.brickSize / exports.worldScale),\n    new Box2D_1.b2Vec2(0, exports.brickSize / exports.worldScale)\n];\nexports.pentagon = [\n    new Box2D_1.b2Vec2(0, -exports.half_size / exports.worldScale),\n    new Box2D_1.b2Vec2(exports.half_size * Math.cos(Math.PI * .1) / exports.worldScale, -exports.half_size * Math.sin(Math.PI * .1) / exports.worldScale),\n    new Box2D_1.b2Vec2(exports.half_size * Math.sin(Math.PI * .2) / exports.worldScale, exports.half_size * Math.cos(Math.PI * .2) / exports.worldScale),\n    new Box2D_1.b2Vec2(-exports.half_size * Math.sin(Math.PI * .2) / exports.worldScale, exports.half_size * Math.cos(Math.PI * .2) / exports.worldScale),\n    new Box2D_1.b2Vec2(-exports.half_size * Math.cos(Math.PI * .1) / exports.worldScale, -exports.half_size * Math.sin(Math.PI * .1) / exports.worldScale)\n];\n// export const flatPentagon = pentagon.reduce((prev, vec) => {\n//     prev.push(vec.x, vec.y);\n//     return prev;\n// }, []);\n\n\n//# sourceURL=webpack:///./src/constants.ts?");

/***/ }),

/***/ "./src/enums.ts":
/*!**********************!*\
  !*** ./src/enums.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ContactFilterCategory;\n(function (ContactFilterCategory) {\n    ContactFilterCategory[ContactFilterCategory[\"none\"] = 0] = \"none\";\n    ContactFilterCategory[ContactFilterCategory[\"top\"] = 1] = \"top\";\n    ContactFilterCategory[ContactFilterCategory[\"right\"] = 2] = \"right\";\n    ContactFilterCategory[ContactFilterCategory[\"bottom\"] = 4] = \"bottom\";\n    ContactFilterCategory[ContactFilterCategory[\"left\"] = 8] = \"left\";\n    ContactFilterCategory[ContactFilterCategory[\"wall\"] = 15] = \"wall\";\n    ContactFilterCategory[ContactFilterCategory[\"brick\"] = 16] = \"brick\";\n    ContactFilterCategory[ContactFilterCategory[\"ball\"] = 32] = \"ball\";\n    ContactFilterCategory[ContactFilterCategory[\"ballContactBrick\"] = 48] = \"ballContactBrick\";\n    ContactFilterCategory[ContactFilterCategory[\"ballContactWall\"] = 47] = \"ballContactWall\";\n    ContactFilterCategory[ContactFilterCategory[\"ballContactBottom\"] = 36] = \"ballContactBottom\";\n    ContactFilterCategory[ContactFilterCategory[\"brickContactBottom\"] = 20] = \"brickContactBottom\";\n})(ContactFilterCategory = exports.ContactFilterCategory || (exports.ContactFilterCategory = {}));\n// export enum Label {\n//     none = 0,\n//     top = 1,\n//     right = 2,\n//     bottom = 4,\n//     left = 8,\n//     ball = 16,\n//     brick = 32\n//     // cannon = 'cannon'\n// }\nvar BrickType;\n(function (BrickType) {\n    BrickType[\"circle\"] = \"circle\";\n    BrickType[\"triangle\"] = \"triangle\";\n    BrickType[\"rect\"] = \"rect\";\n    BrickType[\"pentagon\"] = \"pentagon\";\n    BrickType[\"increase\"] = \"increase\";\n    BrickType[\"decrease\"] = \"decrease\";\n})(BrickType = exports.BrickType || (exports.BrickType = {}));\n\n\n//# sourceURL=webpack:///./src/enums.ts?");

/***/ }),

/***/ "./src/library.ts":
/*!************************!*\
  !*** ./src/library.ts ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// 核心包，封装了显示对象渲染，事件，时间管理，时间轴动画，缓动，消息交互,socket，本地存储，鼠标触摸，声音，加载，颜色滤镜，位图字体等\n__webpack_require__(/*! ../bin/libs/laya.core.js */ \"./bin/libs/laya.core.js-exposed\");\n// 提供了微信小游戏的适配\n__webpack_require__(/*! ../bin/libs/laya.wxmini.js */ \"./bin/libs/laya.wxmini.js\");\n// 封装了webgl渲染管线，如果使用webgl渲染，可以在初始化时调用Laya.init(1000,800,laya.webgl.WebGL);\n// tslint:disable-next-line:ordered-imports\n__webpack_require__(/*! ../bin/libs/laya.webgl.js */ \"./bin/libs/laya.webgl.js\");\n// 是动画模块，包含了swf动画，骨骼动画等\n// tslint:disable-next-line:ordered-imports\n__webpack_require__(/*! ../bin/libs/laya.ani.js */ \"./bin/libs/laya.ani.js\");\n// 包含更多webgl滤镜，比如外发光，阴影，模糊以及更多\n__webpack_require__(/*! ../bin/libs/laya.filter.js */ \"./bin/libs/laya.filter.js\");\n// 封装了html动态排版功能\n__webpack_require__(/*! ../bin/libs/laya.html.js */ \"./bin/libs/laya.html.js\");\n// 粒子类库\n__webpack_require__(/*! ../bin/libs/laya.particle.js */ \"./bin/libs/laya.particle.js\");\n// 提供tileMap解析支持\n__webpack_require__(/*! ../bin/libs/laya.tiledmap.js */ \"./bin/libs/laya.tiledmap.js\");\n// 提供了制作UI的各种组件实现\n__webpack_require__(/*! ../bin/libs/laya.ui.js */ \"./bin/libs/laya.ui.js\");\n//  物理引擎matter.js\n// tslint:disable-next-line:ordered-imports\n// import '../bin/libs/decomp.js';\n// import '../bin/libs/matter.js';\n// tslint:disable-next-line:ordered-imports\n// import 'poly-decomp';\n// tslint:disable-next-line:ordered-imports\n// import 'matter-js';\n// tslint:disable-next-line:ordered-imports\n// import '../bin/libs/LayaRender.js';\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\nif (constants_1.debug) {\n    // tslint:disable-next-line:no-var-requires\n    __webpack_require__(/*! ../bin/libs/laya.debugtool.js */ \"./bin/libs/laya.debugtool.js\");\n}\n\n\n//# sourceURL=webpack:///./src/library.ts?");

/***/ }),

/***/ "./src/store.ts":
/*!**********************!*\
  !*** ./src/store.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Box2D_1 = __webpack_require__(/*! ./Box2D/Box2D */ \"./src/Box2D/Box2D.ts\");\nvar constants_1 = __webpack_require__(/*! ./constants */ \"./src/constants.ts\");\nvar Store = /** @class */ (function () {\n    function Store() {\n        this.isOver = false;\n        this.world = new Box2D_1.b2World(new Box2D_1.b2Vec2(0, 0.1));\n        this.world.SetAllowSleeping(true);\n        this.update();\n    }\n    // readonly destroy_list: b2Body[] = [];\n    Store.prototype.gameOver = function () {\n        this.otherSync = null;\n        this.isOver = true;\n        cancelAnimationFrame(this.timer);\n    };\n    Store.prototype.update = function () {\n        var _this = this;\n        if (!this.isOver) {\n            // for (const body of this.destroy_list) {\n            //     this.world.DestroyBody(body);\n            //     Laya.stage.removeChild(body.m_userData);\n            // }\n            // this.destroy_list.length = 0;\n            this.world.Step(constants_1.timeStep * 0.00125, constants_1.velocityInterations, constants_1.positionIterations);\n            this.world.ClearForces();\n            // this.world.DrawDebugData(); // 绘制绑定到debug视图上渲染\n            this.sync();\n            if (this.otherSync) {\n                this.otherSync();\n            }\n            this.timer = requestAnimationFrame(function () { return _this.update(); });\n        }\n    };\n    Store.prototype.sync = function () {\n        // let count = 0;\n        for (var body = this.world.m_bodyList; body; body = body.m_next) {\n            if (body.m_userData && body.IsActive) {\n                var _a = body.GetPosition(), x = _a.x, y = _a.y;\n                var sprite = body.m_userData;\n                sprite.pos(x * constants_1.worldScale, y * constants_1.worldScale);\n                // console.log(count++);\n                // console.log(x * worldScale, y * worldScale);\n                if (sprite.reviving) {\n                    sprite.reviving = false;\n                    sprite.visible = true;\n                }\n            }\n        }\n    };\n    Store.prototype.otherSync = function () { };\n    return Store;\n}());\nexports.store = new Store();\n\n\n//# sourceURL=webpack:///./src/store.ts?");

/***/ })

/******/ });